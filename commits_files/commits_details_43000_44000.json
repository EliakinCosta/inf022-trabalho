[{"sha": "a5984f1bec46fe87138713afe7f2b5888d088504", "stats": {"total": 1, "additions": 1, "deletions": 0}, "files": [{"sha": "39622a9b178c780bcb5d49c35916f483b7336c09", "filename": "linux/build-image.sh", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/a5984f1bec46fe87138713afe7f2b5888d088504/linux/build-image.sh", "raw_url": "https://github.com/KDE/krita/raw/a5984f1bec46fe87138713afe7f2b5888d088504/linux/build-image.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/linux/build-image.sh?ref=a5984f1bec46fe87138713afe7f2b5888d088504", "patch": "@@ -142,6 +142,7 @@ rm -f usr/lib/libSM.so.6 || true\n rm -f usr/lib/libusb-1.0.so.0 || true\n rm -f usr/lib/libuuid.so.1 || true\n rm -f usr/lib/libwind.so.0 || true\n+rm -f usr/lib/libfontconfig.so.* || true\n \n # Remove these libraries, we need to use the system versions; this means 11.04 is not supported (12.04 is our baseline)\n rm -f usr/lib/libGL.so.* || true"}]}, {"sha": "e413f106622e0a3ea555ce5a24956f099d00754b", "stats": {"total": 32, "additions": 14, "deletions": 18}, "files": [{"sha": "53e2d185f260f30341d063f5f62372ae2a0da320", "filename": "libs/ui/thememanager.cpp", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/e413f106622e0a3ea555ce5a24956f099d00754b/libs/ui/thememanager.cpp", "raw_url": "https://github.com/KDE/krita/raw/e413f106622e0a3ea555ce5a24956f099d00754b/libs/ui/thememanager.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/thememanager.cpp?ref=e413f106622e0a3ea555ce5a24956f099d00754b", "patch": "@@ -251,7 +251,7 @@ void ThemeManager::populateThemeMenu()\n \n \n     QAction * action;\n-    const QStringList schemeFiles = KoResourcePaths::findAllResources(\"data\", \"color-schemes/*.colors\", KoResourcePaths::NoDuplicates);\n+    const QStringList schemeFiles = KoResourcePaths::findAllResources(\"data\", \"color-schemes/*.colors\");\n \n     QMap<QString, QAction*> actionMap;\n     for (int i = 0; i < schemeFiles.size(); ++i)\n@@ -351,7 +351,7 @@ QString ThemeManager::currentKDEdefaultTheme() const\n \n void ThemeManager::populateThemeMap()\n {\n-    const QStringList schemeFiles = KoResourcePaths::findAllResources(\"data\", \"color-schemes/*.colors\", KoResourcePaths::NoDuplicates);\n+    const QStringList schemeFiles = KoResourcePaths::findAllResources(\"data\", \"color-schemes/*.colors\");\n     for (int i = 0; i < schemeFiles.size(); ++i)\n     {\n         const QString filename  = schemeFiles.at(i);"}, {"sha": "cd639547272ca56bece18f83850b902c3e13e0c2", "filename": "libs/ui/widgets/kis_custom_image_widget.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/e413f106622e0a3ea555ce5a24956f099d00754b/libs/ui/widgets/kis_custom_image_widget.cc", "raw_url": "https://github.com/KDE/krita/raw/e413f106622e0a3ea555ce5a24956f099d00754b/libs/ui/widgets/kis_custom_image_widget.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/widgets/kis_custom_image_widget.cc?ref=e413f106622e0a3ea555ce5a24956f099d00754b", "patch": "@@ -327,7 +327,7 @@ void KisCustomImageWidget::fillPredefined()\n \n     cmbPredefined->addItem(\"\");\n \n-    QStringList definitions = KoResourcePaths::findAllResources(\"data\", \"predefined_image_sizes/*.predefinedimage\", KoResourcePaths::Recursive | KoResourcePaths::NoDuplicates);\n+    QStringList definitions = KoResourcePaths::findAllResources(\"data\", \"predefined_image_sizes/*.predefinedimage\", KoResourcePaths::Recursive);\n     definitions.sort();\n \n     if (!definitions.empty()) {"}, {"sha": "80e95ba3332d219855162014795398938b9a6d4a", "filename": "libs/widgets/KoResourceServer.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/e413f106622e0a3ea555ce5a24956f099d00754b/libs/widgets/KoResourceServer.h", "raw_url": "https://github.com/KDE/krita/raw/e413f106622e0a3ea555ce5a24956f099d00754b/libs/widgets/KoResourceServer.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgets/KoResourceServer.h?ref=e413f106622e0a3ea555ce5a24956f099d00754b", "patch": "@@ -82,7 +82,7 @@ class KRITAWIDGETS_EXPORT KoResourceServerBase {\n         QStringList fileNames;\n \n         foreach (const QString &extension, extensionList) {\n-            fileNames += KoResourcePaths::findAllResources(type().toLatin1(), extension, KoResourcePaths::Recursive | KoResourcePaths::NoDuplicates);\n+            fileNames += KoResourcePaths::findAllResources(type().toLatin1(), extension, KoResourcePaths::Recursive);\n \n         }\n         return fileNames;"}, {"sha": "606bff8ac3ef58b442f9d36bc1c8d53edcf956fa", "filename": "libs/widgetutils/KoResourcePaths.cpp", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/KDE/krita/blob/e413f106622e0a3ea555ce5a24956f099d00754b/libs/widgetutils/KoResourcePaths.cpp", "raw_url": "https://github.com/KDE/krita/raw/e413f106622e0a3ea555ce5a24956f099d00754b/libs/widgetutils/KoResourcePaths.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/KoResourcePaths.cpp?ref=e413f106622e0a3ea555ce5a24956f099d00754b", "patch": "@@ -396,10 +396,9 @@ QStringList KoResourcePaths::findAllResourcesInternal(const QString &type,\n     debugWidgetUtils << \"=====================================================\";\n     debugWidgetUtils << type << _filter << QStandardPaths::standardLocations(d->mapTypeToQStandardPaths(type));\n \n-    bool noDuplicates = options & KoResourcePaths::NoDuplicates;\n     bool recursive = options & KoResourcePaths::Recursive;\n \n-    debugWidgetUtils << \"findAllResources: type\" << type << \"filter\" << _filter << \"no dups\" << noDuplicates << \"recursive\" << recursive;\n+    debugWidgetUtils << \"findAllResources: type\" << type << \"filter\" << _filter << \"recursive\" << recursive;\n \n     QStringList aliases = d->aliases(type);\n     QString filter = _filter;\n@@ -416,7 +415,7 @@ QStringList KoResourcePaths::findAllResourcesInternal(const QString &type,\n         QStringList standardResources =\n             QStandardPaths::locateAll(d->mapTypeToQStandardPaths(type),\n                                       filter, QStandardPaths::LocateFile);\n-        appendResources(&resources, standardResources, noDuplicates);\n+        appendResources(&resources, standardResources, true);\n     }\n \n     debugWidgetUtils << \"\\tresources from qstandardpaths:\" << resources.size();\n@@ -432,7 +431,7 @@ QStringList KoResourcePaths::findAllResourcesInternal(const QString &type,\n         Q_FOREACH (const QString &dir, dirs) {\n             appendResources(&resources,\n                             filesInDir(dir, filter, recursive),\n-                            noDuplicates);\n+                            true);\n         }\n     }\n \n@@ -444,7 +443,7 @@ QStringList KoResourcePaths::findAllResourcesInternal(const QString &type,\n         QStringList prefixResources;\n         prefixResources << filesInDir(getInstallationPrefix() + \"share/\" + fi.path(), fi.fileName(), false);\n         prefixResources << filesInDir(getInstallationPrefix() + \"share/krita/\" + fi.path(), fi.fileName(), false);\n-        appendResources(&resources, prefixResources, noDuplicates);\n+        appendResources(&resources, prefixResources, true);\n     }\n \n     debugWidgetUtils << \"\\tresources from installation:\" << resources.size();"}, {"sha": "28a971acb22e244a43c0a6c23706d7614481b2a0", "filename": "libs/widgetutils/KoResourcePaths.h", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/e413f106622e0a3ea555ce5a24956f099d00754b/libs/widgetutils/KoResourcePaths.h", "raw_url": "https://github.com/KDE/krita/raw/e413f106622e0a3ea555ce5a24956f099d00754b/libs/widgetutils/KoResourcePaths.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/KoResourcePaths.h?ref=e413f106622e0a3ea555ce5a24956f099d00754b", "patch": "@@ -49,7 +49,6 @@ class KRITAWIDGETUTILS_EXPORT KoResourcePaths\n \n     enum SearchOption { NoSearchOptions = 0,\n                         Recursive = 1,\n-                        NoDuplicates = 2,\n                         IgnoreExecBit = 4\n                       };\n     Q_DECLARE_FLAGS(SearchOptions, SearchOption)\n@@ -155,8 +154,7 @@ class KRITAWIDGETUTILS_EXPORT KoResourcePaths\n      *        wildcard expression. E.g. <tt>\"images\\*.jpg\"</tt>.\n      *        Use QString() if you do not want a filter.\n      * @param options if the flags passed include Recursive, subdirectories\n-     *        will also be search; if NoDuplicates is passed then only entries with\n-     *        unique filenames will be returned eliminating duplicates.\n+     *        will also be search.\n      *\n      * @return List of all the files whose filename matches the\n      *         specified filter."}, {"sha": "9e0186fabacb8964711dc027d51f1240053935b7", "filename": "libs/widgetutils/kis_action_registry.cpp", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/e413f106622e0a3ea555ce5a24956f099d00754b/libs/widgetutils/kis_action_registry.cpp", "raw_url": "https://github.com/KDE/krita/raw/e413f106622e0a3ea555ce5a24956f099d00754b/libs/widgetutils/kis_action_registry.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/kis_action_registry.cpp?ref=e413f106622e0a3ea555ce5a24956f099d00754b", "patch": "@@ -377,9 +377,8 @@ void KisActionRegistry::writeCustomShortcuts(KConfigBase *config) const\n \n void KisActionRegistry::Private::loadActionFiles()\n {\n-    auto searchType = KoResourcePaths::Recursive | KoResourcePaths::NoDuplicates;\n     QStringList actionDefinitions =\n-        KoResourcePaths::findAllResources(\"kis_actions\", \"*.action\", searchType);\n+        KoResourcePaths::findAllResources(\"kis_actions\", \"*.action\", KoResourcePaths::Recursive);\n \n     // Extract actions all XML .action files.\n     Q_FOREACH (const QString &actionDefinition, actionDefinitions)  {"}, {"sha": "7ac0bbf780ae30fb419ee4c84c36737664273119", "filename": "plugins/color/lcms2engine/LcmsEnginePlugin.cpp", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/e413f106622e0a3ea555ce5a24956f099d00754b/plugins/color/lcms2engine/LcmsEnginePlugin.cpp", "raw_url": "https://github.com/KDE/krita/raw/e413f106622e0a3ea555ce5a24956f099d00754b/plugins/color/lcms2engine/LcmsEnginePlugin.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/color/lcms2engine/LcmsEnginePlugin.cpp?ref=e413f106622e0a3ea555ce5a24956f099d00754b", "patch": "@@ -94,10 +94,10 @@ LcmsEnginePlugin::LcmsEnginePlugin(QObject *parent, const QVariantList &)\n \n \n     QStringList profileFilenames;\n-    profileFilenames += KoResourcePaths::findAllResources(\"icc_profiles\", \"*.icm\",  KoResourcePaths::Recursive | KoResourcePaths::NoDuplicates);\n-    profileFilenames += KoResourcePaths::findAllResources(\"icc_profiles\", \"*.ICM\",  KoResourcePaths::Recursive | KoResourcePaths::NoDuplicates);\n-    profileFilenames += KoResourcePaths::findAllResources(\"icc_profiles\", \"*.ICC\",  KoResourcePaths::Recursive | KoResourcePaths::NoDuplicates);\n-    profileFilenames += KoResourcePaths::findAllResources(\"icc_profiles\", \"*.icc\",  KoResourcePaths::Recursive | KoResourcePaths::NoDuplicates);\n+    profileFilenames += KoResourcePaths::findAllResources(\"icc_profiles\", \"*.icm\",  KoResourcePaths::Recursive);\n+    profileFilenames += KoResourcePaths::findAllResources(\"icc_profiles\", \"*.ICM\",  KoResourcePaths::Recursive);\n+    profileFilenames += KoResourcePaths::findAllResources(\"icc_profiles\", \"*.ICC\",  KoResourcePaths::Recursive);\n+    profileFilenames += KoResourcePaths::findAllResources(\"icc_profiles\", \"*.icc\",  KoResourcePaths::Recursive);\n \n     // Load the profiles\n     if (!profileFilenames.empty()) {"}]}, {"sha": "d07168fcd08e9e2d048c396c7bf29be4cf96f021", "stats": {"total": 103, "additions": 66, "deletions": 37}, "files": [{"sha": "c9fd0817f518bd0a72f1453e265b9cd21c291b8b", "filename": "libs/widgetutils/KoResourcePaths.cpp", "status": "modified", "additions": 66, "deletions": 37, "changes": 103, "blob_url": "https://github.com/KDE/krita/blob/d07168fcd08e9e2d048c396c7bf29be4cf96f021/libs/widgetutils/KoResourcePaths.cpp", "raw_url": "https://github.com/KDE/krita/raw/d07168fcd08e9e2d048c396c7bf29be4cf96f021/libs/widgetutils/KoResourcePaths.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/KoResourcePaths.cpp?ref=d07168fcd08e9e2d048c396c7bf29be4cf96f021", "patch": "@@ -25,9 +25,9 @@\n #include <QDir>\n #include <QFileInfo>\n #include <QDebug>\n-#include <QSet>\n #include <QApplication>\n #include <QMutex>\n+#include \"kis_debug.h\"\n \n #include \"WidgetUtilsDebug.h\"\n \n@@ -63,6 +63,16 @@ static QStringList cleanupDirs(const QStringList &pathList)\n   return cleanedPathList;\n }\n \n+void appendResources(QStringList *dst, const QStringList &src, bool eliminateDuplicates)\n+{\n+    Q_FOREACH (const QString &resource, src) {\n+        QString realPath = QDir::cleanPath(resource);\n+        if (!eliminateDuplicates || !dst->contains(realPath)) {\n+            *dst << realPath;\n+        }\n+    }\n+}\n+\n \n #ifdef Q_OS_WIN\n static const Qt::CaseSensitivity cs = Qt::CaseInsensitive;\n@@ -319,31 +329,43 @@ QStringList KoResourcePaths::findDirsInternal(const QString &type, const QString\n \n     QStringList dirs;\n \n-#ifdef Q_OS_MAC\n-    QString bundlePath = getApplicationRoot() + \"/share/\" + relDir;\n-    dirs << bundlePath;\n-    bundlePath = getApplicationRoot() + \"/../share/\" + relDir;\n-    dirs << bundlePath;\n-#endif\n-\n-    dirs << QStandardPaths::locateAll(d->mapTypeToQStandardPaths(type), relDir, QStandardPaths::LocateDirectory);\n+    {\n+        QStringList standardDirs =\n+            QStandardPaths::locateAll(d->mapTypeToQStandardPaths(type), relDir, QStandardPaths::LocateDirectory);\n+        appendResources(&dirs, standardDirs, true);\n+    }\n \n     Q_FOREACH (const QString &alias, aliases) {\n-        dirs << QStandardPaths::locateAll(d->mapTypeToQStandardPaths(type), alias + '/' + relDir, QStandardPaths::LocateDirectory);\n+        QStringList aliasDirs =\n+            QStandardPaths::locateAll(d->mapTypeToQStandardPaths(type), alias + '/' + relDir, QStandardPaths::LocateDirectory);\n+        appendResources(&dirs, aliasDirs, true);\n+    }\n+\n+#ifdef Q_OS_MAC\n+\n+    {\n+        QStringList bundlePaths;\n+        bundlePaths << getApplicationRoot() + \"/share/\" + relDir;\n+        bundlePaths << getApplicationRoot() + \"/../share/\" + relDir;\n+        appendResources(&dirs, bundlePaths, true);\n     }\n+#endif\n \n     if (dirs.isEmpty()) {\n-        dirs.append(getApplicationRoot() + \"/share/\" + relDir);\n-        dirs.append(getApplicationRoot() + \"/share/krita/\" + relDir);\n+        QStringList fallbackPaths;\n+        fallbackPaths << getApplicationRoot() + \"/share/\" + relDir;\n+        fallbackPaths << getApplicationRoot() + \"/share/krita/\" + relDir;\n+        appendResources(&dirs, fallbackPaths, true);\n     }\n+\n     debugWidgetUtils << \"findDirs: type\" << type << \"relDir\" << relDir<< \"resource\" << dirs;\n     return dirs;\n }\n \n \n-QStringList filesInDir(const QString &startdir, const QString & filter, bool noduplicates, bool recursive)\n+QStringList filesInDir(const QString &startdir, const QString & filter, bool recursive)\n {\n-    debugWidgetUtils << \"filesInDir: startdir\" << startdir << \"filter\" << filter << \"noduplicates\" << noduplicates << \"recursive\" << recursive;\n+    debugWidgetUtils << \"filesInDir: startdir\" << startdir << \"filter\" << filter << \"recursive\" << recursive;\n     QStringList result;\n \n     // First the entries in this path\n@@ -361,7 +383,7 @@ QStringList filesInDir(const QString &startdir, const QString & filter, bool nod\n         const QStringList entries = QDir(startdir).entryList(QDir::Dirs | QDir::NoDotAndDotDot);\n         Q_FOREACH (const QString &subdir, entries) {\n             debugWidgetUtils << \"\\tGoing to look in subdir\" << subdir << \"of\" << startdir;\n-            result << filesInDir(startdir + '/' + subdir, filter, noduplicates, recursive);\n+            result << filesInDir(startdir + '/' + subdir, filter, recursive);\n         }\n     }\n     return result;\n@@ -373,6 +395,7 @@ QStringList KoResourcePaths::findAllResourcesInternal(const QString &type,\n {\n     debugWidgetUtils << \"=====================================================\";\n     debugWidgetUtils << type << _filter << QStandardPaths::standardLocations(d->mapTypeToQStandardPaths(type));\n+\n     bool noDuplicates = options & KoResourcePaths::NoDuplicates;\n     bool recursive = options & KoResourcePaths::Recursive;\n \n@@ -390,39 +413,41 @@ QStringList KoResourcePaths::findAllResourcesInternal(const QString &type,\n \n     QStringList resources;\n     if (aliases.isEmpty()) {\n-        resources << QStandardPaths::locateAll(d->mapTypeToQStandardPaths(type), filter, QStandardPaths::LocateFile);\n+        QStringList standardResources =\n+            QStandardPaths::locateAll(d->mapTypeToQStandardPaths(type),\n+                                      filter, QStandardPaths::LocateFile);\n+        appendResources(&resources, standardResources, noDuplicates);\n     }\n \n     debugWidgetUtils << \"\\tresources from qstandardpaths:\" << resources.size();\n \n     Q_FOREACH (const QString &alias, aliases) {\n         debugWidgetUtils << \"\\t\\talias:\" << alias;\n-        const QStringList dirs = QStringList() << getInstallationPrefix() + \"share/\" + alias + \"/\"\n-                                               << getInstallationPrefix() + \"share/krita/\" + alias + \"/\"\n-                                               << QStandardPaths::locateAll(d->mapTypeToQStandardPaths(type), alias, QStandardPaths::LocateDirectory);\n-        QSet<QString> s = QSet<QString>::fromList(dirs);\n-\n-        debugWidgetUtils << \"\\t\\tdirs:\" << dirs;\n-        Q_FOREACH (const QString &dir, s) {\n-            resources << filesInDir(dir, filter, noDuplicates, recursive);\n+        QStringList dirs;\n+\n+        dirs << QStandardPaths::locateAll(d->mapTypeToQStandardPaths(type), alias, QStandardPaths::LocateDirectory)\n+             << getInstallationPrefix() + \"share/\" + alias + \"/\"\n+             << getInstallationPrefix() + \"share/krita/\" + alias + \"/\";\n+\n+        Q_FOREACH (const QString &dir, dirs) {\n+            appendResources(&resources,\n+                            filesInDir(dir, filter, recursive),\n+                            noDuplicates);\n         }\n     }\n \n     debugWidgetUtils << \"\\tresources also from aliases:\" << resources.size();\n \n     if (resources.isEmpty()) {\n         QFileInfo fi(filter);\n-        resources << filesInDir(getInstallationPrefix() + \"share/\" + fi.path(), fi.fileName(), noDuplicates, false);\n-        resources << filesInDir(getInstallationPrefix() + \"share/krita/\" + fi.path(), fi.fileName(), noDuplicates, false);\n-    }\n-\n-    debugWidgetUtils << \"\\tresources from installation:\" << resources.size();\n \n-    if (noDuplicates) {\n-        QSet<QString> s = QSet<QString>::fromList(resources);\n-        resources = s.toList();\n+        QStringList prefixResources;\n+        prefixResources << filesInDir(getInstallationPrefix() + \"share/\" + fi.path(), fi.fileName(), false);\n+        prefixResources << filesInDir(getInstallationPrefix() + \"share/krita/\" + fi.path(), fi.fileName(), false);\n+        appendResources(&resources, prefixResources, noDuplicates);\n     }\n \n+    debugWidgetUtils << \"\\tresources from installation:\" << resources.size();\n     debugWidgetUtils << \"=====================================================\";\n \n     return resources;\n@@ -434,12 +459,16 @@ QStringList KoResourcePaths::resourceDirsInternal(const QString &type)\n     QStringList aliases = d->aliases(type);\n \n     Q_FOREACH (const QString &alias, aliases) {\n-        resourceDirs << getInstallationPrefix() + \"share/\" + alias + \"/\"\n-                                               << QStandardPaths::locateAll(d->mapTypeToQStandardPaths(type), alias, QStandardPaths::LocateDirectory);\n-        resourceDirs << getInstallationPrefix() + \"share/krita/\" + alias + \"/\"\n-                                               << QStandardPaths::locateAll(d->mapTypeToQStandardPaths(type), alias, QStandardPaths::LocateDirectory);\n+        QStringList aliasDirs;\n+\n+        aliasDirs << QStandardPaths::locateAll(d->mapTypeToQStandardPaths(type), alias, QStandardPaths::LocateDirectory);\n+\n+        aliasDirs << getInstallationPrefix() + \"share/\" + alias + \"/\"\n+                  << QStandardPaths::locateAll(d->mapTypeToQStandardPaths(type), alias, QStandardPaths::LocateDirectory);\n+        aliasDirs << getInstallationPrefix() + \"share/krita/\" + alias + \"/\"\n+                  << QStandardPaths::locateAll(d->mapTypeToQStandardPaths(type), alias, QStandardPaths::LocateDirectory);\n \n-        resourceDirs << QStandardPaths::locateAll(d->mapTypeToQStandardPaths(type), alias, QStandardPaths::LocateDirectory);\n+        appendResources(&resourceDirs, aliasDirs, true);\n     }\n \n     debugWidgetUtils << \"resourceDirs: type\" << type << resourceDirs;"}]}, {"sha": "0974f204dfecdcd4e66b15f090c34492e1543f4d", "stats": {"total": 14, "additions": 11, "deletions": 3}, "files": [{"sha": "f9f8d785d927d4c5498186dd48f0c74b7b32f0ed", "filename": "plugins/dockers/animation/kis_animation_utils.cpp", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/0974f204dfecdcd4e66b15f090c34492e1543f4d/plugins/dockers/animation/kis_animation_utils.cpp", "raw_url": "https://github.com/KDE/krita/raw/0974f204dfecdcd4e66b15f090c34492e1543f4d/plugins/dockers/animation/kis_animation_utils.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/animation/kis_animation_utils.cpp?ref=0974f204dfecdcd4e66b15f090c34492e1543f4d", "patch": "@@ -39,6 +39,10 @@ namespace KisAnimationUtils {\n     const QString dropFramesActionName = i18n(\"Drop Frames\");\n     const QString showLayerActionName = i18n(\"Show in Timeline\");\n \n+    const QString newLayerActionName = i18n(\"New Layer\");\n+    const QString addExistingLayerActionName = i18n(\"Add Existing Layer\");\n+    const QString removeLayerActionName = i18n(\"Remove Layer\");\n+\n \n     bool createKeyframeLazy(KisImageSP image, KisNodeSP node, int time, bool copy) {\n         KisKeyframeChannel *content ="}, {"sha": "bda389f28cd7f62aaa270ca43905de0d9cffe7f1", "filename": "plugins/dockers/animation/kis_animation_utils.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/0974f204dfecdcd4e66b15f090c34492e1543f4d/plugins/dockers/animation/kis_animation_utils.h", "raw_url": "https://github.com/KDE/krita/raw/0974f204dfecdcd4e66b15f090c34492e1543f4d/plugins/dockers/animation/kis_animation_utils.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/animation/kis_animation_utils.h?ref=0974f204dfecdcd4e66b15f090c34492e1543f4d", "patch": "@@ -54,6 +54,10 @@ namespace KisAnimationUtils\n     extern const QString lazyFrameCreationActionName;\n     extern const QString dropFramesActionName;\n     extern const QString showLayerActionName;\n+\n+    extern const QString newLayerActionName;\n+    extern const QString addExistingLayerActionName;\n+    extern const QString removeLayerActionName;\n };\n \n #endif /* __KIS_ANIMATION_UTILS_H */"}, {"sha": "0ce0e136df78528a0f7bcae482b87fc4eeda2de5", "filename": "plugins/dockers/animation/timeline_frames_view.cpp", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/0974f204dfecdcd4e66b15f090c34492e1543f4d/plugins/dockers/animation/timeline_frames_view.cpp", "raw_url": "https://github.com/KDE/krita/raw/0974f204dfecdcd4e66b15f090c34492e1543f4d/plugins/dockers/animation/timeline_frames_view.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/animation/timeline_frames_view.cpp?ref=0974f204dfecdcd4e66b15f090c34492e1543f4d", "patch": "@@ -155,8 +155,8 @@ TimelineFramesView::TimelineFramesView(QWidget *parent)\n     m_d->addLayersButton->setPopupMode(QToolButton::InstantPopup);\n \n     m_d->layerEditingMenu = new QMenu(this);\n-    m_d->layerEditingMenu->addAction(\"New Layer\", this, SLOT(slotAddNewLayer()));\n-    m_d->existingLayersMenu = m_d->layerEditingMenu->addMenu(\"Add Existing Layer\");\n+    m_d->layerEditingMenu->addAction(KisAnimationUtils::newLayerActionName, this, SLOT(slotAddNewLayer()));\n+    m_d->existingLayersMenu = m_d->layerEditingMenu->addMenu(KisAnimationUtils::addExistingLayerActionName);\n     m_d->layerEditingMenu->addSeparator();\n \n     m_d->showHideLayerAction = new KisAction(KisAnimationUtils::showLayerActionName, this);\n@@ -166,7 +166,7 @@ TimelineFramesView::TimelineFramesView(QWidget *parent)\n     m_d->globalActions.insert(\"show_in_timeline\", m_d->showHideLayerAction);\n     m_d->layerEditingMenu->addAction(m_d->showHideLayerAction);\n \n-    m_d->layerEditingMenu->addAction(\"Remove Layer\", this, SLOT(slotRemoveLayer()));\n+    m_d->layerEditingMenu->addAction(KisAnimationUtils::removeLayerActionName, this, SLOT(slotRemoveLayer()));\n \n     connect(m_d->existingLayersMenu, SIGNAL(aboutToShow()), SLOT(slotUpdateLayersMenu()));\n     connect(m_d->existingLayersMenu, SIGNAL(triggered(QAction*)), SLOT(slotAddExistingLayer(QAction*)));"}]}, {"sha": "a1e6bb022bd0803a9e616dc77a62e83017104374", "stats": {"total": 227, "additions": 119, "deletions": 108}, "files": [{"sha": "bfaabcda9ab4db5cd05e5f396d3e2ca7fbe0ac84", "filename": "libs/global/kis_global.h", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/KDE/krita/blob/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/global/kis_global.h", "raw_url": "https://github.com/KDE/krita/raw/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/global/kis_global.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/global/kis_global.h?ref=a1e6bb022bd0803a9e616dc77a62e83017104374", "patch": "@@ -232,5 +232,14 @@ inline QSharedPointer<T> toQShared(T* ptr) {\n     return QSharedPointer<T>(ptr);\n }\n \n+template <class A, template <class C> class List>\n+List<QSharedPointer<A>> listToQShared(const List<A*> list) {\n+    List<QSharedPointer<A>> newList;\n+    Q_FOREACH(A* value, list) {\n+        newList.append(toQShared(value));\n+    }\n+    return newList;\n+}\n+\n #endif // KISGLOBAL_H_\n "}, {"sha": "243fc63e3d6d37b554da38b43262f22fd08ac9da", "filename": "libs/image/kis_types.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/image/kis_types.h", "raw_url": "https://github.com/KDE/krita/raw/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/image/kis_types.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_types.h?ref=a1e6bb022bd0803a9e616dc77a62e83017104374", "patch": "@@ -164,6 +164,10 @@ class KisAnimationFrameCache;\n typedef KisSharedPtr<KisAnimationFrameCache> KisAnimationFrameCacheSP;\n typedef KisWeakSharedPtr<KisAnimationFrameCache> KisAnimationFrameCacheWSP;\n \n+class KisPaintingAssistant;\n+typedef QSharedPointer<KisPaintingAssistant> KisPaintingAssistantSP;\n+typedef QWeakPointer<KisPaintingAssistant> KisPaintingAssistantWSP;\n+\n // Repeat iterators\n class KisHLineIterator2;\n template<class T> class KisRepeatHLineIteratorPixelBase;"}, {"sha": "a9429115cd1e67792c120fe947b24484600c56b5", "filename": "libs/ui/KisDocument.cpp", "status": "modified", "additions": 5, "deletions": 12, "changes": 17, "blob_url": "https://github.com/KDE/krita/blob/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/ui/KisDocument.cpp", "raw_url": "https://github.com/KDE/krita/raw/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/ui/KisDocument.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisDocument.cpp?ref=a1e6bb022bd0803a9e616dc77a62e83017104374", "patch": "@@ -407,7 +407,7 @@ class Q_DECL_HIDDEN KisDocument::Private\n     bool suppressProgress;\n     KoProgressProxy* fileProgressProxy;\n \n-    QList<KisPaintingAssistant*> assistants;\n+    QList<KisPaintingAssistantSP> assistants;\n     KisGridConfig gridConfig;\n \n     bool openFile() {\n@@ -2327,21 +2327,14 @@ vKisNodeSP KisDocument::activeNodes() const\n     return nodes;\n }\n \n-QList<KisPaintingAssistant*> KisDocument::assistants()\n+QList<KisPaintingAssistantSP> KisDocument::assistants() const\n {\n-    QList<KisPaintingAssistant*> assistants;\n-    Q_FOREACH (KisView *view, KisPart::instance()->views()) {\n-        if (view && view->document() == this) {\n-            KisPaintingAssistantsDecoration* assistantsDecoration = view->canvasBase()->paintingAssistantsDecoration();\n-            assistants.append(assistantsDecoration->assistants());\n-        }\n-    }\n-    return assistants;\n+    return d->assistants;\n }\n \n-QList<KisPaintingAssistant *> KisDocument::preLoadedAssistants()\n+void KisDocument::setAssistants(const QList<KisPaintingAssistantSP> value)\n {\n-    return d->assistants;\n+    d->assistants = value;\n }\n \n void KisDocument::setPreActivatedNode(KisNodeSP activatedNode)"}, {"sha": "689204ca1a0ed25de7a3a6981e15dcf9c47d2ffd", "filename": "libs/ui/KisDocument.h", "status": "modified", "additions": 2, "deletions": 10, "changes": 12, "blob_url": "https://github.com/KDE/krita/blob/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/ui/KisDocument.h", "raw_url": "https://github.com/KDE/krita/raw/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/ui/KisDocument.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisDocument.h?ref=a1e6bb022bd0803a9e616dc77a62e83017104374", "patch": "@@ -803,16 +803,8 @@ private Q_SLOTS:\n      */\n     KisNodeSP preActivatedNode() const;\n \n-    /**\n-      *@return a list of all the assistants in all current views\n-      */\n-    QList<KisPaintingAssistant *> assistants();\n-\n-    /**\n-     * @return a list of assistants loaded from a document\n-     */\n-    QList<KisPaintingAssistant *> preLoadedAssistants();\n-\n+    QList<KisPaintingAssistantSP> assistants() const;\n+    void setAssistants(const QList<KisPaintingAssistantSP> value);\n \n private:\n "}, {"sha": "005e4616c112b5332faed61f0aa8894938182fa3", "filename": "libs/ui/KisView.cpp", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/ui/KisView.cpp", "raw_url": "https://github.com/KDE/krita/raw/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/ui/KisView.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisView.cpp?ref=a1e6bb022bd0803a9e616dc77a62e83017104374", "patch": "@@ -249,6 +249,7 @@ KisView::KisView(KisDocument *document, KoCanvasResourceManager *resourceManager\n     connect(d->document, SIGNAL(sigSavingFinished()), this, SLOT(slotSavingFinished()));\n \n     d->canvas.addDecoration(&d->paintingAssistantsDecoration);\n+    d->paintingAssistantsDecoration.setVisible(true);\n \n     d->showFloatingMessage = cfg.showCanvasMessages();\n }\n@@ -964,11 +965,6 @@ void KisView::slotLoadingFinished()\n         image()->unlock();\n     }\n \n-    Q_FOREACH (KisPaintingAssistant* assist, document()->preLoadedAssistants()) {\n-        d->paintingAssistantsDecoration.addAssistant(assist);\n-    }\n-    d->paintingAssistantsDecoration.setVisible(true);\n-\n     canvasBase()->initializeImage();\n \n     /**"}, {"sha": "418f2ded3ebbb26e061a5a1c4e07e4d9f1074164", "filename": "libs/ui/kis_painting_assistants_decoration.cpp", "status": "modified", "additions": 47, "deletions": 31, "changes": 78, "blob_url": "https://github.com/KDE/krita/blob/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/ui/kis_painting_assistants_decoration.cpp", "raw_url": "https://github.com/KDE/krita/raw/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/ui/kis_painting_assistants_decoration.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kis_painting_assistants_decoration.cpp?ref=a1e6bb022bd0803a9e616dc77a62e83017104374", "patch": "@@ -26,6 +26,7 @@\n #include <kactioncollection.h>\n #include <ktoggleaction.h>\n #include \"kis_debug.h\"\n+#include \"KisDocument.h\"\n \n #include <QPainter>\n \n@@ -36,12 +37,10 @@ struct KisPaintingAssistantsDecoration::Private {\n                 firstAssistant(0),\n                 aFirstStroke(false){}\n \n-\n-    QList<KisPaintingAssistant*> assistants;\n     bool assistantVisible;\n     bool outlineVisible;\n     bool snapOnlyOneAssistant;\n-    KisPaintingAssistant* firstAssistant;\n+    KisPaintingAssistantSP firstAssistant;\n     bool aFirstStroke;\n };\n \n@@ -56,39 +55,48 @@ KisPaintingAssistantsDecoration::KisPaintingAssistantsDecoration(QPointer<KisVie\n \n KisPaintingAssistantsDecoration::~KisPaintingAssistantsDecoration()\n {\n-    qDeleteAll(d->assistants.begin(), d->assistants.end());\n     delete d;\n }\n \n-void KisPaintingAssistantsDecoration::addAssistant(KisPaintingAssistant* assistant)\n+void KisPaintingAssistantsDecoration::addAssistant(KisPaintingAssistantSP assistant)\n {\n-    if (d->assistants.contains(assistant)) return;\n-    d->assistants.push_back(assistant);\n+    QList<KisPaintingAssistantSP> assistants = view()->document()->assistants();\n+    if (assistants.contains(assistant)) return;\n+\n+    assistants.append(assistant);\n+\n+    view()->document()->setAssistants(assistants);\n     emit assistantChanged();\n }\n \n-void KisPaintingAssistantsDecoration::removeAssistant(KisPaintingAssistant* assistant)\n+void KisPaintingAssistantsDecoration::removeAssistant(KisPaintingAssistantSP assistant)\n {\n-    delete assistant;\n-    d->assistants.removeAll(assistant);\n-    emit assistantChanged();\n+    QList<KisPaintingAssistantSP> assistants = view()->document()->assistants();\n+    KIS_ASSERT_RECOVER_NOOP(assistants.contains(assistant));\n+\n+    if (assistants.removeAll(assistant)) {\n+        view()->document()->setAssistants(assistants);\n+        emit assistantChanged();\n+    }\n }\n \n void KisPaintingAssistantsDecoration::removeAll()\n {\n-    Q_FOREACH (KisPaintingAssistant* assistant, d->assistants) {\n-        delete assistant;\n-    }\n-    d->assistants.clear();\n+    QList<KisPaintingAssistantSP> assistants = view()->document()->assistants();\n+    assistants.clear();\n+    view()->document()->setAssistants(assistants);\n+\n     emit assistantChanged();\n }\n \n QPointF KisPaintingAssistantsDecoration::adjustPosition(const QPointF& point, const QPointF& strokeBegin)\n {\n-    if (d->assistants.empty()) return point;\n-    if (d->assistants.count() == 1) {\n-        if(d->assistants.first()->snapping()==true){\n-        QPointF newpoint = d->assistants.first()->adjustPosition(point, strokeBegin);\n+    QList<KisPaintingAssistantSP> assistants = view()->document()->assistants();\n+\n+    if (assistants.empty()) return point;\n+    if (assistants.count() == 1) {\n+        if(assistants.first()->snapping()==true){\n+        QPointF newpoint = assistants.first()->adjustPosition(point, strokeBegin);\n         // check for NaN\n         if (newpoint.x() != newpoint.x()) return point;\n         return newpoint;\n@@ -98,7 +106,7 @@ QPointF KisPaintingAssistantsDecoration::adjustPosition(const QPointF& point, co\n     double distance = DBL_MAX;\n     //the following tries to find the closest point to stroke-begin. It checks all assistants for the closest point//\n     if(!d->snapOnlyOneAssistant){\n-        Q_FOREACH (KisPaintingAssistant* assistant, d->assistants) {\n+        Q_FOREACH (KisPaintingAssistantSP assistant, assistants) {\n             if(assistant->snapping()==true){//this checks if the assistant in question has it's snapping boolean turned on//\n                 QPointF pt = assistant->adjustPosition(point, strokeBegin);\n                 if (pt.x() != pt.x()) continue;\n@@ -110,7 +118,7 @@ QPointF KisPaintingAssistantsDecoration::adjustPosition(const QPointF& point, co\n             }\n         }\n     } else if (d->aFirstStroke==false) {\n-        Q_FOREACH (KisPaintingAssistant* assistant, d->assistants) {\n+        Q_FOREACH (KisPaintingAssistantSP assistant, assistants) {\n             if(assistant->snapping()==true){//this checks if the assistant in question has it's snapping boolean turned on//\n                 QPointF pt = assistant->adjustPosition(point, strokeBegin);\n                 if (pt.x() != pt.x()) continue;\n@@ -139,29 +147,34 @@ QPointF KisPaintingAssistantsDecoration::adjustPosition(const QPointF& point, co\n \n void KisPaintingAssistantsDecoration::endStroke()\n {\n+    QList<KisPaintingAssistantSP> assistants = view()->document()->assistants();\n+\n     d->aFirstStroke=false;\n-    Q_FOREACH (KisPaintingAssistant* assistant, d->assistants) {\n+    Q_FOREACH (KisPaintingAssistantSP assistant, assistants) {\n         assistant->endStroke();\n     }\n }\n \n void KisPaintingAssistantsDecoration::drawDecoration(QPainter& gc, const QRectF& updateRect, const KisCoordinatesConverter *converter,KisCanvas2* canvas)\n-{   \n+{\n     if (!canvas) {\n         dbgFile<<\"canvas does not exist in painting assistant decoration, you may have passed arguments incorrectly:\"<<canvas;\n-    }    \n-    \n-    Q_FOREACH (KisPaintingAssistant* assistant, d->assistants) {\n+    }\n+\n+    QList<KisPaintingAssistantSP> assistants = view()->document()->assistants();\n+\n+    Q_FOREACH (KisPaintingAssistantSP assistant, assistants) {\n             assistant->drawAssistant(gc, updateRect, converter, true, canvas, assistantVisibility(), outlineVisibility());\n     }\n-    \n }\n //drawPreview//\n \n QList<KisPaintingAssistantHandleSP> KisPaintingAssistantsDecoration::handles()\n {\n+    QList<KisPaintingAssistantSP> assistants = view()->document()->assistants();\n+\n     QList<KisPaintingAssistantHandleSP> hs;\n-    Q_FOREACH (KisPaintingAssistant* assistant, d->assistants) {\n+    Q_FOREACH (KisPaintingAssistantSP assistant, assistants) {\n         Q_FOREACH (const KisPaintingAssistantHandleSP handle, assistant->handles()) {\n             if (!hs.contains(handle)) {\n                 hs.push_back(handle);\n@@ -176,9 +189,10 @@ QList<KisPaintingAssistantHandleSP> KisPaintingAssistantsDecoration::handles()\n     return hs;\n }\n \n-QList<KisPaintingAssistant*> KisPaintingAssistantsDecoration::assistants()\n+QList<KisPaintingAssistantSP> KisPaintingAssistantsDecoration::assistants()\n {\n-    return d->assistants;\n+    QList<KisPaintingAssistantSP> assistants = view()->document()->assistants();\n+    return assistants;\n }\n \n void KisPaintingAssistantsDecoration::setAssistantVisible(bool set)\n@@ -206,7 +220,9 @@ bool KisPaintingAssistantsDecoration::outlineVisibility()\n }\n void KisPaintingAssistantsDecoration::uncache()\n {\n-     Q_FOREACH (KisPaintingAssistant* assistant, d->assistants) {\n+    QList<KisPaintingAssistantSP> assistants = view()->document()->assistants();\n+\n+    Q_FOREACH (KisPaintingAssistantSP assistant, assistants) {\n             assistant->uncache();\n     }\n }"}, {"sha": "58d10e54b3fbc29fbc050340b27b322c6cc4d1a4", "filename": "libs/ui/kis_painting_assistants_decoration.h", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/ui/kis_painting_assistants_decoration.h", "raw_url": "https://github.com/KDE/krita/raw/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/ui/kis_painting_assistants_decoration.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kis_painting_assistants_decoration.h?ref=a1e6bb022bd0803a9e616dc77a62e83017104374", "patch": "@@ -37,13 +37,13 @@ class KRITAUI_EXPORT KisPaintingAssistantsDecoration : public KisCanvasDecoratio\n public:\n     KisPaintingAssistantsDecoration(QPointer<KisView> parent);\n     ~KisPaintingAssistantsDecoration();\n-    void addAssistant(KisPaintingAssistant* assistant);\n-    void removeAssistant(KisPaintingAssistant* assistant);\n+    void addAssistant(KisPaintingAssistantSP assistant);\n+    void removeAssistant(KisPaintingAssistantSP assistant);\n     void removeAll();\n     QPointF adjustPosition(const QPointF& point, const QPointF& strokeBegin);\n     void endStroke();\n     QList<KisPaintingAssistantHandleSP> handles();\n-    QList<KisPaintingAssistant*> assistants();\n+    QList<KisPaintingAssistantSP> assistants();\n     /*sets whether the main assistant is visible*/\n     void setAssistantVisible(bool set);\n     /*sets whether the preview is visible*/"}, {"sha": "2b181b7fedba766fa63d29efec529c4822302890", "filename": "libs/ui/kra/kis_kra_loader.cpp", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/ui/kra/kis_kra_loader.cpp", "raw_url": "https://github.com/KDE/krita/raw/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/ui/kra/kis_kra_loader.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kra/kis_kra_loader.cpp?ref=a1e6bb022bd0803a9e616dc77a62e83017104374", "patch": "@@ -124,7 +124,7 @@ struct KisKraLoader::Private\n     int syntaxVersion; // version of the fileformat we are loading\n     vKisNodeSP selectedNodes; // the nodes that were active when saving the document.\n     QMap<QString, QString> assistantsFilenames;\n-    QList<KisPaintingAssistant*> assistants;\n+    QList<KisPaintingAssistantSP> assistants;\n     QMap<KisNode*, QString> keyframeFilenames;\n     QStringList errorMessages;\n };\n@@ -467,7 +467,7 @@ vKisNodeSP KisKraLoader::selectedNodes() const\n     return m_d->selectedNodes;\n }\n \n-QList<KisPaintingAssistant *> KisKraLoader::assistants() const\n+QList<KisPaintingAssistantSP> KisKraLoader::assistants() const\n {\n     return m_d->assistants;\n }\n@@ -494,7 +494,7 @@ void KisKraLoader::loadAssistants(KoStore *store, const QString &uri, bool exter\n             assistant->loadXml(store, handleMap, file_path);\n             //If an assistant has too few handles than it should according to it's own setup, just don't load it//\n             if (assistant->handles().size()==assistant->numHandles()){\n-                m_d->assistants.append(assistant);\n+                m_d->assistants.append(toQShared(assistant));\n             }\n         }\n         loadedAssistant++;"}, {"sha": "053e7393459651ea151396e741e041101e0c81b4", "filename": "libs/ui/kra/kis_kra_loader.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/ui/kra/kis_kra_loader.h", "raw_url": "https://github.com/KDE/krita/raw/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/ui/kra/kis_kra_loader.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kra/kis_kra_loader.h?ref=a1e6bb022bd0803a9e616dc77a62e83017104374", "patch": "@@ -58,7 +58,7 @@ class KRITAUI_EXPORT KisKraLoader\n     vKisNodeSP selectedNodes() const;\n \n     // it's neater to follow the same design as with selectedNodes, so let's have a getter here\n-    QList<KisPaintingAssistant*> assistants() const;\n+    QList<KisPaintingAssistantSP> assistants() const;\n \n     /// if empty, loading didn't fail...\n     QStringList errorMessages() const;"}, {"sha": "f5dfacd05481db07a4352e2c67c62911f776ffe7", "filename": "libs/ui/kra/kis_kra_saver.cpp", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/ui/kra/kis_kra_saver.cpp", "raw_url": "https://github.com/KDE/krita/raw/a1e6bb022bd0803a9e616dc77a62e83017104374/libs/ui/kra/kis_kra_saver.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kra/kis_kra_saver.cpp?ref=a1e6bb022bd0803a9e616dc77a62e83017104374", "patch": "@@ -290,10 +290,10 @@ bool KisKraSaver::saveAssistants(KoStore* store, QString uri, bool external)\n     QString location;\n     QMap<QString, int> assistantcounters;\n     QByteArray data;\n-    QList<KisPaintingAssistant*> assistants =  m_d->doc->assistants();\n+    QList<KisPaintingAssistantSP> assistants =  m_d->doc->assistants();\n     QMap<KisPaintingAssistantHandleSP, int> handlemap;\n     if (!assistants.isEmpty()) {\n-        Q_FOREACH (KisPaintingAssistant* assist, assistants){\n+        Q_FOREACH (KisPaintingAssistantSP assist, assistants){\n             if (!assistantcounters.contains(assist->id())){\n                 assistantcounters.insert(assist->id(),0);\n             }\n@@ -314,10 +314,10 @@ bool KisKraSaver::saveAssistants(KoStore* store, QString uri, bool external)\n bool KisKraSaver::saveAssistantsList(QDomDocument& doc, QDomElement& element)\n {\n     int count_ellipse = 0, count_perspective = 0, count_ruler = 0, count_vanishingpoint = 0,count_infiniteruler = 0, count_parallelruler = 0, count_concentricellipse = 0, count_fisheyepoint = 0, count_spline = 0;\n-    QList<KisPaintingAssistant*> assistants =  m_d->doc->assistants();\n+    QList<KisPaintingAssistantSP> assistants =  m_d->doc->assistants();\n     if (!assistants.isEmpty()) {\n         QDomElement assistantsElement = doc.createElement(\"assistants\");\n-        Q_FOREACH (KisPaintingAssistant* assist, assistants){\n+        Q_FOREACH (KisPaintingAssistantSP assist, assistants){\n             if (assist->id() == \"ellipse\"){\n                 assist->saveXmlList(doc, assistantsElement, count_ellipse);\n                 count_ellipse++;"}, {"sha": "297821fa81e2153635f3cd5f38d41b330c2c29b4", "filename": "plugins/assistants/RulerAssistant/kis_ruler_assistant_tool.cc", "status": "modified", "additions": 32, "deletions": 31, "changes": 63, "blob_url": "https://github.com/KDE/krita/blob/a1e6bb022bd0803a9e616dc77a62e83017104374/plugins/assistants/RulerAssistant/kis_ruler_assistant_tool.cc", "raw_url": "https://github.com/KDE/krita/raw/a1e6bb022bd0803a9e616dc77a62e83017104374/plugins/assistants/RulerAssistant/kis_ruler_assistant_tool.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/assistants/RulerAssistant/kis_ruler_assistant_tool.cc?ref=a1e6bb022bd0803a9e616dc77a62e83017104374", "patch": "@@ -45,6 +45,8 @@\n #include <kis_abstract_perspective_grid.h>\n #include <kis_painting_assistants_decoration.h>\n \n+#include \"kis_global.h\"\n+\n #include <math.h>\n \n KisRulerAssistantTool::KisRulerAssistantTool(KoCanvasBase * canvas)\n@@ -91,7 +93,7 @@ bool KisRulerAssistantTool::mouseNear(const QPointF& mousep, const QPointF& poin\n     return handlerect.contains(mousep);\n }\n \n-KisPaintingAssistantHandleSP KisRulerAssistantTool::nodeNearPoint(KisPaintingAssistant* grid, QPointF point)\n+KisPaintingAssistantHandleSP KisRulerAssistantTool::nodeNearPoint(KisPaintingAssistantSP grid, QPointF point)\n {\n     if (mouseNear(point, pixelToView(*grid->topLeft()))) {\n         return grid->topLeft();\n@@ -130,7 +132,7 @@ void KisRulerAssistantTool::beginPrimaryAction(KoPointerEvent *event)\n     double minDist = 81.0;\n \n     QPointF mousePos = m_canvas->viewConverter()->documentToView(snapToGuide(event, QPointF(), false));//m_canvas->viewConverter()->documentToView(event->point);\n-    Q_FOREACH (KisPaintingAssistant* assistant, m_canvas->paintingAssistantsDecoration()->assistants()) {\n+    Q_FOREACH (KisPaintingAssistantSP assistant, m_canvas->paintingAssistantsDecoration()->assistants()) {\n         Q_FOREACH (const KisPaintingAssistantHandleSP handle, m_handles) {\n             double dist = norm2(mousePos - m_canvas->viewConverter()->documentToView(*handle));\n             if (dist < minDist) {\n@@ -175,7 +177,7 @@ void KisRulerAssistantTool::beginPrimaryAction(KoPointerEvent *event)\n                                       (assistant->bottomLeft().data()->y()+assistant->topLeft().data()->y())*0.5);\n                 m_selectedNode1 = new KisPaintingAssistantHandle(assistant->topLeft().data()->x(),assistant->topLeft().data()->y());\n                 m_selectedNode2 = new KisPaintingAssistantHandle(assistant->bottomLeft().data()->x(),assistant->bottomLeft().data()->y());\n-                m_newAssistant = KisPaintingAssistantFactoryRegistry::instance()->get(\"perspective\")->createPaintingAssistant();\n+                m_newAssistant = toQShared(KisPaintingAssistantFactoryRegistry::instance()->get(\"perspective\")->createPaintingAssistant());\n                 m_newAssistant->addHandle(assistant->topLeft());\n                 m_newAssistant->addHandle(m_selectedNode1);\n                 m_newAssistant->addHandle(m_selectedNode2);\n@@ -190,7 +192,7 @@ void KisRulerAssistantTool::beginPrimaryAction(KoPointerEvent *event)\n                 m_internalMode = MODE_DRAGGING_TRANSLATING_TWONODES;\n                 m_selectedNode1 = new KisPaintingAssistantHandle(assistant->topRight().data()->x(),assistant->topRight().data()->y());\n                 m_selectedNode2 = new KisPaintingAssistantHandle(assistant->bottomRight().data()->x(),assistant->bottomRight().data()->y());\n-                m_newAssistant = KisPaintingAssistantFactoryRegistry::instance()->get(\"perspective\")->createPaintingAssistant();\n+                m_newAssistant = toQShared(KisPaintingAssistantFactoryRegistry::instance()->get(\"perspective\")->createPaintingAssistant());\n                 m_newAssistant->addHandle(assistant->topRight());\n                 m_newAssistant->addHandle(m_selectedNode1);\n                 m_newAssistant->addHandle(m_selectedNode2);\n@@ -205,7 +207,7 @@ void KisRulerAssistantTool::beginPrimaryAction(KoPointerEvent *event)\n                 m_internalMode = MODE_DRAGGING_TRANSLATING_TWONODES;\n                 m_selectedNode1 = new KisPaintingAssistantHandle(assistant->topLeft().data()->x(),assistant->topLeft().data()->y());\n                 m_selectedNode2 = new KisPaintingAssistantHandle(assistant->topRight().data()->x(),assistant->topRight().data()->y());\n-                m_newAssistant = KisPaintingAssistantFactoryRegistry::instance()->get(\"perspective\")->createPaintingAssistant();\n+                m_newAssistant = toQShared(KisPaintingAssistantFactoryRegistry::instance()->get(\"perspective\")->createPaintingAssistant());\n                 m_newAssistant->addHandle(m_selectedNode1);\n                 m_newAssistant->addHandle(m_selectedNode2);\n                 m_newAssistant->addHandle(assistant->topRight());\n@@ -220,7 +222,7 @@ void KisRulerAssistantTool::beginPrimaryAction(KoPointerEvent *event)\n                 m_internalMode = MODE_DRAGGING_TRANSLATING_TWONODES;\n                 m_selectedNode1 = new KisPaintingAssistantHandle(assistant->bottomLeft().data()->x(),assistant->bottomLeft().data()->y());\n                 m_selectedNode2 = new KisPaintingAssistantHandle(assistant->bottomRight().data()->x(),assistant->bottomRight().data()->y());\n-                m_newAssistant = KisPaintingAssistantFactoryRegistry::instance()->get(\"perspective\")->createPaintingAssistant();\n+                m_newAssistant = toQShared(KisPaintingAssistantFactoryRegistry::instance()->get(\"perspective\")->createPaintingAssistant());\n                 m_newAssistant->addHandle(assistant->bottomLeft());\n                 m_newAssistant->addHandle(assistant->bottomRight());\n                 m_newAssistant->addHandle(m_selectedNode2);\n@@ -278,8 +280,8 @@ void KisRulerAssistantTool::beginPrimaryAction(KoPointerEvent *event)\n         return;\n     }\n \n-    m_assistantDrag = 0;\n-    Q_FOREACH (KisPaintingAssistant* assistant, m_canvas->paintingAssistantsDecoration()->assistants()) {\n+    m_assistantDrag.clear();\n+    Q_FOREACH (KisPaintingAssistantSP assistant, m_canvas->paintingAssistantsDecoration()->assistants()) {\n \n         // This code contains the click event behavior. The actual display of the icons are done at the bottom\n         // of the paint even. Make sure the rectangles positions are the same between the two.\n@@ -328,7 +330,7 @@ void KisRulerAssistantTool::beginPrimaryAction(KoPointerEvent *event)\n     }\n     if (newAssistantAllowed==true){//don't make a new assistant when I'm just toogling visiblity//\n         QString key = m_options.comboBox->model()->index( m_options.comboBox->currentIndex(), 0 ).data(Qt::UserRole).toString();\n-        m_newAssistant = KisPaintingAssistantFactoryRegistry::instance()->get(key)->createPaintingAssistant();\n+        m_newAssistant = toQShared(KisPaintingAssistantFactoryRegistry::instance()->get(key)->createPaintingAssistant());\n         m_internalMode = MODE_CREATION;\n         m_newAssistant->addHandle(new KisPaintingAssistantHandle(snapToGuide(event, QPointF(), false)));\n         if (m_newAssistant->numHandles() <= 1) {\n@@ -398,8 +400,8 @@ void KisRulerAssistantTool::continuePrimaryAction(KoPointerEvent *event)\n \n     bool wasHiglightedNode = m_higlightedNode != 0;\n     QPointF mousep = m_canvas->viewConverter()->documentToView(event->point);\n-    QList <KisPaintingAssistant*> pAssistant= m_canvas->paintingAssistantsDecoration()->assistants();\n-    Q_FOREACH (KisPaintingAssistant*  assistant, pAssistant) {\n+    QList <KisPaintingAssistantSP> pAssistant= m_canvas->paintingAssistantsDecoration()->assistants();\n+    Q_FOREACH (KisPaintingAssistantSP  assistant, pAssistant) {\n         if(assistant->id() == \"perspective\") {\n             if ((m_higlightedNode = nodeNearPoint(assistant, mousep))) {\n                 if (m_higlightedNode == m_selectedNode1 || m_higlightedNode == m_selectedNode2) {\n@@ -475,7 +477,7 @@ void KisRulerAssistantTool::endPrimaryAction(KoPointerEvent *event)\n         m_handleDrag = m_handleCombine = 0;\n         m_canvas->updateCanvas(); // TODO update only the relevant part of the canvas\n     } else if (m_assistantDrag) {\n-        m_assistantDrag = 0;\n+        m_assistantDrag.clear();\n         m_canvas->updateCanvas(); // TODO update only the relevant part of the canvas\n     } else if(m_internalMode == MODE_DRAGGING_TRANSLATING_TWONODES) {\n         addAssistant();\n@@ -491,40 +493,40 @@ void KisRulerAssistantTool::addAssistant()\n {\n     m_canvas->paintingAssistantsDecoration()->addAssistant(m_newAssistant);\n     m_handles = m_canvas->paintingAssistantsDecoration()->handles();\n-    KisAbstractPerspectiveGrid* grid = dynamic_cast<KisAbstractPerspectiveGrid*>(m_newAssistant);\n+    KisAbstractPerspectiveGrid* grid = dynamic_cast<KisAbstractPerspectiveGrid*>(m_newAssistant.data());\n     if (grid) {\n         m_canvas->viewManager()->resourceProvider()->addPerspectiveGrid(grid);\n     }\n-    m_newAssistant = 0;\n+    m_newAssistant.clear();\n }\n \n \n-void KisRulerAssistantTool::removeAssistant(KisPaintingAssistant* assistant)\n+void KisRulerAssistantTool::removeAssistant(KisPaintingAssistantSP assistant)\n {\n-    KisAbstractPerspectiveGrid* grid = dynamic_cast<KisAbstractPerspectiveGrid*>(assistant);\n+    KisAbstractPerspectiveGrid* grid = dynamic_cast<KisAbstractPerspectiveGrid*>(assistant.data());\n     if (grid) {\n         m_canvas->viewManager()->resourceProvider()->removePerspectiveGrid(grid);\n     }\n     m_canvas->paintingAssistantsDecoration()->removeAssistant(assistant);\n     m_handles = m_canvas->paintingAssistantsDecoration()->handles();\n }\n \n-void KisRulerAssistantTool::snappingOn(KisPaintingAssistant* assistant)\n+void KisRulerAssistantTool::snappingOn(KisPaintingAssistantSP assistant)\n {\n     assistant->setSnapping(true);\n }\n \n-void KisRulerAssistantTool::snappingOff(KisPaintingAssistant* assistant)\n+void KisRulerAssistantTool::snappingOff(KisPaintingAssistantSP assistant)\n {\n     assistant->setSnapping(false);\n }\n \n-void KisRulerAssistantTool::outlineOn(KisPaintingAssistant* assistant)\n+void KisRulerAssistantTool::outlineOn(KisPaintingAssistantSP assistant)\n {\n     assistant->setOutline(true);\n }\n \n-void KisRulerAssistantTool::outlineOff(KisPaintingAssistant* assistant)\n+void KisRulerAssistantTool::outlineOff(KisPaintingAssistantSP assistant)\n {\n     assistant->setOutline(false);\n }\n@@ -605,7 +607,7 @@ void KisRulerAssistantTool::paint(QPainter& _gc, const KoViewConverter &_convert\n     // TODO: too  many Q_FOREACH loops going through all assistants. Condense this to one to be a little more performant\n \n     // render handles for the asssistant\n-    Q_FOREACH (KisPaintingAssistant* assistant, m_canvas->paintingAssistantsDecoration()->assistants()) {\n+    Q_FOREACH (KisPaintingAssistantSP assistant, m_canvas->paintingAssistantsDecoration()->assistants()) {\n         Q_FOREACH (const KisPaintingAssistantHandleSP handle, m_handles) {\n             QRectF ellipse(_converter.documentToView(*handle) -  QPointF(6, 6), QSizeF(12, 12));\n \n@@ -637,7 +639,7 @@ void KisRulerAssistantTool::paint(QPainter& _gc, const KoViewConverter &_convert\n \n \n \n-    Q_FOREACH (KisPaintingAssistant* assistant, m_canvas->paintingAssistantsDecoration()->assistants()) {\n+    Q_FOREACH (KisPaintingAssistantSP assistant, m_canvas->paintingAssistantsDecoration()->assistants()) {\n         if(assistant->id()==\"perspective\") {\n             assistant->findHandleLocation();\n             QPointF topMiddle, bottomMiddle, rightMiddle, leftMiddle;\n@@ -674,7 +676,7 @@ void KisRulerAssistantTool::paint(QPainter& _gc, const KoViewConverter &_convert\n     }\n \n \n-    Q_FOREACH (const KisPaintingAssistant* assistant, m_canvas->paintingAssistantsDecoration()->assistants()) {\n+    Q_FOREACH (const KisPaintingAssistantSP assistant, m_canvas->paintingAssistantsDecoration()->assistants()) {\n \n \n        // We are going to put all of the assistant actions below the bounds of the assistant\n@@ -750,7 +752,7 @@ void KisRulerAssistantTool::loadAssistants()\n     QByteArray data = file.readAll();\n     QXmlStreamReader xml(data);\n     QMap<int, KisPaintingAssistantHandleSP> handleMap;\n-    KisPaintingAssistant* assistant = 0;\n+    KisPaintingAssistantSP assistant;\n     bool errors = false;\n     while (!xml.atEnd()) {\n         switch (xml.readNext()) {\n@@ -785,9 +787,9 @@ void KisRulerAssistantTool::loadAssistants()\n                 if (factory) {\n                     if (assistant) {\n                         errors = true;\n-                        delete assistant;\n+                        assistant.clear();\n                     }\n-                    assistant = factory->createPaintingAssistant();\n+                    assistant = toQShared(factory->createPaintingAssistant());\n                 } else {\n                     errors = true;\n                 }\n@@ -806,15 +808,14 @@ void KisRulerAssistantTool::loadAssistants()\n                             assistant->addSideHandle(new KisPaintingAssistantHandle(pos+QPointF(140,0)));\n                         }\n                         m_canvas->paintingAssistantsDecoration()->addAssistant(assistant);\n-                        KisAbstractPerspectiveGrid* grid = dynamic_cast<KisAbstractPerspectiveGrid*>(assistant);\n+                        KisAbstractPerspectiveGrid* grid = dynamic_cast<KisAbstractPerspectiveGrid*>(assistant.data());\n                         if (grid) {\n                             m_canvas->viewManager()->resourceProvider()->addPerspectiveGrid(grid);\n                         }\n                     } else {\n                         errors = true;\n-                        delete assistant;\n                     }\n-                    assistant = 0;\n+                    assistant.clear();\n                 }\n             }\n             break;\n@@ -824,7 +825,7 @@ void KisRulerAssistantTool::loadAssistants()\n     }\n     if (assistant) {\n         errors = true;\n-        delete assistant;\n+        assistant.clear();\n     }\n     if (xml.hasError()) {\n         QMessageBox::warning(0, i18nc(\"@title:window\", \"Krita\"), xml.errorString());\n@@ -859,7 +860,7 @@ void KisRulerAssistantTool::saveAssistants()\n     }\n     xml.writeEndElement();\n     xml.writeStartElement(\"assistants\");\n-    Q_FOREACH (const KisPaintingAssistant* assistant, m_canvas->paintingAssistantsDecoration()->assistants()) {\n+    Q_FOREACH (const KisPaintingAssistantSP assistant, m_canvas->paintingAssistantsDecoration()->assistants()) {\n         xml.writeStartElement(\"assistant\");\n         xml.writeAttribute(\"type\", assistant->id());\n         xml.writeStartElement(\"handles\");"}, {"sha": "23a77b30b12fe64fa1f14ba00fe14587dc7ebc8c", "filename": "plugins/assistants/RulerAssistant/kis_ruler_assistant_tool.h", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/KDE/krita/blob/a1e6bb022bd0803a9e616dc77a62e83017104374/plugins/assistants/RulerAssistant/kis_ruler_assistant_tool.h", "raw_url": "https://github.com/KDE/krita/raw/a1e6bb022bd0803a9e616dc77a62e83017104374/plugins/assistants/RulerAssistant/kis_ruler_assistant_tool.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/assistants/RulerAssistant/kis_ruler_assistant_tool.h?ref=a1e6bb022bd0803a9e616dc77a62e83017104374", "patch": "@@ -53,14 +53,14 @@ class KisRulerAssistantTool : public KisTool\n \n private:\n     void addAssistant();\n-    void removeAssistant(KisPaintingAssistant *assistant);\n-    void snappingOn(KisPaintingAssistant* assistant);\n-    void snappingOff(KisPaintingAssistant* assistant);\n-    void outlineOn(KisPaintingAssistant* assistant);\n-    void outlineOff(KisPaintingAssistant* assistant);\n+    void removeAssistant(KisPaintingAssistantSP assistant);\n+    void snappingOn(KisPaintingAssistantSP assistant);\n+    void snappingOff(KisPaintingAssistantSP assistant);\n+    void outlineOn(KisPaintingAssistantSP assistant);\n+    void outlineOff(KisPaintingAssistantSP assistant);\n     bool mouseNear(const QPointF& mousep, const QPointF& point);\n     QPointF straightLine(QPointF point, QPointF compare);\n-    KisPaintingAssistantHandleSP nodeNearPoint(KisPaintingAssistant* grid, QPointF point);\n+    KisPaintingAssistantHandleSP nodeNearPoint(KisPaintingAssistantSP grid, QPointF point);\n     QPointF snapToGuide(KoPointerEvent *e, const QPointF &offset, bool useModifiers);\n     QPointF snapToGuide(const QPointF& pt, const QPointF &offset);\n \n@@ -82,8 +82,8 @@ private Q_SLOTS:\n     QList<KisPaintingAssistantHandleSP> m_handles, m_sideHandles;\n     KisPaintingAssistantHandleSP m_handleDrag;\n     KisPaintingAssistantHandleSP m_handleCombine;\n-    KisPaintingAssistant* m_assistantDrag;\n-    KisPaintingAssistant* m_newAssistant;\n+    KisPaintingAssistantSP m_assistantDrag;\n+    KisPaintingAssistantSP m_newAssistant;\n     QPointF m_mousePosition;\n     Ui::AssistantsToolOptions m_options;\n     QWidget* m_optionsWidget;"}]}, {"sha": "962bfe1908d6d277aeb34279956a81ea75f6fb60", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "8493b57513aa7cc278b7735d4ec807e85bdad88e", "filename": "linux/build-image.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/962bfe1908d6d277aeb34279956a81ea75f6fb60/linux/build-image.sh", "raw_url": "https://github.com/KDE/krita/raw/962bfe1908d6d277aeb34279956a81ea75f6fb60/linux/build-image.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/linux/build-image.sh?ref=962bfe1908d6d277aeb34279956a81ea75f6fb60", "patch": "@@ -200,7 +200,7 @@ cp /krita/krita/pics/app/64-apps-calligrakrita.png calligrakrita.png\n #\n cd /\n rm -f krita-3.0-l10-win-current.tar.gz || true\n-wget http://www.valdyas.org/~boud/krita-3.0-l10n-win-current.tar.gz\n+wget http://files.kde.org/krita/build/krita-3.0-l10n-win-current.tar.gz\n tar -xf krita-3.0-l10n-win-current.tar.gz\n cd /krita.appdir/usr/share\n tar -xf /krita-3.0-l10n-win-current.tar.gz"}]}, {"sha": "37389d5353ec5aa4c4dacf2809c1b594b3fd06ab", "stats": {"total": 152, "additions": 80, "deletions": 72}, "files": [{"sha": "d11322243bde3964bb55ecfd1d72b452d43a78e5", "filename": "krita/krita.action", "status": "modified", "additions": 0, "deletions": 34, "changes": 34, "blob_url": "https://github.com/KDE/krita/blob/37389d5353ec5aa4c4dacf2809c1b594b3fd06ab/krita/krita.action", "raw_url": "https://github.com/KDE/krita/raw/37389d5353ec5aa4c4dacf2809c1b594b3fd06ab/krita/krita.action", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/krita.action?ref=37389d5353ec5aa4c4dacf2809c1b594b3fd06ab", "patch": "@@ -50,40 +50,6 @@\n       <isCheckable>false</isCheckable>\n       <statusTip></statusTip>\n     </Action>\n-    <Action name=\"windows_next\">\n-      <icon></icon>\n-      <text>N&amp;ext</text>\n-      <whatsThis></whatsThis>\n-      <toolTip>Next</toolTip>\n-      <iconText>Next</iconText>\n-      <activationFlags>10</activationFlags>\n-      <activationConditions>0</activationConditions>\n-      <shortcut></shortcut>\n-      <isCheckable>false</isCheckable>\n-      <statusTip></statusTip>\n-    </Action>\n-    <Action name=\"windows_previous\">\n-      <icon></icon>\n-      <text>Previous</text>\n-      <whatsThis></whatsThis>\n-      <toolTip>Previous</toolTip>\n-      <iconText>Previous</iconText>\n-      <shortcut></shortcut>\n-      <isCheckable>false</isCheckable>\n-      <statusTip></statusTip>\n-    </Action>\n-    <Action name=\"view_newwindow\">\n-      <icon>window-new</icon>\n-      <text>&amp;New Window</text>\n-      <whatsThis></whatsThis>\n-      <toolTip>New Window</toolTip>\n-      <iconText>New Window</iconText>\n-      <activationFlags>0</activationFlags>\n-      <activationConditions>0</activationConditions>\n-      <shortcut></shortcut>\n-      <isCheckable>false</isCheckable>\n-      <statusTip></statusTip>\n-    </Action>\n     <Action name=\"import_resources\">\n       <icon></icon>\n       <text>Import Resources or Bundles...</text>"}, {"sha": "cbba6112766a2ebf7d71889cc9436fcc01f940f5", "filename": "krita/kritamenu.action", "status": "modified", "additions": 80, "deletions": 38, "changes": 118, "blob_url": "https://github.com/KDE/krita/blob/37389d5353ec5aa4c4dacf2809c1b594b3fd06ab/krita/kritamenu.action", "raw_url": "https://github.com/KDE/krita/raw/37389d5353ec5aa4c4dacf2809c1b594b3fd06ab/krita/kritamenu.action", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/kritamenu.action?ref=37389d5353ec5aa4c4dacf2809c1b594b3fd06ab", "patch": "@@ -440,6 +440,44 @@\n     </Action>\n   </Actions>\n \n+  <Actions category=\"Window\">\n+    <text>Window</text>\n+    <Action name=\"view_newwindow\">\n+      <icon>window-new</icon>\n+      <text>&amp;New Window</text>\n+      <whatsThis></whatsThis>\n+      <toolTip>New Window</toolTip>\n+      <iconText>New Window</iconText>\n+      <activationFlags>0</activationFlags>\n+      <activationConditions>0</activationConditions>\n+      <shortcut></shortcut>\n+      <isCheckable>false</isCheckable>\n+      <statusTip></statusTip>\n+    </Action>\n+    <Action name=\"windows_next\">\n+      <icon></icon>\n+      <text>N&amp;ext</text>\n+      <whatsThis></whatsThis>\n+      <toolTip>Next</toolTip>\n+      <iconText>Next</iconText>\n+      <activationFlags>10</activationFlags>\n+      <activationConditions>0</activationConditions>\n+      <shortcut></shortcut>\n+      <isCheckable>false</isCheckable>\n+      <statusTip></statusTip>\n+    </Action>\n+    <Action name=\"windows_previous\">\n+      <icon></icon>\n+      <text>Previous</text>\n+      <whatsThis></whatsThis>\n+      <toolTip>Previous</toolTip>\n+      <iconText>Previous</iconText>\n+      <shortcut></shortcut>\n+      <isCheckable>false</isCheckable>\n+      <statusTip></statusTip>\n+    </Action>\n+  </Actions>\n+\n   <Actions category=\"View\">\n     <text>View</text>\n     <Action name=\"view_show_canvas_only\">\n@@ -1358,18 +1396,44 @@\n       <isCheckable>false</isCheckable>\n       <statusTip></statusTip>\n     </Action>\n-    <Action name=\"options_configure_toolbars\">\n+  </Actions>\n+\n+  <Actions category=\"Settings\">\n+    <text>Settings</text>\n+    <Action name=\"options_configure\">\n       <icon>configure</icon>\n-      <text>Configure Tool&amp;bars...</text>\n+      <text>&amp;Configure Krita...</text>\n       <whatsThis></whatsThis>\n-      <toolTip>Configure Toolbars</toolTip>\n-      <iconText>Configure Toolbars</iconText>\n+      <toolTip>Configure Krita</toolTip>\n+      <iconText>Configure Krita</iconText>\n       <activationFlags>0</activationFlags>\n       <activationConditions>0</activationConditions>\n       <shortcut></shortcut>\n       <isCheckable>false</isCheckable>\n       <statusTip></statusTip>\n     </Action>\n+    <Action name=\"manage_bundles\">\n+      <icon></icon>\n+      <text>&amp;Manage Resources...</text>\n+      <whatsThis></whatsThis>\n+      <toolTip>Manage Resources</toolTip>\n+      <iconText>Manage Resources</iconText>\n+      <activationFlags>0</activationFlags>\n+      <activationConditions>0</activationConditions>\n+      <shortcut></shortcut>\n+      <isCheckable>false</isCheckable>\n+      <statusTip></statusTip>\n+    </Action>\n+    <Action name=\"switch_application_language\">\n+      <icon>preferences-desktop-locale</icon>\n+      <text>Switch Application &amp;Language...</text>\n+      <whatsThis></whatsThis>\n+      <toolTip>Switch Application Language</toolTip>\n+      <iconText>Switch Application Language</iconText>\n+      <shortcut></shortcut>\n+      <isCheckable>false</isCheckable>\n+      <statusTip></statusTip>\n+    </Action>\n     <Action name=\"view_toggledockers\">\n       <icon></icon>\n       <text>&amp;Show Dockers</text>\n@@ -1394,6 +1458,18 @@\n       <isCheckable>true</isCheckable>\n       <statusTip></statusTip>\n     </Action>\n+    <Action name=\"options_configure_toolbars\">\n+      <icon>configure</icon>\n+      <text>Configure Tool&amp;bars...</text>\n+      <whatsThis></whatsThis>\n+      <toolTip>Configure Toolbars</toolTip>\n+      <iconText>Configure Toolbars</iconText>\n+      <activationFlags>0</activationFlags>\n+      <activationConditions>0</activationConditions>\n+      <shortcut></shortcut>\n+      <isCheckable>false</isCheckable>\n+      <statusTip></statusTip>\n+    </Action>\n     <Action name=\"settings_dockers_menu\">\n       <icon></icon>\n       <text>Dockers</text>\n@@ -1436,40 +1512,6 @@\n       <isCheckable>false</isCheckable>\n       <statusTip></statusTip>\n     </Action>\n-    <Action name=\"options_configure\">\n-      <icon>configure</icon>\n-      <text>&amp;Configure Krita...</text>\n-      <whatsThis></whatsThis>\n-      <toolTip>Configure Krita</toolTip>\n-      <iconText>Configure Krita</iconText>\n-      <activationFlags>0</activationFlags>\n-      <activationConditions>0</activationConditions>\n-      <shortcut></shortcut>\n-      <isCheckable>false</isCheckable>\n-      <statusTip></statusTip>\n-    </Action>\n-    <Action name=\"manage_bundles\">\n-      <icon></icon>\n-      <text>&amp;Manage Resources...</text>\n-      <whatsThis></whatsThis>\n-      <toolTip>Manage Resources</toolTip>\n-      <iconText>Manage Resources</iconText>\n-      <activationFlags>0</activationFlags>\n-      <activationConditions>0</activationConditions>\n-      <shortcut></shortcut>\n-      <isCheckable>false</isCheckable>\n-      <statusTip></statusTip>\n-    </Action>\n-    <Action name=\"switch_application_language\">\n-      <icon>preferences-desktop-locale</icon>\n-      <text>Switch Application &amp;Language...</text>\n-      <whatsThis></whatsThis>\n-      <toolTip>Switch Application Language</toolTip>\n-      <iconText>Switch Application Language</iconText>\n-      <shortcut></shortcut>\n-      <isCheckable>false</isCheckable>\n-      <statusTip></statusTip>\n-    </Action>\n     <Action name=\"window\">\n       <icon></icon>\n       <text>&amp;Window</text>"}]}, {"sha": "6b70a4c176c85d2eb8753e4c0787cb88d2f4a278", "stats": {"total": 13, "additions": 2, "deletions": 11}, "files": [{"sha": "222207b99d9d025b6fc27a0a1aa5a63b33c30f88", "filename": "libs/ui/ora/kis_open_raster_stack_load_visitor.cpp", "status": "modified", "additions": 2, "deletions": 11, "changes": 13, "blob_url": "https://github.com/KDE/krita/blob/6b70a4c176c85d2eb8753e4c0787cb88d2f4a278/libs/ui/ora/kis_open_raster_stack_load_visitor.cpp", "raw_url": "https://github.com/KDE/krita/raw/6b70a4c176c85d2eb8753e4c0787cb88d2f4a278/libs/ui/ora/kis_open_raster_stack_load_visitor.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/ora/kis_open_raster_stack_load_visitor.cpp?ref=6b70a4c176c85d2eb8753e4c0787cb88d2f4a278", "patch": "@@ -180,19 +180,14 @@ void KisOpenRasterStackLoadVisitor::loadPaintLayer(const QDomElement& elem, KisP\n void KisOpenRasterStackLoadVisitor::loadGroupLayer(const QDomElement& elem, KisGroupLayerSP gL)\n {\n     dbgFile << \"Loading group layer\";\n-    QLocale c(QLocale::German);\n     loadLayerInfo(elem, gL);\n     for (QDomNode node = elem.firstChild(); !node.isNull(); node = node.nextSibling()) {\n         if (node.isElement()) {\n             QDomElement subelem = node.toElement();\n             if (node.nodeName() == \"stack\") {\n                 double opacity = 1.0;\n                 if (!subelem.attribute(\"opacity\").isNull()) {\n-                    bool result;\n-                    opacity = subelem.attribute(\"opacity\", \"1.0\").toDouble(&result);\n-                    if (!result) {\n-                        opacity = c.toDouble(subelem.attribute(\"radius\"));\n-                    }\n+                    opacity = KisDomUtils::toDouble(subelem.attribute(\"opacity\", \"1.0\"));\n                 }\n                 KisGroupLayerSP layer = new KisGroupLayer(d->image, \"\", opacity * 255);\n                 d->image->addNode(layer.data(), gL.data(), 0);\n@@ -201,11 +196,7 @@ void KisOpenRasterStackLoadVisitor::loadGroupLayer(const QDomElement& elem, KisG\n                 QString filename = subelem.attribute(\"src\");\n                 if (!filename.isNull()) {\n                     double opacity = 1.0;\n-                    bool result;\n-                    opacity = subelem.attribute(\"opacity\", \"1.0\").toDouble(&result);\n-                    if (!result) {\n-                        opacity = c.toDouble(subelem.attribute(\"radius\"));\n-                    }\n+                    opacity = KisDomUtils::toDouble(subelem.attribute(\"opacity\", \"1.0\"));\n                     KisImageWSP pngImage = d->loadContext->loadDeviceData(filename);\n                     if (pngImage) {\n                         // If ORA doesn't have resolution info, load the default value(75 ppi) else fetch from stack.xml"}]}, {"sha": "e7d02015097b5d028e715dee36910c44763c8709", "stats": {"total": 4, "additions": 0, "deletions": 4}, "files": [{"sha": "fe21700575ca0118eb9ec75f07d84dd8d610ae0a", "filename": "libs/ui/kra/kis_kra_save_visitor.cpp", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/e7d02015097b5d028e715dee36910c44763c8709/libs/ui/kra/kis_kra_save_visitor.cpp", "raw_url": "https://github.com/KDE/krita/raw/e7d02015097b5d028e715dee36910c44763c8709/libs/ui/kra/kis_kra_save_visitor.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kra/kis_kra_save_visitor.cpp?ref=e7d02015097b5d028e715dee36910c44763c8709", "patch": "@@ -161,10 +161,6 @@ bool KisKraSaveVisitor::visit(KisGeneratorLayer * layer)\n         m_errorMessages << i18n(\"Failed to save the selection for layer %1.\", layer->name());\n         return false;\n     }\n-    if (!saveAnnotations(layer)) {\n-        m_errorMessages << i18n(\"Failed to save the annotations for layer %1.\", layer->name());\n-        return false;   // generator layers can have a profile because they have their own pixel data\n-    }\n     if (!saveFilterConfiguration(layer)) {\n         m_errorMessages << i18n(\"Failed to save the generator configuration for layer %1.\", layer->name());\n         return false;"}]}, {"sha": "c2a10021f8ad182e5da32027b0c9880fc454e177", "stats": {"total": 4, "additions": 4, "deletions": 0}, "files": [{"sha": "6677f19824897225f02eb6002b36db282c2aedba", "filename": "libs/ui/kra/kis_kra_load_visitor.cpp", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/c2a10021f8ad182e5da32027b0c9880fc454e177/libs/ui/kra/kis_kra_load_visitor.cpp", "raw_url": "https://github.com/KDE/krita/raw/c2a10021f8ad182e5da32027b0c9880fc454e177/libs/ui/kra/kis_kra_load_visitor.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kra/kis_kra_load_visitor.cpp?ref=c2a10021f8ad182e5da32027b0c9880fc454e177", "patch": "@@ -179,6 +179,10 @@ bool KisKraLoadVisitor::visit(KisPaintLayer *layer)\n \n bool KisKraLoadVisitor::visit(KisGroupLayer *layer)\n {\n+    if (!(*layer->colorSpace() == *m_image->colorSpace())) {\n+        layer->resetCache(m_image->colorSpace());\n+    }\n+\n     if (!loadMetaData(layer)) {\n         return false;\n     }"}]}, {"sha": "77695fea234b1228adde30011b73d7457f3a45b7", "stats": {"total": 34, "additions": 33, "deletions": 1}, "files": [{"sha": "b2ffd549875b0043988c9df699f754a06293d31e", "filename": "libs/image/kis_keyframe_channel.cpp", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/KDE/krita/blob/77695fea234b1228adde30011b73d7457f3a45b7/libs/image/kis_keyframe_channel.cpp", "raw_url": "https://github.com/KDE/krita/raw/77695fea234b1228adde30011b73d7457f3a45b7/libs/image/kis_keyframe_channel.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_keyframe_channel.cpp?ref=77695fea234b1228adde30011b73d7457f3a45b7", "patch": "@@ -278,6 +278,21 @@ KisKeyframeSP KisKeyframeChannel::lastKeyframe() const\n     return (m_d->keys.end()-1).value();\n }\n \n+int KisKeyframeChannel::framesHash() const\n+{\n+    KeyframesMap::const_iterator it = m_d->keys.constBegin();\n+    KeyframesMap::const_iterator end = m_d->keys.constEnd();\n+\n+    int hash = 0;\n+\n+    while (it != end) {\n+        hash += it.key();\n+        ++it;\n+    }\n+\n+    return hash;\n+}\n+\n QSet<int> KisKeyframeChannel::allKeyframeIds() const\n {\n     QSet<int> frames;"}, {"sha": "385f51b2a8cb4f51d2b2e40775335d7ca4538dbc", "filename": "libs/image/kis_keyframe_channel.h", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/77695fea234b1228adde30011b73d7457f3a45b7/libs/image/kis_keyframe_channel.h", "raw_url": "https://github.com/KDE/krita/raw/77695fea234b1228adde30011b73d7457f3a45b7/libs/image/kis_keyframe_channel.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_keyframe_channel.h?ref=77695fea234b1228adde30011b73d7457f3a45b7", "patch": "@@ -63,6 +63,12 @@ class KRITAIMAGE_EXPORT KisKeyframeChannel : public QObject\n     KisKeyframeSP previousKeyframe(KisKeyframeSP keyframe) const;\n     KisKeyframeSP lastKeyframe() const;\n \n+    /**\n+     * Calculates a pseudo-unique keyframes hash. The hash changes\n+     * every time any frame is added/removed/moved\n+     */\n+    int framesHash() const;\n+\n     QSet<int> allKeyframeIds() const;\n     /**\n      * Get the set of frames affected by any changes to the value"}, {"sha": "69b2af6f2caea6d89bd6c47c1e6f44993bfa54f3", "filename": "libs/image/kis_onion_skin_cache.cpp", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/KDE/krita/blob/77695fea234b1228adde30011b73d7457f3a45b7/libs/image/kis_onion_skin_cache.cpp", "raw_url": "https://github.com/KDE/krita/raw/77695fea234b1228adde30011b73d7457f3a45b7/libs/image/kis_onion_skin_cache.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_onion_skin_cache.cpp?ref=77695fea234b1228adde30011b73d7457f3a45b7", "patch": "@@ -28,28 +28,38 @@\n #include \"kis_default_bounds.h\"\n #include \"kis_image.h\"\n \n+#include \"kis_raster_keyframe_channel.h\"\n+\n \n struct KisOnionSkinCache::Private\n {\n     KisPaintDeviceSP cachedProjection;\n \n     int cacheTime = 0;\n     int cacheConfigSeqNo = 0;\n+    int framesHash = 0;\n     QReadWriteLock lock;\n \n     bool checkCacheValid(KisPaintDeviceSP source, KisOnionSkinCompositor *compositor) {\n+        const KisRasterKeyframeChannel *keyframes = source->keyframeChannel();\n+\n         const int time = source->defaultBounds()->currentTime();\n         const int seqNo = compositor->configSeqNo();\n+        const int hash = keyframes->framesHash();\n \n-        return time == cacheTime && cacheConfigSeqNo == seqNo;\n+        return time == cacheTime && cacheConfigSeqNo == seqNo && framesHash == hash;\n     }\n \n     void updateCacheMetrics(KisPaintDeviceSP source, KisOnionSkinCompositor *compositor) {\n+        const KisRasterKeyframeChannel *keyframes = source->keyframeChannel();\n+\n         const int time = source->defaultBounds()->currentTime();\n         const int seqNo = compositor->configSeqNo();\n+        const int hash = keyframes->framesHash();\n \n         cacheTime = time;\n         cacheConfigSeqNo = seqNo;\n+        framesHash = hash;\n     }\n };\n \n@@ -70,6 +80,7 @@ KisPaintDeviceSP KisOnionSkinCache::projection(KisPaintDeviceSP source)\n \n     QReadLocker readLocker(&m_d->lock);\n     cachedProjection = m_d->cachedProjection;\n+\n     if (!cachedProjection || !m_d->checkCacheValid(source, compositor)) {\n \n         readLocker.unlock();"}]}, {"sha": "bba8fa783d5601dcaabd52d2e0cba88edee7fc4a", "stats": {"total": 15, "additions": 8, "deletions": 7}, "files": [{"sha": "b8037615666be0c4d8627fff32cb52d0959a868f", "filename": "libs/ui/ora/kis_open_raster_stack_load_visitor.cpp", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/KDE/krita/blob/bba8fa783d5601dcaabd52d2e0cba88edee7fc4a/libs/ui/ora/kis_open_raster_stack_load_visitor.cpp", "raw_url": "https://github.com/KDE/krita/raw/bba8fa783d5601dcaabd52d2e0cba88edee7fc4a/libs/ui/ora/kis_open_raster_stack_load_visitor.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/ora/kis_open_raster_stack_load_visitor.cpp?ref=bba8fa783d5601dcaabd52d2e0cba88edee7fc4a", "patch": "@@ -34,6 +34,7 @@\n #include <kis_paint_layer.h>\n #include <kis_png_converter.h>\n #include <kis_selection.h>\n+#include <kis_dom_utils.h>\n \n #include \"KisDocument.h\"\n \n@@ -91,13 +92,13 @@ void KisOpenRasterStackLoadVisitor::loadImage()\n             }\n \n             d->xRes = 75.0/72; // Setting the default value of the X Resolution = 75ppi\n-            if(!subelem.attribute(\"xres\").isNull()){\n-                d->xRes = (subelem.attribute(\"xres\").toDouble() / 72);\n+            if (!subelem.attribute(\"xres\").isNull()){\n+                d->xRes = (KisDomUtils::toDouble(subelem.attribute(\"xres\")) / 72);\n             }\n \n             d->yRes = 75.0/72;\n-            if(!subelem.attribute(\"yres\").isNull()){\n-                d->yRes = (subelem.attribute(\"yres\").toDouble() / 72);\n+            if (!subelem.attribute(\"yres\").isNull()){\n+                d->yRes = (KisDomUtils::toDouble(subelem.attribute(\"yres\")) / 72);\n             }\n \n             dbgFile << ppVar(width) << ppVar(height);"}, {"sha": "add376f274c2673fd838c177efbeaf3db19382fe", "filename": "plugins/paintops/defaultpaintops/duplicate/kis_duplicateop_settings.cpp", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/bba8fa783d5601dcaabd52d2e0cba88edee7fc4a/plugins/paintops/defaultpaintops/duplicate/kis_duplicateop_settings.cpp", "raw_url": "https://github.com/KDE/krita/raw/bba8fa783d5601dcaabd52d2e0cba88edee7fc4a/plugins/paintops/defaultpaintops/duplicate/kis_duplicateop_settings.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/defaultpaintops/duplicate/kis_duplicateop_settings.cpp?ref=bba8fa783d5601dcaabd52d2e0cba88edee7fc4a", "patch": "@@ -37,7 +37,7 @@\n #include <kis_pressure_opacity_option.h>\n #include <kis_pressure_size_option.h>\n #include <kis_paint_action_type_option.h>\n-\n+#include <kis_dom_utils.h>\n \n KisDuplicateOpSettings::KisDuplicateOpSettings()\n     : m_isOffsetNotUptodate(false)\n@@ -106,8 +106,8 @@ void KisDuplicateOpSettings::fromXML(const QDomElement& elt)\n     // properties are saved to the map\n     KisPaintOpSettings::fromXML(elt);\n \n-    m_offset.setX(elt.attribute(\"OffsetX\", \"0.0\").toDouble());\n-    m_offset.setY(elt.attribute(\"OffsetY\", \"0.0\").toDouble());\n+    m_offset.setX(KisDomUtils::toDouble(elt.attribute(\"OffsetX\", \"0.0\")));\n+    m_offset.setY(KisDomUtils::toDouble(elt.attribute(\"OffsetY\", \"0.0\")));\n     m_isOffsetNotUptodate = false;\n }\n "}]}, {"sha": "c724c14114c3631e99acaac7ff11ae4077efe807", "stats": {"total": 85, "additions": 36, "deletions": 49}, "files": [{"sha": "d6c71a8cbf8f023a6f5463c5b6f16f909b135361", "filename": "libs/flake/KoOdfGradientBackground.cpp", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/c724c14114c3631e99acaac7ff11ae4077efe807/libs/flake/KoOdfGradientBackground.cpp", "raw_url": "https://github.com/KDE/krita/raw/c724c14114c3631e99acaac7ff11ae4077efe807/libs/flake/KoOdfGradientBackground.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/flake/KoOdfGradientBackground.cpp?ref=c724c14114c3631e99acaac7ff11ae4077efe807", "patch": "@@ -36,7 +36,6 @@\n #include <QImage>\n #include <qmath.h>\n \n-\n class KoOdfGradientBackgroundPrivate : public KoShapeBackgroundPrivate\n {\n public:"}, {"sha": "31e94576b6cb10007e001463a0b4d4a38febde36", "filename": "libs/image/brushengine/kis_paint_information.cc", "status": "modified", "additions": 11, "deletions": 10, "changes": 21, "blob_url": "https://github.com/KDE/krita/blob/c724c14114c3631e99acaac7ff11ae4077efe807/libs/image/brushengine/kis_paint_information.cc", "raw_url": "https://github.com/KDE/krita/raw/c724c14114c3631e99acaac7ff11ae4077efe807/libs/image/brushengine/kis_paint_information.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/brushengine/kis_paint_information.cc?ref=c724c14114c3631e99acaac7ff11ae4077efe807", "patch": "@@ -25,6 +25,7 @@\n #include \"kis_algebra_2d.h\"\n #include \"kis_lod_transform.h\"\n \n+#include <kis_dom_utils.h>\n \n struct KisPaintInformation::Private {\n     EIGEN_MAKE_ALIGNED_OPERATOR_NEW\n@@ -274,16 +275,16 @@ void KisPaintInformation::toXML(QDomDocument&, QDomElement& e) const\n \n KisPaintInformation KisPaintInformation::fromXML(const QDomElement& e)\n {\n-    qreal pointX = qreal(e.attribute(\"pointX\", \"0.0\").toDouble());\n-    qreal pointY = qreal(e.attribute(\"pointY\", \"0.0\").toDouble());\n-    qreal pressure = qreal(e.attribute(\"pressure\", \"0.0\").toDouble());\n-    qreal rotation = qreal(e.attribute(\"rotation\", \"0.0\").toDouble());\n-    qreal tangentialPressure = qreal(e.attribute(\"tangentialPressure\", \"0.0\").toDouble());\n-    qreal perspective = qreal(e.attribute(\"perspective\", \"0.0\").toDouble());\n-    qreal xTilt = qreal(e.attribute(\"xTilt\", \"0.0\").toDouble());\n-    qreal yTilt = qreal(e.attribute(\"yTilt\", \"0.0\").toDouble());\n-    qreal time = e.attribute(\"time\", \"0\").toDouble();\n-    qreal speed = e.attribute(\"speed\", \"0\").toDouble();\n+    qreal pointX = qreal(KisDomUtils::toDouble(e.attribute(\"pointX\", \"0.0\")));\n+    qreal pointY = qreal(KisDomUtils::toDouble(e.attribute(\"pointY\", \"0.0\")));\n+    qreal pressure = qreal(KisDomUtils::toDouble(e.attribute(\"pressure\", \"0.0\")));\n+    qreal rotation = qreal(KisDomUtils::toDouble(e.attribute(\"rotation\", \"0.0\")));\n+    qreal tangentialPressure = qreal(KisDomUtils::toDouble(e.attribute(\"tangentialPressure\", \"0.0\")));\n+    qreal perspective = qreal(KisDomUtils::toDouble(e.attribute(\"perspective\", \"0.0\")));\n+    qreal xTilt = qreal(KisDomUtils::toDouble(e.attribute(\"xTilt\", \"0.0\")));\n+    qreal yTilt = qreal(KisDomUtils::toDouble(e.attribute(\"yTilt\", \"0.0\")));\n+    qreal time = KisDomUtils::toDouble(e.attribute(\"time\", \"0\"));\n+    qreal speed = KisDomUtils::toDouble(e.attribute(\"speed\", \"0\"));\n \n     return KisPaintInformation(QPointF(pointX, pointY), pressure, xTilt, yTilt,\n                                rotation, tangentialPressure, perspective, time, speed);"}, {"sha": "7b29da4ea7cb81514ec5b05c516c932a7605c06e", "filename": "libs/image/kis_base_mask_generator.cpp", "status": "modified", "additions": 7, "deletions": 24, "changes": 31, "blob_url": "https://github.com/KDE/krita/blob/c724c14114c3631e99acaac7ff11ae4077efe807/libs/image/kis_base_mask_generator.cpp", "raw_url": "https://github.com/KDE/krita/raw/c724c14114c3631e99acaac7ff11ae4077efe807/libs/image/kis_base_mask_generator.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_base_mask_generator.cpp?ref=c724c14114c3631e99acaac7ff11ae4077efe807", "patch": "@@ -36,7 +36,7 @@\n #include \"kis_cubic_curve.h\"\n #include \"kis_curve_circle_mask_generator.h\"\n #include \"kis_curve_rect_mask_generator.h\"\n-\n+#include <kis_dom_utils.h>\n \n struct KisMaskGenerator::Private {\n     qreal diameter, ratio;\n@@ -128,34 +128,17 @@ void KisMaskGenerator::toXML(QDomDocument& doc, QDomElement& e) const\n \n KisMaskGenerator* KisMaskGenerator::fromXML(const QDomElement& elt)\n {\n-    QLocale c(QLocale::German);\n-    bool result;\n-\n     double diameter = 1.0;\n     // backward compatibility -- it was mistakenly named radius for 2.2\n     if (elt.hasAttribute(\"radius\")){\n-        diameter = elt.attribute(\"radius\", \"1.0\").toDouble(&result);\n-        if (!result) {\n-            diameter = c.toDouble(elt.attribute(\"radius\"));\n-        }\n-    }else /*if (elt.hasAttribute(\"diameter\"))*/{\n-        diameter = elt.attribute(\"diameter\", \"1.0\").toDouble(&result);\n-        if (!result) {\n-            diameter = c.toDouble(elt.attribute(\"diameter\"));\n-        }\n-    }\n-    double ratio = elt.attribute(\"ratio\", \"1.0\").toDouble(&result);\n-    if (!result) {\n-        ratio = c.toDouble(elt.attribute(\"ratio\"));\n-    }\n-    double hfade = elt.attribute(\"hfade\", \"0.0\").toDouble(&result);\n-    if (!result) {\n-        hfade = c.toDouble(elt.attribute(\"hfade\"));\n+        diameter = KisDomUtils::toDouble(elt.attribute(\"radius\", \"1.0\"));\n     }\n-    double vfade = elt.attribute(\"vfade\", \"0.0\").toDouble(&result);\n-    if (!result) {\n-        vfade = c.toDouble(elt.attribute(\"vfade\"));\n+    else /*if (elt.hasAttribute(\"diameter\"))*/{\n+        diameter = KisDomUtils::toDouble(elt.attribute(\"diameter\", \"1.0\"));\n     }\n+    double ratio = KisDomUtils::toDouble(elt.attribute(\"ratio\", \"1.0\"));\n+    double hfade = KisDomUtils::toDouble(elt.attribute(\"hfade\", \"0.0\"));\n+    double vfade = KisDomUtils::toDouble(elt.attribute(\"vfade\", \"0.0\"));\n \n     int spikes = elt.attribute(\"spikes\", \"2\").toInt();\n     QString typeShape = elt.attribute(\"type\", \"circle\");"}, {"sha": "bb3f872280a99dfabaed8ae97b03c0c65ce20c75", "filename": "libs/image/kis_cubic_curve.cpp", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/c724c14114c3631e99acaac7ff11ae4077efe807/libs/image/kis_cubic_curve.cpp", "raw_url": "https://github.com/KDE/krita/raw/c724c14114c3631e99acaac7ff11ae4077efe807/libs/image/kis_cubic_curve.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_cubic_curve.cpp?ref=c724c14114c3631e99acaac7ff11ae4077efe807", "patch": "@@ -24,6 +24,7 @@\n #include <QList>\n #include <QSharedData>\n #include <QStringList>\n+#include \"kis_dom_utils.h\"\n \n template <typename T>\n class KisTridiagonalSystem\n@@ -455,8 +456,8 @@ void KisCubicCurve::fromString(const QString& string)\n     Q_FOREACH (const QString & pair, data) {\n         if (pair.indexOf(',') > -1) {\n             QPointF p;\n-            p.rx() = pair.section(',', 0, 0).toDouble();\n-            p.ry() = pair.section(',', 1, 1).toDouble();\n+            p.rx() = KisDomUtils::toDouble(pair.section(',', 0, 0));\n+            p.ry() = KisDomUtils::toDouble(pair.section(',', 1, 1));\n             points.append(p);\n         }\n     }"}, {"sha": "869381e9bb9bb147c651ef4fc7a07c2a843886b2", "filename": "libs/image/recorder/kis_recorded_paint_action.cpp", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/c724c14114c3631e99acaac7ff11ae4077efe807/libs/image/recorder/kis_recorded_paint_action.cpp", "raw_url": "https://github.com/KDE/krita/raw/c724c14114c3631e99acaac7ff11ae4077efe807/libs/image/recorder/kis_recorded_paint_action.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/recorder/kis_recorded_paint_action.cpp?ref=c724c14114c3631e99acaac7ff11ae4077efe807", "patch": "@@ -41,7 +41,7 @@\n #include \"kis_layer.h\"\n #include \"kis_play_info.h\"\n #include \"kis_node_query_path.h\"\n-\n+#include <kis_dom_utils.h>\n // Recorder\n #include \"kis_recorded_action_factory_registry.h\"\n #include \"kis_recorded_action_load_context.h\"\n@@ -448,12 +448,12 @@ KoColor KisRecordedPaintActionFactory::colorFromXML(const QDomElement& elt, cons\n \n qreal KisRecordedPaintActionFactory::opacityFromXML(const QDomElement& elt)\n {\n-    return elt.attribute(\"opacity\", \"1.0\").toDouble();\n+    return KisDomUtils::toDouble(elt.attribute(\"opacity\", \"1.0\"));\n }\n \n bool KisRecordedPaintActionFactory::paintIncrementalFromXML(const QDomElement& elt)\n {\n-    return elt.attribute(\"paintIncremental\", \"1\").toInt();\n+    return KisDomUtils::toInt(elt.attribute(\"paintIncremental\", \"1\"));\n }\n \n QString KisRecordedPaintActionFactory::compositeOpFromXML(const QDomElement& elt)"}, {"sha": "abc15be9832020bdb27989be367aae2d61f9cd96", "filename": "libs/image/recorder/kis_recorded_path_paint_action.cpp", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/KDE/krita/blob/c724c14114c3631e99acaac7ff11ae4077efe807/libs/image/recorder/kis_recorded_path_paint_action.cpp", "raw_url": "https://github.com/KDE/krita/raw/c724c14114c3631e99acaac7ff11ae4077efe807/libs/image/recorder/kis_recorded_path_paint_action.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/recorder/kis_recorded_path_paint_action.cpp?ref=c724c14114c3631e99acaac7ff11ae4077efe807", "patch": "@@ -38,6 +38,7 @@\n #include \"kis_image.h\"\n #include \"kis_layer.h\"\n #include \"kis_node_query_path.h\"\n+#include <kis_dom_utils.h>\n \n struct Q_DECL_HIDDEN KisRecordedPathPaintAction::Private {\n     struct BezierCurveSlice {\n@@ -239,10 +240,10 @@ KisRecordedAction* KisRecordedPathPaintActionFactory::fromXML(const QDomElement&\n                     QDomElement control1Elt = eWp.firstChildElement(\"Control1\");\n                     QDomElement control2Elt = eWp.firstChildElement(\"Control2\");\n                     rplpa->addCurve(KisPaintInformation::fromXML(eWp.firstChildElement(\"Point1\")),\n-                                    QPointF(control1Elt.attribute(\"x\", \"0.0\").toDouble(),\n-                                            control1Elt.attribute(\"y\", \"0.0\").toDouble()),\n-                                    QPointF(control2Elt.attribute(\"x\", \"0.0\").toDouble(),\n-                                            control2Elt.attribute(\"y\", \"0.0\").toDouble()),\n+                                    QPointF(KisDomUtils::toDouble(control1Elt.attribute(\"x\", \"0.0\")),\n+                                            KisDomUtils::toDouble(control1Elt.attribute(\"y\", \"0.0\"))),\n+                                    QPointF(KisDomUtils::toDouble(control2Elt.attribute(\"x\", \"0.0\")),\n+                                            KisDomUtils::toDouble(control2Elt.attribute(\"y\", \"0.0\"))),\n                                     KisPaintInformation::fromXML(eWp.firstChildElement(\"Point2\")));\n                 } else {\n                     dbgImage << \"Unsupported <\" << eWp.tagName() << \" /> element\";"}, {"sha": "cfab4e26b1064c61d6eb644c328f8619f50b441e", "filename": "libs/image/recorder/kis_recorded_shape_paint_action.cpp", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/KDE/krita/blob/c724c14114c3631e99acaac7ff11ae4077efe807/libs/image/recorder/kis_recorded_shape_paint_action.cpp", "raw_url": "https://github.com/KDE/krita/raw/c724c14114c3631e99acaac7ff11ae4077efe807/libs/image/recorder/kis_recorded_shape_paint_action.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/recorder/kis_recorded_shape_paint_action.cpp?ref=c724c14114c3631e99acaac7ff11ae4077efe807", "patch": "@@ -40,6 +40,7 @@\n #include \"kis_image.h\"\n #include \"kis_layer.h\"\n #include \"kis_node_query_path.h\"\n+#include <kis_dom_utils.h>\n \n struct Q_DECL_HIDDEN KisRecordedShapePaintAction::Private {\n     Shape shape;\n@@ -139,11 +140,12 @@ KisRecordedAction* KisRecordedShapePaintActionFactory::fromXML(const QDomElement\n     QDomElement ellipseElt = elt.firstChildElement(\"Rectangle\");\n     qreal x, y, width, height;\n     if (!ellipseElt.isNull()) {\n-        x = ellipseElt.attribute(\"x\", \"0.0\").toDouble();\n-        y = ellipseElt.attribute(\"y\", \"0.0\").toDouble();\n-        width = ellipseElt.attribute(\"width\", \"0.0\").toDouble();\n-        height = ellipseElt.attribute(\"height\", \"0.0\").toDouble();\n-    } else {\n+        x = KisDomUtils::toDouble(ellipseElt.attribute(\"x\", \"0.0\"));\n+        y = KisDomUtils::toDouble(ellipseElt.attribute(\"y\", \"0.0\"));\n+        width = KisDomUtils::toDouble(ellipseElt.attribute(\"width\", \"0.0\"));\n+        height = KisDomUtils::toDouble(ellipseElt.attribute(\"height\", \"0.0\"));\n+    }\n+    else {\n         x = 0;\n         y = 0;\n         width = 0;"}]}, {"sha": "62ff0ee4ce991d1d4bdaa8ff180247835d5dfd75", "stats": {"total": 9, "additions": 3, "deletions": 6}, "files": [{"sha": "b0922e9ce58d97a2e9b89527062cb5580e5e4709", "filename": "libs/widgetutils/xmlgui/kswitchlanguagedialog_p.cpp", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/KDE/krita/blob/62ff0ee4ce991d1d4bdaa8ff180247835d5dfd75/libs/widgetutils/xmlgui/kswitchlanguagedialog_p.cpp", "raw_url": "https://github.com/KDE/krita/raw/62ff0ee4ce991d1d4bdaa8ff180247835d5dfd75/libs/widgetutils/xmlgui/kswitchlanguagedialog_p.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/xmlgui/kswitchlanguagedialog_p.cpp?ref=62ff0ee4ce991d1d4bdaa8ff180247835d5dfd75", "patch": "@@ -278,12 +278,9 @@ void KSwitchLanguageDialog::slotOk()\n         //list is different from defaults or saved languages list\n         setApplicationSpecificLanguage(languageString.toLatin1());\n \n-        KMessageBox::information(\n-            this,\n-            i18n(\"The language for this application has been changed. The change will take effect the next time the application is started.\"), //text\n-            i18n(\"Application Language Changed\"), //caption\n-            QStringLiteral(\"ApplicationLanguageChangedWarning\") //dontShowAgainName\n-        );\n+        QMessageBox::information(this,\n+                                 i18nc(\"@title:window:\", \"Application Language Changed\"), //caption\n+                                 i18n(\"The language for this application has been changed. The change will take effect the next time the application is started.\"));\n     }\n \n     accept();"}]}, {"sha": "222733048a31baee2e681444f948026f0fa0001c", "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "31501d4cbc4e6b350f869f7165e7345efb7f2bbe", "filename": "libs/koplugin/KisMimeDatabase.cpp", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/222733048a31baee2e681444f948026f0fa0001c/libs/koplugin/KisMimeDatabase.cpp", "raw_url": "https://github.com/KDE/krita/raw/222733048a31baee2e681444f948026f0fa0001c/libs/koplugin/KisMimeDatabase.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/koplugin/KisMimeDatabase.cpp?ref=222733048a31baee2e681444f948026f0fa0001c", "patch": "@@ -161,11 +161,17 @@ void KisMimeDatabase::fillMimeData()\n         mimeType.suffixes = QStringList() << \"*.abr\";\n         s_mimeDatabase << mimeType;\n \n+        mimeType.mimeType = \"image/png\";\n+        mimeType.description = i18nc(\"description of a file type\", \"Krita Brush Preset\");\n+        mimeType.suffixes = QStringList() << \"*.kpp\";\n+        s_mimeDatabase << mimeType;\n+\n         mimeType.mimeType = \"application/x-krita-paintoppreset\";\n         mimeType.description = i18nc(\"description of a file type\", \"Krita Brush Preset\");\n         mimeType.suffixes = QStringList() << \"*.kpp\";\n         s_mimeDatabase << mimeType;\n \n+\n         mimeType.mimeType = \"application/x-krita-assistant\";\n         mimeType.description = i18nc(\"description of a file type\", \"Krita Assistant\");\n         mimeType.suffixes = QStringList() << \"*.paintingassistant\";"}, {"sha": "5806a3ce869774ebae16b824def2c2a35a64eec2", "filename": "plugins/impex/png/krita_png_export.json", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/222733048a31baee2e681444f948026f0fa0001c/plugins/impex/png/krita_png_export.json", "raw_url": "https://github.com/KDE/krita/raw/222733048a31baee2e681444f948026f0fa0001c/plugins/impex/png/krita_png_export.json", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/png/krita_png_export.json?ref=222733048a31baee2e681444f948026f0fa0001c", "patch": "@@ -9,5 +9,5 @@\n         \"Krita/FileFilter\"\n     ],\n     \"X-KDE-Weight\": \"1\",\n-    \"X-KDE-Extensions\" : \"png\"\n+    \"X-KDE-Extensions\" : \"png,kpp\"\n }"}, {"sha": "c0390f556031ea918286a4624b19d563e5294ac3", "filename": "plugins/impex/png/krita_png_import.json", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/222733048a31baee2e681444f948026f0fa0001c/plugins/impex/png/krita_png_import.json", "raw_url": "https://github.com/KDE/krita/raw/222733048a31baee2e681444f948026f0fa0001c/plugins/impex/png/krita_png_import.json", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/png/krita_png_import.json?ref=222733048a31baee2e681444f948026f0fa0001c", "patch": "@@ -9,5 +9,5 @@\n         \"Krita/FileFilter\"\n     ],\n     \"X-KDE-Weight\": \"1\",\n-    \"X-KDE-Extensions\" : \"png\"\n+    \"X-KDE-Extensions\" : \"png,kpp\"\n }"}]}, {"sha": "6dfacb6744925b7f36ac7d019b73518a551c5e49", "stats": {"total": 17, "additions": 6, "deletions": 11}, "files": [{"sha": "6c2e55c00c7977fb77968e2c92c9c20d3a4a1d3a", "filename": "libs/brush/kis_abr_translator.cpp", "status": "modified", "additions": 4, "deletions": 9, "changes": 13, "blob_url": "https://github.com/KDE/krita/blob/6dfacb6744925b7f36ac7d019b73518a551c5e49/libs/brush/kis_abr_translator.cpp", "raw_url": "https://github.com/KDE/krita/raw/6dfacb6744925b7f36ac7d019b73518a551c5e49/libs/brush/kis_abr_translator.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/brush/kis_abr_translator.cpp?ref=6dfacb6744925b7f36ac7d019b73518a551c5e49", "patch": "@@ -19,6 +19,7 @@\n #include \"kis_abr_translator.h\"\n #include <kis_debug.h>\n #include <QStringList>\n+#include <kis_dom_utils.h>\n \n KisAbrTranslator::KisAbrTranslator()\n {\n@@ -127,9 +128,7 @@ void AbrBrushProperties::setupProperty(const QString& attributeName, const QStri\n         list = value.split(' ');\n         //e.g. \"#Pxl 10\" -> ['#Pxl','10']\n         Q_ASSERT(list.count() == 2);\n-        bool ok;\n-        valueDbl = list.at(1).toDouble(&ok);\n-        Q_ASSERT(ok);\n+        valueDbl = KisDomUtils::toDouble(list.at(1));\n     }\n \n     if (attributeName == OBJECT_NAME_BRUSH) {\n@@ -233,9 +232,7 @@ void AbrTipDynamicsProperties::setupProperty(const QString& attributeName, const\n         list = value.split(' ');\n         //e.g. \"#Pxl 10\" -> ['#Pxl','10']\n         Q_ASSERT(list.count() == 2);\n-        bool ok;\n-        valueDbl = list.at(1).toDouble(&ok);\n-        Q_ASSERT(ok);\n+        valueDbl = KisDomUtils::toDouble(list.at(1));\n     }\n \n     if (m_groupType.isNull()) {\n@@ -314,9 +311,7 @@ void AbrGroupProperties::setupProperty(const QString& attributeName, const QStri\n         list = value.split(' ');\n         //e.g. \"#Pxl 10\" -> ['#Pxl','10']\n         Q_ASSERT(list.count() == 2);\n-        bool ok;\n-        valueDbl = list.at(1).toDouble(&ok);\n-        Q_ASSERT(ok);\n+        valueDbl = KisDomUtils::toDouble(list.at(1));\n     }\n \n     if (attributeName == ABR_DYNAMICS_FADE_STEP) {"}, {"sha": "0fc1b248d57c1f716deb42b2ba6b7f601c139867", "filename": "libs/brush/kis_text_brush_factory.cpp", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/6dfacb6744925b7f36ac7d019b73518a551c5e49/libs/brush/kis_text_brush_factory.cpp", "raw_url": "https://github.com/KDE/krita/raw/6dfacb6744925b7f36ac7d019b73518a551c5e49/libs/brush/kis_text_brush_factory.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/brush/kis_text_brush_factory.cpp?ref=6dfacb6744925b7f36ac7d019b73518a551c5e49", "patch": "@@ -19,15 +19,15 @@\n \n #include <QString>\n #include <QFont>\n-\n+#include <kis_dom_utils.h>\n #include \"kis_text_brush.h\"\n \n KisBrushSP KisTextBrushFactory::getOrCreateBrush(const QDomElement& brushDefinition)\n {\n     QString text = brushDefinition.attribute(\"text\", \"The quick brown fox ate your text\");\n     QFont font;\n     font.fromString(brushDefinition.attribute(\"font\"));\n-    double spacing = brushDefinition.attribute(\"spacing\", \"1.0\").toDouble();\n+    double spacing = KisDomUtils::toDouble(brushDefinition.attribute(\"spacing\", \"1.0\"));\n     QString pipeMode = brushDefinition.attribute(\"pipe\", \"false\");\n     bool pipe = (pipeMode == \"true\") ? true : false;\n "}]}, {"sha": "c51dd6585857ff37602a729c366188cdba059be9", "stats": {"total": 9, "additions": 9, "deletions": 0}, "files": [{"sha": "14d4d13b7a4f07666e404ca9c083db3985c0f524", "filename": "libs/flake/tools/KoPanTool.cpp", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/c51dd6585857ff37602a729c366188cdba059be9/libs/flake/tools/KoPanTool.cpp", "raw_url": "https://github.com/KDE/krita/raw/c51dd6585857ff37602a729c366188cdba059be9/libs/flake/tools/KoPanTool.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/flake/tools/KoPanTool.cpp?ref=c51dd6585857ff37602a729c366188cdba059be9", "patch": "@@ -121,3 +121,9 @@ QPointF KoPanTool::documentToViewport(const QPointF &p)\n \n     return viewportPoint;\n }\n+\n+void KoPanTool::mouseDoubleClickEvent(KoPointerEvent *event)\n+{\n+    mousePressEvent(event);\n+}\n+"}, {"sha": "262aa2a03d6eabec0f5c19f27af091abc832098c", "filename": "libs/flake/tools/KoPanTool.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/c51dd6585857ff37602a729c366188cdba059be9/libs/flake/tools/KoPanTool.h", "raw_url": "https://github.com/KDE/krita/raw/c51dd6585857ff37602a729c366188cdba059be9/libs/flake/tools/KoPanTool.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/flake/tools/KoPanTool.h?ref=c51dd6585857ff37602a729c366188cdba059be9", "patch": "@@ -56,6 +56,9 @@ class KoPanTool : public KoToolBase\n     virtual void activate(ToolActivation toolActivation, const QSet<KoShape*> &shapes);\n     /// reimplemented method\n     virtual void customMoveEvent(KoPointerEvent *event);\n+    /// reimplemented method\n+    virtual void mouseDoubleClickEvent(KoPointerEvent *event);\n+\n \n     /// set the canvasController this tool works on.\n     void setCanvasController(KoCanvasController *controller) {"}]}, {"sha": "744eb906326a2568153af9cbdaac89b66444cae4", "stats": {"total": 54, "additions": 38, "deletions": 16}, "files": [{"sha": "996360b7954c6980e92cfe6718393e9868c62bf5", "filename": "libs/ui/canvas/kis_abstract_canvas_widget.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/744eb906326a2568153af9cbdaac89b66444cae4/libs/ui/canvas/kis_abstract_canvas_widget.h", "raw_url": "https://github.com/KDE/krita/raw/744eb906326a2568153af9cbdaac89b66444cae4/libs/ui/canvas/kis_abstract_canvas_widget.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/canvas/kis_abstract_canvas_widget.h?ref=744eb906326a2568153af9cbdaac89b66444cae4", "patch": "@@ -55,9 +55,9 @@ class KisAbstractCanvasWidget\n \n     virtual KisCanvasDecoration* decoration(const QString& id) const = 0;\n \n-    virtual void setDecorations(const QList<KisCanvasDecoration*> &) = 0;\n+    virtual void setDecorations(const QList<QPointer<KisCanvasDecoration>> &) = 0;\n \n-    virtual QList<KisCanvasDecoration*> decorations() const = 0;\n+    virtual QList<QPointer<KisCanvasDecoration>> decorations() const = 0;\n \n     /// set the specified display filter on the canvas\n     virtual void setDisplayFilter(KisDisplayFilter *displayFilter) = 0;"}, {"sha": "3b4c81d5972da2f6eaa603c68b283f58ea6b086e", "filename": "libs/ui/canvas/kis_canvas_widget_base.cpp", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/KDE/krita/blob/744eb906326a2568153af9cbdaac89b66444cae4/libs/ui/canvas/kis_canvas_widget_base.cpp", "raw_url": "https://github.com/KDE/krita/raw/744eb906326a2568153af9cbdaac89b66444cae4/libs/ui/canvas/kis_canvas_widget_base.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/canvas/kis_canvas_widget_base.cpp?ref=744eb906326a2568153af9cbdaac89b66444cae4", "patch": "@@ -52,7 +52,7 @@ struct KisCanvasWidgetBase::Private\n         , borderColor(Qt::gray)\n     {}\n \n-    QList<KisCanvasDecoration*> decorations;\n+    QList<QPointer<KisCanvasDecoration>> decorations;\n     KisCanvas2 * canvas;\n     KisCoordinatesConverter *coordinatesConverter;\n     const KoViewConverter * viewConverter;\n@@ -71,6 +71,14 @@ KisCanvasWidgetBase::KisCanvasWidgetBase(KisCanvas2 * canvas, KisCoordinatesConv\n \n KisCanvasWidgetBase::~KisCanvasWidgetBase()\n {\n+    /**\n+     * Clear all the attached decoration. Oherwise they might decide\n+     * to process some events or signals after the canvas has been\n+     * destroyed\n+     */\n+    qDeleteAll(m_d->decorations);\n+    m_d->decorations.clear();\n+\n     delete m_d;\n }\n \n@@ -154,20 +162,20 @@ void KisCanvasWidgetBase::addDecoration(KisCanvasDecoration* deco)\n \n KisCanvasDecoration* KisCanvasWidgetBase::decoration(const QString& id) const\n {\n-    Q_FOREACH (KisCanvasDecoration* deco, m_d->decorations) {\n+    Q_FOREACH (QPointer<KisCanvasDecoration> deco, m_d->decorations) {\n         if (deco->id() == id) {\n             return deco;\n         }\n     }\n     return 0;\n }\n \n-void KisCanvasWidgetBase::setDecorations(const QList<KisCanvasDecoration*> &decorations)\n+void KisCanvasWidgetBase::setDecorations(const QList<QPointer<KisCanvasDecoration> > &decorations)\n {\n     m_d->decorations=decorations;\n }\n \n-QList<KisCanvasDecoration*> KisCanvasWidgetBase::decorations() const\n+QList<QPointer<KisCanvasDecoration> > KisCanvasWidgetBase::decorations() const\n {\n     return m_d->decorations;\n }"}, {"sha": "c01f2c1ef9f8eb7341914ce5938e71b7076c6be4", "filename": "libs/ui/canvas/kis_canvas_widget_base.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/744eb906326a2568153af9cbdaac89b66444cae4/libs/ui/canvas/kis_canvas_widget_base.h", "raw_url": "https://github.com/KDE/krita/raw/744eb906326a2568153af9cbdaac89b66444cae4/libs/ui/canvas/kis_canvas_widget_base.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/canvas/kis_canvas_widget_base.h?ref=744eb906326a2568153af9cbdaac89b66444cae4", "patch": "@@ -58,8 +58,8 @@ class KRITAUI_EXPORT KisCanvasWidgetBase : public KisAbstractCanvasWidget\n     virtual void addDecoration(KisCanvasDecoration* deco);\n     virtual KisCanvasDecoration* decoration(const QString& id) const;\n \n-    virtual void setDecorations(const QList<KisCanvasDecoration*> &);\n-    virtual QList<KisCanvasDecoration*> decorations() const;\n+    virtual void setDecorations(const QList<QPointer<KisCanvasDecoration> > &);\n+    virtual QList<QPointer<KisCanvasDecoration> > decorations() const;\n \n     virtual void setWrapAroundViewingMode(bool value);\n "}, {"sha": "eaa9dcce9720eaf2b596e569408b1fdaf0d5a3f3", "filename": "libs/ui/canvas/kis_mirror_axis.cpp", "status": "modified", "additions": 21, "deletions": 8, "changes": 29, "blob_url": "https://github.com/KDE/krita/blob/744eb906326a2568153af9cbdaac89b66444cae4/libs/ui/canvas/kis_mirror_axis.cpp", "raw_url": "https://github.com/KDE/krita/raw/744eb906326a2568153af9cbdaac89b66444cae4/libs/ui/canvas/kis_mirror_axis.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/canvas/kis_mirror_axis.cpp?ref=744eb906326a2568153af9cbdaac89b66444cae4", "patch": "@@ -107,13 +107,6 @@ KisMirrorAxis::KisMirrorAxis(KisCanvasResourceProvider* provider, QPointer<KisVi\n     int imageHeight = parent->canvasBase()->image()->height();\n     QPointF point(imageWidth / 2, imageHeight / 2);\n     d->resourceProvider->resourceManager()->setResource(KisCanvasResourceProvider::MirrorAxesCenter, point);\n-\n-    parent->installEventFilter(this);\n-\n-    KisInputManager *inputManager = parent->canvasBase()->globalInputManager();\n-    if (inputManager) {\n-        inputManager->attachPriorityEventFilter(this);\n-    }\n }\n \n KisMirrorAxis::~KisMirrorAxis()\n@@ -223,7 +216,12 @@ void KisMirrorAxis::drawDecoration(QPainter& gc, const QRectF& updateArea, const\n \n bool KisMirrorAxis::eventFilter(QObject* target, QEvent* event)\n {\n-    if (!view() || target != view()->canvasBase()->canvasWidget()) return false;\n+    if (!visible()) return false;\n+\n+    QObject *expectedCanvasWidget = view() ?\n+        view()->canvasBase()->canvasWidget() : 0;\n+\n+    if (!expectedCanvasWidget || target != expectedCanvasWidget) return false;\n \n     if(event->type() == QEvent::MouseButtonPress || event->type() == QEvent::TabletPress) {\n         QMouseEvent *me = dynamic_cast<QMouseEvent*>(event);\n@@ -317,6 +315,21 @@ void KisMirrorAxis::mirrorModeChanged()\n     setVisible(d->mirrorHorizontal || d->mirrorVertical);\n }\n \n+void KisMirrorAxis::setVisible(bool v)\n+{\n+    KisCanvasDecoration::setVisible(v);\n+\n+\n+    KisInputManager *inputManager = view() ? view()->canvasBase()->globalInputManager() : 0;\n+    if (!inputManager) return;\n+\n+    if (v) {\n+        inputManager->attachPriorityEventFilter(this);\n+    } else {\n+        inputManager->detachPriorityEventFilter(this);\n+    }\n+}\n+\n void KisMirrorAxis::Private::setAxisPosition(float x, float y)\n {\n     QPointF newPosition = QPointF(x, y);"}, {"sha": "99eda39cf6a9c4e556b8f6b9260241ce61665782", "filename": "libs/ui/canvas/kis_mirror_axis.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/744eb906326a2568153af9cbdaac89b66444cae4/libs/ui/canvas/kis_mirror_axis.h", "raw_url": "https://github.com/KDE/krita/raw/744eb906326a2568153af9cbdaac89b66444cae4/libs/ui/canvas/kis_mirror_axis.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/canvas/kis_mirror_axis.h?ref=744eb906326a2568153af9cbdaac89b66444cae4", "patch": "@@ -36,6 +36,7 @@ class KisMirrorAxis : public KisCanvasDecoration\n \n     float handleSize() const;\n     void setHandleSize(float newSize);\n+    void setVisible(bool v);\n \n Q_SIGNALS:\n     void handleSizeChanged();"}]}, {"sha": "57cd2d5db851d4daa95c71e07d1ae0e3160f6c17", "stats": {"total": 3, "additions": 0, "deletions": 3}, "files": [{"sha": "4f0f52bad4cef21fcbbdaf9a59f87375ed9722b9", "filename": "libs/ui/KisMainWindow.cpp", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/57cd2d5db851d4daa95c71e07d1ae0e3160f6c17/libs/ui/KisMainWindow.cpp", "raw_url": "https://github.com/KDE/krita/raw/57cd2d5db851d4daa95c71e07d1ae0e3160f6c17/libs/ui/KisMainWindow.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisMainWindow.cpp?ref=57cd2d5db851d4daa95c71e07d1ae0e3160f6c17", "patch": "@@ -191,7 +191,6 @@ class Q_DECL_HIDDEN KisMainWindow::Private\n         , windowMenu(new KActionMenu(i18nc(\"@action:inmenu\", \"&Window\"), parent))\n         , documentMenu(new KActionMenu(i18nc(\"@action:inmenu\", \"New &View\"), parent))\n         , helpMenu(0)\n-        , brushesAndStuff(0)\n         , recentFiles(0)\n         , toolOptionsDocker(0)\n         , deferredClosingEvent(0)\n@@ -257,8 +256,6 @@ class Q_DECL_HIDDEN KisMainWindow::Private\n \n     KHelpMenu *helpMenu;\n \n-    KToolBar *brushesAndStuff;\n-\n     KRecentFilesAction *recentFiles;\n \n     QUrl lastExportUrl;"}]}, {"sha": "aefcb2677e1d04f63bcedde8a75e01a5ef52a437", "stats": {"total": 1464, "additions": 695, "deletions": 769}, "files": [{"sha": "b83218ced2a85cb18c9327f47b701da07aa2ca77", "filename": "plugins/dockers/advancedcolorselector/kis_color_selector_settings.cpp", "status": "modified", "additions": 17, "deletions": 27, "changes": 44, "blob_url": "https://github.com/KDE/krita/blob/aefcb2677e1d04f63bcedde8a75e01a5ef52a437/plugins/dockers/advancedcolorselector/kis_color_selector_settings.cpp", "raw_url": "https://github.com/KDE/krita/raw/aefcb2677e1d04f63bcedde8a75e01a5ef52a437/plugins/dockers/advancedcolorselector/kis_color_selector_settings.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/advancedcolorselector/kis_color_selector_settings.cpp?ref=aefcb2677e1d04f63bcedde8a75e01a5ef52a437", "patch": "@@ -43,12 +43,6 @@ KisColorSelectorSettings::KisColorSelectorSettings(QWidget *parent) :\n {\n     ui->setupUi(this);\n \n-    ui->lbl_lastUsedNumRows->hide();\n-    ui->lastUsedColorsNumRows->hide();\n-\n-    ui->lbl_commonColorsNumCols->hide();\n-    ui->commonColorsNumCols->hide();\n-    \n     resize(minimumSize());\n \n     ui->colorSelectorConfiguration->setColorSpace(ui->colorSpace->currentColorSpace());\n@@ -106,6 +100,10 @@ KisColorSelectorSettings::KisColorSelectorSettings(QWidget *parent) :\n     ui->commonColorsAlignVertical->setChecked(true);\n     ui->commonColorsAlignHorizontal->setChecked(true);\n     connect( ui->commonColorsAlignHorizontal, SIGNAL(toggled(bool)), this, SLOT(changedACSColorAlignment(bool)));\n+    connect( ui->lastUsedColorsAlignHorizontal, SIGNAL(toggled(bool)), this, SLOT(changedACSLastUsedColorAlignment(bool)));\n+\n+    changedACSColorAlignment(ui->commonColorsAlignHorizontal->isChecked());\n+    changedACSLastUsedColorAlignment(ui->lastUsedColorsAlignHorizontal->isChecked());\n \n \n     connect(ui->colorSpace,                 SIGNAL(colorSpaceChanged(const KoColorSpace*)),\n@@ -343,25 +341,23 @@ void KisColorSelectorSettings::changedACSColorAlignment(bool toggled)\n     // this slot is tied to the horizontal radio button's state being changed\n     // you can infer the vertical state\n \n-    if (toggled) {  // horizontal layout. show rows\n-        ui->lbl_commonColorsNumCols->hide();\n-        ui->commonColorsNumCols->hide();\n-\n-        ui->lbl_commonColorsNumRows->show();\n-        ui->commonColorsNumRows->show();\n-\n-    } else {\n-        ui->lbl_commonColorsNumCols->show();\n-        ui->commonColorsNumCols->show();\n-\n-        ui->lbl_commonColorsNumRows->hide();\n-        ui->commonColorsNumRows->hide();\n-\n-    }\n+    ui->lbl_commonColorsNumCols->setDisabled(toggled);\n+    ui->commonColorsNumCols->setDisabled(toggled);\n \n+    ui->lbl_commonColorsNumRows->setEnabled(toggled);\n+    ui->commonColorsNumRows->setEnabled(toggled);\n+}\n \n+void KisColorSelectorSettings::changedACSLastUsedColorAlignment(bool toggled)\n+{\n+    // this slot is tied to the horizontal radio button's state being changed\n+    // you can infer the vertical state\n \n+    ui->lbl_lastUsedNumCols->setDisabled(toggled);\n+    ui->lastUsedColorsNumCols->setDisabled(toggled);\n \n+    ui->lbl_lastUsedNumRows->setEnabled(toggled);\n+    ui->lastUsedColorsNumRows->setEnabled(toggled);\n }\n \n \n@@ -384,14 +380,8 @@ void KisColorSelectorSettings::changedACSShadeSelectorType(int index)\n         ui->myPaintColorModelLabel->hide();\n         ui->ACSshadeSelectorMyPaintColorModelComboBox->hide();\n     }\n-\n-\n-\n }\n \n-\n-\n-\n void KisColorSelectorSettings::useDifferentColorSpaceChecked(bool enabled)\n {\n     ui->colorSpace->setEnabled(enabled);"}, {"sha": "501fc9cc0691bc1b56302a24b0e1704d84c2fd64", "filename": "plugins/dockers/advancedcolorselector/kis_color_selector_settings.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/aefcb2677e1d04f63bcedde8a75e01a5ef52a437/plugins/dockers/advancedcolorselector/kis_color_selector_settings.h", "raw_url": "https://github.com/KDE/krita/raw/aefcb2677e1d04f63bcedde8a75e01a5ef52a437/plugins/dockers/advancedcolorselector/kis_color_selector_settings.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/advancedcolorselector/kis_color_selector_settings.h?ref=aefcb2677e1d04f63bcedde8a75e01a5ef52a437", "patch": "@@ -49,6 +49,7 @@ public Q_SLOTS:\n     void changedACSColorSelectorType(int);\n     void changedACSShadeSelectorType(int);\n     void changedACSColorAlignment(bool);\n+    void changedACSLastUsedColorAlignment(bool);\n \n Q_SIGNALS:\n     void settingsChanged() const;"}, {"sha": "e105b5a676d1d192eb4464084a27542fb6196c49", "filename": "plugins/dockers/advancedcolorselector/wdg_color_selector_settings.ui", "status": "modified", "additions": 677, "deletions": 742, "changes": 1419, "blob_url": "https://github.com/KDE/krita/blob/aefcb2677e1d04f63bcedde8a75e01a5ef52a437/plugins/dockers/advancedcolorselector/wdg_color_selector_settings.ui", "raw_url": "https://github.com/KDE/krita/raw/aefcb2677e1d04f63bcedde8a75e01a5ef52a437/plugins/dockers/advancedcolorselector/wdg_color_selector_settings.ui", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/advancedcolorselector/wdg_color_selector_settings.ui?ref=aefcb2677e1d04f63bcedde8a75e01a5ef52a437", "patch": "@@ -6,7 +6,7 @@\n    <rect>\n     <x>0</x>\n     <y>0</y>\n-    <width>618</width>\n+    <width>635</width>\n     <height>982</height>\n    </rect>\n   </property>\n@@ -71,7 +71,7 @@\n       </size>\n      </property>\n      <property name=\"currentIndex\">\n-      <number>0</number>\n+      <number>3</number>\n      </property>\n      <widget class=\"QWidget\" name=\"tab_typeshape\">\n       <attribute name=\"title\">\n@@ -81,7 +81,24 @@\n        <item>\n         <layout class=\"QHBoxLayout\" name=\"horizontalLayout_6\">\n          <item>\n-          <widget class=\"KisColorSelectorComboBox\" name=\"colorSelectorConfiguration\"/>\n+          <layout class=\"QVBoxLayout\" name=\"verticalLayout_5\">\n+           <item>\n+            <widget class=\"KisColorSelectorComboBox\" name=\"colorSelectorConfiguration\"/>\n+           </item>\n+           <item>\n+            <spacer name=\"verticalSpacer_2\">\n+             <property name=\"orientation\">\n+              <enum>Qt::Vertical</enum>\n+             </property>\n+             <property name=\"sizeHint\" stdset=\"0\">\n+              <size>\n+               <width>20</width>\n+               <height>40</height>\n+              </size>\n+             </property>\n+            </spacer>\n+           </item>\n+          </layout>\n          </item>\n          <item>\n           <layout class=\"QVBoxLayout\" name=\"verticalLayout_2\">\n@@ -107,7 +124,7 @@\n            <item>\n             <widget class=\"QLabel\" name=\"ACSTypeDescriptionLabel\">\n              <property name=\"sizePolicy\">\n-              <sizepolicy hsizetype=\"Fixed\" vsizetype=\"Fixed\">\n+              <sizepolicy hsizetype=\"Expanding\" vsizetype=\"Expanding\">\n                <horstretch>0</horstretch>\n                <verstretch>0</verstretch>\n               </sizepolicy>\n@@ -392,272 +409,291 @@\n        </item>\n       </layout>\n      </widget>\n-     <widget class=\"QWidget\" name=\"tab_2\">\n+     <widget class=\"QWidget\" name=\"tabShadeSelector\">\n       <attribute name=\"title\">\n        <string>Shade Selector</string>\n       </attribute>\n-      <widget class=\"QLabel\" name=\"label_7\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>320</x>\n-         <y>20</y>\n-         <width>201</width>\n-         <height>21</height>\n-        </rect>\n-       </property>\n-       <property name=\"text\">\n-        <string>Update Selector When:</string>\n-       </property>\n-      </widget>\n-      <widget class=\"QCheckBox\" name=\"shadeSelectorUpdateOnRightClick\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>320</x>\n-         <y>40</y>\n-         <width>271</width>\n-         <height>22</height>\n-        </rect>\n-       </property>\n-       <property name=\"text\">\n-        <string>Right clicking on shade selector</string>\n-       </property>\n-      </widget>\n-      <widget class=\"QCheckBox\" name=\"shadeSelectorUpdateOnLeftClick\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>320</x>\n-         <y>60</y>\n-         <width>321</width>\n-         <height>22</height>\n-        </rect>\n-       </property>\n-       <property name=\"text\">\n-        <string>Left clicking on shade selector</string>\n-       </property>\n-      </widget>\n-      <widget class=\"QCheckBox\" name=\"shadeSelectorUpdateOnForeground\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>320</x>\n-         <y>80</y>\n-         <width>281</width>\n-         <height>22</height>\n-        </rect>\n-       </property>\n-       <property name=\"toolTip\">\n-        <string>this doesn't include a color change by the shade selector</string>\n-       </property>\n-       <property name=\"text\">\n-        <string>Foreground color changes</string>\n-       </property>\n-       <property name=\"checked\">\n-        <bool>false</bool>\n-       </property>\n-      </widget>\n-      <widget class=\"QCheckBox\" name=\"shadeSelectorUpdateOnBackground\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>320</x>\n-         <y>100</y>\n-         <width>311</width>\n-         <height>22</height>\n-        </rect>\n-       </property>\n-       <property name=\"toolTip\">\n-        <string>this doesn't include a color change by the shade selector</string>\n-       </property>\n-       <property name=\"text\">\n-        <string>Background color change</string>\n-       </property>\n-       <property name=\"checked\">\n-        <bool>true</bool>\n-       </property>\n-      </widget>\n-      <widget class=\"QLabel\" name=\"myPaintColorModelLabel\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>190</x>\n-         <y>20</y>\n-         <width>91</width>\n-         <height>21</height>\n-        </rect>\n-       </property>\n-       <property name=\"text\">\n-        <string>Color model:</string>\n-       </property>\n-      </widget>\n-      <widget class=\"QGroupBox\" name=\"minimalShadeSelectorGroup\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>20</x>\n-         <y>150</y>\n-         <width>531</width>\n-         <height>171</height>\n-        </rect>\n-       </property>\n-       <property name=\"title\">\n-        <string>Minimal Shade Selector</string>\n-       </property>\n-       <widget class=\"QLabel\" name=\"label_15\">\n-        <property name=\"geometry\">\n-         <rect>\n-          <x>10</x>\n-          <y>40</y>\n-          <width>51</width>\n-          <height>21</height>\n-         </rect>\n-        </property>\n-        <property name=\"text\">\n-         <string>Display:</string>\n-        </property>\n-       </widget>\n-       <widget class=\"KisShadeSelectorLinesSettings\" name=\"minimalShadeSelectorLineSettings\">\n-        <property name=\"geometry\">\n-         <rect>\n-          <x>10</x>\n-          <y>60</y>\n-          <width>291</width>\n-          <height>101</height>\n-         </rect>\n-        </property>\n-       </widget>\n-       <widget class=\"QRadioButton\" name=\"minimalShadeSelectorAsGradient\">\n-        <property name=\"geometry\">\n-         <rect>\n-          <x>70</x>\n-          <y>40</y>\n-          <width>91</width>\n-          <height>21</height>\n-         </rect>\n-        </property>\n-        <property name=\"text\">\n-         <string>Gradient</string>\n-        </property>\n-       </widget>\n-       <widget class=\"QRadioButton\" name=\"minimalShadeSelectorAsColorPatches\">\n-        <property name=\"geometry\">\n-         <rect>\n-          <x>180</x>\n-          <y>40</y>\n-          <width>121</width>\n-          <height>22</height>\n-         </rect>\n-        </property>\n-        <property name=\"text\">\n-         <string>Color Patches</string>\n-        </property>\n-       </widget>\n-       <widget class=\"QWidget\" name=\"gridLayoutWidget\">\n-        <property name=\"geometry\">\n-         <rect>\n-          <x>320</x>\n-          <y>60</y>\n-          <width>196</width>\n-          <height>115</height>\n-         </rect>\n-        </property>\n-        <layout class=\"QGridLayout\" name=\"gridLayout_3\">\n-         <property name=\"spacing\">\n-          <number>10</number>\n-         </property>\n-         <item row=\"1\" column=\"1\">\n-          <widget class=\"QSpinBox\" name=\"minimalShadeSelectorLineHeight\">\n-           <property name=\"suffix\">\n-            <string> px</string>\n-           </property>\n-           <property name=\"minimum\">\n-            <number>8</number>\n-           </property>\n-           <property name=\"maximum\">\n-            <number>99</number>\n-           </property>\n-           <property name=\"value\">\n-            <number>16</number>\n-           </property>\n-          </widget>\n-         </item>\n-         <item row=\"1\" column=\"0\">\n-          <widget class=\"QLabel\" name=\"label_6\">\n-           <property name=\"text\">\n-            <string>Line Height: </string>\n-           </property>\n-           <property name=\"alignment\">\n-            <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-           </property>\n-          </widget>\n-         </item>\n-         <item row=\"0\" column=\"1\">\n-          <widget class=\"QSpinBox\" name=\"minimalShadeSelectorLineCount\">\n-           <property name=\"minimum\">\n-            <number>1</number>\n-           </property>\n-           <property name=\"maximum\">\n-            <number>10</number>\n-           </property>\n-           <property name=\"value\">\n-            <number>3</number>\n-           </property>\n-          </widget>\n+      <layout class=\"QVBoxLayout\" name=\"verticalLayout_9\">\n+       <item>\n+        <layout class=\"QHBoxLayout\" name=\"horizontalLayout_11\">\n+         <item>\n+          <layout class=\"QVBoxLayout\" name=\"verticalLayout_8\">\n+           <item>\n+            <layout class=\"QGridLayout\" name=\"gridLayout_3\">\n+             <item row=\"0\" column=\"0\">\n+              <widget class=\"QLabel\" name=\"label_16\">\n+               <property name=\"text\">\n+                <string>Type:</string>\n+               </property>\n+              </widget>\n+             </item>\n+             <item row=\"0\" column=\"1\">\n+              <widget class=\"QLabel\" name=\"myPaintColorModelLabel\">\n+               <property name=\"text\">\n+                <string>Color model:</string>\n+               </property>\n+              </widget>\n+             </item>\n+             <item row=\"1\" column=\"1\">\n+              <widget class=\"QComboBox\" name=\"ACSshadeSelectorMyPaintColorModelComboBox\"/>\n+             </item>\n+             <item row=\"1\" column=\"0\">\n+              <widget class=\"QComboBox\" name=\"ACSShadeSelectorTypeComboBox\"/>\n+             </item>\n+            </layout>\n+           </item>\n+           <item>\n+            <spacer name=\"verticalSpacer_4\">\n+             <property name=\"orientation\">\n+              <enum>Qt::Vertical</enum>\n+             </property>\n+             <property name=\"sizeHint\" stdset=\"0\">\n+              <size>\n+               <width>20</width>\n+               <height>10</height>\n+              </size>\n+             </property>\n+            </spacer>\n+           </item>\n+          </layout>\n          </item>\n-         <item row=\"0\" column=\"0\">\n-          <widget class=\"QLabel\" name=\"label_2\">\n-           <property name=\"text\">\n-            <string>Line Count: </string>\n+         <item>\n+          <spacer name=\"horizontalSpacer_5\">\n+           <property name=\"orientation\">\n+            <enum>Qt::Horizontal</enum>\n            </property>\n-           <property name=\"alignment\">\n-            <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+           <property name=\"sizeHint\" stdset=\"0\">\n+            <size>\n+             <width>20</width>\n+             <height>20</height>\n+            </size>\n            </property>\n-          </widget>\n+          </spacer>\n          </item>\n-         <item row=\"2\" column=\"0\">\n-          <widget class=\"QLabel\" name=\"patchesPerLineLabel\">\n-           <property name=\"text\">\n-            <string>Patches Per Line: </string>\n-           </property>\n-           <property name=\"alignment\">\n-            <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+         <item>\n+          <layout class=\"QVBoxLayout\" name=\"verticalLayout_7\">\n+           <property name=\"spacing\">\n+            <number>0</number>\n            </property>\n-          </widget>\n-         </item>\n-         <item row=\"2\" column=\"1\">\n-          <widget class=\"QSpinBox\" name=\"minimalShadeSelectorPatchesPerLine\"/>\n+           <item>\n+            <widget class=\"QLabel\" name=\"label_7\">\n+             <property name=\"text\">\n+              <string>Update Selector When:</string>\n+             </property>\n+            </widget>\n+           </item>\n+           <item>\n+            <spacer name=\"verticalSpacer_3\">\n+             <property name=\"orientation\">\n+              <enum>Qt::Vertical</enum>\n+             </property>\n+             <property name=\"sizeHint\" stdset=\"0\">\n+              <size>\n+               <width>20</width>\n+               <height>6</height>\n+              </size>\n+             </property>\n+            </spacer>\n+           </item>\n+           <item>\n+            <widget class=\"QCheckBox\" name=\"shadeSelectorUpdateOnRightClick\">\n+             <property name=\"text\">\n+              <string>Right clicking on shade selector</string>\n+             </property>\n+            </widget>\n+           </item>\n+           <item>\n+            <widget class=\"QCheckBox\" name=\"shadeSelectorUpdateOnLeftClick\">\n+             <property name=\"text\">\n+              <string>Left clicking on shade selector</string>\n+             </property>\n+            </widget>\n+           </item>\n+           <item>\n+            <widget class=\"QCheckBox\" name=\"shadeSelectorUpdateOnForeground\">\n+             <property name=\"toolTip\">\n+              <string>this doesn't include a color change by the shade selector</string>\n+             </property>\n+             <property name=\"text\">\n+              <string>Foreground color changes</string>\n+             </property>\n+             <property name=\"checked\">\n+              <bool>false</bool>\n+             </property>\n+            </widget>\n+           </item>\n+           <item>\n+            <widget class=\"QCheckBox\" name=\"shadeSelectorUpdateOnBackground\">\n+             <property name=\"toolTip\">\n+              <string>this doesn't include a color change by the shade selector</string>\n+             </property>\n+             <property name=\"text\">\n+              <string>Background color change</string>\n+             </property>\n+             <property name=\"checked\">\n+              <bool>true</bool>\n+             </property>\n+            </widget>\n+           </item>\n+          </layout>\n          </item>\n         </layout>\n-       </widget>\n-      </widget>\n-      <widget class=\"QComboBox\" name=\"ACSshadeSelectorMyPaintColorModelComboBox\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>190</x>\n-         <y>40</y>\n-         <width>91</width>\n-         <height>31</height>\n-        </rect>\n-       </property>\n-      </widget>\n-      <widget class=\"QComboBox\" name=\"ACSShadeSelectorTypeComboBox\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>10</x>\n-         <y>40</y>\n-         <width>161</width>\n-         <height>27</height>\n-        </rect>\n-       </property>\n-      </widget>\n-      <widget class=\"QLabel\" name=\"label_16\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>10</x>\n-         <y>20</y>\n-         <width>41</width>\n-         <height>21</height>\n-        </rect>\n-       </property>\n-       <property name=\"text\">\n-        <string>Type:</string>\n-       </property>\n-      </widget>\n+       </item>\n+       <item>\n+        <spacer name=\"verticalSpacer_5\">\n+         <property name=\"orientation\">\n+          <enum>Qt::Vertical</enum>\n+         </property>\n+         <property name=\"sizeHint\" stdset=\"0\">\n+          <size>\n+           <width>20</width>\n+           <height>109</height>\n+          </size>\n+         </property>\n+        </spacer>\n+       </item>\n+       <item>\n+        <widget class=\"QGroupBox\" name=\"minimalShadeSelectorGroup\">\n+         <property name=\"title\">\n+          <string>Minimal Shade Selector</string>\n+         </property>\n+         <layout class=\"QHBoxLayout\" name=\"horizontalLayout_10\">\n+          <item>\n+           <layout class=\"QVBoxLayout\" name=\"verticalLayout_6\">\n+            <item>\n+             <layout class=\"QHBoxLayout\" name=\"horizontalLayout_9\">\n+              <item>\n+               <widget class=\"QLabel\" name=\"label_15\">\n+                <property name=\"text\">\n+                 <string>Display:</string>\n+                </property>\n+               </widget>\n+              </item>\n+              <item>\n+               <widget class=\"QRadioButton\" name=\"minimalShadeSelectorAsGradient\">\n+                <property name=\"text\">\n+                 <string>Gradient</string>\n+                </property>\n+               </widget>\n+              </item>\n+              <item>\n+               <widget class=\"QRadioButton\" name=\"minimalShadeSelectorAsColorPatches\">\n+                <property name=\"text\">\n+                 <string>Color Patches</string>\n+                </property>\n+               </widget>\n+              </item>\n+             </layout>\n+            </item>\n+            <item>\n+             <widget class=\"KisShadeSelectorLinesSettings\" name=\"minimalShadeSelectorLineSettings\">\n+              <property name=\"sizePolicy\">\n+               <sizepolicy hsizetype=\"Preferred\" vsizetype=\"MinimumExpanding\">\n+                <horstretch>0</horstretch>\n+                <verstretch>0</verstretch>\n+               </sizepolicy>\n+              </property>\n+             </widget>\n+            </item>\n+           </layout>\n+          </item>\n+          <item>\n+           <spacer name=\"horizontalSpacer_4\">\n+            <property name=\"orientation\">\n+             <enum>Qt::Horizontal</enum>\n+            </property>\n+            <property name=\"sizeHint\" stdset=\"0\">\n+             <size>\n+              <width>59</width>\n+              <height>20</height>\n+             </size>\n+            </property>\n+           </spacer>\n+          </item>\n+          <item>\n+           <layout class=\"QFormLayout\" name=\"formLayout_3\">\n+            <item row=\"0\" column=\"0\">\n+             <widget class=\"QLabel\" name=\"label_2\">\n+              <property name=\"text\">\n+               <string>Line Count: </string>\n+              </property>\n+              <property name=\"alignment\">\n+               <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+              </property>\n+             </widget>\n+            </item>\n+            <item row=\"0\" column=\"1\">\n+             <widget class=\"QSpinBox\" name=\"minimalShadeSelectorLineCount\">\n+              <property name=\"minimum\">\n+               <number>1</number>\n+              </property>\n+              <property name=\"maximum\">\n+               <number>10</number>\n+              </property>\n+              <property name=\"value\">\n+               <number>3</number>\n+              </property>\n+             </widget>\n+            </item>\n+            <item row=\"1\" column=\"0\">\n+             <widget class=\"QLabel\" name=\"label_6\">\n+              <property name=\"text\">\n+               <string>Line Height: </string>\n+              </property>\n+              <property name=\"alignment\">\n+               <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+              </property>\n+             </widget>\n+            </item>\n+            <item row=\"1\" column=\"1\">\n+             <widget class=\"QSpinBox\" name=\"minimalShadeSelectorLineHeight\">\n+              <property name=\"suffix\">\n+               <string> px</string>\n+              </property>\n+              <property name=\"minimum\">\n+               <number>8</number>\n+              </property>\n+              <property name=\"maximum\">\n+               <number>99</number>\n+              </property>\n+              <property name=\"value\">\n+               <number>16</number>\n+              </property>\n+             </widget>\n+            </item>\n+            <item row=\"2\" column=\"0\">\n+             <widget class=\"QLabel\" name=\"patchesPerLineLabel\">\n+              <property name=\"text\">\n+               <string>Patches Per Line: </string>\n+              </property>\n+              <property name=\"alignment\">\n+               <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+              </property>\n+             </widget>\n+            </item>\n+            <item row=\"2\" column=\"1\">\n+             <widget class=\"QSpinBox\" name=\"minimalShadeSelectorPatchesPerLine\"/>\n+            </item>\n+           </layout>\n+          </item>\n+         </layout>\n+        </widget>\n+       </item>\n+      </layout>\n+      <zorder>label_7</zorder>\n+      <zorder>shadeSelectorUpdateOnRightClick</zorder>\n+      <zorder>shadeSelectorUpdateOnLeftClick</zorder>\n+      <zorder>shadeSelectorUpdateOnForeground</zorder>\n+      <zorder>shadeSelectorUpdateOnBackground</zorder>\n+      <zorder>myPaintColorModelLabel</zorder>\n+      <zorder>minimalShadeSelectorGroup</zorder>\n+      <zorder>ACSshadeSelectorMyPaintColorModelComboBox</zorder>\n+      <zorder>ACSShadeSelectorTypeComboBox</zorder>\n+      <zorder>label_16</zorder>\n+      <zorder>verticalSpacer_3</zorder>\n+      <zorder></zorder>\n+      <zorder>verticalSpacer_4</zorder>\n+      <zorder>verticalSpacer_5</zorder>\n      </widget>\n      <widget class=\"QWidget\" name=\"tab_ColorHistory\">\n       <property name=\"enabled\">\n@@ -672,125 +708,358 @@\n       <attribute name=\"title\">\n        <string>Color History</string>\n       </attribute>\n-      <widget class=\"QGroupBox\" name=\"lastUsedColorsShow\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>10</x>\n-         <y>10</y>\n-         <width>466</width>\n-         <height>205</height>\n-        </rect>\n-       </property>\n-       <property name=\"sizePolicy\">\n-        <sizepolicy hsizetype=\"Fixed\" vsizetype=\"Fixed\">\n-         <horstretch>0</horstretch>\n-         <verstretch>0</verstretch>\n-        </sizepolicy>\n-       </property>\n-       <property name=\"title\">\n-        <string>Show Color History</string>\n-       </property>\n-       <property name=\"checkable\">\n-        <bool>true</bool>\n-       </property>\n-       <layout class=\"QFormLayout\" name=\"formLayout_2\">\n-        <item row=\"0\" column=\"0\">\n-         <layout class=\"QHBoxLayout\" name=\"horizontalLayout_7\">\n+      <layout class=\"QVBoxLayout\" name=\"verticalLayout_11\">\n+       <item>\n+        <widget class=\"QGroupBox\" name=\"lastUsedColorsShow\">\n+         <property name=\"sizePolicy\">\n+          <sizepolicy hsizetype=\"MinimumExpanding\" vsizetype=\"MinimumExpanding\">\n+           <horstretch>0</horstretch>\n+           <verstretch>0</verstretch>\n+          </sizepolicy>\n+         </property>\n+         <property name=\"title\">\n+          <string>Show Color History</string>\n+         </property>\n+         <property name=\"checkable\">\n+          <bool>true</bool>\n+         </property>\n+         <layout class=\"QVBoxLayout\" name=\"verticalLayout_12\">\n           <item>\n-           <widget class=\"QGroupBox\" name=\"groupBox\">\n-            <property name=\"title\">\n-             <string>Patch Options</string>\n-            </property>\n-            <layout class=\"QGridLayout\" name=\"gridLayout_6\">\n-             <item row=\"0\" column=\"0\">\n-              <widget class=\"QLabel\" name=\"label_14\">\n-               <property name=\"text\">\n-                <string>Height:</string>\n-               </property>\n-               <property name=\"alignment\">\n-                <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-               </property>\n-              </widget>\n-             </item>\n-             <item row=\"0\" column=\"1\">\n-              <widget class=\"QSpinBox\" name=\"lastUsedColorsWidth\">\n-               <property name=\"suffix\">\n-                <string> px</string>\n-               </property>\n-               <property name=\"prefix\">\n-                <string/>\n-               </property>\n-               <property name=\"minimum\">\n-                <number>16</number>\n-               </property>\n-              </widget>\n-             </item>\n-             <item row=\"1\" column=\"0\">\n-              <widget class=\"QLabel\" name=\"label\">\n-               <property name=\"text\">\n-                <string>Width: </string>\n-               </property>\n-               <property name=\"alignment\">\n-                <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-               </property>\n-              </widget>\n-             </item>\n-             <item row=\"1\" column=\"1\">\n-              <widget class=\"QSpinBox\" name=\"lastUsedColorsHeight\">\n-               <property name=\"suffix\">\n-                <string> px</string>\n-               </property>\n-               <property name=\"minimum\">\n-                <number>16</number>\n-               </property>\n-              </widget>\n-             </item>\n-             <item row=\"2\" column=\"0\">\n-              <widget class=\"QLabel\" name=\"label_10\">\n-               <property name=\"text\">\n-                <string>Max Patches: </string>\n-               </property>\n-               <property name=\"alignment\">\n-                <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+           <layout class=\"QHBoxLayout\" name=\"horizontalLayout_7\">\n+            <item>\n+             <widget class=\"QGroupBox\" name=\"groupBox\">\n+              <property name=\"title\">\n+               <string>Patch Options</string>\n+              </property>\n+              <layout class=\"QFormLayout\" name=\"formLayout_4\">\n+               <item row=\"0\" column=\"0\">\n+                <widget class=\"QLabel\" name=\"label_14\">\n+                 <property name=\"text\">\n+                  <string>Height:</string>\n+                 </property>\n+                 <property name=\"alignment\">\n+                  <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"0\" column=\"1\">\n+                <widget class=\"QSpinBox\" name=\"lastUsedColorsWidth\">\n+                 <property name=\"suffix\">\n+                  <string> px</string>\n+                 </property>\n+                 <property name=\"prefix\">\n+                  <string/>\n+                 </property>\n+                 <property name=\"minimum\">\n+                  <number>16</number>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"1\" column=\"0\">\n+                <widget class=\"QLabel\" name=\"label\">\n+                 <property name=\"text\">\n+                  <string>Width: </string>\n+                 </property>\n+                 <property name=\"alignment\">\n+                  <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"1\" column=\"1\">\n+                <widget class=\"QSpinBox\" name=\"lastUsedColorsHeight\">\n+                 <property name=\"suffix\">\n+                  <string> px</string>\n+                 </property>\n+                 <property name=\"minimum\">\n+                  <number>16</number>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"2\" column=\"0\">\n+                <widget class=\"QLabel\" name=\"label_10\">\n+                 <property name=\"text\">\n+                  <string>Max Patches: </string>\n+                 </property>\n+                 <property name=\"alignment\">\n+                  <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"2\" column=\"1\">\n+                <widget class=\"QSpinBox\" name=\"lastUsedColorsPatchCount\">\n+                 <property name=\"minimum\">\n+                  <number>1</number>\n+                 </property>\n+                 <property name=\"value\">\n+                  <number>30</number>\n+                 </property>\n+                </widget>\n+               </item>\n+              </layout>\n+             </widget>\n+            </item>\n+            <item>\n+             <spacer name=\"horizontalSpacer_6\">\n+              <property name=\"orientation\">\n+               <enum>Qt::Horizontal</enum>\n+              </property>\n+              <property name=\"sizeHint\" stdset=\"0\">\n+               <size>\n+                <width>40</width>\n+                <height>20</height>\n+               </size>\n+              </property>\n+             </spacer>\n+            </item>\n+            <item>\n+             <widget class=\"QGroupBox\" name=\"groupBox_2\">\n+              <property name=\"title\">\n+               <string>Layout</string>\n+              </property>\n+              <layout class=\"QGridLayout\" name=\"gridLayout\">\n+               <property name=\"verticalSpacing\">\n+                <number>0</number>\n                </property>\n-              </widget>\n-             </item>\n-             <item row=\"2\" column=\"1\">\n-              <widget class=\"QSpinBox\" name=\"lastUsedColorsPatchCount\">\n-               <property name=\"minimum\">\n-                <number>1</number>\n+               <item row=\"0\" column=\"0\">\n+                <widget class=\"QRadioButton\" name=\"lastUsedColorsAlignVertical\">\n+                 <property name=\"text\">\n+                  <string>Vertical</string>\n+                 </property>\n+                 <property name=\"checked\">\n+                  <bool>true</bool>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"0\" column=\"1\">\n+                <widget class=\"QLabel\" name=\"lbl_lastUsedNumCols\">\n+                 <property name=\"text\">\n+                  <string>Columns:</string>\n+                 </property>\n+                 <property name=\"alignment\">\n+                  <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+                 </property>\n+                 <property name=\"buddy\">\n+                  <cstring>lastUsedColorsNumCols</cstring>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"0\" column=\"2\">\n+                <widget class=\"QSpinBox\" name=\"lastUsedColorsNumCols\">\n+                 <property name=\"minimum\">\n+                  <number>1</number>\n+                 </property>\n+                 <property name=\"maximum\">\n+                  <number>20</number>\n+                 </property>\n+                 <property name=\"value\">\n+                  <number>2</number>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"1\" column=\"0\">\n+                <widget class=\"QRadioButton\" name=\"lastUsedColorsAlignHorizontal\">\n+                 <property name=\"text\">\n+                  <string>Horizontal</string>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"1\" column=\"1\">\n+                <widget class=\"QLabel\" name=\"lbl_lastUsedNumRows\">\n+                 <property name=\"text\">\n+                  <string>Rows:</string>\n+                 </property>\n+                 <property name=\"alignment\">\n+                  <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+                 </property>\n+                 <property name=\"buddy\">\n+                  <cstring>lastUsedColorsNumRows</cstring>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"1\" column=\"2\">\n+                <widget class=\"QSpinBox\" name=\"lastUsedColorsNumRows\">\n+                 <property name=\"minimum\">\n+                  <number>1</number>\n+                 </property>\n+                 <property name=\"maximum\">\n+                  <number>20</number>\n+                 </property>\n+                 <property name=\"value\">\n+                  <number>3</number>\n+                 </property>\n+                </widget>\n+               </item>\n+              </layout>\n+             </widget>\n+            </item>\n+           </layout>\n+          </item>\n+          <item>\n+           <widget class=\"QCheckBox\" name=\"lastUsedColorsAllowScrolling\">\n+            <property name=\"text\">\n+             <string>Allow scrolling</string>\n+            </property>\n+            <property name=\"checked\">\n+             <bool>true</bool>\n+            </property>\n+           </widget>\n+          </item>\n+         </layout>\n+        </widget>\n+       </item>\n+       <item>\n+        <spacer name=\"verticalSpacer_6\">\n+         <property name=\"orientation\">\n+          <enum>Qt::Vertical</enum>\n+         </property>\n+         <property name=\"sizeHint\" stdset=\"0\">\n+          <size>\n+           <width>20</width>\n+           <height>40</height>\n+          </size>\n+         </property>\n+        </spacer>\n+       </item>\n+      </layout>\n+     </widget>\n+     <widget class=\"QWidget\" name=\"tab_colorsFromImage\">\n+      <attribute name=\"title\">\n+       <string>Colors from Image</string>\n+      </attribute>\n+      <layout class=\"QVBoxLayout\" name=\"verticalLayout_14\">\n+       <item>\n+        <widget class=\"QGroupBox\" name=\"commonColorsShow\">\n+         <property name=\"enabled\">\n+          <bool>true</bool>\n+         </property>\n+         <property name=\"title\">\n+          <string>Show Colors from the image</string>\n+         </property>\n+         <property name=\"checkable\">\n+          <bool>true</bool>\n+         </property>\n+         <layout class=\"QVBoxLayout\" name=\"verticalLayout_13\">\n+          <item>\n+           <layout class=\"QHBoxLayout\" name=\"horizontalLayout_8\">\n+            <item>\n+             <widget class=\"QGroupBox\" name=\"groupBox_3\">\n+              <property name=\"title\">\n+               <string>Patch Options</string>\n+              </property>\n+              <layout class=\"QFormLayout\" name=\"formLayout_2\">\n+               <item row=\"0\" column=\"0\">\n+                <widget class=\"QLabel\" name=\"label_12\">\n+                 <property name=\"text\">\n+                  <string>Height:</string>\n+                 </property>\n+                 <property name=\"alignment\">\n+                  <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"0\" column=\"1\">\n+                <widget class=\"QSpinBox\" name=\"commonColorsWidth\">\n+                 <property name=\"suffix\">\n+                  <string> px</string>\n+                 </property>\n+                 <property name=\"prefix\">\n+                  <string/>\n+                 </property>\n+                 <property name=\"minimum\">\n+                  <number>16</number>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"1\" column=\"0\">\n+                <widget class=\"QLabel\" name=\"label_4\">\n+                 <property name=\"text\">\n+                  <string>Width:</string>\n+                 </property>\n+                 <property name=\"alignment\">\n+                  <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"1\" column=\"1\">\n+                <widget class=\"QSpinBox\" name=\"commonColorsHeight\">\n+                 <property name=\"suffix\">\n+                  <string> px</string>\n+                 </property>\n+                 <property name=\"minimum\">\n+                  <number>16</number>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"2\" column=\"0\">\n+                <widget class=\"QLabel\" name=\"label_9\">\n+                 <property name=\"text\">\n+                  <string>Max Patches: </string>\n+                 </property>\n+                 <property name=\"alignment\">\n+                  <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"2\" column=\"1\">\n+                <widget class=\"QSpinBox\" name=\"commonColorsPatchCount\">\n+                 <property name=\"minimum\">\n+                  <number>1</number>\n+                 </property>\n+                 <property name=\"value\">\n+                  <number>30</number>\n+                 </property>\n+                </widget>\n+               </item>\n+              </layout>\n+             </widget>\n+            </item>\n+            <item>\n+             <spacer name=\"horizontalSpacer_7\">\n+              <property name=\"orientation\">\n+               <enum>Qt::Horizontal</enum>\n+              </property>\n+              <property name=\"sizeHint\" stdset=\"0\">\n+               <size>\n+                <width>40</width>\n+                <height>20</height>\n+               </size>\n+              </property>\n+             </spacer>\n+            </item>\n+            <item>\n+             <widget class=\"QGroupBox\" name=\"groupBox_4\">\n+              <property name=\"title\">\n+               <string>Layout</string>\n+              </property>\n+              <layout class=\"QGridLayout\" name=\"gridLayout_2\">\n+               <property name=\"horizontalSpacing\">\n+                <number>6</number>\n                </property>\n-               <property name=\"value\">\n-                <number>30</number>\n+               <property name=\"verticalSpacing\">\n+                <number>0</number>\n                </property>\n-              </widget>\n-             </item>\n-            </layout>\n-           </widget>\n-          </item>\n-          <item>\n-           <widget class=\"QGroupBox\" name=\"groupBox_2\">\n-            <property name=\"title\">\n-             <string>Layout</string>\n-            </property>\n-            <layout class=\"QGridLayout\" name=\"gridLayout_4\">\n-             <item row=\"0\" column=\"0\">\n-              <layout class=\"QGridLayout\" name=\"gridLayout\">\n+               <item row=\"0\" column=\"0\">\n+                <widget class=\"QRadioButton\" name=\"commonColorsAlignVertical\">\n+                 <property name=\"text\">\n+                  <string>Vertical</string>\n+                 </property>\n+                </widget>\n+               </item>\n                <item row=\"0\" column=\"1\">\n-                <widget class=\"QLabel\" name=\"lbl_lastUsedNumCols\">\n+                <widget class=\"QLabel\" name=\"lbl_commonColorsNumCols\">\n                  <property name=\"text\">\n                   <string>Columns:</string>\n                  </property>\n                  <property name=\"alignment\">\n                   <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n                  </property>\n                  <property name=\"buddy\">\n-                  <cstring>lastUsedColorsNumCols</cstring>\n+                  <cstring>commonColorsNumCols</cstring>\n                  </property>\n                 </widget>\n                </item>\n                <item row=\"0\" column=\"2\">\n-                <widget class=\"QSpinBox\" name=\"lastUsedColorsNumCols\">\n+                <widget class=\"QSpinBox\" name=\"commonColorsNumCols\">\n                  <property name=\"minimum\">\n                   <number>1</number>\n                  </property>\n@@ -802,38 +1071,31 @@\n                  </property>\n                 </widget>\n                </item>\n-               <item row=\"0\" column=\"0\">\n-                <widget class=\"QRadioButton\" name=\"lastUsedColorsAlignVertical\">\n+               <item row=\"1\" column=\"0\">\n+                <widget class=\"QRadioButton\" name=\"commonColorsAlignHorizontal\">\n                  <property name=\"text\">\n-                  <string>Vertical</string>\n+                  <string>Horizontal</string>\n                  </property>\n                  <property name=\"checked\">\n                   <bool>true</bool>\n                  </property>\n                 </widget>\n                </item>\n-               <item row=\"1\" column=\"0\">\n-                <widget class=\"QRadioButton\" name=\"lastUsedColorsAlignHorizontal\">\n-                 <property name=\"text\">\n-                  <string>Horizontal</string>\n-                 </property>\n-                </widget>\n-               </item>\n                <item row=\"1\" column=\"1\">\n-                <widget class=\"QLabel\" name=\"lbl_lastUsedNumRows\">\n+                <widget class=\"QLabel\" name=\"lbl_commonColorsNumRows\">\n                  <property name=\"text\">\n                   <string>Rows:</string>\n                  </property>\n                  <property name=\"alignment\">\n                   <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n                  </property>\n                  <property name=\"buddy\">\n-                  <cstring>lastUsedColorsNumRows</cstring>\n+                  <cstring>commonColorsNumRows</cstring>\n                  </property>\n                 </widget>\n                </item>\n                <item row=\"1\" column=\"2\">\n-                <widget class=\"QSpinBox\" name=\"lastUsedColorsNumRows\">\n+                <widget class=\"QSpinBox\" name=\"commonColorsNumRows\">\n                  <property name=\"minimum\">\n                   <number>1</number>\n                  </property>\n@@ -846,243 +1108,44 @@\n                 </widget>\n                </item>\n               </layout>\n-             </item>\n-            </layout>\n-           </widget>\n-          </item>\n-         </layout>\n-        </item>\n-        <item row=\"1\" column=\"0\">\n-         <widget class=\"QCheckBox\" name=\"lastUsedColorsAllowScrolling\">\n-          <property name=\"text\">\n-           <string>Allow scrolling</string>\n-          </property>\n-          <property name=\"checked\">\n-           <bool>true</bool>\n-          </property>\n-         </widget>\n-        </item>\n-       </layout>\n-      </widget>\n-     </widget>\n-     <widget class=\"QWidget\" name=\"tab_colorsFromImage\">\n-      <attribute name=\"title\">\n-       <string>Colors from Image</string>\n-      </attribute>\n-      <widget class=\"QGroupBox\" name=\"commonColorsShow\">\n-       <property name=\"enabled\">\n-        <bool>true</bool>\n-       </property>\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>10</x>\n-         <y>10</y>\n-         <width>561</width>\n-         <height>241</height>\n-        </rect>\n-       </property>\n-       <property name=\"title\">\n-        <string>Show Colors from the image</string>\n-       </property>\n-       <property name=\"checkable\">\n-        <bool>true</bool>\n-       </property>\n-       <widget class=\"QCheckBox\" name=\"commonColorsAutoUpdate\">\n-        <property name=\"geometry\">\n-         <rect>\n-          <x>10</x>\n-          <y>190</y>\n-          <width>284</width>\n-          <height>22</height>\n-         </rect>\n-        </property>\n-        <property name=\"toolTip\">\n-         <string>this can be slow on big images</string>\n-        </property>\n-        <property name=\"text\">\n-         <string>Update after every stroke</string>\n-        </property>\n-       </widget>\n-       <widget class=\"QCheckBox\" name=\"commonColorsAllowScrolling\">\n-        <property name=\"geometry\">\n-         <rect>\n-          <x>10</x>\n-          <y>210</y>\n-          <width>284</width>\n-          <height>22</height>\n-         </rect>\n-        </property>\n-        <property name=\"text\">\n-         <string>Allow scrolling</string>\n-        </property>\n-       </widget>\n-       <widget class=\"QWidget\" name=\"\">\n-        <property name=\"geometry\">\n-         <rect>\n-          <x>20</x>\n-          <y>40</y>\n-          <width>434</width>\n-          <height>140</height>\n-         </rect>\n-        </property>\n-        <layout class=\"QHBoxLayout\" name=\"horizontalLayout_8\">\n-         <item>\n-          <widget class=\"QGroupBox\" name=\"groupBox_3\">\n-           <property name=\"title\">\n-            <string>Patch Options</string>\n-           </property>\n-           <layout class=\"QGridLayout\" name=\"gridLayout_7\">\n-            <item row=\"0\" column=\"0\">\n-             <widget class=\"QLabel\" name=\"label_12\">\n-              <property name=\"text\">\n-               <string>Height:</string>\n-              </property>\n-              <property name=\"alignment\">\n-               <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-              </property>\n-             </widget>\n-            </item>\n-            <item row=\"0\" column=\"1\">\n-             <widget class=\"QSpinBox\" name=\"commonColorsWidth\">\n-              <property name=\"suffix\">\n-               <string> px</string>\n-              </property>\n-              <property name=\"prefix\">\n-               <string/>\n-              </property>\n-              <property name=\"minimum\">\n-               <number>16</number>\n-              </property>\n-             </widget>\n-            </item>\n-            <item row=\"1\" column=\"0\">\n-             <widget class=\"QLabel\" name=\"label_4\">\n-              <property name=\"text\">\n-               <string>Width:</string>\n-              </property>\n-              <property name=\"alignment\">\n-               <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-              </property>\n-             </widget>\n-            </item>\n-            <item row=\"1\" column=\"1\">\n-             <widget class=\"QSpinBox\" name=\"commonColorsHeight\">\n-              <property name=\"suffix\">\n-               <string> px</string>\n-              </property>\n-              <property name=\"minimum\">\n-               <number>16</number>\n-              </property>\n-             </widget>\n-            </item>\n-            <item row=\"2\" column=\"0\">\n-             <widget class=\"QLabel\" name=\"label_9\">\n-              <property name=\"text\">\n-               <string>Max Patches: </string>\n-              </property>\n-              <property name=\"alignment\">\n-               <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-              </property>\n              </widget>\n             </item>\n-            <item row=\"2\" column=\"1\">\n-             <widget class=\"QSpinBox\" name=\"commonColorsPatchCount\">\n-              <property name=\"minimum\">\n-               <number>1</number>\n-              </property>\n-              <property name=\"value\">\n-               <number>30</number>\n-              </property>\n-             </widget>\n-            </item>\n-           </layout>\n-          </widget>\n-         </item>\n-         <item>\n-          <widget class=\"QGroupBox\" name=\"groupBox_4\">\n-           <property name=\"title\">\n-            <string>Layout</string>\n-           </property>\n-           <layout class=\"QGridLayout\" name=\"gridLayout_8\">\n-            <item row=\"0\" column=\"0\">\n-             <layout class=\"QGridLayout\" name=\"gridLayout_2\">\n-              <item row=\"3\" column=\"0\">\n-               <widget class=\"QRadioButton\" name=\"commonColorsAlignHorizontal\">\n-                <property name=\"text\">\n-                 <string>Horizontal</string>\n-                </property>\n-                <property name=\"checked\">\n-                 <bool>true</bool>\n-                </property>\n-               </widget>\n-              </item>\n-              <item row=\"1\" column=\"0\">\n-               <widget class=\"QRadioButton\" name=\"commonColorsAlignVertical\">\n-                <property name=\"text\">\n-                 <string>Vertical</string>\n-                </property>\n-               </widget>\n-              </item>\n-              <item row=\"1\" column=\"1\">\n-               <widget class=\"QLabel\" name=\"lbl_commonColorsNumCols\">\n-                <property name=\"text\">\n-                 <string>Columns:</string>\n-                </property>\n-                <property name=\"alignment\">\n-                 <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-                </property>\n-                <property name=\"buddy\">\n-                 <cstring>commonColorsNumCols</cstring>\n-                </property>\n-               </widget>\n-              </item>\n-              <item row=\"1\" column=\"2\">\n-               <widget class=\"QSpinBox\" name=\"commonColorsNumCols\">\n-                <property name=\"minimum\">\n-                 <number>1</number>\n-                </property>\n-                <property name=\"maximum\">\n-                 <number>20</number>\n-                </property>\n-                <property name=\"value\">\n-                 <number>2</number>\n-                </property>\n-               </widget>\n-              </item>\n-              <item row=\"3\" column=\"1\">\n-               <widget class=\"QLabel\" name=\"lbl_commonColorsNumRows\">\n-                <property name=\"text\">\n-                 <string>Rows:</string>\n-                </property>\n-                <property name=\"alignment\">\n-                 <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-                </property>\n-                <property name=\"buddy\">\n-                 <cstring>commonColorsNumRows</cstring>\n-                </property>\n-               </widget>\n-              </item>\n-              <item row=\"3\" column=\"2\">\n-               <widget class=\"QSpinBox\" name=\"commonColorsNumRows\">\n-                <property name=\"minimum\">\n-                 <number>1</number>\n-                </property>\n-                <property name=\"maximum\">\n-                 <number>20</number>\n-                </property>\n-                <property name=\"value\">\n-                 <number>3</number>\n-                </property>\n-               </widget>\n-              </item>\n-             </layout>\n-            </item>\n            </layout>\n-          </widget>\n-         </item>\n-        </layout>\n-       </widget>\n-      </widget>\n+          </item>\n+          <item>\n+           <widget class=\"QCheckBox\" name=\"commonColorsAutoUpdate\">\n+            <property name=\"toolTip\">\n+             <string>this can be slow on big images</string>\n+            </property>\n+            <property name=\"text\">\n+             <string>Update after every stroke</string>\n+            </property>\n+           </widget>\n+          </item>\n+          <item>\n+           <widget class=\"QCheckBox\" name=\"commonColorsAllowScrolling\">\n+            <property name=\"text\">\n+             <string>Allow scrolling</string>\n+            </property>\n+           </widget>\n+          </item>\n+         </layout>\n+        </widget>\n+       </item>\n+       <item>\n+        <spacer name=\"verticalSpacer_7\">\n+         <property name=\"orientation\">\n+          <enum>Qt::Vertical</enum>\n+         </property>\n+         <property name=\"sizeHint\" stdset=\"0\">\n+          <size>\n+           <width>20</width>\n+           <height>138</height>\n+          </size>\n+         </property>\n+        </spacer>\n+       </item>\n+      </layout>\n      </widget>\n     </widget>\n    </item>\n@@ -1381,146 +1444,18 @@\n  <resources/>\n  <connections>\n   <connection>\n-   <sender>lastUsedColorsAlignVertical</sender>\n-   <signal>toggled(bool)</signal>\n-   <receiver>lbl_lastUsedNumCols</receiver>\n-   <slot>setVisible(bool)</slot>\n-   <hints>\n-    <hint type=\"sourcelabel\">\n-     <x>85</x>\n-     <y>156</y>\n-    </hint>\n-    <hint type=\"destinationlabel\">\n-     <x>31</x>\n-     <y>213</y>\n-    </hint>\n-   </hints>\n-  </connection>\n-  <connection>\n-   <sender>lastUsedColorsAlignVertical</sender>\n-   <signal>toggled(bool)</signal>\n-   <receiver>lastUsedColorsNumCols</receiver>\n-   <slot>setVisible(bool)</slot>\n-   <hints>\n-    <hint type=\"sourcelabel\">\n-     <x>85</x>\n-     <y>156</y>\n-    </hint>\n-    <hint type=\"destinationlabel\">\n-     <x>144</x>\n-     <y>213</y>\n-    </hint>\n-   </hints>\n-  </connection>\n-  <connection>\n-   <sender>lastUsedColorsAlignVertical</sender>\n-   <signal>toggled(bool)</signal>\n-   <receiver>lbl_lastUsedNumRows</receiver>\n-   <slot>setHidden(bool)</slot>\n-   <hints>\n-    <hint type=\"sourcelabel\">\n-     <x>85</x>\n-     <y>156</y>\n-    </hint>\n-    <hint type=\"destinationlabel\">\n-     <x>31</x>\n-     <y>241</y>\n-    </hint>\n-   </hints>\n-  </connection>\n-  <connection>\n-   <sender>lastUsedColorsAlignVertical</sender>\n-   <signal>toggled(bool)</signal>\n-   <receiver>lastUsedColorsNumRows</receiver>\n-   <slot>setHidden(bool)</slot>\n-   <hints>\n-    <hint type=\"sourcelabel\">\n-     <x>85</x>\n-     <y>156</y>\n-    </hint>\n-    <hint type=\"destinationlabel\">\n-     <x>144</x>\n-     <y>241</y>\n-    </hint>\n-   </hints>\n-  </connection>\n-  <connection>\n-   <sender>lastUsedColorsAlignHorizontal</sender>\n-   <signal>toggled(bool)</signal>\n-   <receiver>lbl_lastUsedNumCols</receiver>\n-   <slot>setHidden(bool)</slot>\n-   <hints>\n-    <hint type=\"sourcelabel\">\n-     <x>152</x>\n-     <y>156</y>\n-    </hint>\n-    <hint type=\"destinationlabel\">\n-     <x>31</x>\n-     <y>213</y>\n-    </hint>\n-   </hints>\n-  </connection>\n-  <connection>\n-   <sender>lastUsedColorsAlignHorizontal</sender>\n-   <signal>toggled(bool)</signal>\n-   <receiver>lastUsedColorsNumCols</receiver>\n-   <slot>setHidden(bool)</slot>\n-   <hints>\n-    <hint type=\"sourcelabel\">\n-     <x>152</x>\n-     <y>156</y>\n-    </hint>\n-    <hint type=\"destinationlabel\">\n-     <x>144</x>\n-     <y>213</y>\n-    </hint>\n-   </hints>\n-  </connection>\n-  <connection>\n-   <sender>lastUsedColorsAlignHorizontal</sender>\n-   <signal>toggled(bool)</signal>\n-   <receiver>lbl_lastUsedNumRows</receiver>\n-   <slot>setVisible(bool)</slot>\n-   <hints>\n-    <hint type=\"sourcelabel\">\n-     <x>152</x>\n-     <y>156</y>\n-    </hint>\n-    <hint type=\"destinationlabel\">\n-     <x>31</x>\n-     <y>241</y>\n-    </hint>\n-   </hints>\n-  </connection>\n-  <connection>\n-   <sender>lastUsedColorsAlignHorizontal</sender>\n-   <signal>toggled(bool)</signal>\n-   <receiver>lastUsedColorsNumRows</receiver>\n-   <slot>setVisible(bool)</slot>\n-   <hints>\n-    <hint type=\"sourcelabel\">\n-     <x>152</x>\n-     <y>156</y>\n-    </hint>\n-    <hint type=\"destinationlabel\">\n-     <x>144</x>\n-     <y>241</y>\n-    </hint>\n-   </hints>\n-  </connection>\n-  <connection>\n    <sender>minimalShadeSelectorAsColorPatches</sender>\n    <signal>toggled(bool)</signal>\n    <receiver>minimalShadeSelectorPatchesPerLine</receiver>\n    <slot>setEnabled(bool)</slot>\n    <hints>\n     <hint type=\"sourcelabel\">\n-     <x>142</x>\n-     <y>280</y>\n+     <x>194</x>\n+     <y>393</y>\n     </hint>\n     <hint type=\"destinationlabel\">\n-     <x>149</x>\n-     <y>308</y>\n+     <x>520</x>\n+     <y>463</y>\n     </hint>\n    </hints>\n   </connection>"}]}, {"sha": "a918744b4534f93ddee1ecf17b7ed5dd9d75f87d", "stats": {"total": 57, "additions": 17, "deletions": 40}, "files": [{"sha": "7d4978793482f738351031f6275c62837c9e54d9", "filename": "libs/brush/kis_auto_brush_factory.cpp", "status": "modified", "additions": 8, "deletions": 33, "changes": 41, "blob_url": "https://github.com/KDE/krita/blob/a918744b4534f93ddee1ecf17b7ed5dd9d75f87d/libs/brush/kis_auto_brush_factory.cpp", "raw_url": "https://github.com/KDE/krita/raw/a918744b4534f93ddee1ecf17b7ed5dd9d75f87d/libs/brush/kis_auto_brush_factory.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/brush/kis_auto_brush_factory.cpp?ref=a918744b4534f93ddee1ecf17b7ed5dd9d75f87d", "patch": "@@ -24,43 +24,18 @@\n \n #include \"kis_auto_brush.h\"\n #include \"kis_mask_generator.h\"\n+#include <kis_dom_utils.h>\n \n KisBrushSP KisAutoBrushFactory::getOrCreateBrush(const QDomElement& brushDefinition)\n {\n     KisMaskGenerator* mask = KisMaskGenerator::fromXML(brushDefinition.firstChildElement(\"MaskGenerator\"));\n-    bool result;\n-    QLocale c(QLocale::German);\n-\n-    double angle = brushDefinition.attribute(\"angle\", \"0.0\").toDouble(&result);\n-    if (!result) {\n-        angle = c.toDouble(brushDefinition.attribute(\"angle\"));\n-    }\n-\n-    double randomness = brushDefinition.attribute(\"randomness\", \"0.0\").toDouble(&result);\n-    if (!result) {\n-        randomness = c.toDouble(brushDefinition.attribute(\"randomness\"));\n-    }\n-\n-    qreal density = brushDefinition.attribute(\"density\", \"1.0\").toDouble(&result);\n-    if (!result) {\n-        density = c.toDouble(brushDefinition.attribute(\"density\"));\n-    }\n-\n-    double spacing = brushDefinition.attribute(\"spacing\", \"1.0\").toDouble(&result);\n-    if (!result) {\n-        spacing = c.toDouble(brushDefinition.attribute(\"spacing\"));\n-    }\n-\n-    bool useAutoSpacing = brushDefinition.attribute(\"useAutoSpacing\", \"0\").toInt(&result);\n-    if (!result) {\n-        useAutoSpacing = c.toInt(brushDefinition.attribute(\"useAutoSpacing\"));\n-    }\n-\n-    qreal autoSpacingCoeff = brushDefinition.attribute(\"autoSpacingCoeff\", \"1.0\").toDouble(&result);\n-    if (!result) {\n-        autoSpacingCoeff = c.toDouble(brushDefinition.attribute(\"autoSpacingCoeff\"));\n-    }\n-\n+    double angle = KisDomUtils::toDouble(brushDefinition.attribute(\"angle\", \"0.0\"));\n+    double randomness = KisDomUtils::toDouble(brushDefinition.attribute(\"randomness\", \"0.0\"));\n+    qreal density = KisDomUtils::toDouble(brushDefinition.attribute(\"density\", \"1.0\"));\n+    double spacing = KisDomUtils::toDouble(brushDefinition.attribute(\"spacing\", \"1.0\"));\n+    bool useAutoSpacing = KisDomUtils::toInt(brushDefinition.attribute(\"useAutoSpacing\", \"0\"));\n+    qreal autoSpacingCoeff = KisDomUtils::toDouble(brushDefinition.attribute(\"autoSpacingCoeff\", \"1.0\"));\n+\\\n     KisBrushSP brush = new KisAutoBrush(mask, angle, randomness, density);\n     brush->setSpacing(spacing);\n     brush->setAutoSpacing(useAutoSpacing, autoSpacingCoeff);"}, {"sha": "c54568fcb676ac937ba08f2be0d119d6d705a13b", "filename": "libs/brush/kis_png_brush.cpp", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/a918744b4534f93ddee1ecf17b7ed5dd9d75f87d/libs/brush/kis_png_brush.cpp", "raw_url": "https://github.com/KDE/krita/raw/a918744b4534f93ddee1ecf17b7ed5dd9d75f87d/libs/brush/kis_png_brush.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/brush/kis_png_brush.cpp?ref=a918744b4534f93ddee1ecf17b7ed5dd9d75f87d", "patch": "@@ -24,6 +24,8 @@\n #include <QByteArray>\n #include <QBuffer>\n \n+#include <kis_dom_utils.h>\n+\n KisPngBrush::KisPngBrush(const QString& filename)\n     : KisBrush(filename)\n {\n@@ -61,7 +63,7 @@ bool KisPngBrush::loadFromDevice(QIODevice *dev)\n     }\n \n     if (reader.textKeys().contains(\"brush_spacing\")) {\n-        setSpacing(reader.text(\"brush_spacing\").toDouble());\n+        setSpacing(KisDomUtils::toDouble(reader.text(\"brush_spacing\")));\n     }\n \n     if (reader.textKeys().contains(\"brush_name\")) {"}, {"sha": "45a0530227c669fd4fa95516c30dd538e8c16d45", "filename": "libs/brush/kis_predefined_brush_factory.cpp", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/KDE/krita/blob/a918744b4534f93ddee1ecf17b7ed5dd9d75f87d/libs/brush/kis_predefined_brush_factory.cpp", "raw_url": "https://github.com/KDE/krita/raw/a918744b4534f93ddee1ecf17b7ed5dd9d75f87d/libs/brush/kis_predefined_brush_factory.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/brush/kis_predefined_brush_factory.cpp?ref=a918744b4534f93ddee1ecf17b7ed5dd9d75f87d", "patch": "@@ -21,7 +21,7 @@\n #include <QDomDocument>\n #include \"kis_brush_server.h\"\n #include \"kis_gbr_brush.h\"\n-\n+#include <kis_dom_utils.h>\n \n KisPredefinedBrushFactory::KisPredefinedBrushFactory(const QString &brushType)\n     : m_id(brushType)\n@@ -51,17 +51,17 @@ KisBrushSP KisPredefinedBrushFactory::getOrCreateBrush(const QDomElement& brushD\n \n     Q_ASSERT(brush);\n \n-    double spacing = brushDefinition.attribute(\"spacing\", \"0.25\").toDouble();\n+    double spacing = KisDomUtils::toDouble(brushDefinition.attribute(\"spacing\", \"0.25\"));\n     brush->setSpacing(spacing);\n \n-    bool useAutoSpacing = brushDefinition.attribute(\"useAutoSpacing\", \"0\").toInt();\n-    qreal autoSpacingCoeff = brushDefinition.attribute(\"autoSpacingCoeff\", \"1.0\").toDouble();\n+    bool useAutoSpacing = KisDomUtils::toInt(brushDefinition.attribute(\"useAutoSpacing\", \"0\"));\n+    qreal autoSpacingCoeff = KisDomUtils::toDouble(brushDefinition.attribute(\"autoSpacingCoeff\", \"1.0\"));\n     brush->setAutoSpacing(useAutoSpacing, autoSpacingCoeff);\n \n-    double angle = brushDefinition.attribute(\"angle\", \"0.0\").toDouble();\n+    double angle = KisDomUtils::toDouble(brushDefinition.attribute(\"angle\", \"0.0\"));\n     brush->setAngle(angle);\n \n-    double scale = brushDefinition.attribute(\"scale\", \"1.0\").toDouble();\n+    double scale = KisDomUtils::toDouble(brushDefinition.attribute(\"scale\", \"1.0\"));\n     brush->setScale(scale);\n \n     if (m_id == \"gbr_brush\") {"}]}, {"sha": "932bcb70669e9a25778bdc50d766f60f99f5f7b2", "stats": {"total": 28, "additions": 13, "deletions": 15}, "files": [{"sha": "25846c86513fec19e97b917f3c3c2c05c720a786", "filename": "libs/widgetutils/kis_action_registry.cpp", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/KDE/krita/blob/932bcb70669e9a25778bdc50d766f60f99f5f7b2/libs/widgetutils/kis_action_registry.cpp", "raw_url": "https://github.com/KDE/krita/raw/932bcb70669e9a25778bdc50d766f60f99f5f7b2/libs/widgetutils/kis_action_registry.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/kis_action_registry.cpp?ref=932bcb70669e9a25778bdc50d766f60f99f5f7b2", "patch": "@@ -265,11 +265,10 @@ void KisActionRegistry::applyShortcutScheme(const KConfigBase *config)\n \n void KisActionRegistry::updateShortcut(const QString &name, QAction *action)\n {\n-    const ActionInfoItem info = d->actionInfo(name);\n-    auto newShortcuts = preferredShortcuts(info);\n-    action->setShortcuts(newShortcuts);\n+    const ActionInfoItem &info = d->actionInfo(name);\n+    action->setShortcuts(preferredShortcuts(info));\n \n-    action->setProperty(\"defaultShortcuts\", qVariantFromValue(newShortcuts));\n+    action->setProperty(\"defaultShortcuts\", qVariantFromValue(info.defaultShortcuts));\n }\n \n "}, {"sha": "5ac833889fea075e25e31b191008d073779c0469", "filename": "libs/widgetutils/xmlgui/KisShortcutsDialog.cpp", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/KDE/krita/blob/932bcb70669e9a25778bdc50d766f60f99f5f7b2/libs/widgetutils/xmlgui/KisShortcutsDialog.cpp", "raw_url": "https://github.com/KDE/krita/raw/932bcb70669e9a25778bdc50d766f60f99f5f7b2/libs/widgetutils/xmlgui/KisShortcutsDialog.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/xmlgui/KisShortcutsDialog.cpp?ref=932bcb70669e9a25778bdc50d766f60f99f5f7b2", "patch": "@@ -121,27 +121,27 @@ void KisShortcutsDialog::allDefault()\n \n void KisShortcutsDialog::importConfiguration(const QString &path)\n {\n-    KConfig config(path);\n-    d->m_shortcutsEditor->importConfiguration(static_cast<KConfigBase *>(&config), true);\n+    auto config = KSharedConfig::openConfig(path);\n+    d->m_shortcutsEditor->importConfiguration(config.data(), true);\n }\n \n void KisShortcutsDialog::exportConfiguration(const QString &path) const\n {\n-    KConfig config(path);\n-    d->m_shortcutsEditor->exportConfiguration(static_cast<KConfigBase *>(&config));\n+    auto config = KSharedConfig::openConfig(path);\n+    d->m_shortcutsEditor->exportConfiguration(config.data());\n }\n \n void KisShortcutsDialog::saveCustomShortcuts(const QString &path) const\n {\n-  KConfig config(path);\n-  KConfigGroup cg(&config, QStringLiteral(\"Shortcuts\"));\n-  d->m_shortcutsEditor->saveShortcuts(&cg);\n+    auto cg = KSharedConfig::openConfig(path)->group(QStringLiteral(\"Shortcuts\"));\n+    d->m_shortcutsEditor->saveShortcuts(&cg);\n+    d->m_shortcutsEditor->commit();\n }\n \n void KisShortcutsDialog::loadCustomShortcuts(const QString &path)\n {\n-    KConfig config(path);\n-    d->m_shortcutsEditor->importConfiguration(static_cast<KConfigBase *>(&config), false);\n+    auto config = KSharedConfig::openConfig(path);\n+    d->m_shortcutsEditor->importConfiguration(config.data(), false);\n }\n \n #include \"moc_KisShortcutsDialog.cpp\""}, {"sha": "55b6e82485625350a0fd0096667351bab836b5d4", "filename": "libs/widgetutils/xmlgui/KisShortcutsEditor.cpp", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/932bcb70669e9a25778bdc50d766f60f99f5f7b2/libs/widgetutils/xmlgui/KisShortcutsEditor.cpp", "raw_url": "https://github.com/KDE/krita/raw/932bcb70669e9a25778bdc50d766f60f99f5f7b2/libs/widgetutils/xmlgui/KisShortcutsEditor.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/xmlgui/KisShortcutsEditor.cpp?ref=932bcb70669e9a25778bdc50d766f60f99f5f7b2", "patch": "@@ -222,8 +222,7 @@ void KisShortcutsEditor::exportConfiguration(KConfigBase *config) const\n     }\n \n     if (d->actionTypes) {\n-        QString groupName(QStringLiteral(\"Shortcuts\"));\n-        KConfigGroup group(config, groupName);\n+        KConfigGroup group(config,QStringLiteral(\"Shortcuts\"));\n         foreach (KActionCollection *collection, d->actionCollections) {\n             collection->writeSettings(&group, true);\n         }"}]}, {"sha": "91f9ef12c6112ad9690a853d539e4776afbe3591", "stats": {"total": 19, "additions": 10, "deletions": 9}, "files": [{"sha": "27824df0b83ac6763b86ea20e64f8c3046eda1b1", "filename": "krita/kritamenu.action", "status": "modified", "additions": 10, "deletions": 9, "changes": 19, "blob_url": "https://github.com/KDE/krita/blob/91f9ef12c6112ad9690a853d539e4776afbe3591/krita/kritamenu.action", "raw_url": "https://github.com/KDE/krita/raw/91f9ef12c6112ad9690a853d539e4776afbe3591/krita/kritamenu.action", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/kritamenu.action?ref=91f9ef12c6112ad9690a853d539e4776afbe3591", "patch": "@@ -28,20 +28,21 @@\n     </Action>\n     <Action name=\"file_open_recent\">\n       <icon>document-open-recent</icon>\n-      <text>Save Incremental &amp;Backup</text>\n+      <text>Open &amp;Recent</text>\n       <whatsThis></whatsThis>\n-      <toolTip>Save Incremental Backup</toolTip>\n-      <iconText>Save Incremental Backup</iconText>\n+      <toolTip>Open a document which was recently opened</toolTip>\n+      <iconText>Open Recent</iconText>\n       <activationFlags>1</activationFlags>\n       <activationConditions>0</activationConditions>\n-      <shortcut>F4</shortcut>\n+      <shortcut></shortcut>\n       <isCheckable>false</isCheckable>\n       <statusTip></statusTip>\n     </Action>\n     <Action name=\"file_save\">\n       <icon>document-save</icon>\n+      <text>&amp;Save</text>\n       <whatsThis></whatsThis>\n-      <toolTip>Save as .krita-6301-document_0-autosave.kra</toolTip>\n+      <toolTip>Save</toolTip>\n       <iconText>Save</iconText>\n       <activationFlags>1</activationFlags>\n       <activationConditions>0</activationConditions>\n@@ -63,13 +64,13 @@\n     </Action>\n     <Action name=\"file_reload_file\">\n       <icon></icon>\n-      <text>Save Incremental &amp;Backup</text>\n+      <text>Reload</text>\n       <whatsThis></whatsThis>\n-      <toolTip>Save Incremental Backup</toolTip>\n-      <iconText>Save Incremental Backup</iconText>\n+      <toolTip>Reload</toolTip>\n+      <iconText>Reload</iconText>\n       <activationFlags>1</activationFlags>\n       <activationConditions>0</activationConditions>\n-      <shortcut>F4</shortcut>\n+      <shortcut></shortcut>\n       <isCheckable>false</isCheckable>\n       <statusTip></statusTip>\n     </Action>"}]}, {"sha": "4023a33a8680a8f3c92141fe009b820152c1428c", "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "5ce01259071b0aa853a8dfb2cd322a0027313836", "filename": "plugins/filters/colorsfilters/kis_perchannel_filter.cpp", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/4023a33a8680a8f3c92141fe009b820152c1428c/plugins/filters/colorsfilters/kis_perchannel_filter.cpp", "raw_url": "https://github.com/KDE/krita/raw/4023a33a8680a8f3c92141fe009b820152c1428c/plugins/filters/colorsfilters/kis_perchannel_filter.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/colorsfilters/kis_perchannel_filter.cpp?ref=4023a33a8680a8f3c92141fe009b820152c1428c", "patch": "@@ -584,9 +584,9 @@ KoColorTransformation* KisPerChannelFilter::createTransformation(const KoColorSp\n     }\n \n     QVector<KoColorTransformation*> allTransforms;\n-    allTransforms << lightnessTransform;\n-    allTransforms << allColorsTransform;\n     allTransforms << colorTransform;\n+    allTransforms << allColorsTransform;\n+    allTransforms << lightnessTransform;\n \n     return KoCompositeColorTransformation::createOptimizedCompositeTransform(allTransforms);\n }"}]}, {"sha": "0f4605a679f9612f9fb9227d77ee266fcccdf8ec", "stats": {"total": 271, "additions": 135, "deletions": 136}, "files": [{"sha": "e0e47e8c348dca3cdc4478bc88b57a331c58bfb0", "filename": "libs/global/kis_dom_utils.cpp", "status": "modified", "additions": 46, "deletions": 46, "changes": 92, "blob_url": "https://github.com/KDE/krita/blob/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/libs/global/kis_dom_utils.cpp", "raw_url": "https://github.com/KDE/krita/raw/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/libs/global/kis_dom_utils.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/global/kis_dom_utils.cpp?ref=0f4605a679f9612f9fb9227d77ee266fcccdf8ec", "patch": "@@ -32,8 +32,8 @@ void saveValue(QDomElement *parent, const QString &tag, const QSize &size)\n \n     e.setAttribute(\"type\", \"size\");\n \n-    e.setAttribute(\"w\", Private::numberToString(size.width()));\n-    e.setAttribute(\"h\", Private::numberToString(size.height()));\n+    e.setAttribute(\"w\", toString(size.width()));\n+    e.setAttribute(\"h\", toString(size.height()));\n }\n \n void saveValue(QDomElement *parent, const QString &tag, const QRect &rc)\n@@ -44,10 +44,10 @@ void saveValue(QDomElement *parent, const QString &tag, const QRect &rc)\n \n     e.setAttribute(\"type\", \"rect\");\n \n-    e.setAttribute(\"x\", Private::numberToString(rc.x()));\n-    e.setAttribute(\"y\", Private::numberToString(rc.y()));\n-    e.setAttribute(\"w\", Private::numberToString(rc.width()));\n-    e.setAttribute(\"h\", Private::numberToString(rc.height()));\n+    e.setAttribute(\"x\", toString(rc.x()));\n+    e.setAttribute(\"y\", toString(rc.y()));\n+    e.setAttribute(\"w\", toString(rc.width()));\n+    e.setAttribute(\"h\", toString(rc.height()));\n }\n \n void saveValue(QDomElement *parent, const QString &tag, const QPoint &pt)\n@@ -58,8 +58,8 @@ void saveValue(QDomElement *parent, const QString &tag, const QPoint &pt)\n \n     e.setAttribute(\"type\", \"point\");\n \n-    e.setAttribute(\"x\", Private::numberToString(pt.x()));\n-    e.setAttribute(\"y\", Private::numberToString(pt.y()));\n+    e.setAttribute(\"x\", toString(pt.x()));\n+    e.setAttribute(\"y\", toString(pt.y()));\n }\n \n void saveValue(QDomElement *parent, const QString &tag, const QPointF &pt)\n@@ -70,8 +70,8 @@ void saveValue(QDomElement *parent, const QString &tag, const QPointF &pt)\n \n     e.setAttribute(\"type\", \"pointf\");\n \n-    e.setAttribute(\"x\", Private::numberToString(pt.x()));\n-    e.setAttribute(\"y\", Private::numberToString(pt.y()));\n+    e.setAttribute(\"x\", toString(pt.x()));\n+    e.setAttribute(\"y\", toString(pt.y()));\n }\n \n void saveValue(QDomElement *parent, const QString &tag, const QVector3D &pt)\n@@ -82,9 +82,9 @@ void saveValue(QDomElement *parent, const QString &tag, const QVector3D &pt)\n \n     e.setAttribute(\"type\", \"vector3d\");\n \n-    e.setAttribute(\"x\", Private::numberToString(pt.x()));\n-    e.setAttribute(\"y\", Private::numberToString(pt.y()));\n-    e.setAttribute(\"z\", Private::numberToString(pt.z()));\n+    e.setAttribute(\"x\", toString(pt.x()));\n+    e.setAttribute(\"y\", toString(pt.y()));\n+    e.setAttribute(\"z\", toString(pt.z()));\n }\n \n void saveValue(QDomElement *parent, const QString &tag, const QTransform &t)\n@@ -95,17 +95,17 @@ void saveValue(QDomElement *parent, const QString &tag, const QTransform &t)\n \n     e.setAttribute(\"type\", \"transform\");\n \n-    e.setAttribute(\"m11\", Private::numberToString(t.m11()));\n-    e.setAttribute(\"m12\", Private::numberToString(t.m12()));\n-    e.setAttribute(\"m13\", Private::numberToString(t.m13()));\n+    e.setAttribute(\"m11\", toString(t.m11()));\n+    e.setAttribute(\"m12\", toString(t.m12()));\n+    e.setAttribute(\"m13\", toString(t.m13()));\n \n-    e.setAttribute(\"m21\", Private::numberToString(t.m21()));\n-    e.setAttribute(\"m22\", Private::numberToString(t.m22()));\n-    e.setAttribute(\"m23\", Private::numberToString(t.m23()));\n+    e.setAttribute(\"m21\", toString(t.m21()));\n+    e.setAttribute(\"m22\", toString(t.m22()));\n+    e.setAttribute(\"m23\", toString(t.m23()));\n \n-    e.setAttribute(\"m31\", Private::numberToString(t.m31()));\n-    e.setAttribute(\"m32\", Private::numberToString(t.m32()));\n-    e.setAttribute(\"m33\", Private::numberToString(t.m33()));\n+    e.setAttribute(\"m31\", toString(t.m31()));\n+    e.setAttribute(\"m32\", toString(t.m32()));\n+    e.setAttribute(\"m33\", toString(t.m33()));\n }\n \n bool findOnlyElement(const QDomElement &parent, const QString &tag, QDomElement *el, QStringList *errorMessages)\n@@ -142,23 +142,23 @@ namespace Private {\n bool loadValue(const QDomElement &e, float *v)\n {\n     if (!Private::checkType(e, \"value\")) return false;\n-    *v = Private::stringToDouble(e.attribute(\"value\", \"0\"));\n+    *v = toDouble(e.attribute(\"value\", \"0\"));\n     return true;\n }\n \n bool loadValue(const QDomElement &e, double *v)\n {\n     if (!Private::checkType(e, \"value\")) return false;\n-    *v = Private::stringToDouble(e.attribute(\"value\", \"0\"));\n+    *v = toDouble(e.attribute(\"value\", \"0\"));\n     return true;\n }\n \n bool loadValue(const QDomElement &e, QSize *size)\n {\n     if (!Private::checkType(e, \"size\")) return false;\n \n-    size->setWidth(Private::stringToInt(e.attribute(\"w\", \"0\")));\n-    size->setHeight(Private::stringToInt(e.attribute(\"h\", \"0\")));\n+    size->setWidth(toInt(e.attribute(\"w\", \"0\")));\n+    size->setHeight(toInt(e.attribute(\"h\", \"0\")));\n \n     return true;\n }\n@@ -167,10 +167,10 @@ bool loadValue(const QDomElement &e, QRect *rc)\n {\n     if (!Private::checkType(e, \"rect\")) return false;\n \n-    rc->setX(Private::stringToInt(e.attribute(\"x\", \"0\")));\n-    rc->setY(Private::stringToInt(e.attribute(\"y\", \"0\")));\n-    rc->setWidth(Private::stringToInt(e.attribute(\"w\", \"0\")));\n-    rc->setHeight(Private::stringToInt(e.attribute(\"h\", \"0\")));\n+    rc->setX(toInt(e.attribute(\"x\", \"0\")));\n+    rc->setY(toInt(e.attribute(\"y\", \"0\")));\n+    rc->setWidth(toInt(e.attribute(\"w\", \"0\")));\n+    rc->setHeight(toInt(e.attribute(\"h\", \"0\")));\n \n     return true;\n }\n@@ -179,8 +179,8 @@ bool loadValue(const QDomElement &e, QPoint *pt)\n {\n     if (!Private::checkType(e, \"point\")) return false;\n \n-    pt->setX(Private::stringToInt(e.attribute(\"x\", \"0\")));\n-    pt->setY(Private::stringToInt(e.attribute(\"y\", \"0\")));\n+    pt->setX(toInt(e.attribute(\"x\", \"0\")));\n+    pt->setY(toInt(e.attribute(\"y\", \"0\")));\n \n     return true;\n }\n@@ -189,8 +189,8 @@ bool loadValue(const QDomElement &e, QPointF *pt)\n {\n     if (!Private::checkType(e, \"pointf\")) return false;\n \n-    pt->setX(Private::stringToDouble(e.attribute(\"x\", \"0\")));\n-    pt->setY(Private::stringToDouble(e.attribute(\"y\", \"0\")));\n+    pt->setX(toDouble(e.attribute(\"x\", \"0\")));\n+    pt->setY(toDouble(e.attribute(\"y\", \"0\")));\n \n     return true;\n }\n@@ -199,9 +199,9 @@ bool loadValue(const QDomElement &e, QVector3D *pt)\n {\n     if (!Private::checkType(e, \"vector3d\")) return false;\n \n-    pt->setX(Private::stringToDouble(e.attribute(\"x\", \"0\")));\n-    pt->setY(Private::stringToDouble(e.attribute(\"y\", \"0\")));\n-    pt->setZ(Private::stringToDouble(e.attribute(\"z\", \"0\")));\n+    pt->setX(toDouble(e.attribute(\"x\", \"0\")));\n+    pt->setY(toDouble(e.attribute(\"y\", \"0\")));\n+    pt->setZ(toDouble(e.attribute(\"z\", \"0\")));\n \n     return true;\n }\n@@ -210,17 +210,17 @@ bool loadValue(const QDomElement &e, QTransform *t)\n {\n     if (!Private::checkType(e, \"transform\")) return false;\n \n-    qreal m11 = Private::stringToDouble(e.attribute(\"m11\", \"1.0\"));\n-    qreal m12 = Private::stringToDouble(e.attribute(\"m12\", \"0.0\"));\n-    qreal m13 = Private::stringToDouble(e.attribute(\"m13\", \"0.0\"));\n+    qreal m11 = toDouble(e.attribute(\"m11\", \"1.0\"));\n+    qreal m12 = toDouble(e.attribute(\"m12\", \"0.0\"));\n+    qreal m13 = toDouble(e.attribute(\"m13\", \"0.0\"));\n \n-    qreal m21 = Private::stringToDouble(e.attribute(\"m21\", \"0.0\"));\n-    qreal m22 = Private::stringToDouble(e.attribute(\"m22\", \"1.0\"));\n-    qreal m23 = Private::stringToDouble(e.attribute(\"m23\", \"0.0\"));\n+    qreal m21 = toDouble(e.attribute(\"m21\", \"0.0\"));\n+    qreal m22 = toDouble(e.attribute(\"m22\", \"1.0\"));\n+    qreal m23 = toDouble(e.attribute(\"m23\", \"0.0\"));\n \n-    qreal m31 = Private::stringToDouble(e.attribute(\"m31\", \"0.0\"));\n-    qreal m32 = Private::stringToDouble(e.attribute(\"m32\", \"0.0\"));\n-    qreal m33 = Private::stringToDouble(e.attribute(\"m33\", \"1.0\"));\n+    qreal m31 = toDouble(e.attribute(\"m31\", \"0.0\"));\n+    qreal m32 = toDouble(e.attribute(\"m32\", \"0.0\"));\n+    qreal m33 = toDouble(e.attribute(\"m33\", \"1.0\"));\n \n     t->setMatrix(\n         m11, m12, m13,"}, {"sha": "e1e44fa15823c6b3746a13499af5fb48e3099b99", "filename": "libs/global/kis_dom_utils.h", "status": "modified", "additions": 48, "deletions": 49, "changes": 97, "blob_url": "https://github.com/KDE/krita/blob/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/libs/global/kis_dom_utils.h", "raw_url": "https://github.com/KDE/krita/raw/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/libs/global/kis_dom_utils.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/global/kis_dom_utils.h?ref=0f4605a679f9612f9fb9227d77ee266fcccdf8ec", "patch": "@@ -32,65 +32,64 @@\n \n namespace KisDomUtils {\n \n-    namespace Private {\n-        inline QString numberToString(const QString &value) {\n-            return value;\n-        }\n+    inline QString toString(const QString &value) {\n+        return value;\n+    }\n \n-        template<typename T>\n-        inline QString numberToString(T value) {\n-            return QString::number(value);\n-        }\n+    template<typename T>\n+        inline QString toString(T value) {\n+        return QString::number(value);\n+    }\n+\n+    inline int toInt(const QString &str) {\n+        bool ok = false;\n+        int value = 0;\n \n-        inline int stringToInt(const QString &str) {\n-            bool ok = false;\n-            int value = 0;\n+        QLocale c(QLocale::German);\n \n-            QLocale c(QLocale::German);\n+        value = str.toInt(&ok);\n+        if (!ok) {\n+            value = c.toInt(str, &ok);\n+        }\n \n-            value = str.toInt(&ok);\n-            if (!ok) {\n-                value = c.toInt(str, &ok);\n-            }\n+        if (!ok) {\n+            warnKrita << \"WARNING: KisDomUtils::toInt failed:\" << ppVar(str);\n+            value = 0;\n+        }\n \n-            if (!ok) {\n-                warnKrita << \"WARNING: KisDomUtils::stringToInt failed:\" << ppVar(str);\n-                value = 0;\n-            }\n+        return value;\n+    }\n \n-            return value;\n+    inline double toDouble(const QString &str) {\n+        bool ok = false;\n+        double value = 0;\n+\n+        QLocale c(QLocale::German);\n+\n+        /**\n+         * A special workaround to handle ','/'.' decimal point\n+         * in different locales. Added for backward compatibility,\n+         * because we used to save qreals directly using\n+         *\n+         * e.setAttribute(\"w\", (qreal)value),\n+         *\n+         * which did local-aware conversion.\n+         */\n+\n+        value = str.toDouble(&ok);\n+        if (!ok) {\n+            value = c.toDouble(str, &ok);\n         }\n \n-        inline double stringToDouble(const QString &str) {\n-            bool ok = false;\n-            double value = 0;\n-\n-            QLocale c(QLocale::German);\n-\n-            /**\n-             * A special workaround to handle ','/'.' decimal point\n-             * in different locales. Added for backward compatibility,\n-             * because we used to save qreals directly using\n-             *\n-             * e.setAttribute(\"w\", (qreal)value),\n-             *\n-             * which did local-aware conversion.\n-             */\n-\n-            value = str.toDouble(&ok);\n-            if (!ok) {\n-                value = c.toDouble(str, &ok);\n-            }\n-\n-            if (!ok) {\n-                warnKrita << \"WARNING: KisDomUtils::stringToDouble failed:\" << ppVar(str);\n-                value = 0;\n-            }\n-\n-            return value;\n+        if (!ok) {\n+            warnKrita << \"WARNING: KisDomUtils::toDouble failed:\" << ppVar(str);\n+            value = 0;\n         }\n+\n+        return value;\n     }\n \n+\n /**\n  * Save a value of type QRect into an XML tree. A child for \\p parent\n  * is created and assigned a tag \\p tag.  The corresponding value can\n@@ -120,7 +119,7 @@ void saveValue(QDomElement *parent, const QString &tag, T value)\n     parent->appendChild(e);\n \n     e.setAttribute(\"type\", \"value\");\n-    e.setAttribute(\"value\", Private::numberToString(value));\n+    e.setAttribute(\"value\", toString(value));\n }\n \n /**"}, {"sha": "83862334b0cb78a70c763d1b8f4b47a724dee7a7", "filename": "libs/image/kis_time_range.cpp", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/libs/image/kis_time_range.cpp", "raw_url": "https://github.com/KDE/krita/raw/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/libs/image/kis_time_range.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_time_range.cpp?ref=0f4605a679f9612f9fb9227d77ee266fcccdf8ec", "patch": "@@ -70,10 +70,10 @@ void saveValue(QDomElement *parent, const QString &tag, const KisTimeRange &rang\n     e.setAttribute(\"type\", \"timerange\");\n \n     if (range.isValid()) {\n-        e.setAttribute(\"from\", Private::numberToString(range.start()));\n+        e.setAttribute(\"from\", toString(range.start()));\n \n         if (!range.isInfinite()) {\n-            e.setAttribute(\"to\", Private::numberToString(range.end()));\n+            e.setAttribute(\"to\", toString(range.end()));\n         }\n     }\n }\n@@ -86,8 +86,8 @@ bool loadValue(const QDomElement &parent, const QString &tag, KisTimeRange *rang\n \n     if (!Private::checkType(e, \"timerange\")) return false;\n \n-    int start = Private::stringToInt(e.attribute(\"from\", \"-1\"));\n-    int end = Private::stringToInt(e.attribute(\"to\", \"-1\"));\n+    int start = toInt(e.attribute(\"from\", \"-1\"));\n+    int end = toInt(e.attribute(\"to\", \"-1\"));\n \n     if (start == -1) {\n         range = new KisTimeRange();"}, {"sha": "2890b110efe012b468e6428f7bc4a9a73e942e84", "filename": "libs/psd/asl/kis_asl_reader.cpp", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/KDE/krita/blob/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/libs/psd/asl/kis_asl_reader.cpp", "raw_url": "https://github.com/KDE/krita/raw/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/libs/psd/asl/kis_asl_reader.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/psd/asl/kis_asl_reader.cpp?ref=0f4605a679f9612f9fb9227d77ee266fcccdf8ec", "patch": "@@ -50,21 +50,21 @@ QString readDoubleAsString(QIODevice *device) {\n     double value = 0.0;\n     SAFE_READ_EX(device, value);\n \n-    return KisDomUtils::Private::numberToString(value);\n+    return KisDomUtils::toString(value);\n }\n \n QString readIntAsString(QIODevice *device) {\n     quint32 value = 0.0;\n     SAFE_READ_EX(device, value);\n \n-    return KisDomUtils::Private::numberToString(value);\n+    return KisDomUtils::toString(value);\n }\n \n QString readBoolAsString(QIODevice *device) {\n     quint8 value = 0.0;\n     SAFE_READ_EX(device, value);\n \n-    return KisDomUtils::Private::numberToString(value);\n+    return KisDomUtils::toString(value);\n }\n \n /**\n@@ -119,8 +119,8 @@ void appendPointXMLNode(const QString &key, const QPointF &pt, QDomElement *pare\n     el.setAttribute(\"classId\", \"CrPt\");\n     el.setAttribute(\"name\", \"\");\n \n-    appendDoubleXMLNode(\"Hrzn\", KisDomUtils::Private::numberToString(pt.x()), &el, doc);\n-    appendDoubleXMLNode(\"Vrtc\", KisDomUtils::Private::numberToString(pt.x()), &el, doc);\n+    appendDoubleXMLNode(\"Hrzn\", KisDomUtils::toString(pt.x()), &el, doc);\n+    appendDoubleXMLNode(\"Vrtc\", KisDomUtils::toString(pt.x()), &el, doc);\n }\n \n /**"}, {"sha": "e3c29b7a26bd86a0d3b0f968fe939bdd24f51bff", "filename": "libs/psd/asl/kis_asl_writer.cpp", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/libs/psd/asl/kis_asl_writer.cpp", "raw_url": "https://github.com/KDE/krita/raw/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/libs/psd/asl/kis_asl_writer.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/psd/asl/kis_asl_writer.cpp?ref=0f4605a679f9612f9fb9227d77ee266fcccdf8ec", "patch": "@@ -82,14 +82,14 @@ void parseElement(const QDomElement &el, QIODevice *device, bool forceTypeInfo =\n             child = child.nextSibling();\n         }\n     } else if (type == \"Double\") {\n-        double v = KisDomUtils::Private::stringToDouble(el.attribute(\"value\", \"0\"));\n+        double v = KisDomUtils::toDouble(el.attribute(\"value\", \"0\"));\n \n         writeVarString(key, device);\n         writeFixedString(\"doub\", device);\n         SAFE_WRITE_EX(device, v);\n \n     } else if (type == \"UnitFloat\") {\n-        double v = KisDomUtils::Private::stringToDouble(el.attribute(\"value\", \"0\"));\n+        double v = KisDomUtils::toDouble(el.attribute(\"value\", \"0\"));\n         QString unit = el.attribute(\"unit\", \"#Pxl\");\n \n         writeVarString(key, device);\n@@ -109,12 +109,12 @@ void parseElement(const QDomElement &el, QIODevice *device, bool forceTypeInfo =\n         writeVarString(typeId, device);\n         writeVarString(v, device);\n     } else if (type == \"Integer\") {\n-        quint32 v = KisDomUtils::Private::stringToInt(el.attribute(\"value\", \"0\"));\n+        quint32 v = KisDomUtils::toInt(el.attribute(\"value\", \"0\"));\n         writeVarString(key, device);\n         writeFixedString(\"long\", device);\n         SAFE_WRITE_EX(device, v);\n     } else if (type == \"Boolean\") {\n-        quint8 v = KisDomUtils::Private::stringToInt(el.attribute(\"value\", \"0\"));\n+        quint8 v = KisDomUtils::toInt(el.attribute(\"value\", \"0\"));\n \n         writeVarString(key, device);\n         writeFixedString(\"bool\", device);"}, {"sha": "938a81282e012de07a8d30b86777fa51adb317d2", "filename": "libs/psd/asl/kis_asl_xml_parser.cpp", "status": "modified", "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/KDE/krita/blob/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/libs/psd/asl/kis_asl_xml_parser.cpp", "raw_url": "https://github.com/KDE/krita/raw/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/libs/psd/asl/kis_asl_xml_parser.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/psd/asl/kis_asl_xml_parser.cpp?ref=0f4605a679f9612f9fb9227d77ee266fcccdf8ec", "patch": "@@ -89,7 +89,7 @@ QColor parseRGBColorObject(QDomElement parent)\n             return Qt::red;\n         }\n \n-        double value = KisDomUtils::Private::stringToDouble(childEl.attribute(\"value\", \"0\"));\n+        double value = KisDomUtils::toDouble(childEl.attribute(\"value\", \"0\"));\n \n         if (key == \"Rd  \") {\n             color.setRed(value);\n@@ -133,11 +133,11 @@ void parseColorStopsList(QDomElement parent,\n                 QString classId = childEl.attribute(\"classId\", \"\");\n \n                 if (type == \"Integer\" && key == \"Lctn\") {\n-                    int value = KisDomUtils::Private::stringToInt(childEl.attribute(\"value\", \"0\"));\n+                    int value = KisDomUtils::toInt(childEl.attribute(\"value\", \"0\"));\n                     startLocations.append(qreal(value) / 4096.0);\n \n                 } else if (type == \"Integer\" && key == \"Mdpn\") {\n-                    int value = KisDomUtils::Private::stringToInt(childEl.attribute(\"value\", \"0\"));\n+                    int value = KisDomUtils::toInt(childEl.attribute(\"value\", \"0\"));\n                     middleOffsets.append(qreal(value) / 100.0);\n \n                 } else if (type == \"Descriptor\" && key == \"Clr \") {\n@@ -190,18 +190,18 @@ void parseTransparencyStopsList(QDomElement parent,\n                 QString key = childEl.attribute(\"key\", \"\");\n \n                 if (type == \"Integer\" && key == \"Lctn\") {\n-                    int value = KisDomUtils::Private::stringToInt(childEl.attribute(\"value\", \"0\"));\n+                    int value = KisDomUtils::toInt(childEl.attribute(\"value\", \"0\"));\n                     startLocations.append(qreal(value) / 4096.0);\n                 } else if (type == \"Integer\" && key == \"Mdpn\") {\n-                    int value = KisDomUtils::Private::stringToInt(childEl.attribute(\"value\", \"0\"));\n+                    int value = KisDomUtils::toInt(childEl.attribute(\"value\", \"0\"));\n                     middleOffsets.append(qreal(value) / 100.0);\n                 } else if (type == \"UnitFloat\" && key == \"Opct\") {\n                     QString unit = childEl.attribute(\"unit\", \"\");\n                     if (unit != \"#Prc\") {\n                         warnKrita << \"WARNING: Invalid unit of a greadient stop transparency\" << unit;\n                     }\n \n-                    qreal value = KisDomUtils::Private::stringToDouble(childEl.attribute(\"value\", \"100\"));\n+                    qreal value = KisDomUtils::toDouble(childEl.attribute(\"value\", \"100\"));\n                     transparencies.append(value / 100.0);\n                 }\n \n@@ -270,7 +270,7 @@ bool tryParseDescriptor(const QDomElement &el,\n                 return false;\n             }\n \n-            double value = KisDomUtils::Private::stringToDouble(childEl.attribute(\"value\", \"0\"));\n+            double value = KisDomUtils::toDouble(childEl.attribute(\"value\", \"0\"));\n \n             if (key == \"Hrzn\") {\n                 point.setX(value);\n@@ -303,7 +303,7 @@ bool tryParseDescriptor(const QDomElement &el,\n                 return false;\n             }\n \n-            double value = KisDomUtils::Private::stringToDouble(childEl.attribute(\"value\", \"0\"));\n+            double value = KisDomUtils::toDouble(childEl.attribute(\"value\", \"0\"));\n \n             if (key == \"Hrzn\") {\n                 point.setX(value);\n@@ -428,7 +428,7 @@ bool tryParseDescriptor(const QDomElement &el,\n                     return true;\n                 }\n             } else if (type == \"Double\" && key == \"Intr\") {\n-                double value = KisDomUtils::Private::stringToDouble(childEl.attribute(\"value\", \"4096\"));\n+                double value = KisDomUtils::toDouble(childEl.attribute(\"value\", \"4096\"));\n                 gradientSmoothness = 100.0 * value / 4096.0;\n             } else if (type == \"List\" && key == \"Clrs\") {\n                 parseColorStopsList(childEl, startLocations, middleOffsets, colors);\n@@ -515,11 +515,11 @@ void parseElement(const QDomElement &el, const QString &parentPath, KisAslObject\n \n         catcher.setArrayMode(false);\n     } else if (type == \"Double\") {\n-        double v = KisDomUtils::Private::stringToDouble(el.attribute(\"value\", \"0\"));\n+        double v = KisDomUtils::toDouble(el.attribute(\"value\", \"0\"));\n         catcher.addDouble(buildPath(parentPath, key), v);\n     } else if (type == \"UnitFloat\") {\n         QString unit = el.attribute(\"unit\", \"<unknown>\");\n-        double v = KisDomUtils::Private::stringToDouble(el.attribute(\"value\", \"0\"));\n+        double v = KisDomUtils::toDouble(el.attribute(\"value\", \"0\"));\n         catcher.addUnitFloat(buildPath(parentPath, key), unit, v);\n     } else if (type == \"Text\") {\n         QString v = el.attribute(\"value\", \"\");\n@@ -529,10 +529,10 @@ void parseElement(const QDomElement &el, const QString &parentPath, KisAslObject\n         QString typeId = el.attribute(\"typeId\", \"<unknown>\");\n         catcher.addEnum(buildPath(parentPath, key), typeId, v);\n     } else if (type == \"Integer\") {\n-        int v = KisDomUtils::Private::stringToInt(el.attribute(\"value\", \"0\"));\n+        int v = KisDomUtils::toInt(el.attribute(\"value\", \"0\"));\n         catcher.addInteger(buildPath(parentPath, key), v);\n     } else if (type == \"Boolean\") {\n-        int v = KisDomUtils::Private::stringToInt(el.attribute(\"value\", \"0\"));\n+        int v = KisDomUtils::toInt(el.attribute(\"value\", \"0\"));\n         catcher.addBoolean(buildPath(parentPath, key), v);\n     } else {\n         warnKrita << \"WARNING: XML (ASL) Unknown element type:\" << type << ppVar(parentPath) << ppVar(key);"}, {"sha": "3250119321d5c32c8c3b0c7c848f6e87993237df", "filename": "libs/psd/asl/kis_asl_xml_writer.cpp", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/libs/psd/asl/kis_asl_xml_writer.cpp", "raw_url": "https://github.com/KDE/krita/raw/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/libs/psd/asl/kis_asl_xml_writer.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/psd/asl/kis_asl_xml_writer.cpp?ref=0f4605a679f9612f9fb9227d77ee266fcccdf8ec", "patch": "@@ -118,7 +118,7 @@ void KisAslXmlWriter::writeDouble(const QString &key, double value)\n     }\n \n     el.setAttribute(\"type\", \"Double\");\n-    el.setAttribute(\"value\", KisDomUtils::Private::numberToString(value));\n+    el.setAttribute(\"value\", KisDomUtils::toString(value));\n \n     m_d->currentElement.appendChild(el);\n }\n@@ -132,7 +132,7 @@ void KisAslXmlWriter::writeInteger(const QString &key, int value)\n     }\n \n     el.setAttribute(\"type\", \"Integer\");\n-    el.setAttribute(\"value\", KisDomUtils::Private::numberToString(value));\n+    el.setAttribute(\"value\", KisDomUtils::toString(value));\n \n     m_d->currentElement.appendChild(el);\n }\n@@ -162,7 +162,7 @@ void KisAslXmlWriter::writeUnitFloat(const QString &key, const QString &unit, do\n \n     el.setAttribute(\"type\", \"UnitFloat\");\n     el.setAttribute(\"unit\", unit);\n-    el.setAttribute(\"value\", KisDomUtils::Private::numberToString(value));\n+    el.setAttribute(\"value\", KisDomUtils::toString(value));\n \n     m_d->currentElement.appendChild(el);\n }\n@@ -190,7 +190,7 @@ void KisAslXmlWriter::writeBoolean(const QString &key, bool value)\n     }\n \n     el.setAttribute(\"type\", \"Boolean\");\n-    el.setAttribute(\"value\", KisDomUtils::Private::numberToString(value));\n+    el.setAttribute(\"value\", KisDomUtils::toString(value));\n \n     m_d->currentElement.appendChild(el);\n }"}, {"sha": "f9a31f186262583d4b6d98960118250908c6e574", "filename": "libs/ui/kra/kis_kra_loader.cpp", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/libs/ui/kra/kis_kra_loader.cpp", "raw_url": "https://github.com/KDE/krita/raw/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/libs/ui/kra/kis_kra_loader.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kra/kis_kra_loader.cpp?ref=0f4605a679f9612f9fb9227d77ee266fcccdf8ec", "patch": "@@ -206,20 +206,20 @@ KisImageWSP KisKraLoader::loadXML(const KoXmlElement& element)\n             m_d->errorMessages << i18n(\"Image does not specify a width.\");\n             return KisImageWSP(0);\n         }\n-        width = KisDomUtils::Private::stringToInt(attr);\n+        width = KisDomUtils::toInt(attr);\n \n         if ((attr = element.attribute(HEIGHT)).isNull()) {\n             m_d->errorMessages << i18n(\"Image does not specify a height.\");\n             return KisImageWSP(0);\n         }\n \n-        height = KisDomUtils::Private::stringToInt(attr);\n+        height = KisDomUtils::toInt(attr);\n \n         m_d->imageComment = element.attribute(DESCRIPTION);\n \n         xres = 100.0 / 72.0;\n         if (!(attr = element.attribute(X_RESOLUTION)).isNull()) {\n-            qreal value = KisDomUtils::Private::stringToDouble(attr);\n+            qreal value = KisDomUtils::toDouble(attr);\n \n             if (value > 1.0) {\n                 xres = value / 72.0;\n@@ -228,7 +228,7 @@ KisImageWSP KisKraLoader::loadXML(const KoXmlElement& element)\n \n         yres = 100.0 / 72.0;\n         if (!(attr = element.attribute(Y_RESOLUTION)).isNull()) {\n-            qreal value = KisDomUtils::Private::stringToDouble(attr);\n+            qreal value = KisDomUtils::toDouble(attr);\n             if (value > 1.0) {\n                 yres = value / 72.0;\n             }"}, {"sha": "9f0e02e231a07dade2d2ef6319ae85908b34de65", "filename": "libs/ui/kra/kis_kra_saver.cpp", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/libs/ui/kra/kis_kra_saver.cpp", "raw_url": "https://github.com/KDE/krita/raw/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/libs/ui/kra/kis_kra_saver.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kra/kis_kra_saver.cpp?ref=0f4605a679f9612f9fb9227d77ee266fcccdf8ec", "patch": "@@ -92,16 +92,16 @@ QDomElement KisKraSaver::saveXML(QDomDocument& doc,  KisImageWSP image)\n     Q_ASSERT(image);\n     imageElement.setAttribute(NAME, m_d->imageName);\n     imageElement.setAttribute(MIME, NATIVE_MIMETYPE);\n-    imageElement.setAttribute(WIDTH, KisDomUtils::Private::numberToString(image->width()));\n-    imageElement.setAttribute(HEIGHT, KisDomUtils::Private::numberToString(image->height()));\n+    imageElement.setAttribute(WIDTH, KisDomUtils::toString(image->width()));\n+    imageElement.setAttribute(HEIGHT, KisDomUtils::toString(image->height()));\n     imageElement.setAttribute(COLORSPACE_NAME, image->colorSpace()->id());\n     imageElement.setAttribute(DESCRIPTION, m_d->doc->documentInfo()->aboutInfo(\"comment\"));\n     // XXX: Save profile as blob inside the image, instead of the product name.\n     if (image->profile() && image->profile()-> valid()) {\n         imageElement.setAttribute(PROFILE, image->profile()->name());\n     }\n-    imageElement.setAttribute(X_RESOLUTION, KisDomUtils::Private::numberToString(image->xRes()*72.0));\n-    imageElement.setAttribute(Y_RESOLUTION, KisDomUtils::Private::numberToString(image->yRes()*72.0));\n+    imageElement.setAttribute(X_RESOLUTION, KisDomUtils::toString(image->xRes()*72.0));\n+    imageElement.setAttribute(Y_RESOLUTION, KisDomUtils::toString(image->yRes()*72.0));\n \n     quint32 count = 1; // We don't save the root layer, but it does count\n     KisSaveXmlVisitor visitor(doc, imageElement, count, m_d->doc->url().toLocalFile(), true);"}, {"sha": "0dcfc112edfec466592b076267d97794845c88a5", "filename": "plugins/color/lcms2engine/colorspaces/rgb_u16/RgbU16ColorSpace.cpp", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/plugins/color/lcms2engine/colorspaces/rgb_u16/RgbU16ColorSpace.cpp", "raw_url": "https://github.com/KDE/krita/raw/0f4605a679f9612f9fb9227d77ee266fcccdf8ec/plugins/color/lcms2engine/colorspaces/rgb_u16/RgbU16ColorSpace.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/color/lcms2engine/colorspaces/rgb_u16/RgbU16ColorSpace.cpp?ref=0f4605a679f9612f9fb9227d77ee266fcccdf8ec", "patch": "@@ -71,9 +71,9 @@ void RgbU16ColorSpace::colorToXML(const quint8 *pixel, QDomDocument &doc, QDomEl\n void RgbU16ColorSpace::colorFromXML(quint8 *pixel, const QDomElement &elt) const\n {\n     KoBgrU16Traits::Pixel *p = reinterpret_cast<KoBgrU16Traits::Pixel *>(pixel);\n-    p->red = KoColorSpaceMaths< qreal, KoBgrU16Traits::channels_type >::scaleToA(KisDomUtils::Private::stringToDouble(elt.attribute(\"r\")));\n-    p->green = KoColorSpaceMaths< qreal, KoBgrU16Traits::channels_type >::scaleToA(KisDomUtils::Private::stringToDouble(elt.attribute(\"g\")));\n-    p->blue = KoColorSpaceMaths< qreal, KoBgrU16Traits::channels_type >::scaleToA(KisDomUtils::Private::stringToDouble(elt.attribute(\"b\")));\n+    p->red = KoColorSpaceMaths< qreal, KoBgrU16Traits::channels_type >::scaleToA(KisDomUtils::toDouble(elt.attribute(\"r\")));\n+    p->green = KoColorSpaceMaths< qreal, KoBgrU16Traits::channels_type >::scaleToA(KisDomUtils::toDouble(elt.attribute(\"g\")));\n+    p->blue = KoColorSpaceMaths< qreal, KoBgrU16Traits::channels_type >::scaleToA(KisDomUtils::toDouble(elt.attribute(\"b\")));\n     p->alpha = KoColorSpaceMathsTraits<quint16>::max;\n }\n "}]}, {"sha": "986c5f6fd712b14ff6ac57244ab22872ecd94e65", "stats": {"total": 23, "additions": 13, "deletions": 10}, "files": [{"sha": "03a3b0f24f0fc88d0df342b34a67ecf719d4d0d1", "filename": "libs/ui/kra/kis_kra_loader.cpp", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/KDE/krita/blob/986c5f6fd712b14ff6ac57244ab22872ecd94e65/libs/ui/kra/kis_kra_loader.cpp", "raw_url": "https://github.com/KDE/krita/raw/986c5f6fd712b14ff6ac57244ab22872ecd94e65/libs/ui/kra/kis_kra_loader.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kra/kis_kra_loader.cpp?ref=986c5f6fd712b14ff6ac57244ab22872ecd94e65", "patch": "@@ -206,28 +206,31 @@ KisImageWSP KisKraLoader::loadXML(const KoXmlElement& element)\n             m_d->errorMessages << i18n(\"Image does not specify a width.\");\n             return KisImageWSP(0);\n         }\n-        width = attr.toInt();\n+        width = KisDomUtils::Private::stringToInt(attr);\n \n         if ((attr = element.attribute(HEIGHT)).isNull()) {\n             m_d->errorMessages << i18n(\"Image does not specify a height.\");\n             return KisImageWSP(0);\n         }\n \n-        height = attr.toInt();\n+        height = KisDomUtils::Private::stringToInt(attr);\n \n         m_d->imageComment = element.attribute(DESCRIPTION);\n \n         xres = 100.0 / 72.0;\n         if (!(attr = element.attribute(X_RESOLUTION)).isNull()) {\n-            if (attr.toDouble() > 1.0) {\n-                xres = attr.toDouble() / 72.0;\n+            qreal value = KisDomUtils::Private::stringToDouble(attr);\n+\n+            if (value > 1.0) {\n+                xres = value / 72.0;\n             }\n         }\n \n         yres = 100.0 / 72.0;\n         if (!(attr = element.attribute(Y_RESOLUTION)).isNull()) {\n-            if (attr.toDouble() > 1.0) {\n-                yres = attr.toDouble() / 72.0;\n+            qreal value = KisDomUtils::Private::stringToDouble(attr);\n+            if (value > 1.0) {\n+                yres = value / 72.0;\n             }\n         }\n "}, {"sha": "6bb1ac9547dcf03aeba87ec1002bc52e159b2eae", "filename": "libs/ui/kra/kis_kra_saver.cpp", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/986c5f6fd712b14ff6ac57244ab22872ecd94e65/libs/ui/kra/kis_kra_saver.cpp", "raw_url": "https://github.com/KDE/krita/raw/986c5f6fd712b14ff6ac57244ab22872ecd94e65/libs/ui/kra/kis_kra_saver.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kra/kis_kra_saver.cpp?ref=986c5f6fd712b14ff6ac57244ab22872ecd94e65", "patch": "@@ -92,16 +92,16 @@ QDomElement KisKraSaver::saveXML(QDomDocument& doc,  KisImageWSP image)\n     Q_ASSERT(image);\n     imageElement.setAttribute(NAME, m_d->imageName);\n     imageElement.setAttribute(MIME, NATIVE_MIMETYPE);\n-    imageElement.setAttribute(WIDTH, image->width());\n-    imageElement.setAttribute(HEIGHT, image->height());\n+    imageElement.setAttribute(WIDTH, KisDomUtils::Private::numberToString(image->width()));\n+    imageElement.setAttribute(HEIGHT, KisDomUtils::Private::numberToString(image->height()));\n     imageElement.setAttribute(COLORSPACE_NAME, image->colorSpace()->id());\n     imageElement.setAttribute(DESCRIPTION, m_d->doc->documentInfo()->aboutInfo(\"comment\"));\n     // XXX: Save profile as blob inside the image, instead of the product name.\n     if (image->profile() && image->profile()-> valid()) {\n         imageElement.setAttribute(PROFILE, image->profile()->name());\n     }\n-    imageElement.setAttribute(X_RESOLUTION, image->xRes()*72.0);\n-    imageElement.setAttribute(Y_RESOLUTION, image->yRes()*72.0);\n+    imageElement.setAttribute(X_RESOLUTION, KisDomUtils::Private::numberToString(image->xRes()*72.0));\n+    imageElement.setAttribute(Y_RESOLUTION, KisDomUtils::Private::numberToString(image->yRes()*72.0));\n \n     quint32 count = 1; // We don't save the root layer, but it does count\n     KisSaveXmlVisitor visitor(doc, imageElement, count, m_d->doc->url().toLocalFile(), true);"}]}, {"sha": "538ca7dc159f18d54c373860f92e6e9d27112edb", "stats": {"total": 4, "additions": 3, "deletions": 1}, "files": [{"sha": "69ac801950a7568662e68b60e1634a2da9bf9fc2", "filename": "plugins/tools/basictools/kis_tool_move.cc", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/538ca7dc159f18d54c373860f92e6e9d27112edb/plugins/tools/basictools/kis_tool_move.cc", "raw_url": "https://github.com/KDE/krita/raw/538ca7dc159f18d54c373860f92e6e9d27112edb/plugins/tools/basictools/kis_tool_move.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/basictools/kis_tool_move.cc?ref=538ca7dc159f18d54c373860f92e6e9d27112edb", "patch": "@@ -108,7 +108,9 @@ bool KisToolMove::startStrokeImpl(MoveToolMode mode, const QPoint *pos)\n     if (mode != MoveSelectedLayer && pos) {\n         bool wholeGroup = !selection &&  mode == MoveGroup;\n         node = KisToolUtils::findNode(image->root(), *pos, wholeGroup);\n-        nodes = {node};\n+        if (node) {\n+            nodes = {node};\n+        }\n     }\n \n     if (nodes.isEmpty()) {"}]}, {"sha": "c07d3b7400248088f5b885b0cbb22811559d5ad4", "stats": {"total": 36, "additions": 19, "deletions": 17}, "files": [{"sha": "92d9940ecbb2071074a7045c3b93090037bcbcc4", "filename": "libs/image/kis_signal_compressor.cpp", "status": "modified", "additions": 18, "deletions": 16, "changes": 34, "blob_url": "https://github.com/KDE/krita/blob/c07d3b7400248088f5b885b0cbb22811559d5ad4/libs/image/kis_signal_compressor.cpp", "raw_url": "https://github.com/KDE/krita/raw/c07d3b7400248088f5b885b0cbb22811559d5ad4/libs/image/kis_signal_compressor.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_signal_compressor.cpp?ref=c07d3b7400248088f5b885b0cbb22811559d5ad4", "patch": "@@ -23,26 +23,28 @@\n \n KisSignalCompressor::KisSignalCompressor()\n     : QObject(0)\n+    , m_timer(new QTimer(this))\n     , m_mode(UNDEFINED)\n     , m_gotSignals(false)\n {\n-    m_timer.setSingleShot(true);\n-    connect(&m_timer, SIGNAL(timeout()), SLOT(slotTimerExpired()));\n+    m_timer->setSingleShot(true);\n+    connect(m_timer, SIGNAL(timeout()), SLOT(slotTimerExpired()));\n }\n \n KisSignalCompressor::KisSignalCompressor(int delay, Mode mode, QObject *parent)\n     : QObject(parent),\n+      m_timer(new QTimer(this)),\n       m_mode(mode),\n       m_gotSignals(false)\n {\n-    m_timer.setSingleShot(true);\n-    m_timer.setInterval(delay);\n-    connect(&m_timer, SIGNAL(timeout()), SLOT(slotTimerExpired()));\n+    m_timer->setSingleShot(true);\n+    m_timer->setInterval(delay);\n+    connect(m_timer, SIGNAL(timeout()), SLOT(slotTimerExpired()));\n }\n \n void KisSignalCompressor::setDelay(int delay)\n {\n-    m_timer.setInterval(delay);\n+    m_timer->setInterval(delay);\n }\n \n void KisSignalCompressor::start()\n@@ -51,31 +53,31 @@ void KisSignalCompressor::start()\n \n     switch (m_mode) {\n     case POSTPONE:\n-        m_timer.start();\n+        m_timer->start();\n         break;\n     case FIRST_ACTIVE_POSTPONE_NEXT:\n     case FIRST_ACTIVE:\n-        if (!m_timer.isActive()) {\n+        if (!m_timer->isActive()) {\n             m_gotSignals = false;\n-            m_timer.start();\n+            m_timer->start();\n             emit timeout();\n         } else {\n             m_gotSignals = true;\n             if (m_mode == FIRST_ACTIVE_POSTPONE_NEXT) {\n-                m_timer.start();\n+                m_timer->start();\n             }\n         }\n         break;\n     case FIRST_INACTIVE:\n-        if (!m_timer.isActive()) {\n-            m_timer.start();\n+        if (!m_timer->isActive()) {\n+            m_timer->start();\n         }\n     case UNDEFINED:\n         ; // Should never happen, but do nothing\n     };\n \n-    if (m_mode == POSTPONE || !m_timer.isActive()) {\n-        m_timer.start();\n+    if (m_mode == POSTPONE || !m_timer->isActive()) {\n+        m_timer->start();\n     }\n }\n \n@@ -90,12 +92,12 @@ void KisSignalCompressor::slotTimerExpired()\n \n void KisSignalCompressor::stop()\n {\n-    m_timer.stop();\n+    m_timer->stop();\n }\n \n bool KisSignalCompressor::isActive() const\n {\n-    return m_timer.isActive() && (m_mode != FIRST_ACTIVE || m_gotSignals);\n+    return m_timer->isActive() && (m_mode != FIRST_ACTIVE || m_gotSignals);\n }\n \n void KisSignalCompressor::setMode(KisSignalCompressor::Mode mode)"}, {"sha": "88ab8f925aec5f03870333e4c0a7b7c51366793d", "filename": "libs/image/kis_signal_compressor.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/c07d3b7400248088f5b885b0cbb22811559d5ad4/libs/image/kis_signal_compressor.h", "raw_url": "https://github.com/KDE/krita/raw/c07d3b7400248088f5b885b0cbb22811559d5ad4/libs/image/kis_signal_compressor.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_signal_compressor.h?ref=c07d3b7400248088f5b885b0cbb22811559d5ad4", "patch": "@@ -85,7 +85,7 @@ private Q_SLOTS:\n     void timeout();\n \n private:\n-    QTimer m_timer;\n+    QTimer *m_timer;\n     Mode m_mode;\n     bool m_gotSignals;\n };"}]}, {"sha": "d9c68ec2f32e7db3564db1f269500ac0fa4bd57b", "stats": {"total": 111, "additions": 0, "deletions": 111}, "files": [{"sha": "9d318dfbcc865050b5558357fd558b518f5700c4", "filename": "CMakeLists.txt", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/d9c68ec2f32e7db3564db1f269500ac0fa4bd57b/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/d9c68ec2f32e7db3564db1f269500ac0fa4bd57b/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=d9c68ec2f32e7db3564db1f269500ac0fa4bd57b", "patch": "@@ -574,12 +574,6 @@ include (TestBigEndian)\n test_big_endian(CMAKE_WORDS_BIGENDIAN)\n \n ##\n-## Test SharedMimeInfo\n-##\n-macro_optional_find_package(SharedMimeInfo)\n-macro_log_feature(SHARED_MIME_INFO_FOUND \"SharedMimeInfo\" \"Shared Mime Info\" \"http://freedesktop.org/wiki/Software/shared-mime-info\" FALSE \"\" \"Required to determine file types OpenRaster (Krita default format).\")\n-\n-##\n ## Test for qt-poppler\n ##\n macro_optional_find_package(Poppler)"}, {"sha": "74adbd2497500fc9bfedf8de80b59c8be3e659a0", "filename": "krita/data/CMakeLists.txt", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/d9c68ec2f32e7db3564db1f269500ac0fa4bd57b/krita/data/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/d9c68ec2f32e7db3564db1f269500ac0fa4bd57b/krita/data/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/data/CMakeLists.txt?ref=d9c68ec2f32e7db3564db1f269500ac0fa4bd57b", "patch": "@@ -12,7 +12,6 @@ add_subdirectory( input )\n add_subdirectory( shortcuts )\n add_subdirectory( paintoppresets )\n add_subdirectory( palettes )\n-add_subdirectory( mime )\n \n ########### install files ###############\n "}, {"sha": "5b758a1d7adeeb17f773aa56d7401110fe340745", "filename": "krita/data/mime/CMakeLists.txt", "status": "removed", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/KDE/krita/blob/048ea24041a42515757811546258b3bcbc9d812c/krita/data/mime/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/048ea24041a42515757811546258b3bcbc9d812c/krita/data/mime/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/data/mime/CMakeLists.txt?ref=048ea24041a42515757811546258b3bcbc9d812c", "patch": "@@ -1,9 +0,0 @@\n-install( FILES\n-    krita.xml\n-    x-gimp-brush-animated.xml\n-    x-gimp-brush.xml\n-    DESTINATION ${XDG_MIME_INSTALL_DIR}\n-)\n-if (SHARED_MIME_INFO_FOUND)\n-    update_xdg_mimetypes(${XDG_MIME_INSTALL_DIR})\n-endif()"}, {"sha": "9d393c28942e4d176cf6cdf043d22c72d83cacc0", "filename": "krita/data/mime/krita.xml", "status": "removed", "additions": 0, "deletions": 36, "changes": 36, "blob_url": "https://github.com/KDE/krita/blob/048ea24041a42515757811546258b3bcbc9d812c/krita/data/mime/krita.xml", "raw_url": "https://github.com/KDE/krita/raw/048ea24041a42515757811546258b3bcbc9d812c/krita/data/mime/krita.xml", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/data/mime/krita.xml?ref=048ea24041a42515757811546258b3bcbc9d812c", "patch": "@@ -1,36 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-<mime-info xmlns=\"http://www.freedesktop.org/standards/shared-mime-info\">\n-  <mime-type type=\"application/x-krita-paintoppreset\">\n-         <sub-class-of type=\"image/png\"/>\n-         <comment xml:lang=\"en\">Krita Brush Preset</comment>\n-         <glob pattern=\"*.kpp\"/>\n-  </mime-type>\n-  <mime-type type=\"application/x-krita-assistant\">\n-         <comment xml:lang=\"en\">Krita Assistant</comment>\n-         <magic priority=\"50\">\n-             <match type=\"string\" value=\"paintingassistant\" offset=\"40\"/>\n-         </magic>\n-         <glob pattern=\"*.krassistant\"/>\n-  </mime-type>\n-  <mime-type type=\"image/x-r16\">\n-         <comment xml:lang=\"en\">r16 heightmap</comment>\n-         <magic priority=\"50\">\n-             <match type=\"string\" value=\"r16heightmap\" offset=\"40\"/>\n-         </magic>\n-         <glob pattern=\"*.r16\"/>\n-  </mime-type>\n-  <mime-type type=\"image/x-r8\">\n-         <comment xml:lang=\"en\">r8 heightmap</comment>\n-         <magic priority=\"50\">\n-             <match type=\"string\" value=\"r8heightmap\" offset=\"40\"/>\n-         </magic>\n-         <glob pattern=\"*.r8\"/>\n-  </mime-type>\n-  <mime-type type=\"application/x-spriter\">\n-         <comment xml:lang=\"en\">Spriter SCML</comment>\n-         <magic priority=\"50\">\n-             <match type=\"string\" value=\"spriter_data scml_version\" offset=\"40\"/>\n-         </magic>\n-         <glob pattern=\"*.scml\"/>\n-  </mime-type>\n-</mime-info>"}, {"sha": "dfa19014014375568fee85bc1d0d1bfad30f2dcc", "filename": "krita/data/mime/x-gimp-brush-animated.xml", "status": "removed", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/KDE/krita/blob/048ea24041a42515757811546258b3bcbc9d812c/krita/data/mime/x-gimp-brush-animated.xml", "raw_url": "https://github.com/KDE/krita/raw/048ea24041a42515757811546258b3bcbc9d812c/krita/data/mime/x-gimp-brush-animated.xml", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/data/mime/x-gimp-brush-animated.xml?ref=048ea24041a42515757811546258b3bcbc9d812c", "patch": "@@ -1,7 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<mime-info xmlns=\"http://www.freedesktop.org/standards/shared-mime-info\">\n-  <mime-type type=\"image/x-gimp-brush-animated\">\n-    <comment>Gimp Image Hose Brush</comment>\n-    <glob pattern=\"*.gih\"/>\n-  </mime-type>\n-</mime-info>"}, {"sha": "8bbb9c699d025c8954f5def3a4f63820ba602322", "filename": "krita/data/mime/x-gimp-brush.xml", "status": "removed", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/048ea24041a42515757811546258b3bcbc9d812c/krita/data/mime/x-gimp-brush.xml", "raw_url": "https://github.com/KDE/krita/raw/048ea24041a42515757811546258b3bcbc9d812c/krita/data/mime/x-gimp-brush.xml", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/data/mime/x-gimp-brush.xml?ref=048ea24041a42515757811546258b3bcbc9d812c", "patch": "@@ -1,8 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<mime-info xmlns=\"http://www.freedesktop.org/standards/shared-mime-info\">\n-  <mime-type type=\"image/x-gimp-brush\">\n-    <comment>Gimp Brush</comment>\n-    <glob pattern=\"*.gbr\"/>\n-    <glob pattern=\"*.vbr\"/>\n-  </mime-type>\n-</mime-info>"}, {"sha": "d6410e99d359f978451dc4d66578fc42d39e319c", "filename": "linux/build-image.sh", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/d9c68ec2f32e7db3564db1f269500ac0fa4bd57b/linux/build-image.sh", "raw_url": "https://github.com/KDE/krita/raw/d9c68ec2f32e7db3564db1f269500ac0fa4bd57b/linux/build-image.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/linux/build-image.sh?ref=d9c68ec2f32e7db3564db1f269500ac0fa4bd57b", "patch": "@@ -60,9 +60,6 @@ make -j4 install\n \n cd /krita.appdir\n \n-# Remove the mimedir, it confuses the file dialog on redhat-derived distributions\n-rm -rf usr/share/mime\n-\n # FIXME: How to find out which subset of plugins is really needed? I used strace when running the binary\n cp -r /usr/plugins ./usr/bin/\n # copy the Qt translation"}, {"sha": "2d1f9f5995cdc6f551715f6b7835f55331187626", "filename": "plugins/flake/vectorshape/CMakeLists.txt", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/d9c68ec2f32e7db3564db1f269500ac0fa4bd57b/plugins/flake/vectorshape/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/d9c68ec2f32e7db3564db1f269500ac0fa4bd57b/plugins/flake/vectorshape/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/flake/vectorshape/CMakeLists.txt?ref=d9c68ec2f32e7db3564db1f269500ac0fa4bd57b", "patch": "@@ -16,8 +16,3 @@ target_link_libraries(krita_shape_vector kritaflake kritawidgets kritavectorimag\n \n install(TARGETS krita_shape_vector DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n-if (SHARED_MIME_INFO_FOUND)\n-    install(FILES krita_svm.xml DESTINATION ${XDG_MIME_INSTALL_DIR})\n-    update_xdg_mimetypes(${XDG_MIME_INSTALL_DIR})\n-endif ()\n-"}, {"sha": "4ed9a7f78117eba4e7c8726fda376079d4102acb", "filename": "plugins/flake/vectorshape/krita_svm.xml", "status": "removed", "additions": 0, "deletions": 13, "changes": 13, "blob_url": "https://github.com/KDE/krita/blob/048ea24041a42515757811546258b3bcbc9d812c/plugins/flake/vectorshape/krita_svm.xml", "raw_url": "https://github.com/KDE/krita/raw/048ea24041a42515757811546258b3bcbc9d812c/plugins/flake/vectorshape/krita_svm.xml", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/flake/vectorshape/krita_svm.xml?ref=048ea24041a42515757811546258b3bcbc9d812c", "patch": "@@ -1,13 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-<!--\n- Remove as soon as this lands in shared-mime-info and we depend on that version.\n--->\n-<mime-info xmlns=\"http://www.freedesktop.org/standards/shared-mime-info\">\n-  <mime-type type=\"image/x-svm\">\n-    <comment>StarView Metafile</comment>\n-    <magic priority=\"50\">\n-      <match type=\"string\" value=\"VCLMTF\" offset=\"0\"/>\n-    </magic>\n-    <glob pattern=\"*.svm\"/>\n-  </mime-type>\n-</mime-info>"}, {"sha": "8d61fa8555c1b68c19297550d776cdb6b3fa6426", "filename": "plugins/impex/ora/CMakeLists.txt", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/d9c68ec2f32e7db3564db1f269500ac0fa4bd57b/plugins/impex/ora/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/d9c68ec2f32e7db3564db1f269500ac0fa4bd57b/plugins/impex/ora/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/ora/CMakeLists.txt?ref=d9c68ec2f32e7db3564db1f269500ac0fa4bd57b", "patch": "@@ -32,8 +32,3 @@ if(SHOULD_BUILD_FILEMANAGER_THUMBNAIL)\n     install( FILES  krita_ora_thumbnail.desktop  DESTINATION ${SERVICES_INSTALL_DIR})\n endif()\n \n-\n-install(FILES krita_ora.xml DESTINATION ${XDG_MIME_INSTALL_DIR})\n-if (SHARED_MIME_INFO_FOUND)\n-    update_xdg_mimetypes(${XDG_MIME_INSTALL_DIR})\n-endif()"}, {"sha": "1e245cdf00d337cf1e3f93730cc42c2be11e406b", "filename": "plugins/impex/ora/krita_ora.xml", "status": "removed", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/KDE/krita/blob/048ea24041a42515757811546258b3bcbc9d812c/plugins/impex/ora/krita_ora.xml", "raw_url": "https://github.com/KDE/krita/raw/048ea24041a42515757811546258b3bcbc9d812c/plugins/impex/ora/krita_ora.xml", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/ora/krita_ora.xml?ref=048ea24041a42515757811546258b3bcbc9d812c", "patch": "@@ -1,18 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-<!--\n-Copy of the image/openraster, shipped with shared-mime-info > 0.60.\n-Remove as soon as krita depends on that version.\n--->\n-<mime-info xmlns=\"http://www.freedesktop.org/standards/shared-mime-info\">\n-  <mime-type type=\"image/openraster\">\n-    <comment>OpenRaster archiving image</comment>\n-    <magic priority=\"50\">\n-      <match type=\"string\" value=\"PK\\003\\004\" offset=\"0\">\n-        <match type=\"string\" value=\"mimetype\" offset=\"30\">\n-          <match type=\"string\" value=\"image/openraster\" offset=\"38\"/>\n-        </match>\n-      </match>\n-    </magic>\n-    <glob pattern=\"*.ora\"/>\n-  </mime-type>\n-</mime-info>"}]}, {"sha": "048ea24041a42515757811546258b3bcbc9d812c", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "43e92947dd9b1d59e694d2d7e77577e0e99f42de", "filename": "plugins/extensions/gmic/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/048ea24041a42515757811546258b3bcbc9d812c/plugins/extensions/gmic/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/048ea24041a42515757811546258b3bcbc9d812c/plugins/extensions/gmic/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/gmic/CMakeLists.txt?ref=048ea24041a42515757811546258b3bcbc9d812c", "patch": "@@ -47,7 +47,7 @@ if (Threads_FOUND)\n endif()\n \n #OpenMP\n-if(OPENMP_FOUND AND CMAKE_CXX_COMPILER_VERSION_GREATER 4.8.3 AND CMAKE_COMPILER_IS_GNUCC)\n+if (CMAKE_COMPILER_IS_GNUCC AND CMAKE_CXX_COMPILER_VERSION VERSION_GREATER 4.8.3 AND OPENMP_FOUND)\n     message(\"G'Mic: using OpenMP\")\n     set (CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} ${OpenMP_CXX_FLAGS}\")\n     add_definitions(-Dcimg_use_openmp)"}]}, {"sha": "d5301ccbdae431fab64b42c25e63fa572dce6285", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "8fd42a1b83e2e394f411c01027a75cac096f28ed", "filename": "plugins/extensions/gmic/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/d5301ccbdae431fab64b42c25e63fa572dce6285/plugins/extensions/gmic/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/d5301ccbdae431fab64b42c25e63fa572dce6285/plugins/extensions/gmic/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/gmic/CMakeLists.txt?ref=d5301ccbdae431fab64b42c25e63fa572dce6285", "patch": "@@ -47,7 +47,7 @@ if (Threads_FOUND)\n endif()\n \n #OpenMP\n-if(OPENMP_FOUND)\n+if(OPENMP_FOUND AND CMAKE_CXX_COMPILER_VERSION_GREATER 4.8.3 AND CMAKE_COMPILER_IS_GNUCC)\n     message(\"G'Mic: using OpenMP\")\n     set (CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} ${OpenMP_CXX_FLAGS}\")\n     add_definitions(-Dcimg_use_openmp)"}]}, {"sha": "2b35122a513c062a28e302e86c6c5d18cdb3d594", "stats": {"total": 3, "additions": 3, "deletions": 0}, "files": [{"sha": "01ae9fb7023ccd9bdd6b0dd700543f3a10cf5ea7", "filename": "linux/build-image.sh", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/2b35122a513c062a28e302e86c6c5d18cdb3d594/linux/build-image.sh", "raw_url": "https://github.com/KDE/krita/raw/2b35122a513c062a28e302e86c6c5d18cdb3d594/linux/build-image.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/linux/build-image.sh?ref=2b35122a513c062a28e302e86c6c5d18cdb3d594", "patch": "@@ -60,6 +60,9 @@ make -j4 install\n \n cd /krita.appdir\n \n+# Remove the mimedir, it confuses the file dialog on redhat-derived distributions\n+rm -rf usr/share/mime\n+\n # FIXME: How to find out which subset of plugins is really needed? I used strace when running the binary\n cp -r /usr/plugins ./usr/bin/\n # copy the Qt translation"}]}, {"sha": "2ac6e594922442fa6382ffde0d658a4c66be321b", "stats": {"total": 19, "additions": 13, "deletions": 6}, "files": [{"sha": "58e8c44d88bb88bdc752984409e0be31ae5b58e5", "filename": "libs/widgetutils/KoFileDialog.cpp", "status": "modified", "additions": 13, "deletions": 6, "changes": 19, "blob_url": "https://github.com/KDE/krita/blob/2ac6e594922442fa6382ffde0d658a4c66be321b/libs/widgetutils/KoFileDialog.cpp", "raw_url": "https://github.com/KDE/krita/raw/2ac6e594922442fa6382ffde0d658a4c66be321b/libs/widgetutils/KoFileDialog.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/KoFileDialog.cpp?ref=2ac6e594922442fa6382ffde0d658a4c66be321b", "patch": "@@ -393,16 +393,23 @@ const QStringList KoFileDialog::getFilterStringListFromMime(const QStringList &m\n     QStringList ret;\n \n     Q_FOREACH(const QString &mimeType, mimeList) {\n-        //qDebug() << \"mimeType\" << mimeType << \"seen\" << mimeSeen.contains(mimeType) << \"swap extension order\" << d->swapExtensionOrder;\n+        qDebug() << \"mimeType\" << mimeType << \"seen\" << mimeSeen.contains(mimeType) << \"swap extension order\" << d->swapExtensionOrder;\n \n         if (!mimeSeen.contains(mimeType)) {\n             QString description = KisMimeDatabase::descriptionForMimeType(mimeType);\n-            //qDebug() << \"\\tdescription:\" << description;\n+            qDebug() << \"\\tdescription:\" << description;\n+            if (description.isEmpty()) {\n+                description = mimeType.split(\"/\")[1];\n+                if (description.startsWith(\"x-\")) {\n+                    description = description.remove(0, 2);\n+                }\n+                qDebug() << \"\\t\\tdescription:\" << description;\n+            }\n \n \n             QString oneFilter;\n             QStringList patterns = KisMimeDatabase::suffixesForMimeType(mimeType);\n-            //qDebug() << \"\\tpatterns:\" << patterns;\n+            qDebug() << \"\\tpatterns:\" << patterns;\n             QStringList globPatterns;\n             Q_FOREACH(const QString &pattern, patterns) {\n                 if (pattern.startsWith(\".\")) {\n@@ -451,7 +458,7 @@ const QStringList KoFileDialog::getFilterStringListFromMime(const QStringList &m\n             Q_ASSERT(!description.isEmpty());\n \n             oneFilter = description + \" ( \" + oneFilter + \")\";\n-            //qDebug() << \">>>>>>>>>>>>>>>>>>>\" << oneFilter;\n+            qDebug() << \">>>>>>>>>>>>>>>>>>>\" << oneFilter;\n \n \n             if (mimeType == \"application/x-krita\") {\n@@ -476,8 +483,8 @@ const QStringList KoFileDialog::getFilterStringListFromMime(const QStringList &m\n     if (!kritaNative.isEmpty())  ret.prepend(kritaNative);\n     if (!allSupported.isEmpty()) ret.prepend(i18n(\"All supported formats\") + \" ( \" + allSupported + (\")\"));\n \n-    //qDebug() << \"Result:\\n\" << ret;\n-    //qDebug() << \"===============================\";\n+    qDebug() << \"Result:\\n\" << ret;\n+    qDebug() << \"===============================\";\n \n \n     return ret;"}]}, {"sha": "48b30f11d5f708d75904fd8cac1ad86fe869526f", "stats": {"total": 0, "additions": 0, "deletions": 0}, "files": [{"sha": "6f5a421c77f1432a6897454d91a3fbe24c40a7e9", "filename": "windows/krita.lnk", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/KDE/krita/blob/48b30f11d5f708d75904fd8cac1ad86fe869526f/windows/krita.lnk", "raw_url": "https://github.com/KDE/krita/raw/48b30f11d5f708d75904fd8cac1ad86fe869526f/windows/krita.lnk", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/krita.lnk?ref=48b30f11d5f708d75904fd8cac1ad86fe869526f"}]}, {"sha": "a514cd3dc1628587542b1cf1dceace4b30179765", "stats": {"total": 8, "additions": 4, "deletions": 4}, "files": [{"sha": "9279f1f064990a536f12381e242e18d85ef8be56", "filename": "plugins/extensions/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/a514cd3dc1628587542b1cf1dceace4b30179765/plugins/extensions/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/a514cd3dc1628587542b1cf1dceace4b30179765/plugins/extensions/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/CMakeLists.txt?ref=a514cd3dc1628587542b1cf1dceace4b30179765", "patch": "@@ -18,9 +18,7 @@ add_subdirectory( layersplit )\n # Allow to skip building GMIC plugin\n option(WITH_GMIC \"Build the G'Mic plugin\" ON)\n if(WITH_GMIC)\n-# Only build gmic with gcc; msvc is broken, and now dtschump tells is that on OSX\n-# gcc should be used as well because clang is broken.\n-if (CMAKE_COMPILER_IS_GNUCC AND CMAKE_CXX_COMPILER_VERSION VERSION_GREATER 4.8.3)\n+if (CMAKE_COMPILER_IS_GNUCC)\n     add_subdirectory( gmic )\n endif()\n endif()"}, {"sha": "0027a3b50a00f2dd9598d03203dd4d1f903fd431", "filename": "plugins/extensions/gmic/CMakeLists.txt", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/a514cd3dc1628587542b1cf1dceace4b30179765/plugins/extensions/gmic/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/a514cd3dc1628587542b1cf1dceace4b30179765/plugins/extensions/gmic/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/gmic/CMakeLists.txt?ref=a514cd3dc1628587542b1cf1dceace4b30179765", "patch": "@@ -121,7 +121,9 @@ if(CURL_FOUND)\n     target_link_libraries(gmic ${CURL_LIBRARIES})\n endif()\n \n-if(OPENMP_FOUND)\n+# Only build gmic with gcc; msvc is broken, and now dtschump tells is that on OSX\n+# gcc should be used as well because clang is broken.\n+if (CMAKE_COMPILER_IS_GNUCC AND CMAKE_CXX_COMPILER_VERSION VERSION_GREATER 4.8.3 AND OPENMP_FOUND)\n     target_link_libraries(gmic ${OPENMP_LIBRARIES})\n endif()\n "}]}, {"sha": "3ea697da75d9e8c3348ea258560e73011313d9c4", "stats": {"total": 32, "additions": 31, "deletions": 1}, "files": [{"sha": "c52d84a20c7238dfb35487dd3c285f4d0d919bb1", "filename": "libs/flake/KoToolManager.cpp", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/3ea697da75d9e8c3348ea258560e73011313d9c4/libs/flake/KoToolManager.cpp", "raw_url": "https://github.com/KDE/krita/raw/3ea697da75d9e8c3348ea258560e73011313d9c4/libs/flake/KoToolManager.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/flake/KoToolManager.cpp?ref=3ea697da75d9e8c3348ea258560e73011313d9c4", "patch": "@@ -502,6 +502,11 @@ void KoToolManager::updateToolShortcuts()\n     // }\n }\n \n+void KoToolManager::initializeCurrentToolForCanvas()\n+{\n+    d->postSwitchTool(false);\n+}\n+\n KoToolManager* KoToolManager::instance()\n {\n     return s_instance;"}, {"sha": "d1fe74d91a402c826a04e4ef28841d31cca3b10d", "filename": "libs/flake/KoToolManager.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/3ea697da75d9e8c3348ea258560e73011313d9c4/libs/flake/KoToolManager.h", "raw_url": "https://github.com/KDE/krita/raw/3ea697da75d9e8c3348ea258560e73011313d9c4/libs/flake/KoToolManager.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/flake/KoToolManager.h?ref=3ea697da75d9e8c3348ea258560e73011313d9c4", "patch": "@@ -236,6 +236,8 @@ class KRITAFLAKE_EXPORT KoToolManager : public QObject\n     /// Returns the toolId of the currently active tool\n     QString activeToolId() const;\n \n+    void initializeCurrentToolForCanvas();\n+\n     class Private;\n     /**\n      * \\internal return the private object for the toolmanager."}, {"sha": "47c826a9326d1b2c6c09e32c28fb8e74c2d284c6", "filename": "libs/ui/KisMainWindow.cpp", "status": "modified", "additions": 24, "deletions": 1, "changes": 25, "blob_url": "https://github.com/KDE/krita/blob/3ea697da75d9e8c3348ea258560e73011313d9c4/libs/ui/KisMainWindow.cpp", "raw_url": "https://github.com/KDE/krita/raw/3ea697da75d9e8c3348ea258560e73011313d9c4/libs/ui/KisMainWindow.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisMainWindow.cpp?ref=3ea697da75d9e8c3348ea258560e73011313d9c4", "patch": "@@ -577,14 +577,37 @@ void KisMainWindow::showView(KisView *imageView)\n         subwin->setOption(QMdiSubWindow::RubberBandResize, cfg.readEntry<int>(\"mdi_rubberband\", cfg.useOpenGL()));\n         subwin->setWindowIcon(qApp->windowIcon());\n \n+        setActiveView(imageView);\n+\n+        /**\n+         * Hack alert!\n+         *\n+         * Here we explicitly request KoToolManager to emit all the tool\n+         * activation signals, to reinitialize the tool options docker.\n+         *\n+         * That is needed due to a design flaw we have in the\n+         * initialization procedure.  The tool in the KoToolManager is\n+         * initialized in KisView::setViewManager() calls, which\n+         * happens early enough. During this call the tool manager\n+         * requests KoCanvasControllerWidget to emit the signal to\n+         * update the widgets in the tool docker. *But* at that moment\n+         * of time the view is not yet connected to the main window,\n+         * because it happens in KisViewManager::setCurrentView a bit\n+         * later. This fact makes the widgets updating signals be lost\n+         * and never reach the tool docker.\n+         *\n+         * So here we just explicitly call the tool activation stub.\n+         */\n+\n+        KoToolManager::instance()->initializeCurrentToolForCanvas();\n+\n         if (d->mdiArea->subWindowList().size() == 1) {\n             imageView->showMaximized();\n         }\n         else {\n             imageView->show();\n         }\n \n-        setActiveView(imageView);\n         updateWindowMenu();\n         updateCaption();\n     }"}]}, {"sha": "260745dfe6b893bdb25f2f101cd4728453240a5a", "stats": {"total": 69, "additions": 58, "deletions": 11}, "files": [{"sha": "c180483b6a29dadd8ae1791531f1e919cf7dedbe", "filename": "libs/ui/canvas/kis_infinity_manager.cpp", "status": "modified", "additions": 58, "deletions": 11, "changes": 69, "blob_url": "https://github.com/KDE/krita/blob/260745dfe6b893bdb25f2f101cd4728453240a5a/libs/ui/canvas/kis_infinity_manager.cpp", "raw_url": "https://github.com/KDE/krita/raw/260745dfe6b893bdb25f2f101cd4728453240a5a/libs/ui/canvas/kis_infinity_manager.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/canvas/kis_infinity_manager.cpp?ref=260745dfe6b893bdb25f2f101cd4728453240a5a", "patch": "@@ -166,6 +166,50 @@ inline int expandRight(int x0, int x1, int maxExpand)\n     return qMin(x0 + maxExpand, qMax(x0, x1));\n }\n \n+inline QPoint getPointFromEvent(QEvent *event)\n+{\n+    QPoint result;\n+\n+    if (event->type() == QEvent::MouseMove ||\n+        event->type() == QEvent::MouseButtonPress ||\n+        event->type() == QEvent::MouseButtonRelease) {\n+\n+        QMouseEvent *mouseEvent = static_cast<QMouseEvent*>(event);\n+        result = mouseEvent->pos();\n+\n+    } else if (event->type() == QEvent::TabletMove ||\n+               event->type() == QEvent::TabletPress ||\n+               event->type() == QEvent::TabletRelease) {\n+\n+        QTabletEvent *tabletEvent = static_cast<QTabletEvent*>(event);\n+        result = tabletEvent->pos();\n+    }\n+\n+    return result;\n+}\n+\n+inline Qt::MouseButton getButtonFromEvent(QEvent *event)\n+{\n+    Qt::MouseButton button = Qt::NoButton;\n+\n+    if (event->type() == QEvent::MouseMove ||\n+        event->type() == QEvent::MouseButtonPress ||\n+        event->type() == QEvent::MouseButtonRelease) {\n+\n+        QMouseEvent *mouseEvent = static_cast<QMouseEvent*>(event);\n+        button = mouseEvent->button();\n+\n+    } else if (event->type() == QEvent::TabletMove ||\n+               event->type() == QEvent::TabletPress ||\n+               event->type() == QEvent::TabletRelease) {\n+\n+        QTabletEvent *tabletEvent = static_cast<QTabletEvent*>(event);\n+        button = tabletEvent->button();\n+    }\n+\n+    return button;\n+}\n+\n bool KisInfinityManager::eventFilter(QObject *obj, QEvent *event)\n {\n     /**\n@@ -183,10 +227,11 @@ bool KisInfinityManager::eventFilter(QObject *obj, QEvent *event)\n     switch (event->type()) {\n     case QEvent::Enter:\n     case QEvent::Leave:\n-    case QEvent::MouseMove: {\n-        QMouseEvent *mouseEvent = static_cast<QMouseEvent*>(event);\n+    case QEvent::MouseMove:\n+    case QEvent::TabletMove: {\n+        QPoint pos = getPointFromEvent(event);\n \n-        if (m_decorationPath.contains(mouseEvent->pos())) {\n+        if (m_decorationPath.contains(pos)) {\n             if (!m_cursorSwitched) {\n                 m_oldCursor = m_canvas->canvasWidget()->cursor();\n                 m_cursorSwitched = true;\n@@ -199,22 +244,24 @@ bool KisInfinityManager::eventFilter(QObject *obj, QEvent *event)\n         }\n         break;\n     }\n-    case QEvent::MouseButtonPress: {\n-        QMouseEvent *mouseEvent = static_cast<QMouseEvent*>(event);\n-        retval = mouseEvent->button() == Qt::LeftButton && m_cursorSwitched;\n+    case QEvent::MouseButtonPress:\n+    case QEvent::TabletPress: {\n+        Qt::MouseButton button = getButtonFromEvent(event);\n+        retval = button == Qt::LeftButton && m_cursorSwitched;\n \n-        if (mouseEvent->button() == Qt::RightButton) {\n+        if (button == Qt::RightButton) {\n             imagePositionChanged();\n         }\n \n         break;\n     }\n-    case QEvent::MouseButtonRelease: {\n-        QMouseEvent *mouseEvent = static_cast<QMouseEvent*>(event);\n-        retval = mouseEvent->button() == Qt::LeftButton && m_cursorSwitched;\n+    case QEvent::MouseButtonRelease:\n+    case QEvent::TabletRelease: {\n+        Qt::MouseButton button = getButtonFromEvent(event);\n+        retval = button == Qt::LeftButton && m_cursorSwitched;\n \n         if (retval) {\n-            QPoint pos = mouseEvent->pos();\n+            QPoint pos = getPointFromEvent(event);\n \n             const KisCoordinatesConverter *converter = m_canvas->coordinatesConverter();\n             QRect widgetRect = converter->widgetToImage(m_canvas->canvasWidget()->rect()).toAlignedRect();"}]}, {"sha": "3d152322866a64e757c1a664cc8eac41223f406a", "stats": {"total": 29, "additions": 19, "deletions": 10}, "files": [{"sha": "ad3879730a02676ad003c520d1a1d7f0a4732a04", "filename": "libs/ui/canvas/kis_mirror_axis.cpp", "status": "modified", "additions": 19, "deletions": 10, "changes": 29, "blob_url": "https://github.com/KDE/krita/blob/3d152322866a64e757c1a664cc8eac41223f406a/libs/ui/canvas/kis_mirror_axis.cpp", "raw_url": "https://github.com/KDE/krita/raw/3d152322866a64e757c1a664cc8eac41223f406a/libs/ui/canvas/kis_mirror_axis.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/canvas/kis_mirror_axis.cpp?ref=3d152322866a64e757c1a664cc8eac41223f406a", "patch": "@@ -223,44 +223,53 @@ void KisMirrorAxis::drawDecoration(QPainter& gc, const QRectF& updateArea, const\n \n bool KisMirrorAxis::eventFilter(QObject* target, QEvent* event)\n {\n+    if (!view() || target != view()->canvasBase()->canvasWidget()) return false;\n+\n     if(event->type() == QEvent::MouseButtonPress || event->type() == QEvent::TabletPress) {\n-        QMouseEvent* me = static_cast<QMouseEvent*>(event);\n-        if(d->mirrorHorizontal && d->horizontalHandle.contains(me->posF())) {\n+        QMouseEvent *me = dynamic_cast<QMouseEvent*>(event);\n+        QTabletEvent *te = dynamic_cast<QTabletEvent*>(event);\n+        QPoint pos = me ? me->pos() : (te ? te->pos() : QPoint(77,77));\n+\n+        if(d->mirrorHorizontal && d->horizontalHandle.contains(pos)) {\n             d->xActive = true;\n             QApplication::setOverrideCursor(Qt::ClosedHandCursor);\n             event->accept();\n             return true;\n         }\n \n-        if(d->mirrorVertical && d->verticalHandle.contains(me->posF())) {\n+        if(d->mirrorVertical && d->verticalHandle.contains(pos)) {\n             d->yActive = true;\n             QApplication::setOverrideCursor(Qt::ClosedHandCursor);\n             event->accept();\n             return true;\n         }\n     }\n     if(event->type() == QEvent::MouseMove || event->type() == QEvent::TabletMove) {\n-        QMouseEvent* me = static_cast<QMouseEvent*>(event);\n+        QMouseEvent *me = dynamic_cast<QMouseEvent*>(event);\n+        QTabletEvent *te = dynamic_cast<QTabletEvent*>(event);\n+\n+        QPoint pos = me ? me->pos() : (te ? te->pos() : QPoint(77,77));\n+\n         if(d->xActive) {\n-            float axisX = view()->viewConverter()->widgetToImage<QPoint>(me->pos()).x();\n+            float axisX = view()->viewConverter()->widgetToImage<QPoint>(pos).x();\n \n             d->setAxisPosition(axisX, d->axisPosition.y());\n-            d->horizontalHandlePosition = KisAlgebra2D::dotProduct<QPointF>(me->pos() - d->horizontalAxis.p1(), d->horizontalAxis.unitVector().p2() - d->horizontalAxis.p1());\n+            d->horizontalHandlePosition = KisAlgebra2D::dotProduct<QPointF>(pos - d->horizontalAxis.p1(), d->horizontalAxis.unitVector().p2() - d->horizontalAxis.p1());\n \n             event->accept();\n             return true;\n         }\n         if(d->yActive) {\n-            float axisY = view()->viewConverter()->widgetToImage<QPoint>(me->pos()).y();\n+            float axisY = view()->viewConverter()->widgetToImage<QPoint>(pos).y();\n \n             d->setAxisPosition(d->axisPosition.x(), axisY);\n-            d->verticalHandlePosition = KisAlgebra2D::dotProduct<QPointF>(me->pos() - d->verticalAxis.p1(), d->verticalAxis.unitVector().p2() - d->verticalAxis.p1());\n+            d->verticalHandlePosition = KisAlgebra2D::dotProduct<QPointF>(pos - d->verticalAxis.p1(), d->verticalAxis.unitVector().p2() - d->verticalAxis.p1());\n \n             event->accept();\n             return true;\n         }\n         if(d->mirrorHorizontal) {\n-            if(d->horizontalHandle.contains(me->posF())) {\n+            if(d->horizontalHandle.contains(pos)) {\n                 if(!d->horizontalContainsCursor) {\n                     QApplication::setOverrideCursor(Qt::OpenHandCursor);\n                     d->horizontalContainsCursor = true;\n@@ -271,7 +280,7 @@ bool KisMirrorAxis::eventFilter(QObject* target, QEvent* event)\n             }\n         }\n         if(d->mirrorVertical) {\n-            if(d->verticalHandle.contains(me->posF())) {\n+            if(d->verticalHandle.contains(pos)) {\n                 if(!d->verticalContainsCursor) {\n                     QApplication::setOverrideCursor(Qt::OpenHandCursor);\n                     d->verticalContainsCursor = true;"}]}, {"sha": "14fb5e837d3a58abf5ac176ad9d722434bfa2bca", "stats": {"total": 15, "additions": 12, "deletions": 3}, "files": [{"sha": "566307be7afcd74d2ba20ca1a1c9a3c1ceb0b641", "filename": "plugins/paintops/spray/spray_brush.cpp", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/KDE/krita/blob/14fb5e837d3a58abf5ac176ad9d722434bfa2bca/plugins/paintops/spray/spray_brush.cpp", "raw_url": "https://github.com/KDE/krita/raw/14fb5e837d3a58abf5ac176ad9d722434bfa2bca/plugins/paintops/spray/spray_brush.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/spray/spray_brush.cpp?ref=14fb5e837d3a58abf5ac176ad9d722434bfa2bca", "patch": "@@ -290,6 +290,7 @@ void SprayBrush::paint(KisPaintDeviceSP dab, KisPaintDeviceSP source,\n \n                     QTransform m;\n                     m.rotate(rad2deg(rotationZ));\n+                    m.scale(additionalScale, additionalScale);\n \n                     if (m_shapeDynamicsProperties->randomSize) {\n                         m.scale(particleScale, particleScale);\n@@ -320,7 +321,9 @@ void SprayBrush::paint(KisPaintDeviceSP dab, KisPaintDeviceSP source,\n             // Auto-brush\n         }\n         else {\n-            QPointF hotSpot = m_brush->hotSpot(particleScale, particleScale, -rotationZ, info);\n+            QPointF hotSpot = m_brush->hotSpot(particleScale * additionalScale,\n+                                               particleScale * additionalScale,\n+                                               -rotationZ, info);\n             QPointF pos(nx + x, ny + y);\n             QPointF pt = pos - hotSpot;\n \n@@ -335,7 +338,9 @@ void SprayBrush::paint(KisPaintDeviceSP dab, KisPaintDeviceSP source,\n             //KisFixedPaintDeviceSP dab;\n             if (m_brush->brushType() == IMAGE ||\n                     m_brush->brushType() == PIPE_IMAGE) {\n-                m_fixedDab = m_brush->paintDevice(m_fixedDab->colorSpace(), particleScale, -rotationZ, info, xFraction, yFraction);\n+                m_fixedDab = m_brush->paintDevice(m_fixedDab->colorSpace(),\n+                                                  particleScale * additionalScale,\n+                                                  -rotationZ, info, xFraction, yFraction);\n \n                 if (m_colorProperties->useRandomHSV && m_transfo) {\n                     quint8 * dabPointer = m_fixedDab->data();\n@@ -345,7 +350,10 @@ void SprayBrush::paint(KisPaintDeviceSP dab, KisPaintDeviceSP source,\n \n             }\n             else {\n-                m_brush->mask(m_fixedDab, m_inkColor, particleScale, particleScale, -rotationZ, info, xFraction, yFraction);\n+                m_brush->mask(m_fixedDab, m_inkColor,\n+                              particleScale * additionalScale,\n+                              particleScale * additionalScale,\n+                              -rotationZ, info, xFraction, yFraction);\n             }\n             m_painter->bltFixed(QPoint(ix, iy), m_fixedDab, m_fixedDab->bounds());\n         }"}, {"sha": "684b010691170d19ee6758e63a282048043a4065", "filename": "plugins/paintops/spray/spray_brush.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/14fb5e837d3a58abf5ac176ad9d722434bfa2bca/plugins/paintops/spray/spray_brush.h", "raw_url": "https://github.com/KDE/krita/raw/14fb5e837d3a58abf5ac176ad9d722434bfa2bca/plugins/paintops/spray/spray_brush.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/spray/spray_brush.h?ref=14fb5e837d3a58abf5ac176ad9d722434bfa2bca", "patch": "@@ -55,6 +55,7 @@ class SprayBrush\n         m_shapeProperties = shapeProperties;\n         m_shapeDynamicsProperties = shapeDynamicsProperties;\n         m_brush = brush;\n+        m_brush->notifyStrokeStarted();\n     }\n \n     void setFixedDab(KisFixedPaintDeviceSP dab);"}]}, {"sha": "e1c7211c4d846bb560d5c9c35c2df44bfa5dea49", "stats": {"total": 89, "additions": 20, "deletions": 69}, "files": [{"sha": "6e175fcc1f3c3ff9726490abf209848c2de9d851", "filename": "plugins/paintops/spray/spray_brush.cpp", "status": "modified", "additions": 17, "deletions": 66, "changes": 83, "blob_url": "https://github.com/KDE/krita/blob/e1c7211c4d846bb560d5c9c35c2df44bfa5dea49/plugins/paintops/spray/spray_brush.cpp", "raw_url": "https://github.com/KDE/krita/raw/e1c7211c4d846bb560d5c9c35c2df44bfa5dea49/plugins/paintops/spray/spray_brush.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/spray/spray_brush.cpp?ref=e1c7211c4d846bb560d5c9c35c2df44bfa5dea49", "patch": "@@ -250,19 +250,19 @@ void SprayBrush::paint(KisPaintDeviceSP dab, KisPaintDeviceSP source,\n             m_painter->setPaintColor(m_inkColor);\n         }\n \n-        qreal jitteredWidth = qMax(qreal(1.0), m_shapeProperties->width * particleScale * additionalScale);\n-        qreal jitteredHeight = qMax(qreal(1.0), m_shapeProperties->height * particleScale * additionalScale);\n+        qreal jitteredWidth = qMax(1.0 * additionalScale, m_shapeProperties->width * particleScale * additionalScale);\n+        qreal jitteredHeight = qMax(1.0 * additionalScale, m_shapeProperties->height * particleScale * additionalScale);\n \n         if (m_shapeProperties->enabled){\n         switch (m_shapeProperties->shape){\n             // ellipse\n             case 0:\n             {\n                 if (m_shapeProperties->width == m_shapeProperties->height){\n-                    paintCircle(m_painter, nx + x, ny + y, qRound(jitteredWidth * 0.5));\n+                    paintCircle(m_painter, nx + x, ny + y, jitteredWidth * 0.5);\n                 }\n                 else {\n-                    paintEllipse(m_painter, nx + x, ny + y, qRound(jitteredWidth * 0.5) , qRound(jitteredHeight * 0.5), rotationZ);\n+                    paintEllipse(m_painter, nx + x, ny + y, jitteredWidth * 0.5 , jitteredHeight * 0.5, rotationZ);\n                 }\n                 break;\n             }\n@@ -396,82 +396,33 @@ void SprayBrush::paintParticle(KisRandomAccessorSP &writeAccessor, const KoColor\n     memcpy(writeAccessor->rawData(), pcolor.data(), m_dabPixelSize);\n }\n \n-void SprayBrush::paintCircle(KisPainter* painter, qreal x, qreal y, int radius)\n+void SprayBrush::paintCircle(KisPainter* painter, qreal x, qreal y, qreal radius)\n {\n     QPainterPath path;\n-    // TODO: leaving this here, in the future we might want to spray regular polygons (hexagon, octagon, etc.)\n-    /*int steps = 12;\n-    qreal cx, cy;\n-\n-    qreal length = 2.0 * M_PI;\n-    qreal step = 1.0 / steps;\n-    path.moveTo(radius + x, y);\n-    for (int i = 1; i < steps; i++) {\n-        cx = cos(i * step * length);\n-        cy = sin(i * step * length);\n-\n-        cx *= radius;\n-        cy *= radius;\n-\n-        cx += x;\n-        cy += y;\n-\n-        path.lineTo(cx, cy);\n-    }\n-    path.closeSubpath();*/\n     path.addEllipse(QPointF(x,y),radius,radius);\n     painter->fillPainterPath(path);\n }\n \n \n-void SprayBrush::paintEllipse(KisPainter* painter, qreal x, qreal y, int a, int b, qreal angle, int steps)\n+void SprayBrush::paintEllipse(KisPainter* painter, qreal x, qreal y, qreal a, qreal b, qreal angle)\n {\n     QPainterPath path;\n-    qreal beta = angle;\n-    qreal sinbeta = sin(beta);\n-    qreal cosbeta = cos(beta);\n-\n-    path.moveTo(x + a * cosbeta, y + a * sinbeta);\n-    qreal step = 360.0 / steps;\n-    for (int i = step; i < 360; i += step) {\n-        qreal alpha = i * (M_PI / 180) ;\n-        qreal sinalpha = sin(alpha);\n-        qreal cosalpha = cos(alpha);\n-\n-        qreal X = x + (a * cosalpha * cosbeta - b * sinalpha * sinbeta);\n-        qreal Y = y + (a * cosalpha * sinbeta + b * sinalpha * cosbeta);\n-\n-        path.lineTo(X, Y);\n-    }\n-    path.closeSubpath();\n+    path.addEllipse(QPointF(), a, b);\n+    QTransform t;\n+    t.translate(x, y);\n+    t.rotateRadians(angle);\n+    path = t.map(path);\n     painter->fillPainterPath(path);\n }\n \n-void SprayBrush::paintRectangle(KisPainter* painter, qreal x, qreal y, int width, int height, qreal angle)\n+void SprayBrush::paintRectangle(KisPainter* painter, qreal x, qreal y, qreal width, qreal height, qreal angle)\n {\n     QPainterPath path;\n-    QTransform transform;\n-\n-    qreal halfWidth = width * 0.5;\n-    qreal halfHeight = height * 0.5;\n-    qreal tx, ty;\n-\n-\n-    transform.reset();\n-    transform.rotateRadians(angle);\n-    // top left\n-    transform.map(- halfWidth,  - halfHeight, &tx, &ty);\n-    path.moveTo(QPointF(tx + x, ty + y));\n-    // top right\n-    transform.map(+ halfWidth,  - halfHeight, &tx, &ty);\n-    path.lineTo(QPointF(tx + x, ty + y));\n-    // bottom right\n-    transform.map(+ halfWidth,  + halfHeight, &tx, &ty);\n-    path.lineTo(QPointF(tx + x, ty + y));\n-    // botom left\n-    transform.map(- halfWidth,  + halfHeight, &tx, &ty);\n-    path.lineTo(QPointF(tx + x, ty + y));\n-    path.closeSubpath();\n+    path.addRect(QRectF(-0.5 * width, -0.5 * height, width, height));\n+    QTransform t;\n+    t.translate(x, y);\n+    t.rotateRadians(angle);\n+    path = t.map(path);\n     painter->fillPainterPath(path);\n }\n "}, {"sha": "ff26eecf576d4fbcd8e2e698e14ba3f943597fa8", "filename": "plugins/paintops/spray/spray_brush.h", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/e1c7211c4d846bb560d5c9c35c2df44bfa5dea49/plugins/paintops/spray/spray_brush.h", "raw_url": "https://github.com/KDE/krita/raw/e1c7211c4d846bb560d5c9c35c2df44bfa5dea49/plugins/paintops/spray/spray_brush.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/spray/spray_brush.h?ref=e1c7211c4d846bb560d5c9c35c2df44bfa5dea49", "patch": "@@ -86,9 +86,9 @@ class SprayBrush\n     qreal rotationAngle(KisRandomSourceSP randomSource);\n     /// Paints Wu Particle\n     void paintParticle(KisRandomAccessorSP &writeAccessor, const KoColor &color, qreal rx, qreal ry);\n-    void paintCircle(KisPainter * painter, qreal x, qreal y, int radius);\n-    void paintEllipse(KisPainter * painter, qreal x, qreal y, int a, int b, qreal angle, int steps = 128);\n-    void paintRectangle(KisPainter * painter, qreal x, qreal y, int width, int height, qreal angle);\n+    void paintCircle(KisPainter * painter, qreal x, qreal y, qreal radius);\n+    void paintEllipse(KisPainter * painter, qreal x, qreal y, qreal a, qreal b, qreal angle);\n+    void paintRectangle(KisPainter * painter, qreal x, qreal y, qreal width, qreal height, qreal angle);\n \n     void paintOutline(KisPaintDeviceSP dev, const KoColor& painterColor, qreal posX, qreal posY, qreal radius);\n "}]}, {"sha": "fd434f942c45aa1440d1973cd11a1e5ac4e0b4af", "stats": {"total": 2, "additions": 2, "deletions": 0}, "files": [{"sha": "bd3eb6c99abb48ac4dcb867d5cf2ff31515565bf", "filename": "plugins/extensions/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/fd434f942c45aa1440d1973cd11a1e5ac4e0b4af/plugins/extensions/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/fd434f942c45aa1440d1973cd11a1e5ac4e0b4af/plugins/extensions/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/CMakeLists.txt?ref=fd434f942c45aa1440d1973cd11a1e5ac4e0b4af", "patch": "@@ -18,6 +18,8 @@ add_subdirectory( layersplit )\n # Allow to skip building GMIC plugin\n option(WITH_GMIC \"Build the G'Mic plugin\" ON)\n if(WITH_GMIC)\n+# Only build gmic with gcc; msvc is broken, and now dtschump tells is that on OSX\n+# gcc should be used as well because clang is broken.\n if (CMAKE_COMPILER_IS_GNUCC AND CMAKE_CXX_COMPILER_VERSION VERSION_GREATER 4.8.3)\n     add_subdirectory( gmic )\n endif()"}]}, {"sha": "65a5ce33c12b2b03a467f71e1f06d78b782400ba", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "34bdf6b5383589256350f379cbcfdff8cb90a13a", "filename": "plugins/flake/textshape/TextTool.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/65a5ce33c12b2b03a467f71e1f06d78b782400ba/plugins/flake/textshape/TextTool.cpp", "raw_url": "https://github.com/KDE/krita/raw/65a5ce33c12b2b03a467f71e1f06d78b782400ba/plugins/flake/textshape/TextTool.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/flake/textshape/TextTool.cpp?ref=65a5ce33c12b2b03a467f71e1f06d78b782400ba", "patch": "@@ -2472,7 +2472,7 @@ void TextTool::setFontFamily(const QString &font)\n \n void TextTool::setFontSize(qreal size)\n {\n-    if (!m_allowActions || !m_textEditor.data()) {\n+    if (!m_allowActions || !m_textEditor.data() || m_textEditor.isNull()) {\n         return;\n     }\n     m_textEditor.data()->setFontSize(size);"}]}, {"sha": "c3dc97c005ec0ad8408dce078ca159385be4a4ae", "stats": {"total": 3, "additions": 1, "deletions": 2}, "files": [{"sha": "50afb40cc1487f9eb54219e450b2d78f21f4290e", "filename": "libs/ui/KisApplication.cpp", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/c3dc97c005ec0ad8408dce078ca159385be4a4ae/libs/ui/KisApplication.cpp", "raw_url": "https://github.com/KDE/krita/raw/c3dc97c005ec0ad8408dce078ca159385be4a4ae/libs/ui/KisApplication.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisApplication.cpp?ref=c3dc97c005ec0ad8408dce078ca159385be4a4ae", "patch": "@@ -380,6 +380,7 @@ bool KisApplication::start(const KisApplicationArguments &args)\n \n         if (showmainWindow) {\n             QTimer::singleShot(1, mainWindow, SLOT(show()));\n+            QTimer::singleShot(1, mainWindow, SLOT(initializeGeometry()));\n         }\n     }\n     short int numberOfOpenDocuments = 0; // number of documents open"}, {"sha": "8ae0a9e64e579981830f2570c9f812d939f3c32a", "filename": "libs/ui/KisMainWindow.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/c3dc97c005ec0ad8408dce078ca159385be4a4ae/libs/ui/KisMainWindow.cpp", "raw_url": "https://github.com/KDE/krita/raw/c3dc97c005ec0ad8408dce078ca159385be4a4ae/libs/ui/KisMainWindow.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisMainWindow.cpp?ref=c3dc97c005ec0ad8408dce078ca159385be4a4ae", "patch": "@@ -327,8 +327,6 @@ KisMainWindow::KisMainWindow()\n \n     actionCollection()->addAssociatedWidget(this);\n \n-    QMetaObject::invokeMethod(this, \"initializeGeometry\", Qt::QueuedConnection);\n-\n     KoToolBoxFactory toolBoxFactory;\n     QDockWidget *toolbox = createDockWidget(&toolBoxFactory);\n     toolbox->setFeatures(QDockWidget::DockWidgetMovable | QDockWidget::DockWidgetFloatable | QDockWidget::DockWidgetClosable);"}]}, {"sha": "433658248cb527a47fe67ecff9c71dbd861bd484", "stats": {"total": 155, "additions": 9, "deletions": 146}, "files": [{"sha": "27198d223d87dc810ca42d4d8fb8f3b977283cbd", "filename": "krita/gemini/MainWindow.cpp", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/433658248cb527a47fe67ecff9c71dbd861bd484/krita/gemini/MainWindow.cpp", "raw_url": "https://github.com/KDE/krita/raw/433658248cb527a47fe67ecff9c71dbd861bd484/krita/gemini/MainWindow.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/gemini/MainWindow.cpp?ref=433658248cb527a47fe67ecff9c71dbd861bd484", "patch": "@@ -28,7 +28,6 @@\n #include <QDeclarativeView>\n #include <QDeclarativeContext>\n #include <QDeclarativeEngine>\n-#include <QGraphicsObject>\n #include <QDir>\n #include <QFile>\n #include <QToolButton>"}, {"sha": "56e76afda5ef032a26553b9f6d21f20a69b31856", "filename": "krita/sketch/MouseTracker.cpp", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/433658248cb527a47fe67ecff9c71dbd861bd484/krita/sketch/MouseTracker.cpp", "raw_url": "https://github.com/KDE/krita/raw/433658248cb527a47fe67ecff9c71dbd861bd484/krita/sketch/MouseTracker.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/sketch/MouseTracker.cpp?ref=433658248cb527a47fe67ecff9c71dbd861bd484", "patch": "@@ -21,7 +21,6 @@\n #include <QQuickItem>\n #include <QEvent>\n #include <QCoreApplication>\n-#include <QGraphicsSceneMouseEvent>\n #include <QTouchEvent>\n \n struct TrackedItem {"}, {"sha": "880cb544525018c19feb86a6cb5bc3300afa854e", "filename": "libs/flake/KoCanvasBase.h", "status": "modified", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/433658248cb527a47fe67ecff9c71dbd861bd484/libs/flake/KoCanvasBase.h", "raw_url": "https://github.com/KDE/krita/raw/433658248cb527a47fe67ecff9c71dbd861bd484/libs/flake/KoCanvasBase.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/flake/KoCanvasBase.h?ref=433658248cb527a47fe67ecff9c71dbd861bd484", "patch": "@@ -27,7 +27,6 @@\n \n #include \"kritaflake_export.h\"\n \n-class QGraphicsObject;\n class KUndo2Command;\n \n class KoUnit;\n@@ -151,16 +150,6 @@ class KRITAFLAKE_EXPORT KoCanvasBase\n     virtual const QWidget *canvasWidget() const = 0;\n \n     /**\n-     * Return the widget that will be added to the scrollArea.\n-     */\n-    virtual QGraphicsObject *canvasItem() { return 0; }\n-\n-    /**\n-     * Return the widget that will be added to the scrollArea.\n-     */\n-    virtual const QGraphicsObject *canvasItem() const{ return 0; }\n-\n-    /**\n      * Return the unit of the current document for initialization of the widgets created\n      * by the flake framework.\n      * @see KoDocument::unit()"}, {"sha": "e1ab05fb1ac63e4c92b2269119059ec620cef15c", "filename": "libs/flake/KoCanvasController.h", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/433658248cb527a47fe67ecff9c71dbd861bd484/libs/flake/KoCanvasController.h", "raw_url": "https://github.com/KDE/krita/raw/433658248cb527a47fe67ecff9c71dbd861bd484/libs/flake/KoCanvasController.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/flake/KoCanvasController.h?ref=433658248cb527a47fe67ecff9c71dbd861bd484", "patch": "@@ -45,12 +45,12 @@ class KoCanvasControllerProxyObject;\n  * that provides scrolling and zooming for your canvas.\n  *\n  * Flake does not provide a canvas, the application will have to\n- * implement a canvas themselves. You canvas can be QWidget-based, QGraphicsItem-based\n+ * implement a canvas themselves. You canvas can be QWidget-based\n  * or something we haven't invented yet -- as long the class that holds the canvas\n  * imlements KoCanvasController, tools, scrolling and zooming will work.\n  *\n- * A KoCanvasController implementation acts as a decorator around the canvas widget or\n- * graphics item and provides a way to scroll the canvas, allows the canvas to be centered\n+ * A KoCanvasController implementation acts as a decorator around the canvas widget\n+ * and provides a way to scroll the canvas, allows the canvas to be centered\n  * in the viewArea and manages tool activation.\n  *\n  * <p>The using application can instantiate this class and add its"}, {"sha": "3dbda5c4a26122f0ecefadbd808d11ec04c4bc4a", "filename": "libs/flake/KoClipPath.cpp", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/433658248cb527a47fe67ecff9c71dbd861bd484/libs/flake/KoClipPath.cpp", "raw_url": "https://github.com/KDE/krita/raw/433658248cb527a47fe67ecff9c71dbd861bd484/libs/flake/KoClipPath.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/flake/KoClipPath.cpp?ref=433658248cb527a47fe67ecff9c71dbd861bd484", "patch": "@@ -24,7 +24,6 @@\n #include <QTransform>\n #include <QPainterPath>\n #include <QPainter>\n-#include <QGraphicsItem>\n #include <QVarLengthArray>\n \n QTransform scaleToPercent(const QSizeF &size)"}, {"sha": "fd7df21737978b478aafd9ce11359958bb20c7a2", "filename": "libs/flake/KoPointerEvent.cpp", "status": "modified", "additions": 2, "deletions": 45, "changes": 47, "blob_url": "https://github.com/KDE/krita/blob/433658248cb527a47fe67ecff9c71dbd861bd484/libs/flake/KoPointerEvent.cpp", "raw_url": "https://github.com/KDE/krita/raw/433658248cb527a47fe67ecff9c71dbd861bd484/libs/flake/KoPointerEvent.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/flake/KoPointerEvent.cpp?ref=433658248cb527a47fe67ecff9c71dbd861bd484", "patch": "@@ -26,22 +26,19 @@\n #include <QMouseEvent>\n #include <QWheelEvent>\n #include <QTouchEvent>\n-#include <QGraphicsSceneMouseEvent>\n \n class Q_DECL_HIDDEN KoPointerEvent::Private\n {\n public:\n     Private()\n-        : tabletEvent(0), mouseEvent(0), wheelEvent(0), touchEvent(0), gsMouseEvent(0)\n-        , gsWheelEvent(0), deviceEvent(0), tabletButton(Qt::NoButton)\n+        : tabletEvent(0), mouseEvent(0), wheelEvent(0), touchEvent(0)\n+        , deviceEvent(0), tabletButton(Qt::NoButton)\n         , globalPos(0, 0), pos(0, 0), posZ(0), rotationX(0), rotationY(0)\n         , rotationZ(0) {}\n     QTabletEvent *tabletEvent;\n     QMouseEvent *mouseEvent;\n     QWheelEvent *wheelEvent;\n     QTouchEvent *touchEvent;\n-    QGraphicsSceneMouseEvent *gsMouseEvent;\n-    QGraphicsSceneWheelEvent *gsWheelEvent;\n     KoInputDeviceHandlerEvent *deviceEvent;\n     Qt::MouseButton tabletButton;\n     QPoint globalPos, pos;\n@@ -58,24 +55,6 @@ KoPointerEvent::KoPointerEvent(QMouseEvent *ev, const QPointF &pnt)\n     d->mouseEvent = ev;\n }\n \n-KoPointerEvent::KoPointerEvent(QGraphicsSceneMouseEvent *ev, const QPointF &pnt)\n-    : point(pnt),\n-      m_event(ev),\n-      d(new Private())\n-{\n-    Q_ASSERT(m_event);\n-    d->gsMouseEvent = ev;\n-}\n-\n-KoPointerEvent::KoPointerEvent(QGraphicsSceneWheelEvent *ev, const QPointF &pnt)\n-    : point(pnt),\n-      m_event(ev),\n-      d(new Private())\n-{\n-    Q_ASSERT(m_event);\n-    d->gsWheelEvent = ev;\n-}\n-\n KoPointerEvent::KoPointerEvent(QTabletEvent *ev, const QPointF &pnt)\n     : point(pnt),\n       m_event(ev),\n@@ -147,8 +126,6 @@ Qt::MouseButton KoPointerEvent::button() const\n         return d->tabletButton;\n     else if (d->deviceEvent)\n         return d->deviceEvent->button();\n-    else if (d->gsMouseEvent)\n-        return d->gsMouseEvent->button();\n     else\n         return Qt::NoButton;\n }\n@@ -163,10 +140,6 @@ Qt::MouseButtons KoPointerEvent::buttons() const\n         return d->tabletButton;\n     else if (d->deviceEvent)\n         return d->deviceEvent->buttons();\n-    else if (d->gsMouseEvent)\n-        return d->gsMouseEvent->buttons();\n-    else if (d->gsWheelEvent)\n-        return d->gsWheelEvent->buttons();\n     return Qt::NoButton;\n }\n \n@@ -178,10 +151,6 @@ QPoint KoPointerEvent::globalPos() const\n         return d->wheelEvent->globalPos();\n     else if (d->tabletEvent)\n         return d->tabletEvent->globalPos();\n-    else if (d->gsMouseEvent)\n-        return d->gsMouseEvent->screenPos();\n-    else if (d->gsWheelEvent)\n-        return d->gsWheelEvent->screenPos();\n     else\n         return d->globalPos;\n }\n@@ -194,10 +163,6 @@ QPoint KoPointerEvent::pos() const\n         return d->wheelEvent->pos();\n     else if (d->tabletEvent)\n         return d->tabletEvent->pos();\n-    else if (d->gsMouseEvent)\n-        return d->gsMouseEvent->pos().toPoint();\n-    else if (d->gsWheelEvent)\n-        return d->gsWheelEvent->pos().toPoint();\n     else\n         return d->pos;\n }\n@@ -280,8 +245,6 @@ int KoPointerEvent::delta() const\n {\n     if (d->wheelEvent)\n         return d->wheelEvent->delta();\n-    else if (d->gsWheelEvent)\n-        return d->gsWheelEvent->delta();\n     else\n         return 0;\n }\n@@ -305,8 +268,6 @@ Qt::Orientation KoPointerEvent::orientation() const\n {\n     if (d->wheelEvent)\n         return d->wheelEvent->orientation();\n-    else if (d->gsWheelEvent)\n-        return d->gsWheelEvent->orientation();\n     else\n         return Qt::Horizontal;\n }\n@@ -331,10 +292,6 @@ Qt::KeyboardModifiers KoPointerEvent::modifiers() const\n         return d->wheelEvent->modifiers();\n     else if (d->deviceEvent)\n         return d->deviceEvent->modifiers();\n-    else if (d->gsMouseEvent)\n-        return d->gsMouseEvent->modifiers();\n-    else if (d->gsWheelEvent)\n-        return d->gsWheelEvent->modifiers();\n     else\n         return Qt::NoModifier;\n }"}, {"sha": "5cdf9faec961c46c30c7f38d0a54d16ff5be789b", "filename": "libs/flake/KoPointerEvent.h", "status": "modified", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/KDE/krita/blob/433658248cb527a47fe67ecff9c71dbd861bd484/libs/flake/KoPointerEvent.h", "raw_url": "https://github.com/KDE/krita/raw/433658248cb527a47fe67ecff9c71dbd861bd484/libs/flake/KoPointerEvent.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/flake/KoPointerEvent.h?ref=433658248cb527a47fe67ecff9c71dbd861bd484", "patch": "@@ -30,8 +30,6 @@ class QTabletEvent;\n class QMouseEvent;\n class QWheelEvent;\n class KoInputDeviceHandlerEvent;\n-class QGraphicsSceneMouseEvent;\n-class QGraphicsSceneWheelEvent;\n \n #include \"kritaflake_export.h\"\n \n@@ -65,22 +63,6 @@ class KRITAFLAKE_EXPORT KoPointerEvent\n     /**\n      * Constructor.\n      *\n-     * @param event the mouse event that is the base of this event.\n-     * @param point the zoomed point in the normal coordinate system.\n-     */\n-    KoPointerEvent(QGraphicsSceneMouseEvent *event, const QPointF &point);\n-\n-    /**\n-     * Constructor.\n-     *\n-     * @param event the mouse event that is the base of this event.\n-     * @param point the zoomed point in the normal coordinate system.\n-     */\n-    KoPointerEvent(QGraphicsSceneWheelEvent *event, const QPointF &point);\n-\n-    /**\n-     * Constructor.\n-     *\n      * @param event the tablet event that is the base of this event.\n      * @param point the zoomed point in the normal coordinate system.\n      */"}, {"sha": "f1c807bc42050970ac1d1055513bbc0a9a91fe11", "filename": "libs/ui/KisPart.cpp", "status": "modified", "additions": 0, "deletions": 22, "changes": 22, "blob_url": "https://github.com/KDE/krita/blob/433658248cb527a47fe67ecff9c71dbd861bd484/libs/ui/KisPart.cpp", "raw_url": "https://github.com/KDE/krita/raw/433658248cb527a47fe67ecff9c71dbd861bd484/libs/ui/KisPart.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisPart.cpp?ref=433658248cb527a47fe67ecff9c71dbd861bd484", "patch": "@@ -52,9 +52,7 @@\n #include <QKeySequence>\n \n #include <QDialog>\n-#include <QGraphicsScene>\n #include <QApplication>\n-#include <QGraphicsProxyWidget>\n #include <QDomDocument>\n #include <QDomElement>\n #include <QGlobalStatic>\n@@ -94,7 +92,6 @@ class Q_DECL_HIDDEN KisPart::Private\n \n     ~Private()\n     {\n-        delete canvasItem;\n     }\n \n     KisPart *part;\n@@ -103,7 +100,6 @@ class Q_DECL_HIDDEN KisPart::Private\n     QList<QPointer<KisMainWindow> > mainWindows;\n     QList<QPointer<KisDocument> > documents;\n \n-    QGraphicsItem *canvasItem{0};\n     KActionCollection *actionCollection{0};\n \n     KisIdleWatcher idleWatcher;\n@@ -313,24 +309,6 @@ int KisPart::viewCount(KisDocument *doc) const\n     }\n }\n \n-QGraphicsItem *KisPart::canvasItem(KisDocument *document, bool create)\n-{\n-    if (create && !d->canvasItem) {\n-        d->canvasItem = createCanvasItem(document);\n-    }\n-    return d->canvasItem;\n-}\n-\n-QGraphicsItem *KisPart::createCanvasItem(KisDocument *document)\n-{\n-    if (!document) return 0;\n-\n-    KisView *view = createView(document, 0, 0, 0);\n-    QGraphicsProxyWidget *proxy = new QGraphicsProxyWidget();\n-    QWidget *canvasController = view->findChild<KoCanvasControllerWidget*>();\n-    proxy->setWidget(canvasController);\n-    return proxy;\n-}\n \n void KisPart::removeMainWindow(KisMainWindow *mainWindow)\n {"}, {"sha": "2461a5b02da5910755050c2617badfffa714c43b", "filename": "libs/ui/KisPart.h", "status": "modified", "additions": 0, "deletions": 20, "changes": 20, "blob_url": "https://github.com/KDE/krita/blob/433658248cb527a47fe67ecff9c71dbd861bd484/libs/ui/KisPart.h", "raw_url": "https://github.com/KDE/krita/raw/433658248cb527a47fe67ecff9c71dbd861bd484/libs/ui/KisPart.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisPart.h?ref=433658248cb527a47fe67ecff9c71dbd861bd484", "patch": "@@ -37,7 +37,6 @@ namespace KIO {\n \n class KisDocument;\n class KisView;\n-class QGraphicsItem;\n class KisDocument;\n class KisIdleWatcher;\n class KisAnimationCachePopulator;\n@@ -232,25 +231,6 @@ private Q_SLOTS:\n      */\n     int viewCount(KisDocument *doc) const;\n \n-    /**\n-     * @return a QGraphicsItem canvas displaying this document. There is only one QGraphicsItem canvas that can\n-     * be shown by many QGraphicsView subclasses (those should reimplement KoCanvasController\n-     * as well).\n-     *\n-     * @param create if true, a new canvas item is created if there wasn't one.\n-     */\n-    QGraphicsItem *canvasItem(KisDocument *document, bool create = true);\n-\n-\n-protected:\n-\n-    /**\n-     * Override this to create a QGraphicsItem that does not rely\n-     * on proxying a KoCanvasController.\n-     */\n-    QGraphicsItem *createCanvasItem(KisDocument *document);\n-\n-\n private:\n \n     Q_DISABLE_COPY(KisPart)"}, {"sha": "b8c0a42d58c39b97dff5810e9cd978a22d9f1523", "filename": "libs/ui/widgets/kis_custom_image_widget.cc", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/433658248cb527a47fe67ecff9c71dbd861bd484/libs/ui/widgets/kis_custom_image_widget.cc", "raw_url": "https://github.com/KDE/krita/raw/433658248cb527a47fe67ecff9c71dbd861bd484/libs/ui/widgets/kis_custom_image_widget.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/widgets/kis_custom_image_widget.cc?ref=433658248cb527a47fe67ecff9c71dbd861bd484", "patch": "@@ -29,8 +29,6 @@\n #include <QClipboard>\n #include <QDesktopWidget>\n #include <QFile>\n-#include <QGraphicsPixmapItem>\n-#include <QGraphicsScene>\n #include <QSpacerItem>\n \n #include <QMessageBox>"}, {"sha": "29c26ce7d14408173206639715639e68b747684e", "filename": "libs/ui/widgets/kis_image_from_clipboard_widget.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/433658248cb527a47fe67ecff9c71dbd861bd484/libs/ui/widgets/kis_image_from_clipboard_widget.cpp", "raw_url": "https://github.com/KDE/krita/raw/433658248cb527a47fe67ecff9c71dbd861bd484/libs/ui/widgets/kis_image_from_clipboard_widget.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/widgets/kis_image_from_clipboard_widget.cpp?ref=433658248cb527a47fe67ecff9c71dbd861bd484", "patch": "@@ -30,8 +30,6 @@\n #include <QClipboard>\n #include <QDesktopWidget>\n #include <QFile>\n-#include <QGraphicsPixmapItem>\n-#include <QGraphicsScene>\n \n #include <kis_debug.h>\n "}, {"sha": "7260be23273232099ed8ef98ccf7eb1306b884c6", "filename": "plugins/flake/textshape/TextTool.cpp", "status": "modified", "additions": 4, "deletions": 20, "changes": 24, "blob_url": "https://github.com/KDE/krita/blob/433658248cb527a47fe67ecff9c71dbd861bd484/plugins/flake/textshape/TextTool.cpp", "raw_url": "https://github.com/KDE/krita/raw/433658248cb527a47fe67ecff9c71dbd861bd484/plugins/flake/textshape/TextTool.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/flake/textshape/TextTool.cpp?ref=433658248cb527a47fe67ecff9c71dbd861bd484", "patch": "@@ -95,7 +95,6 @@\n #include <QTextDocumentFragment>\n #include <QToolTip>\n #include <QSignalMapper>\n-#include <QGraphicsObject>\n #include <QLinearGradient>\n #include <QBitmap>\n #include <QDrag>\n@@ -585,7 +584,7 @@ void TextTool::showEditTip()\n \n void TextTool::blinkCaret()\n {\n-    if (!(canvas()->canvasWidget() ? canvas()->canvasWidget()->hasFocus() : canvas()->canvasItem()->hasFocus())) {\n+    if (!(canvas()->canvasWidget() && canvas()->canvasWidget()->hasFocus())) {\n         m_caretTimer.stop();\n         m_caretTimerState = false; // not visible.\n     } else {\n@@ -610,9 +609,7 @@ void TextTool::paint(QPainter &painter, const KoViewConverter &converter)\n         return;\n     }\n     if (canvas()\n-            && ((canvas()->canvasWidget() && canvas()->canvasWidget()->hasFocus())\n-                || (canvas()->canvasItem() && canvas()->canvasItem()->hasFocus())\n-               )\n+            && (canvas()->canvasWidget() && canvas()->canvasWidget()->hasFocus())\n             && !m_caretTimer.isActive()) { // make sure we blink\n         m_caretTimer.start();\n         m_caretTimerState = true;\n@@ -857,15 +854,11 @@ void TextTool::mousePressEvent(KoPointerEvent *event)\n         // basically, we require a widget for this to work (passing 0 to QApplication::sendEvent\n         // crashes) and there are three tests any one of which can be true to trigger the event\n         const bool hasWidget = canvas()->canvasWidget();\n-        const bool hasItem = canvas()->canvasItem();\n-        if ((behavior == QStyle::RSIP_OnMouseClick && (hasWidget || hasItem)) ||\n-                (hasWidget && canvas()->canvasWidget()->hasFocus()) ||\n-                (hasItem && canvas()->canvasItem()->hasFocus())) {\n+        if ((behavior == QStyle::RSIP_OnMouseClick && hasWidget) ||\n+                (hasWidget && canvas()->canvasWidget()->hasFocus())) {\n             QEvent event(QEvent::RequestSoftwareInputPanel);\n             if (hasWidget) {\n                 QApplication::sendEvent(canvas()->canvasWidget(), &event);\n-            } else {\n-                QApplication::sendEvent(canvas()->canvasItem(), &event);\n             }\n         }\n     }\n@@ -1436,9 +1429,6 @@ void TextTool::mouseMoveEvent(KoPointerEvent *event)\n                 if (canvas()->canvasWidget()) {\n                     canvas()->canvasWidget()->update();\n                 }\n-                if (canvas()->canvasItem()) {\n-                    canvas()->canvasItem()->update();\n-                }\n             }\n             m_tableDraggedOnce = true;\n         } else if (m_tableDragInfo.tableHit == KoPointedAt::RowDivider) {\n@@ -1465,9 +1455,6 @@ void TextTool::mouseMoveEvent(KoPointerEvent *event)\n                     if (canvas()->canvasWidget()) {\n                         canvas()->canvasWidget()->update();\n                     }\n-                    if (canvas()->canvasItem()) {\n-                        canvas()->canvasItem()->update();\n-                    }\n                 }\n                 m_tableDraggedOnce = true;\n             }\n@@ -1525,9 +1512,6 @@ void TextTool::mouseReleaseEvent(KoPointerEvent *event)\n         if (canvas()->canvasWidget()) {\n             canvas()->canvasWidget()->update();\n         }\n-        if (canvas()->canvasItem()) {\n-            canvas()->canvasItem()->update();\n-        }\n     }\n \n     if (!m_textShapeData) {"}]}, {"sha": "bf2371ddfe37f87ee3d528521e7fc3fa7ad3e8a0", "stats": {"total": 17, "additions": 11, "deletions": 6}, "files": [{"sha": "5265e512ff6387a0552e70afe54cc3d2c9909cd9", "filename": "libs/brush/kis_brush.cpp", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/bf2371ddfe37f87ee3d528521e7fc3fa7ad3e8a0/libs/brush/kis_brush.cpp", "raw_url": "https://github.com/KDE/krita/raw/bf2371ddfe37f87ee3d528521e7fc3fa7ad3e8a0/libs/brush/kis_brush.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/brush/kis_brush.cpp?ref=bf2371ddfe37f87ee3d528521e7fc3fa7ad3e8a0", "patch": "@@ -628,9 +628,7 @@ QPainterPath KisBrush::outline() const\n \n void KisBrush::lodLimitations(KisPaintopLodLimitations *l) const\n {\n-    if (autoSpacingActive()) {\n-        l->limitations << KoID(\"auto-spacing\", i18nc(\"PaintOp instant preview limitation\", \"Auto Spacing\"));\n-    } else if (spacing() > 0.5) {\n+    if (spacing() > 0.5) {\n         l->limitations << KoID(\"huge-spacing\", i18nc(\"PaintOp instant preview limitation\", \"Spacing > 0.5, consider disabling Instant Preview\"));\n     }\n }"}, {"sha": "3d494036669451d30fceff5073c3a6388e10bd16", "filename": "plugins/paintops/libpaintop/kis_brush_based_paintop.cpp", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/bf2371ddfe37f87ee3d528521e7fc3fa7ad3e8a0/plugins/paintops/libpaintop/kis_brush_based_paintop.cpp", "raw_url": "https://github.com/KDE/krita/raw/bf2371ddfe37f87ee3d528521e7fc3fa7ad3e8a0/plugins/paintops/libpaintop/kis_brush_based_paintop.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/libpaintop/kis_brush_based_paintop.cpp?ref=bf2371ddfe37f87ee3d528521e7fc3fa7ad3e8a0", "patch": "@@ -21,6 +21,7 @@\n #include \"kis_brush_option.h\"\n #include <kis_pressure_spacing_option.h>\n #include \"kis_painter.h\"\n+#include <kis_lod_transform.h>\n \n #include <QGlobalStatic>\n \n@@ -130,14 +131,18 @@ KisSpacingInformation KisBrushBasedPaintOp::effectiveSpacing(qreal scale, qreal\n     return effectiveSpacing(metric.width(), metric.height(), extraSpacingScale, spacingOption.isotropicSpacing(), rotation);\n }\n \n-inline qreal calcAutoSpacing(qreal value, qreal coeff)\n+inline qreal KisBrushBasedPaintOp::calcAutoSpacing(qreal value, qreal coeff)\n {\n     return coeff * (value < 1.0 ? value : sqrt(value));\n }\n \n-inline QPointF calcAutoSpacing(const QPointF &pt, qreal coeff)\n+QPointF KisBrushBasedPaintOp::calcAutoSpacing(const QPointF &pt, qreal coeff) const\n {\n-    return QPointF(calcAutoSpacing(pt.x(), coeff), calcAutoSpacing(pt.y(), coeff));\n+    const qreal lodScale = KisLodTransform::lodToScale(painter()->device());\n+    const qreal invLodScale = 1.0 / lodScale;\n+    const QPointF lod0Point = invLodScale * pt;\n+\n+    return lodScale * QPointF(calcAutoSpacing(lod0Point.x(), coeff), calcAutoSpacing(lod0Point.y(), coeff));\n }\n \n KisSpacingInformation KisBrushBasedPaintOp::effectiveSpacing(qreal dabWidth, qreal dabHeight, qreal extraScale, bool isotropicSpacing, qreal rotation) const"}, {"sha": "ec38fc8415df19feae64fc423dbae0f186deca4f", "filename": "plugins/paintops/libpaintop/kis_brush_based_paintop.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/bf2371ddfe37f87ee3d528521e7fc3fa7ad3e8a0/plugins/paintops/libpaintop/kis_brush_based_paintop.h", "raw_url": "https://github.com/KDE/krita/raw/bf2371ddfe37f87ee3d528521e7fc3fa7ad3e8a0/plugins/paintops/libpaintop/kis_brush_based_paintop.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/libpaintop/kis_brush_based_paintop.h?ref=bf2371ddfe37f87ee3d528521e7fc3fa7ad3e8a0", "patch": "@@ -79,6 +79,8 @@ class PAINTOP_EXPORT KisBrushBasedPaintOp : public KisPaintOp\n \n private:\n     KisSpacingInformation effectiveSpacing(qreal dabWidth, qreal dabHeight, qreal extraScale, bool isotropicSpacing, qreal rotation) const;\n+    QPointF calcAutoSpacing(const QPointF &pt, qreal coeff) const;\n+    static inline qreal calcAutoSpacing(qreal value, qreal coeff);\n \n protected: // XXX: make private!\n "}]}, {"sha": "eee523a3fc18ada6e973e9fdd122dcbc2559ec99", "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "9ffe12693567f23ccc7418cdb436b050cb56e14a", "filename": "krita/gemini/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/eee523a3fc18ada6e973e9fdd122dcbc2559ec99/krita/gemini/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/eee523a3fc18ada6e973e9fdd122dcbc2559ec99/krita/gemini/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/gemini/CMakeLists.txt?ref=eee523a3fc18ada6e973e9fdd122dcbc2559ec99", "patch": "@@ -21,7 +21,7 @@ set(kritagemini_SRCS\n \n \n if (WIN32)\n-    set(kritagemini_SRCS ${kritagemini_SRCS} KritaGeminiWin.xmlgui)\n+    set(kritagemini_SRCS ${kritagemini_SRCS} KritaGeminiWin.rc)\n else ()\n     ecm_add_app_icon(kritagemini_SRCS ICONS kritagemini.png)\n endif ()"}, {"sha": "4badaaf3cbb8c75d9702f6ae31a0b74e700eb0f2", "filename": "krita/gemini/KritaGeminiWin.rc", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/KDE/krita/blob/eee523a3fc18ada6e973e9fdd122dcbc2559ec99/krita/gemini/KritaGeminiWin.rc", "raw_url": "https://github.com/KDE/krita/raw/eee523a3fc18ada6e973e9fdd122dcbc2559ec99/krita/gemini/KritaGeminiWin.rc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/gemini/KritaGeminiWin.rc?ref=eee523a3fc18ada6e973e9fdd122dcbc2559ec99", "previous_filename": "krita/gemini/KritaGeminiWin.xmlgui"}, {"sha": "1b80f4e02eaa94c6b126604f1fc7b9d38b14c214", "filename": "krita/sketch/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/eee523a3fc18ada6e973e9fdd122dcbc2559ec99/krita/sketch/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/eee523a3fc18ada6e973e9fdd122dcbc2559ec99/krita/sketch/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/sketch/CMakeLists.txt?ref=eee523a3fc18ada6e973e9fdd122dcbc2559ec99", "patch": "@@ -107,7 +107,7 @@ ${KRITA_COLORSELECTORNG_SOURCE_DIR}/kis_color_selector_combo_box.cpp\n \n \n if (WIN32)\n-    set(kritasketch_SRCS ${kritasketch_SRCS} KritaSketchWin.xmlgui)\n+    set(kritasketch_SRCS ${kritasketch_SRCS} KritaSketchWin.rc)\n else ()\n     file(GLOB ICONS_SRCS \"${CMAKE_CURRENT_SOURCE_DIR}/icon/*-apps-kritasketch.png\")\n     ecm_add_app_icon(kritasketch_SRCS ICONS ${ICONS_SRCS})"}, {"sha": "6f1447e3431388710edfb56dc9e5fd887416e548", "filename": "krita/sketch/KritaSketchWin.rc", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/KDE/krita/blob/eee523a3fc18ada6e973e9fdd122dcbc2559ec99/krita/sketch/KritaSketchWin.rc", "raw_url": "https://github.com/KDE/krita/raw/eee523a3fc18ada6e973e9fdd122dcbc2559ec99/krita/sketch/KritaSketchWin.rc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/sketch/KritaSketchWin.rc?ref=eee523a3fc18ada6e973e9fdd122dcbc2559ec99", "previous_filename": "krita/sketch/KritaSketchWin.xmlgui"}]}, {"sha": "452e0b8da26f8e9fd58b93f8b04326e0b7703aeb", "stats": {"total": 9, "additions": 5, "deletions": 4}, "files": [{"sha": "4c9796ca3db99d60672d43ad09bb836c2558eeac", "filename": "plugins/color/lcms2engine/colorspaces/rgb_u16/RgbU16ColorSpace.cpp", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/KDE/krita/blob/452e0b8da26f8e9fd58b93f8b04326e0b7703aeb/plugins/color/lcms2engine/colorspaces/rgb_u16/RgbU16ColorSpace.cpp", "raw_url": "https://github.com/KDE/krita/raw/452e0b8da26f8e9fd58b93f8b04326e0b7703aeb/plugins/color/lcms2engine/colorspaces/rgb_u16/RgbU16ColorSpace.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/color/lcms2engine/colorspaces/rgb_u16/RgbU16ColorSpace.cpp?ref=452e0b8da26f8e9fd58b93f8b04326e0b7703aeb", "patch": "@@ -25,6 +25,7 @@\n \n #include \"compositeops/KoCompositeOps.h\"\n #include \"compositeops/RgbCompositeOps.h\"\n+#include \"kis_dom_utils.h\"\n \n RgbU16ColorSpace::RgbU16ColorSpace(const QString &name, KoColorProfile *p) :\n     LcmsColorSpace<KoBgrU16Traits>(colorSpaceId(), name, TYPE_BGRA_16, cmsSigRgbData, p)\n@@ -70,9 +71,9 @@ void RgbU16ColorSpace::colorToXML(const quint8 *pixel, QDomDocument &doc, QDomEl\n void RgbU16ColorSpace::colorFromXML(quint8 *pixel, const QDomElement &elt) const\n {\n     KoBgrU16Traits::Pixel *p = reinterpret_cast<KoBgrU16Traits::Pixel *>(pixel);\n-    p->red = KoColorSpaceMaths< qreal, KoBgrU16Traits::channels_type >::scaleToA(elt.attribute(\"r\").toDouble());\n-    p->green = KoColorSpaceMaths< qreal, KoBgrU16Traits::channels_type >::scaleToA(elt.attribute(\"g\").toDouble());\n-    p->blue = KoColorSpaceMaths< qreal, KoBgrU16Traits::channels_type >::scaleToA(elt.attribute(\"b\").toDouble());\n+    p->red = KoColorSpaceMaths< qreal, KoBgrU16Traits::channels_type >::scaleToA(KisDomUtils::Private::stringToDouble(elt.attribute(\"r\")));\n+    p->green = KoColorSpaceMaths< qreal, KoBgrU16Traits::channels_type >::scaleToA(KisDomUtils::Private::stringToDouble(elt.attribute(\"g\")));\n+    p->blue = KoColorSpaceMaths< qreal, KoBgrU16Traits::channels_type >::scaleToA(KisDomUtils::Private::stringToDouble(elt.attribute(\"b\")));\n     p->alpha = KoColorSpaceMathsTraits<quint16>::max;\n }\n \n@@ -103,4 +104,4 @@ QVector <double> RgbU16ColorSpace::fromYUV(qreal *y, qreal *u, qreal *v) const\n     YUVToRGB(*y, *u, *v, &channelValues[0],&channelValues[1],&channelValues[2], lumaCoefficients()[0], lumaCoefficients()[1], lumaCoefficients()[2]);\n     channelValues[3]=1.0;\n     return channelValues;\n-}\n\\ No newline at end of file\n+}"}]}, {"sha": "3710ed1a63f8471e5686f02e2b279d9bc6db5393", "stats": {"total": 14, "additions": 6, "deletions": 8}, "files": [{"sha": "31fcaba26e79a696734a56506c5647b185f68ffa", "filename": "libs/widgets/KoGradientEditWidget.cpp", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/KDE/krita/blob/3710ed1a63f8471e5686f02e2b279d9bc6db5393/libs/widgets/KoGradientEditWidget.cpp", "raw_url": "https://github.com/KDE/krita/raw/3710ed1a63f8471e5686f02e2b279d9bc6db5393/libs/widgets/KoGradientEditWidget.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgets/KoGradientEditWidget.cpp?ref=3710ed1a63f8471e5686f02e2b279d9bc6db5393", "patch": "@@ -242,10 +242,13 @@ void KoGradientEditWidget::updateUI()\n             break;\n         }\n     }\n-    if (equalOpacity)\n+\n+    m_opacity->setEnabled(equalOpacity);\n+    if (equalOpacity) {\n         m_opacity->setValue(opacity * 100);\n-    else\n-        m_opacity->setValue(100);\n+    }\n+\n+\n \n     // now update the stop color and opacity\n     const bool colorStopSelected = m_stopIndex >= 0 && m_stopIndex < m_stops.count();"}, {"sha": "8c5286af2e3828dd47df4ae08b5dcc560d3fc4c0", "filename": "plugins/tools/karbonplugins/tools/KarbonGradientTool.cpp", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/3710ed1a63f8471e5686f02e2b279d9bc6db5393/plugins/tools/karbonplugins/tools/KarbonGradientTool.cpp", "raw_url": "https://github.com/KDE/krita/raw/3710ed1a63f8471e5686f02e2b279d9bc6db5393/plugins/tools/karbonplugins/tools/KarbonGradientTool.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/karbonplugins/tools/KarbonGradientTool.cpp?ref=3710ed1a63f8471e5686f02e2b279d9bc6db5393", "patch": "@@ -345,8 +345,6 @@ void KarbonGradientTool::activate(ToolActivation toolActivation, const QSet<KoSh\n     m_oldSnapStrategies = canvas()->snapGuide()->enabledSnapStrategies();\n     canvas()->snapGuide()->enableSnapStrategies(KoSnapGuide::BoundingBoxSnapping);\n     canvas()->snapGuide()->reset();\n-\n-    connect(canvas()->shapeManager(), SIGNAL(selectionContentChanged()), this, SLOT(initialize()));\n }\n \n void KarbonGradientTool::initialize()\n@@ -475,9 +473,6 @@ void KarbonGradientTool::initialize()\n \n void KarbonGradientTool::deactivate()\n {\n-    // we are not interested in selection content changes when not active\n-    disconnect(canvas()->shapeManager(), SIGNAL(selectionContentChanged()), this, SLOT(initialize()));\n-\n     delete m_gradient;\n     m_gradient = 0;\n "}]}, {"sha": "922ab5e4950d87d4d61f1deeb215e6365177288a", "stats": {"total": 74, "additions": 47, "deletions": 27}, "files": [{"sha": "3b061e5faf5cd61394bd92aa13d5f0dd40989bfd", "filename": "libs/global/kis_acs_pixel_cache_renderer.h", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/KDE/krita/blob/922ab5e4950d87d4d61f1deeb215e6365177288a/libs/global/kis_acs_pixel_cache_renderer.h", "raw_url": "https://github.com/KDE/krita/raw/922ab5e4950d87d4d61f1deeb215e6365177288a/libs/global/kis_acs_pixel_cache_renderer.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/global/kis_acs_pixel_cache_renderer.h?ref=922ab5e4950d87d4d61f1deeb215e6365177288a", "previous_filename": "plugins/dockers/advancedcolorselector/kis_acs_pixel_cache_renderer.h"}, {"sha": "147754ee81dd513c53ff79eec398148421ab49c5", "filename": "libs/global/kis_acs_types.h", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/KDE/krita/blob/922ab5e4950d87d4d61f1deeb215e6365177288a/libs/global/kis_acs_types.h", "raw_url": "https://github.com/KDE/krita/raw/922ab5e4950d87d4d61f1deeb215e6365177288a/libs/global/kis_acs_types.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/global/kis_acs_types.h?ref=922ab5e4950d87d4d61f1deeb215e6365177288a", "previous_filename": "plugins/dockers/advancedcolorselector/kis_acs_types.h"}, {"sha": "d56339615d59a79f480e75bb5a723189b81faada", "filename": "plugins/dockers/advancedcolorselector/kis_color_selector_base.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/922ab5e4950d87d4d61f1deeb215e6365177288a/plugins/dockers/advancedcolorselector/kis_color_selector_base.h", "raw_url": "https://github.com/KDE/krita/raw/922ab5e4950d87d4d61f1deeb215e6365177288a/plugins/dockers/advancedcolorselector/kis_color_selector_base.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/advancedcolorselector/kis_color_selector_base.h?ref=922ab5e4950d87d4d61f1deeb215e6365177288a", "patch": "@@ -94,7 +94,7 @@ protected Q_SLOTS:\n     /// if you overwrite this, keep in mind, that you should set the colour only, if m_colorUpdateAllowed is true\n     virtual void canvasResourceChanged(int key, const QVariant& v);\n \n-public Q_SLOTS:\n+public:\n     // This is a private interface for signal compressor, don't use it.\n     // Use requestUpdateColorAndPreview() instead\n     void slotUpdateColorAndPreview(QPair<KoColor, Acs::ColorRole> color);"}, {"sha": "717531fcda3c09e9f3205e8b3f7764a1ef6b4756", "filename": "plugins/dockers/artisticcolorselector/kis_color_selector.cpp", "status": "modified", "additions": 28, "deletions": 19, "changes": 47, "blob_url": "https://github.com/KDE/krita/blob/922ab5e4950d87d4d61f1deeb215e6365177288a/plugins/dockers/artisticcolorselector/kis_color_selector.cpp", "raw_url": "https://github.com/KDE/krita/raw/922ab5e4950d87d4d61f1deeb215e6365177288a/plugins/dockers/artisticcolorselector/kis_color_selector.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/artisticcolorselector/kis_color_selector.cpp?ref=922ab5e4950d87d4d61f1deeb215e6365177288a", "patch": "@@ -46,12 +46,16 @@ KisColorSelector::KisColorSelector(QWidget* parent, KisColor::Type type):\n     m_inverseSaturation(false),\n     m_relativeLight(false),\n     m_light(0.5f),\n-    m_selectedColorIsFgColor(true),\n+    m_selectedColorRole(Acs::Foreground),\n     m_clickedRing(-1)\n {\n     recalculateRings(9, 12);\n     recalculateAreas(9);\n     selectColor(KisColor(Qt::red, KisColor::HSY));\n+\n+    using namespace std::placeholders; // For _1 placeholder\n+    auto function = std::bind(&KisColorSelector::slotUpdateColorAndPreview, this, _1);\n+    m_updateColorCompressor.reset(new ColorCompressorType(20 /* ms */, function));\n }\n \n void KisColorSelector::setColorSpace(KisColor::Type type)\n@@ -317,18 +321,23 @@ void KisColorSelector::createRing(ColorRing& ring, quint8 numPieces, qreal inner\n     }\n }\n \n-void KisColorSelector::setSelectedColor(const KisColor& color, bool selectAsFgColor, bool emitSignal)\n+void KisColorSelector::requestUpdateColorAndPreview(const KisColor &color, Acs::ColorRole role)\n {\n-    if (selectAsFgColor) { m_fgColor = color; }\n-    else                 { m_bgColor = color; }\n-    \n-    m_selectedColor          = color;\n-    m_selectedColorIsFgColor = selectAsFgColor;\n-    \n-    if (emitSignal) {\n-        if (selectAsFgColor) { emit sigFgColorChanged(m_selectedColor); }\n-        else                 { emit sigBgColorChanged(m_selectedColor); }\n-    }\n+    m_updateColorCompressor->start(qMakePair(color, role));\n+}\n+\n+void KisColorSelector::slotUpdateColorAndPreview(QPair<KisColor, Acs::ColorRole> color)\n+{\n+    const bool selectAsFgColor = color.second == Acs::Foreground;\n+\n+    if (selectAsFgColor) { m_fgColor = color.first; }\n+    else                 { m_bgColor = color.first; }\n+\n+    m_selectedColor          = color.first;\n+    m_selectedColorRole = color.second;\n+\n+    if (selectAsFgColor) { emit sigFgColorChanged(m_selectedColor); }\n+    else                 { emit sigBgColorChanged(m_selectedColor); }\n }\n \n void KisColorSelector::drawRing(QPainter& painter, KisColorSelector::ColorRing& ring, const QRect& rect)\n@@ -547,7 +556,7 @@ void KisColorSelector::mousePressEvent(QMouseEvent* event)\n     if (clickedLightPiece >= 0) {\n         setLight(getLight(event->posF()), m_relativeLight);\n         m_selectedLightPiece = clickedLightPiece;\n-        setSelectedColor(m_selectedColor, !(m_pressedButtons & Qt::RightButton), true);\n+        requestUpdateColorAndPreview(m_selectedColor, Acs::buttonsToRole(Qt::NoButton, m_pressedButtons));\n         m_mouseMoved   = true;\n     }\n     else if (m_clickedRing >= 0) {\n@@ -560,7 +569,7 @@ void KisColorSelector::mousePressEvent(QMouseEvent* event)\n             m_selectedColor.setH(angle.scaled(0.0f, 1.0f));\n             m_selectedColor.setS(getSaturation(m_clickedRing));\n             m_selectedColor.setX(getLight(m_light, m_selectedColor.getH(), m_relativeLight));\n-            setSelectedColor(m_selectedColor, !(m_pressedButtons & Qt::RightButton), true);\n+            requestUpdateColorAndPreview(m_selectedColor, Acs::buttonsToRole(Qt::NoButton, m_pressedButtons));\n             m_selectedRing = m_clickedRing;\n             m_mouseMoved   = true;\n             update();\n@@ -576,7 +585,7 @@ void KisColorSelector::mouseMoveEvent(QMouseEvent* event)\n     if (clickedLightPiece >= 0) {\n         setLight(getLight(event->posF()), m_relativeLight);\n         m_selectedLightPiece = clickedLightPiece;\n-        setSelectedColor(m_selectedColor, m_selectedColorIsFgColor, true);\n+        requestUpdateColorAndPreview(m_selectedColor, m_selectedColorRole);\n     }\n     \n     if (m_clickedRing < 0)\n@@ -604,7 +613,7 @@ void KisColorSelector::mouseMoveEvent(QMouseEvent* event)\n                 color.setX(getLight(m_light, color.getH(), m_relativeLight));\n                 \n                 m_selectedPiece = getHueIndex(angle, m_colorRings[m_clickedRing].getShift());\n-                setSelectedColor(color, m_selectedColorIsFgColor, true);\n+                requestUpdateColorAndPreview(color, m_selectedColorRole);\n             }\n             \n             m_mouseMoved = true;\n@@ -614,7 +623,7 @@ void KisColorSelector::mouseMoveEvent(QMouseEvent* event)\n         Radian angle = std::atan2(dragPos.x(), dragPos.y()) - RAD_90;\n         m_selectedColor.setH(angle.scaled(0.0f, 1.0f));\n         m_selectedColor.setX(getLight(m_light, m_selectedColor.getH(), m_relativeLight));\n-        setSelectedColor(m_selectedColor, m_selectedColorIsFgColor, true);\n+        requestUpdateColorAndPreview(m_selectedColor, m_selectedColorRole);\n     }\n     \n     update();\n@@ -636,10 +645,10 @@ void KisColorSelector::mouseReleaseEvent(QMouseEvent* /*event*/)\n         m_selectedColor.setS(getSaturation(m_selectedRing));\n         m_selectedColor.setX(getLight(m_light, m_selectedColor.getH(), m_relativeLight));\n         \n-        setSelectedColor(m_selectedColor, !(m_pressedButtons & Qt::RightButton));\n+        requestUpdateColorAndPreview(m_selectedColor, Acs::buttonsToRole(Qt::NoButton, m_pressedButtons));\n     }\n     else if (m_mouseMoved)\n-        setSelectedColor(m_selectedColor, m_selectedColorIsFgColor);\n+        requestUpdateColorAndPreview(m_selectedColor, m_selectedColorRole);\n     \n     m_clickedRing = -1;\n     update();"}, {"sha": "f7d8b7506af79301d25badbb9e77b3fd78561459", "filename": "plugins/dockers/artisticcolorselector/kis_color_selector.h", "status": "modified", "additions": 18, "deletions": 7, "changes": 25, "blob_url": "https://github.com/KDE/krita/blob/922ab5e4950d87d4d61f1deeb215e6365177288a/plugins/dockers/artisticcolorselector/kis_color_selector.h", "raw_url": "https://github.com/KDE/krita/raw/922ab5e4950d87d4d61f1deeb215e6365177288a/plugins/dockers/artisticcolorselector/kis_color_selector.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/artisticcolorselector/kis_color_selector.h?ref=922ab5e4950d87d4d61f1deeb215e6365177288a", "patch": "@@ -26,6 +26,8 @@\n \n #include \"kis_color.h\"\n #include \"kis_radian.h\"\n+#include \"kis_acs_types.h\"\n+#include \"kis_signal_compressor_with_param.h\"\n \n class QPainter;\n class QPainter;\n@@ -84,7 +86,7 @@ class KisColorSelector: public QWidget\n     qreal          getLight            () const { return m_light;             }\n     bool           isSaturationInverted() const { return m_inverseSaturation; }\n     bool           islightRelative     () const { return m_relativeLight;     }\n-    \n+\n Q_SIGNALS:\n     void sigFgColorChanged(const KisColor& color);\n     void sigBgColorChanged(const KisColor& color);\n@@ -95,16 +97,17 @@ class KisColorSelector: public QWidget\n     virtual void mouseReleaseEvent(QMouseEvent* event);\n     virtual void resizeEvent(QResizeEvent* event);\n     virtual void paintEvent(QPaintEvent* event);\n-    \n+\n+    void requestUpdateColorAndPreview(const KisColor &color, Acs::ColorRole role);\n+\n     void recalculateAreas(quint8 numLightPieces);\n     void recalculateRings(quint8 numRings, quint8 numPieces);\n     void createRing(ColorRing& wheel, quint8 numPieces, qreal innerRadius, qreal outerRadius);\n-    \n+\n     void drawRing(QPainter& painter, ColorRing& wheel, const QRect& rect);\n     void drawOutline(QPainter& painter, const QRect& rect);\n     void drawLightStrip(QPainter& painter, const QRect& rect);\n-    void setSelectedColor(const KisColor& color, bool selectAsFgColor, bool emitSignal=true);\n-    \n+\n     qint8 getHueIndex(Radian hue, Radian shift=0.0f) const;\n     qreal getHue(int hueIdx, Radian shift=0.0f) const;\n     qint8 getLightIndex(const QPointF& pt) const;\n@@ -116,7 +119,12 @@ class KisColorSelector: public QWidget\n     qreal getSaturation(int saturationIdx) const;\n     \n     QPointF mapCoord(const QPointF& pt, const QRectF& rect) const;\n-    \n+\n+public:\n+    // This is a private interface for signal compressor, don't use it.\n+    // Use requestUpdateColorAndPreview() instead\n+    void slotUpdateColorAndPreview(QPair<KisColor, Acs::ColorRole> color);\n+\n private:\n     KisColor::Type     m_colorSpace;\n     quint8             m_numPieces;\n@@ -134,11 +142,14 @@ class KisColorSelector: public QWidget\n     QRect              m_renderArea;\n     QRect              m_lightStripArea;\n     bool               m_mouseMoved;\n-    bool               m_selectedColorIsFgColor;\n+    Acs::ColorRole     m_selectedColorRole;\n     QPointF            m_clickPos;\n     qint8              m_clickedRing;\n     QVector<ColorRing> m_colorRings;\n     Qt::MouseButtons   m_pressedButtons;\n+\n+    typedef KisSignalCompressorWithParam<QPair<KisColor, Acs::ColorRole>> ColorCompressorType;\n+    QScopedPointer<ColorCompressorType> m_updateColorCompressor;\n };\n \n #endif // H_KIS_COLOR_SELECTOR_H"}]}, {"sha": "3c12bddb9c9e61c9876e096279c3cd8fcfb74fdb", "stats": {"total": 31, "additions": 28, "deletions": 3}, "files": [{"sha": "fc0b2b5bcae3875fd5fad61349fb183d47123637", "filename": "plugins/dockers/advancedcolorselector/kis_color_selector.cpp", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/3c12bddb9c9e61c9876e096279c3cd8fcfb74fdb/plugins/dockers/advancedcolorselector/kis_color_selector.cpp", "raw_url": "https://github.com/KDE/krita/raw/3c12bddb9c9e61c9876e096279c3cd8fcfb74fdb/plugins/dockers/advancedcolorselector/kis_color_selector.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/advancedcolorselector/kis_color_selector.cpp?ref=3c12bddb9c9e61c9876e096279c3cd8fcfb74fdb", "patch": "@@ -307,11 +307,10 @@ void KisColorSelector::mouseEvent(QMouseEvent *e)\n         m_grabbingComponent->mouseEvent(e->x(), e->y());\n \n         KoColor color = m_mainComponent->currentColor();\n+        Acs::ColorRole role = Acs::buttonsToRole(e->button(), e->buttons());\n         m_currentRealColor = color;\n-        updateColorPreview(color);\n \n-        Acs::ColorRole role = Acs::buttonsToRole(e->button(), e->buttons());\n-        updateColor(color, role, false);\n+        requestUpdateColorAndPreview(color, role);\n     }\n }\n "}, {"sha": "e36c3d761751e8151c32a29400030ec3efd4da63", "filename": "plugins/dockers/advancedcolorselector/kis_color_selector_base.cpp", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/KDE/krita/blob/3c12bddb9c9e61c9876e096279c3cd8fcfb74fdb/plugins/dockers/advancedcolorselector/kis_color_selector_base.cpp", "raw_url": "https://github.com/KDE/krita/raw/3c12bddb9c9e61c9876e096279c3cd8fcfb74fdb/plugins/dockers/advancedcolorselector/kis_color_selector_base.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/advancedcolorselector/kis_color_selector_base.cpp?ref=3c12bddb9c9e61c9876e096279c3cd8fcfb74fdb", "patch": "@@ -109,6 +109,10 @@ KisColorSelectorBase::KisColorSelectorBase(QWidget *parent) :\n     m_hideTimer->setInterval(0);\n     m_hideTimer->setSingleShot(true);\n     connect(m_hideTimer, SIGNAL(timeout()), this, SLOT(hidePopup()));\n+\n+    using namespace std::placeholders; // For _1 placeholder\n+    auto function = std::bind(&KisColorSelectorBase::slotUpdateColorAndPreview, this, _1);\n+    m_updateColorCompressor.reset(new ColorCompressorType(20 /* ms */, function));\n }\n \n KisColorSelectorBase::~KisColorSelectorBase()\n@@ -331,6 +335,17 @@ void KisColorSelectorBase::updateColor(const KoColor &color, Acs::ColorRole role\n     }\n }\n \n+void KisColorSelectorBase::requestUpdateColorAndPreview(const KoColor &color, Acs::ColorRole role)\n+{\n+    m_updateColorCompressor->start(qMakePair(color, role));\n+}\n+\n+void KisColorSelectorBase::slotUpdateColorAndPreview(QPair<KoColor, Acs::ColorRole> color)\n+{\n+    updateColorPreview(color.first);\n+    updateColor(color.first, color.second, false);\n+}\n+\n void KisColorSelectorBase::setColor(const KoColor& color)\n {\n     Q_UNUSED(color);"}, {"sha": "44ff27f8e5456ddabc6f88cdb6ab1161edae4da7", "filename": "plugins/dockers/advancedcolorselector/kis_color_selector_base.h", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/3c12bddb9c9e61c9876e096279c3cd8fcfb74fdb/plugins/dockers/advancedcolorselector/kis_color_selector_base.h", "raw_url": "https://github.com/KDE/krita/raw/3c12bddb9c9e61c9876e096279c3cd8fcfb74fdb/plugins/dockers/advancedcolorselector/kis_color_selector_base.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/advancedcolorselector/kis_color_selector_base.h?ref=3c12bddb9c9e61c9876e096279c3cd8fcfb74fdb", "patch": "@@ -23,6 +23,8 @@\n #include <QPointer>\n #include <kis_canvas2.h>\n #include \"kis_acs_types.h\"\n+#include \"kis_signal_compressor_with_param.h\"\n+\n \n class KoColor;\n class QTimer;\n@@ -80,6 +82,7 @@ public Q_SLOTS:\n     void setHidingTime(int time);\n     bool isPopup() const { return m_isPopup; }\n     void mouseMoveEvent(QMouseEvent *event);\n+    void requestUpdateColorAndPreview(const KoColor &color, Acs::ColorRole role);\n \n private:\n     void commitColor(const KoColor& koColor, Acs::ColorRole role);\n@@ -91,6 +94,11 @@ protected Q_SLOTS:\n     /// if you overwrite this, keep in mind, that you should set the colour only, if m_colorUpdateAllowed is true\n     virtual void canvasResourceChanged(int key, const QVariant& v);\n \n+public Q_SLOTS:\n+    // This is a private interface for signal compressor, don't use it.\n+    // Use requestUpdateColorAndPreview() instead\n+    void slotUpdateColorAndPreview(QPair<KoColor, Acs::ColorRole> color);\n+\n private:\n     void lazyCreatePopup();\n \n@@ -109,6 +117,9 @@ protected Q_SLOTS:\n     bool m_isPopup; //this instance is a popup\n     bool m_hideOnMouseClick;\n     KisColorPreviewPopup* m_colorPreviewPopup;\n+\n+    typedef KisSignalCompressorWithParam<QPair<KoColor, Acs::ColorRole>> ColorCompressorType;\n+    QScopedPointer<ColorCompressorType> m_updateColorCompressor;\n };\n \n #endif"}]}, {"sha": "7436999f85c888dcfd5e4c03eea6ee59b2d236bc", "stats": {"total": 3, "additions": 2, "deletions": 1}, "files": [{"sha": "5e9bcf401ca5fb427dca916f024105cfe86abb7d", "filename": "libs/widgets/KoPageLayoutDialog.cpp", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/7436999f85c888dcfd5e4c03eea6ee59b2d236bc/libs/widgets/KoPageLayoutDialog.cpp", "raw_url": "https://github.com/KDE/krita/raw/7436999f85c888dcfd5e4c03eea6ee59b2d236bc/libs/widgets/KoPageLayoutDialog.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgets/KoPageLayoutDialog.cpp?ref=7436999f85c888dcfd5e4c03eea6ee59b2d236bc", "patch": "@@ -56,7 +56,8 @@ KoPageLayoutDialog::KoPageLayoutDialog(QWidget *parent, const KoPageLayout &layo\n     lay->addWidget(d->pageLayoutWidget,1);\n \n     KoPagePreviewWidget *prev = new KoPagePreviewWidget(widget);\n-    prev->setPageLayout(layout);\n+    // use not original layout, but \"fixed\" one (e.g. with 0 values) as now hold by pageLayoutWidget\n+    prev->setPageLayout(d->pageLayoutWidget->pageLayout());\n     lay->addWidget(prev, 1);\n \n     connect (d->pageLayoutWidget, SIGNAL(layoutChanged(const KoPageLayout&)),"}]}, {"sha": "d64d85fb10a58b6ed3b9451abeb1927576052e4d", "stats": {"total": 231, "additions": 209, "deletions": 22}, "files": [{"sha": "b3146433989884c6bfdebb112ae0cdaca69910fe", "filename": "libs/image/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/d64d85fb10a58b6ed3b9451abeb1927576052e4d/libs/image/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/d64d85fb10a58b6ed3b9451abeb1927576052e4d/libs/image/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/CMakeLists.txt?ref=d64d85fb10a58b6ed3b9451abeb1927576052e4d", "patch": "@@ -180,6 +180,7 @@ set(kritaimage_LIB_SRCS\n    kis_signal_compressor_with_param.cpp\n    kis_thread_safe_signal_compressor.cpp\n    kis_acyclic_signal_connector.cpp\n+   kis_timed_signal_threshold.cpp\n    kis_layer.cc\n    kis_indirect_painting_support.cpp\n    kis_abstract_projection_plane.cpp"}, {"sha": "98a9244e51effbe09998ef4c9934c61cd107caf3", "filename": "libs/image/kis_timed_signal_threshold.cpp", "status": "added", "additions": 82, "deletions": 0, "changes": 82, "blob_url": "https://github.com/KDE/krita/blob/d64d85fb10a58b6ed3b9451abeb1927576052e4d/libs/image/kis_timed_signal_threshold.cpp", "raw_url": "https://github.com/KDE/krita/raw/d64d85fb10a58b6ed3b9451abeb1927576052e4d/libs/image/kis_timed_signal_threshold.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_timed_signal_threshold.cpp?ref=d64d85fb10a58b6ed3b9451abeb1927576052e4d", "patch": "@@ -0,0 +1,82 @@\n+/*\n+ *  Copyright (c) 2016 Dmitry Kazakov <dimula73@gmail.com>\n+ *\n+ *  This program is free software; you can redistribute it and/or modify\n+ *  it under the terms of the GNU General Public License as published by\n+ *  the Free Software Foundation; either version 2 of the License, or\n+ *  (at your option) any later version.\n+ *\n+ *  This program is distributed in the hope that it will be useful,\n+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License\n+ *  along with this program; if not, write to the Free Software\n+ *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.\n+ */\n+\n+#include \"kis_timed_signal_threshold.h\"\n+#include <QElapsedTimer>\n+#include \"kis_debug.h\"\n+\n+\n+struct KisTimedSignalThreshold::Private\n+{\n+    Private(int _delay, int _cancelDelay)\n+        : delay(_delay),\n+          cancelDelay(_cancelDelay),\n+          enabled(true)\n+    {\n+        if (cancelDelay < 0) {\n+            cancelDelay = 2 * delay;\n+        }\n+    }\n+\n+    QElapsedTimer timer;\n+    int delay;\n+    int cancelDelay;\n+    bool enabled;\n+};\n+\n+\n+KisTimedSignalThreshold::KisTimedSignalThreshold(int delay, int cancelDelay, QObject *parent)\n+    : QObject(parent),\n+      m_d(new Private(delay, cancelDelay))\n+{\n+}\n+\n+KisTimedSignalThreshold::~KisTimedSignalThreshold()\n+{\n+}\n+\n+void KisTimedSignalThreshold::forceDone()\n+{\n+    stop();\n+    emit timeout();\n+}\n+\n+void KisTimedSignalThreshold::start()\n+{\n+    if (!m_d->timer.isValid()) {\n+        m_d->timer.start();\n+    } else if (m_d->timer.elapsed() > 2 * m_d->delay) {\n+        stop();\n+    } else if (m_d->timer.elapsed() > m_d->delay) {\n+        forceDone();\n+    }\n+}\n+\n+void KisTimedSignalThreshold::stop()\n+{\n+    m_d->timer.invalidate();\n+}\n+\n+void KisTimedSignalThreshold::setEnabled(bool value)\n+{\n+    m_d->enabled = value;\n+    if (!m_d->enabled) {\n+        stop();\n+    }\n+}\n+"}, {"sha": "55051790a75f5ce337920e4f5804714bddda913e", "filename": "libs/image/kis_timed_signal_threshold.h", "status": "added", "additions": 71, "deletions": 0, "changes": 71, "blob_url": "https://github.com/KDE/krita/blob/d64d85fb10a58b6ed3b9451abeb1927576052e4d/libs/image/kis_timed_signal_threshold.h", "raw_url": "https://github.com/KDE/krita/raw/d64d85fb10a58b6ed3b9451abeb1927576052e4d/libs/image/kis_timed_signal_threshold.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_timed_signal_threshold.h?ref=d64d85fb10a58b6ed3b9451abeb1927576052e4d", "patch": "@@ -0,0 +1,71 @@\n+/*\n+ *  Copyright (c) 2016 Dmitry Kazakov <dimula73@gmail.com>\n+ *\n+ *  This program is free software; you can redistribute it and/or modify\n+ *  it under the terms of the GNU General Public License as published by\n+ *  the Free Software Foundation; either version 2 of the License, or\n+ *  (at your option) any later version.\n+ *\n+ *  This program is distributed in the hope that it will be useful,\n+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License\n+ *  along with this program; if not, write to the Free Software\n+ *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.\n+ */\n+\n+#ifndef __KIS_TIMED_SIGNAL_THRESHOLD_H\n+#define __KIS_TIMED_SIGNAL_THRESHOLD_H\n+\n+#include \"kritaimage_export.h\"\n+#include <QScopedPointer>\n+#include <QObject>\n+\n+\n+/**\n+ * Emits the timeout() signal if and only if the flow of start()\n+ * events has been coming for a consecutive \\p delay of milliseconds.\n+ * If the events were not coming for \\p cancelDelay of milliseconds the\n+ * counting is dropped and the new period is started.\n+ */\n+class KRITAIMAGE_EXPORT KisTimedSignalThreshold : public QObject\n+{\n+    Q_OBJECT\n+public:\n+    KisTimedSignalThreshold(int delay, int cancelDelay = -1, QObject *parent = 0);\n+    ~KisTimedSignalThreshold();\n+\n+public Q_SLOTS:\n+    /**\n+     * Stops counting and emits the signal forcefully\n+     */\n+    void forceDone();\n+\n+    /**\n+     * Start/continue counting and if the signal flow is stable enough\n+     * (longer than \\p delay and shorter than \\p cancelDelay), the\n+     * timeout signal in emitted.\n+     */\n+    void start();\n+\n+    /**\n+     * Stops counting the signals flow\n+     */\n+    void stop();\n+\n+    /**\n+     * Enable or disable emitting the signal\n+     */\n+    void setEnabled(bool value);\n+\n+Q_SIGNALS:\n+    void timeout();\n+\n+private:\n+    struct Private;\n+    const QScopedPointer<Private> m_d;\n+};\n+\n+#endif /* __KIS_TIMED_SIGNAL_THRESHOLD_H */"}, {"sha": "f2c2626d42558fc6c963392ff3d3d575d258e162", "filename": "libs/ui/input/kis_input_manager.cpp", "status": "modified", "additions": 3, "deletions": 15, "changes": 18, "blob_url": "https://github.com/KDE/krita/blob/d64d85fb10a58b6ed3b9451abeb1927576052e4d/libs/ui/input/kis_input_manager.cpp", "raw_url": "https://github.com/KDE/krita/raw/d64d85fb10a58b6ed3b9451abeb1927576052e4d/libs/ui/input/kis_input_manager.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_input_manager.cpp?ref=d64d85fb10a58b6ed3b9451abeb1927576052e4d", "patch": "@@ -163,17 +163,8 @@ void KisInputManager::stopIgnoringEvents()\n \n void KisInputManager::slotFocusOnEnter(bool value)\n {\n-    if (d->focusOnEnter == value) {\n-        return;\n-    }\n-\n-    d->focusOnEnter = value;\n-\n-    if (d->focusOnEnter && d->containsPointer) {\n-        if (d->canvas) {\n-            d->canvas->canvasWidget()->setFocus();\n-        }\n-    }\n+    Q_UNUSED(value);\n+    // not used anymore\n }\n \n #if defined (__clang__)\n@@ -376,10 +367,7 @@ bool KisInputManager::eventFilterImpl(QEvent * event)\n         d->containsPointer = true;\n         //Make sure the input actions know we are active.\n         KisAbstractInputAction::setInputManager(this);\n-        //Ensure we have focus so we get key events.\n-        if (d->focusOnEnter) {\n-            d->canvas->canvasWidget()->setFocus();\n-        }\n+\n         stop_ignore_cursor_events();\n         touch_stop_block_press_events();\n "}, {"sha": "2d4c7a28e482d9500c8436308f0c94581b62836d", "filename": "libs/ui/input/kis_input_manager_p.cpp", "status": "modified", "additions": 39, "deletions": 5, "changes": 44, "blob_url": "https://github.com/KDE/krita/blob/d64d85fb10a58b6ed3b9451abeb1927576052e4d/libs/ui/input/kis_input_manager_p.cpp", "raw_url": "https://github.com/KDE/krita/raw/d64d85fb10a58b6ed3b9451abeb1927576052e4d/libs/ui/input/kis_input_manager_p.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_input_manager_p.cpp?ref=d64d85fb10a58b6ed3b9451abeb1927576052e4d", "patch": "@@ -31,7 +31,6 @@\n #include \"kis_touch_shortcut.h\"\n #include \"kis_input_profile_manager.h\"\n \n-\n /**\n  * This hungry class EventEater encapsulates event masking logic.\n  *\n@@ -147,10 +146,20 @@ KisInputManager::Private::Private(KisInputManager *qq)\n KisInputManager::Private::CanvasSwitcher::CanvasSwitcher(Private *_d, QObject *p)\n     : QObject(p),\n       d(_d),\n-      eatOneMouseStroke(false)\n+      eatOneMouseStroke(false),\n+      focusSwitchThreshold(2000)\n {\n }\n \n+void KisInputManager::Private::CanvasSwitcher::setupFocusThreshold(QObject* object)\n+{\n+    QWidget *widget = qobject_cast<QWidget*>(object);\n+    KIS_SAFE_ASSERT_RECOVER_RETURN(widget);\n+\n+    thresholdConnections.clear();\n+    thresholdConnections.addConnection(&focusSwitchThreshold, SIGNAL(timeout()), widget, SLOT(setFocus()));\n+}\n+\n void KisInputManager::Private::CanvasSwitcher::addCanvas(KisCanvas2 *canvas)\n {\n     QObject *canvasWidget = canvas->canvasWidget();\n@@ -160,6 +169,9 @@ void KisInputManager::Private::CanvasSwitcher::addCanvas(KisCanvas2 *canvas)\n         d->q->setupAsEventFilter(canvasWidget);\n         canvasWidget->installEventFilter(this);\n \n+        setupFocusThreshold(canvasWidget);\n+        focusSwitchThreshold.setEnabled(false);\n+\n         d->canvas = canvas;\n         d->toolProxy = dynamic_cast<KisToolProxy*>(canvas->toolProxy());\n     } else {\n@@ -186,9 +198,11 @@ bool KisInputManager::Private::CanvasSwitcher::eventFilter(QObject* object, QEve\n         switch (event->type()) {\n         case QEvent::FocusIn: {\n             QFocusEvent *fevent = static_cast<QFocusEvent*>(event);\n-            eatOneMouseStroke = 2 * (fevent->reason() == Qt::MouseFocusReason);\n-\n             KisCanvas2 *canvas = canvasResolver.value(object);\n+            if (canvas != d->canvas) {\n+                eatOneMouseStroke = 2 * (fevent->reason() == Qt::MouseFocusReason);\n+            }\n+\n             d->canvas = canvas;\n             d->toolProxy = dynamic_cast<KisToolProxy*>(canvas->toolProxy());\n \n@@ -197,11 +211,24 @@ bool KisInputManager::Private::CanvasSwitcher::eventFilter(QObject* object, QEve\n             object->removeEventFilter(this);\n             object->installEventFilter(this);\n \n+            setupFocusThreshold(object);\n+            focusSwitchThreshold.setEnabled(false);\n+\n             QEvent event(QEvent::Enter);\n             d->q->eventFilter(object, &event);\n             break;\n         }\n-\n+        case QEvent::FocusOut: {\n+            focusSwitchThreshold.setEnabled(true);\n+            break;\n+        }\n+        case QEvent::Enter: {\n+            break;\n+        }\n+        case QEvent::Leave: {\n+            focusSwitchThreshold.stop();\n+            break;\n+        }\n         case QEvent::Wheel: {\n             QWidget *widget = static_cast<QWidget*>(object);\n             widget->setFocus();\n@@ -211,16 +238,23 @@ bool KisInputManager::Private::CanvasSwitcher::eventFilter(QObject* object, QEve\n         case QEvent::MouseButtonRelease:\n         case QEvent::TabletPress:\n         case QEvent::TabletRelease:\n+            focusSwitchThreshold.forceDone();\n+\n             if (eatOneMouseStroke) {\n                 eatOneMouseStroke--;\n                 return true;\n             }\n             break;\n         case QEvent::MouseButtonDblClick:\n+            focusSwitchThreshold.forceDone();\n             if (eatOneMouseStroke) {\n                 return true;\n             }\n             break;\n+        case QEvent::MouseMove:\n+        case QEvent::TabletMove:\n+            focusSwitchThreshold.start();\n+            break;\n         default:\n             break;\n         }"}, {"sha": "a4a0c24ee8e9dcf3ef638f13ff2d7595e8e0ff78", "filename": "libs/ui/input/kis_input_manager_p.h", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/KDE/krita/blob/d64d85fb10a58b6ed3b9451abeb1927576052e4d/libs/ui/input/kis_input_manager_p.h", "raw_url": "https://github.com/KDE/krita/raw/d64d85fb10a58b6ed3b9451abeb1927576052e4d/libs/ui/input/kis_input_manager_p.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_input_manager_p.h?ref=d64d85fb10a58b6ed3b9451abeb1927576052e4d", "patch": "@@ -31,6 +31,9 @@\n #include \"kis_tool_proxy.h\"\n #include \"kis_signal_compressor.h\"\n #include \"input/kis_tablet_debugger.h\"\n+#include \"kis_timed_signal_threshold.h\"\n+#include \"kis_signal_auto_connection.h\"\n+\n \n class KisToolInvocationAction;\n \n@@ -109,9 +112,14 @@ class KisInputManager::Private\n         bool eventFilter(QObject* object, QEvent* event );\n \n     private:\n+        void setupFocusThreshold(QObject *object);\n+\n+    private:\n         KisInputManager::Private *d;\n         QMap<QObject*, KisCanvas2*> canvasResolver;\n         int eatOneMouseStroke;\n+        KisTimedSignalThreshold focusSwitchThreshold;\n+        KisSignalAutoConnectionsStore thresholdConnections;\n     };\n     CanvasSwitcher canvasSwitcher;\n \n@@ -133,6 +141,5 @@ class KisInputManager::Private\n     };\n     EventEater eventEater;\n \n-    bool focusOnEnter = true;\n     bool containsPointer = true;\n };"}, {"sha": "08206ee9e45ddfdbb07340c9cdd407d27aa8a68f", "filename": "libs/ui/input/kis_shortcut_matcher.cpp", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/d64d85fb10a58b6ed3b9451abeb1927576052e4d/libs/ui/input/kis_shortcut_matcher.cpp", "raw_url": "https://github.com/KDE/krita/raw/d64d85fb10a58b6ed3b9451abeb1927576052e4d/libs/ui/input/kis_shortcut_matcher.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_shortcut_matcher.cpp?ref=d64d85fb10a58b6ed3b9451abeb1927576052e4d", "patch": "@@ -81,6 +81,10 @@ class Q_DECL_HIDDEN KisShortcutMatcher::Private\n     inline bool actionsSuppressed() const {\n         return suppressAllActions || !cursorEntered;\n     }\n+\n+    inline bool actionsSuppressedIgnoreFocus() const {\n+        return suppressAllActions;\n+    }\n };\n \n KisShortcutMatcher::KisShortcutMatcher()\n@@ -360,7 +364,7 @@ bool KisShortcutMatcher::tryRunWheelShortcut(KisSingleActionShortcut::WheelActio\n template<typename T, typename U>\n bool KisShortcutMatcher::tryRunSingleActionShortcutImpl(T param, U *event, const QSet<Qt::Key> &keysState)\n {\n-    if (m_d->actionsSuppressed()) {\n+    if (m_d->actionsSuppressedIgnoreFocus()) {\n         DEBUG_EVENT_ACTION(\"Event suppressed\", event)\n         return false;\n     }"}]}, {"sha": "0f72f00cd70466d8716c26219cd347791a9c3e0d", "stats": {"total": 16, "additions": 8, "deletions": 8}, "files": [{"sha": "660ac3c9a5d0b1fa74ca3e10ff0d53bde17bc145", "filename": "windows/makepkg-32.sh", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/0f72f00cd70466d8716c26219cd347791a9c3e0d/windows/makepkg-32.sh", "raw_url": "https://github.com/KDE/krita/raw/0f72f00cd70466d8716c26219cd347791a9c3e0d/windows/makepkg-32.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/makepkg-32.sh?ref=0f72f00cd70466d8716c26219cd347791a9c3e0d", "patch": "@@ -24,7 +24,7 @@ echo $VERSION\n PACKAGENAME=$APP\"-\"$VERSION\"-x86\"\n \n mkdir -p $BUILDROOT/out/$PACKAGENAME\n-mkdir -p $BUILDROOT/out/$PACKAGENAME/bin\n+mkdir -p $BUILDROOT/out/$PACKAGENAME/bin/data\n mkdir -p $BUILDROOT/out/$PACKAGENAME/lib\n mkdir -p $BUILDROOT/out/$PACKAGENAME/share\n \n@@ -62,16 +62,16 @@ cp -r $MXEROOT/share/color $BUILDROOT/out/$PACKAGENAME/share\n cp -r $MXEROOT/share/color-schemes $BUILDROOT/out/$PACKAGENAME/share\n cp -r $MXEROOT/share/kf5 $BUILDROOT/out/$PACKAGENAME/share\n cp -r $MXEROOT/share/krita $BUILDROOT/out/$PACKAGENAME/share\n-cp -r $MXEROOT/share/locale $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/locale $BUILDROOT/out/$PACKAGENAME/bin/data\n cp -r $MXEROOT/share/mime $BUILDROOT/out/$PACKAGENAME/share\n cp -r $MXEROOT/share/ocio $BUILDROOT/out/$PACKAGENAME/share\n \n+cd $BUILDROOT\n rm krita-3.0-l10n-win-current.tar.gz || true\n rm -rf locale\n \n-wget http://nonaynever.ru/pub/l10n-win/krita-3.0-l10n-win-current.tar.gz\n+wget http://files.kde.org/krita/build/krita-3.0-l10n-win-current.tar.gz\n tar -xf krita-3.0-l10n-win-current.tar.gz\n-mkdir $BUILDROOT/out/$PACKAGENAME/bin/data\n cp -r $BUILDROOT/locale $BUILDROOT/out/$PACKAGENAME/bin/data\n \n cd $BUILDROOT/out/"}, {"sha": "b2a5146a72d1afbfc80123b0d9e31495c6258357", "filename": "windows/makepkg-64.sh", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/0f72f00cd70466d8716c26219cd347791a9c3e0d/windows/makepkg-64.sh", "raw_url": "https://github.com/KDE/krita/raw/0f72f00cd70466d8716c26219cd347791a9c3e0d/windows/makepkg-64.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/makepkg-64.sh?ref=0f72f00cd70466d8716c26219cd347791a9c3e0d", "patch": "@@ -24,7 +24,7 @@ echo $VERSION\n PACKAGENAME=$APP\"-\"$VERSION\"-x64\"\n \n mkdir -p $BUILDROOT/out/$PACKAGENAME\n-mkdir -p $BUILDROOT/out/$PACKAGENAME/bin\n+mkdir -p $BUILDROOT/out/$PACKAGENAME/bin/data\n mkdir -p $BUILDROOT/out/$PACKAGENAME/lib\n mkdir -p $BUILDROOT/out/$PACKAGENAME/share\n \n@@ -62,16 +62,16 @@ cp -r $MXEROOT/share/color $BUILDROOT/out/$PACKAGENAME/share\n cp -r $MXEROOT/share/color-schemes $BUILDROOT/out/$PACKAGENAME/share\n cp -r $MXEROOT/share/kf5 $BUILDROOT/out/$PACKAGENAME/share\n cp -r $MXEROOT/share/krita $BUILDROOT/out/$PACKAGENAME/share\n-cp -r $MXEROOT/share/locale $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/locale $BUILDROOT/out/$PACKAGENAME/bin/data\n cp -r $MXEROOT/share/mime $BUILDROOT/out/$PACKAGENAME/share\n cp -r $MXEROOT/share/ocio $BUILDROOT/out/$PACKAGENAME/share\n \n+cd $BUILDROOT\n rm krita-3.0-l10n-win-current.tar.gz || true\n rm -rf locale\n \n-wget http://nonaynever.ru/pub/l10n-win/krita-3.0-l10n-win-current.tar.gz\n+wget http://files.kde.org/krita/build/krita-3.0-l10n-win-current.tar.gz\n tar -xf krita-3.0-l10n-win-current.tar.gz\n-mkdir $BUILDROOT/out/$PACKAGENAME/bin/data\n cp -r $BUILDROOT/locale $BUILDROOT/out/$PACKAGENAME/bin/data\n \n cd $BUILDROOT/out/"}]}, {"sha": "8b2a146b4f802f0014589f1d6bf923d6335e73c7", "stats": {"total": 400, "additions": 240, "deletions": 160}, "files": [{"sha": "4a6053d92a2995ae4d4ccf9d89f109c2917a01ff", "filename": "linux/Dockerfile", "status": "removed", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/9ec59a7cbd1bfdf9321dc9ed1473023d56215b45/linux/Dockerfile", "raw_url": "https://github.com/KDE/krita/raw/9ec59a7cbd1bfdf9321dc9ed1473023d56215b45/linux/Dockerfile", "contents_url": "https://api.github.com/repos/KDE/krita/contents/linux/Dockerfile?ref=9ec59a7cbd1bfdf9321dc9ed1473023d56215b45", "patch": "@@ -1,5 +0,0 @@\n-# Due to the timeout of docker hub, we cannot build the docker image in one go.\n-# Hence we base this recipe on another docker image, krita-dependencies\n-FROM probonopd/appimages:krita-dependencies\n-ADD https://raw.githubusercontent.com/KDE/krita/master/linux/Recipe /Recipe\n-RUN bash -ex Recipe && yum clean all && rm -rf /out && rm -rf /krita.appdir /Krita*AppImage"}, {"sha": "493fd59e568c8aa342c0298d5dfc3aebcbbdf8ea", "filename": "linux/build-deps.sh", "status": "added", "additions": 128, "deletions": 0, "changes": 128, "blob_url": "https://github.com/KDE/krita/blob/8b2a146b4f802f0014589f1d6bf923d6335e73c7/linux/build-deps.sh", "raw_url": "https://github.com/KDE/krita/raw/8b2a146b4f802f0014589f1d6bf923d6335e73c7/linux/build-deps.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/linux/build-deps.sh?ref=8b2a146b4f802f0014589f1d6bf923d6335e73c7", "patch": "@@ -0,0 +1,128 @@\n+#!/bin/bash\n+\n+# Enter a CentOS 6 chroot (you could use other methods)\n+# git clone https://github.com/probonopd/AppImageKit.git\n+# ./AppImageKit/build.sh \n+# sudo ./AppImageKit/AppImageAssistant.AppDir/testappimage /isodevice/boot/iso/CentOS-6.5-x86_64-LiveCD.iso bash\n+\n+# Halt on errors\n+set -e\n+\n+# Be verbose\n+set -x\n+\n+# Now we are inside CentOS 6\n+grep -r \"CentOS release 6\" /etc/redhat-release || exit 1\n+\n+# qjsonparser, used to add metadata to the plugins needs to work in a en_US.UTF-8 environment. That's\n+# not always set correctly in CentOS 6.7\n+export LC_ALL=en_US.UTF-8\n+export LANG=en_us.UTF-8\n+\n+# Determine which architecture should be built\n+if [[ \"$(arch)\" = \"i686\" || \"$(arch)\" = \"x86_64\" ]] ; then\n+  ARCH=$(arch)\n+else\n+  echo \"Architecture could not be determined\"\n+  exit 1\n+fi\n+\n+# if the library path doesn't point to our usr/lib, linking will be broken and we won't find all deps either\n+export LD_LIBRARY_PATH=/usr/lib64/:/usr/lib:/krita.appdir/usr/lib\n+\n+git_pull_rebase_helper()\n+{\n+\tgit reset --hard HEAD\n+        git pull\n+}\n+\n+yum -y install epel-release \n+# we need to be up to date in order to install the xcb-keysyms dependency\n+yum -y update\n+# base dependencies and Qt5.\n+yum -y install wget tar bzip2 git libtool which fuse fuse-devel libpng-devel automake libtool mesa-libEGL cppunit-devel cmake glibc-headers libstdc++-devel gcc-c++ freetype-devel fontconfig-devel libxml2-devel libstdc++-devel libXrender-devel patch xcb-util-keysyms-devel libXi-devel mesa-libGL-devel libxcb libxcb-devel xcb-util xcb-util-devel\n+\n+# Newer compiler than what comes with CentOS 6\n+wget http://people.centos.org/tru/devtools-2/devtools-2.repo -O /etc/yum.repos.d/devtools-2.repo\n+yum -y install devtoolset-2-gcc devtoolset-2-gcc-c++ devtoolset-2-binutils\n+\n+# Make sure we build from the /, parts of this script depends on that. We also need to run as root...\n+cd  /\n+\n+# Build AppImageKit\n+if [ ! -d AppImageKit ] ; then\n+  git clone  --depth 1 https://github.com/probonopd/AppImageKit.git /AppImageKit\n+fi\n+\n+cd /AppImageKit/\n+git_pull_rebase_helper\n+./build.sh\n+cd /\n+\n+\n+# Workaround for:\n+# /usr/lib/librevenge-stream-0.0.so: undefined reference to `std::__detail::_List_node_base::_M_hook(std::__detail::_List_node_base*)'\n+# Use the new compiler\n+. /opt/rh/devtoolset-2/enable\n+\n+\n+# Workaround for: On CentOS 6, .pc files in /usr/lib/pkgconfig are not recognized\n+# However, this is where .pc files get installed when bulding libraries... (FIXME)\n+# I found this by comparing the output of librevenge's \"make install\" command\n+# between Ubuntu and CentOS 6\n+ln -sf /usr/share/pkgconfig /usr/lib/pkgconfig\n+\n+\n+# A krita build layout looks like this:\n+# krita/ -- the source directory\n+# krita/3rdparty -- the cmake definitions for the dependencies\n+# d -- downloads of the dependencies from files.kde.org\n+# b -- build directory for the dependencies\n+# krita_build -- build directory for krita itself\n+# krita.appdir -- install directory for krita and the dependencies\n+\n+# Get Krita\n+if [ ! -d /krita ] ; then\n+\tgit clone  --depth 1 https://github.com/KDE/krita.git /krita\n+fi\n+\n+cd /krita/\n+git_pull_rebase_helper\n+\n+# Create the build dir for the 3rdparty deps\n+if [ ! -d /b ] ; then\n+    mkdir /b\n+fi    \n+if [ ! -d /d ] ; then\n+    mkdir /d\n+fi\n+\n+# start building the deps\n+cd /b\n+\n+rm -rf /b/* || true\n+\n+cmake /krita/3rdparty \\\n+    -DCMAKE_INSTALL_PREFIX:PATH=/usr \\\n+    -DINSTALL_ROOT=/usr \\\n+    -DEXTERNALS_DOWNLOAD_DIR=/d\n+    \n+cmake --build . --config RelWithDebInfo --target ext_qt\n+cmake --build . --config RelWithDebInfo --target ext_boost\n+cmake --build . --config RelWithDebInfo --target ext_eigen3\n+cmake --build . --config RelWithDebInfo --target ext_exiv2\n+cmake --build . --config RelWithDebInfo --target ext_fftw3\n+cmake --build . --config RelWithDebInfo --target ext_lcms2\n+cmake --build . --config RelWithDebInfo --target ext_ocio\n+cmake --build . --config RelWithDebInfo --target ext_openexr\n+cmake --build . --config RelWithDebInfo --target ext_vc\n+#cmake --build . --config RelWithDebInfo --target ext_png\n+cmake --build . --config RelWithDebInfo --target ext_tiff\n+cmake --build . --config RelWithDebInfo --target ext_jpeg\n+cmake --build . --config RelWithDebInfo --target ext_libraw\n+# XXX: this builds, but cmake never manages to find the library\n+#cmake --build . --config RelWithDebInfo --target ext_openjpeg\n+cmake --build . --config RelWithDebInfo --target ext_kcrash\n+cmake --build . --config RelWithDebInfo --target ext_poppler\n+cmake --build . --config RelWithDebInfo --target ext_gsl\n+"}, {"sha": "d6410e99d359f978451dc4d66578fc42d39e319c", "filename": "linux/build-image.sh", "status": "renamed", "additions": 24, "deletions": 150, "changes": 174, "blob_url": "https://github.com/KDE/krita/blob/8b2a146b4f802f0014589f1d6bf923d6335e73c7/linux/build-image.sh", "raw_url": "https://github.com/KDE/krita/raw/8b2a146b4f802f0014589f1d6bf923d6335e73c7/linux/build-image.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/linux/build-image.sh?ref=8b2a146b4f802f0014589f1d6bf923d6335e73c7", "patch": "@@ -20,8 +20,13 @@ grep -r \"CentOS release 6\" /etc/redhat-release || exit 1\n # Also we do not want to download and build the dependencies every\n # time we build Krita on travis in the docker image. In order to\n # use newer dependencies, we re-build the docker image instead.\n-unset DO_NOT_BUILD_KRITA\n-NO_DOWNLOAD=1\n+#unset DO_NOT_BUILD_KRITA\n+#NO_DOWNLOAD=1\n+\n+# clean up\n+rm -f krita-3.0-l10n-win-current.tar.gz\n+rm -rf /out/*\n+rm -rf /krita.appdir\n \n # qjsonparser, used to add metadata to the plugins needs to work in a en_US.UTF-8 environment. That's\n # not always set correctly in CentOS 6.7\n@@ -39,160 +44,26 @@ fi\n # if the library path doesn't point to our usr/lib, linking will be broken and we won't find all deps either\n export LD_LIBRARY_PATH=/usr/lib64/:/usr/lib:/krita.appdir/usr/lib\n \n-git_pull_rebase_helper()\n-{\n-\tgit reset --hard HEAD\n-        git pull\n-}\n-\n-if [ -z \"$NO_DOWNLOAD\" ] ; then\n-yum -y install epel-release \n-# we need to be up to date in order to install the xcb-keysyms dependency\n-yum -y update\n-# base dependencies and Qt5.\n-yum -y install wget tar bzip2 git libtool which fuse fuse-devel libpng-devel automake libtool mesa-libEGL cppunit-devel cmake glibc-headers libstdc++-devel gcc-c++ freetype-devel fontconfig-devel libxml2-devel libstdc++-devel libXrender-devel patch xcb-util-keysyms-devel libXi-devel mesa-libGL-devel libxcb libxcb-devel xcb-util xcb-util-devel\n-\n-# Newer compiler than what comes with CentOS 6\n-wget http://people.centos.org/tru/devtools-2/devtools-2.repo -O /etc/yum.repos.d/devtools-2.repo\n-yum -y install devtoolset-2-gcc devtoolset-2-gcc-c++ devtoolset-2-binutils\n-\n-# Make sure we build from the /, parts of this script depends on that. We also need to run as root...\n-cd  /\n-\n-# Build AppImageKit\n-if [ ! -d AppImageKit ] ; then\n-  git clone  --depth 1 https://github.com/probonopd/AppImageKit.git /AppImageKit\n-fi\n-\n-cd /AppImageKit/\n-git_pull_rebase_helper\n-./build.sh\n cd /\n-fi # [ -z \"$NO_DOWNLOAD\" ]\n-\n-\n-# Workaround for:\n-# /usr/lib/librevenge-stream-0.0.so: undefined reference to `std::__detail::_List_node_base::_M_hook(std::__detail::_List_node_base*)'\n-# Use the new compiler\n-. /opt/rh/devtoolset-2/enable\n-\n-\n-# Workaround for: On CentOS 6, .pc files in /usr/lib/pkgconfig are not recognized\n-# However, this is where .pc files get installed when bulding libraries... (FIXME)\n-# I found this by comparing the output of librevenge's \"make install\" command\n-# between Ubuntu and CentOS 6\n-ln -sf /usr/share/pkgconfig /usr/lib/pkgconfig\n-\n-\n-# A krita build layout looks like this:\n-# krita/ -- the source directory\n-# krita/3rdparty -- the cmake definitions for the dependencies\n-# d -- downloads of the dependencies from files.kde.org\n-# b -- build directory for the dependencies\n-# krita_build -- build directory for krita itself\n-# krita.appdir -- install directory for krita and the dependencies\n-\n-# Get Krita\n-if [ ! -d /krita ] ; then\n-\tgit clone  --depth 1 https://github.com/KDE/krita.git /krita\n-fi\n-\n-cd /krita/\n-git_pull_rebase_helper\n-\n-# Create the build dir for the 3rdparty deps\n-if [ ! -d /b ] ; then\n-    mkdir /b\n-fi    \n-if [ ! -d /d ] ; then\n-    mkdir /d\n-fi\n \n # Prepare the install location\n rm -rf /krita.appdir/ || true\n-mkdir -p /krita.appdir/usr\n+mkdir -p /krita.appdir/usr/bin\n \n # make sure lib and lib64 are the same thing\n mkdir -p /krita.appdir/usr/lib\n cd  /krita.appdir/usr\n ln -s lib lib64\n \n-# start building the deps\n-cd /b\n-\n-if [ -z \"$NO_DOWNLOAD\" ] ; then\n-\n-rm -rf /b/* || true\n-\n-cmake /krita/3rdparty \\\n-    -DCMAKE_INSTALL_PREFIX:PATH=/usr \\\n-    -DINSTALL_ROOT=/usr \\\n-    -DEXTERNALS_DOWNLOAD_DIR=/d\n-    \n-cmake --build . --config RelWithDebInfo --target ext_qt\n-cmake --build . --config RelWithDebInfo --target ext_boost\n-cmake --build . --config RelWithDebInfo --target ext_eigen3\n-cmake --build . --config RelWithDebInfo --target ext_exiv2\n-cmake --build . --config RelWithDebInfo --target ext_fftw3\n-cmake --build . --config RelWithDebInfo --target ext_lcms2\n-cmake --build . --config RelWithDebInfo --target ext_ocio\n-cmake --build . --config RelWithDebInfo --target ext_openexr\n-cmake --build . --config RelWithDebInfo --target ext_vc\n-#cmake --build . --config RelWithDebInfo --target ext_png\n-cmake --build . --config RelWithDebInfo --target ext_tiff\n-cmake --build . --config RelWithDebInfo --target ext_jpeg\n-cmake --build . --config RelWithDebInfo --target ext_libraw\n-# XXX: this builds, but cmake never manages to find the library\n-#cmake --build . --config RelWithDebInfo --target ext_openjpeg\n-cmake --build . --config RelWithDebInfo --target ext_kcrash\n-# XXX: this builds, but pulls in ext_png, which leads to big conflicts\n-#cmake --build . --config RelWithDebInfo --target ext_poppler\n-cmake --build . --config RelWithDebInfo --target ext_gsl\n-\n-fi # if [ -z \"$NO_DOWNLOAD\" ]\n-    \n-cd ..\n-\n-# If the environment variable DO_NOT_BUILD_KRITA is set to something,\n-# then stop here. This is for docker hub which has a timeout that\n-# prevents us from building in one go.\n-# if [ ! -z \"$DO_NOT_BUILD_KRITA\" ] ; then\n-#  exit 0\n-# fi\n-\n-mkdir -p /krita_build\n cd /krita_build\n-cmake ../krita \\\n-    -DCMAKE_INSTALL_PREFIX:PATH=/krita.appdir/usr \\\n-    -DDEFINE_NO_DEPRECATED=1 \\\n-    -DCMAKE_BUILD_TYPE=RelWithDebInfo \\\n-    -DPACKAGERS_BUILD=1 \\\n-    -DBUILD_TESTING=FALSE \\\n-    -DKDE4_BUILD_TESTS=FALSE \\\n-    -DHAVE_MEMORY_LEAK_TRACKER=FALSE\n-    \n-# Install into the AppDir\n make -j4 install\n \n cd /krita.appdir\n \n # FIXME: How to find out which subset of plugins is really needed? I used strace when running the binary\n-mkdir -p ./usr/lib/qt5/plugins/\n-\n-if [ -e $(dirname /usr/li*/qt5/plugins/bearer) ] ; then\n-  PLUGINS=$(dirname /usr/li*/qt5/plugins/bearer)\n-else\n-  PLUGINS=../../5.5/gc*/plugins/\n-fi\n-echo $PLUGINS # /usr/lib64/qt5/plugins if build system Qt is found\n-cp -r $PLUGINS/bearer ./usr/lib/qt5/plugins/\n-cp -r $PLUGINS/generic ./usr/lib/qt5/plugins/\n-cp -r $PLUGINS/imageformats ./usr/lib/qt5/plugins/\n-cp -r $PLUGINS/platforms ./usr/lib/qt5/plugins/\n-cp -r $PLUGINS/iconengines ./usr/lib/qt5/plugins/\n-cp -r $PLUGINS/platforminputcontexts ./usr/lib/qt5/plugins/\n-cp -r $PLUGINS/platformthemes ./usr/lib/qt5/plugins/\n-cp -r $PLUGINS/xcbglintegrations ./usr/lib/qt5/plugins/\n+cp -r /usr/plugins ./usr/bin/\n+# copy the Qt translation\n+cp -r /usr/translations ./usr\n \n cp $(ldconfig -p | grep libsasl2.so.2 | cut -d \">\" -f 2 | xargs) ./usr/lib/\n cp $(ldconfig -p | grep libGL.so.1 | cut -d \">\" -f 2 | xargs) ./usr/lib/ # otherwise segfaults!?\n@@ -212,7 +83,7 @@ ldd usr/bin/krita | grep \"=>\" | awk '{print $3}' | xargs -I '{}' cp -v '{}' ./us\n #ldd usr/lib64/krita/*.so  | grep \"=>\" | awk '{print $3}' | xargs -I '{}' cp -v '{}' ./usr/lib || true\n #ldd usr/lib64/plugins/imageformats/*.so  | grep \"=>\" | awk '{print $3}' | xargs -I '{}' cp -v '{}' ./usr/lib || true\n \n-ldd usr/lib/qt5/plugins/platforms/libqxcb.so | grep \"=>\" | awk '{print $3}'  |  xargs -I '{}' cp -v '{}' ./usr/lib || true\n+ldd usr/bin/plugins/platforms/libqxcb.so | grep \"=>\" | awk '{print $3}'  |  xargs -I '{}' cp -v '{}' ./usr/lib || true\n \n # Copy in the indirect dependencies\n FILES=$(find . -type f -executable)\n@@ -275,7 +146,7 @@ rm -f usr/lib/libwind.so.0 || true\n # Remove these libraries, we need to use the system versions; this means 11.04 is not supported (12.04 is our baseline)\n rm -f usr/lib/libGL.so.* || true\n rm -f usr/lib/libdrm.so.* || true\n-\n+rm -f usr/lib/libX11.so.* || true\n #rm -f usr/lib/libz.so.1 || true\n \n # These seem to be available on most systems but not Ubuntu 11.04\n@@ -309,7 +180,7 @@ cd usr/ ; find . -type f -exec sed -i -e 's|/usr|././|g' {} \\; ; cd ..\n \n # We do not bundle this, so let's not search that inside the AppImage. \n # Fixes \"Qt: Failed to create XKB context!\" and lets us enter text\n-sed -i -e 's|././/share/X11/|/usr/share/X11/|g' ./usr/lib/qt5/plugins/platforminputcontexts/libcomposeplatforminputcontextplugin.so\n+sed -i -e 's|././/share/X11/|/usr/share/X11/|g' ./usr/bin/plugins/platforminputcontexts/libcomposeplatforminputcontextplugin.so\n sed -i -e 's|././/share/X11/|/usr/share/X11/|g' ./usr/lib/libQt5XcbQpa.so.5\n \n # Workaround for:\n@@ -328,9 +199,10 @@ cp /krita/krita/pics/app/64-apps-calligrakrita.png calligrakrita.png\n # Fetch and install the translations\n #\n cd /\n-wget http://nonaynever.ru/pub/l10n-win/krita-3.0-l10n-win-current.tar.gz\n+rm -f krita-3.0-l10-win-current.tar.gz || true\n+wget http://www.valdyas.org/~boud/krita-3.0-l10n-win-current.tar.gz\n tar -xf krita-3.0-l10n-win-current.tar.gz\n-cd /krita/appdir/usr/share\n+cd /krita.appdir/usr/share\n tar -xf /krita-3.0-l10n-win-current.tar.gz\n \n # replace krita with the lib-checking startup script.\n@@ -340,7 +212,7 @@ tar -xf /krita-3.0-l10n-win-current.tar.gz\n #chmod a+rx krita\n cd / \n \n-APP=Krita\n+APP=krita\n \n VER=$(grep \"#define KRITA_VERSION_STRING\" krita_build/libs/version/kritaversion.h | cut -d '\"' -f 2)\n cd krita\n@@ -352,10 +224,10 @@ VERSION=\"$(sed s/\\ /-/g <<<$VERSION)\"\n echo $VERSION\n \n if [[ \"$ARCH\" = \"x86_64\" ]] ; then\n-\tAPPIMAGE=$APP\"-\"$VERSION\"-x86_64.AppImage\"\n+\tAPPIMAGE=$APP\"-\"$VERSION\"-x86_64.appimage\"\n fi\n if [[ \"$ARCH\" = \"i686\" ]] ; then\n-\tAPPIMAGE=$APP\"-\"$VERSION\"-i386.AppImage\"\n+\tAPPIMAGE=$APP\"-\"$VERSION\"-i386.appimage\"\n fi\n echo $APPIMAGE\n \n@@ -366,5 +238,7 @@ AppImageKit/AppImageAssistant.AppDir/package /krita.appdir/ /out/$APPIMAGE\n \n chmod a+rwx /out/$APPIMAGE # So that we can edit the AppImage outside of the Docker container\n \n-# Test the resulting AppImage on my local system\n-# sudo /tmp/*/union/AppImageKit/AppImageAssistant.AppDir/testappimage /isodevice/boot/iso/Fedora-Live-Workstation-x86_64-22-3.iso /tmp/*/union/Scribus.AppDir/\n+cd /krita.appdir\n+mv AppRun krita\n+cd /\n+mv krita.appdir $APP\"-\"$VERSION\"-x86_64", "previous_filename": "linux/Recipe"}, {"sha": "42f210d84ba7798a855fa1d0c155eaf3119b9f4a", "filename": "linux/build-krita.sh", "status": "added", "additions": 88, "deletions": 0, "changes": 88, "blob_url": "https://github.com/KDE/krita/blob/8b2a146b4f802f0014589f1d6bf923d6335e73c7/linux/build-krita.sh", "raw_url": "https://github.com/KDE/krita/raw/8b2a146b4f802f0014589f1d6bf923d6335e73c7/linux/build-krita.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/linux/build-krita.sh?ref=8b2a146b4f802f0014589f1d6bf923d6335e73c7", "patch": "@@ -0,0 +1,88 @@\n+#!/bin/bash\n+\n+# Enter a CentOS 6 chroot (you could use other methods)\n+# git clone https://github.com/probonopd/AppImageKit.git\n+# ./AppImageKit/build.sh \n+# sudo ./AppImageKit/AppImageAssistant.AppDir/testappimage /isodevice/boot/iso/CentOS-6.5-x86_64-LiveCD.iso bash\n+\n+# Halt on errors\n+set -e\n+\n+# Be verbose\n+set -x\n+\n+# Now we are inside CentOS 6\n+grep -r \"CentOS release 6\" /etc/redhat-release || exit 1\n+\n+# qjsonparser, used to add metadata to the plugins needs to work in a en_US.UTF-8 environment. That's\n+# not always set correctly in CentOS 6.7\n+export LC_ALL=en_US.UTF-8\n+export LANG=en_us.UTF-8\n+\n+# Determine which architecture should be built\n+if [[ \"$(arch)\" = \"i686\" || \"$(arch)\" = \"x86_64\" ]] ; then\n+  ARCH=$(arch)\n+else\n+  echo \"Architecture could not be determined\"\n+  exit 1\n+fi\n+\n+# if the library path doesn't point to our usr/lib, linking will be broken and we won't find all deps either\n+export LD_LIBRARY_PATH=/usr/lib64/:/usr/lib:/krita.appdir/usr/lib\n+\n+git_pull_rebase_helper()\n+{\n+\tgit reset --hard HEAD\n+        git pull\n+}\n+\n+# Use the new compiler\n+. /opt/rh/devtoolset-2/enable\n+\n+\n+# Workaround for: On CentOS 6, .pc files in /usr/lib/pkgconfig are not recognized\n+# However, this is where .pc files get installed when bulding libraries... (FIXME)\n+# I found this by comparing the output of librevenge's \"make install\" command\n+# between Ubuntu and CentOS 6\n+ln -sf /usr/share/pkgconfig /usr/lib/pkgconfig\n+\n+\n+# A krita build layout looks like this:\n+# krita/ -- the source directory\n+# krita/3rdparty -- the cmake definitions for the dependencies\n+# d -- downloads of the dependencies from files.kde.org\n+# b -- build directory for the dependencies\n+# krita_build -- build directory for krita itself\n+# krita.appdir -- install directory for krita and the dependencies\n+\n+# Get Krita\n+if [ ! -d /krita ] ; then\n+\tgit clone  --depth 1 https://github.com/KDE/krita.git /krita\n+fi\n+\n+cd /krita/\n+git_pull_rebase_helper\n+\n+cd /\n+\n+# If the environment variable DO_NOT_BUILD_KRITA is set to something,\n+# then stop here. This is for docker hub which has a timeout that\n+# prevents us from building in one go.\n+# if [ ! -z \"$DO_NOT_BUILD_KRITA\" ] ; then\n+#  exit 0\n+# fi\n+\n+mkdir -p /krita_build\n+cd /krita_build\n+cmake ../krita \\\n+    -DCMAKE_INSTALL_PREFIX:PATH=/krita.appdir/usr \\\n+    -DDEFINE_NO_DEPRECATED=1 \\\n+    -DCMAKE_BUILD_TYPE=RelWithDebInfo \\\n+    -DPACKAGERS_BUILD=1 \\\n+    -DBUILD_TESTING=FALSE \\\n+    -DKDE4_BUILD_TESTS=FALSE \\\n+    -DHAVE_MEMORY_LEAK_TRACKER=FALSE\n+    \n+# build\n+make -j4 \n+"}, {"sha": "05c753e2e4ed30e82a0696124c6cdc6c20615f3c", "filename": "linux/dependencies/Dockerfile", "status": "removed", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/9ec59a7cbd1bfdf9321dc9ed1473023d56215b45/linux/dependencies/Dockerfile", "raw_url": "https://github.com/KDE/krita/raw/9ec59a7cbd1bfdf9321dc9ed1473023d56215b45/linux/dependencies/Dockerfile", "contents_url": "https://api.github.com/repos/KDE/krita/contents/linux/dependencies/Dockerfile?ref=9ec59a7cbd1bfdf9321dc9ed1473023d56215b45", "patch": "@@ -1,5 +0,0 @@\n-# First stage. Builds everything but Krita itself. This exists because of the docker hub timeout\n-# which prevents us from building everyting in one go\n-FROM centos:6\n-ADD https://raw.githubusercontent.com/KDE/krita/master/linux/Recipe /Recipe\n-RUN export DO_NOT_BUILD_KRITA=1 && bash -ex Recipe && yum clean all && rm -rf /out && rm -rf /krita.appdir"}]}, {"sha": "9ec59a7cbd1bfdf9321dc9ed1473023d56215b45", "stats": {"total": 55, "additions": 27, "deletions": 28}, "files": [{"sha": "7dc991877a4de4d017ad39bc4cb1637826fb6646", "filename": "CMakeLists.txt", "status": "modified", "additions": 26, "deletions": 27, "changes": 53, "blob_url": "https://github.com/KDE/krita/blob/9ec59a7cbd1bfdf9321dc9ed1473023d56215b45/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/9ec59a7cbd1bfdf9321dc9ed1473023d56215b45/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=9ec59a7cbd1bfdf9321dc9ed1473023d56215b45", "patch": "@@ -257,9 +257,6 @@ find_package(Qt5 ${MIN_QT_VERSION}\n \n set(QT_QTTEST_LIBRARY Qt5::Test)\n \n-if (NOT WIN32 AND NOT APPLE)\n-    find_package(Qt5 ${MIN_QT_VERSION} REQUIRED X11Extras)\n-endif()\n \n include (MacroLibrary)\n include (MacroAdditionalCleanFiles)\n@@ -272,37 +269,39 @@ macro_ensure_out_of_source_build(\"Compiling Krita inside the source directory is\n find_package(Qt5Quick ${MIN_QT_VERSION} QUIET)\n macro_log_feature(${Qt5Quick_FOUND} \"QtQuick\" \"Qt Quick\" \"http://www.qt.io\" FALSE \"\" \"Necessary to build the tablet gui for Krita\")\n \n-find_package(Qt5DBus ${MIN_QT_VERSION} QUIET)\n-set(HAVE_DBUS ${Qt5DBus_FOUND})\n-macro_log_feature(${Qt5DBus_FOUND} \"dbus\" \"Qt DBUS integration\" \"http://www.qt.io/\" FALSE \"\" \"Optionally used to provide a dbus api on Linux\")\n+if (NOT WIN32 AND NOT APPLE)\n \n+    find_package(Qt5 ${MIN_QT_VERSION} REQUIRED X11Extras)\n \n-if (NOT WIN32 AND NOT APPLE)\n+    find_package(Qt5DBus ${MIN_QT_VERSION} QUIET)\n+    set(HAVE_DBUS ${Qt5DBus_FOUND})\n+    macro_log_feature(${Qt5DBus_FOUND} \"dbus\" \"Qt DBUS integration\" \"http://www.qt.io/\" FALSE \"\" \"Optionally used to provide a dbus api on Linux\")\n \n-        find_package(KF5KIO ${MIN_FRAMEWORKS_VERSION} QUIET)\n-        macro_bool_to_01(KF5KIO_FOUND HAVE_KIO)\n-        macro_log_feature(${KF5KIO_FOUND} \"KIO\" \"KDE's KIO Framework\" \"http://api.kde.org/frameworks-api/frameworks5-apidocs/kio/html/index.html\" FALSE \"\" \"Optionally used for recent document handling\")\n+    find_package(KF5KIO ${MIN_FRAMEWORKS_VERSION} QUIET)\n+    macro_bool_to_01(KF5KIO_FOUND HAVE_KIO)\n+    macro_log_feature(${KF5KIO_FOUND} \"KIO\" \"KDE's KIO Framework\" \"http://api.kde.org/frameworks-api/frameworks5-apidocs/kio/html/index.html\" FALSE \"\" \"Optionally used for recent document handling\")\n \n-        find_package(KF5Crash ${MIN_FRAMEWORKS_VERSION} QUIET) \n-        macro_bool_to_01(KF5Crash_FOUND HAVE_KCRASH)\n-        macro_log_feature(${KF5Crash_FOUND} \"kcrash\" \"KDE's Crash Handler\" \"http://api.kde.org/frameworks-api/frameworks5-apidocs/kcrash/html/index.html\" FALSE \"\" \"Optionally used to provide crash reporting on Linux\")\n+    find_package(KF5Crash ${MIN_FRAMEWORKS_VERSION} QUIET) \n+    macro_bool_to_01(KF5Crash_FOUND HAVE_KCRASH)\n+    macro_log_feature(${KF5Crash_FOUND} \"kcrash\" \"KDE's Crash Handler\" \"http://api.kde.org/frameworks-api/frameworks5-apidocs/kcrash/html/index.html\" FALSE \"\" \"Optionally used to provide crash reporting on Linux\")\n \n-        find_package(X11)\n-        if(X11_FOUND)\n-            find_package(Qt5 ${MIN_QT_VERSION} REQUIRED NO_MODULE COMPONENTS X11Extras)\n-            set(HAVE_X11 TRUE)\n-            add_definitions(-DHAVE_X11)\n-        else()\n-            set(HAVE_X11 FALSE)\n-        endif()\n+    find_package(X11)\n+    if(X11_FOUND)\n+        find_package(Qt5 ${MIN_QT_VERSION} REQUIRED NO_MODULE COMPONENTS X11Extras)\n+        set(HAVE_X11 TRUE)\n+        add_definitions(-DHAVE_X11)\n+    else()\n+        set(HAVE_X11 FALSE)\n+    endif()\n \n-        find_package(XCB COMPONENTS XCB ATOM)\n-        if(XCB_FOUND)\n-            set(HAVE_XCB TRUE)\n-        else()\n-            set(HAVE_XCB FALSE)\n-        endif()\n+    find_package(XCB COMPONENTS XCB ATOM)\n+    if(XCB_FOUND)\n+        set(HAVE_XCB TRUE)\n+    else()\n+        set(HAVE_XCB FALSE)\n+    endif()\n else()\n+    set(HAVE_DBUS FALSE)\n     set(HAVE_X11 FALSE)\n     set(HAVE_XCB FALSE)\n endif()"}, {"sha": "851d53018b28e7d4affa713db142d0efc12426d2", "filename": "libs/color/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/9ec59a7cbd1bfdf9321dc9ed1473023d56215b45/libs/color/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/9ec59a7cbd1bfdf9321dc9ed1473023d56215b45/libs/color/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/color/CMakeLists.txt?ref=9ec59a7cbd1bfdf9321dc9ed1473023d56215b45", "patch": "@@ -1,4 +1,4 @@\n-if (UNIX AND NOT APPLE AND ${Qt5DBus_FOUND})\n+if (UNIX AND NOT APPLE AND HAVE_DBUS)\n     add_subdirectory(colord)\n     set(kritacolor_LIB_SRCS kis_color_manager.h linux/kis_color_manager.cpp)\n     set(kritacolor_EXTRA_LIBRARIES kritacolord)"}]}, {"sha": "20d8ec0f51661d0113294aac3a917f977d9dc64e", "stats": {"total": 2, "additions": 2, "deletions": 0}, "files": [{"sha": "edde8084816f13a1b0abb081be4cbad0d05de781", "filename": "plugins/extensions/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/20d8ec0f51661d0113294aac3a917f977d9dc64e/plugins/extensions/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/20d8ec0f51661d0113294aac3a917f977d9dc64e/plugins/extensions/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/CMakeLists.txt?ref=20d8ec0f51661d0113294aac3a917f977d9dc64e", "patch": "@@ -18,5 +18,7 @@ add_subdirectory( layersplit )\n # Allow to skip building GMIC plugin\n option(WITH_GMIC \"Build the G'Mic plugin\" ON)\n if(WITH_GMIC)\n+if (CMAKE_COMPILER_IS_GNUCC AND CMAKE_CXX_COMPILER_VERSION VERSION_GREATER 4.8.3)\n     add_subdirectory( gmic )\n endif()\n+endif()"}]}, {"sha": "83af92ba5865ff390e5f91f8978b5d3ab3d64e45", "stats": {"total": 137, "additions": 74, "deletions": 63}, "files": [{"sha": "acf3c1af7fb52fcefc32bb2040540f561cfafbcf", "filename": "libs/image/kis_paint_device.cc", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/83af92ba5865ff390e5f91f8978b5d3ab3d64e45/libs/image/kis_paint_device.cc", "raw_url": "https://github.com/KDE/krita/raw/83af92ba5865ff390e5f91f8978b5d3ab3d64e45/libs/image/kis_paint_device.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_paint_device.cc?ref=83af92ba5865ff390e5f91f8978b5d3ab3d64e45", "patch": "@@ -223,6 +223,7 @@ struct KisPaintDevice::Private\n         KIS_ASSERT_RECOVER(parentCommand) { return -1; }\n \n         DataSP data;\n+        bool initialFrame = false;\n \n         if (m_frames.isEmpty()) {\n             /**\n@@ -233,6 +234,7 @@ struct KisPaintDevice::Private\n             data = toQShared(new Data(m_data.data(), true));\n             m_data->dataManager()->clear();\n             m_data->cache()->invalidate();\n+            initialFrame = true;\n \n         } else if (copy) {\n             DataSP srcData = m_frames[copySrc];\n@@ -242,7 +244,7 @@ struct KisPaintDevice::Private\n             data = toQShared(new Data(srcData.data(), false));\n         }\n \n-        if (!copy) {\n+        if (!initialFrame && !copy) {\n             data->setX(offset.x());\n             data->setY(offset.y());\n         }"}, {"sha": "d1b3b8e80225b7c95a1c1e72b244904791fac36b", "filename": "libs/image/tests/kis_paint_device_test.cpp", "status": "modified", "additions": 71, "deletions": 62, "changes": 133, "blob_url": "https://github.com/KDE/krita/blob/83af92ba5865ff390e5f91f8978b5d3ab3d64e45/libs/image/tests/kis_paint_device_test.cpp", "raw_url": "https://github.com/KDE/krita/raw/83af92ba5865ff390e5f91f8978b5d3ab3d64e45/libs/image/tests/kis_paint_device_test.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/tests/kis_paint_device_test.cpp?ref=83af92ba5865ff390e5f91f8978b5d3ab3d64e45", "patch": "@@ -1614,42 +1614,42 @@ void KisPaintDeviceTest::testFramesLeaking()\n \n     KisPaintDeviceFramesInterface::TestingDataObjects o;\n \n-    // Itinial state: one frame, m_data shared\n+    // Itinial state: one frame, m_data is kept separate\n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data);\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 1);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n     // add keyframe at position 10\n     channel->addKeyframe(10);\n \n-    // two frames, m_data is null\n+    // two frames, m_data has a default empty value\n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data);\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 2);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n     // add keyframe at position 20\n     channel->addKeyframe(20);\n \n-    // three frames, m_data is null, current frame is 0\n+    // three frames, m_data is default, current frame is 0\n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data);\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 3);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n     // switch to frame 10\n     bounds->testingSetTime(10);\n \n-    // three frames, m_data is null, current frame is 10\n+    // three frames, m_data is default, current frame is 10\n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data);\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QVERIFY(o.m_currentData == o.m_frames[1]);\n@@ -1658,9 +1658,9 @@ void KisPaintDeviceTest::testFramesLeaking()\n     // switch to frame 20\n     bounds->testingSetTime(20);\n \n-    // three frames, m_data is null, current frame is 20\n+    // three frames, m_data is default, current frame is 20\n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data);\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QVERIFY(o.m_currentData == o.m_frames[2]);\n@@ -1669,9 +1669,9 @@ void KisPaintDeviceTest::testFramesLeaking()\n     // switch to frame 15\n     bounds->testingSetTime(15);\n \n-    // three frames, m_data is null, current frame is 10\n+    // three frames, m_data is default, current frame is 10\n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data);\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QVERIFY(o.m_currentData == o.m_frames[1]);\n@@ -1690,9 +1690,9 @@ void KisPaintDeviceTest::testFramesLeaking()\n     QCOMPARE(key->time(), 10);\n     QVERIFY(channel->deleteKeyframe(key));\n \n-    // two frames, m_data is null, current frame is 0\n+    // two frames, m_data is default, current frame is 0\n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data);\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     //QVERIFY(o.m_currentData == o.m_frames[0]);\n@@ -1706,7 +1706,7 @@ void KisPaintDeviceTest::testFramesLeaking()\n \n     // nothing changed\n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data);\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     //QVERIFY(o.m_currentData == o.m_frames[0]);\n@@ -1718,9 +1718,9 @@ void KisPaintDeviceTest::testFramesLeaking()\n     QCOMPARE(key->time(), 20);\n     QVERIFY(channel->deleteKeyframe(key));\n \n-    // one keyframe is left at position 0, m_data is shared\n+    // one keyframe is left at position 0, m_data is default\n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data);\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     //QVERIFY(o.m_currentData == o.m_frames[0]);\n@@ -1756,73 +1756,82 @@ void KisPaintDeviceTest::testFramesUndoRedo()\n \n     // Itinial state: one frame, m_data shared\n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // default m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 1);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n     // add a keyframe\n \n     KUndo2Command cmdAdd;\n+    int frameId = -1;\n+    const int time = 1;\n \n-    int frameId = i->createFrame(false, 0, QPoint(), &cmdAdd);\n+    channel->addKeyframe(time, &cmdAdd);\n+    frameId = channel->frameIdAt(time);\n+    //int frameId = i->createFrame(false, 0, QPoint(), &cmdAdd);\n \n     QCOMPARE(frameId, 1);\n \n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // default m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 2);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n     cmdAdd.undo();\n \n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // default m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 1);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n     cmdAdd.redo();\n \n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // default m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 2);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n \n     KUndo2Command cmdRemove;\n-    i->deleteFrame(1, &cmdRemove);\n+    KisKeyframeSP keyframe = channel->keyframeAt(time);\n+    QVERIFY(keyframe);\n+\n+    channel->deleteKeyframe(keyframe, &cmdRemove);\n+\n+    //i->deleteFrame(1, &cmdRemove);\n \n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // default m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 1);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n     cmdRemove.undo();\n \n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // default m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 2);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n     cmdRemove.redo();\n \n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // default m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 1);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n }\n \n void KisPaintDeviceTest::testFramesUndoRedoWithChannel()\n@@ -1845,11 +1854,11 @@ void KisPaintDeviceTest::testFramesUndoRedoWithChannel()\n \n     // Itinial state: one frame, m_data shared\n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // default m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 1);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n \n     // add a keyframe\n@@ -1861,33 +1870,33 @@ void KisPaintDeviceTest::testFramesUndoRedoWithChannel()\n     QVERIFY(channel->keyframeAt(10));\n \n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // default m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 2);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n     cmdAdd.undo();\n \n     QVERIFY(!channel->keyframeAt(10));\n \n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // default m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 1);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n     cmdAdd.redo();\n \n     QVERIFY(channel->keyframeAt(10));\n \n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // default m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 2);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n \n     KUndo2Command cmdRemove;\n@@ -1896,44 +1905,44 @@ void KisPaintDeviceTest::testFramesUndoRedoWithChannel()\n     QVERIFY(!channel->keyframeAt(10));\n \n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // default m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 1);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n     cmdRemove.undo();\n \n     QVERIFY(channel->keyframeAt(10));\n \n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // default m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 2);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n     cmdRemove.redo();\n \n     QVERIFY(!channel->keyframeAt(10));\n \n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // default m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 1);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n     cmdRemove.undo();\n \n     QVERIFY(channel->keyframeAt(10));\n \n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // default m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 2);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n \n     KUndo2Command cmdMove;\n@@ -1943,35 +1952,35 @@ void KisPaintDeviceTest::testFramesUndoRedoWithChannel()\n     QVERIFY(channel->keyframeAt(12));\n \n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // default m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 2);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n     cmdMove.undo();\n \n     QVERIFY(channel->keyframeAt(10));\n     QVERIFY(!channel->keyframeAt(12));\n \n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // default m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 2);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n     cmdMove.redo();\n \n     QVERIFY(!channel->keyframeAt(10));\n     QVERIFY(channel->keyframeAt(12));\n \n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // default m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 2);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n }\n \n void fillRect(KisPaintDeviceSP dev, int time, const QRect &rc, TestUtil::TestingTimedDefaultBounds *bounds)\n@@ -2145,11 +2154,11 @@ void KisPaintDeviceTest::testCopyPaintDeviceWithFrames()\n \n     // Itinial state: one frame, m_data shared\n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 1);\n-    QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    QVERIFY(o.m_currentData == o.m_frames[0]);\n \n \n     // add a keyframe\n@@ -2161,11 +2170,11 @@ void KisPaintDeviceTest::testCopyPaintDeviceWithFrames()\n     QVERIFY(channel->keyframeAt(10));\n \n     o = i->testingGetDataObjects();\n-    QVERIFY(!o.m_data);\n+    QVERIFY(o.m_data); // m_data should always be present\n     QVERIFY(!o.m_lodData);\n     QVERIFY(!o.m_externalFrameData);\n     QCOMPARE(o.m_frames.size(), 2);\n-    //QVERIFY(o.m_currentData == o.m_frames.begin().value());\n+    //QVERIFY(o.m_currentData == o.m_frames[0]);\n \n     KisPaintDeviceSP newDev = new KisPaintDevice(*dev, true, 0);\n "}]}, {"sha": "db1ca0753fafb0d21341646d646ab3f485e203ca", "stats": {"total": 2, "additions": 0, "deletions": 2}, "files": [{"sha": "7d0686e1bb7383560778e6d6d9e27c183444df9f", "filename": "libs/widgetutils/kis_action_registry.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/db1ca0753fafb0d21341646d646ab3f485e203ca/libs/widgetutils/kis_action_registry.cpp", "raw_url": "https://github.com/KDE/krita/raw/db1ca0753fafb0d21341646d646ab3f485e203ca/libs/widgetutils/kis_action_registry.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/kis_action_registry.cpp?ref=db1ca0753fafb0d21341646d646ab3f485e203ca", "patch": "@@ -71,14 +71,12 @@ namespace {\n         }\n         QString translatedString = i18nc(\"action\", s.toUtf8());\n         if (translatedString == s) {\n-            qDebug() << \"Try again without the context, not all menu actions have context\";\n             translatedString = i18n(s.toUtf8());\n         }\n         if (translatedString.isEmpty()) {\n             dbgAction << \"No translation found for\" << s;\n             return s;\n         }\n-        qDebug() <<  s << \"translates to\" << translatedString;\n \n         return translatedString;\n     };"}]}, {"sha": "3cdc4c044af8dea799d315eee1166135b959d6af", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "6a2c0f6349e81cad6f79718c3f96d7ae0883e732", "filename": "libs/ui/kis_animation_cache_populator.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/3cdc4c044af8dea799d315eee1166135b959d6af/libs/ui/kis_animation_cache_populator.cpp", "raw_url": "https://github.com/KDE/krita/raw/3cdc4c044af8dea799d315eee1166135b959d6af/libs/ui/kis_animation_cache_populator.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kis_animation_cache_populator.cpp?ref=3cdc4c044af8dea799d315eee1166135b959d6af", "patch": "@@ -239,7 +239,7 @@ struct KisAnimationCachePopulator::Private\n                     }\n                 }\n \n-                if (!cache->frameStatus(frame) == KisAnimationFrameCache::Cached) {\n+                if (cache->frameStatus(frame) != KisAnimationFrameCache::Cached) {\n                     return regenerate(cache, frame);\n                 }\n             }"}]}, {"sha": "82e46e4811d7a6821b7453f79f094d0ce7c05cd9", "stats": {"total": 79, "additions": 44, "deletions": 35}, "files": [{"sha": "18efdc8c1746a6513e43ffbcacd5289eb88c6195", "filename": "libs/ui/KisApplication.cpp", "status": "modified", "additions": 34, "deletions": 30, "changes": 64, "blob_url": "https://github.com/KDE/krita/blob/82e46e4811d7a6821b7453f79f094d0ce7c05cd9/libs/ui/KisApplication.cpp", "raw_url": "https://github.com/KDE/krita/raw/82e46e4811d7a6821b7453f79f094d0ce7c05cd9/libs/ui/KisApplication.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisApplication.cpp?ref=82e46e4811d7a6821b7453f79f094d0ce7c05cd9", "patch": "@@ -84,7 +84,6 @@\n #include <kis_resource_server_provider.h>\n #include <KoResourceServerProvider.h>\n #include \"kis_image_barrier_locker.h\"\n-\n #include \"opengl/kis_opengl.h\"\n \n #include <KritaVersionWrapper.h>\n@@ -372,7 +371,6 @@ bool KisApplication::start(const KisApplicationArguments &args)\n     // Load the plugins\n     loadPlugins();\n \n-\n     KisMainWindow *mainWindow = 0;\n \n     if (needsMainWindow) {\n@@ -387,14 +385,8 @@ bool KisApplication::start(const KisApplicationArguments &args)\n     short int numberOfOpenDocuments = 0; // number of documents open\n \n     // Check for autosave files that can be restored, if we're not running a batchrun (test, print, export to pdf)\n-    QList<QUrl> urls = checkAutosaveFiles();\n-    if (!batchRun && mainWindow) {\n-\n-        setSplashScreenLoadingText(i18n(\"Retrieving Auto save files...\"));\n-        Q_FOREACH (const QUrl &url, urls) {\n-            KisDocument *doc = KisPart::instance()->createDocument();\n-            mainWindow->openDocumentInternal(url, doc);\n-        }\n+    if (!batchRun) {\n+        checkAutosaveFiles();\n     }\n \n     setSplashScreenLoadingText(\"\"); // done loading, so clear out label\n@@ -424,7 +416,7 @@ bool KisApplication::start(const KisApplicationArguments &args)\n                 if (createNewDocFromTemplate(fileName, mainWindow)) {\n                     ++numberOfOpenDocuments;\n                 }\n-            // now try to load\n+                // now try to load\n             }\n             else {\n \n@@ -465,15 +457,15 @@ bool KisApplication::start(const KisApplicationArguments &args)\n                             KisPrintJob *job = mainWindow->exportToPdf(exportFileName);\n                             if (job)\n                                 connect (job, SIGNAL(destroyed(QObject*)), mainWindow,\n-                                        SLOT(slotFileQuit()), Qt::QueuedConnection);\n+                                         SLOT(slotFileQuit()), Qt::QueuedConnection);\n                             nPrinted++;\n                         } else {\n                             // Normal case, success\n                             numberOfOpenDocuments++;\n                         }\n                     } else {\n-                    // .... if failed\n-                    // delete doc; done by openDocument\n+                        // .... if failed\n+                        // delete doc; done by openDocument\n                     }\n                 }\n             }\n@@ -563,11 +555,10 @@ void KisApplication::fileOpenRequested(const QString &url)\n }\n \n \n-QList<QUrl> KisApplication::checkAutosaveFiles()\n+void KisApplication::checkAutosaveFiles()\n {\n     // Check for autosave files from a previous run. There can be several, and\n     // we want to offer a restore for every one. Including a nice thumbnail!\n-    QStringList autoSaveFiles;\n \n     QStringList filters;\n     filters << QString(\".krita-*-*-autosave.kra\");\n@@ -587,22 +578,30 @@ QList<QUrl> KisApplication::checkAutosaveFiles()\n             // hide the splashscreen to see the dialog\n             d->splashScreen->hide();\n         }\n-        KisAutoSaveRecoveryDialog *dlg = new KisAutoSaveRecoveryDialog(autoSaveFiles, activeWindow());\n-        if (dlg->exec() == QDialog::Accepted) {\n+        dlg = new KisAutoSaveRecoveryDialog(autoSaveFiles, activeWindow());\n+        connect(dlg, SIGNAL(finished(int)), this, SLOT(onAutoSaveFinished(int)));\n+        dlg->exec();\n+    }\n+}\n \n-            QStringList filesToRecover = dlg->recoverableFiles();\n-            Q_FOREACH (const QString &autosaveFile, autoSaveFiles) {\n-                if (!filesToRecover.contains(autosaveFile)) {\n-                    QFile::remove(dir.absolutePath() + \"/\" + autosaveFile);\n-                }\n+void KisApplication::onAutoSaveFinished(int result) {\n+\n+#ifdef Q_OS_WIN\n+    QDir dir = QDir::temp();\n+#else\n+    QDir dir = QDir::home();\n+#endif\n+\n+    if (result == QDialog::Accepted) {\n+        QStringList filesToRecover = dlg->recoverableFiles();\n+        Q_FOREACH (const QString &autosaveFile, autoSaveFiles) {\n+            if (!filesToRecover.contains(autosaveFile)) {\n+                QFile::remove(dir.absolutePath() + \"/\" + autosaveFile);\n             }\n-            autoSaveFiles = filesToRecover;\n-        }\n-        else {\n-            // don't recover any of the files, but don't delete them either\n-            autoSaveFiles.clear();\n         }\n-        delete dlg;\n+        autoSaveFiles = filesToRecover;\n+    } else {\n+        autoSaveFiles.clear();\n     }\n \n     QList<QUrl> autosaveUrls;\n@@ -614,7 +613,12 @@ QList<QUrl> KisApplication::checkAutosaveFiles()\n         }\n     }\n \n-    return autosaveUrls;\n+    if (mainWindow) {\n+        Q_FOREACH (const QUrl &url, autosaveUrls) {\n+            KisDocument *doc = KisPart::instance()->createDocument();\n+            mainWindow->openDocumentInternal(url, doc);\n+        }\n+    }\n }\n \n bool KisApplication::createNewDocFromTemplate(const QString &fileName, KisMainWindow *mainWindow)"}, {"sha": "3454b2fb59ba89941b6e3e93485d2ebe303bcac4", "filename": "libs/ui/KisApplication.h", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/KDE/krita/blob/82e46e4811d7a6821b7453f79f094d0ce7c05cd9/libs/ui/KisApplication.h", "raw_url": "https://github.com/KDE/krita/raw/82e46e4811d7a6821b7453f79f094d0ce7c05cd9/libs/ui/KisApplication.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisApplication.h?ref=82e46e4811d7a6821b7453f79f094d0ce7c05cd9", "patch": "@@ -22,11 +22,13 @@\n \n #include <qtsingleapplication/qtsingleapplication.h>\n #include \"kritaui_export.h\"\n+#include <KisAutoSaveRecoveryDialog.h>\n \n class KisMainWindow;\n class KisApplicationPrivate;\n class QWidget;\n class KisApplicationArguments;\n+class KisAutoSaveRecoveryDialog;\n \n #include <KisImportExportManager.h>\n \n@@ -98,9 +100,11 @@ public Q_SLOTS:\n     void remoteArguments(QByteArray message, QObject*socket);\n     void fileOpenRequested(const QString & url);\n \n+    void onAutoSaveFinished(int result);\n+\n private:\n     /// @return the number of autosavefiles opened\n-    QList<QUrl> checkAutosaveFiles();\n+    void checkAutosaveFiles();\n     bool createNewDocFromTemplate(const QString &fileName, KisMainWindow *mainWindow);\n     void clearConfig();\n     void loadResources();\n@@ -110,6 +114,9 @@ public Q_SLOTS:\n     KisApplicationPrivate * const d;\n     class ResetStarting;\n     friend class ResetStarting;\n+    KisAutoSaveRecoveryDialog *dlg;\n+    QStringList autoSaveFiles;\n+    KisMainWindow *mainWindow;\n };\n \n #endif"}, {"sha": "6492b0dbc03b2c9f848146932a2608600f30611c", "filename": "libs/ui/KisAutoSaveRecoveryDialog.cpp", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/82e46e4811d7a6821b7453f79f094d0ce7c05cd9/libs/ui/KisAutoSaveRecoveryDialog.cpp", "raw_url": "https://github.com/KDE/krita/raw/82e46e4811d7a6821b7453f79f094d0ce7c05cd9/libs/ui/KisAutoSaveRecoveryDialog.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisAutoSaveRecoveryDialog.cpp?ref=82e46e4811d7a6821b7453f79f094d0ce7c05cd9", "patch": "@@ -61,16 +61,14 @@ class FileItemDelegate : public KWidgetItemDelegate\n     {\n     }\n \n-    QList<QWidget*> createItemWidgets(const QModelIndex& /*index*/) const\n+    QList<QWidget*> createItemWidgets(const QModelIndex& index) const\n     {\n         // a lump of coal and a piece of elastic will get you through the world\n-        QModelIndex idx = property(\"goya:creatingWidgetForIndex\").value<QModelIndex>();\n-\n         QWidget *page = new QWidget;\n         QHBoxLayout *layout = new QHBoxLayout(page);\n \n         QCheckBox *checkBox = new QCheckBox;\n-        checkBox->setProperty(\"fileitem\", idx.data());\n+        checkBox->setProperty(\"fileitem\", index.data());\n \n         connect(checkBox, SIGNAL(toggled(bool)), m_parent, SLOT(toggleFileItem(bool)));\n         QLabel *thumbnail = new QLabel;"}]}, {"sha": "95700dbb0205fddad20a561fe9d9bd2a5697958b", "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "1283f707ae01e06330117c2df5042544fc5f3551", "filename": "libs/widgetutils/KoResourcePaths.cpp", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/95700dbb0205fddad20a561fe9d9bd2a5697958b/libs/widgetutils/KoResourcePaths.cpp", "raw_url": "https://github.com/KDE/krita/raw/95700dbb0205fddad20a561fe9d9bd2a5697958b/libs/widgetutils/KoResourcePaths.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/KoResourcePaths.cpp?ref=95700dbb0205fddad20a561fe9d9bd2a5697958b", "patch": "@@ -86,9 +86,9 @@ QString getInstallationPrefix() {\n      QString bundlePath = QString::fromLatin1(pathPtr);\n \n      debugWidgetUtils << \"1\" << bundlePath << (bundlePath + QString::fromLatin1(\"/Contents/MacOS/share\"));\n-     if (QFile(bundlePath + QString::fromLatin1(\"/Contents/MacOS/share\")).exists()) {\n+     if (QFile(bundlePath + QString::fromLatin1(\"/Contents/share\")).exists()) {\n          debugWidgetUtils << \"running from a deployed bundle\";\n-         bundlePath += QString::fromLatin1(\"/Contents/MacOS/\");\n+         bundlePath += QString::fromLatin1(\"/Contents/\");\n      }\n      else {\n          debugWidgetUtils << \"running from make install\";"}]}, {"sha": "045fc9f9a862e3a3d2779fc7db7e0950c5ef9740", "stats": {"total": 6, "additions": 6, "deletions": 0}, "files": [{"sha": "2bdb5abc5f20ddb7fbc622c95ac6e5e5ab51279d", "filename": "krita/Info.plist.template", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/045fc9f9a862e3a3d2779fc7db7e0950c5ef9740/krita/Info.plist.template", "raw_url": "https://github.com/KDE/krita/raw/045fc9f9a862e3a3d2779fc7db7e0950c5ef9740/krita/Info.plist.template", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/Info.plist.template?ref=045fc9f9a862e3a3d2779fc7db7e0950c5ef9740", "patch": "@@ -2,6 +2,12 @@\n <!DOCTYPE plist PUBLIC \"-//Apple Computer//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n <plist version=\"1.0\">\n   <dict>\n+    <key>NSPrincipalClass</key>\n+    <string>NSApplication</string>\n+    <key>NSHighResolutionCapable</key>\n+    <string>YES</string>\n+    <key>NSHighResolutionMagnifyAllowed</key>\n+    <string>NO</string>\n     <key>CFBundleDevelopmentRegion</key>\n     <string>English</string>\n     <key>CFBundleExecutable</key>"}]}, {"sha": "1ffe9c04ebb38b13eb239453fb89d655904e7bc9", "stats": {"total": 24, "additions": 20, "deletions": 4}, "files": [{"sha": "8abdac415e5ab9b28dd427747f8bbf6a62f47c3f", "filename": "krita/CMakeLists.txt", "status": "modified", "additions": 20, "deletions": 4, "changes": 24, "blob_url": "https://github.com/KDE/krita/blob/1ffe9c04ebb38b13eb239453fb89d655904e7bc9/krita/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/1ffe9c04ebb38b13eb239453fb89d655904e7bc9/krita/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/CMakeLists.txt?ref=1ffe9c04ebb38b13eb239453fb89d655904e7bc9", "patch": "@@ -17,6 +17,21 @@ endif ()\n \n set(krita_SRCS main.cc)\n \n+if (NOT APPLE)\n+    file(GLOB ICON_SRCS \"${CMAKE_CURRENT_SOURCE_DIR}/pics/app/*-apps-calligrakrita.png\")\n+else()\n+    set(ICON_SRCS\n+         \"${CMAKE_CURRENT_SOURCE_DIR}/pics/app/16-apps-calligrakrita.png\"\n+         \"${CMAKE_CURRENT_SOURCE_DIR}/pics/app/32-apps-calligrakrita.png\"\n+         \"${CMAKE_CURRENT_SOURCE_DIR}/pics/app/48-apps-calligrakrita.png\"\n+         \"${CMAKE_CURRENT_SOURCE_DIR}/pics/app/128-apps-calligrakrita.png\"\n+         \"${CMAKE_CURRENT_SOURCE_DIR}/pics/app/256-apps-calligrakrita.png\"\n+         \"${CMAKE_CURRENT_SOURCE_DIR}/pics/app/512-apps-calligrakrita.png\"\n+         \"${CMAKE_CURRENT_SOURCE_DIR}/pics/app/1024-apps-calligrakrita.png\"\n+    )\n+endif() \n+ecm_add_app_icon(krita_SRCS ICONS ${ICON_SRCS})\n+\n if(WIN32 AND USE_BREAKPAD)\n     set(krita_SRCS ${krita_SRCS} kis_crash_handler.cpp)\n     find_library(BREAKPAD_LIBS breakpad)\n@@ -25,10 +40,6 @@ if(WIN32 AND USE_BREAKPAD)\n     endif()\n endif()\n \n-if (NOT APPLE)\n-    file(GLOB ICONS_SRCS \"${CMAKE_CURRENT_SOURCE_DIR}/pics/app/*-apps-calligrakrita.png\")\n-    ecm_add_app_icon(krita_SRCS ICONS ${ICONS_SRCS})\n-endif()\n \n # separate listing, both used by Krita and KritaSketch\n set(krita_QRCS\n@@ -80,6 +91,11 @@ if (APPLE)\n     set_target_properties(krita PROPERTIES MACOSX_BUNDLE_INFO_PLIST ${CMAKE_CURRENT_SOURCE_DIR}/Info.plist.template)\n     set_target_properties(krita PROPERTIES MACOSX_BUNDLE_GUI_IDENTIFIER \"org.krita\")\n     set_target_properties(krita PROPERTIES MACOSX_BUNDLE_BUNDLE_NAME \"Krita\")\n+    set_target_properties(krita PROPERTIES MACOSX_BUNDLE_ICON_FILE \"krita_SRCS.icns\")\n+    set_target_properties(krita PROPERTIES MACOSX_BUNDLE_LONG_VERSION_STRING ${KRITA_VERSION_STRING})\n+    set_target_properties(krita PROPERTIES MACOSX_BUNDLE_SHORT_VERSION_STRING ${KRITA_VERSION_STRING})\n+    set_target_properties(krita PROPERTIES MACOSX_BUNDLE_VERSION ${KRITA_VERSION_STRING})\n+    set_target_properties(krita PROPERTIES MACOSX_BUNDLE_COPYRIGHT \"GNU Public License, V2 or, at your option, any later version.\")\n endif ()\n \n install(TARGETS krita ${INSTALL_TARGETS_DEFAULT_ARGS})"}]}, {"sha": "d09b28b3999deacb290161cf2a68177ddd9f9297", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "732f552185c66349f756b431926e02218c65edc7", "filename": "plugins/impex/exr/exr_converter.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/d09b28b3999deacb290161cf2a68177ddd9f9297/plugins/impex/exr/exr_converter.cc", "raw_url": "https://github.com/KDE/krita/raw/d09b28b3999deacb290161cf2a68177ddd9f9297/plugins/impex/exr/exr_converter.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/exr/exr_converter.cc?ref=d09b28b3999deacb290161cf2a68177ddd9f9297", "patch": "@@ -576,7 +576,7 @@ KisImageBuilder_Result exrConverter::decode(const QString &filename)\n     // fetch Krita's extra layer info, which might have been stored previously\n     QDomDocument extraLayersInfo = m_d->loadExtraLayersInfo(file.header());\n \n-    // Constuct the list of LayerInfo\n+    // Construct the list of LayerInfo\n \n     QList<ExrPaintLayerInfo> informationObjects;\n     QList<ExrGroupLayerInfo> groups;"}]}, {"sha": "43dc8eb0515ec49c6cc12da7abff0b167fdd6fcc", "stats": {"total": 14, "additions": 6, "deletions": 8}, "files": [{"sha": "df6ae40f1cf54035ea4c04fcb4041f87a6fe11e1", "filename": "CMakeLists.txt", "status": "modified", "additions": 6, "deletions": 8, "changes": 14, "blob_url": "https://github.com/KDE/krita/blob/43dc8eb0515ec49c6cc12da7abff0b167fdd6fcc/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/43dc8eb0515ec49c6cc12da7abff0b167fdd6fcc/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=43dc8eb0515ec49c6cc12da7abff0b167fdd6fcc", "patch": "@@ -50,8 +50,11 @@ endif()\n \n if (APPLE)\n     set(APPLE_SUPPRESS_X11_WARNING TRUE)\n-    set(CMAKE_MACOSX_RPATH ON)\n-endif ()\n+    set(KDE_SKIP_RPATH_SETTINGS TRUE)\n+    set(CMAKE_MACOSX_RPATH 1)\n+    set(BUILD_WITH_INSTALL_RPATH 1)\n+    add_definitions(-Wno-deprecated-register)\n+endif()\n \n # QT5TODO: remove KDE4_BUILD_TESTS once all kde4_add_unit_test have been converted\n # transitional forward compatibility:\n@@ -382,11 +385,6 @@ endif()\n add_definitions(-DBOOST_ALL_NO_LIB)\n find_package(Boost REQUIRED COMPONENTS system) # for pigment and stage\n \n-if (APPLE)\n-    SET(CMAKE_CXX_FLAGS \"-stdlib=libstdc++ -std=c++11\")\n-#    find_package(Carbon REQUIRED)\n-endif ()\n-\n ##\n ## Test for GNU Scientific Library\n ##\n@@ -447,7 +445,7 @@ macro_bool_to_01(OCIO_FOUND HAVE_OCIO)\n if(Qt5Gui_OPENGL_IMPLEMENTATION)\n     message(STATUS \"Found QtGui OpenGL support\")\n else()\n-    message(FATAL_ERROR \"Did NOT find QtGui OpenGL support. Check your Qt configuration.\")\n+    message(FATAL_ERROR  \"Did NOT find QtGui OpenGL support. Check your Qt configuration. You cannot build Krita without Qt OpenGL support.\")\n endif()\n \n ##"}]}, {"sha": "5d078c79402355a6c7413b751a26b7475fd4efcb", "stats": {"total": 8, "additions": 0, "deletions": 8}, "files": [{"sha": "0e1b5c72b68783be5bad7a2e2219c5015a5c5a83", "filename": "plugins/dockers/animation/timeline_frames_view.cpp", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/5d078c79402355a6c7413b751a26b7475fd4efcb/plugins/dockers/animation/timeline_frames_view.cpp", "raw_url": "https://github.com/KDE/krita/raw/5d078c79402355a6c7413b751a26b7475fd4efcb/plugins/dockers/animation/timeline_frames_view.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/animation/timeline_frames_view.cpp?ref=5d078c79402355a6c7413b751a26b7475fd4efcb", "patch": "@@ -130,22 +130,14 @@ TimelineFramesView::TimelineFramesView(QWidget *parent)\n \n     m_d->horizontalRuler = new TimelineRulerHeader(this);\n \n-#if QT_VERSION < 0x050000\n-    m_d->horizontalRuler->setResizeMode(QHeaderView::Fixed);\n-#else\n     m_d->horizontalRuler->setSectionResizeMode(QHeaderView::Fixed);\n-#endif\n \n     m_d->horizontalRuler->setDefaultSectionSize(18);\n     this->setHorizontalHeader(m_d->horizontalRuler);\n \n     m_d->layersHeader = new TimelineLayersHeader(this);\n \n-#if QT_VERSION < 0x050000\n-    m_d->layersHeader->setResizeMode(QHeaderView::Fixed);\n-#else\n     m_d->layersHeader->setSectionResizeMode(QHeaderView::Fixed);\n-#endif\n \n     m_d->layersHeader->setDefaultSectionSize(24);\n     m_d->layersHeader->setMinimumWidth(60);"}]}, {"sha": "da2c5153a6cfeb1a6e28fc08813bad5ca7f50541", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "3c036929b2c3b7313e4ba0e8bb13f87b87dbf93a", "filename": "linux/Recipe", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/da2c5153a6cfeb1a6e28fc08813bad5ca7f50541/linux/Recipe", "raw_url": "https://github.com/KDE/krita/raw/da2c5153a6cfeb1a6e28fc08813bad5ca7f50541/linux/Recipe", "contents_url": "https://api.github.com/repos/KDE/krita/contents/linux/Recipe?ref=da2c5153a6cfeb1a6e28fc08813bad5ca7f50541", "patch": "@@ -50,7 +50,7 @@ yum -y install epel-release\n # we need to be up to date in order to install the xcb-keysyms dependency\n yum -y update\n # base dependencies and Qt5.\n-yum -y install wget tar bzip2 git libtool which fuse fuse-devel libpng-devel automake libtool mesa-libEGL cppunit-devel cmake glibc-headers libstdc++-devel gcc-c++ freetype-devel fontconfig-devel libxml2-devel libstdc++-devel libXrender-devel patch xcb-util-keysyms-devel libXi-devel\n+yum -y install wget tar bzip2 git libtool which fuse fuse-devel libpng-devel automake libtool mesa-libEGL cppunit-devel cmake glibc-headers libstdc++-devel gcc-c++ freetype-devel fontconfig-devel libxml2-devel libstdc++-devel libXrender-devel patch xcb-util-keysyms-devel libXi-devel mesa-libGL-devel libxcb libxcb-devel xcb-util xcb-util-devel\n \n # Newer compiler than what comes with CentOS 6\n wget http://people.centos.org/tru/devtools-2/devtools-2.repo -O /etc/yum.repos.d/devtools-2.repo"}]}, {"sha": "f72209fb32171db677b20de12d8d279b0b82198d", "stats": {"total": 14, "additions": 11, "deletions": 3}, "files": [{"sha": "8f347d50e74d97458cc61df2c21432178278e9fd", "filename": "libs/global/kis_debug.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/f72209fb32171db677b20de12d8d279b0b82198d/libs/global/kis_debug.cpp", "raw_url": "https://github.com/KDE/krita/raw/f72209fb32171db677b20de12d8d279b0b82198d/libs/global/kis_debug.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/global/kis_debug.cpp?ref=f72209fb32171db677b20de12d8d279b0b82198d", "patch": "@@ -100,7 +100,7 @@ Q_LOGGING_CATEGORY(_41011, \"krita.scripting\")\n Q_LOGGING_CATEGORY(_41012, \"krita.input\")\n Q_LOGGING_CATEGORY(_41013, \"krita.action\")\n Q_LOGGING_CATEGORY(_41014, \"krita.tabletlog\")\n-\n+Q_LOGGING_CATEGORY(_41015, \"krita.opengl\")\n \n \n QString __methodName(const char *_prettyFunction)"}, {"sha": "06a6be1c1211e58ae446e5535062586c0590e01b", "filename": "libs/global/kis_debug.h", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/KDE/krita/blob/f72209fb32171db677b20de12d8d279b0b82198d/libs/global/kis_debug.h", "raw_url": "https://github.com/KDE/krita/raw/f72209fb32171db677b20de12d8d279b0b82198d/libs/global/kis_debug.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/global/kis_debug.h?ref=f72209fb32171db677b20de12d8d279b0b82198d", "patch": "@@ -39,6 +39,7 @@ extern const KRITAGLOBAL_EXPORT QLoggingCategory &_41011();\n extern const KRITAGLOBAL_EXPORT QLoggingCategory &_41012();\n extern const KRITAGLOBAL_EXPORT QLoggingCategory &_41013();\n extern const KRITAGLOBAL_EXPORT QLoggingCategory &_41014();\n+extern const KRITAGLOBAL_EXPORT QLoggingCategory &_41015();\n \n #define dbgResources qCDebug(_30009)\n #define dbgKrita qCDebug(_41000)\n@@ -56,9 +57,10 @@ extern const KRITAGLOBAL_EXPORT QLoggingCategory &_41014();\n #define dbgInput qCDebug(_41012)\n #define dbgAction qCDebug(_41013)\n #define dbgTablet qCDebug(_41014)\n+#define dbgOpenGL qCDebug(_41015)\n \n // Defined in Qt 5.6\n-/*\n+#if QT_VERSION >= 0x050600\n #define infoResources qCInfo(_30009)\n #define infoKrita qCInfo(_41000)\n #define infoImage qCInfo(_41001)\n@@ -74,7 +76,9 @@ extern const KRITAGLOBAL_EXPORT QLoggingCategory &_41014();\n #define infoScript qCInfo(_41011)\n #define infoInput qCInfo(_41012)\n #define infoAction qCDebug(_41013)\n-*/\n+#define infoTablet qCDebug(_41014)\n+#define infoOpenGL qCDebug(_41015)\n+#endif\n \n #define warnResources qCWarning(_30009)\n #define warnKrita qCWarning(_41000)\n@@ -91,6 +95,8 @@ extern const KRITAGLOBAL_EXPORT QLoggingCategory &_41014();\n #define warnScript qCWarning(_41011)\n #define warnInput qCWarning(_41012)\n #define warnAction qCDebug(_41013)\n+#define warnTablet qCDebug(_41014)\n+#define warnOpenGL qCDebug(_41015)\n \n #define errResources qCCritical(_30009)\n #define errKrita qCCritical(_41000)\n@@ -107,6 +113,8 @@ extern const KRITAGLOBAL_EXPORT QLoggingCategory &_41014();\n #define errScript qCCritical(_41011)\n #define errInput qCCritical(_41012)\n #define errAction qCDebug(_41013)\n+#define errTablet qCDebug(_41014)\n+#define errOpenGL qCDebug(_41015)\n \n // Qt does not yet define qCFatal (TODO: this is an oversight, submit a patch upstream)\n /*"}]}, {"sha": "96f6dab73359f1444289f8c04ad6e844dbfaedd4", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "9327a5db4f8176125f807b8dffa7303d3b7211b2", "filename": "3rdparty/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/96f6dab73359f1444289f8c04ad6e844dbfaedd4/3rdparty/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/96f6dab73359f1444289f8c04ad6e844dbfaedd4/3rdparty/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/3rdparty/CMakeLists.txt?ref=96f6dab73359f1444289f8c04ad6e844dbfaedd4", "patch": "@@ -66,7 +66,7 @@ if (MSYS)\n endif() \n \n if (APPLE)\n-    set(GLOBAL_PROFILE ${GLOBAL_PROFILE} -DCMAKE_MACOSX_RPATH=ON)\n+    set(GLOBAL_PROFILE ${GLOBAL_PROFILE} -DCMAKE_MACOSX_RPATH=ON -DKDE_SKIP_RPATH_SETTINGS=ON -DBUILD_WITH_INSTALL_RPATH=ON -DAPPLE_SUPPRESS_X11_WARNING=ON)\n     set(PATCH_COMMAND patch)\n endif ()\n "}]}, {"sha": "61cb3ac37463f1b5fa5cdeadf9102ac151ad747a", "stats": {"total": 112, "additions": 108, "deletions": 4}, "files": [{"sha": "538cf08cb5c96da34abfda76a542ec4d2b3d148e", "filename": "osx/build-deps.sh", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/KDE/krita/blob/61cb3ac37463f1b5fa5cdeadf9102ac151ad747a/osx/build-deps.sh", "raw_url": "https://github.com/KDE/krita/raw/61cb3ac37463f1b5fa5cdeadf9102ac151ad747a/osx/build-deps.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/osx/build-deps.sh?ref=61cb3ac37463f1b5fa5cdeadf9102ac151ad747a", "patch": "@@ -0,0 +1,19 @@\n+cmake --build . --config RelWithDebInfo --target ext_boost\n+cmake --build . --config RelWithDebInfo --target ext_eigen3\n+cmake --build . --config RelWithDebInfo --target ext_exiv2\n+cmake --build . --config RelWithDebInfo --target ext_fftw3\n+cmake --build . --config RelWithDebInfo --target ext_ilmbase\n+cmake --build . --config RelWithDebInfo --target ext_jpeg\n+cmake --build . --config RelWithDebInfo --target ext_lcms2\n+cmake --build . --config RelWithDebInfo --target ext_ocio\n+cmake --build . --config RelWithDebInfo --target ext_openexr\n+install_name_tool -add_rpath /Users/boud/dev/i/lib /Users/boud/dev/b/ext_openexr/ext_openexr-prefix/src/ext_openexr-build/IlmImf/./b44ExpLogTable\n+install_name_tool -add_rpath /Users/boud/dev/i/lib /Users/boud/dev/b/ext_openexr/ext_openexr-prefix/src/ext_openexr-build/IlmImf/./dwaLookups\n+cmake --build . --config RelWithDebInfo --target ext_openexr\n+cmake --build . --config RelWithDebInfo --target ext_png\n+cmake --build . --config RelWithDebInfo --target ext_tiff\n+cmake --build . --config RelWithDebInfo --target ext_vc\n+cmake --build . --config RelWithDebInfo --target ext_libraw\n+cmake --build . --config RelWithDebInfo --target ext_openjpeg\n+cmake --build . --config RelWithDebInfo --target ext_kwindowsystem\n+cmake --build . --config RelWithDebInfo --target ext_gsl"}, {"sha": "64ed27fbbc02a33d7eb70d408e916effeba959d0", "filename": "osx/configure.sh", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/KDE/krita/blob/61cb3ac37463f1b5fa5cdeadf9102ac151ad747a/osx/configure.sh", "raw_url": "https://github.com/KDE/krita/raw/61cb3ac37463f1b5fa5cdeadf9102ac151ad747a/osx/configure.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/osx/configure.sh?ref=61cb3ac37463f1b5fa5cdeadf9102ac151ad747a", "patch": "@@ -0,0 +1,34 @@\n+#export MACOSX_DEPLOYMENT_TARGET=10.9\n+#export SDKROOT=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk\n+\n+./configure  \\\n+    -skip qt3d \\\n+    -skip qtactiveqt \\\n+    -skip qtcanvas3d \\\n+    -skip qtconnectivity \\\n+    -skip qtdeclarative \\\n+    -skip qtdoc \\\n+    -skip qtenginio \\\n+    -skip qtgraphicaleffects \\\n+    -skip qtlocation \\\n+    -skip qtmultimedia \\\n+    -skip qtsensors \\\n+    -skip qtserialport \\\n+    -skip qtwayland \\\n+    -skip qtwebchannel \\\n+    -skip qtwebengine \\\n+    -skip qtwebsockets \\\n+    -skip qtxmlpatterns \\\n+    -opensource -confirm-license -release \\\n+    -no-qml-debug -no-mtdev -no-journald \\\n+    -no-openssl -no-libproxy \\\n+    -no-pulseaudio -no-alsa -no-nis \\\n+    -no-cups -no-tslib -no-pch \\\n+    -no-dbus  -no-gstreamer -no-system-proxies \\\n+    -no-openssl -no-libproxy -no-pulseaudio \\\n+    -nomake examples \\\n+    -prefix /Users/boud/dev/i\n+\n+#    -sdk macosx10.9 \\\n+#    -platform macx-clang-64 \\\n+"}, {"sha": "789d0202e7f337bc7bc4a7e4d2f381130b10893b", "filename": "osx/deploy5.sh", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/KDE/krita/blob/61cb3ac37463f1b5fa5cdeadf9102ac151ad747a/osx/deploy5.sh", "raw_url": "https://github.com/KDE/krita/raw/61cb3ac37463f1b5fa5cdeadf9102ac151ad747a/osx/deploy5.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/osx/deploy5.sh?ref=61cb3ac37463f1b5fa5cdeadf9102ac151ad747a", "patch": "@@ -0,0 +1,22 @@\n+set -e # stop on errors\n+set -x # be verbise \n+\n+rm -rf ~/dev/krita.app/\n+rm -rf ~/dev/krita.dmg\n+cp -r ~/dev/i/bin/krita.app ~/dev\n+cp -r ~/dev/i/share ~/dev/krita.app/Contents/\n+\n+mkdir -p ~/dev/krita.app/Contents/PlugIns/kritaplugins\n+\n+install_name_tool -add_rpath /Users/boud/dev/i/lib ~/dev/krita.app/Contents/MacOS/krita\n+\n+~/dev/i/bin/macdeployqt ~/dev/krita.app \\\n+    -verbose=1 \\\n+    -executable=/Users/boud/dev/krita.app/Contents/MacOS/krita \\\n+    -extra-plugins=/Users/boud/dev/i/lib/kritaplugins/ \\\n+    -extra-plugins=/Users/boud/dev/i/lib/plugins/ \\\n+    -extra-plugins=/Users/boud/dev/i/plugins/ \\\n+    -dmg\n+\n+#install_name_tool -delete_rpath  @loader_path/../../../../lib ~/dev/krita.app/Contents/MacOS/krita\n+"}, {"sha": "c3b1743da69e1e5005f32b660bdfa490f9c1a51c", "filename": "osx/fixrpath.sh", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/61cb3ac37463f1b5fa5cdeadf9102ac151ad747a/osx/fixrpath.sh", "raw_url": "https://github.com/KDE/krita/raw/61cb3ac37463f1b5fa5cdeadf9102ac151ad747a/osx/fixrpath.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/osx/fixrpath.sh?ref=61cb3ac37463f1b5fa5cdeadf9102ac151ad747a", "patch": "@@ -0,0 +1,8 @@\n+install_name_tool -change libboost_system.dylib @rpath/libboost_system.dylib /Users/boud/dev/i/bin/krita.app/Contents/MacOS/krita\n+\n+\n+FILES=\"$(find /Users/boud/dev/i/lib/ -name '*so' -o -name '*dylib')\"\n+for FILE in $FILES ; do\n+    echo $FILE\n+    install_name_tool -change libboost_system.dylib @rpath/libboost_system.dylib $FILE\n+done"}, {"sha": "92794936a61a39abef1d9ef20d41bbc94f4a9565", "filename": "osx/macdeploy-qt.diff", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/61cb3ac37463f1b5fa5cdeadf9102ac151ad747a/osx/macdeploy-qt.diff", "raw_url": "https://github.com/KDE/krita/raw/61cb3ac37463f1b5fa5cdeadf9102ac151ad747a/osx/macdeploy-qt.diff", "contents_url": "https://api.github.com/repos/KDE/krita/contents/osx/macdeploy-qt.diff?ref=61cb3ac37463f1b5fa5cdeadf9102ac151ad747a", "patch": "@@ -78,7 +78,7 @@ index d20b219..4a9aa1f 100644\n +        // deploy all found plugins\n +        foreach (const QString &plugin, pluginList) {\n +            QString sourcePath = extraPluginDir + \"/\" + plugin;\n-+            const QString destinationPath = pluginDestinationPath + \"/\" + plugin;\n++            const QString destinationPath = pluginDestinationPath + \"/\" + extraPluginDir.split(\"/\", QString::SkipEmptyParts).last() + \"/\" + plugin;\n +            QDir dir;\n +            dir.mkpath(QFileInfo(destinationPath).path());\n +"}, {"sha": "94e812b815becee0a1c557c44c7e25fb52686822", "filename": "osx/notes.txt", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/61cb3ac37463f1b5fa5cdeadf9102ac151ad747a/osx/notes.txt", "raw_url": "https://github.com/KDE/krita/raw/61cb3ac37463f1b5fa5cdeadf9102ac151ad747a/osx/notes.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/osx/notes.txt?ref=61cb3ac37463f1b5fa5cdeadf9102ac151ad747a", "patch": "@@ -37,9 +37,14 @@ cp -r ~/dev/i/bin/krita.app ~\n cp -r ~/dev/i/share ~/krita.app/Contents/\n macdeployqt ~/krita.app \\\n     -verbose=1 \\\n-    -extra-plugins=$HOME/dev/i/lib/krita/ \\\n+    -extra-plugins=$HOME/dev/i/lib/kritaplugins/ \\\n+    -extra-plugins=$HOME/dev/i/lib/kf5/ \\\n     -extra-plugins=$HOME/dev/i/lib/plugins/ \\\n     -extra-plugins=$HOME/dev/i/plugins/ \\\n     -dmg\n-mkdir ~/krita.app/Contents/PlugIns/krita\n-mv ~/krita.app/Contents/PlugIns/*so ~/krita.app/Contents/PlugIns/krita\n+mkdir ~/krita.app/Contents/PlugIns/kritaplugins\n+mv ~/krita.app/Contents/PlugIns/*so ~/krita.app/Contents/PlugIns/kritaplugins\n+\n+To make open_exr build, manual step after it fails because dwalookups cannot find Half:\n+install_name_tool -add_rpath /Users/boud/dev/i/lib /Users/boud/dev/b/ext_openexr/ext_openexr-prefix/src/ext_openexr-build/IlmImf/./b44ExpLogTable \n+install_name_tool -add_rpath /Users/boud/dev/i/lib /Users/boud/dev/b/ext_openexr/ext_openexr-prefix/src/ext_openexr-build/IlmImf/./dwaLookups"}, {"sha": "fd3aeefc80e356c17ca057c3e2d37194c805be5d", "filename": "osx/run-cmake-3rdparty.sh", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/61cb3ac37463f1b5fa5cdeadf9102ac151ad747a/osx/run-cmake-3rdparty.sh", "raw_url": "https://github.com/KDE/krita/raw/61cb3ac37463f1b5fa5cdeadf9102ac151ad747a/osx/run-cmake-3rdparty.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/osx/run-cmake-3rdparty.sh?ref=61cb3ac37463f1b5fa5cdeadf9102ac151ad747a", "patch": "@@ -0,0 +1,8 @@\n+#export MACOSX_DEPLOYMENT_TARGET=10.7\n+#export SDKROOT=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.7.sdk\n+cmake ../krita/3rdparty/  \\\n+    -DCMAKE_INSTALL_PREFIX=/Users/boud/dev/i \\\n+    -DEXTERNALS_DOWNLOAD_DIR=/Users/boud/dev/d  \\\n+    -DINSTALL_ROOT=/Users/boud/dev/i \n+ #   -DCMAKE_OSX_DEPLOYMENT_TARGET=10.7 \\\n+ #   -CMAKE_OSX_SYSROOT=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.7.sdk"}, {"sha": "fcf22f4c0f8c78e9fa98cb9f31ad5cbc25252ea8", "filename": "osx/run-cmake-krita.sh", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/61cb3ac37463f1b5fa5cdeadf9102ac151ad747a/osx/run-cmake-krita.sh", "raw_url": "https://github.com/KDE/krita/raw/61cb3ac37463f1b5fa5cdeadf9102ac151ad747a/osx/run-cmake-krita.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/osx/run-cmake-krita.sh?ref=61cb3ac37463f1b5fa5cdeadf9102ac151ad747a", "patch": "@@ -0,0 +1,8 @@\n+#export MACOSX_DEPLOYMENT_TARGET=10.7\n+#export SDKROOT=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.7.sdk\n+cmake ../krita \\\n+    -DCMAKE_INSTALL_PREFIX=/Users/boud/dev/i \\\n+    -DDEFINE_NO_DEPRECATED=1 -DBUILD_TESTING=OFF \\\n+    -DKDE4_BUILD_TESTS=OFF \\\n+    -DPACKAGERS_BUILD=ON  \\\n+    -DBUNDLE_INSTALL_DIR=$HOME/dev/i/bin "}]}, {"sha": "80f62b2da07e83c1488e15a9d8ce6e7788d9670f", "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "aaecd848c29e29861556e0a042353b5813be8af3", "filename": "plugins/filters/colorsfilters/kis_perchannel_filter.cpp", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/KDE/krita/blob/80f62b2da07e83c1488e15a9d8ce6e7788d9670f/plugins/filters/colorsfilters/kis_perchannel_filter.cpp", "raw_url": "https://github.com/KDE/krita/raw/80f62b2da07e83c1488e15a9d8ce6e7788d9670f/plugins/filters/colorsfilters/kis_perchannel_filter.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/colorsfilters/kis_perchannel_filter.cpp?ref=80f62b2da07e83c1488e15a9d8ce6e7788d9670f", "patch": "@@ -177,7 +177,9 @@ inline QPixmap KisPerChannelConfigWidget::getHistogram()\n     pix.fill(QColor(appPalette.color(QPalette::Base)));\n \n     QPainter p(&pix);\n-    p.setPen(QPen(Qt::gray, 1, Qt::SolidLine));\n+    p.setPen(QColor(appPalette.color(QPalette::Text)));\n+    p.save();\n+    p.setOpacity(0.2);\n \n     const VirtualChannelInfo &info = m_virtualChannels[m_activeVChannel];\n \n@@ -200,6 +202,9 @@ inline QPixmap KisPerChannelConfigWidget::getHistogram()\n             }\n         }\n     }\n+\n+    p.restore();\n+\n     return pix;\n }\n "}]}, {"sha": "83b454224b67c14019d162ecf3a188f069f022e0", "stats": {"total": 5, "additions": 5, "deletions": 0}, "files": [{"sha": "e38b43767bb1cde9c2895a809b27856b0666fa61", "filename": "libs/ui/KisMainWindow.cpp", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/83b454224b67c14019d162ecf3a188f069f022e0/libs/ui/KisMainWindow.cpp", "raw_url": "https://github.com/KDE/krita/raw/83b454224b67c14019d162ecf3a188f069f022e0/libs/ui/KisMainWindow.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisMainWindow.cpp?ref=83b454224b67c14019d162ecf3a188f069f022e0", "patch": "@@ -1194,6 +1194,11 @@ void KisMainWindow::saveWindowSettings()\n                 dockGroup.writeEntry(\"Collapsed\", i.value()->widget()->isHidden());\n                 dockGroup.writeEntry(\"Locked\", i.value()->property(\"Locked\").toBool());\n                 dockGroup.writeEntry(\"DockArea\", (int) dockWidgetArea(i.value()));\n+                dockGroup.writeEntry(\"xPosition\", (int) i.value()->widget()->x());\n+                dockGroup.writeEntry(\"yPosition\", (int) i.value()->widget()->y());\n+\n+                dockGroup.writeEntry(\"width\", (int) i.value()->widget()->width());\n+                dockGroup.writeEntry(\"height\", (int) i.value()->widget()->height());\n             }\n         }\n "}]}, {"sha": "69d31bda88ae1fb255c6d755c5a6d23bcec5d52f", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "3bc1a3c7db58a8079e9ab7944e660b22b2d16a95", "filename": "libs/ui/actions/kis_selection_action_factories.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/69d31bda88ae1fb255c6d755c5a6d23bcec5d52f/libs/ui/actions/kis_selection_action_factories.cpp", "raw_url": "https://github.com/KDE/krita/raw/69d31bda88ae1fb255c6d755c5a6d23bcec5d52f/libs/ui/actions/kis_selection_action_factories.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/actions/kis_selection_action_factories.cpp?ref=69d31bda88ae1fb255c6d755c5a6d23bcec5d52f", "patch": "@@ -416,7 +416,7 @@ void KisPasteNewActionFactory::run(KisViewManager *viewManager)\n                                     clip->colorSpace(),\n                                     i18n(\"Pasted\"));\n     KisPaintLayerSP layer =\n-        new KisPaintLayer(image.data(), clip->objectName(),\n+        new KisPaintLayer(image.data(), image->nextLayerName() + i18n(\"(pasted)\"),\n                           OPACITY_OPAQUE_U8, clip->colorSpace());\n \n     KisPainter::copyAreaOptimized(QPoint(), clip, layer->paintDevice(), rect);"}]}, {"sha": "54c2b972d3ddecf31de2337faea74b70cf436468", "stats": {"total": 11, "additions": 8, "deletions": 3}, "files": [{"sha": "d3b4859fea9f54c65c48ce728c22fada7264cc3f", "filename": "libs/ui/thememanager.cpp", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/54c2b972d3ddecf31de2337faea74b70cf436468/libs/ui/thememanager.cpp", "raw_url": "https://github.com/KDE/krita/raw/54c2b972d3ddecf31de2337faea74b70cf436468/libs/ui/thememanager.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/thememanager.cpp?ref=54c2b972d3ddecf31de2337faea74b70cf436468", "patch": "@@ -162,9 +162,12 @@ void ThemeManager::slotChangePalette()\n \n     QString theme(currentThemeName());\n \n+    // Windows doesn't do well with KDE theming\n+    #if defined (Q_OS_LINUX) || defined (__APPLE__)\n     if (theme == defaultThemeName() || theme.isEmpty()) {\n         theme = currentKDEdefaultTheme();\n     }\n+    #endif\n \n     QString filename        = d->themeMap.value(theme);\n     KSharedConfigPtr config = KSharedConfig::openConfig(filename);\n@@ -246,10 +249,8 @@ void ThemeManager::populateThemeMenu()\n     connect(d->themeMenuActionGroup, SIGNAL(triggered(QAction*)),\n             this, SLOT(slotChangePalette()));\n \n-    QAction * action = new QAction(defaultThemeName(), d->themeMenuActionGroup);\n-    action->setCheckable(true);\n-    d->themeMenuAction->addAction(action);\n \n+    QAction * action;\n     const QStringList schemeFiles = KoResourcePaths::findAllResources(\"data\", \"color-schemes/*.colors\", KoResourcePaths::NoDuplicates);\n \n     QMap<QString, QAction*> actionMap;\n@@ -273,6 +274,10 @@ void ThemeManager::populateThemeMenu()\n \n     Q_FOREACH (const QString& name, actionMapKeys)\n     {\n+        if ( name ==  currentThemeName()) {\n+            actionMap.value(name)->setChecked(true);\n+        }\n+\n         d->themeMenuAction->addAction(actionMap.value(name));\n     }\n "}]}, {"sha": "e664941e60124c7169315e59d7bc2d3f35a12acc", "stats": {"total": 6, "additions": 3, "deletions": 3}, "files": [{"sha": "e99db28da17309b2f9067b4ef60993c9298e0d4c", "filename": "libs/widgets/KoConfigAuthorPage.cpp", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/e664941e60124c7169315e59d7bc2d3f35a12acc/libs/widgets/KoConfigAuthorPage.cpp", "raw_url": "https://github.com/KDE/krita/raw/e664941e60124c7169315e59d7bc2d3f35a12acc/libs/widgets/KoConfigAuthorPage.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgets/KoConfigAuthorPage.cpp?ref=e664941e60124c7169315e59d7bc2d3f35a12acc", "patch": "@@ -60,11 +60,11 @@ KoConfigAuthorPage::KoConfigAuthorPage()\n     d->combo = new QComboBox;\n     layout->addWidget(d->combo, 0, 0);\n     QToolButton *newUser = new QToolButton;\n-    newUser->setIcon(koIcon(\"list-add-user\"));\n+    newUser->setIcon(koIcon(\"list-add\"));\n     newUser->setToolTip(i18n(\"Add new author profile (starts out as a copy of current)\"));\n     layout->addWidget(newUser, 0, 1);\n     d->deleteUser = new QToolButton;\n-    d->deleteUser->setIcon(koIcon(\"list-remove-user\"));\n+    d->deleteUser->setIcon(koIcon(\"trash-empty\"));\n     d->deleteUser->setToolTip(i18n(\"Delete the author profile\"));\n     layout->addWidget(d->deleteUser, 0, 2);\n     QFrame *f = new QFrame;"}, {"sha": "7112dd27327e9343af9c6a4136dde78f15ea9bb0", "filename": "plugins/flake/textshape/dialogs/StylesDelegate.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/e664941e60124c7169315e59d7bc2d3f35a12acc/plugins/flake/textshape/dialogs/StylesDelegate.cpp", "raw_url": "https://github.com/KDE/krita/raw/e664941e60124c7169315e59d7bc2d3f35a12acc/plugins/flake/textshape/dialogs/StylesDelegate.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/flake/textshape/dialogs/StylesDelegate.cpp?ref=e664941e60124c7169315e59d7bc2d3f35a12acc", "patch": "@@ -99,7 +99,7 @@ void StylesDelegate::paint(QPainter *painter, const QStyleOptionViewItem &option\n         if (!m_editButtonPressed) {\n             optEdit.state |= QStyle::State_Enabled;\n         }\n-        optEdit.icon = koIcon(\"document-properties\");\n+        optEdit.icon = koIcon(\"configure\");\n         optEdit.features |= QStyleOptionButton::Flat;\n         optEdit.rect = option.rect.adjusted(dx1 - scrollBarWidth, dy1, dx2 - scrollBarWidth, dy2);\n         view->style()->drawControl(QStyle::CE_PushButton, &optEdit, painter, 0);"}]}, {"sha": "25ecbafce8365e44ebc550d23e62e61aa01efe1b", "stats": {"total": 6, "additions": 6, "deletions": 0}, "files": [{"sha": "855dbf97c4700f1df5f4f94481beca4bebd8cba5", "filename": "libs/widgetutils/kis_action_registry.cpp", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/25ecbafce8365e44ebc550d23e62e61aa01efe1b/libs/widgetutils/kis_action_registry.cpp", "raw_url": "https://github.com/KDE/krita/raw/25ecbafce8365e44ebc550d23e62e61aa01efe1b/libs/widgetutils/kis_action_registry.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/kis_action_registry.cpp?ref=25ecbafce8365e44ebc550d23e62e61aa01efe1b", "patch": "@@ -70,10 +70,16 @@ namespace {\n             return s;\n         }\n         QString translatedString = i18nc(\"action\", s.toUtf8());\n+        if (translatedString == s) {\n+            qDebug() << \"Try again without the context, not all menu actions have context\";\n+            translatedString = i18n(s.toUtf8());\n+        }\n         if (translatedString.isEmpty()) {\n             dbgAction << \"No translation found for\" << s;\n             return s;\n         }\n+        qDebug() <<  s << \"translates to\" << translatedString;\n+\n         return translatedString;\n     };\n "}]}, {"sha": "8c15c05cf217ef0bb9be8ea522fdb33fe0c89d30", "stats": {"total": 10, "additions": 4, "deletions": 6}, "files": [{"sha": "ebb6eb772e3c20ec4e8b0eca5a359594211df133", "filename": "windows/makepkg-32.sh", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/8c15c05cf217ef0bb9be8ea522fdb33fe0c89d30/windows/makepkg-32.sh", "raw_url": "https://github.com/KDE/krita/raw/8c15c05cf217ef0bb9be8ea522fdb33fe0c89d30/windows/makepkg-32.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/makepkg-32.sh?ref=8c15c05cf217ef0bb9be8ea522fdb33fe0c89d30", "patch": "@@ -1,7 +1,7 @@\n #!/bin/bash\n \n # Halt on errors\n-#set -e\n+set -e\n \n # Be verbose\n set -x\n@@ -12,7 +12,7 @@ APP=krita\n \n cd $BUILDROOT\n \n-VER=$(grep \"#define KRITA_VERSION_STRING\" /build/libs/version/kritaversion.h | cut -d '\"' -f 2)\n+VER=$(grep \"#define KRITA_VERSION_STRING\" $BUILDROOT/build/libs/version/kritaversion.h | cut -d '\"' -f 2)\n cd $BUILDROOT/krita\n BRANCH=$( git branch | cut -d ' ' -f 2)\n REVISION=$(git rev-parse --short HEAD)\n@@ -23,7 +23,6 @@ echo $VERSION\n \n PACKAGENAME=$APP\"-\"$VERSION\"-x86\"\n \n-#rm -rf $BUILDROOT/out/* || true\n mkdir -p $BUILDROOT/out/$PACKAGENAME\n mkdir -p $BUILDROOT/out/$PACKAGENAME/bin\n mkdir -p $BUILDROOT/out/$PACKAGENAME/lib"}, {"sha": "b28302ca7d6442d2ce710f50738fb86fe3e89a0e", "filename": "windows/makepkg-64.sh", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/8c15c05cf217ef0bb9be8ea522fdb33fe0c89d30/windows/makepkg-64.sh", "raw_url": "https://github.com/KDE/krita/raw/8c15c05cf217ef0bb9be8ea522fdb33fe0c89d30/windows/makepkg-64.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/makepkg-64.sh?ref=8c15c05cf217ef0bb9be8ea522fdb33fe0c89d30", "patch": "@@ -1,7 +1,7 @@\n #!/bin/bash\n \n # Halt on errors\n-#set -e\n+set -e\n \n # Be verbose\n set -x\n@@ -12,7 +12,7 @@ APP=krita\n \n cd $BUILDROOT\n \n-VER=$(grep \"#define KRITA_VERSION_STRING\" /build/libs/version/kritaversion.h | cut -d '\"' -f 2)\n+VER=$(grep \"#define KRITA_VERSION_STRING\" $BUILDROOT/build/libs/version/kritaversion.h | cut -d '\"' -f 2)\n cd $BUILDROOT/krita\n BRANCH=$( git branch | cut -d ' ' -f 2)\n REVISION=$(git rev-parse --short HEAD)\n@@ -23,7 +23,6 @@ echo $VERSION\n \n PACKAGENAME=$APP\"-\"$VERSION\"-x64\"\n \n-#rm -rf $BUILDROOT/out/* || true\n mkdir -p $BUILDROOT/out/$PACKAGENAME\n mkdir -p $BUILDROOT/out/$PACKAGENAME/bin\n mkdir -p $BUILDROOT/out/$PACKAGENAME/lib"}]}, {"sha": "b0b613dbf145f48bb1525ced6b25babf36e51c1f", "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "343a97d06f079faf8e700ecb38aa1c601757b9df", "filename": "libs/ui/KisNodeDelegate.cpp", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/KDE/krita/blob/b0b613dbf145f48bb1525ced6b25babf36e51c1f/libs/ui/KisNodeDelegate.cpp", "raw_url": "https://github.com/KDE/krita/raw/b0b613dbf145f48bb1525ced6b25babf36e51c1f/libs/ui/KisNodeDelegate.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisNodeDelegate.cpp?ref=b0b613dbf145f48bb1525ced6b25babf36e51c1f", "patch": "@@ -158,8 +158,8 @@ void KisNodeDelegate::drawBranch(QPainter *p, const QStyleOptionViewItem &option\n \n \n      // draw parent lines (keep drawing until x position is less than 0\n-     QPoint p5 = base - QPoint(scm.iconSize()*1.8, -scm.iconSize()*0.45);\n-     QPoint p6 = base - QPoint(scm.iconSize()*1.8, -scm.iconSize());\n+    QPoint p5 = p2 - QPoint(scm.indentation(), 0);\n+    QPoint p6 = p3 - QPoint(scm.indentation(), 0);\n \n      QPoint parentBase1 = p5;\n      QPoint parentBase2 = p6;\n@@ -168,11 +168,11 @@ void KisNodeDelegate::drawBranch(QPainter *p, const QStyleOptionViewItem &option\n      color = KritaUtils::blendColors(color, bgColor, 0.9); // makes it a little lighter than L lines\n      p->setPen(QPen(color, 0, Qt::SolidLine, Qt::RoundCap, Qt::RoundJoin));\n \n-     while (parentBase1.x() > 10) {\n+     while (parentBase1.x() > scm.visibilityColumnWidth()) {\n          p->drawLine(parentBase1, parentBase2);\n \n-         parentBase1 = parentBase1 - QPoint(scm.iconSize()*2.7 - scm.decorationMargin(), 0);\n-         parentBase2 = parentBase2 - QPoint(scm.iconSize()*2.7 - scm.decorationMargin(), 0);\n+         parentBase1 = parentBase1 - QPoint(scm.indentation(), 0);\n+         parentBase2 = parentBase2 - QPoint(scm.indentation(), 0);\n      }\n \n "}]}, {"sha": "4858a4245e4cc30bfcfe7f96745908db6d4ba6b0", "stats": {"total": 13, "additions": 10, "deletions": 3}, "files": [{"sha": "a295ab4d09d100caffae66404398205e6ac3aa7e", "filename": "libs/ui/kis_node_model.cpp", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/KDE/krita/blob/4858a4245e4cc30bfcfe7f96745908db6d4ba6b0/libs/ui/kis_node_model.cpp", "raw_url": "https://github.com/KDE/krita/raw/4858a4245e4cc30bfcfe7f96745908db6d4ba6b0/libs/ui/kis_node_model.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kis_node_model.cpp?ref=4858a4245e4cc30bfcfe7f96745908db6d4ba6b0", "patch": "@@ -466,10 +466,17 @@ QVariant KisNodeModel::data(const QModelIndex &index, int role) const\n         return node->colorLabelIndex();\n     }\n     default:\n-        if (role >= int(KisNodeModel::BeginThumbnailRole) && belongsToIsolatedGroup(node))\n-            return node->createThumbnail(role - int(KisNodeModel::BeginThumbnailRole), role - int(KisNodeModel::BeginThumbnailRole));\n-        else\n+        if (role >= int(KisNodeModel::BeginThumbnailRole) && belongsToIsolatedGroup(node)) {\n+\n+            const int maxSize = role - int(KisNodeModel::BeginThumbnailRole);\n+\n+            QSize size = node->extent().size();\n+            size.scale(maxSize, maxSize, Qt::KeepAspectRatio);\n+\n+            return node->createThumbnail(size.width(), size.height());\n+        } else {\n             return QVariant();\n+        }\n     }\n \n     return QVariant();"}]}, {"sha": "2051a35e295c3a10e10b772aae301adf0ab1894c", "stats": {"total": 48, "additions": 29, "deletions": 19}, "files": [{"sha": "b9beb19ae56c5b0c2d8a3e47fb1fe0949605ef6c", "filename": "libs/image/kis_signal_compressor.cpp", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/2051a35e295c3a10e10b772aae301adf0ab1894c/libs/image/kis_signal_compressor.cpp", "raw_url": "https://github.com/KDE/krita/raw/2051a35e295c3a10e10b772aae301adf0ab1894c/libs/image/kis_signal_compressor.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_signal_compressor.cpp?ref=2051a35e295c3a10e10b772aae301adf0ab1894c", "patch": "@@ -53,13 +53,17 @@ void KisSignalCompressor::start()\n     case POSTPONE:\n         m_timer.start();\n         break;\n+    case FIRST_ACTIVE_POSTPONE_NEXT:\n     case FIRST_ACTIVE:\n         if (!m_timer.isActive()) {\n             m_gotSignals = false;\n             m_timer.start();\n             emit timeout();\n         } else {\n             m_gotSignals = true;\n+            if (m_mode == FIRST_ACTIVE_POSTPONE_NEXT) {\n+                m_timer.start();\n+            }\n         }\n         break;\n     case FIRST_INACTIVE:"}, {"sha": "c85d76d729e1048ef70546c0c8ce1c6274f8d811", "filename": "libs/image/kis_signal_compressor.h", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/2051a35e295c3a10e10b772aae301adf0ab1894c/libs/image/kis_signal_compressor.h", "raw_url": "https://github.com/KDE/krita/raw/2051a35e295c3a10e10b772aae301adf0ab1894c/libs/image/kis_signal_compressor.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_signal_compressor.h?ref=2051a35e295c3a10e10b772aae301adf0ab1894c", "patch": "@@ -34,6 +34,13 @@ class QTimer;\n  * POSTPONE resets the timer after each call. Therefore if the calls are made\n  * quickly enough, the timer will never be activated.\n  *\n+ * FIRST_ACTIVE_POSTPONE_NEXT emits the first signal and postpones all\n+ * the other actions the other action like in POSTPONE. This mode is\n+ * used e.g.  in move/remove layer functionality. If you remove a\n+ * single layer, you'll see the result immediately. But if you want to\n+ * remove multiple layers, you should wait until all the actions are\n+ * finished.\n+ *\n  * FIRST_ACTIVE emits the timeout() event immediately and sets a timer of\n  * duration \\p delay. If the compressor is triggered during this time, it will\n  * wait until the end of the delay period to fire the signal. Further events are\n@@ -54,6 +61,7 @@ class KRITAIMAGE_EXPORT KisSignalCompressor : public QObject\n public:\n     enum Mode {\n         POSTPONE, /* Calling start() resets the timer to \\p delay ms */\n+        FIRST_ACTIVE_POSTPONE_NEXT, /* emits the first signal and postpones all the next ones */\n         FIRST_ACTIVE, /* Emit timeout() signal immediately. Throttle further timeout() to rate of one per \\p delay ms */\n         FIRST_INACTIVE, /* Set a timer \\p delay ms, emit timeout() when it elapses. Ignore all events meanwhile. */\n         UNDEFINED /* KisSignalCompressor is created without an explicit mode */"}, {"sha": "b923dc6e7e2db6ac1e41faabb386d22329c1b92e", "filename": "libs/ui/kis_node_juggler_compressed.cpp", "status": "modified", "additions": 12, "deletions": 17, "changes": 29, "blob_url": "https://github.com/KDE/krita/blob/2051a35e295c3a10e10b772aae301adf0ab1894c/libs/ui/kis_node_juggler_compressed.cpp", "raw_url": "https://github.com/KDE/krita/raw/2051a35e295c3a10e10b772aae301adf0ab1894c/libs/ui/kis_node_juggler_compressed.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kis_node_juggler_compressed.cpp?ref=2051a35e295c3a10e10b772aae301adf0ab1894c", "patch": "@@ -136,6 +136,12 @@ class BatchMoveUpdateData {\n \n     QMutex m_mutex;\n \n+    KisNodeJugglerCompressed *m_parentJuggler;\n+\n+public:\n+    BatchMoveUpdateData(KisNodeJugglerCompressed *parentJuggler)\n+        : m_parentJuggler(parentJuggler) {}\n+\n private:\n \n     static void addToHashLazy(MovedNodesHash *hash, MoveNodeStructSP moveStruct) {\n@@ -168,6 +174,7 @@ class BatchMoveUpdateData {\n     void addInitialUpdate(MoveNodeStructSP moveStruct) {\n         QMutexLocker l(&m_mutex);\n         addToHashLazy(&m_movedNodesInitial, moveStruct);\n+        emit m_parentJuggler->requestUpdateAsyncFromCommand();\n     }\n \n     void emitFinalUpdates(bool undo) {\n@@ -605,13 +612,13 @@ struct RemoveLayers : private KisLayerUtils::RemoveNodeHelper, public KisCommand\n \n struct KisNodeJugglerCompressed::Private\n {\n-    Private(const KUndo2MagicString &_actionName, KisImageSP _image, KisNodeManager *_nodeManager, int _timeout)\n+    Private(KisNodeJugglerCompressed *juggler, const KUndo2MagicString &_actionName, KisImageSP _image, KisNodeManager *_nodeManager, int _timeout)\n         : actionName(_actionName),\n           image(_image),\n           nodeManager(_nodeManager),\n-          compressor(_timeout, KisSignalCompressor::POSTPONE),\n+          compressor(_timeout, KisSignalCompressor::FIRST_ACTIVE_POSTPONE_NEXT),\n           selfDestructionCompressor(3 * _timeout, KisSignalCompressor::POSTPONE),\n-          updateData(new BatchMoveUpdateData),\n+          updateData(new BatchMoveUpdateData(juggler)),\n           autoDelete(false),\n           isStarted(false)\n     {}\n@@ -631,7 +638,7 @@ struct KisNodeJugglerCompressed::Private\n };\n \n KisNodeJugglerCompressed::KisNodeJugglerCompressed(const KUndo2MagicString &actionName, KisImageSP image, KisNodeManager *nodeManager, int timeout)\n-    : m_d(new Private(actionName, image, nodeManager, timeout))\n+    : m_d(new Private(this, actionName, image, nodeManager, timeout))\n {\n     connect(m_d->image, SIGNAL(sigStrokeCancellationRequested()), SLOT(slotEndStrokeRequested()));\n     connect(m_d->image, SIGNAL(sigUndoDuringStrokeRequested()), SLOT(slotCancelStrokeRequested()));\n@@ -646,6 +653,7 @@ KisNodeJugglerCompressed::KisNodeJugglerCompressed(const KUndo2MagicString &acti\n                                     KisProcessingApplicator::NONE,\n                                     emitSignals,\n                                     actionName));\n+    connect(this, SIGNAL(requestUpdateAsyncFromCommand()), SLOT(startTimers()));\n     connect(&m_d->compressor, SIGNAL(timeout()), SLOT(slotUpdateTimeout()));\n \n     m_d->applicator->applyCommand(\n@@ -675,7 +683,6 @@ void KisNodeJugglerCompressed::lowerNode(const KisNodeList &nodes)\n                             m_d->image,\n                             nodes, activeNode, true));\n \n-    startTimers();\n }\n \n void KisNodeJugglerCompressed::raiseNode(const KisNodeList &nodes)\n@@ -686,7 +693,6 @@ void KisNodeJugglerCompressed::raiseNode(const KisNodeList &nodes)\n         new LowerRaiseLayer(m_d->updateData,\n                             m_d->image,\n                             nodes, activeNode, false));\n-    startTimers();\n }\n \n void KisNodeJugglerCompressed::removeNode(const KisNodeList &nodes)\n@@ -697,8 +703,6 @@ void KisNodeJugglerCompressed::removeNode(const KisNodeList &nodes)\n         new RemoveLayers(m_d->updateData,\n                          m_d->image,\n                          nodes, activeNode));\n-\n-    startTimers();\n }\n \n void KisNodeJugglerCompressed::duplicateNode(const KisNodeList &nodes)\n@@ -712,8 +716,6 @@ void KisNodeJugglerCompressed::duplicateNode(const KisNodeList &nodes)\n                             KisNodeSP(), KisNodeSP(),\n                             activeNode,\n                             DuplicateLayers::COPY));\n-\n-    startTimers();\n }\n \n void KisNodeJugglerCompressed::copyNode(const KisNodeList &nodes, KisNodeSP dstParent, KisNodeSP dstAbove)\n@@ -727,8 +729,6 @@ void KisNodeJugglerCompressed::copyNode(const KisNodeList &nodes, KisNodeSP dstP\n                             dstParent, dstAbove,\n                             activeNode,\n                             DuplicateLayers::COPY));\n-\n-    startTimers();\n }\n \n void KisNodeJugglerCompressed::moveNode(const KisNodeList &nodes, KisNodeSP dstParent, KisNodeSP dstAbove)\n@@ -742,8 +742,6 @@ void KisNodeJugglerCompressed::moveNode(const KisNodeList &nodes, KisNodeSP dstP\n                             dstParent, dstAbove,\n                             activeNode,\n                             DuplicateLayers::MOVE));\n-\n-    startTimers();\n }\n \n void KisNodeJugglerCompressed::addNode(const KisNodeList &nodes, KisNodeSP dstParent, KisNodeSP dstAbove)\n@@ -757,8 +755,6 @@ void KisNodeJugglerCompressed::addNode(const KisNodeList &nodes, KisNodeSP dstPa\n                             dstParent, dstAbove,\n                             activeNode,\n                             DuplicateLayers::ADD));\n-\n-    startTimers();\n }\n \n void KisNodeJugglerCompressed::moveNode(KisNodeSP node, KisNodeSP parent, KisNodeSP above)\n@@ -768,7 +764,6 @@ void KisNodeJugglerCompressed::moveNode(KisNodeSP node, KisNodeSP parent, KisNod\n     MoveNodeStructSP moveStruct = toQShared(new MoveNodeStruct(m_d->image, node, parent, above));\n \n     m_d->updateData->addInitialUpdate(moveStruct);\n-    startTimers();\n }\n \n void KisNodeJugglerCompressed::startTimers()"}, {"sha": "ee5ab46218f099b86d5a100ea4c3d4ff6b316822", "filename": "libs/ui/kis_node_juggler_compressed.h", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/2051a35e295c3a10e10b772aae301adf0ab1894c/libs/ui/kis_node_juggler_compressed.h", "raw_url": "https://github.com/KDE/krita/raw/2051a35e295c3a10e10b772aae301adf0ab1894c/libs/ui/kis_node_juggler_compressed.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kis_node_juggler_compressed.h?ref=2051a35e295c3a10e10b772aae301adf0ab1894c", "patch": "@@ -55,13 +55,16 @@ public Q_SLOTS:\n     void end();\n \n private Q_SLOTS:\n+    void startTimers();\n     void slotUpdateTimeout();\n     void slotEndStrokeRequested();\n     void slotCancelStrokeRequested();\n     void slotImageAboutToBeDeleted();\n \n+Q_SIGNALS:\n+    void requestUpdateAsyncFromCommand();\n+\n private:\n-    void startTimers();\n     void cleanup();\n \n private:"}, {"sha": "af163e5028aaa31f2432de4dbfe17a00dd0b3ba0", "filename": "libs/ui/kis_node_manager.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/2051a35e295c3a10e10b772aae301adf0ab1894c/libs/ui/kis_node_manager.cpp", "raw_url": "https://github.com/KDE/krita/raw/2051a35e295c3a10e10b772aae301adf0ab1894c/libs/ui/kis_node_manager.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kis_node_manager.cpp?ref=2051a35e295c3a10e10b772aae301adf0ab1894c", "patch": "@@ -735,7 +735,7 @@ KisNodeJugglerCompressed* KisNodeManager::Private::lazyGetJuggler(const KUndo2Ma\n         (nodeJuggler &&\n          !nodeJuggler->canMergeAction(actionName))) {\n \n-        nodeJuggler = new KisNodeJugglerCompressed(actionName, image, q, 1000);\n+        nodeJuggler = new KisNodeJugglerCompressed(actionName, image, q, 750);\n         nodeJuggler->setAutoDelete(true);\n     }\n "}]}, {"sha": "32cb1de4ceb9d651fb98926a12f8d044a4e6a08f", "stats": {"total": 3, "additions": 0, "deletions": 3}, "files": [{"sha": "50992dc5658dbb4ec92b0df1d6a1a9a88d04a12f", "filename": "libs/flake/KoSnapGuide.cpp", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/32cb1de4ceb9d651fb98926a12f8d044a4e6a08f/libs/flake/KoSnapGuide.cpp", "raw_url": "https://github.com/KDE/krita/raw/32cb1de4ceb9d651fb98926a12f8d044a4e6a08f/libs/flake/KoSnapGuide.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/flake/KoSnapGuide.cpp?ref=32cb1de4ceb9d651fb98926a12f8d044a4e6a08f", "patch": "@@ -187,9 +187,6 @@ QPointF KoSnapGuide::snap(const QPointF &mousePosition, Qt::KeyboardModifiers mo\n     foreach (Private::KoSnapStrategySP strategy, d->strategies) {\n         if (d->usedStrategies & strategy->type() ||\n             strategy->type() == GridSnapping ||\n-            strategy->type() == GuideLineSnapping ||\n-            strategy->type() == DocumentBoundsSnapping ||\n-            strategy->type() == DocumentCenterSnapping ||\n             strategy->type() == CustomSnapping) {\n \n             if (! strategy->snap(mousePosition, &proxy, maxSnapDistance))"}]}, {"sha": "e6636aa466a740ee4464d2e516428ae3773b33af", "stats": {"total": 7, "additions": 7, "deletions": 0}, "files": [{"sha": "4ea9ae597cb094f868c7bd331ad43cf324bdcd97", "filename": "libs/brush/kis_imagepipe_brush.cpp", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/KDE/krita/blob/e6636aa466a740ee4464d2e516428ae3773b33af/libs/brush/kis_imagepipe_brush.cpp", "raw_url": "https://github.com/KDE/krita/raw/e6636aa466a740ee4464d2e516428ae3773b33af/libs/brush/kis_imagepipe_brush.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/brush/kis_imagepipe_brush.cpp?ref=e6636aa466a740ee4464d2e516428ae3773b33af", "patch": "@@ -106,6 +106,13 @@ class KisImageBrushesPipe : public KisBrushesPipe<KisGbrBrush>\n         quint32 brushIndex = 0;\n \n         if (!m_isInitialized) {\n+            /**\n+             * Reset all the indexes to the initial values and do the\n+             * generation based on parameters.\n+             */\n+            for (int i = 0; i < m_parasite.dim; i++) {\n+                m_parasite.index[i] = 0;\n+            }\n             updateBrushIndexes(info);\n             m_isInitialized = true;\n         }"}]}, {"sha": "546e22eb7e10df363158ccad0638a01810ea63cf", "stats": {"total": 50, "additions": 42, "deletions": 8}, "files": [{"sha": "fbb81c5beef533c9d0b251511613e1aa05986ffd", "filename": "libs/ui/KisNodeDelegate.cpp", "status": "modified", "additions": 33, "deletions": 4, "changes": 37, "blob_url": "https://github.com/KDE/krita/blob/546e22eb7e10df363158ccad0638a01810ea63cf/libs/ui/KisNodeDelegate.cpp", "raw_url": "https://github.com/KDE/krita/raw/546e22eb7e10df363158ccad0638a01810ea63cf/libs/ui/KisNodeDelegate.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisNodeDelegate.cpp?ref=546e22eb7e10df363158ccad0638a01810ea63cf", "patch": "@@ -151,7 +151,7 @@ void KisNodeDelegate::drawBranch(QPainter *p, const QStyleOptionViewItem &option\n \n     QPoint p2 = base + QPoint(scm.iconSize() - scm.decorationMargin()*2, scm.iconSize()*0.45);\n     QPoint p3 =  base + QPoint(scm.iconSize() - scm.decorationMargin()*2, scm.iconSize());\n-    QPoint p4 = base + QPoint(scm.iconSize()*2, scm.iconSize());\n+    QPoint p4 = base + QPoint(scm.iconSize()*1.4, scm.iconSize());\n     p->drawLine(p2, p3);\n     p->drawLine(p3, p4);\n \n@@ -209,7 +209,7 @@ void KisNodeDelegate::drawFrame(QPainter *p, const QStyleOptionViewItem &option,\n     const QPoint base = option.rect.topLeft();\n \n     QPoint p2 = base + QPoint(-scm.indentation() - 1, 0);\n-    QPoint p3 = base + QPoint(-2 * scm.border() - 2 * scm.decorationMargin() - scm.decorationSize(), 0);\n+    QPoint p3 = base + QPoint(2 * scm.decorationMargin() + scm.decorationSize(), 0);\n     QPoint p4 = base + QPoint(-1, 0);\n     QPoint p5(iconsRect(option,\n                            index).left() - 1, base.y());\n@@ -335,11 +335,16 @@ QRect KisNodeDelegate::textRect(const QStyleOptionViewItem &option, const QModel\n         minbearing = option.fontMetrics.minLeftBearing() + option.fontMetrics.minRightBearing();\n     }\n \n+    const int decorationOffset =\n+        2 * scm.border() +\n+        2 * scm.decorationMargin() +\n+        scm.decorationSize();\n+\n     const int width =\n         iconsRect(option, index).left() - option.rect.x() -\n-        scm.border() + minbearing;\n+        scm.border() + minbearing - decorationOffset;\n \n-    return QRect(option.rect.x() - minbearing,\n+    return QRect(option.rect.x() - minbearing + decorationOffset,\n                  option.rect.y() + scm.border(),\n                  width,\n                  scm.rowHeight() - scm.border());\n@@ -500,6 +505,19 @@ QRect KisNodeDelegate::visibilityClickRect(const QStyleOptionViewItem &option, c\n                  scm.rowHeight() - scm.border());\n }\n \n+QRect KisNodeDelegate::decorationClickRect(const QStyleOptionViewItem &option, const QModelIndex &index) const\n+{\n+    Q_UNUSED(option);\n+    Q_UNUSED(index);\n+    KisNodeViewColorScheme scm;\n+\n+    QRect realVisualRect = d->view->originalVisualRect(index);\n+\n+    return QRect(realVisualRect.left(), scm.border() + realVisualRect.top(),\n+                 2 * scm.decorationMargin() + scm.decorationSize(),\n+                 scm.rowHeight() - scm.border());\n+}\n+\n void KisNodeDelegate::drawVisibilityIconHijack(QPainter *p, const QStyleOptionViewItem &option, const QModelIndex &index) const\n {\n     /**\n@@ -651,6 +669,10 @@ bool KisNodeDelegate::editorEvent(QEvent *event, QAbstractItemModel *model, cons\n         const bool visibilityClicked = visibilityRect.isValid() &&\n             visibilityRect.contains(mouseEvent->pos());\n \n+        const QRect decorationRect = decorationClickRect(option, index);\n+        const bool decorationClicked = decorationRect.isValid() &&\n+            decorationRect.contains(mouseEvent->pos());\n+\n         const bool leftButton = mouseEvent->buttons() & Qt::LeftButton;\n \n         if (leftButton && iconsClicked) {\n@@ -679,6 +701,13 @@ bool KisNodeDelegate::editorEvent(QEvent *event, QAbstractItemModel *model, cons\n             if (!clickedProperty) return false;\n             d->toggleProperty(props, clickedProperty, mouseEvent->modifiers() == Qt::ControlModifier, index);\n             return true;\n+        } else if (leftButton && decorationClicked) {\n+            bool isExpandable = model->hasChildren(index);\n+            if (isExpandable) {\n+                bool isExpanded = d->view->isExpanded(index);\n+                d->view->setExpanded(index, !isExpanded);\n+                return true;\n+            }\n         }\n \n         if (mouseEvent->button() == Qt::LeftButton &&"}, {"sha": "985c6b8a67c09a3d8aceca72a6f11db8a8a06b98", "filename": "libs/ui/KisNodeDelegate.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/546e22eb7e10df363158ccad0638a01810ea63cf/libs/ui/KisNodeDelegate.h", "raw_url": "https://github.com/KDE/krita/raw/546e22eb7e10df363158ccad0638a01810ea63cf/libs/ui/KisNodeDelegate.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisNodeDelegate.h?ref=546e22eb7e10df363158ccad0638a01810ea63cf", "patch": "@@ -73,6 +73,7 @@ class KisNodeDelegate: public QAbstractItemDelegate\n     void drawText(QPainter *p, const QStyleOptionViewItem &option, const QModelIndex &index) const;\n     void drawIcons(QPainter *p, const QStyleOptionViewItem &option, const QModelIndex &index) const;\n     QRect visibilityClickRect(const QStyleOptionViewItem &option, const QModelIndex &index) const;\n+    QRect decorationClickRect(const QStyleOptionViewItem &option, const QModelIndex &index) const;\n     void drawVisibilityIconHijack(QPainter *p, const QStyleOptionViewItem &option, const QModelIndex &index) const;\n     void drawDecoration(QPainter *p, const QStyleOptionViewItem &option, const QModelIndex &index) const;\n     void drawExpandButton(QPainter *p, const QStyleOptionViewItem &option, const QModelIndex &index) const;"}, {"sha": "98102d9bc26ce63112622db6864252b6a63b39fd", "filename": "libs/ui/KisNodeView.cpp", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/546e22eb7e10df363158ccad0638a01810ea63cf/libs/ui/KisNodeView.cpp", "raw_url": "https://github.com/KDE/krita/raw/546e22eb7e10df363158ccad0638a01810ea63cf/libs/ui/KisNodeView.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisNodeView.cpp?ref=546e22eb7e10df363158ccad0638a01810ea63cf", "patch": "@@ -202,6 +202,11 @@ QRect KisNodeView::visualRect(const QModelIndex &index) const\n     return rc;\n }\n \n+QRect KisNodeView::originalVisualRect(const QModelIndex &index) const\n+{\n+    return QTreeView::visualRect(index);\n+}\n+\n QModelIndex KisNodeView::indexAt(const QPoint &point) const\n {\n     KisNodeViewColorScheme scm;"}, {"sha": "9f02afb729cdb37737784ad0bb65ffee5389200d", "filename": "libs/ui/KisNodeView.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/546e22eb7e10df363158ccad0638a01810ea63cf/libs/ui/KisNodeView.h", "raw_url": "https://github.com/KDE/krita/raw/546e22eb7e10df363158ccad0638a01810ea63cf/libs/ui/KisNodeView.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisNodeView.h?ref=546e22eb7e10df363158ccad0638a01810ea63cf", "patch": "@@ -127,6 +127,8 @@ class KRITAUI_EXPORT KisNodeView: public QTreeView\n \n     void updateNode(const QModelIndex &index);\n \n+    QRect originalVisualRect(const QModelIndex &index) const;\n+\n protected:\n     QItemSelectionModel::SelectionFlags selectionCommand(const QModelIndex &index,\n                                                          const QEvent *event) const;"}, {"sha": "f48582cd5f2ec91c194a3704b82a3b65bd9e2dbf", "filename": "libs/ui/kis_node_view_color_scheme.cpp", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/546e22eb7e10df363158ccad0638a01810ea63cf/libs/ui/kis_node_view_color_scheme.cpp", "raw_url": "https://github.com/KDE/krita/raw/546e22eb7e10df363158ccad0638a01810ea63cf/libs/ui/kis_node_view_color_scheme.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kis_node_view_color_scheme.cpp?ref=546e22eb7e10df363158ccad0638a01810ea63cf", "patch": "@@ -138,12 +138,9 @@ int KisNodeViewColorScheme::indentation() const\n {\n     return\n         2 * thumbnailMargin() + thumbnailSize() +\n-        border() +\n-        2 * decorationMargin() + decorationSize() +\n         border();\n }\n \n-\n QRect KisNodeViewColorScheme::relThumbnailRect() const\n {\n     return QRect(-indentation(),\n@@ -154,7 +151,7 @@ QRect KisNodeViewColorScheme::relThumbnailRect() const\n \n QRect KisNodeViewColorScheme::relDecorationRect() const\n {\n-    return QRect(-border() - decorationMargin() - decorationSize(),\n+    return QRect(border() + decorationMargin(),\n                  border() + decorationMargin(),\n                  decorationSize(),\n                  decorationSize());"}]}, {"sha": "b55fdf3303efa79c9c315916ab44a91b794b2ebd", "stats": {"total": 5, "additions": 3, "deletions": 2}, "files": [{"sha": "4ca7ea8ce0610e0520be5f33dc9c344c4ffbac21", "filename": "libs/widgetutils/kis_action_registry.cpp", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/b55fdf3303efa79c9c315916ab44a91b794b2ebd/libs/widgetutils/kis_action_registry.cpp", "raw_url": "https://github.com/KDE/krita/raw/b55fdf3303efa79c9c315916ab44a91b794b2ebd/libs/widgetutils/kis_action_registry.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/kis_action_registry.cpp?ref=b55fdf3303efa79c9c315916ab44a91b794b2ebd", "patch": "@@ -69,11 +69,12 @@ namespace {\n         if (s.isEmpty()) {\n             return s;\n         }\n-        if (i18n(s.toUtf8().constData()).isEmpty()) {\n+        QString translatedString = i18nc(\"action\", s.toUtf8());\n+        if (translatedString.isEmpty()) {\n             dbgAction << \"No translation found for\" << s;\n             return s;\n         }\n-        return i18n(s.toUtf8().constData());\n+        return translatedString;\n     };\n \n "}]}, {"sha": "7498d7d2b82bf73a22846f62ca63f3c7c05149b5", "stats": {"total": 19, "additions": 19, "deletions": 0}, "files": [{"sha": "c2c990e32bd6c96fa4f2147667dd3d3649f399ee", "filename": "libs/widgetutils/xmlgui/KisShortcutsEditor.cpp", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/7498d7d2b82bf73a22846f62ca63f3c7c05149b5/libs/widgetutils/xmlgui/KisShortcutsEditor.cpp", "raw_url": "https://github.com/KDE/krita/raw/7498d7d2b82bf73a22846f62ca63f3c7c05149b5/libs/widgetutils/xmlgui/KisShortcutsEditor.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/xmlgui/KisShortcutsEditor.cpp?ref=7498d7d2b82bf73a22846f62ca63f3c7c05149b5", "patch": "@@ -297,6 +297,17 @@ void KisShortcutsEditor::printShortcuts() const\n     d->printShortcuts();\n }\n \n+void KisShortcutsEditor::searchUpdated(QString s)\n+{\n+    if (s.isEmpty()) {\n+        // Reset the tree area\n+        d->ui.list->collapseAll();\n+        d->ui.list->expandToDepth(0);\n+    } else {\n+        d->ui.list->expandAll();\n+    }\n+}\n+\n KisShortcutsEditor::ActionTypes KisShortcutsEditor::actionTypes() const\n {\n     return d->actionTypes;"}, {"sha": "b9e5c65666fca69a8c8525aaabf9607bf85aac9b", "filename": "libs/widgetutils/xmlgui/KisShortcutsEditor.h", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/7498d7d2b82bf73a22846f62ca63f3c7c05149b5/libs/widgetutils/xmlgui/KisShortcutsEditor.h", "raw_url": "https://github.com/KDE/krita/raw/7498d7d2b82bf73a22846f62ca63f3c7c05149b5/libs/widgetutils/xmlgui/KisShortcutsEditor.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/xmlgui/KisShortcutsEditor.h?ref=7498d7d2b82bf73a22846f62ca63f3c7c05149b5", "patch": "@@ -233,6 +233,11 @@ public Q_SLOTS:\n      */\n     void printShortcuts() const;\n \n+    /**\n+     * Expand or collapse the tree view when the search text changes\n+     */\n+    void searchUpdated(QString s);\n+\n private:\n     Q_PRIVATE_SLOT(d, void capturedShortcut(QVariant, const QModelIndex &))\n "}, {"sha": "4996e9a3318da61c774f11108117465c2414bf36", "filename": "libs/widgetutils/xmlgui/KisShortcutsEditor_p.cpp", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/7498d7d2b82bf73a22846f62ca63f3c7c05149b5/libs/widgetutils/xmlgui/KisShortcutsEditor_p.cpp", "raw_url": "https://github.com/KDE/krita/raw/7498d7d2b82bf73a22846f62ca63f3c7c05149b5/libs/widgetutils/xmlgui/KisShortcutsEditor_p.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/xmlgui/KisShortcutsEditor_p.cpp?ref=7498d7d2b82bf73a22846f62ca63f3c7c05149b5", "patch": "@@ -85,6 +85,9 @@ void KisShortcutsEditorPrivate::initGUI(KisShortcutsEditor::ActionTypes types,\n     //hide the editor widget chen its item becomes hidden\n     QObject::connect(ui.searchFilter->searchLine(), SIGNAL(hiddenChanged(QTreeWidgetItem*,bool)),\n                      delegate, SLOT(hiddenBySearchLine(QTreeWidgetItem*,bool)));\n+    //Expand items when searching\n+    QObject::connect(ui.searchFilter->searchLine(), SIGNAL(searchUpdated(QString)),\n+                     q, SLOT(searchUpdated(QString)));\n \n     ui.searchFilter->setFocus();\n }"}]}, {"sha": "520cbbfdfb662a46476a69aa0d24d30507a198c5", "stats": {"total": 66, "additions": 34, "deletions": 32}, "files": [{"sha": "7ca59441bfa0f127a448efee22d81c62e53c309a", "filename": "libs/widgetutils/kis_action_registry.cpp", "status": "modified", "additions": 29, "deletions": 26, "changes": 55, "blob_url": "https://github.com/KDE/krita/blob/520cbbfdfb662a46476a69aa0d24d30507a198c5/libs/widgetutils/kis_action_registry.cpp", "raw_url": "https://github.com/KDE/krita/raw/520cbbfdfb662a46476a69aa0d24d30507a198c5/libs/widgetutils/kis_action_registry.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/kis_action_registry.cpp?ref=520cbbfdfb662a46476a69aa0d24d30507a198c5", "patch": "@@ -50,8 +50,8 @@ namespace {\n      */\n     struct ActionInfoItem {\n         QDomElement  xmlData;\n-        QKeySequence defaultShortcut;\n-        QKeySequence customShortcut;\n+        QList<QKeySequence> defaultShortcuts;\n+        QList<QKeySequence> customShortcuts;\n         QString      collectionName;\n         QString      categoryName;\n     };\n@@ -77,11 +77,11 @@ namespace {\n     };\n \n \n-    QKeySequence preferredShortcut(ActionInfoItem action) {\n-        if (action.customShortcut.isEmpty()) {\n-            return action.defaultShortcut;\n+    QList<QKeySequence> preferredShortcuts(ActionInfoItem action) {\n+        if (action.customShortcuts.isEmpty()) {\n+            return action.defaultShortcuts;\n         } else {\n-            return action.customShortcut;\n+            return action.customShortcuts;\n         }\n     };\n \n@@ -133,17 +133,17 @@ KisActionRegistry::KisActionRegistry()\n \n }\n \n-QKeySequence KisActionRegistry::getCustomShortcut(const QString &name)\n+QList<QKeySequence> KisActionRegistry::getCustomShortcut(const QString &name)\n {\n-    return d->actionInfo(name).customShortcut;\n+    return d->actionInfo(name).customShortcuts;\n };\n \n-QKeySequence KisActionRegistry::getPreferredShortcut(const QString &name)\n+QList<QKeySequence> KisActionRegistry::getPreferredShortcut(const QString &name)\n {\n-    return preferredShortcut(d->actionInfo(name));\n+    return preferredShortcuts(d->actionInfo(name));\n };\n \n-QKeySequence KisActionRegistry::getCategory(const QString &name)\n+QString KisActionRegistry::getCategory(const QString &name)\n {\n     return d->actionInfo(name).categoryName;\n };\n@@ -251,7 +251,8 @@ void KisActionRegistry::applyShortcutScheme(const KConfigBase *config)\n         auto it = schemeEntries.constBegin();\n         while (it != schemeEntries.end()) {\n             ActionInfoItem &info = d->actionInfo(it.key());\n-            info.defaultShortcut = it.value();\n+            if (!it.value().isEmpty())\n+                info.defaultShortcuts = QKeySequence::listFromString(it.value());\n             it++;\n         }\n     }\n@@ -260,14 +261,10 @@ void KisActionRegistry::applyShortcutScheme(const KConfigBase *config)\n void KisActionRegistry::updateShortcut(const QString &name, QAction *action)\n {\n     const ActionInfoItem info = d->actionInfo(name);\n-    action->setShortcut(preferredShortcut(info));\n+    auto newShortcuts = preferredShortcuts(info);\n+    action->setShortcuts(newShortcuts);\n \n-    auto defaultShortcutsList = QList<QKeySequence>();\n-    if (info.defaultShortcut != QKeySequence(\"\")) {\n-        // Use the empty list to represent no shortcut\n-        defaultShortcutsList << info.defaultShortcut;\n-    }\n-    action->setProperty(\"defaultShortcuts\", qVariantFromValue(defaultShortcutsList));\n+    action->setProperty(\"defaultShortcuts\", qVariantFromValue(newShortcuts));\n }\n \n \n@@ -311,7 +308,7 @@ bool KisActionRegistry::propertizeAction(const QString &name, QAction * a)\n \n \n \n-    // TODO: check for colliding shortcuts, either here, or in loading code\n+    // TODO: check for colliding shortcuts in .action files either here or in loading code\n #if 0\n      QMap<QKeySequence, QAction*> existingShortcuts;\n      Q_FOREACH (QAction* action, actionCollection->actions()) {\n@@ -364,7 +361,7 @@ void KisActionRegistry::writeCustomShortcuts(KConfigBase *config) const\n          it != d->actionInfoList.constEnd(); ++it) {\n \n         QString actionName = it.key();\n-        QString s = it.value().customShortcut.toString();\n+        QString s = QKeySequence::listToString(it.value().customShortcuts);\n         if (s.isEmpty()) {\n             cg.deleteEntry(actionName, KConfigGroup::Persistent);\n         } else {\n@@ -437,8 +434,12 @@ void KisActionRegistry::Private::loadActionFiles()\n                     else {\n                         ActionInfoItem info;\n                         info.xmlData         = actionXml;\n-                        info.defaultShortcut = getChildContent(actionXml, \"shortcut\");\n-                        info.customShortcut  = QKeySequence();\n+\n+                        // Use empty list to signify no shortcut\n+                        QString shortcutText = getChildContent(actionXml, \"shortcut\");\n+                        if (!shortcutText.isEmpty())\n+                            info.defaultShortcuts << QKeySequence(shortcutText);\n+\n                         info.categoryName    = categoryName;\n                         info.collectionName  = collectionName;\n \n@@ -469,9 +470,11 @@ void KisActionRegistry::Private::loadCustomShortcuts(QString filename)\n     for (auto i = actionInfoList.begin(); i != actionInfoList.end(); ++i) {\n         if (localShortcuts.hasKey(i.key())) {\n             QString entry = localShortcuts.readEntry(i.key(), QString());\n-            i.value().customShortcut = QKeySequence(entry);\n-        } else {\n-            i.value().customShortcut = QKeySequence();\n+            if (entry != QStringLiteral(\"none\")) {\n+                i.value().customShortcuts = QKeySequence::listFromString(entry);\n+                continue;\n+            }\n         }\n+        i.value().customShortcuts = QList<QKeySequence>();\n     }\n };"}, {"sha": "7da8b0c391761213674f42f148a36bbc98ae7cc3", "filename": "libs/widgetutils/kis_action_registry.h", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/KDE/krita/blob/520cbbfdfb662a46476a69aa0d24d30507a198c5/libs/widgetutils/kis_action_registry.h", "raw_url": "https://github.com/KDE/krita/raw/520cbbfdfb662a46476a69aa0d24d30507a198c5/libs/widgetutils/kis_action_registry.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/kis_action_registry.h?ref=520cbbfdfb662a46476a69aa0d24d30507a198c5", "patch": "@@ -62,23 +62,22 @@ class KRITAWIDGETUTILS_EXPORT KisActionRegistry : public QObject\n     /**\n      * Get shortcut for an action\n      */\n-    QKeySequence getPreferredShortcut(const QString &name);\n+    QList<QKeySequence> getPreferredShortcut(const QString &name);\n \n     /**\n      * Get shortcut for an action\n      */\n-    QKeySequence getDefaultShortcut(const QString &name);\n+    QList<QKeySequence> getDefaultShortcut(const QString &name);\n \n     /**\n      * Get custom shortcut for an action\n      */\n-    QKeySequence getCustomShortcut(const QString &name);\n-\n+    QList<QKeySequence> getCustomShortcut(const QString &name);\n \n     /**\n      * Get category name\n      */\n-    QKeySequence getCategory(const QString &name);\n+    QString getCategory(const QString &name);\n \n     /**\n      * @return value @p property for an action @p name."}, {"sha": "f0760fed0e320dc11a061a51bd2f65282535f4c0", "filename": "libs/widgetutils/xmlgui/KisShortcutEditWidget.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/520cbbfdfb662a46476a69aa0d24d30507a198c5/libs/widgetutils/xmlgui/KisShortcutEditWidget.cpp", "raw_url": "https://github.com/KDE/krita/raw/520cbbfdfb662a46476a69aa0d24d30507a198c5/libs/widgetutils/xmlgui/KisShortcutEditWidget.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/xmlgui/KisShortcutEditWidget.cpp?ref=520cbbfdfb662a46476a69aa0d24d30507a198c5", "patch": "@@ -177,7 +177,7 @@ void ShortcutEditWidget::setCustom(const QKeySequence &seq)\n \n void ShortcutEditWidget::setKeySequence(const QKeySequence &activeSeq)\n {\n-    if (activeSeq.toString(QKeySequence::NativeText) == m_defaultLabel->text()) {\n+    if (activeSeq.toString(QKeySequence::NativeText) == m_defaultKeySequence.toString(QKeySequence::NativeText)) {\n         m_defaultRadio->setChecked(true);\n         m_customEditor->clearKeySequence();\n     } else {"}]}, {"sha": "aa9bc3da76f1002d6a09085c0bac65574e5418f9", "stats": {"total": 5, "additions": 3, "deletions": 2}, "files": [{"sha": "629ec052c4430115136ebe549f197dd1e57d992a", "filename": "libs/widgetutils/kis_action_registry.cpp", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/aa9bc3da76f1002d6a09085c0bac65574e5418f9/libs/widgetutils/kis_action_registry.cpp", "raw_url": "https://github.com/KDE/krita/raw/aa9bc3da76f1002d6a09085c0bac65574e5418f9/libs/widgetutils/kis_action_registry.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/kis_action_registry.cpp?ref=aa9bc3da76f1002d6a09085c0bac65574e5418f9", "patch": "@@ -63,7 +63,8 @@ namespace {\n \n     ActionInfoItem emptyActionInfo;  // Used as default return value\n \n-\n+    // Use Krita debug logging categories instead of KDE's default qDebug() for\n+    // harmless empty strings and translations\n     QString quietlyTranslate(const QString &s) {\n         if (s.isEmpty()) {\n             return s;\n@@ -286,7 +287,7 @@ bool KisActionRegistry::propertizeAction(const QString &name, QAction * a)\n \n     // Note: the fields in the .action documents marked for translation are determined by extractrc.\n     QString icon      = getChildContent(actionXml, \"icon\");\n-    QString text      = getChildContent(actionXml, \"text\");\n+    QString text      = getChildContent_i18n(\"text\");\n     QString whatsthis = getChildContent_i18n(\"whatsThis\");\n     QString toolTip   = getChildContent_i18n(\"toolTip\");\n     QString statusTip = getChildContent_i18n(\"statusTip\");"}]}, {"sha": "ce9cd7938d21d5d45b7d5b3c9ea766df90dc0a97", "stats": {"total": 2, "additions": 0, "deletions": 2}, "files": [{"sha": "28331b4c762b90df5cb7906a406dfc6176b480e4", "filename": "libs/flake/KoSnapGuide.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/ce9cd7938d21d5d45b7d5b3c9ea766df90dc0a97/libs/flake/KoSnapGuide.cpp", "raw_url": "https://github.com/KDE/krita/raw/ce9cd7938d21d5d45b7d5b3c9ea766df90dc0a97/libs/flake/KoSnapGuide.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/flake/KoSnapGuide.cpp?ref=ce9cd7938d21d5d45b7d5b3c9ea766df90dc0a97", "patch": "@@ -92,8 +92,6 @@ KoShape *KoSnapGuide::editedShape() const\n \n void KoSnapGuide::enableSnapStrategy(Strategy type, bool value)\n {\n-    if ((d->usedStrategies & type) ==  value) return;\n-\n     if (value) {\n         d->usedStrategies |= type;\n     } else {"}]}, {"sha": "39e6822a01c823b74a5b1b9e75c9737a1f79049e", "stats": {"total": 168, "additions": 102, "deletions": 66}, "files": [{"sha": "3bddb39bb1887c33dd6a52030ea6c1639ea34d54", "filename": "CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -315,11 +315,6 @@ add_definitions(\n   -DQT_DISABLE_DEPRECATED_BEFORE=0\n )\n \n-# To avoid the confusion of an endless stream of Eigen warnings.\n-if (CMAKE_COMPILER_IS_GNUCXX OR CMAKE_COMPILER_IS_GNUC)\n-    add_definitions(-Wno-unused-local-typedefs -Wno-deprecated -Wno-deprecated-declarations)\n-endif ()\n-\n #\n # The reason for this mode is that the Debug mode disable inlining\n #\n@@ -381,7 +376,7 @@ find_package(PNG REQUIRED)\n \n if (APPLE)\n     # this is not added correctly on OSX -- see http://forum.kde.org/viewtopic.php?f=139&t=101867&p=221242#p221242\n-    include_directories(${PNG_INCLUDE_DIR})\n+    include_directories(SYSTEM ${PNG_INCLUDE_DIR})\n endif()\n \n add_definitions(-DBOOST_ALL_NO_LIB)\n@@ -419,7 +414,7 @@ macro_log_feature(OPENEXR_FOUND \"OpenEXR\" \"High dynamic-range (HDR) image file f\n macro_bool_to_01(OPENEXR_FOUND HAVE_OPENEXR)\n set(LINK_OPENEXR_LIB)\n if(OPENEXR_FOUND)\n-    include_directories(${OPENEXR_INCLUDE_DIR})\n+    include_directories(SYSTEM ${OPENEXR_INCLUDE_DIR})\n     set(LINK_OPENEXR_LIB ${OPENEXR_LIBRARIES})\n     add_definitions(${OPENEXR_DEFINITIONS})\n endif()"}, {"sha": "2ea18fff867c3e30b89cc435ab880c3212503255", "filename": "benchmarks/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/benchmarks/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/benchmarks/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/benchmarks/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -4,6 +4,8 @@ include_directories(\n     ${CMAKE_SOURCE_DIR}/sdk/tests\n     ${CMAKE_SOURCE_DIR}/libs/pigment\n     ${CMAKE_SOURCE_DIR}/libs/pigment/compositeops\n+)\n+include_directories(SYSTEM\n     ${EIGEN3_INCLUDE_DIR}\n     ${Boost_INCLUDE_DIRS}\n )"}, {"sha": "bc6e2b13e5adb227d7605c3f5a5239730170aa09", "filename": "krita/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/krita/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/krita/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -1,6 +1,6 @@\n project(krita)\n \n-include_directories(\n+include_directories(SYSTEM\n     ${EIGEN3_INCLUDE_DIR}\n     ${Vc_INCLUDE_DIR}\n )"}, {"sha": "373d802a01bd0dddadfc8d8f7a5c8704a8e3219d", "filename": "krita/sketch/CMakeLists.txt", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/krita/sketch/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/krita/sketch/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/sketch/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -8,11 +8,16 @@ endif ()\n \n add_definitions(${QT_DEFINITIONS} ${KDE4_DEFINITIONS})\n \n-include_directories(${CMAKE_CURRENT_SOURCE_DIR}\n-                    ${CMAKE_CURRENT_SOURCE_DIR}/..\n-                    ${CMAKE_CURRENT_SOURCE_DIR}/models\n-                    ${CMAKE_CURRENT_BINARY_DIR}\n-                    ${Boost_INCLUDE_DIRS})\n+include_directories(\n+    ${CMAKE_CURRENT_SOURCE_DIR}\n+    ${CMAKE_CURRENT_SOURCE_DIR}/..\n+    ${CMAKE_CURRENT_SOURCE_DIR}/models\n+    ${CMAKE_CURRENT_BINARY_DIR}\n+)\n+\n+include_directories(SYSTEM\n+    ${Boost_INCLUDE_DIRS}\n+)\n \n add_subdirectory(draganddrop)\n "}, {"sha": "415553ce3eb16d5c802c1490b0368c4efd760b45", "filename": "libs/brush/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/libs/brush/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/libs/brush/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/brush/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -1,6 +1,6 @@\n add_subdirectory( tests )\n \n-include_directories(\n+include_directories(SYSTEM\n     ${EIGEN3_INCLUDE_DIR}\n )\n \n@@ -35,7 +35,7 @@ endif ()\n \n \n if(HAVE_VC)\n-  include_directories(${Vc_INCLUDE_DIR})\n+  include_directories(SYSTEM ${Vc_INCLUDE_DIR})\n   target_link_libraries(kritalibbrush  ${Vc_LIBRARIES})\n #  set(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} ${Vc_DEFINITIONS}\")\n endif()"}, {"sha": "44c8818150f76fad3a6c2b3d813202fd3937a64d", "filename": "libs/brush/tests/CMakeLists.txt", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/libs/brush/tests/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/libs/brush/tests/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/brush/tests/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -4,11 +4,15 @@ set( EXECUTABLE_OUTPUT_PATH ${CMAKE_CURRENT_BINARY_DIR} )\n include_directories(    \n     ${CMAKE_SOURCE_DIR}/libs/image/metadata \n     ${CMAKE_SOURCE_DIR}/sdk/tests \n+)\n+include_directories(SYSTEM\n     ${EIGEN3_INCLUDE_DIR}\n )\n \n if(HAVE_VC)\n-  include_directories(${Vc_INCLUDE_DIR})\n+  include_directories(SYSTEM\n+      ${Vc_INCLUDE_DIR}\n+  )\n endif()\n \n "}, {"sha": "191529548932180854f8b4dc064b63fb9082e1c8", "filename": "libs/image/CMakeLists.txt", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/libs/image/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/libs/image/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -17,17 +17,19 @@ include_directories(\n     ${CMAKE_CURRENT_SOURCE_DIR}/recorder\n \n     ${CMAKE_SOURCE_DIR}/sdk/tests\n-    \n+)\n+\n+include_directories(SYSTEM\n     ${EIGEN3_INCLUDE_DIR}\n     ${Boost_INCLUDE_DIRS}\n )\n \n if(FFTW3_FOUND)\n-  include_directories(${FFTW3_INCLUDE_DIR})\n+  include_directories(SYSTEM ${FFTW3_INCLUDE_DIR})\n endif()\n \n if(HAVE_VC)\n-  include_directories(${Vc_INCLUDE_DIR} ${Qt5Core_INCLUDE_DIRS} ${Qt5Gui_INCLUDE_DIRS})\n+  include_directories(SYSTEM ${Vc_INCLUDE_DIR} ${Qt5Core_INCLUDE_DIRS} ${Qt5Gui_INCLUDE_DIRS})\n   ko_compile_for_all_implementations(__per_arch_circle_mask_generator_objs kis_brush_mask_applicator_factories.cpp)\n else()\n   set(__per_arch_circle_mask_generator_objs kis_brush_mask_applicator_factories.cpp)"}, {"sha": "c008ca9afec10da794cec494de72c3c90dfbff8d", "filename": "libs/image/tests/CMakeLists.txt", "status": "modified", "additions": 13, "deletions": 9, "changes": 22, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/libs/image/tests/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/libs/image/tests/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/tests/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -9,15 +9,19 @@ if(NOT ${CMAKE_VERSION} VERSION_LESS 3.1.3 AND\n     return()\n endif()\n \n-include_directories(${CMAKE_SOURCE_DIR}/libs/image/metadata \n-                    ${CMAKE_BINARY_DIR}/libs/image/\n-                    ${CMAKE_SOURCE_DIR}/libs/image/\n-                    ${CMAKE_SOURCE_DIR}/libs/image/brushengine\n-                    ${CMAKE_SOURCE_DIR}/libs/image/tiles3\n-                    ${CMAKE_SOURCE_DIR}/libs/image/tiles3/swap\n-                    ${CMAKE_SOURCE_DIR}/sdk/tests \n-                    ${EIGEN3_INCLUDE_DIR}\n-                    ${Boost_INCLUDE_DIRS}\n+include_directories(\n+    ${CMAKE_SOURCE_DIR}/libs/image/metadata\n+    ${CMAKE_BINARY_DIR}/libs/image/\n+    ${CMAKE_SOURCE_DIR}/libs/image/\n+    ${CMAKE_SOURCE_DIR}/libs/image/brushengine\n+    ${CMAKE_SOURCE_DIR}/libs/image/tiles3\n+    ${CMAKE_SOURCE_DIR}/libs/image/tiles3/swap\n+    ${CMAKE_SOURCE_DIR}/sdk/tests\n+)\n+\n+include_Directories(SYSTEM\n+    ${EIGEN3_INCLUDE_DIR}\n+    ${Boost_INCLUDE_DIRS}\n )\n \n if(HAVE_VC)"}, {"sha": "4e7c26ef58aa39dcc3459d383dbf0d77d7d7207b", "filename": "libs/image/tiles3/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/libs/image/tiles3/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/libs/image/tiles3/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/tiles3/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -1,2 +1,2 @@\n-include_directories(${Boost_INCLUDE_DIRS})\n+include_directories(SYSTEM ${Boost_INCLUDE_DIRS})\n add_subdirectory(tests)"}, {"sha": "ca584f11929f81717acfbd39cf1b93e375274f4f", "filename": "libs/image/tiles3/tests/CMakeLists.txt", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/libs/image/tiles3/tests/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/libs/image/tiles3/tests/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/tiles3/tests/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -3,6 +3,9 @@ include_directories(\n     ${CMAKE_BINARY_DIR}/libs/image\n     ${CMAKE_CURRENT_SOURCE_DIR}/tiles3\n     ${CMAKE_CURRENT_SOURCE_DIR}/tile4/SWAP\n+)\n+\n+include_directories(SYSTEM\n     ${EIGEN3_INCLUDE_DIR}\n )\n "}, {"sha": "0db69f65c2c3e82e20619c3c8f22213483af8563", "filename": "libs/pigment/CMakeLists.txt", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/libs/pigment/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/libs/pigment/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -8,23 +8,25 @@ if (WIN32)\n     set(WIN32_PLATFORM_NET_LIBS ws2_32.lib netapi32.lib)\n endif ()\n \n-include_directories( ${Boost_INCLUDE_DIRS} \n-                     ${CMAKE_CURRENT_SOURCE_DIR}/resources\n-                     ${CMAKE_CURRENT_SOURCE_DIR}/compositeops\n+include_directories(\n+    ${CMAKE_CURRENT_SOURCE_DIR}/resources\n+    ${CMAKE_CURRENT_SOURCE_DIR}/compositeops)\n+include_directories(SYSTEM\n+    ${Boost_INCLUDE_DIRS}\n )\n \n set(FILE_OPENEXR_SOURCES)\n set(LINK_OPENEXR_LIB)\n if(OPENEXR_FOUND)\n-    include_directories(${OPENEXR_INCLUDE_DIR})\n+    include_directories(SYSTEM ${OPENEXR_INCLUDE_DIR})\n     set(LINK_OPENEXR_LIB ${OPENEXR_LIBRARIES})\n     add_definitions(${OPENEXR_DEFINITIONS})\n endif()\n \n set(LINK_VC_LIB)\n \n if(HAVE_VC)\n-    include_directories(${Vc_INCLUDE_DIR})\n+    include_directories(SYSTEM ${Vc_INCLUDE_DIR})\n     set(LINK_VC_LIB ${Vc_LIBRARIES})\n     ko_compile_for_all_implementations_no_scalar(__per_arch_factory_objs compositeops/KoOptimizedCompositeOpFactoryPerArch.cpp)\n "}, {"sha": "a88c7b7dcf5b2e0ac9d50673d5e45518180cb0a1", "filename": "libs/ui/CMakeLists.txt", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/libs/ui/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/libs/ui/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -8,6 +8,9 @@ endif ()\n \n include_directories(\n     ${CMAKE_CURRENT_SOURCE_DIR}/qtlockedfile\n+)\n+\n+include_directories(SYSTEM\n     ${EXIV2_INCLUDE_DIR}\n     ${EIGEN3_INCLUDE_DIR}\n     ${OCIO_INCLUDE_DIR}"}, {"sha": "796526927ced53250798395a8fc32c903a41800b", "filename": "plugins/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -6,7 +6,7 @@ endif()\n \n # add all the include paths to kritaui that we use, for now.\n \n-include_directories(\n+include_directories(SYSTEM\n     ${EIGEN3_INCLUDE_DIR}\n     ${Vc_INCLUDE_DIR}\n )"}, {"sha": "bcd3983c9ac82e113fefa97b025d235cfa17232c", "filename": "plugins/color/lcms2engine/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/color/lcms2engine/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/color/lcms2engine/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/color/lcms2engine/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -2,7 +2,7 @@ project( lcmsengine )\n \n add_subdirectory(tests)\n \n-include_directories( \n+include_directories(SYSTEM\n     ${LCMS2_INCLUDE_DIR} \n     ${Boost_INCLUDE_DIRS} \n     \n@@ -41,7 +41,7 @@ endif ()\n set(FILE_OPENEXR_SOURCES)\n set(LINK_OPENEXR_LIB)\n if(OPENEXR_FOUND)\n-    include_directories(${OPENEXR_INCLUDE_DIR})\n+    include_directories(SYSTEM ${OPENEXR_INCLUDE_DIR})\n     set(LINK_OPENEXR_LIB ${OPENEXR_LIBRARIES})\n     add_definitions(${OPENEXR_DEFINITIONS})\n endif()"}, {"sha": "b8e7dc449a8c3bb554f462fbf89b63ba163e56e0", "filename": "plugins/color/lcms2engine/tests/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/color/lcms2engine/tests/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/color/lcms2engine/tests/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/color/lcms2engine/tests/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -15,7 +15,7 @@ include_directories( ../colorspaces/cmyk_u16\n     ..\n )\n if(OPENEXR_FOUND)\n-    include_directories(${OPENEXR_INCLUDE_DIR})\n+    include_directories(SYSTEM ${OPENEXR_INCLUDE_DIR})\n endif()\n include_directories( ${LCMS2_INCLUDE_DIR} )\n "}, {"sha": "ca9a6d3ba02939affe2965634244c82552c1f513", "filename": "plugins/dockers/animation/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/dockers/animation/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/dockers/animation/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/animation/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -2,7 +2,7 @@ if (NOT WIN32 AND NOT APPLE)\n     add_subdirectory(tests)\n endif()    \n \n-include_directories(${Boost_INCLUDE_DIRS})\n+include_directories(SYSTEM ${Boost_INCLUDE_DIRS})\n \n set(KRITA_ANIMATIONDOCKER_SOURCES\n     animation_dockers.cpp"}, {"sha": "20e7b1a3eeaab7367b34df3005895e15f4866a3f", "filename": "plugins/dockers/griddocker/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/dockers/griddocker/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/dockers/griddocker/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/griddocker/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -1,4 +1,4 @@\n-include_directories(\n+include_directories(SYSTEM\n \t${Boost_INCLUDE_DIRS}\n )\n "}, {"sha": "8ed1b48a36a21d84f9be3c07e3db7408ff8aaf95", "filename": "plugins/dockers/lut/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/dockers/lut/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/dockers/lut/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/lut/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -2,7 +2,8 @@ if (NOT WIN32 AND NOT APPLE)\n     add_subdirectory(tests)\n endif()\n \n-include_directories( ${OCIO_INCLUDE_DIR}\n+include_directories(SYSTEM\n+    ${OCIO_INCLUDE_DIR}\n     ${Boost_INCLUDE_DIRS}\n )\n "}, {"sha": "16e31e5b1ce2373f272b190ff4a44a62309cf279", "filename": "plugins/dockers/lut/tests/CMakeLists.txt", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/dockers/lut/tests/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/dockers/lut/tests/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/lut/tests/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -1,7 +1,9 @@\n macro_add_unittest_definitions()\n-include_directories( ${OCIO_INCLUDE_DIR}\n+include_directories(${CMAKE_SOURCE_DIR}/sdk/tests)\n+include_directories(SYSTEM\n+    ${OCIO_INCLUDE_DIR}\n     ${Boost_INCLUDE_DIRS}\n-    ${CMAKE_SOURCE_DIR}/sdk/tests)\n+    )\n \n ########### next target ###############\n "}, {"sha": "5ffc39d695168071383ad8783829f60ae96f832f", "filename": "plugins/extensions/gmic/CMakeLists.txt", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/extensions/gmic/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/extensions/gmic/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/gmic/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -59,28 +59,28 @@ if(FFTW3_FOUND)\n     message(\"G'Mic: using FFTW3\")\n     add_definitions(-Dcimg_use_fftw3 )\n     add_definitions(-Dcimg_use_fftw3_singlethread )\n-    include_directories(${FFTW3_INCLUDE_DIR})\n+    include_directories(SYSTEM ${FFTW3_INCLUDE_DIR})\n endif()\n \n # PNG\n if (PNG_FOUND)\n     add_definitions(${PNG_DEFINITIONS})\n     add_definitions(-Dcimg_use_png)\n-    include_directories(${PNG_INCLUDE_DIR})\n+    include_directories(SYSTEM ${PNG_INCLUDE_DIR})\n endif()\n \n # ZLIB\n if (ZLIB_FOUND)\n     add_definitions(-Dcimg_use_zlib)\n-    include_directories( ${ZLIB_INCLUDE_DIRS} )\n+    include_directories(SYSTEM ${ZLIB_INCLUDE_DIRS} )\n endif()\n \n \n # CURL\n if (CURL_FOUND)\n     message(\"G'Mic: using Curl\")\n     add_definitions(-Dcimg_use_curl)\n-    include_directories( ${CURL_INCLUDE_DIRS} )\n+    include_directories(SYSTEM ${CURL_INCLUDE_DIRS} )\n endif()\n \n # X11"}, {"sha": "01d3bd83459a38ef76db991da7e11ce1e532392c", "filename": "plugins/impex/csv/CMakeLists.txt", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/impex/csv/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/impex/csv/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/csv/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -1,8 +1,10 @@\n add_subdirectory(tests)\n \n include_directories( \n-${CMAKE_SOURCE_DIR}/krita/image/metadata \n-${Boost_INCLUDE_DIRS}\n+    ${CMAKE_SOURCE_DIR}/krita/image/metadata\n+)\n+include_directories(SYSTEM\n+    ${Boost_INCLUDE_DIRS}\n )\n \n # import"}, {"sha": "9eb79c0e2babd4ff22bfda5c3fa8ad64783a1ec9", "filename": "plugins/impex/exr/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/impex/exr/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/impex/exr/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/exr/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -1,6 +1,6 @@\n add_subdirectory(tests)\n \n-include_directories( ${OPENEXR_INCLUDE_DIR} )\n+include_directories(SYSTEM ${OPENEXR_INCLUDE_DIR} )\n \n add_definitions(${OPENEXR_DEFINITIONS})\n "}, {"sha": "0b885a99a78e0a74277615443fcff68d35f5f004", "filename": "plugins/impex/jp2/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/impex/jp2/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/impex/jp2/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/jp2/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -1,4 +1,4 @@\n-include_directories( ${OPENJPEG_INCLUDE_DIR})\n+include_directories(SYSTEM ${OPENJPEG_INCLUDE_DIR})\n \n set(libkritaconverter_LIB_SRCS\n     jp2_converter.cc"}, {"sha": "74d06c028245168ecf07686a0b00572b0046797e", "filename": "plugins/impex/jpeg/CMakeLists.txt", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/impex/jpeg/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/impex/jpeg/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/jpeg/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -2,9 +2,12 @@ add_subdirectory(tests)\n \n set(ICCJPEG_SOURCE_DIR \"${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/lcms\")\n \n-include_directories(${ICCJPEG_SOURCE_DIR})\n+include_directories(${ICCJPEG_SOURCE_DIR} ${CMAKE_SOURCE_DIR}/krita/image/metadata)\n \n-include_directories( ${LCMS2_INCLUDE_DIR} ${CMAKE_SOURCE_DIR}/krita/image/metadata ${EXIV2_INCLUDE_DIR})\n+include_directories(SYSTEM\n+    ${LCMS2_INCLUDE_DIR}\n+    ${EXIV2_INCLUDE_DIR}\n+)\n \n set(libkritaconverter_LIB_SRCS\n     kis_jpeg_converter.cc"}, {"sha": "5e96fffbec646ecbc7f2b655068a949c9a5c99ba", "filename": "plugins/impex/odg/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/impex/odg/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/impex/odg/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/odg/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -6,7 +6,7 @@ set(kritaodgimport_SOURCES\n \n add_library(kritaodgimport MODULE ${kritaodgimport_SOURCES})\n \n-include_directories(${PNG_INCLUDE_DIR})\n+include_directories(SYSTEM ${PNG_INCLUDE_DIR})\n \n add_definitions(${PNG_DEFINITIONS} ${KDE4_ENABLE_EXCEPTIONS})\n "}, {"sha": "4e5c58d72e33550ccb803a1dd4f8dee27ec96df7", "filename": "plugins/impex/png/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/impex/png/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/impex/png/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/png/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -8,7 +8,7 @@ set(kritapngimport_SOURCES\n \n add_library(kritapngimport MODULE ${kritapngimport_SOURCES})\n \n-include_directories(${PNG_INCLUDE_DIR})\n+include_directories(SYSTEM ${PNG_INCLUDE_DIR})\n \n add_definitions(${PNG_DEFINITIONS} ${KDE4_ENABLE_EXCEPTIONS})\n "}, {"sha": "e1a157c78b8be8766ee633ac84c43f0dc6258cb5", "filename": "plugins/impex/psd/CMakeLists.txt", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/impex/psd/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/impex/psd/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/psd/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -4,10 +4,15 @@ endif()\n \n configure_file(config_psd.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config_psd.h)\n \n-include_directories(${ZLIB_INCLUDE_DIR})\n-include_directories(${Boost_INCLUDE_DIRS})\n-include_directories(${CMAKE_BINARY_DIR}/libs/psd)  #For kispsd_include.h\n-include_directories(${CMAKE_SOURCE_DIR}/libs/psd)  #For kispsd_include.h\n+include_directories(\n+    ${CMAKE_BINARY_DIR}/libs/psd\n+    ${CMAKE_SOURCE_DIR}/libs/psd\n+)  #For kispsd_include.h\n+\n+include_directories(SYSTEM\n+    ${ZLIB_INCLUDE_DIR}\n+    ${Boost_INCLUDE_DIRS}\n+)\n \n set(LIB_PSD_SRCS \n     psd_header.cpp"}, {"sha": "4e63d8630582c3216d3b2fe226bf7b8facf4b2d7", "filename": "plugins/impex/raw/3rdparty/libkdcraw/tests/multithreading/CMakeLists.txt", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/impex/raw/3rdparty/libkdcraw/tests/multithreading/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/impex/raw/3rdparty/libkdcraw/tests/multithreading/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/raw/3rdparty/libkdcraw/tests/multithreading/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -4,11 +4,12 @@\n # Redistribution and use is allowed according to the terms of the BSD license.\n # For details see the accompanying COPYING-CMAKE-SCRIPTS file.\n \n-include_directories(${KF5_INCLUDE_DIR}\n-                    ${Qt5_INCLUDE_DIR}\n-                    ${Qt5_QTCORE_INCLUDE_DIR}\n-                    ${LibRaw_INCLUDE_DIR}\n-                    ${CMAKE_CURRENT_SOURCE_DIR}/../../src\n+include_directories(${CMAKE_CURRENT_SOURCE_DIR}/../../src)\n+include_directories(SYSTEM\n+    ${KF5_INCLUDE_DIR}\n+    ${Qt5_INCLUDE_DIR}\n+    ${Qt5_QTCORE_INCLUDE_DIR}\n+    ${LibRaw_INCLUDE_DIR}\n )\n \n set(multicorerawtopng_SRCS"}, {"sha": "e58f7ea3f0def3f0ffd1baf98070e3935a1a8bb1", "filename": "plugins/impex/spriter/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/impex/spriter/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/impex/spriter/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/spriter/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -1,5 +1,7 @@\n include_directories( \n     ${CMAKE_SOURCE_DIR}/krita/image/metadata \n+)\n+include_directories(SYSTEM\n     ${Boost_INCLUDE_DIRS}\n )\n "}, {"sha": "0d6420ff771b185d66c8140e459022ad471c6d57", "filename": "plugins/tools/basictools/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/tools/basictools/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/tools/basictools/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/basictools/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -2,7 +2,7 @@ if (NOT APPLE)\n     add_subdirectory(tests)\n endif ()\n \n-include_directories(${Boost_INCLUDE_DIRS})\n+include_directories(SYSTEM ${Boost_INCLUDE_DIRS})\n \n set(kritadefaulttools_SOURCES\n     default_tools.cc"}, {"sha": "d0a8e1f530dc48dfc2de7d8d9f3bcf8a5f4d4b7e", "filename": "plugins/tools/tool_transform2/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/tools/tool_transform2/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/39e6822a01c823b74a5b1b9e75c9737a1f79049e/plugins/tools/tool_transform2/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_transform2/CMakeLists.txt?ref=39e6822a01c823b74a5b1b9e75c9737a1f79049e", "patch": "@@ -2,7 +2,7 @@ if (NOT WIN32 AND NOT APPLE)\n     add_subdirectory(tests)\n endif()\n \n-include_directories(${Boost_INCLUDE_DIRS})\n+include_directories(SYSTEM ${Boost_INCLUDE_DIRS})\n \n set(kritatooltransform_SOURCES\n     tool_transform.cc"}]}, {"sha": "d3d45eddadb480ceb9630e1e6e08d18799435453", "stats": {"total": 63, "additions": 62, "deletions": 1}, "files": [{"sha": "3dd31a28699a04bc8a029c28a15dc073aeaadf0b", "filename": "plugins/tools/tool_transform2/kis_tool_transform.cc", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/KDE/krita/blob/d3d45eddadb480ceb9630e1e6e08d18799435453/plugins/tools/tool_transform2/kis_tool_transform.cc", "raw_url": "https://github.com/KDE/krita/raw/d3d45eddadb480ceb9630e1e6e08d18799435453/plugins/tools/tool_transform2/kis_tool_transform.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_transform2/kis_tool_transform.cc?ref=d3d45eddadb480ceb9630e1e6e08d18799435453", "patch": "@@ -1100,7 +1100,20 @@ void KisToolTransform::slotResetTransform()\n     if (m_currentArgs.continuedTransform()) {\n         ToolTransformArgs::TransformMode savedMode = m_currentArgs.mode();\n \n-        if (m_currentArgs.continuedTransform()->mode() == savedMode) {\n+        /**\n+         * Our reset transform button can be used for two purposes:\n+         *\n+         * 1) Reset current transform to the initial one, which was\n+         *    loaded from the previous user action.\n+         *\n+         * 2) Reset transform frame to infinity when the frame is unchanged\n+         */\n+\n+        const bool transformDiffers = !m_currentArgs.continuedTransform()->isSameMode(m_currentArgs);\n+\n+        if (transformDiffers &&\n+            m_currentArgs.continuedTransform()->mode() == savedMode) {\n+\n             m_currentArgs.restoreContinuedState();\n             initGuiAfterTransformMode();\n             slotEditingFinished();"}, {"sha": "17dd30b30bfd1009abb37c4e6466a8e497bf4d82", "filename": "plugins/tools/tool_transform2/tool_transform_args.cc", "status": "modified", "additions": 47, "deletions": 0, "changes": 47, "blob_url": "https://github.com/KDE/krita/blob/d3d45eddadb480ceb9630e1e6e08d18799435453/plugins/tools/tool_transform2/tool_transform_args.cc", "raw_url": "https://github.com/KDE/krita/raw/d3d45eddadb480ceb9630e1e6e08d18799435453/plugins/tools/tool_transform2/tool_transform_args.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_transform2/tool_transform_args.cc?ref=d3d45eddadb480ceb9630e1e6e08d18799435453", "patch": "@@ -158,6 +158,53 @@ bool ToolTransformArgs::operator==(const ToolTransformArgs& other) const\n          || m_liquifyWorker == other.m_liquifyWorker);\n }\n \n+bool ToolTransformArgs::isSameMode(const ToolTransformArgs& other) const\n+{\n+    if (m_mode != other.m_mode) return false;\n+\n+    bool result = true;\n+\n+    if (m_mode == FREE_TRANSFORM) {\n+        result &= m_transformedCenter == other.m_transformedCenter;\n+        result &= m_originalCenter == other.m_originalCenter;\n+        result &= m_scaleX == other.m_scaleX;\n+        result &= m_scaleY == other.m_scaleY;\n+        result &= m_shearX == other.m_shearX;\n+        result &= m_shearY == other.m_shearY;\n+        result &= m_aX == other.m_aX;\n+        result &= m_aY == other.m_aY;\n+        result &= m_aZ == other.m_aZ;\n+\n+    } else if (m_mode == PERSPECTIVE_4POINT) {\n+        result &= m_transformedCenter == other.m_transformedCenter;\n+        result &= m_originalCenter == other.m_originalCenter;\n+        result &= m_scaleX == other.m_scaleX;\n+        result &= m_scaleY == other.m_scaleY;\n+        result &= m_shearX == other.m_shearX;\n+        result &= m_shearY == other.m_shearY;\n+        result &= m_flattenedPerspectiveTransform == other.m_flattenedPerspectiveTransform;\n+\n+    } else if(m_mode == WARP || m_mode == CAGE) {\n+        result &= m_origPoints == other.m_origPoints;\n+        result &= m_transfPoints == other.m_transfPoints;\n+\n+    } else if (m_mode == LIQUIFY) {\n+        result &= m_liquifyProperties &&\n+            (m_liquifyProperties == other.m_liquifyProperties ||\n+             *m_liquifyProperties == *other.m_liquifyProperties);\n+\n+        result &=\n+            (m_liquifyWorker && other.m_liquifyWorker &&\n+             *m_liquifyWorker == *other.m_liquifyWorker)\n+            || m_liquifyWorker == other.m_liquifyWorker;\n+\n+    } else {\n+        KIS_SAFE_ASSERT_RECOVER_NOOP(0 && \"unknown transform mode\");\n+    }\n+\n+    return result;\n+}\n+\n ToolTransformArgs::ToolTransformArgs(TransformMode mode,\n                                      QPointF transformedCenter,\n                                      QPointF originalCenter,"}, {"sha": "26dc359a920b10d9965e2055e64594a2dffab531", "filename": "plugins/tools/tool_transform2/tool_transform_args.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/d3d45eddadb480ceb9630e1e6e08d18799435453/plugins/tools/tool_transform2/tool_transform_args.h", "raw_url": "https://github.com/KDE/krita/raw/d3d45eddadb480ceb9630e1e6e08d18799435453/plugins/tools/tool_transform2/tool_transform_args.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_transform2/tool_transform_args.h?ref=d3d45eddadb480ceb9630e1e6e08d18799435453", "patch": "@@ -81,6 +81,7 @@ class KRITATOOLTRANSFORM_EXPORT ToolTransformArgs\n     ToolTransformArgs& operator=(const ToolTransformArgs& args);\n \n     bool operator==(const ToolTransformArgs& other) const;\n+    bool isSameMode(const ToolTransformArgs& other) const;\n \n     inline TransformMode mode() const {\n         return m_mode;"}]}, {"sha": "62a299cbb11a51640d18e0fc1a844618d92699b2", "stats": {"total": 14, "additions": 11, "deletions": 3}, "files": [{"sha": "37a358f5fc06e36feff4fa3066b34fc9e91f87cd", "filename": "plugins/filters/colorsfilters/kis_perchannel_filter.cpp", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/KDE/krita/blob/62a299cbb11a51640d18e0fc1a844618d92699b2/plugins/filters/colorsfilters/kis_perchannel_filter.cpp", "raw_url": "https://github.com/KDE/krita/raw/62a299cbb11a51640d18e0fc1a844618d92699b2/plugins/filters/colorsfilters/kis_perchannel_filter.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/colorsfilters/kis_perchannel_filter.cpp?ref=62a299cbb11a51640d18e0fc1a844618d92699b2", "patch": "@@ -93,10 +93,11 @@ KisPerChannelConfigWidget::KisPerChannelConfigWidget(QWidget * parent, KisPaintD\n \n     m_dev = dev;\n     m_activeVChannel = 0;\n+    const KoColorSpace *targetColorSpace = dev->compositionSourceColorSpace();\n \n     // fill in the channel chooser, in the display order, but store the pixel index as well.\n \n-    m_virtualChannels = getVirtualChannels(dev->colorSpace());\n+    m_virtualChannels = getVirtualChannels(targetColorSpace);\n     const int virtualChannelCount = m_virtualChannels.size();\n \n     KisPerChannelFilterConfiguration::initDefaultCurves(m_curves,\n@@ -116,7 +117,7 @@ KisPerChannelConfigWidget::KisPerChannelConfigWidget(QWidget * parent, KisPaintD\n \n     // init histogram calculator\n     QList<QString> keys =\n-        KoHistogramProducerFactoryRegistry::instance()->keysCompatibleWith(m_dev->colorSpace());\n+        KoHistogramProducerFactoryRegistry::instance()->keysCompatibleWith(targetColorSpace);\n \n     if(keys.size() > 0) {\n         KoHistogramProducerFactory *hpf;\n@@ -324,7 +325,7 @@ KisPerChannelFilterConfiguration::~KisPerChannelFilterConfiguration()\n \n bool KisPerChannelFilterConfiguration::isCompatible(const KisPaintDeviceSP dev) const\n {\n-    return (int)dev->colorSpace()->channelCount() == m_curves.size();\n+    return (int)dev->compositionSourceColorSpace()->channelCount() == m_curves.size();\n }\n \n void KisPerChannelFilterConfiguration::setCurves(QList<KisCubicCurve> &curves)\n@@ -585,3 +586,8 @@ KoColorTransformation* KisPerChannelFilter::createTransformation(const KoColorSp\n     return KoCompositeColorTransformation::createOptimizedCompositeTransform(allTransforms);\n }\n \n+bool KisPerChannelFilter::needsTransparentPixels(const KisFilterConfiguration *config, const KoColorSpace *cs) const\n+{\n+    Q_UNUSED(config);\n+    return cs->colorModelId() == AlphaColorModelID;\n+}"}, {"sha": "9cd7703ad7c54a52c8c67756277dad0b9a2c3304", "filename": "plugins/filters/colorsfilters/kis_perchannel_filter.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/62a299cbb11a51640d18e0fc1a844618d92699b2/plugins/filters/colorsfilters/kis_perchannel_filter.h", "raw_url": "https://github.com/KDE/krita/raw/62a299cbb11a51640d18e0fc1a844618d92699b2/plugins/filters/colorsfilters/kis_perchannel_filter.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/colorsfilters/kis_perchannel_filter.h?ref=62a299cbb11a51640d18e0fc1a844618d92699b2", "patch": "@@ -89,6 +89,8 @@ class KisPerChannelFilter\n \n     virtual KoColorTransformation* createTransformation(const KoColorSpace* cs, const KisFilterConfiguration* config) const;\n \n+    virtual bool needsTransparentPixels(const KisFilterConfiguration *config, const KoColorSpace *cs) const;\n+\n     static inline KoID id() {\n         return KoID(\"perchannel\", i18n(\"Color Adjustment\"));\n     }"}]}, {"sha": "dcd8cbe6bbbad1b3988e59cb30296f8bae8db7d4", "stats": {"total": 9, "additions": 5, "deletions": 4}, "files": [{"sha": "b30ed3329d8581f29cd862b59c2eac343b708f47", "filename": "libs/ui/kis_filter_manager.cc", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/KDE/krita/blob/dcd8cbe6bbbad1b3988e59cb30296f8bae8db7d4/libs/ui/kis_filter_manager.cc", "raw_url": "https://github.com/KDE/krita/raw/dcd8cbe6bbbad1b3988e59cb30296f8bae8db7d4/libs/ui/kis_filter_manager.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kis_filter_manager.cc?ref=dcd8cbe6bbbad1b3988e59cb30296f8bae8db7d4", "patch": "@@ -67,7 +67,7 @@ struct KisFilterManager::Private {\n     KisSafeFilterConfigurationSP lastConfiguration;\n     KisSafeFilterConfigurationSP currentlyAppliedConfiguration;\n     KisStrokeId currentStrokeId;\n-    QRect currentApplyRect;\n+    QRect initialApplyRect;\n \n     QSignalMapper actionsMapper;\n \n@@ -252,15 +252,16 @@ void KisFilterManager::apply(KisSafeFilterConfigurationSP filterConfig)\n         d->currentStrokeId.clear();\n     } else {\n         image->waitForDone();\n+        d->initialApplyRect = d->view->activeNode()->exactBounds();\n     }\n \n-    d->currentApplyRect = d->view->activeNode()->exactBounds();\n+    QRect applyRect = d->initialApplyRect;\n \n     KisPaintDeviceSP paintDevice = d->view->activeNode()->paintDevice();\n     if (paintDevice &&\n         filter->needsTransparentPixels(filterConfig.data(), paintDevice->colorSpace())) {\n \n-        d->currentApplyRect |= image->bounds();\n+        applyRect |= image->bounds();\n     }\n \n     KisPostExecutionUndoAdapter *undoAdapter =\n@@ -279,7 +280,7 @@ void KisFilterManager::apply(KisSafeFilterConfigurationSP filterConfig)\n                                                        KisSafeFilterConfigurationSP(filterConfig),\n                                                        resources));\n \n-    QRect processRect = filter->changedRect(d->currentApplyRect, filterConfig.data(), 0);\n+    QRect processRect = filter->changedRect(applyRect, filterConfig.data(), 0);\n     processRect &= image->bounds();\n \n     if (filter->supportsThreading()) {"}]}, {"sha": "c130036711ca642f18f4906ef1f685b8309b76a0", "stats": {"total": 2, "additions": 0, "deletions": 2}, "files": [{"sha": "50a0258174baea0b31b536e9d5ddaee36011fd70", "filename": "windows/makepkg-64.sh", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/c130036711ca642f18f4906ef1f685b8309b76a0/windows/makepkg-64.sh", "raw_url": "https://github.com/KDE/krita/raw/c130036711ca642f18f4906ef1f685b8309b76a0/windows/makepkg-64.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/makepkg-64.sh?ref=c130036711ca642f18f4906ef1f685b8309b76a0", "patch": "@@ -80,8 +80,6 @@ cd $BUILDROOT/out/\n zip -r $PACKAGENAME-dbg.zip $PACKAGENAME\n sha1sum $PACKAGENAME-dbg.zip > $PACKAGENAME-dbg.sha1\n \n-exit 0 \n-\n find $BUILDROOT/out/$PACKAGENAME/bin -name \\*exe | xargs $BUILDROOT/mxe/usr/bin/x86_64-w64-mingw32.shared-strip\n find $BUILDROOT/out/$PACKAGENAME/bin -name \\*dll | xargs $BUILDROOT/mxe/usr/bin/x86_64-w64-mingw32.shared-strip\n find $BUILDROOT/out/$PACKAGENAME/lib -name \\*dll | xargs $BUILDROOT/mxe/usr/bin/x86_64-w64-mingw32.shared-strip"}]}, {"sha": "cca5819b19e0da3434192c5b352285b987a48796", "stats": {"total": 14, "additions": 11, "deletions": 3}, "files": [{"sha": "4a6053d92a2995ae4d4ccf9d89f109c2917a01ff", "filename": "linux/Dockerfile", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/cca5819b19e0da3434192c5b352285b987a48796/linux/Dockerfile", "raw_url": "https://github.com/KDE/krita/raw/cca5819b19e0da3434192c5b352285b987a48796/linux/Dockerfile", "contents_url": "https://api.github.com/repos/KDE/krita/contents/linux/Dockerfile?ref=cca5819b19e0da3434192c5b352285b987a48796", "patch": "@@ -1,5 +1,5 @@\n # Due to the timeout of docker hub, we cannot build the docker image in one go.\n # Hence we base this recipe on another docker image, krita-dependencies\n FROM probonopd/appimages:krita-dependencies\n-ADD https://github.com/probonopd/AppImages/raw/master/recipes/krita/Recipe /Recipe\n+ADD https://raw.githubusercontent.com/KDE/krita/master/linux/Recipe /Recipe\n RUN bash -ex Recipe && yum clean all && rm -rf /out && rm -rf /krita.appdir /Krita*AppImage"}, {"sha": "9148085772eb036d4adc13ca9b5c48da3ee53763", "filename": "linux/Recipe", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/KDE/krita/blob/cca5819b19e0da3434192c5b352285b987a48796/linux/Recipe", "raw_url": "https://github.com/KDE/krita/raw/cca5819b19e0da3434192c5b352285b987a48796/linux/Recipe", "contents_url": "https://api.github.com/repos/KDE/krita/contents/linux/Recipe?ref=cca5819b19e0da3434192c5b352285b987a48796", "patch": "@@ -324,6 +324,14 @@ cp ../AppImageKit/AppRun .\n cp ./usr/share/applications/krita.desktop krita.desktop\n cp /krita/krita/pics/app/64-apps-calligrakrita.png calligrakrita.png\n \n+#\n+# Fetch and install the translations\n+#\n+cd /\n+wget http://nonaynever.ru/pub/l10n-win/krita-3.0-l10n-win-current.tar.gz\n+tar -xf krita-3.0-l10n-win-current.tar.gz\n+cd /krita/appdir/usr/share\n+tar -xf /krita-3.0-l10n-win-current.tar.gz\n \n # replace krita with the lib-checking startup script.\n #cd /krita.appdir/usr/bin\n@@ -334,7 +342,7 @@ cd /\n \n APP=Krita\n \n-VER=$(grep \"#define CALLIGRA_VERSION_STRING\" krita_build/libs/version/calligraversion.h | cut -d '\"' -f 2)\n+VER=$(grep \"#define KRITA_VERSION_STRING\" krita_build/libs/version/kritaversion.h | cut -d '\"' -f 2)\n cd krita\n BRANCH=$( git branch | cut -d ' ' -f 2)\n REVISION=$(git rev-parse --short HEAD)"}, {"sha": "05c753e2e4ed30e82a0696124c6cdc6c20615f3c", "filename": "linux/dependencies/Dockerfile", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/cca5819b19e0da3434192c5b352285b987a48796/linux/dependencies/Dockerfile", "raw_url": "https://github.com/KDE/krita/raw/cca5819b19e0da3434192c5b352285b987a48796/linux/dependencies/Dockerfile", "contents_url": "https://api.github.com/repos/KDE/krita/contents/linux/dependencies/Dockerfile?ref=cca5819b19e0da3434192c5b352285b987a48796", "patch": "@@ -1,5 +1,5 @@\n # First stage. Builds everything but Krita itself. This exists because of the docker hub timeout\n # which prevents us from building everyting in one go\n FROM centos:6\n-ADD https://github.com/probonopd/AppImages/raw/master/recipes/krita/Recipe /Recipe\n+ADD https://raw.githubusercontent.com/KDE/krita/master/linux/Recipe /Recipe\n RUN export DO_NOT_BUILD_KRITA=1 && bash -ex Recipe && yum clean all && rm -rf /out && rm -rf /krita.appdir"}]}, {"sha": "95858d5fbb8575f48c462ce0093e31bf92be3210", "stats": {"total": 372, "additions": 372, "deletions": 0}, "files": [{"sha": "23015cdfd0278ad4f187259cba918ebe4554562d", "filename": "linux/Dockerfile", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/95858d5fbb8575f48c462ce0093e31bf92be3210/linux/Dockerfile", "raw_url": "https://github.com/KDE/krita/raw/95858d5fbb8575f48c462ce0093e31bf92be3210/linux/Dockerfile", "contents_url": "https://api.github.com/repos/KDE/krita/contents/linux/Dockerfile?ref=95858d5fbb8575f48c462ce0093e31bf92be3210", "patch": "@@ -0,0 +1,5 @@\n+# Due to the timeout of docker hub, we cannot build the docker image in one go.\n+# Hence we base this recipe on another docker image, krita-dependencies\n+FROM probonopd/appimages:krita-dependencies\n+ADD https://github.com/probonopd/AppImages/raw/master/recipes/krita/Recipe /Recipe\n+RUN bash -ex Recipe && yum clean all && rm -rf /out && rm -rf /krita.appdir /Krita*AppImage"}, {"sha": "7b6cac11c1ac68a5199221214578398b1665a300", "filename": "linux/Recipe", "status": "added", "additions": 362, "deletions": 0, "changes": 362, "blob_url": "https://github.com/KDE/krita/blob/95858d5fbb8575f48c462ce0093e31bf92be3210/linux/Recipe", "raw_url": "https://github.com/KDE/krita/raw/95858d5fbb8575f48c462ce0093e31bf92be3210/linux/Recipe", "contents_url": "https://api.github.com/repos/KDE/krita/contents/linux/Recipe?ref=95858d5fbb8575f48c462ce0093e31bf92be3210", "patch": "@@ -0,0 +1,362 @@\n+#!/bin/bash\n+\n+# Enter a CentOS 6 chroot (you could use other methods)\n+# git clone https://github.com/probonopd/AppImageKit.git\n+# ./AppImageKit/build.sh \n+# sudo ./AppImageKit/AppImageAssistant.AppDir/testappimage /isodevice/boot/iso/CentOS-6.5-x86_64-LiveCD.iso bash\n+\n+# Halt on errors\n+set -e\n+\n+# Be verbose\n+set -x\n+\n+# Now we are inside CentOS 6\n+grep -r \"CentOS release 6\" /etc/redhat-release || exit 1\n+\n+# If we are running inside Travis CI, then we want to build Krita\n+# and we remove the $DO_NOT_BUILD_KRITA environment variable\n+# that was used in the process of generating the Docker image.\n+# Also we do not want to download and build the dependencies every\n+# time we build Krita on travis in the docker image. In order to\n+# use newer dependencies, we re-build the docker image instead.\n+unset DO_NOT_BUILD_KRITA\n+NO_DOWNLOAD=1\n+\n+# qjsonparser, used to add metadata to the plugins needs to work in a en_US.UTF-8 environment. That's\n+# not always set correctly in CentOS 6.7\n+export LC_ALL=en_US.UTF-8\n+export LANG=en_us.UTF-8\n+\n+# Determine which architecture should be built\n+if [[ \"$(arch)\" = \"i686\" || \"$(arch)\" = \"x86_64\" ]] ; then\n+  ARCH=$(arch)\n+else\n+  echo \"Architecture could not be determined\"\n+  exit 1\n+fi\n+\n+# if the library path doesn't point to our usr/lib, linking will be broken and we won't find all deps either\n+export LD_LIBRARY_PATH=/usr/lib64/:/usr/lib:/krita.appdir/usr/lib\n+\n+git_pull_rebase_helper()\n+{\n+\tgit reset --hard HEAD\n+        git pull\n+}\n+\n+if [ -z \"$NO_DOWNLOAD\" ] ; then\n+yum -y install epel-release \n+# we need to be up to date in order to install the xcb-keysyms dependency\n+yum -y update\n+# base dependencies and Qt5.\n+yum -y install wget tar bzip2 git libtool which fuse fuse-devel libpng-devel automake libtool mesa-libEGL cppunit-devel cmake glibc-headers libstdc++-devel gcc-c++ freetype-devel fontconfig-devel libxml2-devel libstdc++-devel libXrender-devel patch xcb-util-keysyms-devel libXi-devel\n+\n+# Newer compiler than what comes with CentOS 6\n+wget http://people.centos.org/tru/devtools-2/devtools-2.repo -O /etc/yum.repos.d/devtools-2.repo\n+yum -y install devtoolset-2-gcc devtoolset-2-gcc-c++ devtoolset-2-binutils\n+\n+# Make sure we build from the /, parts of this script depends on that. We also need to run as root...\n+cd  /\n+\n+# Build AppImageKit\n+if [ ! -d AppImageKit ] ; then\n+  git clone  --depth 1 https://github.com/probonopd/AppImageKit.git /AppImageKit\n+fi\n+\n+cd /AppImageKit/\n+git_pull_rebase_helper\n+./build.sh\n+cd /\n+fi # [ -z \"$NO_DOWNLOAD\" ]\n+\n+\n+# Workaround for:\n+# /usr/lib/librevenge-stream-0.0.so: undefined reference to `std::__detail::_List_node_base::_M_hook(std::__detail::_List_node_base*)'\n+# Use the new compiler\n+. /opt/rh/devtoolset-2/enable\n+\n+\n+# Workaround for: On CentOS 6, .pc files in /usr/lib/pkgconfig are not recognized\n+# However, this is where .pc files get installed when bulding libraries... (FIXME)\n+# I found this by comparing the output of librevenge's \"make install\" command\n+# between Ubuntu and CentOS 6\n+ln -sf /usr/share/pkgconfig /usr/lib/pkgconfig\n+\n+\n+# A krita build layout looks like this:\n+# krita/ -- the source directory\n+# krita/3rdparty -- the cmake definitions for the dependencies\n+# d -- downloads of the dependencies from files.kde.org\n+# b -- build directory for the dependencies\n+# krita_build -- build directory for krita itself\n+# krita.appdir -- install directory for krita and the dependencies\n+\n+# Get Krita\n+if [ ! -d /krita ] ; then\n+\tgit clone  --depth 1 https://github.com/KDE/krita.git /krita\n+fi\n+\n+cd /krita/\n+git_pull_rebase_helper\n+\n+# Create the build dir for the 3rdparty deps\n+if [ ! -d /b ] ; then\n+    mkdir /b\n+fi    \n+if [ ! -d /d ] ; then\n+    mkdir /d\n+fi\n+\n+# Prepare the install location\n+rm -rf /krita.appdir/ || true\n+mkdir -p /krita.appdir/usr\n+\n+# make sure lib and lib64 are the same thing\n+mkdir -p /krita.appdir/usr/lib\n+cd  /krita.appdir/usr\n+ln -s lib lib64\n+\n+# start building the deps\n+cd /b\n+\n+if [ -z \"$NO_DOWNLOAD\" ] ; then\n+\n+rm -rf /b/* || true\n+\n+cmake /krita/3rdparty \\\n+    -DCMAKE_INSTALL_PREFIX:PATH=/usr \\\n+    -DINSTALL_ROOT=/usr \\\n+    -DEXTERNALS_DOWNLOAD_DIR=/d\n+    \n+cmake --build . --config RelWithDebInfo --target ext_qt\n+cmake --build . --config RelWithDebInfo --target ext_boost\n+cmake --build . --config RelWithDebInfo --target ext_eigen3\n+cmake --build . --config RelWithDebInfo --target ext_exiv2\n+cmake --build . --config RelWithDebInfo --target ext_fftw3\n+cmake --build . --config RelWithDebInfo --target ext_lcms2\n+cmake --build . --config RelWithDebInfo --target ext_ocio\n+cmake --build . --config RelWithDebInfo --target ext_openexr\n+cmake --build . --config RelWithDebInfo --target ext_vc\n+#cmake --build . --config RelWithDebInfo --target ext_png\n+cmake --build . --config RelWithDebInfo --target ext_tiff\n+cmake --build . --config RelWithDebInfo --target ext_jpeg\n+cmake --build . --config RelWithDebInfo --target ext_libraw\n+# XXX: this builds, but cmake never manages to find the library\n+#cmake --build . --config RelWithDebInfo --target ext_openjpeg\n+cmake --build . --config RelWithDebInfo --target ext_kcrash\n+# XXX: this builds, but pulls in ext_png, which leads to big conflicts\n+#cmake --build . --config RelWithDebInfo --target ext_poppler\n+cmake --build . --config RelWithDebInfo --target ext_gsl\n+\n+fi # if [ -z \"$NO_DOWNLOAD\" ]\n+    \n+cd ..\n+\n+# If the environment variable DO_NOT_BUILD_KRITA is set to something,\n+# then stop here. This is for docker hub which has a timeout that\n+# prevents us from building in one go.\n+# if [ ! -z \"$DO_NOT_BUILD_KRITA\" ] ; then\n+#  exit 0\n+# fi\n+\n+mkdir -p /krita_build\n+cd /krita_build\n+cmake ../krita \\\n+    -DCMAKE_INSTALL_PREFIX:PATH=/krita.appdir/usr \\\n+    -DDEFINE_NO_DEPRECATED=1 \\\n+    -DCMAKE_BUILD_TYPE=RelWithDebInfo \\\n+    -DPACKAGERS_BUILD=1 \\\n+    -DBUILD_TESTING=FALSE \\\n+    -DKDE4_BUILD_TESTS=FALSE \\\n+    -DHAVE_MEMORY_LEAK_TRACKER=FALSE\n+    \n+# Install into the AppDir\n+make -j4 install\n+\n+cd /krita.appdir\n+\n+# FIXME: How to find out which subset of plugins is really needed? I used strace when running the binary\n+mkdir -p ./usr/lib/qt5/plugins/\n+\n+if [ -e $(dirname /usr/li*/qt5/plugins/bearer) ] ; then\n+  PLUGINS=$(dirname /usr/li*/qt5/plugins/bearer)\n+else\n+  PLUGINS=../../5.5/gc*/plugins/\n+fi\n+echo $PLUGINS # /usr/lib64/qt5/plugins if build system Qt is found\n+cp -r $PLUGINS/bearer ./usr/lib/qt5/plugins/\n+cp -r $PLUGINS/generic ./usr/lib/qt5/plugins/\n+cp -r $PLUGINS/imageformats ./usr/lib/qt5/plugins/\n+cp -r $PLUGINS/platforms ./usr/lib/qt5/plugins/\n+cp -r $PLUGINS/iconengines ./usr/lib/qt5/plugins/\n+cp -r $PLUGINS/platforminputcontexts ./usr/lib/qt5/plugins/\n+cp -r $PLUGINS/platformthemes ./usr/lib/qt5/plugins/\n+cp -r $PLUGINS/xcbglintegrations ./usr/lib/qt5/plugins/\n+\n+cp $(ldconfig -p | grep libsasl2.so.2 | cut -d \">\" -f 2 | xargs) ./usr/lib/\n+cp $(ldconfig -p | grep libGL.so.1 | cut -d \">\" -f 2 | xargs) ./usr/lib/ # otherwise segfaults!?\n+cp $(ldconfig -p | grep libGLU.so.1 | cut -d \">\" -f 2 | xargs) ./usr/lib/ # otherwise segfaults!?\n+# Fedora 23 seemed to be missing SOMETHING from the Centos 6.7. The only message was:\n+# This application failed to start because it could not find or load the Qt platform plugin \"xcb\".\n+# Setting export QT_DEBUG_PLUGINS=1 revealed the cause.\n+# QLibraryPrivate::loadPlugin failed on \"/usr/lib64/qt5/plugins/platforms/libqxcb.so\" : \n+# \"Cannot load library /usr/lib64/qt5/plugins/platforms/libqxcb.so: (/lib64/libEGL.so.1: undefined symbol: drmGetNodeTypeFromFd)\"\n+# Which means that we have to copy libEGL.so.1 in too\n+cp $(ldconfig -p | grep libEGL.so.1 | cut -d \">\" -f 2 | xargs) ./usr/lib/ # Otherwise F23 cannot load the Qt platform plugin \"xcb\"\n+# let's not copy xcb itself, that breaks on dri3 systems https://bugs.kde.org/show_bug.cgi?id=360552\n+#cp $(ldconfig -p | grep libxcb.so.1 | cut -d \">\" -f 2 | xargs) ./usr/lib/ \n+cp $(ldconfig -p | grep libfreetype.so.6 | cut -d \">\" -f 2 | xargs) ./usr/lib/ # For Fedora 20\n+\n+ldd usr/bin/krita | grep \"=>\" | awk '{print $3}' | xargs -I '{}' cp -v '{}' ./usr/lib || true\n+#ldd usr/lib64/krita/*.so  | grep \"=>\" | awk '{print $3}' | xargs -I '{}' cp -v '{}' ./usr/lib || true\n+#ldd usr/lib64/plugins/imageformats/*.so  | grep \"=>\" | awk '{print $3}' | xargs -I '{}' cp -v '{}' ./usr/lib || true\n+\n+ldd usr/lib/qt5/plugins/platforms/libqxcb.so | grep \"=>\" | awk '{print $3}'  |  xargs -I '{}' cp -v '{}' ./usr/lib || true\n+\n+# Copy in the indirect dependencies\n+FILES=$(find . -type f -executable)\n+\n+for FILE in $FILES ; do\n+\tldd \"${FILE}\" | grep \"=>\" | awk '{print $3}' | xargs -I '{}' cp -v '{}' usr/lib || true\n+done\n+\n+#DEPS=\"\"\n+#for FILE in $FILES ; do\n+#  ldd \"${FILE}\" | grep \"=>\" | awk '{print $3}' | xargs -I '{}' echo '{}' > DEPSFILE\n+#done\n+#DEPS=$(cat DEPSFILE  |sort | uniq)\n+#for FILE in $DEPS ; do\n+#  if [ -f $FILE ] ; then\n+#    echo $FILE\n+#    cp --parents -rfL $FILE ./\n+#  fi\n+#done\n+#rm -f DEPSFILE\n+\n+\n+# The following are assumed to be part of the base system\n+rm -f usr/lib/libcom_err.so.2 || true\n+rm -f usr/lib/libcrypt.so.1 || true\n+rm -f usr/lib/libdl.so.2 || true\n+rm -f usr/lib/libexpat.so.1 || true\n+#rm -f usr/lib/libfontconfig.so.1 || true\n+rm -f usr/lib/libgcc_s.so.1 || true\n+rm -f usr/lib/libglib-2.0.so.0 || true\n+rm -f usr/lib/libgpg-error.so.0 || true\n+rm -f usr/lib/libgssapi_krb5.so.2 || true\n+rm -f usr/lib/libgssapi.so.3 || true\n+rm -f usr/lib/libhcrypto.so.4 || true\n+rm -f usr/lib/libheimbase.so.1 || true\n+rm -f usr/lib/libheimntlm.so.0 || true\n+rm -f usr/lib/libhx509.so.5 || true\n+rm -f usr/lib/libICE.so.6 || true\n+rm -f usr/lib/libidn.so.11 || true\n+rm -f usr/lib/libk5crypto.so.3 || true\n+rm -f usr/lib/libkeyutils.so.1 || true\n+rm -f usr/lib/libkrb5.so.26 || true\n+rm -f usr/lib/libkrb5.so.3 || true\n+rm -f usr/lib/libkrb5support.so.0 || true\n+# rm -f usr/lib/liblber-2.4.so.2 || true # needed for debian wheezy\n+# rm -f usr/lib/libldap_r-2.4.so.2 || true # needed for debian wheezy\n+rm -f usr/lib/libm.so.6 || true\n+rm -f usr/lib/libp11-kit.so.0 || true\n+rm -f usr/lib/libpcre.so.3 || true\n+rm -f usr/lib/libpthread.so.0 || true\n+rm -f usr/lib/libresolv.so.2 || true\n+rm -f usr/lib/libroken.so.18 || true\n+rm -f usr/lib/librt.so.1 || true\n+rm -f usr/lib/libsasl2.so.2 || true\n+rm -f usr/lib/libSM.so.6 || true\n+rm -f usr/lib/libusb-1.0.so.0 || true\n+rm -f usr/lib/libuuid.so.1 || true\n+rm -f usr/lib/libwind.so.0 || true\n+\n+# Remove these libraries, we need to use the system versions; this means 11.04 is not supported (12.04 is our baseline)\n+rm -f usr/lib/libGL.so.* || true\n+rm -f usr/lib/libdrm.so.* || true\n+\n+#rm -f usr/lib/libz.so.1 || true\n+\n+# These seem to be available on most systems but not Ubuntu 11.04\n+# rm -f usr/lib/libffi.so.6 usr/lib/libGL.so.1 usr/lib/libglapi.so.0 usr/lib/libxcb.so.1 usr/lib/libxcb-glx.so.0 || true\n+\n+# Delete potentially dangerous libraries\n+rm -f usr/lib/libstdc* usr/lib/libgobject* usr/lib/libc.so.* || true\n+rm -f usr/lib/libxcb.so.1\n+\n+# Do NOT delete libX* because otherwise on Ubuntu 11.04:\n+# loaded library \"Xcursor\" malloc.c:3096: sYSMALLOc: Assertion (...) Aborted\n+\n+# We don't bundle the developer stuff\n+rm -rf usr/include || true\n+rm -rf usr/lib/cmake || true\n+rm -rf usr/lib/pkgconfig || true\n+rm -rf usr/share/ECM/ || true\n+rm -rf usr/share/gettext || true\n+rm -rf usr/share/pkgconfig || true\n+\n+strip usr/lib/kritaplugins/* usr/bin/* usr/lib/* || true\n+\n+# Since we set /krita.appdir as the prefix, we need to patch it away too (FIXME)\n+# Probably it would be better to use /app as a prefix because it has the same length for all apps\n+cd usr/ ; find . -type f -exec sed -i -e 's|/krita.appdir/usr/|./././././././././|g' {} \\; ; cd  ..\n+\n+# On openSUSE Qt is picking up the wrong libqxcb.so\n+# (the one from the system when in fact it should use the bundled one) - is this a Qt bug?\n+# Also, Krita has a hardcoded /usr which we patch away\n+cd usr/ ; find . -type f -exec sed -i -e 's|/usr|././|g' {} \\; ; cd ..\n+\n+# We do not bundle this, so let's not search that inside the AppImage. \n+# Fixes \"Qt: Failed to create XKB context!\" and lets us enter text\n+sed -i -e 's|././/share/X11/|/usr/share/X11/|g' ./usr/lib/qt5/plugins/platforminputcontexts/libcomposeplatforminputcontextplugin.so\n+sed -i -e 's|././/share/X11/|/usr/share/X11/|g' ./usr/lib/libQt5XcbQpa.so.5\n+\n+# Workaround for:\n+# D-Bus library appears to be incorrectly set up;\n+# failed to read machine uuid: Failed to open\n+# The file is more commonly in /etc/machine-id\n+# sed -i -e 's|/var/lib/dbus/machine-id|//././././etc/machine-id|g' ./usr/lib/libdbus-1.so.3\n+# or\n+rm -f ./usr/lib/libdbus-1.so.3 || true\n+\n+cp ../AppImageKit/AppRun .\n+cp ./usr/share/applications/krita.desktop krita.desktop\n+cp /krita/krita/pics/app/64-apps-calligrakrita.png calligrakrita.png\n+\n+\n+# replace krita with the lib-checking startup script.\n+#cd /krita.appdir/usr/bin\n+#mv krita krita.real\n+#wget https://raw.githubusercontent.com/boudewijnrempt/AppImages/master/recipes/krita/krita\n+#chmod a+rx krita\n+cd / \n+\n+APP=Krita\n+\n+VER=$(grep \"#define CALLIGRA_VERSION_STRING\" krita_build/libs/version/calligraversion.h | cut -d '\"' -f 2)\n+cd krita\n+BRANCH=$( git branch | cut -d ' ' -f 2)\n+REVISION=$(git rev-parse --short HEAD)\n+cd ..\n+VERSION=$VER-$BRANCH-$REVISION\n+VERSION=\"$(sed s/\\ /-/g <<<$VERSION)\"\n+echo $VERSION\n+\n+if [[ \"$ARCH\" = \"x86_64\" ]] ; then\n+\tAPPIMAGE=$APP\"-\"$VERSION\"-x86_64.AppImage\"\n+fi\n+if [[ \"$ARCH\" = \"i686\" ]] ; then\n+\tAPPIMAGE=$APP\"-\"$VERSION\"-i386.AppImage\"\n+fi\n+echo $APPIMAGE\n+\n+mkdir -p /out\n+\n+rm -f /out/*.AppImage || true\n+AppImageKit/AppImageAssistant.AppDir/package /krita.appdir/ /out/$APPIMAGE\n+\n+chmod a+rwx /out/$APPIMAGE # So that we can edit the AppImage outside of the Docker container\n+\n+# Test the resulting AppImage on my local system\n+# sudo /tmp/*/union/AppImageKit/AppImageAssistant.AppDir/testappimage /isodevice/boot/iso/Fedora-Live-Workstation-x86_64-22-3.iso /tmp/*/union/Scribus.AppDir/"}, {"sha": "a5b028d12fd8ef0816e6ee16853297d48b9744e0", "filename": "linux/dependencies/Dockerfile", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/95858d5fbb8575f48c462ce0093e31bf92be3210/linux/dependencies/Dockerfile", "raw_url": "https://github.com/KDE/krita/raw/95858d5fbb8575f48c462ce0093e31bf92be3210/linux/dependencies/Dockerfile", "contents_url": "https://api.github.com/repos/KDE/krita/contents/linux/dependencies/Dockerfile?ref=95858d5fbb8575f48c462ce0093e31bf92be3210", "patch": "@@ -0,0 +1,5 @@\n+# First stage. Builds everything but Krita itself. This exists because of the docker hub timeout\n+# which prevents us from building everyting in one go\n+FROM centos:6\n+ADD https://github.com/probonopd/AppImages/raw/master/recipes/krita/Recipe /Recipe\n+RUN export DO_NOT_BUILD_KRITA=1 && bash -ex Recipe && yum clean all && rm -rf /out && rm -rf /krita.appdir"}]}, {"sha": "e4571602389e41b52b9be897da311befd85b1718", "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "8bb15d242ea627dabdd6a4f042ff564b58018a76", "filename": "krita/data/shortcuts/paint_tool_sai_compatible.shortcuts", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/e4571602389e41b52b9be897da311befd85b1718/krita/data/shortcuts/paint_tool_sai_compatible.shortcuts", "raw_url": "https://github.com/KDE/krita/raw/e4571602389e41b52b9be897da311befd85b1718/krita/data/shortcuts/paint_tool_sai_compatible.shortcuts", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/data/shortcuts/paint_tool_sai_compatible.shortcuts?ref=e4571602389e41b52b9be897da311befd85b1718", "patch": "@@ -337,7 +337,7 @@ pathpoint-merge=none\n pathpoint-remove=Backspace\n pathpoint-smooth=none\n pathpoint-symmetric=none\n-pathsegment-curve=C\n+pathsegment-curve=Shift+C\n pathsegment-line=F\n patterns=none\n preserve_alpha=none"}, {"sha": "b762f280108528ce0e32eda0c40be29008a262ee", "filename": "krita/data/shortcuts/photoshop_compatible.shortcuts", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/e4571602389e41b52b9be897da311befd85b1718/krita/data/shortcuts/photoshop_compatible.shortcuts", "raw_url": "https://github.com/KDE/krita/raw/e4571602389e41b52b9be897da311befd85b1718/krita/data/shortcuts/photoshop_compatible.shortcuts", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/data/shortcuts/photoshop_compatible.shortcuts?ref=e4571602389e41b52b9be897da311befd85b1718", "patch": "@@ -337,7 +337,7 @@ pathpoint-merge=none\n pathpoint-remove=Backspace\n pathpoint-smooth=none\n pathpoint-symmetric=none\n-pathsegment-curve=C\n+pathsegment-curve=Shift+C\n pathsegment-line=F\n patterns=none\n preserve_alpha=none"}]}, {"sha": "55bbe2312368b88ec6d6154d6205ffa8451f78f7", "stats": {"total": 25, "additions": 13, "deletions": 12}, "files": [{"sha": "9cc5da78695f33ff7a423c6d3bb56da3f00ef8e6", "filename": "libs/ui/kis_action.cpp", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/55bbe2312368b88ec6d6154d6205ffa8451f78f7/libs/ui/kis_action.cpp", "raw_url": "https://github.com/KDE/krita/raw/55bbe2312368b88ec6d6154d6205ffa8451f78f7/libs/ui/kis_action.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kis_action.cpp?ref=55bbe2312368b88ec6d6154d6205ffa8451f78f7", "patch": "@@ -83,7 +83,10 @@ KisAction *makeKisAction(QString name, QObject *parent)\n void KisAction::setDefaultShortcut(const QKeySequence &shortcut)\n {\n     QList<QKeySequence> listifiedShortcut;\n-    listifiedShortcut.append(shortcut);\n+    // Use the empty list to represent no shortcut\n+    if (shortcut != QKeySequence(\"\")) {\n+        listifiedShortcut.append(shortcut);\n+    }\n     setProperty(\"defaultShortcuts\", qVariantFromValue(listifiedShortcut));\n }\n "}, {"sha": "417993a925c0572a0f4fd0f094592301e9428d4e", "filename": "libs/widgetutils/kis_action_registry.cpp", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/KDE/krita/blob/55bbe2312368b88ec6d6154d6205ffa8451f78f7/libs/widgetutils/kis_action_registry.cpp", "raw_url": "https://github.com/KDE/krita/raw/55bbe2312368b88ec6d6154d6205ffa8451f78f7/libs/widgetutils/kis_action_registry.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/kis_action_registry.cpp?ref=55bbe2312368b88ec6d6154d6205ffa8451f78f7", "patch": "@@ -260,8 +260,13 @@ void KisActionRegistry::updateShortcut(const QString &name, QAction *action)\n {\n     const ActionInfoItem info = d->actionInfo(name);\n     action->setShortcut(preferredShortcut(info));\n-    auto propertizedShortcut = qVariantFromValue(QList<QKeySequence>() << info.defaultShortcut);\n-    action->setProperty(\"defaultShortcuts\", propertizedShortcut);\n+\n+    auto defaultShortcutsList = QList<QKeySequence>();\n+    if (info.defaultShortcut != QKeySequence(\"\")) {\n+        // Use the empty list to represent no shortcut\n+        defaultShortcutsList << info.defaultShortcut;\n+    }\n+    action->setProperty(\"defaultShortcuts\", qVariantFromValue(defaultShortcutsList));\n }\n \n "}, {"sha": "92598a104fc94b816000618e07cd559d87f33080", "filename": "libs/widgetutils/xmlgui/kactioncollection.cpp", "status": "modified", "additions": 2, "deletions": 9, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/55bbe2312368b88ec6d6154d6205ffa8451f78f7/libs/widgetutils/xmlgui/kactioncollection.cpp", "raw_url": "https://github.com/KDE/krita/raw/55bbe2312368b88ec6d6154d6205ffa8451f78f7/libs/widgetutils/xmlgui/kactioncollection.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/xmlgui/kactioncollection.cpp?ref=55bbe2312368b88ec6d6154d6205ffa8451f78f7", "patch": "@@ -587,16 +587,9 @@ void KActionCollection::writeSettings(KConfigGroup *config,\n                 // not set to its default value. Write it\n                 QString s = QKeySequence::listToString(action->shortcuts());\n                 if (s.isEmpty()) {\n-                    if (writeScheme) {\n-                        // A scheme file should explicitly set \"none\" for the shortcut\n-                        s = QStringLiteral(\"none\");\n-                        config->writeEntry(actionName, s, flags);\n-                    } else {\n-                        config->deleteEntry(actionName, flags);\n-                    }\n-                } else {\n-                    config->writeEntry(actionName, s, flags);\n+                    s = QStringLiteral(\"none\");\n                 }\n+                config->writeEntry(actionName, s, flags);\n             } else if (bConfigHasAction) {\n                 // This key is the same as default but exists in config file.\n                 // Remove it."}]}, {"sha": "54064e5a401f1e30254490115c7d098b7624d184", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "436f10c19913b068845ba34e458575ca236a7eda", "filename": "krita/data/actions/PathTool.action", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/54064e5a401f1e30254490115c7d098b7624d184/krita/data/actions/PathTool.action", "raw_url": "https://github.com/KDE/krita/raw/54064e5a401f1e30254490115c7d098b7624d184/krita/data/actions/PathTool.action", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/data/actions/PathTool.action?ref=54064e5a401f1e30254490115c7d098b7624d184", "patch": "@@ -84,7 +84,7 @@\n     </Action>\n     <Action name=\"pathsegment-curve\">\n       <iconText>Segment to Curve</iconText>\n-      <shortcut>C</shortcut>\n+      <shortcut>Shift+C</shortcut>\n       <toolTip>Segment to Curve</toolTip>\n       <icon>pathsegment-curve</icon>\n       <whatsThis></whatsThis>"}]}, {"sha": "b318d7fe5bd32ed806d23b0379f8ebe8b717273d", "stats": {"total": 30, "additions": 15, "deletions": 15}, "files": [{"sha": "d8e57c73cc3bb0ece556a298ef594394878a66b0", "filename": "COPYING.LIB", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/b318d7fe5bd32ed806d23b0379f8ebe8b717273d/COPYING.LIB", "raw_url": "https://github.com/KDE/krita/raw/b318d7fe5bd32ed806d23b0379f8ebe8b717273d/COPYING.LIB", "contents_url": "https://api.github.com/repos/KDE/krita/contents/COPYING.LIB?ref=b318d7fe5bd32ed806d23b0379f8ebe8b717273d", "patch": "@@ -1,5 +1,5 @@\n NOTE! The LGPL below is copyrighted by the Free Software Foundation, but \n-the instance of code that it refers to (parts of calligra) are copyrighted \n+the instance of code that it refers to (parts of Krita) are copyrighted \n by the authors who actually wrote it.\n \t\t\t\t   \n ---------------------------------------------------------------------------"}, {"sha": "d0f77fe035e4841ccb7957149a6735d1fd0bc0b2", "filename": "libs/koplugin/KoJsonTrader.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/b318d7fe5bd32ed806d23b0379f8ebe8b717273d/libs/koplugin/KoJsonTrader.cpp", "raw_url": "https://github.com/KDE/krita/raw/b318d7fe5bd32ed806d23b0379f8ebe8b717273d/libs/koplugin/KoJsonTrader.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/koplugin/KoJsonTrader.cpp?ref=b318d7fe5bd32ed806d23b0379f8ebe8b717273d", "patch": "@@ -76,7 +76,7 @@ KoJsonTrader::KoJsonTrader()\n                     }\n \n                     // on debian at least the actual libdir is a subdir named like \"lib/x86_64-linux-gnu\"\n-                    // so search there for the calligra subdir which will contain our plugins\n+                    // so search there for the Krita subdir which will contain our plugins\n                     Q_FOREACH (QString subEntry, libDir.entryList()) {\n                         QFileInfo subInfo(libDir, subEntry);\n                         if (subInfo.isDir()) {"}, {"sha": "94a2ba07693f43bc3e17776e859f0ddac915455c", "filename": "libs/store/KoStore.h", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/b318d7fe5bd32ed806d23b0379f8ebe8b717273d/libs/store/KoStore.h", "raw_url": "https://github.com/KDE/krita/raw/b318d7fe5bd32ed806d23b0379f8ebe8b717273d/libs/store/KoStore.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/store/KoStore.h?ref=b318d7fe5bd32ed806d23b0379f8ebe8b717273d", "patch": "@@ -30,7 +30,7 @@ class QUrl;\n class KoStorePrivate;\n \n /**\n- * Saves and loads Calligra documents using various backends. Currently supported\n+ * Saves and loads Krita documents using various backends. Currently supported\n  * backends are zip and directory.\n  * We call a \"store\" the file on the hard disk (the one the users sees)\n  * and call a \"file\" a file inside the store.\n@@ -43,7 +43,7 @@ class KRITASTORE_EXPORT KoStore\n     enum Backend { Auto, Zip, Directory };\n \n     /**\n-     * Open a store (i.e. the representation on disk of a Calligra document).\n+     * Open a store (i.e. the representation on disk of a Krita document).\n      *\n      * @param fileName the name of the file to open\n      * @param mode if KoStore::Read, open an existing store to read it.\n@@ -75,7 +75,7 @@ class KRITASTORE_EXPORT KoStore\n                                 Backend backend = Auto, bool writeMimetype = true);\n \n     /**\n-     * Open a store (i.e. the representation on disk of a Calligra document).\n+     * Open a store (i.e. the representation on disk of a Krita document).\n      *\n      * @param url URL of the file to open\n      * @param mode if KoStore::Read, open an existing store to read it."}, {"sha": "690912af2b8d86191021f480f22a412a6c6d39e7", "filename": "libs/store/KoZipStore.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/b318d7fe5bd32ed806d23b0379f8ebe8b717273d/libs/store/KoZipStore.cpp", "raw_url": "https://github.com/KDE/krita/raw/b318d7fe5bd32ed806d23b0379f8ebe8b717273d/libs/store/KoZipStore.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/store/KoZipStore.cpp?ref=b318d7fe5bd32ed806d23b0379f8ebe8b717273d", "patch": "@@ -119,7 +119,7 @@ void KoZipStore::init(const QByteArray& appIdentification)\n         }\n \n         m_pZip->setCompression(KZip::DeflateCompression);\n-        // We don't need the extra field in Calligra - so we leave it as \"no extra field\".\n+        // We don't need the extra field in Krita - so we leave it as \"no extra field\".\n     } else {\n         d->good = m_pZip->directory() != 0;\n     }"}, {"sha": "9a8dbf87b685840c41ca09ab21ff294b6d544083", "filename": "libs/store/tests/storedroptest.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/b318d7fe5bd32ed806d23b0379f8ebe8b717273d/libs/store/tests/storedroptest.cpp", "raw_url": "https://github.com/KDE/krita/raw/b318d7fe5bd32ed806d23b0379f8ebe8b717273d/libs/store/tests/storedroptest.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/store/tests/storedroptest.cpp?ref=b318d7fe5bd32ed806d23b0379f8ebe8b717273d", "patch": "@@ -60,7 +60,7 @@ int main(int argc, char** argv)\n StoreDropTest::StoreDropTest(QWidget* parent)\n         : QTextBrowser(parent)\n {\n-    setText(\"KoStore drop/paste test\\nDrop or paste a selection from a Calligra application into this widget to see the ZIP contents\");\n+    setText(\"KoStore drop/paste test\\nDrop or paste a selection from a Krita application into this widget to see the ZIP contents\");\n     setAcceptDrops(true);\n }\n "}, {"sha": "e5edbaf91f3a052de71086362c20903e979b89c9", "filename": "libs/ui/KisApplication.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/b318d7fe5bd32ed806d23b0379f8ebe8b717273d/libs/ui/KisApplication.cpp", "raw_url": "https://github.com/KDE/krita/raw/b318d7fe5bd32ed806d23b0379f8ebe8b717273d/libs/ui/KisApplication.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisApplication.cpp?ref=b318d7fe5bd32ed806d23b0379f8ebe8b717273d", "patch": "@@ -352,7 +352,7 @@ bool KisApplication::start(const KisApplicationArguments &args)\n \n     KoHashGeneratorProvider::instance()->setGenerator(\"MD5\", new KisMD5Generator());\n \n-    // Initialize all Calligra directories etc.\n+    // Initialize all Krita directories etc.\n     KoGlobal::initialize();\n \n     KConfigGroup group(KSharedConfig::openConfig(), \"theme\");"}, {"sha": "98a028c0e15a519c5c68bd161c3b40dbdb079b45", "filename": "libs/ui/KisApplication.h", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/b318d7fe5bd32ed806d23b0379f8ebe8b717273d/libs/ui/KisApplication.h", "raw_url": "https://github.com/KDE/krita/raw/b318d7fe5bd32ed806d23b0379f8ebe8b717273d/libs/ui/KisApplication.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisApplication.h?ref=b318d7fe5bd32ed806d23b0379f8ebe8b717273d", "patch": "@@ -31,13 +31,13 @@ class KisApplicationArguments;\n #include <KisImportExportManager.h>\n \n /**\n- *  @brief Base class for all %Calligra apps\n+ *  @brief Base class for the %Krita app\n  *\n  *  This class handles arguments given on the command line and\n- *  shows a generic about dialog for all Calligra apps.\n+ *  shows a generic about dialog for the Krita app.\n  *\n- *  In addition it adds the standard directories where Calligra applications\n- *  can find their images etc.\n+ *  In addition it adds the standard directories where Krita\n+ *  can find its images etc.\n  *\n  *  If the last mainwindow becomes closed, KisApplication automatically\n  *  calls QApplication::quit."}, {"sha": "d9ae55e89fc94bd0fe787e2c44e0c2fbce4ad430", "filename": "libs/ui/KisAutoSaveRecoveryDialog.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/b318d7fe5bd32ed806d23b0379f8ebe8b717273d/libs/ui/KisAutoSaveRecoveryDialog.cpp", "raw_url": "https://github.com/KDE/krita/raw/b318d7fe5bd32ed806d23b0379f8ebe8b717273d/libs/ui/KisAutoSaveRecoveryDialog.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisAutoSaveRecoveryDialog.cpp?ref=b318d7fe5bd32ed806d23b0379f8ebe8b717273d", "patch": "@@ -210,7 +210,7 @@ KisAutoSaveRecoveryDialog::KisAutoSaveRecoveryDialog(const QStringList &filename\n         QString path = QDir::homePath() + \"/\" + filename;\n #endif\n \n-        // get thumbnail -- all calligra apps save a thumbnail\n+        // get thumbnail -- almost all Krita-supported formats save a thumbnail\n         KoStore* store = KoStore::createStore(path, KoStore::Read);\n \n         if (store) {"}, {"sha": "3b3fcc840d69def605a91dc1123a21dfb1c91ccd", "filename": "libs/widgets/KoUnitDoubleSpinBox.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/b318d7fe5bd32ed806d23b0379f8ebe8b717273d/libs/widgets/KoUnitDoubleSpinBox.h", "raw_url": "https://github.com/KDE/krita/raw/b318d7fe5bd32ed806d23b0379f8ebe8b717273d/libs/widgets/KoUnitDoubleSpinBox.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgets/KoUnitDoubleSpinBox.h?ref=b318d7fe5bd32ed806d23b0379f8ebe8b717273d", "patch": "@@ -31,9 +31,9 @@ class KoUnit;\n /**\n  * Spin box for double precision numbers with unit display.\n  * Use this widget for any value that represents a real measurable value for consistency throughout\n- * Calligra.\n+ * Krita.\n  * This widget shows the value in the user-selected units (inch, milimeters, etc) but keeps the\n- * calligra-widget default measurement unit internally. This has the advantage that just setting and\n+ * Krita-widget default measurement unit internally. This has the advantage that just setting and\n  * getting a value will not change the value due to conversions.\n  * The KoDocument class has a unit() method for consistent (document wide) configuration of the\n  * used unit."}]}, {"sha": "7e243631056ce6e00efa3615585a1b84d81eddc0", "stats": {"total": 37, "additions": 0, "deletions": 37}, "files": [{"sha": "52731996b947c98009331e2cf8a9ed63b1aea6f8", "filename": "CMakeLists.txt", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/7e243631056ce6e00efa3615585a1b84d81eddc0/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/7e243631056ce6e00efa3615585a1b84d81eddc0/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=7e243631056ce6e00efa3615585a1b84d81eddc0", "patch": "@@ -618,7 +618,6 @@ macro_log_feature(CURL_FOUND \"CURL\" \"A tool to fetch remote data\" \"http://curl.h\n ############################\n \n include(MacroKritaAddBenchmark)\n-include(MacroCalligraAddTest)\n \n  ####################\n #####################"}, {"sha": "f051589dda87d32b5909724bc362f0d9fad4572d", "filename": "cmake/modules/MacroCalligraAddTest.cmake", "status": "removed", "additions": 0, "deletions": 36, "changes": 36, "blob_url": "https://github.com/KDE/krita/blob/88797393039c3c541473c02dd0c8b28b117228ba/cmake/modules/MacroCalligraAddTest.cmake", "raw_url": "https://github.com/KDE/krita/raw/88797393039c3c541473c02dd0c8b28b117228ba/cmake/modules/MacroCalligraAddTest.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/modules/MacroCalligraAddTest.cmake?ref=88797393039c3c541473c02dd0c8b28b117228ba", "patch": "@@ -1,36 +0,0 @@\n-#\n-# Copyright (c) 2012-2015 Jaros\u0142aw Staniek <staniek@kde.org>\n-#\n-# Redistribution and use is allowed according to the terms of the BSD license.\n-# For details see the accompanying COPYING-CMAKE-SCRIPTS file.\n-#\n-# Adds a single test with proper prefix.\n-# Prefixes help to select subsets of tests to run, e.g. only Krita tests or Flake tests.\n-#\n-# Usage: calligra_add_test(<prefix> <test_basename> <libraries_to_link>)\n-#\n-# Result: adds a test named \"<prefix>-<test_basename>\", with executable \"<test_basename>\"\n-#         and links it with libraries listed in <libraries_to_link>.\n-#\n-# Example: calligra_add_test(kexi GlobalSearchTest keximain kexicore kexiextendedwidgets)\n-# -- adds a \"kexi-GlobalSearchTest\" test with executable GlobalSearchTest and links it with\n-#    libraries keximain, kexicore, kexiextendedwidgets.\n-#\n-\n-macro(CALLIGRA_ADD_TEST __test_prefix __test_basename)\n-    set(_args \"\")\n-    list(APPEND _libs ${ARGV})\n-    list(REMOVE_AT _libs 0 1)\n-\n-    set(EXECUTABLE_OUTPUT_PATH ${CMAKE_CURRENT_BINARY_DIR})\n-    add_executable(${__test_basename} ${__test_basename}.cpp)\n-    add_test(${__test_prefix}-${__test_basename} ${__test_basename})\n-    ecm_mark_as_test(${__test_prefix}-${__test_basename})\n-    target_link_libraries(${__test_basename} Qt5::Test ${_libs})\n-    get_property(_COMPILE_FLAGS TARGET ${__test_basename} PROPERTY COMPILE_FLAGS)\n-    set_property(TARGET ${__test_basename} PROPERTY COMPILE_FLAGS\n-        ${_COMPILE_FLAGS}\\ -DCURRENT_SOURCE_DIR=\"\\\\\"${CMAKE_CURRENT_SOURCE_DIR}/\\\\\"\"\\ -DFILES_OUTPUT_DIR=\"\\\\\"${CMAKE_CURRENT_BINARY_DIR}/\\\\\"\")\n-#if (BUILD_TEST_COVERAGE)\n-#    target_link_libraries(${_test_name} gcov)\n-#endif ()\n-endmacro(CALLIGRA_ADD_TEST)"}]}, {"sha": "88797393039c3c541473c02dd0c8b28b117228ba", "stats": {"total": 60, "additions": 30, "deletions": 30}, "files": [{"sha": "b81fd33e843716d9bb22ee89a9cfc6676964e8f5", "filename": "CMakeLists.txt", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/KDE/krita/blob/88797393039c3c541473c02dd0c8b28b117228ba/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/88797393039c3c541473c02dd0c8b28b117228ba/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=88797393039c3c541473c02dd0c8b28b117228ba", "patch": "@@ -611,13 +611,13 @@ macro_log_feature(OPENMP_FOUND \"OpenMP\" \"A low-level parallel execution library\"\n macro_optional_find_package(CURL)\n macro_log_feature(CURL_FOUND \"CURL\" \"A tool to fetch remote data\" \"http://curl.haxx.se/\" FALSE \"\" \"Optionally used by the G'Mic plugin\")\n \n- ###############################\n-################################\n-## Add Calligra helper macros ##\n-################################\n-###############################\n+ ############################\n+#############################\n+## Add Krita helper macros ##\n+#############################\n+############################\n \n-include(MacroCalligraAddBenchmark)\n+include(MacroKritaAddBenchmark)\n include(MacroCalligraAddTest)\n \n  ####################"}, {"sha": "e3f889dae8a1b86f8e203049f3e84f100e2353b8", "filename": "benchmarks/CMakeLists.txt", "status": "modified", "additions": 17, "deletions": 17, "changes": 34, "blob_url": "https://github.com/KDE/krita/blob/88797393039c3c541473c02dd0c8b28b117228ba/benchmarks/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/88797393039c3c541473c02dd0c8b28b117228ba/benchmarks/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/benchmarks/CMakeLists.txt?ref=88797393039c3c541473c02dd0c8b28b117228ba", "patch": "@@ -38,23 +38,23 @@ set(kis_low_memory_benchmark_SRCS kis_low_memory_benchmark.cpp)\n set(kis_filter_selections_benchmark_SRCS kis_filter_selections_benchmark.cpp)\n set(kis_composition_benchmark_SRCS kis_composition_benchmark.cpp)\n \n-calligra_add_benchmark(KisDatamanagerBenchmark TESTNAME krita-benchmarks-KisDataManager ${kis_datamanager_benchmark_SRCS})\n-calligra_add_benchmark(KisHLineIteratorBenchmark TESTNAME krita-benchmarks-KisHLineIterator ${kis_hiterator_benchmark_SRCS})\n-calligra_add_benchmark(KisVLineIteratorBenchmark TESTNAME krita-benchmarks-KisVLineIterator ${kis_viterator_benchmark_SRCS})\n-calligra_add_benchmark(KisRandomIteratorBenchmark TESTNAME krita-benchmarks-KisRandomIterator ${kis_random_iterator_benchmark_SRCS})\n-calligra_add_benchmark(KisProjectionBenchmark TESTNAME krita-benchmarks-KisProjectionBenchmark ${kis_projection_benchmark_SRCS})\n-calligra_add_benchmark(KisBContrastBenchmark TESTNAME krita-benchmarks-KisBContrastBenchmark ${kis_bcontrast_benchmark_SRCS})\n-calligra_add_benchmark(KisBlurBenchmark TESTNAME krita-benchmarks-KisBlurBenchmark ${kis_blur_benchmark_SRCS})\n-calligra_add_benchmark(KisLevelFilterBenchmark TESTNAME krita-benchmarks-KisLevelFilterBenchmark ${kis_level_filter_benchmark_SRCS})\n-calligra_add_benchmark(KisPainterBenchmark TESTNAME krita-benchmarks-KisPainterBenchmark ${kis_painter_benchmark_SRCS})\n-calligra_add_benchmark(KisStrokeBenchmark TESTNAME krita-benchmarks-KisStrokeBenchmark ${kis_stroke_benchmark_SRCS})\n-calligra_add_benchmark(KisFastMathBenchmark TESTNAME krita-benchmarks-KisFastMath ${kis_fast_math_benchmark_SRCS})\n-calligra_add_benchmark(KisFloodfillBenchmark TESTNAME krita-benchmarks-KisFloodFill ${kis_floodfill_benchmark_SRCS})\n-calligra_add_benchmark(KisGradientBenchmark TESTNAME krita-benchmarks-KisGradientFill ${kis_gradient_benchmark_SRCS})\n-calligra_add_benchmark(KisMaskGeneratorBenchmark TESTNAME krita-benchmarks-KisMaskGenerator ${kis_mask_generator_benchmark_SRCS})\n-calligra_add_benchmark(KisLowMemoryBenchmark TESTNAME krita-benchmarks-KisLowMemory ${kis_low_memory_benchmark_SRCS})\n-calligra_add_benchmark(KisFilterSelectionsBenchmark TESTNAME krita-image-KisFilterSelectionsBenchmark ${kis_filter_selections_benchmark_SRCS})\n-calligra_add_benchmark(KisCompositionBenchmark TESTNAME krita-benchmarks-KisComposition ${kis_composition_benchmark_SRCS})\n+krita_add_benchmark(KisDatamanagerBenchmark TESTNAME krita-benchmarks-KisDataManager ${kis_datamanager_benchmark_SRCS})\n+krita_add_benchmark(KisHLineIteratorBenchmark TESTNAME krita-benchmarks-KisHLineIterator ${kis_hiterator_benchmark_SRCS})\n+krita_add_benchmark(KisVLineIteratorBenchmark TESTNAME krita-benchmarks-KisVLineIterator ${kis_viterator_benchmark_SRCS})\n+krita_add_benchmark(KisRandomIteratorBenchmark TESTNAME krita-benchmarks-KisRandomIterator ${kis_random_iterator_benchmark_SRCS})\n+krita_add_benchmark(KisProjectionBenchmark TESTNAME krita-benchmarks-KisProjectionBenchmark ${kis_projection_benchmark_SRCS})\n+krita_add_benchmark(KisBContrastBenchmark TESTNAME krita-benchmarks-KisBContrastBenchmark ${kis_bcontrast_benchmark_SRCS})\n+krita_add_benchmark(KisBlurBenchmark TESTNAME krita-benchmarks-KisBlurBenchmark ${kis_blur_benchmark_SRCS})\n+krita_add_benchmark(KisLevelFilterBenchmark TESTNAME krita-benchmarks-KisLevelFilterBenchmark ${kis_level_filter_benchmark_SRCS})\n+krita_add_benchmark(KisPainterBenchmark TESTNAME krita-benchmarks-KisPainterBenchmark ${kis_painter_benchmark_SRCS})\n+krita_add_benchmark(KisStrokeBenchmark TESTNAME krita-benchmarks-KisStrokeBenchmark ${kis_stroke_benchmark_SRCS})\n+krita_add_benchmark(KisFastMathBenchmark TESTNAME krita-benchmarks-KisFastMath ${kis_fast_math_benchmark_SRCS})\n+krita_add_benchmark(KisFloodfillBenchmark TESTNAME krita-benchmarks-KisFloodFill ${kis_floodfill_benchmark_SRCS})\n+krita_add_benchmark(KisGradientBenchmark TESTNAME krita-benchmarks-KisGradientFill ${kis_gradient_benchmark_SRCS})\n+krita_add_benchmark(KisMaskGeneratorBenchmark TESTNAME krita-benchmarks-KisMaskGenerator ${kis_mask_generator_benchmark_SRCS})\n+krita_add_benchmark(KisLowMemoryBenchmark TESTNAME krita-benchmarks-KisLowMemory ${kis_low_memory_benchmark_SRCS})\n+krita_add_benchmark(KisFilterSelectionsBenchmark TESTNAME krita-image-KisFilterSelectionsBenchmark ${kis_filter_selections_benchmark_SRCS})\n+krita_add_benchmark(KisCompositionBenchmark TESTNAME krita-benchmarks-KisComposition ${kis_composition_benchmark_SRCS})\n \n target_link_libraries(KisDatamanagerBenchmark  kritaimage  Qt5::Test)\n target_link_libraries(KisHLineIteratorBenchmark  kritaimage  Qt5::Test)"}, {"sha": "05ddb4b6d4c2d0741092e4c4cc0e56749c7f8570", "filename": "cmake/modules/MacroKritaAddBenchmark.cmake", "status": "renamed", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/88797393039c3c541473c02dd0c8b28b117228ba/cmake/modules/MacroKritaAddBenchmark.cmake", "raw_url": "https://github.com/KDE/krita/raw/88797393039c3c541473c02dd0c8b28b117228ba/cmake/modules/MacroKritaAddBenchmark.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/modules/MacroKritaAddBenchmark.cmake?ref=88797393039c3c541473c02dd0c8b28b117228ba", "patch": "@@ -8,15 +8,15 @@\n \n add_custom_target(benchmark)\n \n-macro (CALLIGRA_ADD_BENCHMARK _test_NAME)\n+macro (KRITA_ADD_BENCHMARK _test_NAME)\n \n     set(_srcList ${ARGN})\n     set(_targetName ${_test_NAME})\n     if( ${ARGV1} STREQUAL \"TESTNAME\" )\n         set(_targetName ${ARGV2})\n         list(REMOVE_AT _srcList 0 1)\n     endif()\n-    \n+\n     set(_nogui)\n     list(GET ${_srcList} 0 first_PARAM)\n     if( ${first_PARAM} STREQUAL \"NOGUI\" )\n@@ -55,7 +55,7 @@ macro (CALLIGRA_ADD_BENCHMARK _test_NAME)\n         set(_executable \"${loc}.shell\")\n       endif ()\n     endif()\n-    \n+\n     if (using_qtest AND KDE4_TEST_OUTPUT STREQUAL \"xml\")\n         #MESSAGE(STATUS \"${_targetName} : Using QTestLib, can produce XML report.\")\n         add_custom_target( ${_targetName} COMMAND ${_executable} -xml -o ${_targetName}.tml )\n@@ -79,4 +79,4 @@ macro (CALLIGRA_ADD_BENCHMARK _test_NAME)\n         endif ()\n     endif ()\n \n-endmacro (CALLIGRA_ADD_BENCHMARK)\n+endmacro (KRITA_ADD_BENCHMARK)", "previous_filename": "cmake/modules/MacroCalligraAddBenchmark.cmake"}, {"sha": "2ddb29f700573e69686538beb886cd0f725efa77", "filename": "libs/pigment/benchmarks/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/88797393039c3c541473c02dd0c8b28b117228ba/libs/pigment/benchmarks/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/88797393039c3c541473c02dd0c8b28b117228ba/libs/pigment/benchmarks/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/benchmarks/CMakeLists.txt?ref=88797393039c3c541473c02dd0c8b28b117228ba", "patch": "@@ -4,10 +4,10 @@ set(EXECUTABLE_OUTPUT_PATH ${CMAKE_CURRENT_BINARY_DIR})\n ########### next target ###############\n \n set(ko_colorspaces_benchmark_SRCS KoColorSpacesBenchmark.cpp)\n-calligra_add_benchmark(KoColorSpacesBenchmark TESTNAME pigment-benchmarks-KoColorSpacesBenchmark ${ko_colorspaces_benchmark_SRCS})\n+krita_add_benchmark(KoColorSpacesBenchmark TESTNAME pigment-benchmarks-KoColorSpacesBenchmark ${ko_colorspaces_benchmark_SRCS})\n target_link_libraries(KoColorSpacesBenchmark kritapigment KF5::I18n  Qt5::Test)\n \n set(ko_compositeops_benchmark_SRCS KoCompositeOpsBenchmark.cpp)\n-calligra_add_benchmark(KoCompositeOpsBenchmark TESTNAME pigment-benchmarks-KoCompositeOpsBenchmark ${ko_compositeops_benchmark_SRCS})\n+krita_add_benchmark(KoCompositeOpsBenchmark TESTNAME pigment-benchmarks-KoCompositeOpsBenchmark ${ko_compositeops_benchmark_SRCS})\n target_link_libraries(KoCompositeOpsBenchmark  kritapigment KF5::I18n  Qt5::Test)\n "}, {"sha": "914bac144f4367c541edbe349dadf65a6472382c", "filename": "plugins/extensions/gmic/tests/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/88797393039c3c541473c02dd0c8b28b117228ba/plugins/extensions/gmic/tests/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/88797393039c3c541473c02dd0c8b28b117228ba/plugins/extensions/gmic/tests/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/gmic/tests/CMakeLists.txt?ref=88797393039c3c541473c02dd0c8b28b117228ba", "patch": "@@ -31,5 +31,5 @@ target_link_libraries(KisGmicTests gmic kritaimage Qt5::Test ${QT_QTXML_LIBRARY}\n \n \n set(kis_gmic_benchmarks_SRCS kis_gmic_benchmarks.cpp ${kritagmic_parser_SOURCES})\n-calligra_add_benchmark(KisGmicBenchmark TESTNAME krita-plugins-extensions-gmic-GmicBenchmarks ${kis_gmic_benchmarks_SRCS})\n+krita_add_benchmark(KisGmicBenchmark TESTNAME krita-plugins-extensions-gmic-GmicBenchmarks ${kis_gmic_benchmarks_SRCS})\n target_link_libraries(KisGmicBenchmark gmic kritaimage Qt5::Test ${QT_QTXML_LIBRARY})"}]}, {"sha": "a31278f1e540b8ad6119730fca351103e3f57411", "stats": {"total": 3, "additions": 0, "deletions": 3}, "files": [{"sha": "d9b51dd47364eac731f97820c0e95bfd0b32988c", "filename": "KoConfig.h.cmake", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/a31278f1e540b8ad6119730fca351103e3f57411/KoConfig.h.cmake", "raw_url": "https://github.com/KDE/krita/raw/a31278f1e540b8ad6119730fca351103e3f57411/KoConfig.h.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/KoConfig.h.cmake?ref=a31278f1e540b8ad6119730fca351103e3f57411", "patch": "@@ -58,8 +58,5 @@\n /* Defines if KCrash is present */\n #cmakedefine HAVE_KCRASH 1\n \n-/* This file contains all the paths that change when changing the installation prefix */\n-#define CALLIGRAPREFIX \"${CMAKE_INSTALL_PREFIX}\"\n-\n /* This variable contains the path to the current build directory */\n #define KRITA_BUILD_DIR \"${CMAKE_BINARY_DIR}\""}]}, {"sha": "080dd9bf70089a6ff75b2b6167fb56f8facb85fc", "stats": {"total": 460, "additions": 219, "deletions": 241}, "files": [{"sha": "65d696fd58775f9e0dbbc636184ee20d346c9500", "filename": "CMakeLists.txt", "status": "modified", "additions": 15, "deletions": 15, "changes": 30, "blob_url": "https://github.com/KDE/krita/blob/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=080dd9bf70089a6ff75b2b6167fb56f8facb85fc", "patch": "@@ -73,29 +73,29 @@ endif()\n #######################\n ######################\n \n-# define common versions of Calligra applications, used to generate calligraversion.h\n+# define common versions of Krita applications, used to generate kritaversion.h\n # update these version for every release:\n-set(CALLIGRA_VERSION_STRING \"3.0 Beta\")\n-set(CALLIGRA_STABLE_VERSION_MAJOR 3) # 3 for 3.x, 4 for 4.x, etc.\n-set(CALLIGRA_STABLE_VERSION_MINOR 0) # 0 for 3.0, 1 for 3.1, etc.\n-set(CALLIGRA_VERSION_RELEASE 90)     # 89 for Alpha, increase for next test releases, set 0 for first Stable, etc.\n-#set(CALLIGRA_ALPHA 1) # uncomment only for Alpha\n-set(CALLIGRA_BETA 1) # uncomment only for Beta\n-#set(CALLIGRA_RC 1) # uncomment only for RC\n-set(CALLIGRA_YEAR 2016) # update every year\n-\n-if(NOT DEFINED CALLIGRA_ALPHA AND NOT DEFINED CALLIGRA_BETA AND NOT DEFINED CALLIGRA_RC)\n-    set(CALLIGRA_STABLE 1) # do not edit\n+set(KRITA_VERSION_STRING \"3.0 Beta\")\n+set(KRITA_STABLE_VERSION_MAJOR 3) # 3 for 3.x, 4 for 4.x, etc.\n+set(KRITA_STABLE_VERSION_MINOR 0) # 0 for 3.0, 1 for 3.1, etc.\n+set(KRITA_VERSION_RELEASE 90)     # 89 for Alpha, increase for next test releases, set 0 for first Stable, etc.\n+#set(KRITA_ALPHA 1) # uncomment only for Alpha\n+set(KRITA_BETA 1) # uncomment only for Beta\n+#set(KRITA_RC 1) # uncomment only for RC\n+set(KRITA_YEAR 2016) # update every year\n+\n+if(NOT DEFINED KRITA_ALPHA AND NOT DEFINED KRITA_BETA AND NOT DEFINED KRITA_RC)\n+    set(KRITA_STABLE 1) # do not edit\n endif()\n \n-message(STATUS \"Krita version: ${CALLIGRA_VERSION_STRING}\")\n+message(STATUS \"Krita version: ${KRITA_VERSION_STRING}\")\n \n # Define the generic version of the Krita libraries here\n # This makes it easy to advance it when the next Krita release comes.\n # 14 was the last GENERIC_KRITA_LIB_VERSION_MAJOR of the previous Krita series\n # (2.x) so we're starting with 15 in 3.x series.\n-if(CALLIGRA_STABLE_VERSION_MAJOR EQUAL 3)\n-    math(EXPR GENERIC_KRITA_LIB_VERSION_MAJOR \"${CALLIGRA_STABLE_VERSION_MINOR} + 15\")\n+if(KRITA_STABLE_VERSION_MAJOR EQUAL 3)\n+    math(EXPR GENERIC_KRITA_LIB_VERSION_MAJOR \"${KRITA_STABLE_VERSION_MINOR} + 15\")\n else()\n     # let's make sure we won't forget to update the \"15\"\n     message(FATAL_ERROR \"Reminder: please update offset == 15 used to compute GENERIC_KRITA_LIB_VERSION_MAJOR to something bigger\")"}, {"sha": "f51614edc1cc8655b874b5217765f80a7c27228d", "filename": "krita/crashreporter/main.cpp", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/krita/crashreporter/main.cpp", "raw_url": "https://github.com/KDE/krita/raw/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/krita/crashreporter/main.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/crashreporter/main.cpp?ref=080dd9bf70089a6ff75b2b6167fb56f8facb85fc", "patch": "@@ -27,23 +27,23 @@\n #include <KAboutData>\n #include <kis_debug.h>\n \n-#include <calligraversion.h>\n+#include <kritaversion.h>\n #include <kritagitversion.h>\n \n #include \"mainwindow.h\"\n \n int main( int argc, char **argv )\n {\n-    QString calligraVersion(CALLIGRA_VERSION_STRING);\n+    QString kritaVersion(KRITA_VERSION_STRING);\n     QString version;\n \n     KLocalizedString::setApplicationDomain( \"crashhandler\" );\n \n #ifdef KRITA_GIT_SHA1_STRING\n     QString gitVersion(KRITA_GIT_SHA1_STRING);\n-    version = QString(\"%1 (git %2)\").arg(calligraVersion).arg(gitVersion).toLatin1();\n+    version = QString(\"%1 (git %2)\").arg(kritaVersion).arg(gitVersion).toLatin1();\n #else\n-    version = calligraVersion;\n+    version = kritaVersion;\n #endif\n     KAboutData aboutData(\"krita\",\n                          i18n(\"Krita Crash Reporter\"),"}, {"sha": "7f0bea612b969198048902b84e5c5284681e8a47", "filename": "krita/crashreporter/mainwindow.cpp", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/krita/crashreporter/mainwindow.cpp", "raw_url": "https://github.com/KDE/krita/raw/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/krita/crashreporter/mainwindow.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/crashreporter/mainwindow.cpp?ref=080dd9bf70089a6ff75b2b6167fb56f8facb85fc", "patch": "@@ -25,7 +25,7 @@\n #include <klocalizedstring.h>\n #include <KoResourcePaths.h>\n \n-#include <calligraversion.h>\n+#include <kritaversion.h>\n #include <kritagitversion.h>\n \n #include <cstdlib>\n@@ -283,15 +283,15 @@ void MainWindow::startUpload()\n     typedef QPair<QByteArray, QByteArray> Field;\n     QList<Field> fields;\n \n-    QString calligraVersion(CALLIGRA_VERSION_STRING);\n+    QString kritaVersion(KRITA_VERSION_STRING);\n     QString version;\n \n \n #ifdef KRITA_GIT_SHA1_STRING\n     QString gitVersion(KRITA_GIT_SHA1_STRING);\n-    version = QString(\"%1-%2\").arg(calligraVersion).arg(gitVersion).toLatin1();\n+    version = QString(\"%1-%2\").arg(kritaVersion).arg(gitVersion).toLatin1();\n #else\n-    version = calligraVersion;\n+    version = kritaVersion;\n #endif\n \n     fields << Field(\"BuildID\", KRITA_GIT_SHA1_STRING)"}, {"sha": "32f9c232992923f8e543a93fe8db2f209d066029", "filename": "krita/gemini/main.cpp", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/KDE/krita/blob/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/krita/gemini/main.cpp", "raw_url": "https://github.com/KDE/krita/raw/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/krita/gemini/main.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/gemini/main.cpp?ref=080dd9bf70089a6ff75b2b6167fb56f8facb85fc", "patch": "@@ -38,7 +38,7 @@\n \n #include \"sketch/SketchInputContext.h\"\n \n-#include <calligraversion.h>\n+#include <kritaversion.h>\n #include <kritagitversion.h>\n \n #if defined Q_OS_WIN\n@@ -51,15 +51,15 @@\n \n int main( int argc, char** argv )\n {\n-    QString calligraVersion(CALLIGRA_VERSION_STRING);\n+    QString kritaVersion(KRITA_VERSION_STRING);\n     QString version;\n \n \n #ifdef KRITA_GIT_SHA1_STRING\n     QString gitVersion(KRITA_GIT_SHA1_STRING);\n-    version = QString(\"%1 (git %2)\").arg(calligraVersion).arg(gitVersion).toLatin1();\n+    version = QString(\"%1 (git %2)\").arg(kritaVersion).arg(gitVersion).toLatin1();\n #else\n-    version = calligraVersion;\n+    version = kritaVersion;\n #endif\n \n \n@@ -69,7 +69,7 @@ int main( int argc, char** argv )\n                          version.toLatin1(),\n                          ki18n(\"Krita Gemini: Painting at Home and on the Go for Artists\"),\n                          KAboutData::License_GPL,\n-                         ki18n(\"(c) 1999-%1 The Krita team.\\n\").subs(CALLIGRA_YEAR),\n+                         ki18n(\"(c) 1999-%1 The Krita team.\\n\").subs(KRITA_YEAR),\n                          KLocalizedString(),\n                          \"http://www.kritastudio.com\",\n                          \"submit@bugs.kde.org\");"}, {"sha": "a1107641dce24dfec8ef9929561e9e538b77ebb9", "filename": "krita/sketch/main.cpp", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/KDE/krita/blob/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/krita/sketch/main.cpp", "raw_url": "https://github.com/KDE/krita/raw/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/krita/sketch/main.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/sketch/main.cpp?ref=080dd9bf70089a6ff75b2b6167fb56f8facb85fc", "patch": "@@ -31,7 +31,7 @@\n #include \"KoGlobal.h\"\n #include <KoResourcePaths.h>\n \n-#include <calligraversion.h>\n+#include <kritaversion.h>\n #include <kritagitversion.h>\n #include <opengl/kis_opengl.h>\n #include <kis_icon.h>\n@@ -53,15 +53,15 @@\n \n int main( int argc, char** argv )\n {\n-    QString calligraVersion(CALLIGRA_VERSION_STRING);\n+    QString kritaVersion(KRITA_VERSION_STRING);\n     QString version;\n \n \n #ifdef KRITA_GIT_SHA1_STRING\n     QString gitVersion(KRITA_GIT_SHA1_STRING);\n-    version = QString(\"%1 (git %2)\").arg(calligraVersion).arg(gitVersion).toLatin1();\n+    version = QString(\"%1 (git %2)\").arg(kritaVersion).arg(gitVersion).toLatin1();\n #else\n-    version = calligraVersion;\n+    version = kritaVersion;\n #endif\n \n     KLocalizedString::setApplicationDomain(\"krita\");\n@@ -71,7 +71,7 @@ int main( int argc, char** argv )\n                          QStringLiteral(\"0.1\"),\n                          i18n(\"Krita Sketch: Painting on the Go for Artists\"),\n                          KAboutLicense::GPL,\n-                         i18n(\"(c) 1999-%1 The Krita team.\\n\").arg(CALLIGRA_YEAR),\n+                         i18n(\"(c) 1999-%1 The Krita team.\\n\").arg(KRITA_YEAR),\n                          QString(),\n                          QStringLiteral(\"https://www.krita.org\"),\n                          QStringLiteral(\"submit@bugs.kde.org\"));"}, {"sha": "7ec905e9d27ac5ae9d1480272757d7478edae8ed", "filename": "libs/ui/KisMainWindow.cpp", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/KDE/krita/blob/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/libs/ui/KisMainWindow.cpp", "raw_url": "https://github.com/KDE/krita/raw/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/libs/ui/KisMainWindow.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisMainWindow.cpp?ref=080dd9bf70089a6ff75b2b6167fb56f8facb85fc", "patch": "@@ -719,16 +719,16 @@ void KisMainWindow::updateCaption()\n void KisMainWindow::updateCaption(const QString & caption, bool mod)\n {\n     dbgUI << \"KisMainWindow::updateCaption(\" << caption << \",\" << mod << \")\";\n-#ifdef CALLIGRA_ALPHA\n-    setCaption(QString(\"ALPHA %1: %2\").arg(CALLIGRA_ALPHA).arg(caption), mod);\n+#ifdef KRITA_ALPHA\n+    setCaption(QString(\"ALPHA %1: %2\").arg(KRITA_ALPHA).arg(caption), mod);\n     return;\n #endif\n-#ifdef CALLIGRA_BETA\n-    setCaption(QString(\"BETA %1: %2\").arg(CALLIGRA_BETA).arg(caption), mod);\n+#ifdef KRITA_BETA\n+    setCaption(QString(\"BETA %1: %2\").arg(KRITA_BETA).arg(caption), mod);\n     return;\n #endif\n-#ifdef CALLIGRA_RC\n-    setCaption(QString(\"RELEASE CANDIDATE %1: %2\").arg(CALLIGRA_RC).arg(caption), mod);\n+#ifdef KRITA_RC\n+    setCaption(QString(\"RELEASE CANDIDATE %1: %2\").arg(KRITA_RC).arg(caption), mod);\n     return;\n #endif\n "}, {"sha": "62e125fc8e6b27d46373092974fe06249cc7d537", "filename": "libs/version/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/libs/version/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/libs/version/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/version/CMakeLists.txt?ref=080dd9bf70089a6ff75b2b6167fb56f8facb85fc", "patch": "@@ -1,11 +1,10 @@\n-# generate calligraversion.h\n-configure_file(calligraversion.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/calligraversion.h)\n+# generate kritaversion.h\n+configure_file(kritaversion.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/kritaversion.h)\n \n # generate kritagitversion.h\n configure_file(kritagitversion.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/kritagitversion.h)\n \n set(kritaversion_LIB_SRCS\n-    calligraversion.cpp\n     KritaVersionWrapper.cpp\n )\n "}, {"sha": "b46205c7b3dbf81077a67ad3c91069c3925b3711", "filename": "libs/version/KritaVersionWrapper.cpp", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/libs/version/KritaVersionWrapper.cpp", "raw_url": "https://github.com/KDE/krita/raw/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/libs/version/KritaVersionWrapper.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/version/KritaVersionWrapper.cpp?ref=080dd9bf70089a6ff75b2b6167fb56f8facb85fc", "patch": "@@ -17,18 +17,18 @@\n  */\n #include <KritaVersionWrapper.h>\n \n-#include <calligraversion.h>\n+#include <kritaversion.h>\n #include <kritagitversion.h>\n \n QString KritaVersionWrapper::versionString(bool checkGit)\n {\n-    QString calligraVersion(CALLIGRA_VERSION_STRING);\n-    QString version = calligraVersion;\n+    QString kritaVersion(KRITA_VERSION_STRING);\n+    QString version = kritaVersion;\n \n     if (checkGit) {\n #ifdef KRITA_GIT_SHA1_STRING\n         QString gitVersion(KRITA_GIT_SHA1_STRING);\n-        version = QString(\"%1 (git %2)\").arg(calligraVersion).arg(gitVersion).toLatin1();\n+        version = QString(\"%1 (git %2)\").arg(kritaVersion).arg(gitVersion).toLatin1();\n #endif\n     }\n     return version;"}, {"sha": "7e6a0eff18bca7b12f8bb0ec193bb6d0e52634af", "filename": "libs/version/calligraversion.cpp", "status": "removed", "additions": 0, "deletions": 20, "changes": 20, "blob_url": "https://github.com/KDE/krita/blob/d179a9676a82ed36ab04485c3476672b9b5084ef/libs/version/calligraversion.cpp", "raw_url": "https://github.com/KDE/krita/raw/d179a9676a82ed36ab04485c3476672b9b5084ef/libs/version/calligraversion.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/version/calligraversion.cpp?ref=d179a9676a82ed36ab04485c3476672b9b5084ef", "patch": "@@ -1,20 +0,0 @@\n-/* This file is part of the Calligra libraries\n-    Copyright (c) 2003 David Faure <faure@kde.org>\n-\n-    This library is free software; you can redistribute it and/or\n-    modify it under the terms of the GNU Library General Public\n-    License as published by the Free Software Foundation; either\n-    version 2 of the License, or (at your option) any later version.\n-\n-    This library is distributed in the hope that it will be useful,\n-    but WITHOUT ANY WARRANTY; without even the implied warranty of\n-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n-    Library General Public License for more details.\n-\n-    You should have received a copy of the GNU Library General Public License\n-    along with this library; see the file COPYING.LIB.  If not, write to\n-    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,\n- * Boston, MA 02110-1301, USA.\n-*/\n-\n-#include \"calligraversion.h\""}, {"sha": "49d2ba6970d1615eaac7e5fff04ed27e3457ec46", "filename": "libs/version/calligraversion.h.cmake", "status": "removed", "additions": 0, "deletions": 173, "changes": 173, "blob_url": "https://github.com/KDE/krita/blob/d179a9676a82ed36ab04485c3476672b9b5084ef/libs/version/calligraversion.h.cmake", "raw_url": "https://github.com/KDE/krita/raw/d179a9676a82ed36ab04485c3476672b9b5084ef/libs/version/calligraversion.h.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/version/calligraversion.h.cmake?ref=d179a9676a82ed36ab04485c3476672b9b5084ef", "patch": "@@ -1,173 +0,0 @@\n-/* This file is part of the Calligra libraries\n-    Copyright (c) 2003 David Faure <faure@kde.org>\n-    Copyright (c) 2003 Lukas Tinkl <lukas@kde.org>\n-    Copyright (c) 2004 Nicolas Goutte <goutte@kde.org>\n-    Copyright (C) 2015 Jaros\u0142aw Staniek <staniek@kde.org>\n-\n-    This library is free software; you can redistribute it and/or\n-    modify it under the terms of the GNU Library General Public\n-    License as published by the Free Software Foundation; either\n-    version 2 of the License, or (at your option) any later version.\n-\n-    This library is distributed in the hope that it will be useful,\n-    but WITHOUT ANY WARRANTY; without even the implied warranty of\n-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n-    Library General Public License for more details.\n-\n-    You should have received a copy of the GNU Library General Public License\n-    along with this library; see the file COPYING.LIB.  If not, write to\n-    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,\n- * Boston, MA 02110-1301, USA.\n-*/\n-\n-#ifndef _CALLIGRA_VERSION_H_\n-#define _CALLIGRA_VERSION_H_\n-\n-#include \"kritaversion_export.h\"\n-\n-// -- WARNING: do not edit values below, instead edit CALLIGRA_* in /CMakeLists.txt --\n-\n-/**\n-* @def CALLIGRA_VERSION_STRING\n-* @ingroup CalligraMacros\n-* @brief Version of Calligra as string, at compile time\n-*\n-* This macro contains the Calligra version in string form. As it is a macro,\n-* it contains the version at compile time. See Calligra::versionString() if you need\n-* the Calligra version used at runtime.\n-*\n-* @note The version string might contain spaces and special characters,\n-* especially for development versions of Calligra.\n-* If you use that macro directly for a file format (e.g. OASIS Open Document)\n-* or for a protocol (e.g. http) be careful that it is appropriate.\n-* (Fictional) example: \"3.0 Alpha\"\n-*/\n-#define CALLIGRA_VERSION_STRING \"@CALLIGRA_VERSION_STRING@\"\n-\n-/**\n- * @def CALLIGRA_STABLE_VERSION_MAJOR\n- * @ingroup CalligraMacros\n- * @brief Major version of stable Calligra, at compile time\n- * CALLIGRA_VERSION_MAJOR is computed based on this value.\n-*/\n-#define CALLIGRA_STABLE_VERSION_MAJOR @CALLIGRA_STABLE_VERSION_MAJOR@\n-\n-/**\n- * @def CALLIGRA_VERSION_MAJOR\n- * @ingroup CalligraMacros\n- * @brief Major version of Calligra, at compile time\n- *\n- * Generally it's the same as CALLIGRA_STABLE_VERSION_MAJOR but for unstable x.0\n- * x is decreased by one, e.g. 3.0 Beta is 2.99.\n-*/\n-#if !defined CALLIGRA_STABLE && @CALLIGRA_STABLE_VERSION_MINOR@ == 0\n-# define CALLIGRA_VERSION_MAJOR (CALLIGRA_STABLE_VERSION_MAJOR - 1)\n-#else\n-# define CALLIGRA_VERSION_MAJOR CALLIGRA_STABLE_VERSION_MAJOR\n-#endif\n-\n-/**\n- * @def CALLIGRA_STABLE_VERSION_MINOR\n- * @ingroup CalligraMacros\n- * @brief Minor version of stable Calligra, at compile time\n- * CALLIGRA_VERSION_MINOR is computed based on this value.\n- */\n-#define CALLIGRA_STABLE_VERSION_MINOR @CALLIGRA_STABLE_VERSION_MINOR@\n-\n-/**\n- * @def CALLIGRA_VERSION_MINOR\n- * @ingroup CalligraMacros\n- * @brief Minor version of Calligra, at compile time\n- *\n- * Generally it's equal to CALLIGRA_STABLE_VERSION_MINOR for stable releases,\n- * equal to 99 for x.0 unstable releases (e.g. it's 3.0 Beta has minor version 99),\n- * and equal to CALLIGRA_STABLE_VERSION_MINOR-1 for unstable releases other than x.0.\n- */\n-#ifdef CALLIGRA_STABLE\n-# define CALLIGRA_VERSION_MINOR CALLIGRA_STABLE_VERSION_MINOR\n-#elif CALLIGRA_STABLE_VERSION_MINOR == 0\n-# define CALLIGRA_VERSION_MINOR 99\n-#else\n-# define CALLIGRA_VERSION_MINOR (CALLIGRA_STABLE_VERSION_MINOR - 1)\n-#endif\n-\n-/**\n- * @def CALLIGRA_VERSION_RELEASE\n- * @ingroup CalligraMacros\n- * @brief Release version of Calligra, at compile time.\n- * 89 for Alpha.\n- */\n-#define CALLIGRA_VERSION_RELEASE @CALLIGRA_VERSION_RELEASE@\n-\n-/**\n- * @def CALLIGRA_STABLE_VERSION_RELEASE\n- * @ingroup CalligraMacros\n- * @brief Release version of Calligra, at compile time.\n- *\n- * Equal to CALLIGRA_VERSION_RELEASE for stable releases and 0 for unstable ones.\n- */\n-#ifdef CALLIGRA_STABLE\n-# define CALLIGRA_STABLE_VERSION_RELEASE 0\n-#else\n-# define CALLIGRA_STABLE_VERSION_RELEASE @CALLIGRA_VERSION_RELEASE@\n-#endif\n-\n-/**\n- * @def CALLIGRA_ALPHA\n- * @ingroup CalligraMacros\n- * @brief If defined (1..9), indicates at compile time that Calligra is in alpha stage\n- */\n-#cmakedefine CALLIGRA_ALPHA @CALLIGRA_ALPHA@\n-\n-/**\n- * @def CALLIGRA_BETA\n- * @ingroup CalligraMacros\n- * @brief If defined (1..9), indicates at compile time that Calligra is in beta stage\n- */\n-#cmakedefine CALLIGRA_BETA @CALLIGRA_BETA@\n-\n-/**\n- * @def CALLIGRA_RC\n- * @ingroup CalligraMacros\n- * @brief If defined (1..9), indicates at compile time that Calligra is in \"release candidate\" stage\n- */\n-#cmakedefine CALLIGRA_RC @CALLIGRA_RC@\n-\n-/**\n- * @def CALLIGRA_STABLE\n- * @ingroup CalligraMacros\n- * @brief If defined, indicates at compile time that Calligra is in stable stage\n- */\n-#cmakedefine CALLIGRA_STABLE @CALLIGRA_STABLE@\n-\n-/**\n- * @ingroup CalligraMacros\n- * @brief Make a number from the major, minor and release number of a Calligra version\n- *\n- * This function can be used for preprocessing when CALLIGRA_IS_VERSION is not\n- * appropriate.\n- */\n-#define CALLIGRA_MAKE_VERSION( a,b,c ) (((a) << 16) | ((b) << 8) | (c))\n-\n-/**\n- * @ingroup CalligraMacros\n- * @brief Version of Calligra as number, at compile time\n- *\n- * This macro contains the Calligra version in number form. As it is a macro,\n- * it contains the version at compile time. See version() if you need\n- * the Calligra version used at runtime.\n- */\n-#define CALLIGRA_VERSION \\\n-    CALLIGRA_MAKE_VERSION(CALLIGRA_VERSION_MAJOR,CALLIGRA_VERSION_MINOR,CALLIGRA_VERSION_RELEASE)\n-\n-/**\n- * @def CALLIGRA_YEAR\n- * @ingroup CalligraMacros\n- * @brief Year of the Calligra release, set at compile time\n- *\n- * This macro is used in \"About application\" dialog for strings such as \"\u00a9 2012-..., The Author Team\".\n-*/\n-#define CALLIGRA_YEAR \"@CALLIGRA_YEAR@\"\n-\n-\n-#endif // _CALLIGRA_VERSION_H_"}, {"sha": "d9f56ab0931796a467e4bbb03deec201da3a6639", "filename": "libs/version/kritaversion.h.cmake", "status": "added", "additions": 172, "deletions": 0, "changes": 172, "blob_url": "https://github.com/KDE/krita/blob/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/libs/version/kritaversion.h.cmake", "raw_url": "https://github.com/KDE/krita/raw/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/libs/version/kritaversion.h.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/version/kritaversion.h.cmake?ref=080dd9bf70089a6ff75b2b6167fb56f8facb85fc", "patch": "@@ -0,0 +1,172 @@\n+/* This file is part of the Krita libraries\n+    Copyright (c) 2003 David Faure <faure@kde.org>\n+    Copyright (c) 2003 Lukas Tinkl <lukas@kde.org>\n+    Copyright (c) 2004 Nicolas Goutte <goutte@kde.org>\n+    Copyright (C) 2015 Jaros\u0142aw Staniek <staniek@kde.org>\n+\n+    This library is free software; you can redistribute it and/or\n+    modify it under the terms of the GNU Library General Public\n+    License as published by the Free Software Foundation; either\n+    version 2 of the License, or (at your option) any later version.\n+\n+    This library is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+    Library General Public License for more details.\n+\n+    You should have received a copy of the GNU Library General Public License\n+    along with this library; see the file COPYING.LIB.  If not, write to\n+    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,\n+ * Boston, MA 02110-1301, USA.\n+*/\n+\n+#ifndef _KRITA_VERSION_H_\n+#define _KRITA_VERSION_H_\n+\n+#include \"kritaversion_export.h\"\n+\n+// -- WARNING: do not edit values below, instead edit KRITA_* in /CMakeLists.txt --\n+\n+/**\n+* @def KRITA_VERSION_STRING\n+* @ingroup KritaMacros\n+* @brief Version of Krita as string, at compile time\n+*\n+* This macro contains the Krita version in string form. As it is a macro,\n+* it contains the version at compile time.\n+*\n+* @note The version string might contain spaces and special characters,\n+* especially for development versions of Krita.\n+* If you use that macro directly for a file format (e.g. OASIS Open Document)\n+* or for a protocol (e.g. http) be careful that it is appropriate.\n+* (Fictional) example: \"3.0 Alpha\"\n+*/\n+#define KRITA_VERSION_STRING \"@KRITA_VERSION_STRING@\"\n+\n+/**\n+ * @def KRITA_STABLE_VERSION_MAJOR\n+ * @ingroup KritaMacros\n+ * @brief Major version of stable Krita, at compile time\n+ * KRITA_VERSION_MAJOR is computed based on this value.\n+*/\n+#define KRITA_STABLE_VERSION_MAJOR @KRITA_STABLE_VERSION_MAJOR@\n+\n+/**\n+ * @def KRITA_VERSION_MAJOR\n+ * @ingroup KritaMacros\n+ * @brief Major version of Krita, at compile time\n+ *\n+ * Generally it's the same as KRITA_STABLE_VERSION_MAJOR but for unstable x.0\n+ * x is decreased by one, e.g. 3.0 Beta is 2.99.\n+*/\n+#if !defined KRITA_STABLE && @KRITA_STABLE_VERSION_MINOR@ == 0\n+# define KRITA_VERSION_MAJOR (KRITA_STABLE_VERSION_MAJOR - 1)\n+#else\n+# define KRITA_VERSION_MAJOR KRITA_STABLE_VERSION_MAJOR\n+#endif\n+\n+/**\n+ * @def KRITA_STABLE_VERSION_MINOR\n+ * @ingroup KritaMacros\n+ * @brief Minor version of stable Krita, at compile time\n+ * KRITA_VERSION_MINOR is computed based on this value.\n+ */\n+#define KRITA_STABLE_VERSION_MINOR @KRITA_STABLE_VERSION_MINOR@\n+\n+/**\n+ * @def KRITA_VERSION_MINOR\n+ * @ingroup KritaMacros\n+ * @brief Minor version of Krita, at compile time\n+ *\n+ * Generally it's equal to KRITA_STABLE_VERSION_MINOR for stable releases,\n+ * equal to 99 for x.0 unstable releases (e.g. it's 3.0 Beta has minor version 99),\n+ * and equal to KRITA_STABLE_VERSION_MINOR-1 for unstable releases other than x.0.\n+ */\n+#ifdef KRITA_STABLE\n+# define KRITA_VERSION_MINOR KRITA_STABLE_VERSION_MINOR\n+#elif KRITA_STABLE_VERSION_MINOR == 0\n+# define KRITA_VERSION_MINOR 99\n+#else\n+# define KRITA_VERSION_MINOR (KRITA_STABLE_VERSION_MINOR - 1)\n+#endif\n+\n+/**\n+ * @def KRITA_VERSION_RELEASE\n+ * @ingroup KritaMacros\n+ * @brief Release version of Krita, at compile time.\n+ * 89 for Alpha.\n+ */\n+#define KRITA_VERSION_RELEASE @KRITA_VERSION_RELEASE@\n+\n+/**\n+ * @def KRITA_STABLE_VERSION_RELEASE\n+ * @ingroup KritaMacros\n+ * @brief Release version of Krita, at compile time.\n+ *\n+ * Equal to KRITA_VERSION_RELEASE for stable releases and 0 for unstable ones.\n+ */\n+#ifdef KRITA_STABLE\n+# define KRITA_STABLE_VERSION_RELEASE 0\n+#else\n+# define KRITA_STABLE_VERSION_RELEASE @KRITA_VERSION_RELEASE@\n+#endif\n+\n+/**\n+ * @def KRITA_ALPHA\n+ * @ingroup KritaMacros\n+ * @brief If defined (1..9), indicates at compile time that Krita is in alpha stage\n+ */\n+#cmakedefine KRITA_ALPHA @KRITA_ALPHA@\n+\n+/**\n+ * @def KRITA_BETA\n+ * @ingroup KritaMacros\n+ * @brief If defined (1..9), indicates at compile time that Krita is in beta stage\n+ */\n+#cmakedefine KRITA_BETA @KRITA_BETA@\n+\n+/**\n+ * @def KRITA_RC\n+ * @ingroup KritaMacros\n+ * @brief If defined (1..9), indicates at compile time that Krita is in \"release candidate\" stage\n+ */\n+#cmakedefine KRITA_RC @KRITA_RC@\n+\n+/**\n+ * @def KRITA_STABLE\n+ * @ingroup KritaMacros\n+ * @brief If defined, indicates at compile time that Krita is in stable stage\n+ */\n+#cmakedefine KRITA_STABLE @KRITA_STABLE@\n+\n+/**\n+ * @ingroup KritaMacros\n+ * @brief Make a number from the major, minor and release number of a Krita version\n+ *\n+ * This function can be used for preprocessing when KRITA_IS_VERSION is not\n+ * appropriate.\n+ */\n+#define KRITA_MAKE_VERSION( a,b,c ) (((a) << 16) | ((b) << 8) | (c))\n+\n+/**\n+ * @ingroup KritaMacros\n+ * @brief Version of Krita as number, at compile time\n+ *\n+ * This macro contains the Krita version in number form. As it is a macro,\n+ * it contains the version at compile time. See version() if you need\n+ * the Krita version used at runtime.\n+ */\n+#define KRITA_VERSION \\\n+    KRITA_MAKE_VERSION(KRITA_VERSION_MAJOR,KRITA_VERSION_MINOR,KRITA_VERSION_RELEASE)\n+\n+/**\n+ * @def KRITA_YEAR\n+ * @ingroup KritaMacros\n+ * @brief Year of the Krita release, set at compile time\n+ *\n+ * This macro is used in \"About application\" dialog for strings such as \"\u00a9 2012-..., The Author Team\".\n+*/\n+#define KRITA_YEAR \"@KRITA_YEAR@\"\n+\n+\n+#endif // _KRITA_VERSION_H_"}, {"sha": "9ff1ba97bafea48c2c7eaae2f2317927874aac19", "filename": "windows/makepkg-32.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/windows/makepkg-32.sh", "raw_url": "https://github.com/KDE/krita/raw/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/windows/makepkg-32.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/makepkg-32.sh?ref=080dd9bf70089a6ff75b2b6167fb56f8facb85fc", "patch": "@@ -12,7 +12,7 @@ APP=krita\n \n cd $BUILDROOT\n \n-VER=$(grep \"#define CALLIGRA_VERSION_STRING\" /build/libs/version/calligraversion.h | cut -d '\"' -f 2)\n+VER=$(grep \"#define KRITA_VERSION_STRING\" /build/libs/version/kritaversion.h | cut -d '\"' -f 2)\n cd $BUILDROOT/krita\n BRANCH=$( git branch | cut -d ' ' -f 2)\n REVISION=$(git rev-parse --short HEAD)"}, {"sha": "5f41d5a22f7b7fe30126b1fe858e8bb288b17a9f", "filename": "windows/makepkg-64.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/windows/makepkg-64.sh", "raw_url": "https://github.com/KDE/krita/raw/080dd9bf70089a6ff75b2b6167fb56f8facb85fc/windows/makepkg-64.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/makepkg-64.sh?ref=080dd9bf70089a6ff75b2b6167fb56f8facb85fc", "patch": "@@ -12,7 +12,7 @@ APP=krita\n \n cd $BUILDROOT\n \n-VER=$(grep \"#define CALLIGRA_VERSION_STRING\" /build/libs/version/calligraversion.h | cut -d '\"' -f 2)\n+VER=$(grep \"#define KRITA_VERSION_STRING\" /build/libs/version/kritaversion.h | cut -d '\"' -f 2)\n cd $BUILDROOT/krita\n BRANCH=$( git branch | cut -d ' ' -f 2)\n REVISION=$(git rev-parse --short HEAD)"}]}, {"sha": "d179a9676a82ed36ab04485c3476672b9b5084ef", "stats": {"total": 4, "additions": 0, "deletions": 4}, "files": [{"sha": "c87e388285fb53207c316a5aeacdda11a93f90c2", "filename": "libs/global/kis_global.h", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/d179a9676a82ed36ab04485c3476672b9b5084ef/libs/global/kis_global.h", "raw_url": "https://github.com/KDE/krita/raw/d179a9676a82ed36ab04485c3476672b9b5084ef/libs/global/kis_global.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/global/kis_global.h?ref=d179a9676a82ed36ab04485c3476672b9b5084ef", "patch": "@@ -21,16 +21,12 @@\n \n #include <limits.h>\n \n-#include <calligraversion.h>\n-\n #include <KoConfig.h>\n #include \"kis_assert.h\"\n \n #include <QPoint>\n #include <QPointF>\n \n-#define KRITA_VERSION CALLIGRA_VERSION\n-\n const quint8 quint8_MAX = UCHAR_MAX;\n const quint16 quint16_MAX = 65535;\n "}]}, {"sha": "eebc5abbe9f0d38d09f7be578489899e6c5269f3", "stats": {"total": 89, "additions": 0, "deletions": 89}, "files": [{"sha": "7e6a0eff18bca7b12f8bb0ec193bb6d0e52634af", "filename": "libs/version/calligraversion.cpp", "status": "modified", "additions": 0, "deletions": 25, "changes": 25, "blob_url": "https://github.com/KDE/krita/blob/eebc5abbe9f0d38d09f7be578489899e6c5269f3/libs/version/calligraversion.cpp", "raw_url": "https://github.com/KDE/krita/raw/eebc5abbe9f0d38d09f7be578489899e6c5269f3/libs/version/calligraversion.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/version/calligraversion.cpp?ref=eebc5abbe9f0d38d09f7be578489899e6c5269f3", "patch": "@@ -18,28 +18,3 @@\n */\n \n #include \"calligraversion.h\"\n-\n-unsigned int Calligra::version()\n-{\n-    return CALLIGRA_VERSION;\n-}\n-\n-unsigned int Calligra::versionMajor()\n-{\n-    return CALLIGRA_VERSION_MAJOR;\n-}\n-\n-unsigned int Calligra::versionMinor()\n-{\n-    return CALLIGRA_VERSION_MINOR;\n-}\n-\n-unsigned int Calligra::versionRelease()\n-{\n-    return CALLIGRA_VERSION_RELEASE;\n-}\n-\n-const char *Calligra::versionString()\n-{\n-    return CALLIGRA_VERSION_STRING;\n-}"}, {"sha": "49d2ba6970d1615eaac7e5fff04ed27e3457ec46", "filename": "libs/version/calligraversion.h.cmake", "status": "modified", "additions": 0, "deletions": 64, "changes": 64, "blob_url": "https://github.com/KDE/krita/blob/eebc5abbe9f0d38d09f7be578489899e6c5269f3/libs/version/calligraversion.h.cmake", "raw_url": "https://github.com/KDE/krita/raw/eebc5abbe9f0d38d09f7be578489899e6c5269f3/libs/version/calligraversion.h.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/version/calligraversion.h.cmake?ref=eebc5abbe9f0d38d09f7be578489899e6c5269f3", "patch": "@@ -161,29 +161,6 @@\n     CALLIGRA_MAKE_VERSION(CALLIGRA_VERSION_MAJOR,CALLIGRA_VERSION_MINOR,CALLIGRA_VERSION_RELEASE)\n \n /**\n- * @ingroup CalligraMacros\n- * @brief Check if the Calligra version matches a certain version or is higher\n- *\n- * This macro is typically used to compile conditionally a part of code:\n- * @code\n- * #if CALLIGRA_IS_VERSION(2,3,0)\n- * // Code for Calligra 2.3.0\n- * #else\n- * // Code for older Calligra\n- * #endif\n- * @endcode\n- *\n- * @warning Especially during development phases of Calligra, be careful\n- * when choosing the version number that you are checking against.\n- * Otherwise you might risk to break the next Calligra release.\n- * Therefore be careful that development version have a\n- * version number lower than the released version, so do not check\n- * e.g. for Calligra 4.3 with CALLIGRA_IS_VERSION(4,3,0)\n- * but with the actual version number at a time a needed feature was introduced, e.g. 4.3.2.\n- */\n-#define CALLIGRA_IS_VERSION(a,b,c) ( CALLIGRA_VERSION >= CALLIGRA_MAKE_VERSION(a,b,c) )\n-\n-/**\n  * @def CALLIGRA_YEAR\n  * @ingroup CalligraMacros\n  * @brief Year of the Calligra release, set at compile time\n@@ -192,46 +169,5 @@\n */\n #define CALLIGRA_YEAR \"@CALLIGRA_YEAR@\"\n \n-/**\n- * Namespace for general Calligra functions.\n- */\n-namespace Calligra\n-{\n-/**\n- * Returns the encoded number of Calligra's version, see the CALLIGRA_VERSION macro.\n- * In contrary to that macro this function returns the number of the actually\n- * installed Calligra version, not the number of the Calligra version that was\n- * installed when the program was compiled.\n- * @return the version number, encoded in a single uint\n- */\n-KRITAVERSION_EXPORT unsigned int version();\n-\n-/**\n- * Returns the major number of Calligra's version, e.g.\n- * 1 for Calligra 1.2.3.\n- * @return the major version number\n- */\n-KRITAVERSION_EXPORT unsigned int versionMajor();\n-\n-/**\n- * Returns the minor number of Calligra's version, e.g.\n- * 2 for Calligra 1.2.3.\n- * @return the minor version number\n- */\n-KRITAVERSION_EXPORT unsigned int versionMinor();\n-\n-/**\n- * Returns the release of Calligra's version, e.g.\n- * 3 for Calligra 1.2.3.\n- * @return the release number\n- */\n-KRITAVERSION_EXPORT unsigned int versionRelease();\n-\n-/**\n- * Returns the Calligra version as string, e.g. \"1.2.3\".\n- * @return the Calligra version. You can keep the string forever.\n- */\n-KRITAVERSION_EXPORT const char *versionString();\n-}\n \n #endif // _CALLIGRA_VERSION_H_"}]}, {"sha": "5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "stats": {"total": 266, "additions": 133, "deletions": 133}, "files": [{"sha": "ffb3660a338733ada3fa4aae4b856d6a2ca60517", "filename": "CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -369,7 +369,7 @@ if(WIN32)\n endif()\n \n # set custom krita plugin installdir\n-set(CALLIGRA_PLUGIN_INSTALL_DIR ${LIB_INSTALL_DIR}/kritaplugins)\n+set(KRITA_PLUGIN_INSTALL_DIR ${LIB_INSTALL_DIR}/kritaplugins)\n \n  ###########################\n ############################"}, {"sha": "181df785a297daad92e46868a84c9125ead68962", "filename": "libs/basicflakes/plugin/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/libs/basicflakes/plugin/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/libs/basicflakes/plugin/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/basicflakes/plugin/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -13,4 +13,4 @@ ki18n_wrap_ui(basicflakesplugin_SRCS\n \n add_library(krita_tool_basicflakes MODULE ${basicflakesplugin_SRCS})\n target_link_libraries(krita_tool_basicflakes kritaflake kritabasicflakes)\n-install(TARGETS krita_tool_basicflakes DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS krita_tool_basicflakes DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "0d7e393459081aa943c5281e7562df821be34764", "filename": "libs/ui/resourcemanager/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/libs/ui/resourcemanager/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/libs/ui/resourcemanager/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/resourcemanager/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -15,5 +15,5 @@ ki18n_wrap_ui(kritaresourcemanager_SOURCES\n \n add_library(kritaresourcemanager MODULE ${kritaresourcemanager_SOURCES})\n target_link_libraries(kritaresourcemanager kritawidgets kritaui kritalibpaintop)\n-install(TARGETS kritaresourcemanager  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaresourcemanager  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install(FILES resourcemanager.xmlgui  DESTINATION ${DATA_INSTALL_DIR}/kritaplugins)"}, {"sha": "4fbe5e068f4a99cc7211ebe4bfda8d9585f0898f", "filename": "plugins/assistants/RulerAssistant/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/assistants/RulerAssistant/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/assistants/RulerAssistant/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/assistants/RulerAssistant/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -21,6 +21,6 @@ add_library(kritarulerassistanttool MODULE ${kritarulerassistanttool_SOURCES})\n \n target_link_libraries(kritarulerassistanttool kritaui kritaflake   )\n \n-install(TARGETS kritarulerassistanttool  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritarulerassistanttool  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n install( FILES krita_tool_ruler_assistant.png dark_krita_tool_ruler_assistant.png light_krita_tool_ruler_assistant.png DESTINATION ${DATA_INSTALL_DIR}/krita/pics)"}, {"sha": "ee8033afed8d53228e9634b27457db03da62fede", "filename": "plugins/color/colorspaceextensions/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/color/colorspaceextensions/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/color/colorspaceextensions/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/color/colorspaceextensions/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -13,4 +13,4 @@ set( extensions_plugin_SOURCES\n \n add_library(krita_colorspaces_extensions MODULE ${extensions_plugin_SOURCES} )\n target_link_libraries(krita_colorspaces_extensions kritapigment kritaglobal ${OPENEXR_LIBRARIES} KF5::I18n KF5::CoreAddons)\n-install( TARGETS krita_colorspaces_extensions DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR} )\n+install( TARGETS krita_colorspaces_extensions DESTINATION ${KRITA_PLUGIN_INSTALL_DIR} )"}, {"sha": "0292c1e27aebf705e731c2b1b51feaefeb7d868e", "filename": "plugins/color/lcms2engine/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/color/lcms2engine/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/color/lcms2engine/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/color/lcms2engine/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -93,5 +93,5 @@ endif ()\n add_library(kritalcmsengine MODULE ${lcmsengine_SRCS})\n \n target_link_libraries(kritalcmsengine kritapigment kritawidgetutils KF5::I18n KF5::CoreAddons ${LCMS2_LIBRARIES}  ${LINK_OPENEXR_LIB})\n-install(TARGETS kritalcmsengine DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritalcmsengine DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n "}, {"sha": "2a8bf9bd19fe6b6da9e5dc67764d11cba3b5743b", "filename": "plugins/dockers/advancedcolorselector/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/advancedcolorselector/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/advancedcolorselector/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/advancedcolorselector/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -38,7 +38,7 @@ add_library(kritacolorselectorng MODULE ${KRITA_COLORSELECTORNG_SOURCES})\n \n target_link_libraries(kritacolorselectorng kritaui)\n \n-install(TARGETS kritacolorselectorng  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritacolorselectorng  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n install( FILES  kis_colselng_color_patches.png\n \t\tkis_colselng_color_triangle.png"}, {"sha": "001c41308bb5bd303b07c2ae4d8305e7bf49bfca", "filename": "plugins/dockers/animation/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/animation/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/animation/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/animation/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -41,6 +41,6 @@ add_library(kritaanimationdocker MODULE ${KRITA_ANIMATIONDOCKER_SOURCES})\n \n generate_export_header(kritaanimationdocker BASE_NAME kritaanimationdocker EXPORT_MACRO_NAME KRITAANIMATIONDOCKER_EXPORT)\n target_link_libraries(kritaanimationdocker kritaui)\n-install(TARGETS kritaanimationdocker  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaanimationdocker  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n "}, {"sha": "3483ead3b397711c19a3001d7af3dd109bcec8ec", "filename": "plugins/dockers/artisticcolorselector/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/artisticcolorselector/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/artisticcolorselector/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/artisticcolorselector/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -12,4 +12,4 @@ ki18n_wrap_ui(kritaartisticcolorselector_SOURCES\n \n add_library(kritaartisticcolorselector MODULE ${kritaartisticcolorselector_SOURCES})\n target_link_libraries(kritaartisticcolorselector kritaui)\n-install(TARGETS kritaartisticcolorselector DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaartisticcolorselector DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "9ee0be006946b93dd21a56a8df8f4cbcad2b929c", "filename": "plugins/dockers/channeldocker/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/channeldocker/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/channeldocker/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/channeldocker/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -1,4 +1,4 @@\n set(KRITA_CHANNELDOCKER_SOURCES channelmodel.cpp channeldocker.cpp channeldocker_dock.cpp )\n add_library(kritachanneldocker MODULE ${KRITA_CHANNELDOCKER_SOURCES})\n target_link_libraries(kritachanneldocker kritaui)\n-install(TARGETS kritachanneldocker  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritachanneldocker  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "1e5cdf1c0214fb67f56b8277e6abb636cced0a60", "filename": "plugins/dockers/colorslider/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/colorslider/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/colorslider/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/colorslider/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -10,4 +10,4 @@ set(kritacolorslider_SOURCES\n \n add_library(kritacolorslider MODULE ${kritacolorslider_SOURCES})\n target_link_libraries(kritacolorslider kritaui ${OPENEXR_LIBRARIES})\n-install(TARGETS kritacolorslider  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritacolorslider  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "7be1662d020362a6df39e2148040ce4fefe9e4cf", "filename": "plugins/dockers/compositiondocker/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/compositiondocker/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/compositiondocker/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/compositiondocker/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -6,4 +6,4 @@ ki18n_wrap_ui(KRITA_COMPOSITIONDOCKER_SOURCES\n \n add_library(kritacompositiondocker MODULE ${KRITA_COMPOSITIONDOCKER_SOURCES})\n target_link_libraries(kritacompositiondocker  kritaui)\n-install(TARGETS kritacompositiondocker  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritacompositiondocker  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "70b6ef4366f35f3e4b0398e67b969f165b1c63fa", "filename": "plugins/dockers/defaultdockers/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/defaultdockers/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/defaultdockers/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/defaultdockers/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -18,4 +18,4 @@ ki18n_wrap_ui(kritadefaultdockers_SOURCES\n add_library(kritadefaultdockers MODULE ${kritadefaultdockers_SOURCES} ${kritadefaultdockers_PART_HEADERS})\n generate_export_header(kritadefaultdockers BASE_NAME kritadefaultdockers EXPORT_MACRO_NAME KRITADEFAULTDOCKERS_EXPORT)\n target_link_libraries(kritadefaultdockers kritaui)\n-install(TARGETS kritadefaultdockers  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritadefaultdockers  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "c14a44aaccc389f4cdac2906bc40f2eaa1c9f94c", "filename": "plugins/dockers/digitalmixer/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/digitalmixer/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/digitalmixer/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/digitalmixer/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -1,4 +1,4 @@\n set(KRITA_DIGITALMIXER_SOURCES digitalmixer.cc digitalmixer_dock.cc )\n add_library(kritadigitalmixer MODULE ${KRITA_DIGITALMIXER_SOURCES})\n target_link_libraries(kritadigitalmixer kritaui)\n-install(TARGETS kritadigitalmixer  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritadigitalmixer  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "71832606ac82b779e15e293376d96c09d60a13ed", "filename": "plugins/dockers/griddocker/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/griddocker/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/griddocker/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/griddocker/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -10,4 +10,4 @@ ki18n_wrap_ui(KRITA_GRIDDOCKER_SOURCES\n \n add_library(kritagriddocker MODULE ${KRITA_GRIDDOCKER_SOURCES})\n target_link_libraries(kritagriddocker kritaui)\n-install(TARGETS kritagriddocker  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritagriddocker  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "d89cec45739392eb69897340a88f44e86b09f960", "filename": "plugins/dockers/historydocker/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/historydocker/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/historydocker/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/historydocker/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -11,4 +11,4 @@ set(kritahistorydocker_SOURCES\n \n add_library(kritahistorydocker MODULE ${kritahistorydocker_SOURCES})\n target_link_libraries(kritahistorydocker kritaimage kritaui)\n-install(TARGETS kritahistorydocker  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritahistorydocker  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "128c936f4beb38d1c8f6d491799ebdc8aa6c525e", "filename": "plugins/dockers/imagedocker/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/imagedocker/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/imagedocker/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/imagedocker/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -8,4 +8,4 @@ set(kritaimagedocker_SOURCES\n ki18n_wrap_ui(kritaimagedocker_SOURCES forms/wdgimagedocker.ui forms/wdgImageViewPopup.ui)\n add_library(kritaimagedocker MODULE ${kritaimagedocker_SOURCES})\n target_link_libraries(kritaimagedocker kritaui)\n-install(TARGETS kritaimagedocker DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaimagedocker DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "12c4aaed9323f686036e444d5dfc9ca78edb6375", "filename": "plugins/dockers/lut/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/lut/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/lut/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/lut/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -21,4 +21,4 @@ add_library(kritalutdocker MODULE ${KRITA_LUTDOCKER_SOURCES})\n \n generate_export_header(kritalutdocker BASE_NAME kritalutdocker)\n target_link_libraries(kritalutdocker kritaui ${Boost_SYSTEM_LIBRARY} ${OCIO_LIBRARIES})\n-install(TARGETS kritalutdocker  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritalutdocker  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "c78c8a6e961fa115a3f04fadf3c906657484ab4f", "filename": "plugins/dockers/overview/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/overview/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/overview/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/overview/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -1,4 +1,4 @@\n set(KRITA_OVERVIEWDOCKER_SOURCES overviewdocker.cpp overviewdocker_dock.cpp overviewwidget.cc )\n add_library(kritaoverviewdocker MODULE ${KRITA_OVERVIEWDOCKER_SOURCES})\n target_link_libraries(kritaoverviewdocker kritaui)\n-install(TARGETS kritaoverviewdocker  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaoverviewdocker  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "f665f8af2b85d03b654fd6b4e9653498af271fc3", "filename": "plugins/dockers/palettedocker/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/palettedocker/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/palettedocker/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/palettedocker/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -6,4 +6,4 @@ ki18n_wrap_ui(KRITA_PALETTEDOCKER_SOURCES\n \n add_library(kritapalettedocker MODULE ${KRITA_PALETTEDOCKER_SOURCES})\n target_link_libraries(kritapalettedocker kritaui)\n-install(TARGETS kritapalettedocker  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritapalettedocker  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "85f5787ad6db744230cb6d2031921e92376c4f7d", "filename": "plugins/dockers/patterndocker/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/patterndocker/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/patterndocker/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/patterndocker/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -1,4 +1,4 @@\n set(KRITA_PATTERNDOCKER_SOURCES patterndocker.cpp patterndocker_dock.cpp )\n add_library(kritapatterndocker MODULE ${KRITA_PATTERNDOCKER_SOURCES})\n target_link_libraries(kritapatterndocker kritaui)\n-install(TARGETS kritapatterndocker  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritapatterndocker  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "8cd901bd7b2188edb16bb09028fb4b8f6292abac", "filename": "plugins/dockers/presetdocker/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/presetdocker/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/presetdocker/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/presetdocker/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -1,4 +1,4 @@\n set(KRITA_PRESETDOCKER_SOURCES presetdocker.cpp presetdocker_dock.cpp )\n add_library(kritapresetdocker MODULE ${KRITA_PRESETDOCKER_SOURCES})\n target_link_libraries(kritapresetdocker kritaui)\n-install(TARGETS kritapresetdocker  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritapresetdocker  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "5c3da88925ca01710096541ce74756d98c995637", "filename": "plugins/dockers/presethistory/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/presethistory/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/presethistory/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/presethistory/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -5,5 +5,5 @@ set(KRITA_PRESETHISTORY_SOURCES\n \n add_library(kritapresethistory MODULE ${KRITA_PRESETHISTORY_SOURCES})\n target_link_libraries(kritapresethistory kritaui)\n-install(TARGETS kritapresethistory  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritapresethistory  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n "}, {"sha": "5dffd82eb3a5f8694785bf16b6d6d121ab577823", "filename": "plugins/dockers/shapedockers/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/shapedockers/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/shapedockers/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/shapedockers/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -17,4 +17,4 @@ add_library(krita_docker_defaults MODULE ${calligradockers_SRCS})\n \n target_link_libraries(krita_docker_defaults kritawidgets)\n \n-install(TARGETS krita_docker_defaults DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS krita_docker_defaults DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "cabb03c1f194d324aa581ecdb38815bf10e6394c", "filename": "plugins/dockers/smallcolorselector/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/smallcolorselector/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/smallcolorselector/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/smallcolorselector/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -1,4 +1,4 @@\n set(KRITA_smallCOLORSELECTOR_SOURCES smallcolorselector.cc smallcolorselector_dock.cc kis_small_color_widget.cc )\n add_library(kritasmallcolorselector MODULE ${KRITA_smallCOLORSELECTOR_SOURCES})\n target_link_libraries(kritasmallcolorselector kritaui)\n-install(TARGETS kritasmallcolorselector  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritasmallcolorselector  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "98359c542f9807cb52969fe6dc4d2a99586ef608", "filename": "plugins/dockers/specificcolorselector/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/specificcolorselector/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/specificcolorselector/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/specificcolorselector/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -1,4 +1,4 @@\n set(KRITA_SPECIFICCOLORSELECTOR_SOURCES specificcolorselector.cc specificcolorselector_dock.cc kis_specific_color_selector_widget.cc kis_color_input.cc )\n add_library(kritaspecificcolorselector MODULE ${KRITA_SPECIFICCOLORSELECTOR_SOURCES})\n target_link_libraries(kritaspecificcolorselector kritaui ${OPENEXR_LIBRARIES})\n-install(TARGETS kritaspecificcolorselector  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaspecificcolorselector  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "a4a9eef3dbf90e6936ba47c2bb9fdd4196f9c94c", "filename": "plugins/dockers/tasksetdocker/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/tasksetdocker/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/dockers/tasksetdocker/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/tasksetdocker/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -5,4 +5,4 @@ ki18n_wrap_ui(KRITA_TASKSETDOCKER_SOURCES\n )\n add_library(kritatasksetdocker MODULE ${KRITA_TASKSETDOCKER_SOURCES})\n target_link_libraries(kritatasksetdocker kritaui)\n-install(TARGETS kritatasksetdocker  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritatasksetdocker  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "6510562d103f0ed6244d7f2b550905a6c8005fea", "filename": "plugins/extensions/bigbrother/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/bigbrother/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/bigbrother/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/bigbrother/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -9,5 +9,5 @@ ki18n_wrap_ui(kritabigbrother_SOURCES\n \n add_library(kritabigbrother MODULE ${kritabigbrother_SOURCES})\n target_link_libraries(kritabigbrother kritaui)\n-install(TARGETS kritabigbrother  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritabigbrother  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES  bigbrother.xmlgui  DESTINATION ${DATA_INSTALL_DIR}/kritaplugins)"}, {"sha": "9071e666ea45755734c9b13e396a8cf934fb8af6", "filename": "plugins/extensions/clonesarray/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/clonesarray/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/clonesarray/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/clonesarray/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -6,5 +6,5 @@ set(kritaclonesarray_SOURCES\n ki18n_wrap_ui(kritaclonesarray_SOURCES wdg_clonesarray.ui )\n add_library(kritaclonesarray MODULE ${kritaclonesarray_SOURCES})\n target_link_libraries(kritaclonesarray kritaui)\n-install(TARGETS kritaclonesarray  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaclonesarray  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES  clonesarray.xmlgui  DESTINATION ${DATA_INSTALL_DIR}/kritaplugins)"}, {"sha": "9c12875c97977b93cee38ff7fbc551c4ae9113dc", "filename": "plugins/extensions/colorrange/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/colorrange/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/colorrange/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/colorrange/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -2,5 +2,5 @@ set(kritacolorrange_SOURCES colorrange.cc dlg_colorrange.cc )\n ki18n_wrap_ui(kritacolorrange_SOURCES wdg_colorrange.ui )\n add_library(kritacolorrange MODULE ${kritacolorrange_SOURCES})\n target_link_libraries(kritacolorrange kritaui)\n-install(TARGETS kritacolorrange  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritacolorrange  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES  colorrange.xmlgui  DESTINATION ${DATA_INSTALL_DIR}/kritaplugins)"}, {"sha": "5bb991cd411c8199983f6a48132d46d644c6c9e1", "filename": "plugins/extensions/colorspaceconversion/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/colorspaceconversion/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/colorspaceconversion/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/colorspaceconversion/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -2,5 +2,5 @@ set(kritacolorspaceconversion_SOURCES colorspaceconversion.cc dlg_colorspaceconv\n ki18n_wrap_ui(kritacolorspaceconversion_SOURCES wdgconvertcolorspace.ui )\n add_library(kritacolorspaceconversion MODULE ${kritacolorspaceconversion_SOURCES})\n target_link_libraries(kritacolorspaceconversion kritaui)\n-install(TARGETS kritacolorspaceconversion  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritacolorspaceconversion  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES  colorspaceconversion.xmlgui  DESTINATION ${DATA_INSTALL_DIR}/kritaplugins)"}, {"sha": "de098bcd7f143c77b1d890b84c5d6643995aae89", "filename": "plugins/extensions/gmic/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/gmic/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/gmic/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/gmic/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -183,7 +183,7 @@ target_link_libraries(gmicparser Qt5::Core Qt5::Gui Qt5::Network kritaui gmic ${\n ########### install files ###############\n set(GMIC_INSTALL_DIR ${DATA_INSTALL_DIR}/krita/gmic)\n \n-install(TARGETS kritagmic  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritagmic  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install(TARGETS gmicparser  ${INSTALL_TARGETS_DEFAULT_ARGS})\n \n install( FILES  gmic.xmlgui DESTINATION ${DATA_INSTALL_DIR}/kritaplugins)"}, {"sha": "9666edfd2da05640a9ec954574779ac9a70446d1", "filename": "plugins/extensions/histogram/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/histogram/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/histogram/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/histogram/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -2,5 +2,5 @@ set(kritahistogram_SOURCES histogram.cc dlg_histogram.cc kis_histogram_widget.cc\n ki18n_wrap_ui(kritahistogram_SOURCES wdghistogram.ui )\n add_library(kritahistogram MODULE ${kritahistogram_SOURCES})\n target_link_libraries(kritahistogram kritaui)\n-install(TARGETS kritahistogram  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritahistogram  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES  histogram.xmlgui  DESTINATION ${DATA_INSTALL_DIR}/kritaplugins)"}, {"sha": "e77ad224417c5e0479eacb4480876e3776f2684e", "filename": "plugins/extensions/imagesize/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/imagesize/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/imagesize/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/imagesize/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -16,5 +16,5 @@ ki18n_wrap_ui(kritaimagesize_SOURCES\n \n add_library(kritaimagesize MODULE ${kritaimagesize_SOURCES})\n target_link_libraries(kritaimagesize kritaui)\n-install(TARGETS kritaimagesize  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaimagesize  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES  imagesize.xmlgui  DESTINATION ${DATA_INSTALL_DIR}/kritaplugins)"}, {"sha": "69329fda10d85f69405bda6172180d91d5a04080", "filename": "plugins/extensions/imagesplit/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/imagesplit/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/imagesplit/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/imagesplit/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -10,5 +10,5 @@ ki18n_wrap_ui(kritaimagesplit_SOURCES\n \n add_library(kritaimagesplit MODULE ${kritaimagesplit_SOURCES})\n target_link_libraries(kritaimagesplit kritaui)\n-install(TARGETS kritaimagesplit  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaimagesplit  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES  imagesplit.xmlgui  DESTINATION ${DATA_INSTALL_DIR}/kritaplugins)"}, {"sha": "4e5710b6b40b6db1a43c3c2a2ac337833061c954", "filename": "plugins/extensions/layergroupswitcher/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/layergroupswitcher/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/layergroupswitcher/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/layergroupswitcher/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -4,4 +4,4 @@ set(kritalayergroupswitcher_SOURCES\n \n add_library(kritalayergroupswitcher MODULE ${kritalayergroupswitcher_SOURCES})\n target_link_libraries(kritalayergroupswitcher kritaui)\n-install(TARGETS kritalayergroupswitcher  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritalayergroupswitcher  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "843219f59fd1c433bab0b27ace5ebeafe25e1361", "filename": "plugins/extensions/layersplit/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/layersplit/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/layersplit/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/layersplit/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -10,5 +10,5 @@ ki18n_wrap_ui(kritalayersplit_SOURCES\n \n add_library(kritalayersplit MODULE ${kritalayersplit_SOURCES})\n target_link_libraries(kritalayersplit kritaui)\n-install(TARGETS kritalayersplit  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritalayersplit  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES  layersplit.xmlgui  DESTINATION ${DATA_INSTALL_DIR}/kritaplugins)"}, {"sha": "c9987061918e73cf63776958adaa5742d0e722ea", "filename": "plugins/extensions/metadataeditor/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/metadataeditor/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/metadataeditor/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/metadataeditor/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -9,6 +9,6 @@ ki18n_wrap_ui(kritametadataeditor_SOURCES\n \n add_library(kritametadataeditor MODULE ${kritametadataeditor_SOURCES})\n target_link_libraries(kritametadataeditor kritaui )\n-install(TARGETS kritametadataeditor  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritametadataeditor  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES metadataeditor.xmlgui DESTINATION ${DATA_INSTALL_DIR}/kritaplugins )\n install( FILES editors/dublincore.xmlgui editors/exif.xmlgui DESTINATION ${DATA_INSTALL_DIR}/kritaplugins/metadataeditor )"}, {"sha": "297724be877dc6ffaa1d63307652b772858245f3", "filename": "plugins/extensions/modify_selection/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/modify_selection/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/modify_selection/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/modify_selection/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -17,5 +17,5 @@ ki18n_wrap_ui(kritamodifyselection_SOURCES\n \n add_library(kritamodifyselection MODULE ${kritamodifyselection_SOURCES})\n target_link_libraries(kritamodifyselection kritaui)\n-install(TARGETS kritamodifyselection  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritamodifyselection  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES  modify_selection.xmlgui  DESTINATION ${DATA_INSTALL_DIR}/kritaplugins)"}, {"sha": "f0a078c9bd7231ab158cec5b49ab34fdfb4338c5", "filename": "plugins/extensions/offsetimage/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/offsetimage/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/offsetimage/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/offsetimage/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -7,5 +7,5 @@ set(kritaoffsetimage_SOURCES\n ki18n_wrap_ui(kritaoffsetimage_SOURCES wdg_offsetimage.ui )\n add_library(kritaoffsetimage MODULE ${kritaoffsetimage_SOURCES})\n target_link_libraries(kritaoffsetimage kritaui)\n-install(TARGETS kritaoffsetimage  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaoffsetimage  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES  offsetimage.xmlgui  DESTINATION ${DATA_INSTALL_DIR}/kritaplugins)"}, {"sha": "fc446a64ff8d41f3a47b0744a492a1a25294a832", "filename": "plugins/extensions/resourcemanager/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/resourcemanager/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/resourcemanager/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/resourcemanager/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -11,5 +11,5 @@ ki18n_wrap_ui(kritaresourcemanager_SOURCES\n \n add_library(kritaresourcemanager MODULE ${kritaresourcemanager_SOURCES})\n target_link_libraries(kritaresourcemanager kritawidgets kritaui kritalibpaintop)\n-install(TARGETS kritaresourcemanager  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaresourcemanager  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install(FILES resourcemanager.xmlgui  DESTINATION ${DATA_INSTALL_DIR}/kritaplugins)"}, {"sha": "4b7c08cd5b03a8d64c3186e62d0b4478739f7717", "filename": "plugins/extensions/rotateimage/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/rotateimage/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/rotateimage/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/rotateimage/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -2,5 +2,5 @@ set(kritarotateimage_SOURCES rotateimage.cc dlg_rotateimage.cc )\n ki18n_wrap_ui(kritarotateimage_SOURCES wdg_rotateimage.ui )\n add_library(kritarotateimage MODULE ${kritarotateimage_SOURCES})\n target_link_libraries(kritarotateimage kritaui)\n-install(TARGETS kritarotateimage  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritarotateimage  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES  rotateimage.xmlgui  DESTINATION ${DATA_INSTALL_DIR}/kritaplugins)"}, {"sha": "f5e7e7f5793e5ca82dc2b8c3072ec208f2a0f0e3", "filename": "plugins/extensions/separate_channels/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/separate_channels/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/separate_channels/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/separate_channels/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -2,5 +2,5 @@ set(kritaseparatechannels_SOURCES kis_channel_separator.cc dlg_separate.cc kis_s\n ki18n_wrap_ui(kritaseparatechannels_SOURCES wdg_separations.ui )\n add_library(kritaseparatechannels MODULE ${kritaseparatechannels_SOURCES})\n target_link_libraries(kritaseparatechannels kritaui)\n-install(TARGETS kritaseparatechannels  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaseparatechannels  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES  imageseparate.xmlgui  DESTINATION ${DATA_INSTALL_DIR}/kritaplugins)"}, {"sha": "7bd87060e4df994d23eee7d0cb39f74e64f8e965", "filename": "plugins/extensions/shearimage/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/shearimage/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/extensions/shearimage/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/shearimage/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -2,5 +2,5 @@ set(kritashearimage_SOURCES shearimage.cc dlg_shearimage.cc )\n ki18n_wrap_ui(kritashearimage_SOURCES wdg_shearimage.ui )\n add_library(kritashearimage MODULE ${kritashearimage_SOURCES})\n target_link_libraries(kritashearimage kritaui)\n-install(TARGETS kritashearimage  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritashearimage  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES  shearimage.xmlgui  DESTINATION ${DATA_INSTALL_DIR}/kritaplugins)"}, {"sha": "c74af7bf4b4fd72699f6995b0ae6f0c3a54df8ee", "filename": "plugins/filters/blur/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/blur/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/blur/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/blur/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -19,4 +19,4 @@ ki18n_wrap_ui(kritablurfilter_SOURCES\n \n add_library(kritablurfilter MODULE ${kritablurfilter_SOURCES})\n target_link_libraries(kritablurfilter kritaui)\n-install(TARGETS kritablurfilter  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritablurfilter  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "af660cbc90c11655c3fa7cb15ede81d2f38d4d83", "filename": "plugins/filters/colors/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/colors/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/colors/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/colors/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -11,4 +11,4 @@ ki18n_wrap_ui(kritaextensioncolorsfilters_SOURCES\n \n add_library(kritaextensioncolorsfilters MODULE ${kritaextensioncolorsfilters_SOURCES})\n target_link_libraries(kritaextensioncolorsfilters kritaui)\n-install(TARGETS kritaextensioncolorsfilters  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaextensioncolorsfilters  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "64c32d952d1410e4a5ed61d444c139470eb1fdb3", "filename": "plugins/filters/colorsfilters/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/colorsfilters/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/colorsfilters/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/colorsfilters/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -18,4 +18,4 @@ ki18n_wrap_ui(kritacolorsfilters_SOURCES\n \n add_library(kritacolorsfilters MODULE ${kritacolorsfilters_SOURCES})\n target_link_libraries(kritacolorsfilters kritaui)\n-install(TARGETS kritacolorsfilters  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritacolorsfilters  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "5ce3518ddc3eb6e0e3bf41d284802ba4eccdca93", "filename": "plugins/filters/convolutionfilters/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/convolutionfilters/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/convolutionfilters/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/convolutionfilters/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -3,4 +3,4 @@ set(kritaconvolutionfilters_SOURCES\n    kis_convolution_filter.cpp )\n add_library(kritaconvolutionfilters MODULE ${kritaconvolutionfilters_SOURCES})\n target_link_libraries(kritaconvolutionfilters kritaui)\n-install(TARGETS kritaconvolutionfilters  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaconvolutionfilters  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "e6ba62fc019e9d08bb32dfdd34a52a2e6669217f", "filename": "plugins/filters/dodgeburn/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/dodgeburn/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/dodgeburn/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/dodgeburn/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -4,4 +4,4 @@ ki18n_wrap_ui(kritadodgeburn_SOURCES\n     )\n add_library(kritadodgeburn MODULE ${kritadodgeburn_SOURCES})\n target_link_libraries(kritadodgeburn kritaui)\n-install(TARGETS kritadodgeburn  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritadodgeburn  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "2e9d9728bb70446678a7665bb18879036fbe51f8", "filename": "plugins/filters/embossfilter/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/embossfilter/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/embossfilter/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/embossfilter/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -1,4 +1,4 @@\n set(kritaembossfilter_SOURCES kis_emboss_filter_plugin.cpp kis_emboss_filter.cpp )\n add_library(kritaembossfilter MODULE ${kritaembossfilter_SOURCES})\n target_link_libraries(kritaembossfilter kritaui)\n-install(TARGETS kritaembossfilter  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaembossfilter  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "a95d02f65aac96e96eba46cdff94fbccb751c560", "filename": "plugins/filters/example/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/example/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/example/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/example/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -1,4 +1,4 @@\n set(kritaexample_SOURCES example.cpp )\n add_library(kritaexample MODULE ${kritaexample_SOURCES})\n target_link_libraries(kritaexample kritaui)\n-install(TARGETS kritaexample  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaexample  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "a0c5d37179923246dc8e5fcb87e7af59725b54c2", "filename": "plugins/filters/fastcolortransfer/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/fastcolortransfer/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/fastcolortransfer/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/fastcolortransfer/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -5,4 +5,4 @@ set(kritafastcolortransferfilter_SOURCES\n ki18n_wrap_ui(kritafastcolortransferfilter_SOURCES wdgfastcolortransfer.ui)\n add_library(kritafastcolortransferfilter MODULE ${kritafastcolortransferfilter_SOURCES})\n target_link_libraries(kritafastcolortransferfilter kritaui)\n-install(TARGETS kritafastcolortransferfilter  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritafastcolortransferfilter  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "45841ff50cdcec144c68946ed5819f55f9329d27", "filename": "plugins/filters/gradientmap/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/gradientmap/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/gradientmap/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/gradientmap/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -4,4 +4,4 @@ ki18n_wrap_ui(kritagradientmap_SOURCES wdg_gradientmap.ui)\n \n add_library(kritagradientmap MODULE ${kritagradientmap_SOURCES})\n target_link_libraries(kritagradientmap kritaui)\n-install(TARGETS kritagradientmap  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritagradientmap  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "f798143e957acd25342e41112b7bdf5e8a6d0d73", "filename": "plugins/filters/imageenhancement/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/imageenhancement/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/imageenhancement/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/imageenhancement/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -5,4 +5,4 @@ set(kritaimageenhancement_SOURCES\n     )\n add_library(kritaimageenhancement MODULE ${kritaimageenhancement_SOURCES})\n target_link_libraries(kritaimageenhancement kritaui)\n-install(TARGETS kritaimageenhancement  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaimageenhancement  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "e8dd363f7618e0189273ae0d1ad297a555ea1fc5", "filename": "plugins/filters/indexcolors/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/indexcolors/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/indexcolors/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/indexcolors/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -2,4 +2,4 @@ set(INDEXCOLORS_SOURCE kiswdgindexcolors.cpp indexcolors.cpp indexcolorpalette.c\n ki18n_wrap_ui(INDEXCOLORS_SOURCE kiswdgindexcolors.ui)\n add_library(kritaindexcolors MODULE ${INDEXCOLORS_SOURCE})\n target_link_libraries(kritaindexcolors kritaui)\n-install(TARGETS kritaindexcolors          DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaindexcolors          DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "9276349fde5de65d088e3a259259c5fc3a71d1d8", "filename": "plugins/filters/levelfilter/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/levelfilter/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/levelfilter/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/levelfilter/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -7,4 +7,4 @@ ki18n_wrap_ui(kritalevelfilter_SOURCES\n     )\n add_library(kritalevelfilter MODULE ${kritalevelfilter_SOURCES})\n target_link_libraries(kritalevelfilter kritaui)\n-install(TARGETS kritalevelfilter  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritalevelfilter  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "b9ad0d3aefdfc2624ea440dda262b67f84771e88", "filename": "plugins/filters/noisefilter/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/noisefilter/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/noisefilter/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/noisefilter/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -8,4 +8,4 @@ ki18n_wrap_ui(kritanoisefilter_SOURCES\n \n add_library(kritanoisefilter MODULE ${kritanoisefilter_SOURCES})\n target_link_libraries(kritanoisefilter kritaui)\n-install(TARGETS kritanoisefilter  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritanoisefilter  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "019deba74d50b92a9b59c1363e649812ac6a5695", "filename": "plugins/filters/normalize/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/normalize/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/normalize/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/normalize/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -3,4 +3,4 @@ set(kritanormalize_SOURCES\n )\n add_library(kritanormalize MODULE ${kritanormalize_SOURCES})\n target_link_libraries(kritanormalize kritaui)\n-install(TARGETS kritanormalize  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritanormalize  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "2c123bb2b7a8cc6aecc371d5116fcb885748a603", "filename": "plugins/filters/oilpaintfilter/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/oilpaintfilter/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/oilpaintfilter/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/oilpaintfilter/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -1,4 +1,4 @@\n set(kritaoilpaintfilter_SOURCES kis_oilpaint_filter_plugin.cpp kis_oilpaint_filter.cpp )\n add_library(kritaoilpaintfilter MODULE ${kritaoilpaintfilter_SOURCES})\n target_link_libraries(kritaoilpaintfilter kritaui)\n-install(TARGETS kritaoilpaintfilter  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaoilpaintfilter  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "c59c521e0f9e555dad2a8a1d242635b0d40e3737", "filename": "plugins/filters/phongbumpmap/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/phongbumpmap/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/phongbumpmap/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/phongbumpmap/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -8,4 +8,4 @@ set(kritaphongbumpmap_SOURCES\n ki18n_wrap_ui(kritaphongbumpmap_SOURCES wdgphongbumpmap.ui)\n add_library(kritaphongbumpmap MODULE ${kritaphongbumpmap_SOURCES})\n target_link_libraries(kritaphongbumpmap kritaui)\n-install(TARGETS kritaphongbumpmap  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaphongbumpmap  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "a75e23eeca231728961f1b2976e07d16aad2c25f", "filename": "plugins/filters/pixelizefilter/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/pixelizefilter/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/pixelizefilter/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/pixelizefilter/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -1,4 +1,4 @@\n set(kritapixelizefilter_SOURCES kis_pixelize_filter_plugin.cpp kis_pixelize_filter.cpp )\n add_library(kritapixelizefilter MODULE ${kritapixelizefilter_SOURCES})\n target_link_libraries(kritapixelizefilter kritaui)\n-install(TARGETS kritapixelizefilter  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritapixelizefilter  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "4d4361462a16c0c60184a19a5838aaaed17d24a0", "filename": "plugins/filters/posterize/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/posterize/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/posterize/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/posterize/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -1,4 +1,4 @@\n set(kritaposterize_SOURCES posterize.cpp )\n add_library(kritaposterize MODULE ${kritaposterize_SOURCES})\n target_link_libraries(kritaposterize kritaui)\n-install(TARGETS kritaposterize  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaposterize  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "5b87d1362dfaff29121abaedcca804b702c4048f", "filename": "plugins/filters/raindropsfilter/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/raindropsfilter/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/raindropsfilter/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/raindropsfilter/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -1,4 +1,4 @@\n set(kritaraindropsfilter_SOURCES kis_raindrops_filter_plugin.cpp kis_raindrops_filter.cpp )\n add_library(kritaraindropsfilter MODULE ${kritaraindropsfilter_SOURCES})\n target_link_libraries(kritaraindropsfilter kritaui)\n-install(TARGETS kritaraindropsfilter  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaraindropsfilter  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "b48ecce7a9996bc2e07088baa1a1f38e6db5ef3c", "filename": "plugins/filters/randompickfilter/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/randompickfilter/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/randompickfilter/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/randompickfilter/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -12,4 +12,4 @@ add_library(kritarandompickfilter MODULE ${kritarandompickfilter_SOURCES})\n \n target_link_libraries(kritarandompickfilter kritaui)\n \n-install(TARGETS kritarandompickfilter  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritarandompickfilter  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "8722ae619353ca446ed6e0b0389667cc4338d316", "filename": "plugins/filters/roundcorners/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/roundcorners/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/roundcorners/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/roundcorners/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -1,4 +1,4 @@\n set(kritaroundcornersfilter_SOURCES kis_round_corners_filter_plugin.cpp kis_round_corners_filter.cpp )\n add_library(kritaroundcornersfilter MODULE ${kritaroundcornersfilter_SOURCES})\n target_link_libraries(kritaroundcornersfilter kritaui)\n-install(TARGETS kritaroundcornersfilter  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaroundcornersfilter  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "3bcc0962b714f5987d40e3d634c4e5f340a3c751", "filename": "plugins/filters/smalltilesfilter/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/smalltilesfilter/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/smalltilesfilter/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/smalltilesfilter/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -1,4 +1,4 @@\n set(kritasmalltilesfilter_SOURCES kis_small_tiles_filter_plugin.cpp kis_small_tiles_filter.cpp )\n add_library(kritasmalltilesfilter MODULE ${kritasmalltilesfilter_SOURCES})\n target_link_libraries(kritasmalltilesfilter kritaui)\n-install(TARGETS kritasmalltilesfilter  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritasmalltilesfilter  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "8df05e8f5637aa4fc0fe684fb6f1c1ad51de1f2c", "filename": "plugins/filters/sobelfilter/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/sobelfilter/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/sobelfilter/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/sobelfilter/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -1,4 +1,4 @@\n set(kritasobelfilter_SOURCES kis_sobel_filter_plugin.cpp kis_sobel_filter.cpp )\n add_library(kritasobelfilter MODULE ${kritasobelfilter_SOURCES})\n target_link_libraries(kritasobelfilter kritaui)\n-install(TARGETS kritasobelfilter  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritasobelfilter  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "e63725abb136f284b411c4a8df9f9aeec1b66e99", "filename": "plugins/filters/unsharp/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/unsharp/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/unsharp/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/unsharp/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -14,4 +14,4 @@ add_library(kritaunsharpfilter MODULE ${kritaunsharpfilter_SOURCES})\n \n target_link_libraries(kritaunsharpfilter kritaui)\n \n-install(TARGETS kritaunsharpfilter  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaunsharpfilter  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "549ab284b2c0cb979cf23fe381beae22b7c7b380", "filename": "plugins/filters/wavefilter/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/wavefilter/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/filters/wavefilter/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/wavefilter/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -12,5 +12,5 @@ add_library(kritawavefilter MODULE ${kritawavefilter_SOURCES})\n \n target_link_libraries(kritawavefilter kritaui)\n \n-install(TARGETS kritawavefilter  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritawavefilter  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n "}, {"sha": "10c2d076ebd65908d34ece646a0f6928099636d7", "filename": "plugins/flake/artistictextshape/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/flake/artistictextshape/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/flake/artistictextshape/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/flake/artistictextshape/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -40,4 +40,4 @@ add_library(krita_shape_artistictext MODULE ${ArtisticTextShape_SRCS} )\n \n target_link_libraries(krita_shape_artistictext kritaflake)\n \n-install( TARGETS krita_shape_artistictext DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR} )\n+install( TARGETS krita_shape_artistictext DESTINATION ${KRITA_PLUGIN_INSTALL_DIR} )"}, {"sha": "3345a7eaf677a44a0db2b61981c89ee5660f6553", "filename": "plugins/flake/pathshapes/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/flake/pathshapes/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/flake/pathshapes/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/flake/pathshapes/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -37,4 +37,4 @@ add_library(krita_shape_paths MODULE ${pathshapes_SOURCES})\n \n target_link_libraries(krita_shape_paths kritaflake kritawidgets)\n \n-install(TARGETS krita_shape_paths  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS krita_shape_paths  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "c0999ed2fc8c22f20d0b5de6bb482f8a57ac2b92", "filename": "plugins/flake/textshape/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/flake/textshape/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/flake/textshape/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/flake/textshape/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -157,4 +157,4 @@ if( SHOULD_BUILD_FEATURE_RDF )\n endif()\n \n \n-install(TARGETS krita_shape_text DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS krita_shape_text DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "4553f7846781061ce8aa5b1e1d534664ea53d78d", "filename": "plugins/flake/vectorshape/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/flake/vectorshape/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/flake/vectorshape/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/flake/vectorshape/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -14,7 +14,7 @@ add_library(krita_shape_vector MODULE ${VectorShape_SRCS})\n \n target_link_libraries(krita_shape_vector kritaflake kritawidgets kritavectorimage KF5::I18n Qt5::Svg)\n \n-install(TARGETS krita_shape_vector DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS krita_shape_vector DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n if (SHARED_MIME_INFO_FOUND)\n     install(FILES krita_svm.xml DESTINATION ${XDG_MIME_INSTALL_DIR})"}, {"sha": "2784e39300a0329d0bdca9eecc3710995b09ed21", "filename": "plugins/generators/pattern/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/generators/pattern/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/generators/pattern/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/generators/pattern/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -12,4 +12,4 @@ add_library(kritapatterngenerator MODULE ${kritapatterngenerator_SOURCES})\n \n target_link_libraries(kritapatterngenerator kritaui)\n \n-install(TARGETS kritapatterngenerator  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritapatterngenerator  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "6a5fee2e97e510bd2a2b20bf527cb267e42b9cc6", "filename": "plugins/generators/solid/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/generators/solid/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/generators/solid/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/generators/solid/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -12,4 +12,4 @@ add_library(kritacolorgenerator MODULE ${kritacolorgenerator_SOURCES})\n \n target_link_libraries(kritacolorgenerator kritaui)\n \n-install(TARGETS kritacolorgenerator  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritacolorgenerator  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "fc613c4fb7ad487cf1fb749d2c1a99c11e9c36dc", "filename": "plugins/impex/bmp/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/bmp/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/bmp/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/bmp/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -8,7 +8,7 @@ add_library(kritabmpexport MODULE ${kritabmpexport_SOURCES})\n \n target_link_libraries(kritabmpexport kritaui)\n \n-install(TARGETS kritabmpexport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritabmpexport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n set(kritabmpimport_SOURCES\n     kis_bmp_import.cpp\n@@ -20,6 +20,6 @@ add_library(kritabmpimport MODULE ${kritabmpimport_SOURCES})\n \n target_link_libraries(kritabmpimport kritaui)\n \n-install(TARGETS kritabmpimport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritabmpimport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n install( PROGRAMS  krita_bmp.desktop  DESTINATION ${XDG_APPS_INSTALL_DIR})"}, {"sha": "bd4c339b81b40f2b76e7d674184411005fad8dd0", "filename": "plugins/impex/brush/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/brush/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/brush/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/brush/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -9,7 +9,7 @@ add_library(kritabrushexport MODULE ${kritabrushexport_PART_SRCS})\n \n target_link_libraries(kritabrushexport kritalibbrush kritalibpaintop kritaui)\n \n-install(TARGETS kritabrushexport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritabrushexport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n set(kritabrushimport_PART_SRCS\n     kis_brush_import.cpp\n@@ -22,5 +22,5 @@ add_library(kritabrushimport MODULE ${kritabrushimport_PART_SRCS})\n \n target_link_libraries(kritabrushimport kritalibbrush kritaui)\n \n-install(TARGETS kritabrushimport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritabrushimport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( PROGRAMS  krita_brush.desktop  DESTINATION ${XDG_APPS_INSTALL_DIR})"}, {"sha": "a52e030ecae1c9ea2272eaedd21b593e0d84e7dc", "filename": "plugins/impex/csv/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/csv/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/csv/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/csv/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -18,7 +18,7 @@ add_library(kritacsvimport MODULE ${kritacsvimport_SOURCES})\n \n target_link_libraries(kritacsvimport kritaui )\n \n-install(TARGETS kritacsvimport DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritacsvimport DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n # export\n \n@@ -32,6 +32,6 @@ add_library(kritacsvexport MODULE ${kritacsvexport_SOURCES})\n \n target_link_libraries(kritacsvexport kritaui )\n \n-install(TARGETS kritacsvexport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritacsvexport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n install( PROGRAMS  krita_csv.desktop  DESTINATION ${XDG_APPS_INSTALL_DIR})"}, {"sha": "8e86459e3933623b0ca3511d98944ea8034ec2ed", "filename": "plugins/impex/exr/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/exr/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/exr/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/exr/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -19,7 +19,7 @@ add_library(kritaexrimport MODULE ${kritaexrimport_SOURCES})\n \n target_link_libraries(kritaexrimport kritaui  ${OPENEXR_LIBRARIES} )\n \n-install(TARGETS kritaexrimport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaexrimport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n set(kritaexrexport_SOURCES\n     exr_export.cc\n@@ -32,7 +32,7 @@ add_library(kritaexrexport MODULE ${kritaexrexport_SOURCES})\n \n target_link_libraries(kritaexrexport kritaui  ${OPENEXR_LIBRARIES} )\n \n-install(TARGETS kritaexrexport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaexrexport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n install( FILES\n     exrchannels.schema"}, {"sha": "30376ce50927ca4e748fda5c4491b1d37455c660", "filename": "plugins/impex/heightmap/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/heightmap/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/heightmap/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/heightmap/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -10,7 +10,7 @@ add_library(kritaheightmapimport MODULE ${kritaheightmapimport_SOURCES})\n \n target_link_libraries(kritaheightmapimport kritaui )\n \n-install(TARGETS kritaheightmapimport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaheightmapimport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n set(kritaheightmapexport_SOURCES\n     kis_heightmap_export.cpp\n@@ -22,5 +22,5 @@ add_library(kritaheightmapexport MODULE ${kritaheightmapexport_SOURCES})\n \n target_link_libraries(kritaheightmapexport kritaui  )\n \n-install(TARGETS kritaheightmapexport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaheightmapexport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( PROGRAMS  krita_heightmap.desktop  DESTINATION ${XDG_APPS_INSTALL_DIR})"}, {"sha": "0aa33def7f93ad0584d01e03424b999dbaea2559", "filename": "plugins/impex/jp2/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/jp2/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/jp2/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/jp2/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -13,7 +13,7 @@ add_library(kritajp2import MODULE ${kritajp2import_SOURCES})\n \n target_link_libraries(kritajp2import kritaui  ${OPENJPEG_LIBRARIES} )\n \n-install(TARGETS kritajp2import  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritajp2import  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n set(kritajp2export_SOURCES\n     jp2_export.cc\n@@ -26,5 +26,5 @@ add_library(kritajp2export MODULE ${kritajp2export_SOURCES})\n \n target_link_libraries(kritajp2export kritaui  ${OPENJPEG_LIBRARIES} )\n \n-install(TARGETS kritajp2export  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritajp2export  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( PROGRAMS  krita_jp2.desktop  DESTINATION ${XDG_APPS_INSTALL_DIR})"}, {"sha": "586b4d1cd00035cd26c41ed0bcd885acca746556", "filename": "plugins/impex/jpeg/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/jpeg/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/jpeg/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/jpeg/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -22,7 +22,7 @@ add_library(kritajpegimport MODULE ${kritajpegimport_SOURCES})\n \n target_link_libraries(kritajpegimport kritaui  ${JPEG_LIBRARIES} ${LCMS2_LIBRARIES} ${EXIV2_LIBRARIES} )\n \n-install(TARGETS kritajpegimport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritajpegimport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n set(kritajpegexport_SOURCES\n     kis_jpeg_export.cc\n@@ -35,5 +35,5 @@ add_library(kritajpegexport MODULE ${kritajpegexport_SOURCES})\n \n target_link_libraries(kritajpegexport kritaui   ${JPEG_LIBRARIES} ${LCMS2_LIBRARIES} ${EXIV2_LIBRARIES} )\n \n-install(TARGETS kritajpegexport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritajpegexport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( PROGRAMS  krita_jpeg.desktop  DESTINATION ${XDG_APPS_INSTALL_DIR})"}, {"sha": "ea4358227d75784b0ce316c2a0d76d6d55fe3ddd", "filename": "plugins/impex/odg/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/odg/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/odg/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/odg/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -12,6 +12,6 @@ add_definitions(${PNG_DEFINITIONS} ${KDE4_ENABLE_EXCEPTIONS})\n \n target_link_libraries(kritaodgimport kritaui ${PNG_LIBRARIES} )\n \n-install(TARGETS kritaodgimport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaodgimport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n install( PROGRAMS  krita_odg.desktop  DESTINATION ${XDG_APPS_INSTALL_DIR})"}, {"sha": "4d288f19ec0b6ea9d309115ddc54f6250dc055d6", "filename": "plugins/impex/ora/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/ora/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/ora/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/ora/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -13,7 +13,7 @@ add_library(kritaoraimport MODULE ${kritaoraimport_SOURCES})\n \n target_link_libraries(kritaoraimport kritaui )\n \n-install(TARGETS kritaoraimport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaoraimport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n set(kritaoraexport_SOURCES\n     ora_export.cc\n@@ -24,7 +24,7 @@ add_library(kritaoraexport MODULE ${kritaoraexport_SOURCES})\n \n target_link_libraries(kritaoraexport kritaui )\n \n-install(TARGETS kritaoraexport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaoraexport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n install( PROGRAMS  krita_ora.desktop  DESTINATION ${XDG_APPS_INSTALL_DIR})\n "}, {"sha": "96a6b3b0d6acc968adc9f3aa07a8c2fdd09ecd3c", "filename": "plugins/impex/pdf/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/pdf/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/pdf/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/pdf/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -8,5 +8,5 @@ add_library(kritapdfimport MODULE ${kritapdfimport_SOURCES})\n \n target_link_libraries(kritapdfimport kritaui  ${POPPLER_LIBRARY} )\n \n-install(TARGETS kritapdfimport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritapdfimport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install(PROGRAMS krita_pdf.desktop  DESTINATION ${XDG_APPS_INSTALL_DIR})"}, {"sha": "2af01edb7a38673958d6410a59fe047a009f8403", "filename": "plugins/impex/png/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/png/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/png/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/png/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -14,7 +14,7 @@ add_definitions(${PNG_DEFINITIONS} ${KDE4_ENABLE_EXCEPTIONS})\n \n target_link_libraries(kritapngimport kritaui ${PNG_LIBRARIES} )\n \n-install(TARGETS kritapngimport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritapngimport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n set(kritapngexport_SOURCES\n     kis_png_export.cc\n@@ -26,6 +26,6 @@ add_library(kritapngexport MODULE ${kritapngexport_SOURCES})\n \n target_link_libraries(kritapngexport kritaui ${PNG_LIBRARIES})\n \n-install(TARGETS kritapngexport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritapngexport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n install( PROGRAMS  krita_png.desktop  DESTINATION ${XDG_APPS_INSTALL_DIR})"}, {"sha": "4fdbdb6c5e8fb8eeb5c910a429ffad96328d145b", "filename": "plugins/impex/ppm/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/ppm/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/ppm/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/ppm/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -10,7 +10,7 @@ add_library(kritappmimport MODULE ${kritappmimport_SOURCES})\n \n target_link_libraries(kritappmimport kritaui )\n \n-install(TARGETS kritappmimport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritappmimport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n set(kritappmexport_SOURCES\n     kis_ppm_export.cpp\n@@ -22,6 +22,6 @@ add_library(kritappmexport MODULE ${kritappmexport_SOURCES})\n \n target_link_libraries(kritappmexport kritaui  )\n \n-install(TARGETS kritappmexport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritappmexport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n install( PROGRAMS  krita_ppm.desktop  DESTINATION ${XDG_APPS_INSTALL_DIR})"}, {"sha": "4ef5dcdfaed38a36ad31d18a23eeb5220d414fe2", "filename": "plugins/impex/psd/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/psd/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/psd/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/psd/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -36,7 +36,7 @@ add_library(kritapsdimport MODULE ${kritapsdimport_SOURCES})\n \n target_link_libraries(kritapsdimport kritaglobal kritaui kritapsd KF5::I18n ${ZLIB_LIBRARIES})\n \n-install(TARGETS kritapsdimport DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritapsdimport DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n #\n # export\n@@ -56,6 +56,6 @@ else ()\n     target_link_libraries(kritapsdexport kritaui kritapsd ${ZLIB_LIBRARIES})\n endif ()\t\n \n-install(TARGETS kritapsdexport DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritapsdexport DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n install( PROGRAMS  krita_psd.desktop  DESTINATION ${XDG_APPS_INSTALL_DIR})"}, {"sha": "0fc69e64e526ed681d457285ccfe45f82e1d3e0a", "filename": "plugins/impex/qml/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/qml/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/qml/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/qml/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -10,4 +10,4 @@ add_library(kritaqmlexport MODULE ${kritaqmlexport_SOURCES})\n \n target_link_libraries(kritaqmlexport kritaui )\n \n-install(TARGETS kritaqmlexport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaqmlexport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "f03ae6dd5c495887806b60a6a2fb35439b540b71", "filename": "plugins/impex/raw/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/raw/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/raw/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/raw/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -28,6 +28,6 @@ ki18n_wrap_ui(krita_raw_import_SOURCES\n add_library(krita_raw_import MODULE ${krita_raw_import_SOURCES})\n target_link_libraries(krita_raw_import kritaui ${LibRaw_LIBRARIES})\n \n-install(TARGETS krita_raw_import  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS krita_raw_import  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( PROGRAMS  krita_raw.desktop  DESTINATION ${XDG_APPS_INSTALL_DIR})\n "}, {"sha": "39263b0412e73dd932c78a9f58d2844e4ba92c5e", "filename": "plugins/impex/spriter/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/spriter/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/spriter/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/spriter/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -13,6 +13,6 @@ add_library(kritaspriterexport MODULE ${kritaspriterexport_SOURCES})\n \n target_link_libraries(kritaspriterexport kritaui )\n \n-install(TARGETS kritaspriterexport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaspriterexport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n install( PROGRAMS  krita_spriter.desktop  DESTINATION ${XDG_APPS_INSTALL_DIR})"}, {"sha": "68aa577524d57c26d613f285fde732889999acd3", "filename": "plugins/impex/tga/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/tga/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/tga/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/tga/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -8,7 +8,7 @@ add_library(kritatgaexport MODULE ${kritatgaexport_SOURCES})\n \n target_link_libraries(kritatgaexport kritaui)\n \n-install(TARGETS kritatgaexport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritatgaexport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n set(kritatgaimport_SOURCES\n     kis_tga_import.cpp\n@@ -20,5 +20,5 @@ add_library(kritatgaimport MODULE ${kritatgaimport_SOURCES})\n \n target_link_libraries(kritatgaimport kritaui )\n \n-install(TARGETS kritatgaimport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritatgaimport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( PROGRAMS  krita_tga.desktop  DESTINATION ${XDG_APPS_INSTALL_DIR})"}, {"sha": "86e7ea0f59ab4d69da275a9cfd3d11afb9ae8753", "filename": "plugins/impex/tiff/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/tiff/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/tiff/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/tiff/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -18,7 +18,7 @@ add_library(kritatiffimport MODULE ${kritatiffimport_SOURCES})\n \n target_link_libraries(kritatiffimport kritaui  ${TIFF_LIBRARIES})\n \n-install(TARGETS kritatiffimport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritatiffimport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n set(kritatiffexport_SOURCES\n     ${libkritatiffconverter_LIB_SRCS}\n@@ -32,6 +32,6 @@ add_library(kritatiffexport MODULE ${kritatiffexport_SOURCES})\n \n target_link_libraries(kritatiffexport kritaui  ${TIFF_LIBRARIES})\n \n-install(TARGETS kritatiffexport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritatiffexport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( PROGRAMS  krita_tiff.desktop  DESTINATION ${XDG_APPS_INSTALL_DIR})\n "}, {"sha": "0e900ad51ebcf1e327af27a36a7284f96c9a18c4", "filename": "plugins/impex/xcf/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/xcf/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/impex/xcf/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/xcf/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -29,5 +29,5 @@ if (WIN32)\n     target_link_libraries(kritaxcfimport kritaui ${WIN32_PLATFORM_NET_LIBS})\n endif ()\n \n-install(TARGETS kritaxcfimport  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaxcfimport  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( PROGRAMS  krita_xcf.desktop  DESTINATION ${XDG_APPS_INSTALL_DIR})"}, {"sha": "ba2afefcf3e295422153ab46b78c177deea75eac", "filename": "plugins/paintops/chalk/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/chalk/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/chalk/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/chalk/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -13,6 +13,6 @@ add_library(kritachalkpaintop MODULE ${kritachalkpaintop_SOURCES})\n \n target_link_libraries(kritachalkpaintop kritalibpaintop)\n \n-install(TARGETS kritachalkpaintop  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritachalkpaintop  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES\n     krita-chalk.png DESTINATION ${DATA_INSTALL_DIR}/krita/images)"}, {"sha": "5715994f9572db60bd26133032cff87005962bea", "filename": "plugins/paintops/colorsmudge/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/colorsmudge/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/colorsmudge/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/colorsmudge/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -12,6 +12,6 @@ add_library(kritacolorsmudgepaintop MODULE ${kritacolorsmudgepaintop_SOURCES})\n \n target_link_libraries(kritacolorsmudgepaintop kritalibpaintop)\n \n-install(TARGETS kritacolorsmudgepaintop DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritacolorsmudgepaintop DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES  krita-colorsmudge.png DESTINATION ${DATA_INSTALL_DIR}/krita/images)\n "}, {"sha": "c3a671eaad3f16e4d904bdcff50c8caa63dd1a30", "filename": "plugins/paintops/curvebrush/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/curvebrush/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/curvebrush/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/curvebrush/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -15,5 +15,5 @@ add_library(kritacurvepaintop MODULE ${kritacurvepaintop_SOURCES})\n \n target_link_libraries(kritacurvepaintop kritalibpaintop)\n \n-install(TARGETS kritacurvepaintop  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritacurvepaintop  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES  krita-curve.png DESTINATION ${DATA_INSTALL_DIR}/krita/images)"}, {"sha": "bd3a0e84765eeccd4fbbb8a102bdb367718cdbe3", "filename": "plugins/paintops/defaultpaintops/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/defaultpaintops/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/defaultpaintops/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/defaultpaintops/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -22,7 +22,7 @@ add_library(kritadefaultpaintops MODULE ${kritadefaultpaintops_SOURCES})\n \n target_link_libraries(kritadefaultpaintops kritalibpaintop)\n \n-install(TARGETS kritadefaultpaintops  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritadefaultpaintops  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES\n     krita-paintbrush.png\n     krita-eraser.png"}, {"sha": "b5cf407fc4774ce67a7778c9eba462d5fd959a59", "filename": "plugins/paintops/deform/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/deform/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/deform/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/deform/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -13,5 +13,5 @@ add_library(kritadeformpaintop MODULE ${kritadeformpaintop_SOURCES})\n \n target_link_libraries(kritadeformpaintop kritaui kritalibpaintop)\n \n-install(TARGETS kritadeformpaintop  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritadeformpaintop  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES  krita-deform.png DESTINATION ${DATA_INSTALL_DIR}/krita/images )"}, {"sha": "756e2ad31b68a68166fb4265a01f9076b5996638", "filename": "plugins/paintops/dynadraw/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/dynadraw/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/dynadraw/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/dynadraw/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -14,7 +14,7 @@ add_library(kritadynapaintop MODULE ${kritadynapaintop_SOURCES})\n \n target_link_libraries(kritadynapaintop kritalibpaintop)\n \n-install(TARGETS kritadynapaintop  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritadynapaintop  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES\n     krita-dyna.png DESTINATION ${DATA_INSTALL_DIR}/krita/images)\n "}, {"sha": "16872f9d534243fc7269a0b67a53068048814f99", "filename": "plugins/paintops/experiment/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/experiment/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/experiment/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/experiment/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -12,7 +12,7 @@ add_library(kritaexperimentpaintop MODULE ${kritaexperimentpaintop_SOURCES})\n \n target_link_libraries(kritaexperimentpaintop kritalibpaintop)\n \n-install(TARGETS kritaexperimentpaintop  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaexperimentpaintop  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES\n     krita-experiment.png DESTINATION ${DATA_INSTALL_DIR}/krita/images)\n "}, {"sha": "0532df2f4b44d9388bd17a8b614f4ecdd7a613e6", "filename": "plugins/paintops/filterop/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/filterop/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/filterop/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/filterop/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -10,7 +10,7 @@ add_library(kritafilterop MODULE ${kritafilterop_SOURCES})\n \n target_link_libraries(kritafilterop kritalibpaintop)\n \n-install(TARGETS kritafilterop  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritafilterop  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES\n     krita-filterop.png\n     DESTINATION ${DATA_INSTALL_DIR}/krita/images)"}, {"sha": "85cef8200c7256f3073678b2ff149d66a7124501", "filename": "plugins/paintops/gridbrush/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/gridbrush/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/gridbrush/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/gridbrush/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -14,7 +14,7 @@ add_library(kritagridpaintop MODULE ${kritagridpaintop_SOURCES})\n \n target_link_libraries(kritagridpaintop kritalibpaintop)\n \n-install(TARGETS kritagridpaintop  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritagridpaintop  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES\n     krita-grid.png DESTINATION ${DATA_INSTALL_DIR}/krita/images)\n "}, {"sha": "a160c0e6efbf1e8bf34ff637d5fa8ced05ea2625", "filename": "plugins/paintops/hairy/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/hairy/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/hairy/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/hairy/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -17,7 +17,7 @@ add_library(kritahairypaintop MODULE ${kritahairypaintop_SOURCES})\n \n target_link_libraries(kritahairypaintop kritalibpaintop)\n \n-install(TARGETS kritahairypaintop  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritahairypaintop  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES\n     krita-sumi.png DESTINATION ${DATA_INSTALL_DIR}/krita/images)\n "}, {"sha": "417a3375a723a828ea8cb332fa60da00eb4a1e4c", "filename": "plugins/paintops/hatching/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/hatching/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/hatching/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/hatching/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -17,6 +17,6 @@ add_library(kritahatchingpaintop MODULE ${kritahatchingpaintop_SOURCES})\n \n target_link_libraries(kritahatchingpaintop kritalibpaintop)\n \n-install(TARGETS kritahatchingpaintop  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritahatchingpaintop  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n install( FILES  krita-hatching.png DESTINATION ${DATA_INSTALL_DIR}/krita/images)\n "}, {"sha": "a3cc8a26ac946344a1d54635606747fb03b032ac", "filename": "plugins/paintops/particle/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/particle/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/particle/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/particle/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -13,7 +13,7 @@ add_library(kritaparticlepaintop MODULE ${kritaparticlepaintop_SOURCES})\n \n target_link_libraries(kritaparticlepaintop kritalibpaintop)\n \n-install(TARGETS kritaparticlepaintop  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaparticlepaintop  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n \n ########### install files ###############"}, {"sha": "e2e8d77646d05df29140b7005beecc57bc66b1e3", "filename": "plugins/paintops/sketch/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/sketch/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/sketch/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/sketch/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -15,7 +15,7 @@ add_library(kritasketchpaintop MODULE ${kritasketchpaintop_SOURCES})\n \n target_link_libraries(kritasketchpaintop kritalibpaintop)\n \n-install(TARGETS kritasketchpaintop  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritasketchpaintop  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n \n ########### install files ###############"}, {"sha": "d92658e44de5dc125bcafaff51170ac5ac984d70", "filename": "plugins/paintops/spray/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/spray/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/spray/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/spray/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -16,7 +16,7 @@ add_library(kritaspraypaintop MODULE ${kritaspraypaintop_SOURCES})\n \n target_link_libraries(kritaspraypaintop kritalibpaintop)\n \n-install(TARGETS kritaspraypaintop  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaspraypaintop  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n \n ########### install files ###############"}, {"sha": "a7d95f78b9b6b7670ca7f5dd932a4ab64333a452", "filename": "plugins/paintops/tangentnormal/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/tangentnormal/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/paintops/tangentnormal/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/tangentnormal/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -13,7 +13,7 @@ add_library(kritatangentnormalpaintop MODULE ${kritatangentnormalpaintop_SOURCES\n \n target_link_libraries(kritatangentnormalpaintop kritalibpaintop)\n \n-install(TARGETS kritatangentnormalpaintop  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritatangentnormalpaintop  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n ########### install files ###############\n \n install( FILES  krita-tangetnormal.png DESTINATION ${DATA_INSTALL_DIR}/krita/images)"}, {"sha": "d213fb3d0132258e2da67057e065e5591b8c8f50", "filename": "plugins/tools/basictools/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/basictools/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/basictools/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/basictools/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -34,7 +34,7 @@ generate_export_header(kritadefaulttools BASE_NAME kritadefaulttools)\n target_link_libraries(kritadefaulttools kritaui kritabasicflakes)\n target_link_libraries(kritadefaulttools ${Boost_SYSTEM_LIBRARY})\n \n-install(TARGETS kritadefaulttools  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritadefaulttools  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n \n ########### install files ###############"}, {"sha": "f76760b624195b2c70afc96d0a73906eaffae0c8", "filename": "plugins/tools/defaulttool/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/defaulttool/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/defaulttool/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/defaulttool/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -34,4 +34,4 @@ qt5_add_resources(defaulttools_SRCS defaulttools.qrc)\n \n add_library(krita_flaketools MODULE ${defaulttools_SRCS})\n target_link_libraries(krita_flaketools kritaflake kritawidgets)\n-install(TARGETS krita_flaketools DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS krita_flaketools DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "9bdf94e0af9826fdd66cdc2876bcec291bbd3f68", "filename": "plugins/tools/karbonplugins/filtereffects/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/karbonplugins/filtereffects/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/karbonplugins/filtereffects/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/karbonplugins/filtereffects/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -40,4 +40,4 @@ add_library(krita_filtereffects MODULE ${karbon_filtereffects_SOURCES})\n \n target_link_libraries(krita_filtereffects kritaflake kritawidgets KF5::Completion)\n \n-install(TARGETS krita_filtereffects  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS krita_filtereffects  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "83e14f9763430d940074e4ce375ac9a265a073ec", "filename": "plugins/tools/karbonplugins/tools/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/karbonplugins/tools/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/karbonplugins/tools/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/karbonplugins/tools/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -46,5 +46,5 @@ add_library(krita_karbontools MODULE ${karbon_tools_SOURCES})\n \n target_link_libraries(krita_karbontools kritawidgets KF5::Completion)\n \n-install(TARGETS krita_karbontools DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS krita_karbontools DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n "}, {"sha": "c81049076c0d3a53aaf4eaddba128c293c259db9", "filename": "plugins/tools/selectiontools/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/selectiontools/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/selectiontools/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/selectiontools/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -16,7 +16,7 @@ add_library(kritaselectiontools MODULE ${kritaselectiontools_SOURCES})\n \n target_link_libraries(kritaselectiontools kritaui kritabasicflakes)\n \n-install(TARGETS kritaselectiontools  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritaselectiontools  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n install( FILES\n         KisToolSelectPolygonal.action"}, {"sha": "f438344d3a6bb6f862c9819deecc070e8933d5b7", "filename": "plugins/tools/tool_crop/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/tool_crop/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/tool_crop/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_crop/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -12,7 +12,7 @@ add_library(kritatoolcrop MODULE ${kritatoolcrop_SOURCES})\n \n target_link_libraries(kritatoolcrop kritaui)\n \n-install(TARGETS kritatoolcrop  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritatoolcrop  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n install( FILES\n     KisToolCrop.action"}, {"sha": "66d51e6a28e7d03fd2e4d2a02075867b5d261ff3", "filename": "plugins/tools/tool_dyna/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/tool_dyna/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/tool_dyna/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_dyna/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -8,5 +8,5 @@ add_library(kritatooldyna MODULE ${kritatooldyna_SOURCES})\n \n target_link_libraries(kritatooldyna kritaui)\n \n-install(TARGETS kritatooldyna  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritatooldyna  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n "}, {"sha": "3902e8e569dfe30914852a18cfa6ab47670196a2", "filename": "plugins/tools/tool_polygon/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/tool_polygon/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/tool_polygon/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_polygon/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -8,7 +8,7 @@ add_library(kritatoolpolygon MODULE ${kritatoolpolygon_SOURCES})\n \n target_link_libraries(kritatoolpolygon kritaui)\n \n-install(TARGETS kritatoolpolygon  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritatoolpolygon  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n install( FILES\n     KisToolPolygon.action"}, {"sha": "223f40cd5a31ae96f35c0b2a04b39527a6861444", "filename": "plugins/tools/tool_polyline/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/tool_polyline/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/tool_polyline/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_polyline/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -9,7 +9,7 @@ add_library(kritatoolpolyline MODULE ${kritatoolpolyline_SOURCES})\n \n target_link_libraries(kritatoolpolyline kritaui)\n \n-install(TARGETS kritatoolpolyline  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritatoolpolyline  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n install( FILES\n     KisToolPolyline.action"}, {"sha": "963e33107e7390556868705e52d9813ed5321f86", "filename": "plugins/tools/tool_text/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/tool_text/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/tool_text/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_text/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -13,4 +13,4 @@ add_library(kritatooltext MODULE ${kritatooltext_SOURCES})\n \n target_link_libraries(kritatooltext kritaui)\n \n-install(TARGETS kritatooltext  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritatooltext  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})"}, {"sha": "806845bbc3fb186104cb092fffb7743dcf2fc16b", "filename": "plugins/tools/tool_transform2/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/tool_transform2/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d/plugins/tools/tool_transform2/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_transform2/CMakeLists.txt?ref=5047342455b1fb9afdcef9e4d2c22fb7dfd9b20d", "patch": "@@ -40,7 +40,7 @@ else ()\n   target_link_libraries(kritatooltransform kritaui ${GSL_LIBRARIES} ${GSL_CBLAS_LIBRARIES})\n endif ()\n \n-install(TARGETS kritatooltransform  DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n+install(TARGETS kritatooltransform  DESTINATION ${KRITA_PLUGIN_INSTALL_DIR})\n \n \n install( FILES"}]}, {"sha": "96e12c49260fdc51655281334395acf0dcb923ec", "stats": {"total": 66, "additions": 33, "deletions": 33}, "files": [{"sha": "b9443f6c61d325d5899cbe9dc08729f96e2c7718", "filename": "CMakeLists.txt", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/96e12c49260fdc51655281334395acf0dcb923ec/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/96e12c49260fdc51655281334395acf0dcb923ec/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=96e12c49260fdc51655281334395acf0dcb923ec", "patch": "@@ -111,17 +111,17 @@ message(\"Module path:\" ${CMAKE_MODULE_PATH})\n \n # fetch git revision for the current build\n \n-set(CALLIGRA_GIT_SHA1_STRING \"\")\n-set(CALLIGRA_GIT_BRANCH_STRING \"\")\n+set(KRITA_GIT_SHA1_STRING \"\")\n+set(KRITA_GIT_BRANCH_STRING \"\")\n \n include(GetGitRevisionDescription)\n get_git_head_revision(GIT_REFSPEC GIT_SHA1)\n get_git_branch(GIT_BRANCH)\n \n if(GIT_SHA1 AND GIT_BRANCH)\n     string(SUBSTRING ${GIT_SHA1} 0 7 GIT_SHA1)\n-    set(CALLIGRA_GIT_SHA1_STRING ${GIT_SHA1})\n-    set(CALLIGRA_GIT_BRANCH_STRING ${GIT_BRANCH})\n+    set(KRITA_GIT_SHA1_STRING ${GIT_SHA1})\n+    set(KRITA_GIT_BRANCH_STRING ${GIT_BRANCH})\n endif()\n \n if(NOT DEFINED RELEASE_BUILD)"}, {"sha": "8b431420a1f5d6438b2b9c18ef0e11ebb623388f", "filename": "krita/crashreporter/main.cpp", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/96e12c49260fdc51655281334395acf0dcb923ec/krita/crashreporter/main.cpp", "raw_url": "https://github.com/KDE/krita/raw/96e12c49260fdc51655281334395acf0dcb923ec/krita/crashreporter/main.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/crashreporter/main.cpp?ref=96e12c49260fdc51655281334395acf0dcb923ec", "patch": "@@ -28,7 +28,7 @@\n #include <kis_debug.h>\n \n #include <calligraversion.h>\n-#include <calligragitversion.h>\n+#include <kritagitversion.h>\n \n #include \"mainwindow.h\"\n \n@@ -39,8 +39,8 @@ int main( int argc, char **argv )\n \n     KLocalizedString::setApplicationDomain( \"crashhandler\" );\n \n-#ifdef CALLIGRA_GIT_SHA1_STRING\n-    QString gitVersion(CALLIGRA_GIT_SHA1_STRING);\n+#ifdef KRITA_GIT_SHA1_STRING\n+    QString gitVersion(KRITA_GIT_SHA1_STRING);\n     version = QString(\"%1 (git %2)\").arg(calligraVersion).arg(gitVersion).toLatin1();\n #else\n     version = calligraVersion;"}, {"sha": "5bc75f3deeabf2e288a074099e49b427128da339", "filename": "krita/crashreporter/mainwindow.cpp", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/96e12c49260fdc51655281334395acf0dcb923ec/krita/crashreporter/mainwindow.cpp", "raw_url": "https://github.com/KDE/krita/raw/96e12c49260fdc51655281334395acf0dcb923ec/krita/crashreporter/mainwindow.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/crashreporter/mainwindow.cpp?ref=96e12c49260fdc51655281334395acf0dcb923ec", "patch": "@@ -26,7 +26,7 @@\n #include <KoResourcePaths.h>\n \n #include <calligraversion.h>\n-#include <calligragitversion.h>\n+#include <kritagitversion.h>\n \n #include <cstdlib>\n \n@@ -287,14 +287,14 @@ void MainWindow::startUpload()\n     QString version;\n \n \n-#ifdef CALLIGRA_GIT_SHA1_STRING\n-    QString gitVersion(CALLIGRA_GIT_SHA1_STRING);\n+#ifdef KRITA_GIT_SHA1_STRING\n+    QString gitVersion(KRITA_GIT_SHA1_STRING);\n     version = QString(\"%1-%2\").arg(calligraVersion).arg(gitVersion).toLatin1();\n #else\n     version = calligraVersion;\n #endif\n \n-    fields << Field(\"BuildID\", CALLIGRA_GIT_SHA1_STRING)\n+    fields << Field(\"BuildID\", KRITA_GIT_SHA1_STRING)\n            << Field(\"ProductName\", \"krita\")\n            << Field(\"Version\", version.toLatin1())\n            << Field(\"Vendor\", \"Krita Foundation\")"}, {"sha": "69c7fd218814f5e5b9f4d08dcf9836564e3f4208", "filename": "krita/gemini/main.cpp", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/96e12c49260fdc51655281334395acf0dcb923ec/krita/gemini/main.cpp", "raw_url": "https://github.com/KDE/krita/raw/96e12c49260fdc51655281334395acf0dcb923ec/krita/gemini/main.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/gemini/main.cpp?ref=96e12c49260fdc51655281334395acf0dcb923ec", "patch": "@@ -39,7 +39,7 @@\n #include \"sketch/SketchInputContext.h\"\n \n #include <calligraversion.h>\n-#include <calligragitversion.h>\n+#include <kritagitversion.h>\n \n #if defined Q_OS_WIN\n #include \"stdlib.h\"\n@@ -55,8 +55,8 @@ int main( int argc, char** argv )\n     QString version;\n \n \n-#ifdef CALLIGRA_GIT_SHA1_STRING\n-    QString gitVersion(CALLIGRA_GIT_SHA1_STRING);\n+#ifdef KRITA_GIT_SHA1_STRING\n+    QString gitVersion(KRITA_GIT_SHA1_STRING);\n     version = QString(\"%1 (git %2)\").arg(calligraVersion).arg(gitVersion).toLatin1();\n #else\n     version = calligraVersion;"}, {"sha": "e9b6f83ddd01f5d8178500d2043862cb60d14dd1", "filename": "krita/sketch/main.cpp", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/96e12c49260fdc51655281334395acf0dcb923ec/krita/sketch/main.cpp", "raw_url": "https://github.com/KDE/krita/raw/96e12c49260fdc51655281334395acf0dcb923ec/krita/sketch/main.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/sketch/main.cpp?ref=96e12c49260fdc51655281334395acf0dcb923ec", "patch": "@@ -32,7 +32,7 @@\n #include <KoResourcePaths.h>\n \n #include <calligraversion.h>\n-#include <calligragitversion.h>\n+#include <kritagitversion.h>\n #include <opengl/kis_opengl.h>\n #include <kis_icon.h>\n \n@@ -57,8 +57,8 @@ int main( int argc, char** argv )\n     QString version;\n \n \n-#ifdef CALLIGRA_GIT_SHA1_STRING\n-    QString gitVersion(CALLIGRA_GIT_SHA1_STRING);\n+#ifdef KRITA_GIT_SHA1_STRING\n+    QString gitVersion(KRITA_GIT_SHA1_STRING);\n     version = QString(\"%1 (git %2)\").arg(calligraVersion).arg(gitVersion).toLatin1();\n #else\n     version = calligraVersion;"}, {"sha": "fb4182c215dadd8e2184fa3263d313517dac0c15", "filename": "libs/version/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/96e12c49260fdc51655281334395acf0dcb923ec/libs/version/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/96e12c49260fdc51655281334395acf0dcb923ec/libs/version/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/version/CMakeLists.txt?ref=96e12c49260fdc51655281334395acf0dcb923ec", "patch": "@@ -1,8 +1,8 @@\n # generate calligraversion.h\n configure_file(calligraversion.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/calligraversion.h)\n \n-# generate calligragitversion.h\n-configure_file(calligragitversion.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/calligragitversion.h)\n+# generate kritagitversion.h\n+configure_file(kritagitversion.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/kritagitversion.h)\n \n set(kritaversion_LIB_SRCS\n     calligraversion.cpp"}, {"sha": "952767197c1f5456ed6c9ad5a4bf89df0c5d756b", "filename": "libs/version/KritaVersionWrapper.cpp", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/96e12c49260fdc51655281334395acf0dcb923ec/libs/version/KritaVersionWrapper.cpp", "raw_url": "https://github.com/KDE/krita/raw/96e12c49260fdc51655281334395acf0dcb923ec/libs/version/KritaVersionWrapper.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/version/KritaVersionWrapper.cpp?ref=96e12c49260fdc51655281334395acf0dcb923ec", "patch": "@@ -18,16 +18,16 @@\n #include <KritaVersionWrapper.h>\n \n #include <calligraversion.h>\n-#include <calligragitversion.h>\n+#include <kritagitversion.h>\n \n QString KritaVersionWrapper::versionString(bool checkGit)\n {\n     QString calligraVersion(CALLIGRA_VERSION_STRING);\n     QString version = calligraVersion;\n \n     if (checkGit) {\n-#ifdef CALLIGRA_GIT_SHA1_STRING\n-        QString gitVersion(CALLIGRA_GIT_SHA1_STRING);\n+#ifdef KRITA_GIT_SHA1_STRING\n+        QString gitVersion(KRITA_GIT_SHA1_STRING);\n         version = QString(\"%1 (git %2)\").arg(calligraVersion).arg(gitVersion).toLatin1();\n #endif\n     }"}, {"sha": "24d5ac9ae888e5c3379bcb7685317374519f9152", "filename": "libs/version/kritagitversion.h.cmake", "status": "renamed", "additions": 11, "deletions": 11, "changes": 22, "blob_url": "https://github.com/KDE/krita/blob/96e12c49260fdc51655281334395acf0dcb923ec/libs/version/kritagitversion.h.cmake", "raw_url": "https://github.com/KDE/krita/raw/96e12c49260fdc51655281334395acf0dcb923ec/libs/version/kritagitversion.h.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/version/kritagitversion.h.cmake?ref=96e12c49260fdc51655281334395acf0dcb923ec", "patch": "@@ -18,21 +18,21 @@\n  * Boston, MA 02110-1301, USA.\n  */\n \n-#ifndef __CALLIGRA_GIT_VERSION_H\n-#define __CALLIGRA_GIT_VERSION_H\n+#ifndef __KRITA_GIT_VERSION_H\n+#define __KRITA_GIT_VERSION_H\n \n /**\n- * @def CALLIGRA_GIT_SHA1_STRING\n- * @ingroup CalligraMacros\n- * @brief Indicates the git sha1 commit which was used for compilation of Calligra\n+ * @def KRITA_GIT_SHA1_STRING\n+ * @ingroup KritaMacros\n+ * @brief Indicates the git sha1 commit which was used for compilation of Krita\n  */\n-#cmakedefine CALLIGRA_GIT_SHA1_STRING \"@CALLIGRA_GIT_SHA1_STRING@\"\n+#cmakedefine KRITA_GIT_SHA1_STRING \"@KRITA_GIT_SHA1_STRING@\"\n \n /**\n- * @def CALLIGRA_GIT_BRANCH_STRING\n- * @ingroup CalligraMacros\n- * @brief Indicates the git branch name which was used for compilation of Calligra\n+ * @def KRITA_GIT_BRANCH_STRING\n+ * @ingroup KritaMacros\n+ * @brief Indicates the git branch name which was used for compilation of Krita\n  */\n-#cmakedefine CALLIGRA_GIT_BRANCH_STRING \"@CALLIGRA_GIT_BRANCH_STRING@\"\n+#cmakedefine KRITA_GIT_BRANCH_STRING \"@KRITA_GIT_BRANCH_STRING@\"\n \n-#endif /* __CALLIGRA_GIT_VERSION_H */\n+#endif /* __KRITA_GIT_VERSION_H */", "previous_filename": "libs/version/calligragitversion.h.cmake"}]}, {"sha": "fbaf338cd87fe9be6c27225252ad9082a4fff9bd", "stats": {"total": 6, "additions": 0, "deletions": 6}, "files": [{"sha": "eb1da95ed9402ca539de930df09a6081da5598e3", "filename": "libs/version/KritaVersionWrapper.cpp", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/fbaf338cd87fe9be6c27225252ad9082a4fff9bd/libs/version/KritaVersionWrapper.cpp", "raw_url": "https://github.com/KDE/krita/raw/fbaf338cd87fe9be6c27225252ad9082a4fff9bd/libs/version/KritaVersionWrapper.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/version/KritaVersionWrapper.cpp?ref=fbaf338cd87fe9be6c27225252ad9082a4fff9bd", "patch": "@@ -20,11 +20,6 @@\n #include <calligraversion.h>\n #include <calligragitversion.h>\n \n-QString KritaVersionWrapper::versionYear()\n-{\n-    return QLatin1Literal(CALLIGRA_YEAR);\n-}\n-\n QString KritaVersionWrapper::versionString(bool checkGit)\n {\n     QString calligraVersion(CALLIGRA_VERSION_STRING);"}, {"sha": "3636f6e05f30effa94fb9a144afdab7ff4281514", "filename": "libs/version/KritaVersionWrapper.h", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/fbaf338cd87fe9be6c27225252ad9082a4fff9bd/libs/version/KritaVersionWrapper.h", "raw_url": "https://github.com/KDE/krita/raw/fbaf338cd87fe9be6c27225252ad9082a4fff9bd/libs/version/KritaVersionWrapper.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/version/KritaVersionWrapper.h?ref=fbaf338cd87fe9be6c27225252ad9082a4fff9bd", "patch": "@@ -23,7 +23,6 @@\n \n namespace KritaVersionWrapper {\n \n-    KRITAVERSION_EXPORT QString versionYear();\n     KRITAVERSION_EXPORT QString versionString(bool checkGit = false);\n }\n "}]}, {"sha": "cc079c199d70a41776a92aba6cf2950ae6179e53", "stats": {"total": 36, "additions": 18, "deletions": 18}, "files": [{"sha": "75f2a68e1f9c94357a175f394951b9c08f423146", "filename": "libs/image/metadata/kis_meta_data_filter_p.cc", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/cc079c199d70a41776a92aba6cf2950ae6179e53/libs/image/metadata/kis_meta_data_filter_p.cc", "raw_url": "https://github.com/KDE/krita/raw/cc079c199d70a41776a92aba6cf2950ae6179e53/libs/image/metadata/kis_meta_data_filter_p.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/metadata/kis_meta_data_filter_p.cc?ref=cc079c199d70a41776a92aba6cf2950ae6179e53", "patch": "@@ -20,7 +20,7 @@\n #include <QDate>\n \n #include <klocalizedstring.h>\n-#include <CalligraVersionWrapper.h>\n+#include <KritaVersionWrapper.h>\n \n #include \"kis_meta_data_entry.h\"\n #include \"kis_meta_data_schema.h\"\n@@ -107,6 +107,6 @@ void ToolInfoFilter::filter(KisMetaData::Store* store) const\n     store->getEntry(xmpSchema, \"ModifyDate\").value() = Value(QDate::currentDate());\n     store->getEntry(xmpSchema, \"MetadataDate\").value() = Value(QDate::currentDate());\n     if (!store->containsEntry(xmpSchema, \"CreatorTool\")) {\n-        store->getEntry(xmpSchema, \"CreatorTool\").value() = Value(i18n(\"Krita %1\", CalligraVersionWrapper::versionString()));\n+        store->getEntry(xmpSchema, \"CreatorTool\").value() = Value(i18n(\"Krita %1\", KritaVersionWrapper::versionString()));\n     }\n }"}, {"sha": "d72caa3bdd58f4c350d1130db6197ed3059fb8c4", "filename": "libs/odf/KoDocumentInfo.cpp", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/cc079c199d70a41776a92aba6cf2950ae6179e53/libs/odf/KoDocumentInfo.cpp", "raw_url": "https://github.com/KDE/krita/raw/cc079c199d70a41776a92aba6cf2950ae6179e53/libs/odf/KoDocumentInfo.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/odf/KoDocumentInfo.cpp?ref=cc079c199d70a41776a92aba6cf2950ae6179e53", "patch": "@@ -37,7 +37,7 @@\n #include <kuser.h>\n #include <kemailsettings.h>\n \n-#include <CalligraVersionWrapper.h>\n+#include <KritaVersionWrapper.h>\n \n \n KoDocumentInfo::KoDocumentInfo(QObject *parent) : QObject(parent)\n@@ -124,7 +124,7 @@ bool KoDocumentInfo::saveOasis(KoStore *store)\n \n     xmlWriter->startElement(\"meta:generator\");\n     xmlWriter->addTextNode(QString(\"Calligra/%1\")\n-                           .arg(CalligraVersionWrapper::versionString()));\n+                           .arg(KritaVersionWrapper::versionString()));\n     xmlWriter->endElement();\n \n     if (!saveOasisAboutInfo(*xmlWriter))"}, {"sha": "2e3cdaae785461d9f175665263b32e0276987cd8", "filename": "libs/ui/KisApplication.cpp", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/cc079c199d70a41776a92aba6cf2950ae6179e53/libs/ui/KisApplication.cpp", "raw_url": "https://github.com/KDE/krita/raw/cc079c199d70a41776a92aba6cf2950ae6179e53/libs/ui/KisApplication.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisApplication.cpp?ref=cc079c199d70a41776a92aba6cf2950ae6179e53", "patch": "@@ -87,7 +87,7 @@\n \n #include \"opengl/kis_opengl.h\"\n \n-#include <CalligraVersionWrapper.h>\n+#include <KritaVersionWrapper.h>\n namespace {\n const QTime appStartTime(QTime::currentTime());\n }\n@@ -152,7 +152,7 @@ KisApplication::KisApplication(const QString &key, int &argc, char **argv)\n //    setOrganizationName(\"krita\");\n     setOrganizationDomain(\"krita.org\");\n \n-    QString version = CalligraVersionWrapper::versionString(true);\n+    QString version = KritaVersionWrapper::versionString(true);\n     setApplicationVersion(version);\n     setWindowIcon(KisIconUtils::loadIcon(\"calligrakrita\"));\n "}, {"sha": "b36a3f74caeca8e4d9a5230c1398f7800bc999fa", "filename": "libs/ui/KisResourceBundle.cpp", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/cc079c199d70a41776a92aba6cf2950ae6179e53/libs/ui/KisResourceBundle.cpp", "raw_url": "https://github.com/KDE/krita/raw/cc079c199d70a41776a92aba6cf2950ae6179e53/libs/ui/KisResourceBundle.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisResourceBundle.cpp?ref=cc079c199d70a41776a92aba6cf2950ae6179e53", "patch": "@@ -47,14 +47,14 @@\n #include <kis_brush_server.h>\n #include <kis_debug.h>\n \n-#include <CalligraVersionWrapper.h>\n+#include <KritaVersionWrapper.h>\n \n KisResourceBundle::KisResourceBundle(QString const& fileName)\n     : KoResource(fileName),\n       m_bundleVersion(\"1\")\n {\n     setName(QFileInfo(fileName).baseName());\n-    m_metadata[\"generator\"] = \"Krita (\" + CalligraVersionWrapper::versionString(true) + \")\";\n+    m_metadata[\"generator\"] = \"Krita (\" + KritaVersionWrapper::versionString(true) + \")\";\n }\n \n KisResourceBundle::~KisResourceBundle()"}, {"sha": "19b355e82685f378aa2a3548995c8f2e9d8991f2", "filename": "libs/ui/resourcemanager/resourcebundle.cpp", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/cc079c199d70a41776a92aba6cf2950ae6179e53/libs/ui/resourcemanager/resourcebundle.cpp", "raw_url": "https://github.com/KDE/krita/raw/cc079c199d70a41776a92aba6cf2950ae6179e53/libs/ui/resourcemanager/resourcebundle.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/resourcemanager/resourcebundle.cpp?ref=cc079c199d70a41776a92aba6cf2950ae6179e53", "patch": "@@ -49,7 +49,7 @@\n #include <kis_brush_server.h>\n #include <kis_debug.h>\n \n-#include <CalligraVersionWrapper.h>\n+#include <KritaVersionWrapper.h>\n \n \n #include \"resourcemanager.h\"\n@@ -60,7 +60,7 @@ ResourceBundle::ResourceBundle(QString const& fileName)\n       m_bundleVersion(\"1\")\n {\n     setName(QFileInfo(fileName).baseName());\n-    m_metadata[\"generator\"] = \"Krita (\" + CalligraVersionWrapper::versionString(true) + \")\";\n+    m_metadata[\"generator\"] = \"Krita (\" + KritaVersionWrapper::versionString(true) + \")\";\n }\n \n ResourceBundle::~ResourceBundle()"}, {"sha": "3dd13fa725a75ae900763019e33de68fa7bb1941", "filename": "libs/version/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/cc079c199d70a41776a92aba6cf2950ae6179e53/libs/version/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/cc079c199d70a41776a92aba6cf2950ae6179e53/libs/version/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/version/CMakeLists.txt?ref=cc079c199d70a41776a92aba6cf2950ae6179e53", "patch": "@@ -6,7 +6,7 @@ configure_file(calligragitversion.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/calligragi\n \n set(kritaversion_LIB_SRCS\n     calligraversion.cpp\n-    CalligraVersionWrapper.cpp\n+    KritaVersionWrapper.cpp\n )\n \n add_library(kritaversion SHARED ${kritaversion_LIB_SRCS})"}, {"sha": "c84d115d33e84155959930c735dfe0db9f6aeeef", "filename": "libs/version/KritaVersionWrapper.cpp", "status": "renamed", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/cc079c199d70a41776a92aba6cf2950ae6179e53/libs/version/KritaVersionWrapper.cpp", "raw_url": "https://github.com/KDE/krita/raw/cc079c199d70a41776a92aba6cf2950ae6179e53/libs/version/KritaVersionWrapper.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/version/KritaVersionWrapper.cpp?ref=cc079c199d70a41776a92aba6cf2950ae6179e53", "patch": "@@ -15,17 +15,17 @@\n  *  along with this program; if not, write to the Free Software\n  *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.\n  */\n-#include <CalligraVersionWrapper.h>\n+#include <KritaVersionWrapper.h>\n \n #include <calligraversion.h>\n #include <calligragitversion.h>\n \n-QString CalligraVersionWrapper::versionYear()\n+QString KritaVersionWrapper::versionYear()\n {\n     return QLatin1Literal(CALLIGRA_YEAR);\n }\n \n-QString CalligraVersionWrapper::versionString(bool checkGit)\n+QString KritaVersionWrapper::versionString(bool checkGit)\n {\n     QString calligraVersion(CALLIGRA_VERSION_STRING);\n     QString version = calligraVersion;", "previous_filename": "libs/version/CalligraVersionWrapper.cpp"}, {"sha": "244d037d88139c430c52a14c1882d2ee5c499247", "filename": "libs/version/KritaVersionWrapper.h", "status": "renamed", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/cc079c199d70a41776a92aba6cf2950ae6179e53/libs/version/KritaVersionWrapper.h", "raw_url": "https://github.com/KDE/krita/raw/cc079c199d70a41776a92aba6cf2950ae6179e53/libs/version/KritaVersionWrapper.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/version/KritaVersionWrapper.h?ref=cc079c199d70a41776a92aba6cf2950ae6179e53", "patch": "@@ -15,16 +15,16 @@\n  *  along with this program; if not, write to the Free Software\n  *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.\n  */\n-#ifndef CALLIGRAVERSIONWRAPPER_H\n-#define CALLIGRAVERSIONWRAPPER_H\n+#ifndef KRITAVERSIONWRAPPER_H\n+#define KRITAVERSIONWRAPPER_H\n \n #include \"kritaversion_export.h\"\n #include <QString>\n \n-namespace CalligraVersionWrapper {\n+namespace KritaVersionWrapper {\n \n     KRITAVERSION_EXPORT QString versionYear();\n     KRITAVERSION_EXPORT QString versionString(bool checkGit = false);\n }\n \n-#endif // CALLIGRAVERSIONWRAPPER_H\n+#endif // KRITAVERSIONWRAPPER_H", "previous_filename": "libs/version/CalligraVersionWrapper.h"}]}, {"sha": "03c04fa680a132c7ca08870fefff3086044efd7d", "stats": {"total": 60, "additions": 30, "deletions": 30}, "files": [{"sha": "de470bc6a9e54e3cccb0d1783c49460012291bb4", "filename": "CMakeLists.txt", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -90,18 +90,18 @@ endif()\n \n message(STATUS \"Krita version: ${CALLIGRA_VERSION_STRING}\")\n \n-# Define the generic version of the Calligra libraries here\n-# This makes it easy to advance it when the next Calligra release comes.\n-# 14 was the last GENERIC_CALLIGRA_LIB_VERSION_MAJOR of the previous Calligra series\n+# Define the generic version of the Krita libraries here\n+# This makes it easy to advance it when the next Krita release comes.\n+# 14 was the last GENERIC_KRITA_LIB_VERSION_MAJOR of the previous Krita series\n # (2.x) so we're starting with 15 in 3.x series.\n if(CALLIGRA_STABLE_VERSION_MAJOR EQUAL 3)\n-    math(EXPR GENERIC_CALLIGRA_LIB_VERSION_MAJOR \"${CALLIGRA_STABLE_VERSION_MINOR} + 15\")\n+    math(EXPR GENERIC_KRITA_LIB_VERSION_MAJOR \"${CALLIGRA_STABLE_VERSION_MINOR} + 15\")\n else()\n     # let's make sure we won't forget to update the \"15\"\n-    message(FATAL_ERROR \"Reminder: please update offset == 15 used to compute GENERIC_CALLIGRA_LIB_VERSION_MAJOR to something bigger\")\n+    message(FATAL_ERROR \"Reminder: please update offset == 15 used to compute GENERIC_KRITA_LIB_VERSION_MAJOR to something bigger\")\n endif()\n-set(GENERIC_CALLIGRA_LIB_VERSION \"${GENERIC_CALLIGRA_LIB_VERSION_MAJOR}.0.0\")\n-set(GENERIC_CALLIGRA_LIB_SOVERSION \"${GENERIC_CALLIGRA_LIB_VERSION_MAJOR}\")\n+set(GENERIC_KRITA_LIB_VERSION \"${GENERIC_KRITA_LIB_VERSION_MAJOR}.0.0\")\n+set(GENERIC_KRITA_LIB_SOVERSION \"${GENERIC_KRITA_LIB_VERSION_MAJOR}\")\n \n set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH}\n                       \"${CMAKE_SOURCE_DIR}/cmake/modules\")"}, {"sha": "8b442794697401b50102015ae5fdc9197fa08dd7", "filename": "krita/sketch/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/krita/sketch/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/krita/sketch/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/sketch/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -114,7 +114,7 @@ endif ()\n add_library(kritasketchlib SHARED ${kritasketchlib_SRCS})\n generate_export_header(kritasketchlib BASE_NAME krita_sketch)\n set_target_properties(kritasketchlib\n-    PROPERTIES VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+    PROPERTIES VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n \n "}, {"sha": "84ec04884949c4def80a25e12654fcd80ca1ce60", "filename": "libs/basicflakes/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/libs/basicflakes/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/libs/basicflakes/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/basicflakes/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -31,7 +31,7 @@ target_link_libraries(kritabasicflakes\n )\n \n set_target_properties(kritabasicflakes PROPERTIES\n-    VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+    VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n \n install(TARGETS kritabasicflakes  ${INSTALL_TARGETS_DEFAULT_ARGS})"}, {"sha": "ab1e23f79f6af95d89d2950df1243eb2e0d39dca", "filename": "libs/brush/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/libs/brush/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/libs/brush/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/brush/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -43,7 +43,7 @@ endif()\n target_link_libraries(kritalibbrush LINK_INTERFACE_LIBRARIES kritaimage Qt5::Svg)\n \n set_target_properties(kritalibbrush PROPERTIES\n-    VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+    VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n \n install(TARGETS kritalibbrush  ${INSTALL_TARGETS_DEFAULT_ARGS})"}, {"sha": "46302223cf8b422785a7fc11ff459cf12bf73bc5", "filename": "libs/color/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/libs/color/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/libs/color/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/color/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -16,7 +16,7 @@ target_link_libraries(kritacolor kritaglobal ${QT_QTCORE_LIBRARY} KF5::I18n  ${k\n target_link_libraries(kritacolor LINK_INTERFACE_LIBRARIES kritaglobal ${QT_QTCORE_LIBRARY})\n \n set_target_properties(kritacolor PROPERTIES\n-    VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+    VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n \n install(TARGETS kritacolor  ${INSTALL_TARGETS_DEFAULT_ARGS})"}, {"sha": "c63e0821b81f043784a045d06897bfb306c04dff", "filename": "libs/flake/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/libs/flake/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/libs/flake/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/flake/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -219,7 +219,7 @@ target_link_libraries(kritaflake kritapigment kritawidgetutils kritaodf kritaund\n target_link_libraries(kritaflake LINK_INTERFACE_LIBRARIES kritapigment kritawidgetutils kritaodf kritaundo2 KF5::WidgetsAddons )\n \n set_target_properties(kritaflake PROPERTIES\n-    VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+    VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n \n install(TARGETS kritaflake  ${INSTALL_TARGETS_DEFAULT_ARGS})"}, {"sha": "9092bfc23c57accf55850434ba5b3d9d8dfa7f14", "filename": "libs/global/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/libs/global/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/libs/global/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/global/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -29,7 +29,7 @@ target_link_libraries(kritaglobal\n )\n \n set_target_properties(kritaglobal PROPERTIES\n-    VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+    VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n \n install(TARGETS kritaglobal  ${INSTALL_TARGETS_DEFAULT_ARGS})"}, {"sha": "6028c01c18f998cdb0f3074d575e206e344f2d0c", "filename": "libs/image/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/libs/image/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/libs/image/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -357,7 +357,7 @@ target_include_directories(kritaimage\n )\n \n set_target_properties(kritaimage PROPERTIES\n-    VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+    VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n install(TARGETS kritaimage  ${INSTALL_TARGETS_DEFAULT_ARGS})\n "}, {"sha": "fc048721a7313c6fe34b11ed48c164ab559b5bb2", "filename": "libs/koplugin/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/libs/koplugin/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/libs/koplugin/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/koplugin/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -24,7 +24,7 @@ target_link_libraries(kritaplugin\n )\n \n set_target_properties(kritaplugin PROPERTIES\n-    VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+    VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n install(TARGETS kritaplugin ${INSTALL_TARGETS_DEFAULT_ARGS} )\n "}, {"sha": "f787022e55472713a511d1ad909ebf8f4371d59e", "filename": "libs/kundo2/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/libs/kundo2/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/libs/kundo2/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/kundo2/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -20,6 +20,6 @@ target_link_libraries(kritaundo2\n )\n \n set_target_properties(kritaundo2 PROPERTIES\n-    VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+    VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n install(TARGETS kritaundo2 ${INSTALL_TARGETS_DEFAULT_ARGS})"}, {"sha": "7df7b66af874aca9dfe12df7c7e6a28b903104e3", "filename": "libs/odf/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/libs/odf/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/libs/odf/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/odf/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -42,6 +42,6 @@ target_link_libraries(kritaodf kritaversion kritaplugin kritastore KF5::CoreAddo\n target_link_libraries(kritaodf LINK_INTERFACE_LIBRARIES kritastore KF5::CoreAddons KF5::I18n Qt5::PrintSupport Qt5::Gui Qt5::Xml)\n \n set_target_properties(kritaodf PROPERTIES\n-    VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+    VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n install(TARGETS kritaodf ${INSTALL_TARGETS_DEFAULT_ARGS} )"}, {"sha": "eed072921dd371cfa058292f9fa7a52f7ec45ccd", "filename": "libs/pigment/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/libs/pigment/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/libs/pigment/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -115,7 +115,7 @@ target_link_libraries( kritapigment\n )\n \n set_target_properties(kritapigment PROPERTIES\n-    VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+    VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n \n install(TARGETS kritapigment  ${INSTALL_TARGETS_DEFAULT_ARGS})"}, {"sha": "f343f14e808141fb0577612d38fd8b2a226d2831", "filename": "libs/psd/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/libs/psd/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/libs/psd/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/psd/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -30,7 +30,7 @@ endif (WIN32)\n \n target_link_libraries(kritapsd LINK_INTERFACE_LIBRARIES kritaglobal ${QT_QTCORE_LIBRARY} ${QT_QTGUI_LIBRARY})\n set_target_properties(kritapsd PROPERTIES\n-    VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+    VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n \n install(TARGETS kritapsd  ${INSTALL_TARGETS_DEFAULT_ARGS})"}, {"sha": "b20d442ad10a87e6353c06d8e328c78c9ad80518", "filename": "libs/store/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/libs/store/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/libs/store/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/store/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -17,7 +17,7 @@ generate_export_header(kritastore BASE_NAME kritastore)\n target_link_libraries(kritastore kritaversion Qt5::Xml Qt5::Gui KF5::Archive)\n \n set_target_properties(kritastore PROPERTIES\n-    VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+    VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n install(TARGETS kritastore ${INSTALL_TARGETS_DEFAULT_ARGS} )\n "}, {"sha": "c2e53dbfc887c42711baa3b54926e9d30129aa75", "filename": "libs/ui/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/libs/ui/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/libs/ui/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -519,7 +519,7 @@ target_include_directories(kritaui\n )\n \n set_target_properties(kritaui\n-    PROPERTIES VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+    PROPERTIES VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n install(TARGETS kritaui  ${INSTALL_TARGETS_DEFAULT_ARGS})\n "}, {"sha": "d99c5862e1ed3bccb205fadf6c0770da169dd0b7", "filename": "libs/vectorimage/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/libs/vectorimage/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/libs/vectorimage/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/vectorimage/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -44,6 +44,6 @@ target_include_directories(kritavectorimage\n target_link_libraries(kritavectorimage  KF5::I18n Qt5::Gui Qt5::PrintSupport)\n \n set_target_properties(kritavectorimage PROPERTIES\n-    VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+    VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n install(TARGETS kritavectorimage ${INSTALL_TARGETS_DEFAULT_ARGS} )"}, {"sha": "eff0bfb5f1e1426cdb097ee70a556c53dd453e6e", "filename": "libs/vectorimage/libsvm/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/libs/vectorimage/libsvm/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/libs/vectorimage/libsvm/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/vectorimage/libsvm/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -11,5 +11,5 @@ set(libsvm_LIB_SRCS\n \n #target_link_libraries(libsvm   Qt5::Gui )\n \n-#set_target_properties(libsvm PROPERTIES VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION} )\n+#set_target_properties(libsvm PROPERTIES VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION} )\n "}, {"sha": "8d16a2c055565f70d32d7343d850371da2dbe785", "filename": "libs/vectorimage/libwmf/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/libs/vectorimage/libwmf/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/libs/vectorimage/libwmf/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/vectorimage/libwmf/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -12,6 +12,6 @@ add_library(libwmf SHARED ${libwmf_LIB_SRCS})\n \n target_link_libraries(libwmf   Qt5::Gui)\n \n-set_target_properties(libwmf PROPERTIES VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION} )\n+set_target_properties(libwmf PROPERTIES VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION} )\n install(TARGETS libwmf  ${INSTALL_TARGETS_DEFAULT_ARGS})\n "}, {"sha": "74536b73d2060d89a47c43396b0255e7ab4c52b3", "filename": "libs/version/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/libs/version/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/libs/version/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/version/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -14,7 +14,7 @@ target_link_libraries(kritaversion Qt5::Core)\n generate_export_header(kritaversion BASE_NAME kritaversion)\n \n set_target_properties(kritaversion PROPERTIES\n-    VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+    VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n install(TARGETS kritaversion ${INSTALL_TARGETS_DEFAULT_ARGS} )\n "}, {"sha": "4efe85fc0e12c711505ba162bc5e719967bf2bb5", "filename": "libs/widgets/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/libs/widgets/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/libs/widgets/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgets/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -101,7 +101,7 @@ endif()\n target_link_libraries(kritawidgets LINK_INTERFACE_LIBRARIES  kritaodf kritaflake kritapigment kritawidgetutils Qt5::PrintSupport KF5::CoreAddons KF5::ConfigGui KF5::GuiAddons KF5::WidgetsAddons KF5::ConfigCore KF5::Completion)\n \n set_target_properties(kritawidgets PROPERTIES\n-    VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+    VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n \n install(TARGETS kritawidgets  ${INSTALL_TARGETS_DEFAULT_ARGS})"}, {"sha": "f54a46ee49f6b13aabe796da6f18e77f4a2ea496", "filename": "libs/widgetutils/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/libs/widgetutils/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/libs/widgetutils/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -119,7 +119,7 @@ target_link_libraries(kritawidgetutils\n )\n \n set_target_properties(kritawidgetutils\n-    PROPERTIES VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+    PROPERTIES VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n \n install(TARGETS kritawidgetutils ${INSTALL_TARGETS_DEFAULT_ARGS})"}, {"sha": "f5395bfcb2c333785d8b4f0f30ff414d7d9394a3", "filename": "plugins/flake/textshape/kotext/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/plugins/flake/textshape/kotext/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/plugins/flake/textshape/kotext/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/flake/textshape/kotext/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -131,6 +131,6 @@ target_include_directories(kritatext\n     $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/styles>\n )\n set_target_properties(kritatext PROPERTIES\n-   VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+   VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n install(TARGETS kritatext  ${INSTALL_TARGETS_DEFAULT_ARGS})"}, {"sha": "3b6a93815255ad2327496f87623acde73d96738f", "filename": "plugins/flake/textshape/textlayout/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/plugins/flake/textshape/textlayout/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/plugins/flake/textshape/textlayout/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/flake/textshape/textlayout/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -34,6 +34,6 @@ target_link_libraries(kritatextlayout kritatext)\n target_link_libraries(kritatextlayout LINK_INTERFACE_LIBRARIES kritatext)\n \n set_target_properties(kritatextlayout PROPERTIES\n-   VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+   VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n install(TARGETS kritatextlayout  ${INSTALL_TARGETS_DEFAULT_ARGS})"}, {"sha": "6275b75e8861fd999d537aa71b6e80b92fe648ff", "filename": "plugins/paintops/libpaintop/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/03c04fa680a132c7ca08870fefff3086044efd7d/plugins/paintops/libpaintop/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/03c04fa680a132c7ca08870fefff3086044efd7d/plugins/paintops/libpaintop/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/libpaintop/CMakeLists.txt?ref=03c04fa680a132c7ca08870fefff3086044efd7d", "patch": "@@ -88,7 +88,7 @@ target_link_libraries(kritalibpaintop kritaui kritalibbrush kritawidgetutils)\n target_link_libraries(kritalibpaintop LINK_INTERFACE_LIBRARIES kritaui kritalibbrush)\n \n set_target_properties(kritalibpaintop PROPERTIES\n-    VERSION ${GENERIC_CALLIGRA_LIB_VERSION} SOVERSION ${GENERIC_CALLIGRA_LIB_SOVERSION}\n+    VERSION ${GENERIC_KRITA_LIB_VERSION} SOVERSION ${GENERIC_KRITA_LIB_SOVERSION}\n )\n \n install(TARGETS kritalibpaintop  ${INSTALL_TARGETS_DEFAULT_ARGS})"}]}, {"sha": "2a165e167dbbe5f18e1100300fc404e1317436fe", "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "756f2bf39377a2288f42b627cb0b0efc1dddac4f", "filename": "CMakeLists.txt", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/KDE/krita/blob/2a165e167dbbe5f18e1100300fc404e1317436fe/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/2a165e167dbbe5f18e1100300fc404e1317436fe/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=2a165e167dbbe5f18e1100300fc404e1317436fe", "patch": "@@ -75,14 +75,14 @@ endif()\n \n # define common versions of Calligra applications, used to generate calligraversion.h\n # update these version for every release:\n-set(CALLIGRA_VERSION_STRING \"3.0 Alpha\")\n+set(CALLIGRA_VERSION_STRING \"3.0 Beta\")\n set(CALLIGRA_STABLE_VERSION_MAJOR 3) # 3 for 3.x, 4 for 4.x, etc.\n set(CALLIGRA_STABLE_VERSION_MINOR 0) # 0 for 3.0, 1 for 3.1, etc.\n-set(CALLIGRA_VERSION_RELEASE 89)     # 89 for Alpha, increase for next test releases, set 0 for first Stable, etc.\n-set(CALLIGRA_ALPHA 1) # uncomment only for Alpha\n-#set(CALLIGRA_BETA 1) # uncomment only for Beta\n+set(CALLIGRA_VERSION_RELEASE 90)     # 89 for Alpha, increase for next test releases, set 0 for first Stable, etc.\n+#set(CALLIGRA_ALPHA 1) # uncomment only for Alpha\n+set(CALLIGRA_BETA 1) # uncomment only for Beta\n #set(CALLIGRA_RC 1) # uncomment only for RC\n-set(CALLIGRA_YEAR 2015) # update every year\n+set(CALLIGRA_YEAR 2016) # update every year\n \n if(NOT DEFINED CALLIGRA_ALPHA AND NOT DEFINED CALLIGRA_BETA AND NOT DEFINED CALLIGRA_RC)\n     set(CALLIGRA_STABLE 1) # do not edit"}]}, {"sha": "ca810f8531812be671eb9810b6e505f7d3cdadbc", "stats": {"total": 29, "additions": 28, "deletions": 1}, "files": [{"sha": "390892f53429b285e142286d9b9175c8e40a0495", "filename": "libs/image/filter/kis_filter.cc", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/ca810f8531812be671eb9810b6e505f7d3cdadbc/libs/image/filter/kis_filter.cc", "raw_url": "https://github.com/KDE/krita/raw/ca810f8531812be671eb9810b6e505f7d3cdadbc/libs/image/filter/kis_filter.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/filter/kis_filter.cc?ref=ca810f8531812be671eb9810b6e505f7d3cdadbc", "patch": "@@ -164,3 +164,11 @@ void KisFilter::setSupportsLevelOfDetail(bool value)\n {\n     m_supportsLevelOfDetail = value;\n }\n+\n+bool KisFilter::needsTransparentPixels(const KisFilterConfiguration *config, const KoColorSpace *cs) const\n+{\n+    Q_UNUSED(config);\n+    Q_UNUSED(cs);\n+\n+    return false;\n+}"}, {"sha": "956d11d5001565f1bf296b1706edd57a76270f13", "filename": "libs/image/filter/kis_filter.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/ca810f8531812be671eb9810b6e505f7d3cdadbc/libs/image/filter/kis_filter.h", "raw_url": "https://github.com/KDE/krita/raw/ca810f8531812be671eb9810b6e505f7d3cdadbc/libs/image/filter/kis_filter.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/filter/kis_filter.h?ref=ca810f8531812be671eb9810b6e505f7d3cdadbc", "patch": "@@ -125,6 +125,8 @@ class KRITAIMAGE_EXPORT KisFilter : public KisBaseProcessor\n      */\n     virtual bool supportsLevelOfDetail(const KisFilterConfiguration *config, int lod) const;\n \n+    virtual bool needsTransparentPixels(const KisFilterConfiguration *config, const KoColorSpace *cs) const;\n+\n protected:\n \n     QString configEntryGroup() const;"}, {"sha": "d3a0c2d75511f1f4e88c3c97f84516755d171e74", "filename": "libs/ui/kis_filter_manager.cc", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/KDE/krita/blob/ca810f8531812be671eb9810b6e505f7d3cdadbc/libs/ui/kis_filter_manager.cc", "raw_url": "https://github.com/KDE/krita/raw/ca810f8531812be671eb9810b6e505f7d3cdadbc/libs/ui/kis_filter_manager.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kis_filter_manager.cc?ref=ca810f8531812be671eb9810b6e505f7d3cdadbc", "patch": "@@ -252,7 +252,15 @@ void KisFilterManager::apply(KisSafeFilterConfigurationSP filterConfig)\n         d->currentStrokeId.clear();\n     } else {\n         image->waitForDone();\n-        d->currentApplyRect = d->view->activeNode()->exactBounds();\n+    }\n+\n+    d->currentApplyRect = d->view->activeNode()->exactBounds();\n+\n+    KisPaintDeviceSP paintDevice = d->view->activeNode()->paintDevice();\n+    if (paintDevice &&\n+        filter->needsTransparentPixels(filterConfig.data(), paintDevice->colorSpace())) {\n+\n+        d->currentApplyRect |= image->bounds();\n     }\n \n     KisPostExecutionUndoAdapter *undoAdapter ="}, {"sha": "53dbe948eb13f493ef735878cca7eae43fc87982", "filename": "plugins/filters/example/example.cpp", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/ca810f8531812be671eb9810b6e505f7d3cdadbc/plugins/filters/example/example.cpp", "raw_url": "https://github.com/KDE/krita/raw/ca810f8531812be671eb9810b6e505f7d3cdadbc/plugins/filters/example/example.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/example/example.cpp?ref=ca810f8531812be671eb9810b6e505f7d3cdadbc", "patch": "@@ -35,6 +35,7 @@\n #include <kis_layer.h>\n #include <filter/kis_filter_registry.h>\n #include <kis_global.h>\n+#include \"KoColorModelStandardIds.h\"\n \n K_PLUGIN_FACTORY_WITH_JSON(KritaExampleFactory, \"kritaexample.json\", registerPlugin<KritaExample>();)\n \n@@ -54,6 +55,7 @@ KisFilterInvert::KisFilterInvert() : KisColorTransformationFilter(id(), category\n     setColorSpaceIndependence(FULLY_INDEPENDENT);\n     setSupportsPainting(true);\n     setShowConfigurationWidget(false);\n+    setSupportsLevelOfDetail(true);\n }\n \n KoColorTransformation* KisFilterInvert::createTransformation(const KoColorSpace* cs, const KisFilterConfiguration* config) const\n@@ -62,4 +64,10 @@ KoColorTransformation* KisFilterInvert::createTransformation(const KoColorSpace*\n     return cs->createInvertTransformation();\n }\n \n+bool KisFilterInvert::needsTransparentPixels(const KisFilterConfiguration *config, const KoColorSpace *cs) const\n+{\n+    Q_UNUSED(config);\n+    return cs->colorModelId() == AlphaColorModelID;\n+}\n+\n #include \"example.moc\""}, {"sha": "6632b89baf6e669187f267894e4f88059980d5c9", "filename": "plugins/filters/example/example.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/ca810f8531812be671eb9810b6e505f7d3cdadbc/plugins/filters/example/example.h", "raw_url": "https://github.com/KDE/krita/raw/ca810f8531812be671eb9810b6e505f7d3cdadbc/plugins/filters/example/example.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/example/example.h?ref=ca810f8531812be671eb9810b6e505f7d3cdadbc", "patch": "@@ -45,6 +45,7 @@ class KisFilterInvert : public KisColorTransformationFilter\n         return KoID(\"invert\", i18n(\"Invert\"));\n     }\n \n+    bool needsTransparentPixels(const KisFilterConfiguration *config, const KoColorSpace *cs) const;\n };\n \n #endif"}]}, {"sha": "992ea4f3e72d6178f820a164d4f7f75ac3be181c", "stats": {"total": 64, "additions": 46, "deletions": 18}, "files": [{"sha": "49551b8cd5d076035c45368ebd4e5370d2f3dba5", "filename": "plugins/paintops/tangentnormal/kis_tangent_normal_paintop.cpp", "status": "modified", "additions": 46, "deletions": 18, "changes": 64, "blob_url": "https://github.com/KDE/krita/blob/992ea4f3e72d6178f820a164d4f7f75ac3be181c/plugins/paintops/tangentnormal/kis_tangent_normal_paintop.cpp", "raw_url": "https://github.com/KDE/krita/raw/992ea4f3e72d6178f820a164d4f7f75ac3be181c/plugins/paintops/tangentnormal/kis_tangent_normal_paintop.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/tangentnormal/kis_tangent_normal_paintop.cpp?ref=992ea4f3e72d6178f820a164d4f7f75ac3be181c", "patch": "@@ -85,18 +85,32 @@ KisSpacingInformation KisTangentNormalPaintOp::paintAt(const KisPaintInformation\n \trgbColorSpace = currentColor.colorSpace();\n     }\n     QVector <float> channelValues(4);\n+    qreal r, g, b;\n \n-    channelValues[0] = 1.0;//blue\n-    channelValues[1] = 0.5;//green\n-    channelValues[2] = 0.5;//red\n-    channelValues[3] = 1.0;//alpha, leave alone.\n+    if (currentColor.colorSpace()->colorDepthId().id()==\"F16\" || currentColor.colorSpace()->colorDepthId().id()==\"F32\"){\n+        channelValues[0] = 0.5;//red\n+        channelValues[1] = 0.5;//green\n+        channelValues[2] = 1.0;//blue\n+        channelValues[3] = 1.0;//alpha, leave alone.\n \n-    qreal r, g, b;\n-    m_tangentTiltOption.apply(info, &r, &g, &b);\n \n-    channelValues[0] = b;//blue\n-    channelValues[1] = g;//green\n-    channelValues[2] = r;//red\n+        m_tangentTiltOption.apply(info, &r, &g, &b);\n+\n+        channelValues[0] = r;//red\n+        channelValues[1] = g;//green\n+        channelValues[2] = b;//blue\n+    } else {\n+        channelValues[0] = 1.0;//blue\n+        channelValues[1] = 0.5;//green\n+        channelValues[2] = 0.5;//red\n+        channelValues[3] = 1.0;//alpha, leave alone.\n+\n+        m_tangentTiltOption.apply(info, &r, &g, &b);\n+\n+        channelValues[0] = b;//blue\n+        channelValues[1] = g;//green\n+        channelValues[2] = r;//red\n+    }\n \n     quint8 data[4];\n     rgbColorSpace->fromNormalisedChannelsValue(data, channelValues);\n@@ -178,18 +192,32 @@ void KisTangentNormalPaintOp::paintLine(const KisPaintInformation& pi1, const Ki\n \t    rgbColorSpace = currentColor.colorSpace();\n \t}\n \tQVector <float> channelValues(4);\n+    qreal r, g, b;\n+\n+\tif (currentColor.colorSpace()->colorDepthId().id()==\"F16\" || currentColor.colorSpace()->colorDepthId().id()==\"F32\"){\n+        channelValues[0] = 0.5;//red\n+        channelValues[1] = 0.5;//green\n+        channelValues[2] = 1.0;//blue\n+        channelValues[3] = 1.0;//alpha, leave alone.\n+\n \n-\tchannelValues[0] = 1.0;//blue\n-\tchannelValues[1] = 0.5;//green\n-\tchannelValues[2] = 0.5;//red\n-\tchannelValues[3] = 1.0;//alpha, leave alone.\n+        m_tangentTiltOption.apply(pi2, &r, &g, &b);\n \n-\tqreal r, g, b;\n-\tm_tangentTiltOption.apply(pi2, &r, &g, &b);\n+        channelValues[0] = r;//red\n+        channelValues[1] = g;//green\n+        channelValues[2] = b;//blue\n+    } else {\n+        channelValues[0] = 1.0;//blue\n+        channelValues[1] = 0.5;//green\n+        channelValues[2] = 0.5;//red\n+        channelValues[3] = 1.0;//alpha, leave alone.\n+\n+        m_tangentTiltOption.apply(pi2, &r, &g, &b);\n \n-\tchannelValues[0] = b;//blue\n-\tchannelValues[1] = g;//green\n-\tchannelValues[2] = r;//red\n+        channelValues[0] = b;//blue\n+        channelValues[1] = g;//green\n+        channelValues[2] = r;//red\n+    }\n \n \tquint8 data[4];\n \trgbColorSpace->fromNormalisedChannelsValue(data, channelValues);"}]}, {"sha": "3fba314ffa7fcb3d07f62be9f04fbe5ad8978286", "stats": {"total": 10, "additions": 10, "deletions": 0}, "files": [{"sha": "7f79ddf796d393b38e6e7ce53fef9454964b6148", "filename": "krita/main.cc", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/KDE/krita/blob/3fba314ffa7fcb3d07f62be9f04fbe5ad8978286/krita/main.cc", "raw_url": "https://github.com/KDE/krita/raw/3fba314ffa7fcb3d07f62be9f04fbe5ad8978286/krita/main.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/main.cc?ref=3fba314ffa7fcb3d07f62be9f04fbe5ad8978286", "patch": "@@ -61,6 +61,16 @@\n #endif\n extern \"C\" int main(int argc, char **argv)\n {\n+    /**\n+     * Add a workaround for Qt 5.6, which implemented compression of the tablet events.\n+     * Since Qt 5.6.1 there will be this hacky environment variable option. After that,\n+     * Qt developers promised to give us better control for that. Please make sure the env\n+     * variable is set *before* the construction of QApplication!\n+     */\n+#if defined Q_OS_LINUX && QT_VERSION >= 0x050600\n+    qputenv(\"QT_XCB_NO_EVENT_COMPRESSION\", \"1\");\n+#endif\n+\n     bool runningInKDE = !qgetenv(\"KDE_FULL_SESSION\").isEmpty();\n \n     /**"}]}, {"sha": "146283952d5a007b6cc74a7bd24d0fc4e18f792d", "stats": {"total": 106, "additions": 85, "deletions": 21}, "files": [{"sha": "3ae6e07d81e89069e2ff23ed7bd11daedeb6cd3e", "filename": "CMakeLists.txt", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/146283952d5a007b6cc74a7bd24d0fc4e18f792d/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/146283952d5a007b6cc74a7bd24d0fc4e18f792d/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=146283952d5a007b6cc74a7bd24d0fc4e18f792d", "patch": "@@ -148,6 +148,9 @@ if (WIN32)\n     option(USE_BREAKPAD \"Build the crash handler for Krita (only on windows)\" OFF)\n endif ()\n \n+option(HIDE_SAFE_ASSERTS \"Don't show message box for \\\"safe\\\" asserts, just ignore them automatically and dump a message to the terminal.\" ON)\n+configure_file(config-hide-safe-asserts.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config-hide-safe-asserts.h)\n+\n  #######################\n ########################\n ## Productset setting ##\n@@ -698,4 +701,3 @@ configure_file(config-ocio.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config-ocio.h )\n \n check_function_exists(powf HAVE_POWF)\n configure_file(config-powf.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config-powf.h)\n-"}, {"sha": "e9fe991a4693f810d40c2b09e12ba874d57c19bc", "filename": "config-hide-safe-asserts.h.cmake", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/KDE/krita/blob/146283952d5a007b6cc74a7bd24d0fc4e18f792d/config-hide-safe-asserts.h.cmake", "raw_url": "https://github.com/KDE/krita/raw/146283952d5a007b6cc74a7bd24d0fc4e18f792d/config-hide-safe-asserts.h.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/config-hide-safe-asserts.h.cmake?ref=146283952d5a007b6cc74a7bd24d0fc4e18f792d", "patch": "@@ -0,0 +1,7 @@\n+/* config-hide-safe-asserts.h.  Generated by cmake from config-hide-safe-asserts.h.cmake */\n+\n+/* Define if you have ocio, the OpenColorIO Library */\n+#cmakedefine HIDE_SAFE_ASSERTS 1\n+\n+\n+"}, {"sha": "3b3c72fdab33d728839799a445e2e74cae171469", "filename": "libs/global/kis_assert.cpp", "status": "modified", "additions": 27, "deletions": 7, "changes": 34, "blob_url": "https://github.com/KDE/krita/blob/146283952d5a007b6cc74a7bd24d0fc4e18f792d/libs/global/kis_assert.cpp", "raw_url": "https://github.com/KDE/krita/raw/146283952d5a007b6cc74a7bd24d0fc4e18f792d/libs/global/kis_assert.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/global/kis_assert.cpp?ref=146283952d5a007b6cc74a7bd24d0fc4e18f792d", "patch": "@@ -26,6 +26,7 @@\n #include <klocalizedstring.h>\n #include <kis_assert_exception.h>\n #include <string>\n+#include \"config-hide-safe-asserts.h\"\n \n /**\n  * TODO: Add automatic saving of the documents\n@@ -40,13 +41,14 @@\n  *    lead to an infinite loop.\n  */\n \n-void kis_assert_common(const char *assertion, const char *file, int line, bool throwException)\n+void kis_assert_common(const char *assertion, const char *file, int line, bool throwException, bool isIgnorable)\n {\n     QString shortMessage =\n-        QString(\"ASSERT (krita): \\\"%1\\\" in file %2, line %3\")\n+        QString(\"%4ASSERT (krita): \\\"%1\\\" in file %2, line %3\")\n         .arg(assertion)\n         .arg(file)\n-        .arg(line);\n+        .arg(line)\n+        .arg(isIgnorable ? \"SAFE \" : \"\");\n \n     QString longMessage =\n         QString(\n@@ -65,7 +67,16 @@ void kis_assert_common(const char *assertion, const char *file, int line, bool t\n         disableAssertMsg = true;\n     }\n \n-    QMessageBox::StandardButton button = QMessageBox::Abort;\n+#ifdef HIDE_SAFE_ASSERTS\n+    const bool shouldIgnoreAsserts = HIDE_SAFE_ASSERTS;\n+#else\n+    const bool shouldIgnoreAsserts = false;\n+#endif\n+\n+    disableAssertMsg |= shouldIgnoreAsserts;\n+\n+    QMessageBox::StandardButton button =\n+        isIgnorable ? QMessageBox::Ignore : QMessageBox::Abort;\n \n     if (!disableAssertMsg) {\n         button =\n@@ -77,6 +88,10 @@ void kis_assert_common(const char *assertion, const char *file, int line, bool t\n \n     if (button == QMessageBox::Abort) {\n         qFatal(\"%s\", shortMessage.toLatin1().data());\n+    } else if (isIgnorable) {\n+        // Assert is a bug! Please don't change this line to warnKrita,\n+        // the user must see it!\n+        qWarning(\"%s\", shortMessage.toLatin1().data());\n     } else if (throwException) {\n         throw KisAssertException(shortMessage.toLatin1().data());\n     }\n@@ -85,12 +100,17 @@ void kis_assert_common(const char *assertion, const char *file, int line, bool t\n \n void kis_assert_recoverable(const char *assertion, const char *file, int line)\n {\n-    kis_assert_common(assertion, file, line, false);\n+    kis_assert_common(assertion, file, line, false, false);\n+}\n+\n+void kis_safe_assert_recoverable(const char *assertion, const char *file, int line)\n+{\n+    kis_assert_common(assertion, file, line, false, true);\n }\n \n void kis_assert_exception(const char *assertion, const char *file, int line)\n {\n-    kis_assert_common(assertion, file, line, true);\n+    kis_assert_common(assertion, file, line, true, false);\n }\n \n void kis_assert_x_exception(const char *assertion,\n@@ -104,5 +124,5 @@ void kis_assert_x_exception(const char *assertion,\n         .arg(what)\n         .arg(assertion);\n \n-    kis_assert_common(res.toLatin1().data(), file, line, true);\n+    kis_assert_common(res.toLatin1().data(), file, line, true, false);\n }"}, {"sha": "d0e4900a01b3192a9e500e9543b9acf8ded4ce18", "filename": "libs/global/kis_assert.h", "status": "modified", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/KDE/krita/blob/146283952d5a007b6cc74a7bd24d0fc4e18f792d/libs/global/kis_assert.h", "raw_url": "https://github.com/KDE/krita/raw/146283952d5a007b6cc74a7bd24d0fc4e18f792d/libs/global/kis_assert.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/global/kis_assert.h?ref=146283952d5a007b6cc74a7bd24d0fc4e18f792d", "patch": "@@ -26,6 +26,8 @@ KRITAGLOBAL_EXPORT void kis_assert_exception(const char *assertion, const char *\n KRITAGLOBAL_EXPORT void kis_assert_recoverable(const char *assertion, const char *file, int line);\n KRITAGLOBAL_EXPORT void kis_assert_x_exception(const char *assertion, const char *where, const char *what, const char *file, int line);\n \n+KRITAGLOBAL_EXPORT void kis_safe_assert_recoverable(const char *assertion, const char *file, int line);\n+\n \n /**\n  * KIS_ASSERT family of macros allows the user to choose whether to\n@@ -105,4 +107,37 @@ KRITAGLOBAL_EXPORT void kis_assert_x_exception(const char *assertion, const char\n  */\n #define KIS_ASSERT_RECOVER_NOOP(cond) KIS_ASSERT_RECOVER(cond) { qt_noop(); }\n \n+\n+/**\n+ * This set of macros work in exactly the same way as their non-safe\n+ * counterparts, but they are automatically converted into console\n+ * warnings in release builds. That is the user will not see any\n+ * message box, just a warning message wil be printed in a terminal\n+ * and a recovery branch will be taken automatically.\n+ *\n+ * Rules when to use \"safe\" asserts. Use them if the following\n+ * conditions are met:\n+ *\n+ * 1) The condition in the assert shows that a real *bug* has\n+ *    happened. It is not just a warning. It is a bug that should be\n+ *    fixed.\n+ *\n+ * 2) The recovery branch will *workaround* the bug and the user will\n+ *    be able to continue his work *as if nothing has\n+ *    happened*. Again, please mark the assert \"safe\" if and only if\n+ *    you are 100% sure Krita will not crash in a minute after you\n+ *    faced that bug. The user is not notified about this bug, so he\n+ *    is not going to take any emergency steps like saving his work\n+ *    and restarting Krita!\n+ *\n+ * 3) If you think that Krita should be better restarted after this\n+ *    bug, please use a usual KIS_ASSRT_RECOVER.\n+ */\n+\n+#define KIS_SAFE_ASSERT_RECOVER(cond) if (!(cond) && (kis_safe_assert_recoverable(#cond,__FILE__,__LINE__), true))\n+#define KIS_SAFE_ASSERT_RECOVER_BREAK(cond) KIS_SAFE_ASSERT_RECOVER(cond) { break; }\n+#define KIS_SAFE_ASSERT_RECOVER_RETURN(cond) KIS_SAFE_ASSERT_RECOVER(cond) { return; }\n+#define KIS_SAFE_ASSERT_RECOVER_RETURN_VALUE(cond, val) KIS_SAFE_ASSERT_RECOVER(cond) { return (val); }\n+#define KIS_SAFE_ASSERT_RECOVER_NOOP(cond) KIS_SAFE_ASSERT_RECOVER(cond) { qt_noop(); }\n+\n #endif /* __KIS_ASSERT_H */"}, {"sha": "6202f399fb25a7cecb9fb5ccc4f86da0db43e02b", "filename": "plugins/impex/bmp/kis_bmp_export.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/bmp/kis_bmp_export.cpp", "raw_url": "https://github.com/KDE/krita/raw/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/bmp/kis_bmp_export.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/bmp/kis_bmp_export.cpp?ref=146283952d5a007b6cc74a7bd24d0fc4e18f792d", "patch": "@@ -60,7 +60,7 @@ KisImportExportFilter::ConversionStatus KisBMPExport::convert(const QByteArray&\n \n     QRect rc = input->image()->bounds();\n     // the image must be locked at the higher levels\n-    KIS_ASSERT_RECOVER_NOOP(input->image()->locked());\n+    KIS_SAFE_ASSERT_RECOVER_NOOP(input->image()->locked());\n     QImage image = input->image()->projection()->convertToQImage(0, 0, 0, rc.width(), rc.height(), KoColorConversionTransformation::internalRenderingIntent(), KoColorConversionTransformation::internalConversionFlags());\n     image.save(filename);\n     return KisImportExportFilter::OK;"}, {"sha": "af895c4faee67d25bb614d505f712d532671633e", "filename": "plugins/impex/brush/kis_brush_export.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/brush/kis_brush_export.cpp", "raw_url": "https://github.com/KDE/krita/raw/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/brush/kis_brush_export.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/brush/kis_brush_export.cpp?ref=146283952d5a007b6cc74a7bd24d0fc4e18f792d", "patch": "@@ -142,7 +142,7 @@ KisImportExportFilter::ConversionStatus KisBrushExport::convert(const QByteArray\n     }\n \n     // the image must be locked at the higher levels\n-    KIS_ASSERT_RECOVER_NOOP(input->image()->locked());\n+    KIS_SAFE_ASSERT_RECOVER_NOOP(input->image()->locked());\n \n     QRect rc = input->image()->bounds();\n "}, {"sha": "1b196f54a09c6ec045b391c641809a62bea8d0d0", "filename": "plugins/impex/exr/exr_export.cc", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/exr/exr_export.cc", "raw_url": "https://github.com/KDE/krita/raw/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/exr/exr_export.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/exr/exr_export.cc?ref=146283952d5a007b6cc74a7bd24d0fc4e18f792d", "patch": "@@ -102,7 +102,7 @@ KisImportExportFilter::ConversionStatus exrExport::convert(const QByteArray& fro\n \n     if (widget.flatten->isChecked()) {\n         // the image must be locked at the higher levels\n-        KIS_ASSERT_RECOVER_NOOP(input->image()->locked());\n+        KIS_SAFE_ASSERT_RECOVER_NOOP(input->image()->locked());\n \n         KisPaintDeviceSP pd = new KisPaintDevice(*image->projection());\n         KisPaintLayerSP l = new KisPaintLayer(image, \"projection\", OPACITY_OPAQUE_U8, pd);\n@@ -111,7 +111,7 @@ KisImportExportFilter::ConversionStatus exrExport::convert(const QByteArray& fro\n     }\n     else {\n         // the image must be locked at the higher levels\n-        KIS_ASSERT_RECOVER_NOOP(input->image()->locked());\n+        KIS_SAFE_ASSERT_RECOVER_NOOP(input->image()->locked());\n \n         res = kpc.buildFile(filename, image->rootLayer());\n     }"}, {"sha": "eeeb4baf60fcbc5149c3115b21562c37f15ade89", "filename": "plugins/impex/heightmap/kis_heightmap_export.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/heightmap/kis_heightmap_export.cpp", "raw_url": "https://github.com/KDE/krita/raw/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/heightmap/kis_heightmap_export.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/heightmap/kis_heightmap_export.cpp?ref=146283952d5a007b6cc74a7bd24d0fc4e18f792d", "patch": "@@ -139,7 +139,7 @@ KisImportExportFilter::ConversionStatus KisHeightMapExport::convert(const QByteA\n \n \n     // the image must be locked at the higher levels\n-    KIS_ASSERT_RECOVER_NOOP(image->locked());\n+    KIS_SAFE_ASSERT_RECOVER_NOOP(image->locked());\n     KisPaintDeviceSP pd = new KisPaintDevice(*image->projection());\n \n     QFile f(filename);"}, {"sha": "a7f92b35a2f1f26bdf1277c397aef004a8ca75ba", "filename": "plugins/impex/jp2/jp2_export.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/jp2/jp2_export.cc", "raw_url": "https://github.com/KDE/krita/raw/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/jp2/jp2_export.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/jp2/jp2_export.cc?ref=146283952d5a007b6cc74a7bd24d0fc4e18f792d", "patch": "@@ -106,7 +106,7 @@ KisImportExportFilter::ConversionStatus jp2Export::convert(const QByteArray& fro\n \n \n     // the image must be locked at the higher levels\n-    KIS_ASSERT_RECOVER_NOOP(input->image()->locked());\n+    KIS_SAFE_ASSERT_RECOVER_NOOP(input->image()->locked());\n     jp2Converter kpc(input);\n \n     KisPaintDeviceSP pd = new KisPaintDevice(*image->projection());"}, {"sha": "8169266783538551b87cc465d22730448d11ae3b", "filename": "plugins/impex/jpeg/kis_jpeg_export.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/jpeg/kis_jpeg_export.cc", "raw_url": "https://github.com/KDE/krita/raw/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/jpeg/kis_jpeg_export.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/jpeg/kis_jpeg_export.cc?ref=146283952d5a007b6cc74a7bd24d0fc4e18f792d", "patch": "@@ -192,7 +192,7 @@ KisImportExportFilter::ConversionStatus KisJPEGExport::convert(const QByteArray&\n     if (filename.isEmpty()) return KisImportExportFilter::FileNotFound;\n \n     // the image must be locked at the higher levels\n-    KIS_ASSERT_RECOVER_NOOP(input->image()->locked());\n+    KIS_SAFE_ASSERT_RECOVER_NOOP(input->image()->locked());\n     KisPaintDeviceSP pd = new KisPaintDevice(*image->projection());\n \n     KisJPEGConverter kpc(input, getBatchMode());"}, {"sha": "13151a79f706f115fb69e48181322f6c7e7ccdaf", "filename": "plugins/impex/png/kis_png_export.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/png/kis_png_export.cc", "raw_url": "https://github.com/KDE/krita/raw/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/png/kis_png_export.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/png/kis_png_export.cc?ref=146283952d5a007b6cc74a7bd24d0fc4e18f792d", "patch": "@@ -94,7 +94,7 @@ KisImportExportFilter::ConversionStatus KisPNGExport::convert(const QByteArray&\n     KisImageWSP image = input->image();\n \n     // the image must be locked at the higher levels\n-    KIS_ASSERT_RECOVER_NOOP(image->locked());\n+    KIS_SAFE_ASSERT_RECOVER_NOOP(image->locked());\n     KisPaintDeviceSP pd;\n     pd = new KisPaintDevice(*image->projection());\n     KisPaintLayerSP l = new KisPaintLayer(image, \"projection\", OPACITY_OPAQUE_U8, pd);"}, {"sha": "1859cf35333b2729560a5851211a37f41d9f5b68", "filename": "plugins/impex/ppm/kis_ppm_export.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/ppm/kis_ppm_export.cpp", "raw_url": "https://github.com/KDE/krita/raw/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/ppm/kis_ppm_export.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/ppm/kis_ppm_export.cpp?ref=146283952d5a007b6cc74a7bd24d0fc4e18f792d", "patch": "@@ -185,7 +185,7 @@ KisImportExportFilter::ConversionStatus KisPPMExport::convert(const QByteArray&\n     KisImageWSP image = input->image();\n     Q_CHECK_PTR(image);\n     // the image must be locked at the higher levels\n-    KIS_ASSERT_RECOVER_NOOP(input->image()->locked());\n+    KIS_SAFE_ASSERT_RECOVER_NOOP(input->image()->locked());\n     KisPaintDeviceSP pd = new KisPaintDevice(*image->projection());\n \n     // Test color space"}, {"sha": "12f7761b581d226856680cd14770a74bf3004742", "filename": "plugins/impex/psd/psd_loader.cpp", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/psd/psd_loader.cpp", "raw_url": "https://github.com/KDE/krita/raw/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/psd/psd_loader.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/psd/psd_loader.cpp?ref=146283952d5a007b6cc74a7bd24d0fc4e18f792d", "patch": "@@ -344,10 +344,10 @@ KisImageBuilder_Result PSDLoader::decode(const QString &filename)\n             new KisPSDLayerStyleCollectionResource(\"Embedded PSD Styles.asl\");\n \n         collection->setName(i18nc(\"Auto-generated layer style collection name for embedded styles (collection)\", \"<%1> (embedded)\", m_image->objectName()));\n-        KIS_ASSERT_RECOVER_NOOP(!collection->valid());\n+        KIS_SAFE_ASSERT_RECOVER_NOOP(!collection->valid());\n \n         collection->setLayerStyles(allStylesForServer);\n-        KIS_ASSERT_RECOVER_NOOP(collection->valid());\n+        KIS_SAFE_ASSERT_RECOVER_NOOP(collection->valid());\n \n         KoResourceServer<KisPSDLayerStyleCollectionResource> *server = KisResourceServerProvider::instance()->layerStyleCollectionServer();\n         server->addResource(collection, false);"}, {"sha": "c895d95b9a42a8d24a4c3cd66f2c84ac406d7fcc", "filename": "plugins/impex/tga/kis_tga_export.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/tga/kis_tga_export.cpp", "raw_url": "https://github.com/KDE/krita/raw/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/tga/kis_tga_export.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/tga/kis_tga_export.cpp?ref=146283952d5a007b6cc74a7bd24d0fc4e18f792d", "patch": "@@ -62,7 +62,7 @@ KisImportExportFilter::ConversionStatus KisTGAExport::convert(const QByteArray&\n         return KisImportExportFilter::NotImplemented;\n \n     // the image must be locked at the higher levels\n-    KIS_ASSERT_RECOVER_NOOP(input->image()->locked());\n+    KIS_SAFE_ASSERT_RECOVER_NOOP(input->image()->locked());\n \n     QRect rc = input->image()->bounds();\n     QImage image = input->image()->projection()->convertToQImage(0, 0, 0, rc.width(), rc.height(), KoColorConversionTransformation::internalRenderingIntent(), KoColorConversionTransformation::internalConversionFlags());"}, {"sha": "f9c245381a9382198d9ba7aa72f31643e95a7341", "filename": "plugins/impex/tiff/kis_tiff_export.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/tiff/kis_tiff_export.cc", "raw_url": "https://github.com/KDE/krita/raw/146283952d5a007b6cc74a7bd24d0fc4e18f792d/plugins/impex/tiff/kis_tiff_export.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/tiff/kis_tiff_export.cc?ref=146283952d5a007b6cc74a7bd24d0fc4e18f792d", "patch": "@@ -110,7 +110,7 @@ KisImportExportFilter::ConversionStatus KisTIFFExport::convert(const QByteArray&\n     }\n \n     // the image must be locked at the higher levels\n-    KIS_ASSERT_RECOVER_NOOP(input->image()->locked());\n+    KIS_SAFE_ASSERT_RECOVER_NOOP(input->image()->locked());\n \n     KisTIFFConverter ktc(input);\n     KisImageBuilder_Result res;"}]}, {"sha": "20248e3f23aa4509069508c015f575561df592a0", "stats": {"total": 1, "additions": 1, "deletions": 0}, "files": [{"sha": "87505cdb9c4f30ccfe6b004038187f102c470964", "filename": "libs/ui/KisApplication.cpp", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/20248e3f23aa4509069508c015f575561df592a0/libs/ui/KisApplication.cpp", "raw_url": "https://github.com/KDE/krita/raw/20248e3f23aa4509069508c015f575561df592a0/libs/ui/KisApplication.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisApplication.cpp?ref=20248e3f23aa4509069508c015f575561df592a0", "patch": "@@ -83,6 +83,7 @@\n #include <kis_brush_server.h>\n #include <kis_resource_server_provider.h>\n #include <KoResourceServerProvider.h>\n+#include \"kis_image_barrier_locker.h\"\n \n #include \"opengl/kis_opengl.h\"\n "}]}, {"sha": "d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "stats": {"total": 220, "additions": 97, "deletions": 123}, "files": [{"sha": "195d6c58b8f5eb2d4a8b9859a47c7fd446a9007d", "filename": "libs/ui/KisApplication.cpp", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/libs/ui/KisApplication.cpp", "raw_url": "https://github.com/KDE/krita/raw/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/libs/ui/KisApplication.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisApplication.cpp?ref=d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "patch": "@@ -436,6 +436,10 @@ bool KisApplication::start(const KisApplicationArguments &args)\n \n                     KisDocument *doc = KisPart::instance()->createDocument();\n                     doc->openUrl(QUrl::fromLocalFile(fileName));\n+\n+                    qApp->processEvents(); // For vector layers to be updated\n+                    KisImageBarrierLocker locker(doc->image());\n+\n                     KisImportExportFilter::ConversionStatus status = KisImportExportFilter::OK;\n                     KisImportExportManager manager(doc);\n                     manager.setBatchMode(true);"}, {"sha": "a8be22edfcf66859fbf699b123c78a77df0a8acb", "filename": "libs/ui/KisDocument.cpp", "status": "modified", "additions": 62, "deletions": 30, "changes": 92, "blob_url": "https://github.com/KDE/krita/blob/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/libs/ui/KisDocument.cpp", "raw_url": "https://github.com/KDE/krita/raw/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/libs/ui/KisDocument.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisDocument.cpp?ref=d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "patch": "@@ -230,6 +230,54 @@ class UndoStack : public KUndo2Stack\n     KisDocument *m_doc;\n };\n \n+class SafeSavingLocker {\n+public:\n+    SafeSavingLocker(KisDocument *doc)\n+        : m_doc(doc),\n+          m_locked(false)\n+    {\n+        const int realAutoSaveInterval = KisConfig().autoSaveInterval();\n+        const int emergencyAutoSaveInterval = 10; // sec\n+\n+        if (!m_doc->image()->tryBarrierLock(true)) {\n+            if (m_doc->isAutosaving()) {\n+                m_doc->setDisregardAutosaveFailure(true);\n+                if (realAutoSaveInterval) {\n+                    m_doc->setAutoSave(emergencyAutoSaveInterval);\n+                }\n+                m_locked = false;\n+            } else {\n+                m_doc->image()->requestStrokeEnd();\n+                QApplication::processEvents();\n+                m_locked = m_doc->image()->tryBarrierLock(true);\n+            }\n+        } else {\n+            m_locked = true;\n+        }\n+\n+        if (m_locked) {\n+            m_doc->setDisregardAutosaveFailure(false);\n+        }\n+    }\n+\n+    ~SafeSavingLocker() {\n+         if (m_locked) {\n+             m_doc->image()->unlock();\n+\n+             const int realAutoSaveInterval = KisConfig().autoSaveInterval();\n+             m_doc->setAutoSave(realAutoSaveInterval);\n+         }\n+     }\n+\n+    bool successfullyLocked() const {\n+        return m_locked;\n+    }\n+\n+private:\n+    KisDocument *m_doc;\n+    bool m_locked;\n+};\n+\n class Q_DECL_HIDDEN KisDocument::Private\n {\n public:\n@@ -612,7 +660,13 @@ bool KisDocument::saveFile()\n     if (!isNativeFormat(outputMimeType)) {\n         dbgUI << \"Saving to format\" << outputMimeType << \"in\" << localFilePath();\n \n-        status = d->filterManager->exportDocument(localFilePath(), outputMimeType);\n+        SafeSavingLocker locker(this);\n+        if (locker.successfullyLocked()) {\n+            status = d->filterManager->exportDocument(localFilePath(), outputMimeType);\n+        } else {\n+            status = KisImportExportFilter::UsageError;\n+        }\n+\n         ret = status == KisImportExportFilter::OK;\n         suppressErrorDialog = (status == KisImportExportFilter::UserCancelled || status == KisImportExportFilter::BadConversionGraph);\n         dbgFile << \"Export status was\" << status;\n@@ -812,26 +866,8 @@ bool KisDocument::isModified() const\n \n bool KisDocument::saveNativeFormat(const QString & file)\n {\n-    const int realAutoSaveInterval = KisConfig().autoSaveInterval();\n-    const int emergencyAutoSaveInterval = 10; // sec\n-\n-    if (!d->image->tryBarrierLock(true)) {\n-        if (isAutosaving()) {\n-            setDisregardAutosaveFailure(true);\n-            if (realAutoSaveInterval) {\n-                setAutoSave(emergencyAutoSaveInterval);\n-            }\n-            return false;\n-        } else {\n-            d->image->requestStrokeEnd();\n-            QApplication::processEvents();\n-            if (!d->image->tryBarrierLock(true)) {\n-                return false;\n-            }\n-        }\n-    }\n-\n-    setDisregardAutosaveFailure(false);\n+    SafeSavingLocker locker(this);\n+    if (!locker.successfullyLocked()) return false;\n \n     d->lastErrorMessage.clear();\n     //dbgUI <<\"Saving to store\";\n@@ -863,22 +899,18 @@ bool KisDocument::saveNativeFormat(const QString & file)\n     if (store->bad()) {\n         d->lastErrorMessage = i18n(\"Could not create the file for saving\");   // more details needed?\n         delete store;\n-        d->image->unlock();\n-        setAutoSave(realAutoSaveInterval);\n-\n         return false;\n     }\n \n-    d->image->unlock();\n-    setAutoSave(realAutoSaveInterval);\n-\n+    bool result = false;\n \n     if (!isAutosaving()) {\n         KisAsyncActionFeedback f(i18n(\"Saving document...\"), 0);\n-        return f.runAction(std::bind(&KisDocument::saveNativeFormatCalligra, this, store));\n+        result = f.runAction(std::bind(&KisDocument::saveNativeFormatCalligra, this, store));\n+    } else {\n+        result = saveNativeFormatCalligra(store);\n     }\n-\n-    return saveNativeFormatCalligra(store);\n+    return result;\n }\n \n bool KisDocument::saveNativeFormatCalligra(KoStore *store)"}, {"sha": "5b93d381d02490ebb3aaf715011c16ea24d0039f", "filename": "libs/ui/KisDocument.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/libs/ui/KisDocument.h", "raw_url": "https://github.com/KDE/krita/raw/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/libs/ui/KisDocument.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisDocument.h?ref=d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "patch": "@@ -617,6 +617,7 @@ public Q_SLOTS:\n private:\n \n     friend class KisPart;\n+    friend class SafeSavingLocker;\n \n     /**\n      * Generate a name for the document."}, {"sha": "1b88903db7ff2068d893ec9800fbab76ffd3b211", "filename": "plugins/impex/bmp/kis_bmp_export.cpp", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/bmp/kis_bmp_export.cpp", "raw_url": "https://github.com/KDE/krita/raw/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/bmp/kis_bmp_export.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/bmp/kis_bmp_export.cpp?ref=d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "patch": "@@ -58,14 +58,10 @@ KisImportExportFilter::ConversionStatus KisBMPExport::convert(const QByteArray&\n     if (from != \"application/x-krita\")\n         return KisImportExportFilter::NotImplemented;\n \n-    qApp->processEvents(); // For vector layers to be updated\n-    input->image()->waitForDone();\n-\n     QRect rc = input->image()->bounds();\n-    input->image()->refreshGraph();\n-    input->image()->lock();\n+    // the image must be locked at the higher levels\n+    KIS_ASSERT_RECOVER_NOOP(input->image()->locked());\n     QImage image = input->image()->projection()->convertToQImage(0, 0, 0, rc.width(), rc.height(), KoColorConversionTransformation::internalRenderingIntent(), KoColorConversionTransformation::internalConversionFlags());\n-    input->image()->unlock();\n     image.save(filename);\n     return KisImportExportFilter::OK;\n }"}, {"sha": "a5652fde8732d70ae786237fe869079f3c77cfe9", "filename": "plugins/impex/brush/kis_brush_export.cpp", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/KDE/krita/blob/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/brush/kis_brush_export.cpp", "raw_url": "https://github.com/KDE/krita/raw/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/brush/kis_brush_export.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/brush/kis_brush_export.cpp?ref=d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "patch": "@@ -141,11 +141,10 @@ KisImportExportFilter::ConversionStatus KisBrushExport::convert(const QByteArray\n         qApp->processEvents(); // For vector layers to be updated\n     }\n \n+    // the image must be locked at the higher levels\n+    KIS_ASSERT_RECOVER_NOOP(input->image()->locked());\n \n-    input->image()->waitForDone();\n     QRect rc = input->image()->bounds();\n-    input->image()->refreshGraph();\n-    input->image()->lock();\n \n     brush->setName(exportOptions.name);\n     brush->setSpacing(exportOptions.spacing);\n@@ -200,8 +199,6 @@ KisImportExportFilter::ConversionStatus KisBrushExport::convert(const QByteArray\n     brush->setWidth(w);\n     brush->setHeight(h);\n \n-    input->image()->unlock();\n-\n     QFile f(filename);\n     f.open(QIODevice::WriteOnly);\n     brush->saveToDevice(&f);"}, {"sha": "ab8606c931b3a7b445a1894f95b78857ddc8f80d", "filename": "plugins/impex/csv/csv_saver.cpp", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/csv/csv_saver.cpp", "raw_url": "https://github.com/KDE/krita/raw/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/csv/csv_saver.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/csv/csv_saver.cpp?ref=d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "patch": "@@ -106,7 +106,6 @@ KisImageBuilder_Result CSVSaver::encode(const QString &filename)\n     //according to the QT docs, the slash is a universal directory separator\n     path.append(\"/\");\n \n-    m_image->lock();\n     node = m_image->rootLayer()->firstChild();\n \n     //TODO: correct handling of the layer tree.\n@@ -336,8 +335,6 @@ KisImageBuilder_Result CSVSaver::encode(const QString &filename)\n         step++;\n     } while((retval == KisImageBuilder_RESULT_OK) && (step < 8));\n \n-    m_image->unlock();\n-\n     qDeleteAll(layers);\n     f.close();\n "}, {"sha": "d5369537cebb6233727020294fa573d9ee243397", "filename": "plugins/impex/csv/kis_csv_export.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/csv/kis_csv_export.cpp", "raw_url": "https://github.com/KDE/krita/raw/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/csv/kis_csv_export.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/csv/kis_csv_export.cpp?ref=d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "patch": "@@ -86,8 +86,6 @@ KisImportExportFilter::ConversionStatus KisCSVExport::convert(const QByteArray&\n         }\n         return KisImportExportFilter::InvalidFormat;\n     }\n-    qApp->processEvents(); // For vector layers to be updated\n-    input->image()->waitForDone();\n \n     if (filename.isEmpty()) return KisImportExportFilter::FileNotFound;\n "}, {"sha": "79468d7c3bcd01a8a527a85e01ce1d21087961f1", "filename": "plugins/impex/exr/exr_export.cc", "status": "modified", "additions": 5, "deletions": 10, "changes": 15, "blob_url": "https://github.com/KDE/krita/blob/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/exr/exr_export.cc", "raw_url": "https://github.com/KDE/krita/raw/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/exr/exr_export.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/exr/exr_export.cc?ref=d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "patch": "@@ -89,10 +89,6 @@ KisImportExportFilter::ConversionStatus exrExport::convert(const QByteArray& fro\n             return KisImportExportFilter::UserCancelled;\n         }\n     }\n-    else {\n-        qApp->processEvents(); // For vector layers to be updated\n-    }\n-    image->waitForDone();\n \n     cfg.setProperty(\"flatten\", widget.flatten->isChecked());\n     KisConfig().setExportConfiguration(\"EXR\", cfg);\n@@ -105,20 +101,19 @@ KisImportExportFilter::ConversionStatus exrExport::convert(const QByteArray& fro\n     KisImageBuilder_Result res;\n \n     if (widget.flatten->isChecked()) {\n-        image->refreshGraph();\n-        image->lock();\n+        // the image must be locked at the higher levels\n+        KIS_ASSERT_RECOVER_NOOP(input->image()->locked());\n+\n         KisPaintDeviceSP pd = new KisPaintDevice(*image->projection());\n         KisPaintLayerSP l = new KisPaintLayer(image, \"projection\", OPACITY_OPAQUE_U8, pd);\n-        image->unlock();\n \n         res = kpc.buildFile(filename, l);\n     }\n     else {\n-        image->lock();\n+        // the image must be locked at the higher levels\n+        KIS_ASSERT_RECOVER_NOOP(input->image()->locked());\n \n         res = kpc.buildFile(filename, image->rootLayer());\n-        image->unlock();\n-\n     }\n \n     dbgFile << \" Result =\" << res;"}, {"sha": "12305f22b4bf840c607b892d6c79e9095d8eff6d", "filename": "plugins/impex/heightmap/kis_heightmap_export.cpp", "status": "modified", "additions": 4, "deletions": 8, "changes": 12, "blob_url": "https://github.com/KDE/krita/blob/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/heightmap/kis_heightmap_export.cpp", "raw_url": "https://github.com/KDE/krita/raw/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/heightmap/kis_heightmap_export.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/heightmap/kis_heightmap_export.cpp?ref=d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "patch": "@@ -116,10 +116,6 @@ KisImportExportFilter::ConversionStatus KisHeightMapExport::convert(const QByteA\n             return KisImportExportFilter::UserCancelled;\n         }\n     }\n-    else {\n-        qApp->processEvents(); // For vector layers to be updated\n-    }\n-    inputDoc->image()->waitForDone();\n \n     if (optionsHeightMap.radioMac->isChecked()) {\n         cfg.setProperty(\"endianness\", 0);\n@@ -141,10 +137,10 @@ KisImportExportFilter::ConversionStatus KisHeightMapExport::convert(const QByteA\n                           == QMessageBox::Yes);\n     }\n \n-    image->refreshGraph();\n-    image->lock();\n+\n+    // the image must be locked at the higher levels\n+    KIS_ASSERT_RECOVER_NOOP(image->locked());\n     KisPaintDeviceSP pd = new KisPaintDevice(*image->projection());\n-    image->unlock();\n \n     QFile f(filename);\n     f.open(QIODevice::WriteOnly);\n@@ -169,4 +165,4 @@ KisImportExportFilter::ConversionStatus KisHeightMapExport::convert(const QByteA\n     return KisImportExportFilter::OK;\n }\n \n-#include \"kis_heightmap_export.moc\"\n\\ No newline at end of file\n+#include \"kis_heightmap_export.moc\""}, {"sha": "06981907e021692e4901ff789419dd8e0c37f7ce", "filename": "plugins/impex/jp2/jp2_export.cc", "status": "modified", "additions": 2, "deletions": 8, "changes": 10, "blob_url": "https://github.com/KDE/krita/blob/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/jp2/jp2_export.cc", "raw_url": "https://github.com/KDE/krita/raw/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/jp2/jp2_export.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/jp2/jp2_export.cc?ref=d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "patch": "@@ -95,10 +95,6 @@ KisImportExportFilter::ConversionStatus jp2Export::convert(const QByteArray& fro\n             return KisImportExportFilter::UserCancelled;\n         }\n     }\n-    else {\n-        qApp->processEvents(); // For vector layers to be updated\n-    }\n-    image->waitForDone();\n \n     JP2ConvertOptions options;\n     options.numberresolution = optionsJP2.numberResolutions->value();\n@@ -109,14 +105,12 @@ KisImportExportFilter::ConversionStatus jp2Export::convert(const QByteArray& fro\n     KisConfig().setExportConfiguration(\"JP2\", cfg);\n \n \n-    image->refreshGraph();\n-    image->lock();\n-\n+    // the image must be locked at the higher levels\n+    KIS_ASSERT_RECOVER_NOOP(input->image()->locked());\n     jp2Converter kpc(input);\n \n     KisPaintDeviceSP pd = new KisPaintDevice(*image->projection());\n     KisPaintLayerSP l = new KisPaintLayer(image, \"projection\", OPACITY_OPAQUE_U8, pd);\n-    image->unlock();\n \n     KisImageBuilder_Result res;\n "}, {"sha": "4a35cfbe23eff210f9cc32135677432dd0eb8769", "filename": "plugins/impex/jpeg/kis_jpeg_export.cc", "status": "modified", "additions": 3, "deletions": 9, "changes": 12, "blob_url": "https://github.com/KDE/krita/blob/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/jpeg/kis_jpeg_export.cc", "raw_url": "https://github.com/KDE/krita/raw/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/jpeg/kis_jpeg_export.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/jpeg/kis_jpeg_export.cc?ref=d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "patch": "@@ -134,10 +134,6 @@ KisImportExportFilter::ConversionStatus KisJPEGExport::convert(const QByteArray&\n             return KisImportExportFilter::UserCancelled;\n         }\n     }\n-    else {\n-        qApp->processEvents(); // For vector layers to be updated\n-    }\n-    image->waitForDone();\n \n     KisJPEGOptions options;\n     options.progressive = wdgUi.progressive->isChecked();\n@@ -195,13 +191,11 @@ KisImportExportFilter::ConversionStatus KisJPEGExport::convert(const QByteArray&\n \n     if (filename.isEmpty()) return KisImportExportFilter::FileNotFound;\n \n-    image->refreshGraph();\n-    image->lock();\n+    // the image must be locked at the higher levels\n+    KIS_ASSERT_RECOVER_NOOP(input->image()->locked());\n+    KisPaintDeviceSP pd = new KisPaintDevice(*image->projection());\n \n     KisJPEGConverter kpc(input, getBatchMode());\n-\n-    KisPaintDeviceSP pd = new KisPaintDevice(*image->projection());\n-    image->unlock();\n     KisPaintLayerSP l = new KisPaintLayer(image, \"projection\", OPACITY_OPAQUE_U8, pd);\n \n     vKisAnnotationSP_it beginIt = image->beginAnnotations();"}, {"sha": "458a98d96f77625ecd875a6d32d672c6c5904dc6", "filename": "plugins/impex/ora/ora_export.cc", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/ora/ora_export.cc", "raw_url": "https://github.com/KDE/krita/raw/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/ora/ora_export.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/ora/ora_export.cc?ref=d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "patch": "@@ -82,11 +82,9 @@ KisImportExportFilter::ConversionStatus OraExport::convert(const QByteArray& fro\n     KisDocument *input = inputDocument();\n     QString filename = outputFile();\n \n-    if (!input)\n+    if (!input) {\n         return KisImportExportFilter::NoDocumentCreated;\n-\n-    qApp->processEvents(); // For vector layers to be updated\n-    input->image()->waitForDone();\n+    }\n \n     if (filename.isEmpty()) return KisImportExportFilter::FileNotFound;\n "}, {"sha": "7dc2cf2c0b368b7deeac35ef7ac578c459902086", "filename": "plugins/impex/png/kis_png_export.cc", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/KDE/krita/blob/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/png/kis_png_export.cc", "raw_url": "https://github.com/KDE/krita/raw/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/png/kis_png_export.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/png/kis_png_export.cc?ref=d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "patch": "@@ -92,15 +92,12 @@ KisImportExportFilter::ConversionStatus KisPNGExport::convert(const QByteArray&\n     kdb->setButtons(KoDialog::Ok | KoDialog::Cancel);\n \n     KisImageWSP image = input->image();\n-    qApp->processEvents(); // For vector layers to be updated\n-    input->image()->waitForDone();\n \n-    image->refreshGraph();\n-    image->lock();\n+    // the image must be locked at the higher levels\n+    KIS_ASSERT_RECOVER_NOOP(image->locked());\n     KisPaintDeviceSP pd;\n     pd = new KisPaintDevice(*image->projection());\n     KisPaintLayerSP l = new KisPaintLayer(image, \"projection\", OPACITY_OPAQUE_U8, pd);\n-    image->unlock();\n \n \n     if (!KisPNGConverter::isColorSpaceSupported(pd->colorSpace())) {"}, {"sha": "b908defbb7533d602ab084c7dde0be00c3fe1610", "filename": "plugins/impex/ppm/kis_ppm_export.cpp", "status": "modified", "additions": 3, "deletions": 9, "changes": 12, "blob_url": "https://github.com/KDE/krita/blob/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/ppm/kis_ppm_export.cpp", "raw_url": "https://github.com/KDE/krita/raw/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/ppm/kis_ppm_export.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/ppm/kis_ppm_export.cpp?ref=d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "patch": "@@ -174,11 +174,6 @@ KisImportExportFilter::ConversionStatus KisPPMExport::convert(const QByteArray&\n             return KisImportExportFilter::UserCancelled;\n         }\n     }\n-    else {\n-        qApp->processEvents(); // For vector layers to be updated\n-    }\n-    input->image()->waitForDone();\n-\n \n     bool rgb = (to == \"image/x-portable-pixmap\");\n     bool binary = optionsPPM.type->currentIndex() == 0;\n@@ -189,10 +184,9 @@ KisImportExportFilter::ConversionStatus KisPPMExport::convert(const QByteArray&\n \n     KisImageWSP image = input->image();\n     Q_CHECK_PTR(image);\n-    image->refreshGraph();\n-    image->lock();\n+    // the image must be locked at the higher levels\n+    KIS_ASSERT_RECOVER_NOOP(input->image()->locked());\n     KisPaintDeviceSP pd = new KisPaintDevice(*image->projection());\n-    image->unlock();\n \n     // Test color space\n     if (((rgb && (pd->colorSpace()->id() != \"RGBA\" && pd->colorSpace()->id() != \"RGBA16\"))\n@@ -289,4 +283,4 @@ KisImportExportFilter::ConversionStatus KisPPMExport::convert(const QByteArray&\n     return KisImportExportFilter::OK;\n }\n \n-#include \"kis_ppm_export.moc\"\n\\ No newline at end of file\n+#include \"kis_ppm_export.moc\""}, {"sha": "06eeb847dceda4d44a9aa7c613b8fae8092246d8", "filename": "plugins/impex/psd/psd_export.cc", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/psd/psd_export.cc", "raw_url": "https://github.com/KDE/krita/raw/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/psd/psd_export.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/psd/psd_export.cc?ref=d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "patch": "@@ -107,9 +107,6 @@ KisImportExportFilter::ConversionStatus psdExport::convert(const QByteArray& fro\n         return KisImportExportFilter::InvalidFormat;\n     }\n \n-    qApp->processEvents(); // For vector layers to be updated\n-    input->image()->waitForDone();\n-\n     if (filename.isEmpty()) return KisImportExportFilter::FileNotFound;\n \n     PSDSaver kpc(input);"}, {"sha": "aacafe3f0c8719bb95f89b3da07af69182a70a08", "filename": "plugins/impex/qml/qml_export.cc", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/qml/qml_export.cc", "raw_url": "https://github.com/KDE/krita/raw/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/qml/qml_export.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/qml/qml_export.cc?ref=d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "patch": "@@ -63,10 +63,6 @@ KisImportExportFilter::ConversionStatus QMLExport::convert(const QByteArray& fro\n     }\n \n     KisImageWSP image = input->image();\n-\n-    qApp->processEvents(); // For vector layers to be updated\n-    image->waitForDone();\n-\n     Q_CHECK_PTR(image);\n \n     QMLConverter converter;"}, {"sha": "1010c39e3226903cf8a7c10a91c6a5d572ee81b9", "filename": "plugins/impex/spriter/kis_spriter_export.cpp", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/spriter/kis_spriter_export.cpp", "raw_url": "https://github.com/KDE/krita/raw/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/spriter/kis_spriter_export.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/spriter/kis_spriter_export.cpp?ref=d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "patch": "@@ -353,9 +353,6 @@ KisImportExportFilter::ConversionStatus KisSpriterExport::convert(const QByteArr\n         return KisImportExportFilter::NoDocumentCreated;\n     }\n \n-    qApp->processEvents(); // For vector layers to be updated\n-    input->image()->waitForDone();\n-\n     QFileInfo fi(filename);\n \n     QDomDocument scmlDoc;"}, {"sha": "9d0fe008b0827029e093a79ba16510768e476ba1", "filename": "plugins/impex/tga/kis_tga_export.cpp", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/KDE/krita/blob/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/tga/kis_tga_export.cpp", "raw_url": "https://github.com/KDE/krita/raw/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/tga/kis_tga_export.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/tga/kis_tga_export.cpp?ref=d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "patch": "@@ -61,14 +61,11 @@ KisImportExportFilter::ConversionStatus KisTGAExport::convert(const QByteArray&\n     if (from != \"application/x-krita\")\n         return KisImportExportFilter::NotImplemented;\n \n-    qApp->processEvents(); // For vector layers to be updated\n-    input->image()->waitForDone();\n+    // the image must be locked at the higher levels\n+    KIS_ASSERT_RECOVER_NOOP(input->image()->locked());\n \n     QRect rc = input->image()->bounds();\n-    input->image()->refreshGraph();\n-    input->image()->lock();\n     QImage image = input->image()->projection()->convertToQImage(0, 0, 0, rc.width(), rc.height(), KoColorConversionTransformation::internalRenderingIntent(), KoColorConversionTransformation::internalConversionFlags());\n-    input->image()->unlock();\n \n     QFile f(filename);\n     f.open(QIODevice::WriteOnly);"}, {"sha": "660333c4b6264a7eb25ba640a39f8172d9473abb", "filename": "plugins/impex/tiff/kis_tiff_export.cc", "status": "modified", "additions": 3, "deletions": 9, "changes": 12, "blob_url": "https://github.com/KDE/krita/blob/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/tiff/kis_tiff_export.cc", "raw_url": "https://github.com/KDE/krita/raw/d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57/plugins/impex/tiff/kis_tiff_export.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/tiff/kis_tiff_export.cc?ref=d5c39fbd21f3eed41a4675ed01ec5f9be38e4c57", "patch": "@@ -84,11 +84,6 @@ KisImportExportFilter::ConversionStatus KisTIFFExport::convert(const QByteArray&\n             return KisImportExportFilter::UserCancelled;\n         }\n     }\n-    else {\n-        qApp->processEvents(); // For vector layers to be updated\n-\n-    }\n-    input->image()->waitForDone();\n \n     KisTIFFOptions options = dlg.options();\n \n@@ -114,17 +109,16 @@ KisImportExportFilter::ConversionStatus KisTIFFExport::convert(const QByteArray&\n         image = input->image();\n     }\n \n-    image->refreshGraph();\n-    image->lock();\n+    // the image must be locked at the higher levels\n+    KIS_ASSERT_RECOVER_NOOP(input->image()->locked());\n \n     KisTIFFConverter ktc(input);\n     KisImageBuilder_Result res;\n     if ((res = ktc.buildFile(filename, image, options)) == KisImageBuilder_RESULT_OK) {\n         dbgFile << \"success !\";\n-        image->unlock();\n         return KisImportExportFilter::OK;\n     }\n-    image->unlock();\n+\n     dbgFile << \" Result =\" << res;\n     return KisImportExportFilter::InternalError;\n }"}]}, {"sha": "ec87c47ab3569fdbabf4acf34a2ee178f12e8854", "stats": {"total": 59, "additions": 30, "deletions": 29}, "files": [{"sha": "5bc24c7007f8438cf521aa976a839caf977ec14e", "filename": "plugins/paintops/tangentnormal/kis_tangent_normal_paintop.cpp", "status": "modified", "additions": 24, "deletions": 23, "changes": 47, "blob_url": "https://github.com/KDE/krita/blob/ec87c47ab3569fdbabf4acf34a2ee178f12e8854/plugins/paintops/tangentnormal/kis_tangent_normal_paintop.cpp", "raw_url": "https://github.com/KDE/krita/raw/ec87c47ab3569fdbabf4acf34a2ee178f12e8854/plugins/paintops/tangentnormal/kis_tangent_normal_paintop.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/tangentnormal/kis_tangent_normal_paintop.cpp?ref=ec87c47ab3569fdbabf4acf34a2ee178f12e8854", "patch": "@@ -82,24 +82,24 @@ KisSpacingInformation KisTangentNormalPaintOp::paintAt(const KisPaintInformation\n     if (currentSpace != \"RGBA\") {\n \trgbColorSpace = KoColorSpaceRegistry::instance()->rgb8();\n     } else {\n-\tQString bit = rgbColorSpace->colorDepthId().id();//let Krita tell you what the bit depth string is.\n-\trgbColorSpace = KoColorSpaceRegistry::instance()->colorSpace(\"RGBA\", bit, currentColor.profile() );\n+\trgbColorSpace = currentColor.colorSpace();\n     }\n+    QVector <float> channelValues(4);\n \n-    quint8 data[4];\n-\n-    data[0] = 255;//blue\n-    data[1] = 128;//green\n-    data[2] = 128;//red\n-    data[3] = 255;//alpha, leave alone.\n+    channelValues[0] = 1.0;//blue\n+    channelValues[1] = 0.5;//green\n+    channelValues[2] = 0.5;//red\n+    channelValues[3] = 1.0;//alpha, leave alone.\n \n-    quint8 r, g, b;\n+    qreal r, g, b;\n     m_tangentTiltOption.apply(info, &r, &g, &b);\n \n-    data[0] = b;//blue\n-    data[1] = g;//green\n-    data[2] = r;//red\n+    channelValues[0] = b;//blue\n+    channelValues[1] = g;//green\n+    channelValues[2] = r;//red\n \n+    quint8 data[4];\n+    rgbColorSpace->fromNormalisedChannelsValue(data, channelValues);\n     KoColor color(data, rgbColorSpace);//Should be default RGB(0.5,0.5,1.0)\n     //draw stuff here, return kisspacinginformation.\n     KisBrushSP brush = m_brush;\n@@ -175,23 +175,24 @@ void KisTangentNormalPaintOp::paintLine(const KisPaintInformation& pi1, const Ki\n \tif (currentSpace != \"RGBA\") {\n \t    rgbColorSpace = KoColorSpaceRegistry::instance()->rgb8();\n \t} else {\n-\t    QString bit = rgbColorSpace->colorDepthId().id();//let Krita tell you what the bit depth string is.\n-\t    rgbColorSpace = KoColorSpaceRegistry::instance()->colorSpace(\"RGBA\", bit, currentColor.profile() );\n+\t    rgbColorSpace = currentColor.colorSpace();\n \t}\n-\tquint8 data[4];\n+\tQVector <float> channelValues(4);\n \n-\tdata[0] = 255;//blue\n-\tdata[1] = 128;//green\n-\tdata[2] = 128;//red\n-\tdata[3] = 255;//alpha, leave alone.\n+\tchannelValues[0] = 1.0;//blue\n+\tchannelValues[1] = 0.5;//green\n+\tchannelValues[2] = 0.5;//red\n+\tchannelValues[3] = 1.0;//alpha, leave alone.\n \n-\tquint8 r, g, b;\n+\tqreal r, g, b;\n \tm_tangentTiltOption.apply(pi2, &r, &g, &b);\n \n-\tdata[0] = b;//blue\n-\tdata[1] = g;//green\n-\tdata[2] = r;//red\n+\tchannelValues[0] = b;//blue\n+\tchannelValues[1] = g;//green\n+\tchannelValues[2] = r;//red\n \n+\tquint8 data[4];\n+\trgbColorSpace->fromNormalisedChannelsValue(data, channelValues);\n \tKoColor color(data, rgbColorSpace);\n         p.setPaintColor(color);\n         p.drawDDALine(pi1.pos(), pi2.pos());"}, {"sha": "1e1733d61dae04797a8fafb8fd4f5012954e9d94", "filename": "plugins/paintops/tangentnormal/kis_tangent_tilt_option.cpp", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/ec87c47ab3569fdbabf4acf34a2ee178f12e8854/plugins/paintops/tangentnormal/kis_tangent_tilt_option.cpp", "raw_url": "https://github.com/KDE/krita/raw/ec87c47ab3569fdbabf4acf34a2ee178f12e8854/plugins/paintops/tangentnormal/kis_tangent_tilt_option.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/tangentnormal/kis_tangent_tilt_option.cpp?ref=ec87c47ab3569fdbabf4acf34a2ee178f12e8854", "patch": "@@ -130,7 +130,7 @@ double KisTangentTiltOption::mixValue() const\n     return m_options->sliderMixValue->value();\n }\n \n-void KisTangentTiltOption::swizzleAssign(qreal const horizontal, qreal const vertical, qreal const depth, quint8 *component, int index, qreal maxvalue)\n+void KisTangentTiltOption::swizzleAssign(qreal const horizontal, qreal const vertical, qreal const depth, qreal *component, int index, qreal maxvalue)\n {\n     switch(index) {\n     case 0: *component = horizontal; break;\n@@ -142,16 +142,16 @@ void KisTangentTiltOption::swizzleAssign(qreal const horizontal, qreal const ver\n     }\n }\n \n-void KisTangentTiltOption::apply(const KisPaintInformation& info,quint8 *r,quint8 *g,quint8 *b)\n+void KisTangentTiltOption::apply(const KisPaintInformation& info,qreal *r,qreal *g,qreal *b)\n {\n     //formula based on http://www.cerebralmeltdown.com/programming_projects/Altitude%20and%20Azimuth%20to%20Vector/index.html\n \n     /* It doesn't make sense of have higher than 8bit color depth.\n      * Instead we make sure in the paintAt function of kis_tangent_normal_paintop to pick an 8bit space of the current\n      * color space if the space is an RGB space. If not, it'll pick sRGB 8bit.\n      */\n-    qreal halfvalue = 128;\n-    qreal maxvalue = 255;\n+    qreal halfvalue = 0.5;\n+    qreal maxvalue = 1.0;\n \n     //have the azimuth and altitude in degrees.\n     qreal direction = KisPaintInformation::tiltDirection(info, true)*360.0;"}, {"sha": "11d8805d3bde4a8001fe5739e3a76f1cce4a914b", "filename": "plugins/paintops/tangentnormal/kis_tangent_tilt_option.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/ec87c47ab3569fdbabf4acf34a2ee178f12e8854/plugins/paintops/tangentnormal/kis_tangent_tilt_option.h", "raw_url": "https://github.com/KDE/krita/raw/ec87c47ab3569fdbabf4acf34a2ee178f12e8854/plugins/paintops/tangentnormal/kis_tangent_tilt_option.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/tangentnormal/kis_tangent_tilt_option.h?ref=ec87c47ab3569fdbabf4acf34a2ee178f12e8854", "patch": "@@ -54,10 +54,10 @@ class KisTangentTiltOption: public KisPaintOpOption//not really//\n     bool m_canvasAxisXMirrored;\n     bool m_canvasAxisYMirrored;\n     /*This assigns the right axis to the component, based on index and maximum value*/\n-    void swizzleAssign(qreal const horizontal, qreal const vertical, qreal const depth, quint8 *component, int index, qreal maxvalue);\n+    void swizzleAssign(qreal const horizontal, qreal const vertical, qreal const depth, qreal *component, int index, qreal maxvalue);\n \n     //takes the RGB values and will deform them depending on tilt.\n-    void apply(const KisPaintInformation& info,quint8 *r,quint8 *g,quint8 *b);\n+    void apply(const KisPaintInformation& info, qreal *r, qreal *g, qreal *b);\n \n     void writeOptionSetting(KisPropertiesConfiguration* setting) const;\n     void readOptionSetting(const KisPropertiesConfiguration* setting);"}]}, {"sha": "8a9660abf3e52e7a8553d0fb44a50c3639253c9d", "stats": {"total": 15, "additions": 15, "deletions": 0}, "files": [{"sha": "c2ae9a5ea6e0915f40e2c3928d67050e907acd92", "filename": "libs/image/kis_layer.cc", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/KDE/krita/blob/8a9660abf3e52e7a8553d0fb44a50c3639253c9d/libs/image/kis_layer.cc", "raw_url": "https://github.com/KDE/krita/raw/8a9660abf3e52e7a8553d0fb44a50c3639253c9d/libs/image/kis_layer.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_layer.cc?ref=8a9660abf3e52e7a8553d0fb44a50c3639253c9d", "patch": "@@ -742,9 +742,24 @@ QRect KisLayer::changeRect(const QRect &rect, PositionToFilthy pos) const\n     changeRect = incomingChangeRect(changeRect);\n \n     if(pos == KisNode::N_FILTHY) {\n+        QRect projectionToBeUpdated = projection()->exactBoundsAmortized() & changeRect;\n+\n         bool changeRectVaries;\n         changeRect = outgoingChangeRect(changeRect);\n         changeRect = masksChangeRect(effectMasks(), changeRect, changeRectVaries);\n+\n+        /**\n+         * If the projection contains some dirty areas we should also\n+         * add them to the change rect, because they might have\n+         * changed. E.g. when a visibility of the mask has chnaged\n+         * while the parent layer was invinisble.\n+         */\n+\n+        if (!projectionToBeUpdated.isEmpty() &&\n+            !changeRect.contains(projectionToBeUpdated)) {\n+\n+            changeRect |= projectionToBeUpdated;\n+        }\n     }\n \n     // TODO: string comparizon: optimize!"}]}, {"sha": "eeb0a5b91c1bcfa961b1fee7cf57560e998f9e51", "stats": {"total": 82, "additions": 82, "deletions": 0}, "files": [{"sha": "b0a3904791efe33a2cc25bf2beb4b9e08c1f91f9", "filename": "libs/image/kis_lock_free_cache.h", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/KDE/krita/blob/eeb0a5b91c1bcfa961b1fee7cf57560e998f9e51/libs/image/kis_lock_free_cache.h", "raw_url": "https://github.com/KDE/krita/raw/eeb0a5b91c1bcfa961b1fee7cf57560e998f9e51/libs/image/kis_lock_free_cache.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_lock_free_cache.h?ref=eeb0a5b91c1bcfa961b1fee7cf57560e998f9e51", "patch": "@@ -148,6 +148,23 @@ class KisLockFreeCache\n         }\n     }\n \n+    bool tryGetValue(T &result) const {\n+        KisCacheStateValue::SeqValue seqValue;\n+        bool isValid = false;\n+        T newValue;\n+\n+        if (m_state.startRead(&seqValue)) {\n+            newValue = m_value;\n+            isValid = m_state.endRead(seqValue);\n+        }\n+\n+        if (isValid) {\n+            result = newValue;\n+        }\n+\n+        return isValid;\n+    }\n+\n protected:\n     /**\n      * Calculate the value. Used by the cache"}, {"sha": "cc241a085892073bd298139a0962b39312568a31", "filename": "libs/image/kis_paint_device.cc", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/eeb0a5b91c1bcfa961b1fee7cf57560e998f9e51/libs/image/kis_paint_device.cc", "raw_url": "https://github.com/KDE/krita/raw/eeb0a5b91c1bcfa961b1fee7cf57560e998f9e51/libs/image/kis_paint_device.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_paint_device.cc?ref=eeb0a5b91c1bcfa961b1fee7cf57560e998f9e51", "patch": "@@ -1030,6 +1030,11 @@ QRect KisPaintDevice::exactBounds() const\n     return m_d->cache()->exactBounds();\n }\n \n+QRect KisPaintDevice::exactBoundsAmortized() const\n+{\n+    return m_d->cache()->exactBoundsAmortized();\n+}\n+\n namespace Impl {\n \n struct CheckFullyTransparent"}, {"sha": "738df2f8c56aa385812c5a1c314d61838b98159c", "filename": "libs/image/kis_paint_device.h", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/KDE/krita/blob/eeb0a5b91c1bcfa961b1fee7cf57560e998f9e51/libs/image/kis_paint_device.h", "raw_url": "https://github.com/KDE/krita/raw/eeb0a5b91c1bcfa961b1fee7cf57560e998f9e51/libs/image/kis_paint_device.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_paint_device.h?ref=eeb0a5b91c1bcfa961b1fee7cf57560e998f9e51", "patch": "@@ -208,6 +208,15 @@ class KRITAIMAGE_EXPORT KisPaintDevice\n     QRect exactBounds() const;\n \n     /**\n+     * Relaxed version of the exactBounds() that can be used in tight\n+     * loops.  If the exact bounds value is present in the paint\n+     * device cache, returns this value.  If the cache is invalidated,\n+     * returns extent() and tries to recalculate the exact bounds not\n+     * faster than once in 1000 ms.\n+     */\n+    QRect exactBoundsAmortized() const;\n+\n+    /**\n      * Retuns exact rectangle of the paint device that contains\n      * non-default pixels. For paint devices with fully transparent\n      * default pixel is equivalent to exactBounds()."}, {"sha": "f72370fe670b0e5b89088422fe77cadac89fefb8", "filename": "libs/image/kis_paint_device_cache.h", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/KDE/krita/blob/eeb0a5b91c1bcfa961b1fee7cf57560e998f9e51/libs/image/kis_paint_device_cache.h", "raw_url": "https://github.com/KDE/krita/raw/eeb0a5b91c1bcfa961b1fee7cf57560e998f9e51/libs/image/kis_paint_device_cache.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_paint_device_cache.h?ref=eeb0a5b91c1bcfa961b1fee7cf57560e998f9e51", "patch": "@@ -20,6 +20,7 @@\n #define __KIS_PAINT_DEVICE_CACHE_H\n \n #include \"kis_lock_free_cache.h\"\n+#include <QElapsedTimer>\n \n \n class KisPaintDeviceCache\n@@ -56,6 +57,26 @@ class KisPaintDeviceCache\n         return m_exactBoundsCache.getValue();\n     }\n \n+    QRect exactBoundsAmortized() {\n+        QRect bounds;\n+        bool result = m_exactBoundsCache.tryGetValue(bounds);\n+\n+        const int msecThreshold = 1000;\n+\n+        if (!result) {\n+            if (!m_lastCalculatedExactBounds.isValid() ||\n+                m_lastCalculatedExactBounds.elapsed() > msecThreshold) {\n+\n+                m_lastCalculatedExactBounds.restart();\n+                bounds = exactBounds();\n+            } else {\n+                bounds = m_paintDevice->extent();\n+            }\n+        }\n+\n+        return bounds;\n+    }\n+\n     QRect nonDefaultPixelArea() {\n         return m_nonDefaultPixelAreaCache.getValue();\n     }\n@@ -133,6 +154,7 @@ class KisPaintDeviceCache\n     ExactBoundsCache m_exactBoundsCache;\n     NonDefaultPixelCache m_nonDefaultPixelAreaCache;\n     RegionCache m_regionCache;\n+    QElapsedTimer m_lastCalculatedExactBounds;\n \n     bool m_thumbnailsValid;\n     QMap<int, QMap<int, QImage> > m_thumbnails;"}, {"sha": "f825d8cceb79c5cf7656fb4631c6353ebf1eb25b", "filename": "libs/image/tests/kis_paint_device_test.cpp", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/KDE/krita/blob/eeb0a5b91c1bcfa961b1fee7cf57560e998f9e51/libs/image/tests/kis_paint_device_test.cpp", "raw_url": "https://github.com/KDE/krita/raw/eeb0a5b91c1bcfa961b1fee7cf57560e998f9e51/libs/image/tests/kis_paint_device_test.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/tests/kis_paint_device_test.cpp?ref=eeb0a5b91c1bcfa961b1fee7cf57560e998f9e51", "patch": "@@ -722,6 +722,34 @@ void KisPaintDeviceTest::benchmarkExactBoundsNullDefaultPixel()\n     QCOMPARE(measuredRect, fillRect);\n }\n \n+void KisPaintDeviceTest::testAmortizedExactBounds()\n+{\n+    const KoColorSpace *cs = KoColorSpaceRegistry::instance()->rgb8();\n+    KisPaintDeviceSP dev = new KisPaintDevice(cs);\n+\n+    QVERIFY(dev->exactBounds().isEmpty());\n+\n+    QRect fillRect(60,60, 833, 833);\n+    QRect extent(0,0,896,896);\n+\n+    dev->fill(fillRect, KoColor(Qt::white, cs));\n+\n+    QCOMPARE(dev->exactBounds(), fillRect);\n+    QCOMPARE(dev->extent(), extent);\n+\n+    QCOMPARE(dev->exactBoundsAmortized(), fillRect);\n+\n+    dev->setDirty();\n+    QCOMPARE(dev->exactBoundsAmortized(), fillRect);\n+\n+    dev->setDirty();\n+    QCOMPARE(dev->exactBoundsAmortized(), extent);\n+\n+    QTest::qSleep(1100);\n+\n+    QCOMPARE(dev->exactBoundsAmortized(), fillRect);\n+}\n+\n void KisPaintDeviceTest::testNonDefaultPixelArea()\n {\n     const KoColorSpace *cs = KoColorSpaceRegistry::instance()->rgb8();"}, {"sha": "ae4b89c89ea9b4ec531b21449eaeb90b29068735", "filename": "libs/image/tests/kis_paint_device_test.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/eeb0a5b91c1bcfa961b1fee7cf57560e998f9e51/libs/image/tests/kis_paint_device_test.h", "raw_url": "https://github.com/KDE/krita/raw/eeb0a5b91c1bcfa961b1fee7cf57560e998f9e51/libs/image/tests/kis_paint_device_test.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/tests/kis_paint_device_test.h?ref=eeb0a5b91c1bcfa961b1fee7cf57560e998f9e51", "patch": "@@ -49,6 +49,7 @@ private Q_SLOTS:\n     void testOpacity();\n     void testExactBoundsWeirdNullAlphaCase();\n     void benchmarkExactBoundsNullDefaultPixel();\n+    void testAmortizedExactBounds();\n     void testNonDefaultPixelArea();\n     void testExactBoundsNonTransparent();\n "}]}, {"sha": "96bc05ad99c1f0a404d4b3c4ace66b100260ccfc", "stats": {"total": 915, "additions": 913, "deletions": 2}, "files": [{"sha": "33f384752e6b933dfc354a0ae5a282f7497f25dd", "filename": "krita/pics/tools/SVG/16/dark_artistic_text.svg", "status": "added", "additions": 205, "deletions": 0, "changes": 205, "blob_url": "https://github.com/KDE/krita/blob/96bc05ad99c1f0a404d4b3c4ace66b100260ccfc/krita/pics/tools/SVG/16/dark_artistic_text.svg", "raw_url": "https://github.com/KDE/krita/raw/96bc05ad99c1f0a404d4b3c4ace66b100260ccfc/krita/pics/tools/SVG/16/dark_artistic_text.svg", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/pics/tools/SVG/16/dark_artistic_text.svg?ref=96bc05ad99c1f0a404d4b3c4ace66b100260ccfc", "patch": "@@ -0,0 +1,205 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<!-- Created with Inkscape (http://www.inkscape.org/) -->\n+\n+<svg\n+   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n+   xmlns:cc=\"http://creativecommons.org/ns#\"\n+   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\n+   xmlns:svg=\"http://www.w3.org/2000/svg\"\n+   xmlns=\"http://www.w3.org/2000/svg\"\n+   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\n+   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\n+   width=\"32\"\n+   height=\"32\"\n+   viewBox=\"0 0 32 32.000001\"\n+   id=\"svg2\"\n+   version=\"1.1\"\n+   inkscape:version=\"0.91 r13725\"\n+   sodipodi:docname=\"dark_artistic_text.svg\"\n+   inkscape:export-filename=\"/run/media/andrei/C2942CC0942CB8B5/dribbble/krita icons/Collaborate/1_flat_dark/tools/light_draw-text.png\"\n+   inkscape:export-xdpi=\"45\"\n+   inkscape:export-ydpi=\"45\">\n+  <defs\n+     id=\"defs4\">\n+    <filter\n+       style=\"color-interpolation-filters:sRGB;\"\n+       inkscape:label=\"Drop Shadow\"\n+       id=\"filter4429\">\n+      <feFlood\n+         flood-opacity=\"0.501961\"\n+         flood-color=\"rgb(0,0,0)\"\n+         result=\"flood\"\n+         id=\"feFlood4431\" />\n+      <feComposite\n+         in=\"flood\"\n+         in2=\"SourceGraphic\"\n+         operator=\"in\"\n+         result=\"composite1\"\n+         id=\"feComposite4433\" />\n+      <feGaussianBlur\n+         in=\"composite1\"\n+         stdDeviation=\"0\"\n+         result=\"blur\"\n+         id=\"feGaussianBlur4435\" />\n+      <feOffset\n+         dx=\"0\"\n+         dy=\"-2\"\n+         result=\"offset\"\n+         id=\"feOffset4437\" />\n+      <feComposite\n+         in=\"SourceGraphic\"\n+         in2=\"offset\"\n+         operator=\"over\"\n+         result=\"composite2\"\n+         id=\"feComposite4439\" />\n+    </filter>\n+    <filter\n+       style=\"color-interpolation-filters:sRGB;\"\n+       inkscape:label=\"Drop Shadow\"\n+       id=\"filter4326\">\n+      <feFlood\n+         flood-opacity=\"0.501961\"\n+         flood-color=\"rgb(0,0,0)\"\n+         result=\"flood\"\n+         id=\"feFlood4328\" />\n+      <feComposite\n+         in=\"flood\"\n+         in2=\"SourceGraphic\"\n+         operator=\"in\"\n+         result=\"composite1\"\n+         id=\"feComposite4330\" />\n+      <feGaussianBlur\n+         in=\"composite1\"\n+         stdDeviation=\"0\"\n+         result=\"blur\"\n+         id=\"feGaussianBlur4332\" />\n+      <feOffset\n+         dx=\"0\"\n+         dy=\"-2\"\n+         result=\"offset\"\n+         id=\"feOffset4334\" />\n+      <feComposite\n+         in=\"SourceGraphic\"\n+         in2=\"offset\"\n+         operator=\"over\"\n+         result=\"composite2\"\n+         id=\"feComposite4336\" />\n+    </filter>\n+    <filter\n+       style=\"color-interpolation-filters:sRGB;\"\n+       inkscape:label=\"Drop Shadow\"\n+       id=\"filter5523\">\n+      <feFlood\n+         flood-opacity=\"0.501961\"\n+         flood-color=\"rgb(0,0,0)\"\n+         result=\"flood\"\n+         id=\"feFlood5525\" />\n+      <feComposite\n+         in=\"flood\"\n+         in2=\"SourceGraphic\"\n+         operator=\"in\"\n+         result=\"composite1\"\n+         id=\"feComposite5527\" />\n+      <feGaussianBlur\n+         in=\"composite1\"\n+         stdDeviation=\"0\"\n+         result=\"blur\"\n+         id=\"feGaussianBlur5529\" />\n+      <feOffset\n+         dx=\"0\"\n+         dy=\"-2\"\n+         result=\"offset\"\n+         id=\"feOffset5531\" />\n+      <feComposite\n+         in=\"SourceGraphic\"\n+         in2=\"offset\"\n+         operator=\"over\"\n+         result=\"composite2\"\n+         id=\"feComposite5533\" />\n+    </filter>\n+  </defs>\n+  <sodipodi:namedview\n+     id=\"base\"\n+     pagecolor=\"#474747\"\n+     bordercolor=\"#666666\"\n+     borderopacity=\"1.0\"\n+     inkscape:pageopacity=\"0\"\n+     inkscape:pageshadow=\"2\"\n+     inkscape:zoom=\"7.9999999\"\n+     inkscape:cx=\"27.589973\"\n+     inkscape:cy=\"18.068852\"\n+     inkscape:document-units=\"px\"\n+     inkscape:current-layer=\"g4154\"\n+     showgrid=\"false\"\n+     units=\"px\"\n+     inkscape:showpageshadow=\"false\"\n+     showborder=\"true\"\n+     inkscape:window-width=\"1149\"\n+     inkscape:window-height=\"517\"\n+     inkscape:window-x=\"2124\"\n+     inkscape:window-y=\"367\"\n+     inkscape:window-maximized=\"1\"\n+     objecttolerance=\"20\">\n+    <inkscape:grid\n+       type=\"xygrid\"\n+       id=\"grid3336\"\n+       dotted=\"false\"\n+       empspacing=\"1\"\n+       snapvisiblegridlinesonly=\"true\"\n+       enabled=\"true\"\n+       visible=\"true\"\n+       empcolor=\"#aaaaff\"\n+       empopacity=\"0.25098039\"\n+       color=\"#7878ff\"\n+       opacity=\"0.1254902\"\n+       spacingx=\"2\"\n+       spacingy=\"2.0000001\" />\n+  </sodipodi:namedview>\n+  <metadata\n+     id=\"metadata7\">\n+    <rdf:RDF>\n+      <cc:Work\n+         rdf:about=\"\">\n+        <dc:format>image/svg+xml</dc:format>\n+        <dc:type\n+           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\n+        <dc:title />\n+        <dc:creator>\n+          <cc:Agent>\n+            <dc:title>Andrei Rudenko</dc:title>\n+          </cc:Agent>\n+        </dc:creator>\n+      </cc:Work>\n+    </rdf:RDF>\n+  </metadata>\n+  <g\n+     inkscape:groupmode=\"layer\"\n+     id=\"layer3\"\n+     inkscape:label=\"v1\"\n+     style=\"display:none\">\n+    <path\n+       style=\"opacity:1;fill:#cacaca;fill-opacity:1;stroke:none;stroke-width:2;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:1;stroke-opacity:1\"\n+       d=\"m 2,0 0,4 0,6 4,0 0,-2 C 6,5.9999995 8,4 12,4 l 2,0 0,22 c 0,1 -1,2 -2,2 l -2,0 0,4 4,0 4,0 4,0 0,-4 -2,0 c -1,0 -2,-1 -2,-2 l 0,-22 2,0 c 4,0 6,1.9999995 6,4 l 0,2 4,0 L 30,0 6,0 Z\"\n+       id=\"rect4360\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccssccccccccccccssccccc\" />\n+  </g>\n+  <g\n+     style=\"display:inline\"\n+     inkscape:label=\"v1 copy\"\n+     id=\"g4154\"\n+     inkscape:groupmode=\"layer\">\n+    <path\n+       style=\"display:inline;fill:none;fill-rule:evenodd;stroke:#1e1e1e;stroke-width:2.03568077;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\n+       d=\"m 30.109625,2.1497056 c 0,0 3.036297,11.4038404 -7.176455,21.4821874 -7.774523,7.672201 -21.2304316,5.830883 -21.2304316,5.830883\"\n+       id=\"path4149-2\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"csc\" />\n+    <path\n+       inkscape:connector-curvature=\"0\"\n+       d=\"m 6.9842654,11.950882 c -0.511725,-0.375509 -0.885061,-0.594638 -1.137125,-0.634428 -0.2521,-0.03974 -0.543075,0.15815 -0.872919,0.593677 -0.60634,0.800613 -0.930911,1.482025 -0.973715,2.044237 -0.04436,0.550964 -0.0039,1.176235 0.12137,1.875826 0.123724,0.68833 0.07887,1.173406 -0.134567,1.455225 -0.460817,0.608463 -0.992252,0.684709 -1.594312,0.228742 -0.269005,-0.20373 -0.487258,-0.43455 -0.654782,-0.692429 -1.01687401,-1.092633 -1.52542699,-1.785182 -1.52566199,-2.077641 -6.2e-4,-0.212106 0.21735798,-0.606385 0.65392198,-1.182826 L 10.194394,1.2446616 c 0.436561,-0.57643603 0.754585,-0.88989503 0.954081,-0.94038503 0.464963,-0.121551 1.271835,0.177094 2.420619,0.89593903 0.295188,0.10262 0.574082,0.253369 0.836681,0.452248 0.60206,0.455967 0.675107,0.984978 0.219139,1.587039 -0.213431,0.281815 -0.670621,0.459642 -1.371578,0.533492 -0.707358,0.069 -1.322627,0.202704 -1.845801,0.401116 -0.524723,0.187152 -1.090256,0.681036 -1.696596,1.481649 -0.324996,0.429125 -0.436634,0.76284 -0.334907,1.001137 0.106578,0.23189 0.407125,0.547131 0.918843,0.922649 l 8.915644,6.5425814 c 0.686619,0.503856 1.220389,0.697488 1.624407,0.549941 l 0.364733,-0.16219 c 0.507063,-0.190453 0.895099,-0.183812 1.164101,0.01991 0.550821,0.417161 0.537616,1.006834 -0.03962,1.769014 l -3.456131,4.563482 c -0.596636,0.7878 -1.170369,0.97312 -1.721189,0.555959 -0.198548,-0.150369 -0.307919,-0.298728 -0.328135,-0.445044 -0.02661,-0.151177 -0.02635,-0.377749 7.8e-4,-0.679713 l 0.05,-0.38543 c 0.03254,-0.428884 -0.282948,-0.910737 -0.969564,-1.414597 z\"\n+       style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:76.15584564px;line-height:50%;font-family:JasmineUPC;-inkscape-font-specification:'JasmineUPC, Bold';text-align:start;letter-spacing:0px;word-spacing:0px;writing-mode:lr-tb;text-anchor:start;display:inline;opacity:0.594;fill:#050505;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       id=\"path4293\"\n+       sodipodi:nodetypes=\"sssccssccssccssccscssccsssscccss\" />\n+  </g>\n+</svg>"}, {"sha": "d561c4fc3cc6751b9e682fab43ea0fd03f07a98a", "filename": "krita/pics/tools/SVG/16/dark_shape_handling.svg", "status": "added", "additions": 246, "deletions": 0, "changes": 246, "blob_url": "https://github.com/KDE/krita/blob/96bc05ad99c1f0a404d4b3c4ace66b100260ccfc/krita/pics/tools/SVG/16/dark_shape_handling.svg", "raw_url": "https://github.com/KDE/krita/raw/96bc05ad99c1f0a404d4b3c4ace66b100260ccfc/krita/pics/tools/SVG/16/dark_shape_handling.svg", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/pics/tools/SVG/16/dark_shape_handling.svg?ref=96bc05ad99c1f0a404d4b3c4ace66b100260ccfc", "patch": "@@ -0,0 +1,246 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<!-- Created with Inkscape (http://www.inkscape.org/) -->\n+\n+<svg\n+   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n+   xmlns:cc=\"http://creativecommons.org/ns#\"\n+   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\n+   xmlns:svg=\"http://www.w3.org/2000/svg\"\n+   xmlns=\"http://www.w3.org/2000/svg\"\n+   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\n+   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\n+   width=\"32\"\n+   height=\"32\"\n+   viewBox=\"0 0 32 32.000001\"\n+   id=\"svg2\"\n+   version=\"1.1\"\n+   inkscape:version=\"0.91 r13725\"\n+   sodipodi:docname=\"dark_shape_handling.svg\"\n+   inkscape:export-filename=\"/run/media/andrei/C2942CC0942CB8B5/dribbble/krita icons/Collaborate/1_flat_dark/tools/light_calligraphy.png\"\n+   inkscape:export-xdpi=\"45\"\n+   inkscape:export-ydpi=\"45\">\n+  <defs\n+     id=\"defs4\">\n+    <filter\n+       style=\"color-interpolation-filters:sRGB;\"\n+       inkscape:label=\"Drop Shadow\"\n+       id=\"filter4280\">\n+      <feFlood\n+         flood-opacity=\"0.498039\"\n+         flood-color=\"rgb(0,0,0)\"\n+         result=\"flood\"\n+         id=\"feFlood4282\" />\n+      <feComposite\n+         in=\"flood\"\n+         in2=\"SourceGraphic\"\n+         operator=\"in\"\n+         result=\"composite1\"\n+         id=\"feComposite4284\" />\n+      <feGaussianBlur\n+         in=\"composite1\"\n+         stdDeviation=\"0\"\n+         result=\"blur\"\n+         id=\"feGaussianBlur4286\" />\n+      <feOffset\n+         dx=\"2.77556e-017\"\n+         dy=\"-2\"\n+         result=\"offset\"\n+         id=\"feOffset4288\" />\n+      <feComposite\n+         in=\"SourceGraphic\"\n+         in2=\"offset\"\n+         operator=\"over\"\n+         result=\"composite2\"\n+         id=\"feComposite4290\" />\n+    </filter>\n+    <filter\n+       style=\"color-interpolation-filters:sRGB;\"\n+       inkscape:label=\"Drop Shadow\"\n+       id=\"filter5596\">\n+      <feFlood\n+         flood-opacity=\"0.501961\"\n+         flood-color=\"rgb(0,0,0)\"\n+         result=\"flood\"\n+         id=\"feFlood5598\" />\n+      <feComposite\n+         in=\"flood\"\n+         in2=\"SourceGraphic\"\n+         operator=\"in\"\n+         result=\"composite1\"\n+         id=\"feComposite5600\" />\n+      <feGaussianBlur\n+         in=\"composite1\"\n+         stdDeviation=\"0\"\n+         result=\"blur\"\n+         id=\"feGaussianBlur5602\" />\n+      <feOffset\n+         dx=\"2.77556e-017\"\n+         dy=\"-2\"\n+         result=\"offset\"\n+         id=\"feOffset5604\" />\n+      <feComposite\n+         in=\"SourceGraphic\"\n+         in2=\"offset\"\n+         operator=\"over\"\n+         result=\"composite2\"\n+         id=\"feComposite5606\" />\n+    </filter>\n+  </defs>\n+  <sodipodi:namedview\n+     id=\"base\"\n+     pagecolor=\"#474747\"\n+     bordercolor=\"#666666\"\n+     borderopacity=\"1.0\"\n+     inkscape:pageopacity=\"0\"\n+     inkscape:pageshadow=\"2\"\n+     inkscape:zoom=\"16\"\n+     inkscape:cx=\"25.906542\"\n+     inkscape:cy=\"18.067882\"\n+     inkscape:document-units=\"px\"\n+     inkscape:current-layer=\"layer1\"\n+     showgrid=\"false\"\n+     units=\"px\"\n+     inkscape:showpageshadow=\"false\"\n+     showborder=\"true\"\n+     inkscape:window-width=\"1920\"\n+     inkscape:window-height=\"1017\"\n+     inkscape:window-x=\"1592\"\n+     inkscape:window-y=\"-8\"\n+     inkscape:window-maximized=\"1\"\n+     objecttolerance=\"10\"\n+     guidetolerance=\"10\"\n+     inkscape:snap-perpendicular=\"true\"\n+     inkscape:snap-tangential=\"true\"\n+     inkscape:snap-path-clip=\"true\"\n+     inkscape:snap-path-mask=\"true\"\n+     gridtolerance=\"10\"\n+     showguides=\"true\">\n+    <inkscape:grid\n+       type=\"xygrid\"\n+       id=\"grid3336\"\n+       dotted=\"false\"\n+       empspacing=\"1\"\n+       snapvisiblegridlinesonly=\"true\"\n+       enabled=\"true\"\n+       visible=\"true\"\n+       empcolor=\"#aaaaff\"\n+       empopacity=\"0.25098039\"\n+       color=\"#7878ff\"\n+       opacity=\"0.1254902\"\n+       spacingx=\"2\"\n+       spacingy=\"2.0000001\" />\n+  </sodipodi:namedview>\n+  <metadata\n+     id=\"metadata7\">\n+    <rdf:RDF>\n+      <cc:Work\n+         rdf:about=\"\">\n+        <dc:format>image/svg+xml</dc:format>\n+        <dc:type\n+           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\n+        <dc:title />\n+        <dc:creator>\n+          <cc:Agent>\n+            <dc:title>Andrei Rudenko</dc:title>\n+          </cc:Agent>\n+        </dc:creator>\n+      </cc:Work>\n+    </rdf:RDF>\n+  </metadata>\n+  <g\n+     inkscape:groupmode=\"layer\"\n+     id=\"layer3\"\n+     inkscape:label=\"Layer 3\"\n+     style=\"display:none\">\n+    <path\n+       style=\"opacity:1;fill:#cacaca;fill-opacity:1;stroke:none;stroke-width:2;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:1;stroke-opacity:1\"\n+       d=\"m 19.640491,21.608542 c 0.481192,4.391997 -4.559846,6.992766 -6.439853,7.675092 -3.31028,1.201425 -10.1403284,0.675039 -13.10407386,-0.819812 -0.6788232,-0.49186 5.36634866,-1.494359 5.98233156,-5.017737 0.3786527,-2.165867 1.2795682,-7.586077 6.0251183,-8.244047 3.962098,-0.549344 7.165987,3.024927 7.536477,6.406504 z\"\n+       id=\"path4171\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"sscsss\" />\n+    <path\n+       style=\"fill:#cacaca;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       d=\"m 15.207024,13.937147 c 2.333842,0.386972 4.895586,2.565916 5.385678,4.577888 0.277189,0.943348 2.614657,-1.018254 2.259914,-2.36818 -1.261052,-2.782065 -3.970326,-4.680627 -6.408155,-4.596194 -0.881229,0.01424 -1.949958,2.340991 -1.237437,2.386486 z\"\n+       id=\"path4174\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccc\" />\n+    <path\n+       style=\"display:inline;fill:#cacaca;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       d=\"m 18.434109,9.7592901 c 2.333842,0.3869719 5.2226,2.7647909 5.712692,4.7767629 0.277189,0.943348 8.629506,-7.8462545 8.274763,-9.1961805 C 33.502804,-2.8780764 32,-6e-7 24.510808,-0.4053706 22.126977,-0.2585481 17.721588,9.7137951 18.434109,9.7592901 Z\"\n+       id=\"path4174-3\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccc\" />\n+    <g\n+       style=\"display:inline\"\n+       id=\"g4261-8-5\"\n+       transform=\"translate(0,6)\" />\n+  </g>\n+  <g\n+     style=\"display:none;opacity:0.19599998\"\n+     inkscape:label=\"Layer 3 copy\"\n+     id=\"g4152\"\n+     inkscape:groupmode=\"layer\"\n+     sodipodi:insensitive=\"true\">\n+    <g\n+       transform=\"translate(0,6)\"\n+       id=\"g4160\"\n+       style=\"display:inline\" />\n+    <path\n+       inkscape:connector-curvature=\"0\"\n+       d=\"m 11.219417,15.892144 c -4.2656666,0.924486 -5.8798289,4.76152 -5.7602025,7.676073 0.1290153,3.143304 -3.2492423,5.634064 -5.37088721,6.064991 2.88480171,2.290554 7.10590391,2.632817 10.91981371,1.858174 5.581946,-1.133748 9.38291,-5.486724 8.3665,-10.490964 -0.763458,-3.75884 -3.973912,-6.014478 -8.155224,-5.108274 z\"\n+       id=\"path6\"\n+       sodipodi:nodetypes=\"sscsss\"\n+       style=\"fill:#cacaca\" />\n+    <path\n+       style=\"display:inline;fill:#cacaca;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       d=\"m 15.419679,13.919707 c 2.333842,0.386972 4.895586,2.565916 5.385678,4.577888 0.277189,0.943348 2.614657,-1.018254 2.259914,-2.36818 -1.261052,-2.782065 -3.970326,-4.680627 -6.408155,-4.596194 -0.881229,0.01424 -1.949958,2.340991 -1.237437,2.386486 z\"\n+       id=\"path4174-1\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccc\" />\n+    <path\n+       style=\"display:inline;fill:#cacaca;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       d=\"m 18.646764,9.7418502 c 2.333842,0.3869718 5.2226,2.7647908 5.712692,4.7767628 0.277189,0.943348 8.629506,-7.8462544 8.274763,-9.1961804 1.08124,-8.2179489 -0.421564,-5.33987312 -7.910756,-5.74524312 -2.383831,0.1468225 -6.78922,10.11916572 -6.076699,10.16466072 z\"\n+       id=\"path4174-3-9\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccc\" />\n+  </g>\n+  <g\n+     inkscape:groupmode=\"layer\"\n+     id=\"layer1\"\n+     inkscape:label=\"Layer 3 copy 1\"\n+     style=\"opacity:1\">\n+    <path\n+       style=\"opacity:1;fill:#373737;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       d=\"m 14.78887,12.740477 16.760456,5.693053 -8.466644,4.544602 -5.129308,8.972617 z\"\n+       id=\"path4147\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccc\" />\n+    <path\n+       style=\"opacity:1;fill:none;fill-rule:evenodd;stroke:#373737;stroke-width:4.13358974;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\n+       d=\"m 3.240508,26.935423 c 0,0 -2.471994,-9.60653 5.842702,-18.0964696 C 15.412825,2.375936 26.367933,3.9270517 26.367933,3.9270517\"\n+       id=\"path4149\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"csc\" />\n+    <ellipse\n+       style=\"opacity:1;fill:#373737;fill-opacity:1;stroke:none;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\n+       id=\"path4151\"\n+       cx=\"28.072071\"\n+       cy=\"3.6685448\"\n+       rx=\"3.4082532\"\n+       ry=\"3.6192944\" />\n+    <ellipse\n+       style=\"opacity:1;fill:#373737;fill-opacity:1;stroke:none;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\n+       id=\"path4151-7\"\n+       cx=\"3.4839249\"\n+       cy=\"27.193954\"\n+       rx=\"3.4082532\"\n+       ry=\"3.6192944\" />\n+    <ellipse\n+       style=\"opacity:1;fill:#373737;fill-opacity:1;stroke:none;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\n+       id=\"path4151-3\"\n+       cx=\"10.543903\"\n+       cy=\"8.0633898\"\n+       rx=\"3.4082532\"\n+       ry=\"3.6192944\" />\n+  </g>\n+</svg>"}, {"sha": "8763e7faad26371af794ce8a9c03640a63a3ac00", "filename": "krita/pics/tools/SVG/16/light_artistic_text.svg", "status": "added", "additions": 210, "deletions": 0, "changes": 210, "blob_url": "https://github.com/KDE/krita/blob/96bc05ad99c1f0a404d4b3c4ace66b100260ccfc/krita/pics/tools/SVG/16/light_artistic_text.svg", "raw_url": "https://github.com/KDE/krita/raw/96bc05ad99c1f0a404d4b3c4ace66b100260ccfc/krita/pics/tools/SVG/16/light_artistic_text.svg", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/pics/tools/SVG/16/light_artistic_text.svg?ref=96bc05ad99c1f0a404d4b3c4ace66b100260ccfc", "patch": "@@ -0,0 +1,210 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<!-- Created with Inkscape (http://www.inkscape.org/) -->\n+\n+<svg\n+   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n+   xmlns:cc=\"http://creativecommons.org/ns#\"\n+   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\n+   xmlns:svg=\"http://www.w3.org/2000/svg\"\n+   xmlns=\"http://www.w3.org/2000/svg\"\n+   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\n+   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\n+   width=\"32\"\n+   height=\"32\"\n+   viewBox=\"0 0 32 32.000001\"\n+   id=\"svg2\"\n+   version=\"1.1\"\n+   inkscape:version=\"0.91 r13725\"\n+   sodipodi:docname=\"light_artistic_text.svg\"\n+   inkscape:export-filename=\"/run/media/andrei/C2942CC0942CB8B5/dribbble/krita icons/Collaborate/1_flat_dark/tools/light_draw-text.png\"\n+   inkscape:export-xdpi=\"45\"\n+   inkscape:export-ydpi=\"45\">\n+  <defs\n+     id=\"defs4\">\n+    <filter\n+       style=\"color-interpolation-filters:sRGB;\"\n+       inkscape:label=\"Drop Shadow\"\n+       id=\"filter4429\">\n+      <feFlood\n+         flood-opacity=\"0.501961\"\n+         flood-color=\"rgb(0,0,0)\"\n+         result=\"flood\"\n+         id=\"feFlood4431\" />\n+      <feComposite\n+         in=\"flood\"\n+         in2=\"SourceGraphic\"\n+         operator=\"in\"\n+         result=\"composite1\"\n+         id=\"feComposite4433\" />\n+      <feGaussianBlur\n+         in=\"composite1\"\n+         stdDeviation=\"0\"\n+         result=\"blur\"\n+         id=\"feGaussianBlur4435\" />\n+      <feOffset\n+         dx=\"0\"\n+         dy=\"-2\"\n+         result=\"offset\"\n+         id=\"feOffset4437\" />\n+      <feComposite\n+         in=\"SourceGraphic\"\n+         in2=\"offset\"\n+         operator=\"over\"\n+         result=\"composite2\"\n+         id=\"feComposite4439\" />\n+    </filter>\n+    <filter\n+       style=\"color-interpolation-filters:sRGB;\"\n+       inkscape:label=\"Drop Shadow\"\n+       id=\"filter4326\">\n+      <feFlood\n+         flood-opacity=\"0.501961\"\n+         flood-color=\"rgb(0,0,0)\"\n+         result=\"flood\"\n+         id=\"feFlood4328\" />\n+      <feComposite\n+         in=\"flood\"\n+         in2=\"SourceGraphic\"\n+         operator=\"in\"\n+         result=\"composite1\"\n+         id=\"feComposite4330\" />\n+      <feGaussianBlur\n+         in=\"composite1\"\n+         stdDeviation=\"0\"\n+         result=\"blur\"\n+         id=\"feGaussianBlur4332\" />\n+      <feOffset\n+         dx=\"0\"\n+         dy=\"-2\"\n+         result=\"offset\"\n+         id=\"feOffset4334\" />\n+      <feComposite\n+         in=\"SourceGraphic\"\n+         in2=\"offset\"\n+         operator=\"over\"\n+         result=\"composite2\"\n+         id=\"feComposite4336\" />\n+    </filter>\n+    <filter\n+       style=\"color-interpolation-filters:sRGB;\"\n+       inkscape:label=\"Drop Shadow\"\n+       id=\"filter5523\">\n+      <feFlood\n+         flood-opacity=\"0.501961\"\n+         flood-color=\"rgb(0,0,0)\"\n+         result=\"flood\"\n+         id=\"feFlood5525\" />\n+      <feComposite\n+         in=\"flood\"\n+         in2=\"SourceGraphic\"\n+         operator=\"in\"\n+         result=\"composite1\"\n+         id=\"feComposite5527\" />\n+      <feGaussianBlur\n+         in=\"composite1\"\n+         stdDeviation=\"0\"\n+         result=\"blur\"\n+         id=\"feGaussianBlur5529\" />\n+      <feOffset\n+         dx=\"0\"\n+         dy=\"-2\"\n+         result=\"offset\"\n+         id=\"feOffset5531\" />\n+      <feComposite\n+         in=\"SourceGraphic\"\n+         in2=\"offset\"\n+         operator=\"over\"\n+         result=\"composite2\"\n+         id=\"feComposite5533\" />\n+    </filter>\n+  </defs>\n+  <sodipodi:namedview\n+     id=\"base\"\n+     pagecolor=\"#474747\"\n+     bordercolor=\"#666666\"\n+     borderopacity=\"1.0\"\n+     inkscape:pageopacity=\"0\"\n+     inkscape:pageshadow=\"2\"\n+     inkscape:zoom=\"0.49999998\"\n+     inkscape:cx=\"-6.8777134\"\n+     inkscape:cy=\"0.37268398\"\n+     inkscape:document-units=\"px\"\n+     inkscape:current-layer=\"flowRoot4202\"\n+     showgrid=\"false\"\n+     units=\"px\"\n+     inkscape:showpageshadow=\"false\"\n+     showborder=\"true\"\n+     inkscape:window-width=\"989\"\n+     inkscape:window-height=\"450\"\n+     inkscape:window-x=\"336\"\n+     inkscape:window-y=\"505\"\n+     inkscape:window-maximized=\"0\"\n+     objecttolerance=\"20\">\n+    <inkscape:grid\n+       type=\"xygrid\"\n+       id=\"grid3336\"\n+       dotted=\"false\"\n+       empspacing=\"1\"\n+       snapvisiblegridlinesonly=\"true\"\n+       enabled=\"true\"\n+       visible=\"true\"\n+       empcolor=\"#aaaaff\"\n+       empopacity=\"0.25098039\"\n+       color=\"#7878ff\"\n+       opacity=\"0.1254902\"\n+       spacingx=\"2\"\n+       spacingy=\"2.0000001\" />\n+  </sodipodi:namedview>\n+  <metadata\n+     id=\"metadata7\">\n+    <rdf:RDF>\n+      <cc:Work\n+         rdf:about=\"\">\n+        <dc:format>image/svg+xml</dc:format>\n+        <dc:type\n+           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\n+        <dc:title />\n+        <dc:creator>\n+          <cc:Agent>\n+            <dc:title>Andrei Rudenko</dc:title>\n+          </cc:Agent>\n+        </dc:creator>\n+      </cc:Work>\n+    </rdf:RDF>\n+  </metadata>\n+  <g\n+     inkscape:groupmode=\"layer\"\n+     id=\"layer3\"\n+     inkscape:label=\"v1\"\n+     style=\"display:none\">\n+    <path\n+       style=\"opacity:1;fill:#cacaca;fill-opacity:1;stroke:none;stroke-width:2;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:1;stroke-opacity:1\"\n+       d=\"m 2,0 0,4 0,6 4,0 0,-2 C 6,5.9999995 8,4 12,4 l 2,0 0,22 c 0,1 -1,2 -2,2 l -2,0 0,4 4,0 4,0 4,0 0,-4 -2,0 c -1,0 -2,-1 -2,-2 l 0,-22 2,0 c 4,0 6,1.9999995 6,4 l 0,2 4,0 L 30,0 6,0 Z\"\n+       id=\"rect4360\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccssccccccccccccssccccc\" />\n+  </g>\n+  <g\n+     style=\"display:inline\"\n+     inkscape:label=\"v1 copy\"\n+     id=\"g4154\"\n+     inkscape:groupmode=\"layer\">\n+    <path\n+       style=\"fill:none;fill-rule:evenodd;stroke:#dcdcdc;stroke-width:2.03568077;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\n+       d=\"m 30.067546,2.2290808 c 0,0 3.036297,11.4038402 -7.176455,21.4821872 -7.774523,7.672201 -21.2304324,5.830883 -21.2304324,5.830883\"\n+       id=\"path4149-2\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"csc\" />\n+    <g\n+       transform=\"matrix(0.3409489,-0.45018961,0.45018961,0.3409489,-96.753651,60.714388)\"\n+       style=\"font-style:normal;font-weight:normal;font-size:76.15584564px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#f0f0f0;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       id=\"flowRoot4202\">\n+      <path\n+         inkscape:connector-curvature=\"0\"\n+         d=\"m 179.58309,94.331763 c -0.017,-1.123812 -0.1068,-1.885089 -0.32011,-2.283446 -0.21341,-0.39836 -0.80384,-0.597539 -1.77127,-0.597539 -1.77839,0 -3.08728,0.270315 -3.92667,0.810944 -0.82518,0.526403 -1.66457,1.251984 -2.5182,2.176744 -0.83939,0.910534 -1.57209,1.3658 -2.19809,1.3658 -1.35157,0 -2.02735,-0.668672 -2.02735,-2.006019 0,-0.597538 0.0925,-1.152394 0.27743,-1.664568 0.45526,-2.603558 0.88919,-4.061835 1.30178,-4.37483 0.29875,-0.227634 1.08836,-0.34145 2.3688,-0.34145 l 27.3587,0 c 1.28043,0 2.06291,0.113815 2.34746,0.34145 0.66867,0.526403 1.10971,1.984678 1.32312,4.37483 0.17072,0.526403 0.25608,1.081259 0.25608,1.664568 0,1.337347 -0.66867,2.006019 -2.00602,2.006019 -0.62599,0 -1.36579,-0.455266 -2.21942,-1.3658 -0.85362,-0.92476 -1.70014,-1.650341 -2.53954,-2.176744 -0.82516,-0.540629 -2.12694,-0.810944 -3.90533,-0.810944 -0.95321,0 -1.54364,0.199179 -1.77127,0.597539 -0.2134,0.398357 -0.33709,1.159634 -0.32011,2.283446 l 0.29593,19.580077 c 0.0228,1.50791 0.32011,2.4684 0.96032,2.88098 l 0.61888,0.34147 c 0.81094,0.51217 1.21641,1.06703 1.21641,1.66456 0,1.22353 -0.84651,1.8353 -2.53953,1.8353 l -10.1368,0 c -1.74993,0 -2.6249,-0.61177 -2.6249,-1.8353 0,-0.44103 0.0925,-0.75403 0.27743,-0.93899 0.18496,-0.19918 0.50507,-0.44104 0.96033,-0.72557 l 0.59754,-0.34147 c 0.64021,-0.41258 0.98312,-1.37307 0.96033,-2.88098 z\"\n+         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:76.15584564px;line-height:50%;font-family:JasmineUPC;-inkscape-font-specification:'JasmineUPC, Bold';text-align:start;writing-mode:lr-tb;text-anchor:start;opacity:0.594;fill:#f0f0f0;fill-opacity:1\"\n+         id=\"path4293\"\n+         sodipodi:nodetypes=\"sssccssccssccssccscssccsssscccss\" />\n+    </g>\n+  </g>\n+</svg>"}, {"sha": "ed36407a7c99cc1d97e2f0c4cd3109a1cbc3f025", "filename": "krita/pics/tools/SVG/16/light_shape_handling.svg", "status": "added", "additions": 246, "deletions": 0, "changes": 246, "blob_url": "https://github.com/KDE/krita/blob/96bc05ad99c1f0a404d4b3c4ace66b100260ccfc/krita/pics/tools/SVG/16/light_shape_handling.svg", "raw_url": "https://github.com/KDE/krita/raw/96bc05ad99c1f0a404d4b3c4ace66b100260ccfc/krita/pics/tools/SVG/16/light_shape_handling.svg", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/pics/tools/SVG/16/light_shape_handling.svg?ref=96bc05ad99c1f0a404d4b3c4ace66b100260ccfc", "patch": "@@ -0,0 +1,246 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<!-- Created with Inkscape (http://www.inkscape.org/) -->\n+\n+<svg\n+   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n+   xmlns:cc=\"http://creativecommons.org/ns#\"\n+   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\n+   xmlns:svg=\"http://www.w3.org/2000/svg\"\n+   xmlns=\"http://www.w3.org/2000/svg\"\n+   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\n+   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\n+   width=\"32\"\n+   height=\"32\"\n+   viewBox=\"0 0 32 32.000001\"\n+   id=\"svg2\"\n+   version=\"1.1\"\n+   inkscape:version=\"0.91 r13725\"\n+   sodipodi:docname=\"light_shape_handling.svg\"\n+   inkscape:export-filename=\"/run/media/andrei/C2942CC0942CB8B5/dribbble/krita icons/Collaborate/1_flat_dark/tools/light_calligraphy.png\"\n+   inkscape:export-xdpi=\"45\"\n+   inkscape:export-ydpi=\"45\">\n+  <defs\n+     id=\"defs4\">\n+    <filter\n+       style=\"color-interpolation-filters:sRGB;\"\n+       inkscape:label=\"Drop Shadow\"\n+       id=\"filter4280\">\n+      <feFlood\n+         flood-opacity=\"0.498039\"\n+         flood-color=\"rgb(0,0,0)\"\n+         result=\"flood\"\n+         id=\"feFlood4282\" />\n+      <feComposite\n+         in=\"flood\"\n+         in2=\"SourceGraphic\"\n+         operator=\"in\"\n+         result=\"composite1\"\n+         id=\"feComposite4284\" />\n+      <feGaussianBlur\n+         in=\"composite1\"\n+         stdDeviation=\"0\"\n+         result=\"blur\"\n+         id=\"feGaussianBlur4286\" />\n+      <feOffset\n+         dx=\"2.77556e-017\"\n+         dy=\"-2\"\n+         result=\"offset\"\n+         id=\"feOffset4288\" />\n+      <feComposite\n+         in=\"SourceGraphic\"\n+         in2=\"offset\"\n+         operator=\"over\"\n+         result=\"composite2\"\n+         id=\"feComposite4290\" />\n+    </filter>\n+    <filter\n+       style=\"color-interpolation-filters:sRGB;\"\n+       inkscape:label=\"Drop Shadow\"\n+       id=\"filter5596\">\n+      <feFlood\n+         flood-opacity=\"0.501961\"\n+         flood-color=\"rgb(0,0,0)\"\n+         result=\"flood\"\n+         id=\"feFlood5598\" />\n+      <feComposite\n+         in=\"flood\"\n+         in2=\"SourceGraphic\"\n+         operator=\"in\"\n+         result=\"composite1\"\n+         id=\"feComposite5600\" />\n+      <feGaussianBlur\n+         in=\"composite1\"\n+         stdDeviation=\"0\"\n+         result=\"blur\"\n+         id=\"feGaussianBlur5602\" />\n+      <feOffset\n+         dx=\"2.77556e-017\"\n+         dy=\"-2\"\n+         result=\"offset\"\n+         id=\"feOffset5604\" />\n+      <feComposite\n+         in=\"SourceGraphic\"\n+         in2=\"offset\"\n+         operator=\"over\"\n+         result=\"composite2\"\n+         id=\"feComposite5606\" />\n+    </filter>\n+  </defs>\n+  <sodipodi:namedview\n+     id=\"base\"\n+     pagecolor=\"#474747\"\n+     bordercolor=\"#666666\"\n+     borderopacity=\"1.0\"\n+     inkscape:pageopacity=\"0\"\n+     inkscape:pageshadow=\"2\"\n+     inkscape:zoom=\"11.313708\"\n+     inkscape:cx=\"7.076331\"\n+     inkscape:cy=\"8.3718342\"\n+     inkscape:document-units=\"px\"\n+     inkscape:current-layer=\"layer1\"\n+     showgrid=\"false\"\n+     units=\"px\"\n+     inkscape:showpageshadow=\"false\"\n+     showborder=\"true\"\n+     inkscape:window-width=\"1920\"\n+     inkscape:window-height=\"1017\"\n+     inkscape:window-x=\"1592\"\n+     inkscape:window-y=\"-8\"\n+     inkscape:window-maximized=\"1\"\n+     objecttolerance=\"10\"\n+     guidetolerance=\"10\"\n+     inkscape:snap-perpendicular=\"true\"\n+     inkscape:snap-tangential=\"true\"\n+     inkscape:snap-path-clip=\"true\"\n+     inkscape:snap-path-mask=\"true\"\n+     gridtolerance=\"10\"\n+     showguides=\"true\">\n+    <inkscape:grid\n+       type=\"xygrid\"\n+       id=\"grid3336\"\n+       dotted=\"false\"\n+       empspacing=\"1\"\n+       snapvisiblegridlinesonly=\"true\"\n+       enabled=\"true\"\n+       visible=\"true\"\n+       empcolor=\"#aaaaff\"\n+       empopacity=\"0.25098039\"\n+       color=\"#7878ff\"\n+       opacity=\"0.1254902\"\n+       spacingx=\"2\"\n+       spacingy=\"2.0000001\" />\n+  </sodipodi:namedview>\n+  <metadata\n+     id=\"metadata7\">\n+    <rdf:RDF>\n+      <cc:Work\n+         rdf:about=\"\">\n+        <dc:format>image/svg+xml</dc:format>\n+        <dc:type\n+           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\n+        <dc:title />\n+        <dc:creator>\n+          <cc:Agent>\n+            <dc:title>Andrei Rudenko</dc:title>\n+          </cc:Agent>\n+        </dc:creator>\n+      </cc:Work>\n+    </rdf:RDF>\n+  </metadata>\n+  <g\n+     inkscape:groupmode=\"layer\"\n+     id=\"layer3\"\n+     inkscape:label=\"Layer 3\"\n+     style=\"display:none\">\n+    <path\n+       style=\"opacity:1;fill:#cacaca;fill-opacity:1;stroke:none;stroke-width:2;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:1;stroke-opacity:1\"\n+       d=\"m 19.640491,21.608542 c 0.481192,4.391997 -4.559846,6.992766 -6.439853,7.675092 -3.31028,1.201425 -10.1403284,0.675039 -13.10407386,-0.819812 -0.6788232,-0.49186 5.36634866,-1.494359 5.98233156,-5.017737 0.3786527,-2.165867 1.2795682,-7.586077 6.0251183,-8.244047 3.962098,-0.549344 7.165987,3.024927 7.536477,6.406504 z\"\n+       id=\"path4171\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"sscsss\" />\n+    <path\n+       style=\"fill:#cacaca;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       d=\"m 15.207024,13.937147 c 2.333842,0.386972 4.895586,2.565916 5.385678,4.577888 0.277189,0.943348 2.614657,-1.018254 2.259914,-2.36818 -1.261052,-2.782065 -3.970326,-4.680627 -6.408155,-4.596194 -0.881229,0.01424 -1.949958,2.340991 -1.237437,2.386486 z\"\n+       id=\"path4174\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccc\" />\n+    <path\n+       style=\"display:inline;fill:#cacaca;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       d=\"m 18.434109,9.7592901 c 2.333842,0.3869719 5.2226,2.7647909 5.712692,4.7767629 0.277189,0.943348 8.629506,-7.8462545 8.274763,-9.1961805 C 33.502804,-2.8780764 32,-6e-7 24.510808,-0.4053706 22.126977,-0.2585481 17.721588,9.7137951 18.434109,9.7592901 Z\"\n+       id=\"path4174-3\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccc\" />\n+    <g\n+       style=\"display:inline\"\n+       id=\"g4261-8-5\"\n+       transform=\"translate(0,6)\" />\n+  </g>\n+  <g\n+     style=\"display:none;opacity:0.19599998\"\n+     inkscape:label=\"Layer 3 copy\"\n+     id=\"g4152\"\n+     inkscape:groupmode=\"layer\"\n+     sodipodi:insensitive=\"true\">\n+    <g\n+       transform=\"translate(0,6)\"\n+       id=\"g4160\"\n+       style=\"display:inline\" />\n+    <path\n+       inkscape:connector-curvature=\"0\"\n+       d=\"m 11.219417,15.892144 c -4.2656666,0.924486 -5.8798289,4.76152 -5.7602025,7.676073 0.1290153,3.143304 -3.2492423,5.634064 -5.37088721,6.064991 2.88480171,2.290554 7.10590391,2.632817 10.91981371,1.858174 5.581946,-1.133748 9.38291,-5.486724 8.3665,-10.490964 -0.763458,-3.75884 -3.973912,-6.014478 -8.155224,-5.108274 z\"\n+       id=\"path6\"\n+       sodipodi:nodetypes=\"sscsss\"\n+       style=\"fill:#cacaca\" />\n+    <path\n+       style=\"display:inline;fill:#cacaca;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       d=\"m 15.419679,13.919707 c 2.333842,0.386972 4.895586,2.565916 5.385678,4.577888 0.277189,0.943348 2.614657,-1.018254 2.259914,-2.36818 -1.261052,-2.782065 -3.970326,-4.680627 -6.408155,-4.596194 -0.881229,0.01424 -1.949958,2.340991 -1.237437,2.386486 z\"\n+       id=\"path4174-1\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccc\" />\n+    <path\n+       style=\"display:inline;fill:#cacaca;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       d=\"m 18.646764,9.7418502 c 2.333842,0.3869718 5.2226,2.7647908 5.712692,4.7767628 0.277189,0.943348 8.629506,-7.8462544 8.274763,-9.1961804 1.08124,-8.2179489 -0.421564,-5.33987312 -7.910756,-5.74524312 -2.383831,0.1468225 -6.78922,10.11916572 -6.076699,10.16466072 z\"\n+       id=\"path4174-3-9\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccc\" />\n+  </g>\n+  <g\n+     inkscape:groupmode=\"layer\"\n+     id=\"layer1\"\n+     inkscape:label=\"Layer 3 copy 1\"\n+     style=\"opacity:1\">\n+    <path\n+       style=\"fill:#c8c8c8;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       d=\"m 15.060848,12.783895 16.760457,5.693054 -8.466644,4.544601 -5.129308,8.972618 z\"\n+       id=\"path4147\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccc\" />\n+    <path\n+       style=\"fill:none;fill-rule:evenodd;stroke:#c8c8c8;stroke-width:4.13358974;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\n+       d=\"m 3.5124865,26.978842 c 0,0 -2.4719942,-9.606531 5.8427018,-18.0964696 C 15.684803,2.419355 26.639911,3.9704707 26.639911,3.9704707\"\n+       id=\"path4149\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"csc\" />\n+    <ellipse\n+       style=\"fill:#c8c8c8;fill-opacity:1;stroke:none;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\n+       id=\"path4151\"\n+       cx=\"28.344049\"\n+       cy=\"3.7119639\"\n+       rx=\"3.4082532\"\n+       ry=\"3.6192944\" />\n+    <ellipse\n+       style=\"fill:#c8c8c8;fill-opacity:1;stroke:none;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\n+       id=\"path4151-7\"\n+       cx=\"3.7559054\"\n+       cy=\"27.237371\"\n+       rx=\"3.4082532\"\n+       ry=\"3.6192944\" />\n+    <ellipse\n+       style=\"fill:#c8c8c8;fill-opacity:1;stroke:none;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\n+       id=\"path4151-3\"\n+       cx=\"10.815882\"\n+       cy=\"8.1068087\"\n+       rx=\"3.4082532\"\n+       ry=\"3.6192944\" />\n+  </g>\n+</svg>"}, {"sha": "0d5e8189afb3e5c08d9bac35d96df5f1de3723e8", "filename": "krita/pics/tools/SVG/16/tools-svg-16-icons.qrc", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/96bc05ad99c1f0a404d4b3c4ace66b100260ccfc/krita/pics/tools/SVG/16/tools-svg-16-icons.qrc", "raw_url": "https://github.com/KDE/krita/raw/96bc05ad99c1f0a404d4b3c4ace66b100260ccfc/krita/pics/tools/SVG/16/tools-svg-16-icons.qrc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/pics/tools/SVG/16/tools-svg-16-icons.qrc?ref=96bc05ad99c1f0a404d4b3c4ace66b100260ccfc", "patch": "@@ -65,5 +65,9 @@\n         <file>light_tool_polygonal_selection.svg</file>\n         <file>light_tool_rect_selection.svg</file>\n         <file>light_tool_similar_selection.svg</file>\n+        <file>dark_shape_handling.svg</file>\n+        <file>dark_artistic_text.svg</file>\n+        <file>light_artistic_text.svg</file>\n+        <file>light_shape_handling.svg</file>\n     </qresource>\n </RCC>"}, {"sha": "80fbd89fea23c715a62dc24889f0d3ecc4efee62", "filename": "libs/flake/tools/KoPathToolFactory.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/96bc05ad99c1f0a404d4b3c4ace66b100260ccfc/libs/flake/tools/KoPathToolFactory.cpp", "raw_url": "https://github.com/KDE/krita/raw/96bc05ad99c1f0a404d4b3c4ace66b100260ccfc/libs/flake/tools/KoPathToolFactory.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/flake/tools/KoPathToolFactory.cpp?ref=96bc05ad99c1f0a404d4b3c4ace66b100260ccfc", "patch": "@@ -29,7 +29,7 @@ KoPathToolFactory::KoPathToolFactory()\n {\n     setToolTip(i18n(\"Path editing\"));\n     setToolType(dynamicToolType());\n-    setIconName(koIconNameCStr(\"editpath\"));\n+    setIconName(koIconNameCStr(\"shape_handling\"));\n     setPriority(2);\n     setActivationShapeId(KoPathShapeId);\n }"}, {"sha": "e9213730a34090c558154f448086ac7e67586582", "filename": "plugins/flake/artistictextshape/ArtisticTextToolFactory.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/96bc05ad99c1f0a404d4b3c4ace66b100260ccfc/plugins/flake/artistictextshape/ArtisticTextToolFactory.cpp", "raw_url": "https://github.com/KDE/krita/raw/96bc05ad99c1f0a404d4b3c4ace66b100260ccfc/plugins/flake/artistictextshape/ArtisticTextToolFactory.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/flake/artistictextshape/ArtisticTextToolFactory.cpp?ref=96bc05ad99c1f0a404d4b3c4ace66b100260ccfc", "patch": "@@ -29,7 +29,7 @@ ArtisticTextToolFactory::ArtisticTextToolFactory()\n {\n     setToolTip(i18n(\"Artistic text editing\"));\n     setToolType(dynamicToolType());\n-    setIconName(koIconNameCStr(\"artistictext-tool\"));\n+    setIconName(koIconNameCStr(\"artistic_text\"));\n     setPriority(1);\n     setActivationShapeId(ArtisticTextShapeID);\n }"}]}, {"sha": "709989a86722ff6d12ec8526a4c5062faaeab00d", "stats": {"total": 29, "additions": 15, "deletions": 14}, "files": [{"sha": "7661e3e9d481bb47aaeeabf44a19c654d43f90a6", "filename": "libs/image/kis_paint_device.cc", "status": "modified", "additions": 15, "deletions": 14, "changes": 29, "blob_url": "https://github.com/KDE/krita/blob/709989a86722ff6d12ec8526a4c5062faaeab00d/libs/image/kis_paint_device.cc", "raw_url": "https://github.com/KDE/krita/raw/709989a86722ff6d12ec8526a4c5062faaeab00d/libs/image/kis_paint_device.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_paint_device.cc?ref=709989a86722ff6d12ec8526a4c5062faaeab00d", "patch": "@@ -225,8 +225,15 @@ struct KisPaintDevice::Private\n         DataSP data;\n \n         if (m_frames.isEmpty()) {\n-            data = m_data;\n-            m_data.clear();\n+            /**\n+             * Here we move the contents of the paint device to the\n+             * new frame and clear m_data to make the \"background\" for\n+             * the areas where there is no frame at all.\n+             */\n+            data = toQShared(new Data(m_data.data(), true));\n+            m_data->dataManager()->clear();\n+            m_data->cache()->invalidate();\n+\n         } else if (copy) {\n             DataSP srcData = m_frames[copySrc];\n             data = toQShared(new Data(srcData.data(), true));\n@@ -266,13 +273,6 @@ struct KisPaintDevice::Private\n                                       frame, false,\n                                       parentCommand);\n         cmd->redo();\n-\n-        if (m_frames.isEmpty()) {\n-            // the original m_data will be deleted by shared poiter\n-            // when the command will be destroyed, so just create a\n-            // new one for m_data\n-            m_data = toQShared(new Data(deletedData.data(), false));\n-        }\n     }\n \n     QRect frameBounds(int frameId)\n@@ -344,17 +344,18 @@ struct KisPaintDevice::Private\n     inline DataSP currentFrameData() const {\n         DataSP data;\n \n-        if (contentChannel->keyframeCount() > 1) {\n+        const int numberOfFrames = contentChannel->keyframeCount();\n+\n+        if (numberOfFrames > 1) {\n             int frameId = contentChannel->frameIdAt(defaultBounds->currentTime());\n             KIS_ASSERT_RECOVER(m_frames.contains(frameId)) { return m_frames.begin().value(); }\n             data = m_frames[frameId];\n-        } else {\n+        } else if (numberOfFrames == 1) {\n             data = m_frames.begin().value();\n+        } else {\n+            data = m_data;\n         }\n \n-        // sanity check!\n-        KIS_ASSERT_RECOVER_NOOP(!m_data);\n-\n         return data;\n     }\n "}]}, {"sha": "2df68a5cecb76b1ab7b0a8856ac335adc18b240e", "stats": {"total": 6, "additions": 3, "deletions": 3}, "files": [{"sha": "d710389d4591d4b03a05d8061411ece2a2f98ae3", "filename": "3rdparty/ext_qt/CMakeLists.txt", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/2df68a5cecb76b1ab7b0a8856ac335adc18b240e/3rdparty/ext_qt/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/2df68a5cecb76b1ab7b0a8856ac335adc18b240e/3rdparty/ext_qt/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/3rdparty/ext_qt/CMakeLists.txt?ref=2df68a5cecb76b1ab7b0a8856ac335adc18b240e", "patch": "@@ -5,9 +5,8 @@ ExternalProject_Add(\n     DOWNLOAD_DIR ${EXTERNALS_DOWNLOAD_DIR}\n     URL http://download.qt.io/official_releases/qt/5.6/5.6.0/single/qt-everywhere-opensource-src-5.6.0.zip\n     URL_MD5 03402708f260dcc917abae9bc559c1df\n-    PATCH_COMMAND myptch -p1 -i ${CMAKE_CURRENT_SOURCE_DIR}/disable-wintab.diff\n-          COMMAND myptch -p1 -i ${CMAKE_CURRENT_SOURCE_DIR}/qtgui-private-headers.diff\n-          COMMAND myptch -p1 -i ${CMAKE_CURRENT_SOURCE_DIR}/qt-no-motion-compression.diff\n+    PATCH_COMMAND  ${PATCH_COMMAND} -p1 -i ${CMAKE_CURRENT_SOURCE_DIR}/disable-wintab.diff\n+          COMMAND  ${PATCH_COMMAND} -p1 -i ${CMAKE_CURRENT_SOURCE_DIR}/qtgui-private-headers.diff\n \n     INSTALL_DIR ${EXTPREFIX_qt}\n     CONFIGURE_COMMAND <SOURCE_DIR>/configure.bat -skip qt3d -skip qtactiveqt -skip qtcanvas3d -skip qtconnectivity -skip qtdoc -skip qtenginio -skip qtgraphicaleffects -skip qtlocation -skip qtmultimedia -skip qtsensors -skip qtserialport -skip qtwayland -skip qtwebchannel -skip qtwebengine -skip qtwebsockets -skip qtwebview -skip qtxmlpatterns -no-sql-sqlite -nomake examples -nomake tools -no-compile-examples -no-dbus -no-iconv -no-angle -no-ssl -no-openssl -no-wmf-backend -no-qml-debug -no-libproxy -no-system-proxies -no-nis -no-icu -no-mtdev -opensource -confirm-license -release -opengl desktop -qt-zlib -qt-pcre -qt-libpng -qt-libjpeg -prefix ${EXTPREFIX_qt}\n@@ -47,6 +46,7 @@ else()\n             DOWNLOAD_DIR ${EXTERNALS_DOWNLOAD_DIR}\n             URL http://download.qt.io/official_releases/qt/5.6/5.6.0/single/qt-everywhere-opensource-src-5.6.0.tar.gz\n             URL_MD5 7a2a867bc12384f4161809136d49d4be\n+            PATCH_COMMAND ${PATCH_COMMAND} -p1 -i ${CMAKE_CURRENT_SOURCE_DIR}/qt-no-motion-compression.diff\n             INSTALL_DIR ${EXTPREFIX_qt}\n             CONFIGURE_COMMAND <SOURCE_DIR>/configure -prefix ${EXTPREFIX_qt} -opensource -confirm-license -nomake examples -no-sql-sqlite -no-openssl -no-qml-debug -no-mtdev  -no-journald  -no-syslog -no-nis  -no-cups -no-tslib -no-directfb -no-linuxfb -no-libproxy -no-pch -qt-zlib -qt-pcre -qt-libpng -qt-libjpeg  -qt-harfbuzz -qt-freetype -qt-xcb -qt-xkbcommon-x11 -optimized-qmake -skip qt3d -skip qtactiveqt -skip qtcanvas3d -skip qtconnectivity -skip qtenginio -skip qtgraphicaleffects -skip qtlocation -skip qtmultimedia -skip qtwayland -skip qtwebchannel -skip qtwebengine -skip qtwebsockets -skip qtwebview \n             "}]}, {"sha": "8f455902b05fa89cd53914e7bf077dd046a45b2b", "stats": {"total": 7, "additions": 7, "deletions": 0}, "files": [{"sha": "a777f7965bcb9ccf8582a0af39652b5f5ad1a57f", "filename": "README_PACKAGERS.md", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/KDE/krita/blob/8f455902b05fa89cd53914e7bf077dd046a45b2b/README_PACKAGERS.md", "raw_url": "https://github.com/KDE/krita/raw/8f455902b05fa89cd53914e7bf077dd046a45b2b/README_PACKAGERS.md", "contents_url": "https://api.github.com/repos/KDE/krita/contents/README_PACKAGERS.md?ref=8f455902b05fa89cd53914e7bf077dd046a45b2b", "patch": "@@ -1,5 +1,12 @@\n = Notes for Packagers =\n \n+== Patching Qt ==\n+\n+Qt 5.6 is currently the recommended version to build Krita with on all platforms. However, Qt 5.6 on Linux needs to be patched for https://bugreports.qt.io/browse/QTBUG-44964 .\n+\n+The patch in 3rdparty/ext_qt/qt-no-motion-compression.diff \n+\n+\n == Package Contents ==\n \n We recommend that all of Krita packaged in one package: there is no need to split Krita up. In particular, do not make a separate package out of the plugins directory; without the plugins Krita will not even start."}]}, {"sha": "31195a85a054e50af2d61ae764f341db12190f1e", "stats": {"total": 21, "additions": 21, "deletions": 0}, "files": [{"sha": "8fa3ba383f8cc121d153ce8a072deb884801ab0e", "filename": "3rdparty/ext_qt/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/31195a85a054e50af2d61ae764f341db12190f1e/3rdparty/ext_qt/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/31195a85a054e50af2d61ae764f341db12190f1e/3rdparty/ext_qt/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/3rdparty/ext_qt/CMakeLists.txt?ref=31195a85a054e50af2d61ae764f341db12190f1e", "patch": "@@ -7,6 +7,7 @@ ExternalProject_Add(\n     URL_MD5 03402708f260dcc917abae9bc559c1df\n     PATCH_COMMAND myptch -p1 -i ${CMAKE_CURRENT_SOURCE_DIR}/disable-wintab.diff\n           COMMAND myptch -p1 -i ${CMAKE_CURRENT_SOURCE_DIR}/qtgui-private-headers.diff\n+          COMMAND myptch -p1 -i ${CMAKE_CURRENT_SOURCE_DIR}/qt-no-motion-compression.diff\n \n     INSTALL_DIR ${EXTPREFIX_qt}\n     CONFIGURE_COMMAND <SOURCE_DIR>/configure.bat -skip qt3d -skip qtactiveqt -skip qtcanvas3d -skip qtconnectivity -skip qtdoc -skip qtenginio -skip qtgraphicaleffects -skip qtlocation -skip qtmultimedia -skip qtsensors -skip qtserialport -skip qtwayland -skip qtwebchannel -skip qtwebengine -skip qtwebsockets -skip qtwebview -skip qtxmlpatterns -no-sql-sqlite -nomake examples -nomake tools -no-compile-examples -no-dbus -no-iconv -no-angle -no-ssl -no-openssl -no-wmf-backend -no-qml-debug -no-libproxy -no-system-proxies -no-nis -no-icu -no-mtdev -opensource -confirm-license -release -opengl desktop -qt-zlib -qt-pcre -qt-libpng -qt-libjpeg -prefix ${EXTPREFIX_qt}"}, {"sha": "bac29953b995fb313ef1e12ce0a3381435d3b6ba", "filename": "3rdparty/ext_qt/qt-no-motion-compression.diff", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/KDE/krita/blob/31195a85a054e50af2d61ae764f341db12190f1e/3rdparty/ext_qt/qt-no-motion-compression.diff", "raw_url": "https://github.com/KDE/krita/raw/31195a85a054e50af2d61ae764f341db12190f1e/3rdparty/ext_qt/qt-no-motion-compression.diff", "contents_url": "https://api.github.com/repos/KDE/krita/contents/3rdparty/ext_qt/qt-no-motion-compression.diff?ref=31195a85a054e50af2d61ae764f341db12190f1e", "patch": "@@ -0,0 +1,20 @@\n+diff --git a/qtbase/src/plugins/platforms/xcb/qxcbconnection.cpp b/qtbase/src/plugins/platforms/xcb/qxcbconnection.cpp\n+index 05c0224..8fa9345 100644\n+--- a/qtbase/src/plugins/platforms/xcb/qxcbconnection.cpp\n++++ b/qtbase/src/plugins/platforms/xcb/qxcbconnection.cpp\n+@@ -1687,8 +1687,13 @@ void QXcbConnection::processXcbEvents()\n+             continue;\n+         }\n+ \n+-        if (compressEvent(event, i, eventqueue))\n+-            continue;\n++\n++        /**\n++         * (Krita) Do *NOT* compress any motion events! This is the\n++         * most weird thing one can do for a painting application!\n++         */\n++        // if (compressEvent(event, i, eventqueue))\n++        //     continue;\n+ \n+         bool accepted = false;\n+         if (clipboard()->processIncr())"}]}, {"sha": "5bd8323f83f14d2e1e5db8c770b37558392ad52d", "stats": {"total": 3, "additions": 2, "deletions": 1}, "files": [{"sha": "ff814daa150ab0db22892872b63e5bc1a69fd3c4", "filename": "libs/widgetutils/xmlgui/kshortcutschemeseditor.cpp", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/5bd8323f83f14d2e1e5db8c770b37558392ad52d/libs/widgetutils/xmlgui/kshortcutschemeseditor.cpp", "raw_url": "https://github.com/KDE/krita/raw/5bd8323f83f14d2e1e5db8c770b37558392ad52d/libs/widgetutils/xmlgui/kshortcutschemeseditor.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/xmlgui/kshortcutschemeseditor.cpp?ref=5bd8323f83f14d2e1e5db8c770b37558392ad52d", "patch": "@@ -116,10 +116,11 @@ void KShortcutSchemesEditor::newScheme()\n         return;\n     }\n \n-    const QString newSchemeFileName = KShortcutSchemesHelper::shortcutSchemeFileName(newName);\n+    const QString newSchemeFileName = KShortcutSchemesHelper::shortcutSchemeFileName(newName) + \".shortcuts\";\n \n     QFile schemeFile(newSchemeFileName);\n     if (!schemeFile.open(QFile::WriteOnly | QFile::Truncate)) {\n+        qDebug() << \"Could not open scheme file.\";\n         return;\n     }\n     schemeFile.close();"}]}, {"sha": "db59db4ec4074bde55c1f6db5f81e81ade4bac93", "stats": {"total": 677, "additions": 511, "deletions": 166}, "files": [{"sha": "400f65bfc47daae65f873bc76067dcef387b34c8", "filename": "3rdparty/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/3rdparty/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/3rdparty/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/3rdparty/CMakeLists.txt?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -55,6 +55,7 @@ endif()\n if (MSYS)\n \tset(PATCH_COMMAND patch)\n     set(GLOBAL_PROFILE ${GLOBAL_PROFILE} \n+                           -DCMAKE_TOOLCHAIN_FILE=${MXE_TOOLCHAIN}\n                            -DCMAKE_FIND_PREFIX_PATH=${CMAKE_PREFIX_PATH}\n                            -DCMAKE_SYSTEM_INCLUDE_PATH=${CMAKE_PREFIX_PATH}/include\n                            -DCMAKE_INCLUDE_PATH=${CMAKE_PREFIX_PATH}/include "}, {"sha": "3fa284465c1463535bdda8342c4748531f124e3f", "filename": "KoConfig.h.cmake", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/KoConfig.h.cmake", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/KoConfig.h.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/KoConfig.h.cmake?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -1,6 +1,6 @@\n // Check windows\n #ifdef Q_OS_WIN\n-   #if _WIN64\n+   #ifdef _WIN64\n      #define ENV64BIT\n   #else\n     #define ENV32BIT"}, {"sha": "d14785260fb15601c28c113e0f1689029f28ed51", "filename": "libs/image/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/image/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/image/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/CMakeLists.txt?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -281,6 +281,7 @@ set(kritaimage_LIB_SRCS\n    kis_scalar_keyframe_channel.cpp\n    kis_raster_keyframe_channel.cpp\n    kis_onion_skin_compositor.cpp\n+   kis_onion_skin_cache.cpp\n    kis_idle_watcher.cpp\n \n    kis_psd_layer_style.cpp"}, {"sha": "93663c0144dc1851195d776fdf22e23401cde8ca", "filename": "libs/image/kis_onion_skin_cache.cpp", "status": "added", "additions": 122, "deletions": 0, "changes": 122, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/image/kis_onion_skin_cache.cpp", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/image/kis_onion_skin_cache.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_onion_skin_cache.cpp?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -0,0 +1,122 @@\n+/*\n+ *  Copyright (c) 2016 Dmitry Kazakov <dimula73@gmail.com>\n+ *\n+ *  This program is free software; you can redistribute it and/or modify\n+ *  it under the terms of the GNU General Public License as published by\n+ *  the Free Software Foundation; either version 2 of the License, or\n+ *  (at your option) any later version.\n+ *\n+ *  This program is distributed in the hope that it will be useful,\n+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License\n+ *  along with this program; if not, write to the Free Software\n+ *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.\n+ */\n+\n+#include \"kis_onion_skin_cache.h\"\n+\n+#include <QReadWriteLock>\n+#include <QReadLocker>\n+#include <QWriteLocker>\n+\n+\n+#include \"kis_paint_device.h\"\n+#include \"kis_onion_skin_compositor.h\"\n+#include \"kis_default_bounds.h\"\n+#include \"kis_image.h\"\n+\n+\n+struct KisOnionSkinCache::Private\n+{\n+    KisPaintDeviceSP cachedProjection;\n+\n+    int cacheTime = 0;\n+    int cacheConfigSeqNo = 0;\n+    QReadWriteLock lock;\n+\n+    bool checkCacheValid(KisPaintDeviceSP source, KisOnionSkinCompositor *compositor) {\n+        const int time = source->defaultBounds()->currentTime();\n+        const int seqNo = compositor->configSeqNo();\n+\n+        return time == cacheTime && cacheConfigSeqNo == seqNo;\n+    }\n+\n+    void updateCacheMetrics(KisPaintDeviceSP source, KisOnionSkinCompositor *compositor) {\n+        const int time = source->defaultBounds()->currentTime();\n+        const int seqNo = compositor->configSeqNo();\n+\n+        cacheTime = time;\n+        cacheConfigSeqNo = seqNo;\n+    }\n+};\n+\n+KisOnionSkinCache::KisOnionSkinCache()\n+    : m_d(new Private)\n+{\n+}\n+\n+KisOnionSkinCache::~KisOnionSkinCache()\n+{\n+}\n+\n+KisPaintDeviceSP KisOnionSkinCache::projection(KisPaintDeviceSP source)\n+{\n+    KisOnionSkinCompositor *compositor = KisOnionSkinCompositor::instance();\n+\n+    KisPaintDeviceSP cachedProjection;\n+\n+    QReadLocker readLocker(&m_d->lock);\n+    cachedProjection = m_d->cachedProjection;\n+    if (!cachedProjection || !m_d->checkCacheValid(source, compositor)) {\n+\n+        readLocker.unlock();\n+        QWriteLocker writeLocker(&m_d->lock);\n+        cachedProjection = m_d->cachedProjection;\n+        if (!cachedProjection || !m_d->checkCacheValid(source, compositor)) {\n+\n+            if (!cachedProjection) {\n+                cachedProjection = new KisPaintDevice(source->colorSpace());\n+            } else {\n+                cachedProjection->clear();\n+            }\n+\n+            cachedProjection->setDefaultBounds(new KisDefaultBounds());\n+\n+            const QRect extent = compositor->calculateExtent(source);\n+            compositor->composite(source, cachedProjection, extent);\n+\n+            cachedProjection->setDefaultBounds(source->defaultBounds());\n+\n+            /**\n+             * It might happen that the lod planes has already been\n+             * generated for all the devices, so we should cold-init them\n+             * for the onion skins.\n+             */\n+            const int lod = source->defaultBounds()->currentLevelOfDetail();\n+            if (lod > 0) {\n+                KisPaintDevice::LodDataStruct *data = cachedProjection->createLodDataStruct(lod);\n+                cachedProjection->updateLodDataStruct(data, extent);\n+                cachedProjection->uploadLodDataStruct(data);\n+            }\n+\n+            m_d->updateCacheMetrics(source, compositor);\n+            m_d->cachedProjection = cachedProjection;\n+        }\n+    }\n+\n+    return cachedProjection;\n+}\n+\n+void KisOnionSkinCache::reset()\n+{\n+    QWriteLocker writeLocker(&m_d->lock);\n+    m_d->cachedProjection = 0;\n+}\n+\n+KisPaintDeviceSP KisOnionSkinCache::lodCapableDevice() const\n+{\n+    return m_d->cachedProjection;\n+}"}, {"sha": "1846864c4cd9f310804b86860e23cd499a03de03", "filename": "libs/image/kis_onion_skin_cache.h", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/image/kis_onion_skin_cache.h", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/image/kis_onion_skin_cache.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_onion_skin_cache.h?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -0,0 +1,42 @@\n+/*\n+ *  Copyright (c) 2016 Dmitry Kazakov <dimula73@gmail.com>\n+ *\n+ *  This program is free software; you can redistribute it and/or modify\n+ *  it under the terms of the GNU General Public License as published by\n+ *  the Free Software Foundation; either version 2 of the License, or\n+ *  (at your option) any later version.\n+ *\n+ *  This program is distributed in the hope that it will be useful,\n+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License\n+ *  along with this program; if not, write to the Free Software\n+ *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.\n+ */\n+\n+#ifndef __KIS_ONION_SKIN_CACHE_H\n+#define __KIS_ONION_SKIN_CACHE_H\n+\n+#include <QScopedPointer>\n+#include \"kis_types.h\"\n+\n+\n+class KisOnionSkinCache\n+{\n+public:\n+    KisOnionSkinCache();\n+    ~KisOnionSkinCache();\n+\n+    KisPaintDeviceSP projection(KisPaintDeviceSP source);\n+    void reset();\n+\n+    KisPaintDeviceSP lodCapableDevice() const;\n+\n+private:\n+    struct Private;\n+    const QScopedPointer<Private> m_d;\n+};\n+\n+#endif /* __KIS_ONION_SKIN_CACHE_H */"}, {"sha": "3cd63fa9577abe88b9c133c732cb197a80f5859e", "filename": "libs/image/kis_onion_skin_compositor.cpp", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/image/kis_onion_skin_compositor.cpp", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/image/kis_onion_skin_compositor.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_onion_skin_compositor.cpp?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -30,15 +30,15 @@\n \n Q_GLOBAL_STATIC(KisOnionSkinCompositor, s_instance);\n \n-\n struct KisOnionSkinCompositor::Private\n {\n-    int numberOfSkins;\n-    int tintFactor;\n+    int numberOfSkins = 0;\n+    int tintFactor = 0;\n     QColor backwardTintColor;\n     QColor forwardTintColor;\n     QVector<int> backwardOpacities;\n     QVector<int> forwardOpacities;\n+    int configSeqNo = 0;\n \n     int skinOpacity(int offset)\n     {\n@@ -90,6 +90,8 @@ struct KisOnionSkinCompositor::Private\n             backwardOpacities[i] = scaleFactor * backwardState * config.onionSkinOpacity(-(i + 1));\n             forwardOpacities[i] = scaleFactor * forwardState * config.onionSkinOpacity(i + 1);\n         }\n+\n+        configSeqNo++;\n     }\n };\n \n@@ -107,6 +109,11 @@ KisOnionSkinCompositor::KisOnionSkinCompositor()\n KisOnionSkinCompositor::~KisOnionSkinCompositor()\n {}\n \n+int KisOnionSkinCompositor::configSeqNo() const\n+{\n+    return m_d->configSeqNo;\n+}\n+\n void KisOnionSkinCompositor::composite(const KisPaintDeviceSP sourceDevice, KisPaintDeviceSP targetDevice, const QRect& rect)\n {\n     KisRasterKeyframeChannel *keyframes = sourceDevice->keyframeChannel();"}, {"sha": "e094f07efc0435748e44768d0837ea3de5c31804", "filename": "libs/image/kis_onion_skin_compositor.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/image/kis_onion_skin_compositor.h", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/image/kis_onion_skin_compositor.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_onion_skin_compositor.h?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -36,6 +36,8 @@ class KRITAIMAGE_EXPORT KisOnionSkinCompositor : public QObject\n     QRect calculateFullExtent(const KisPaintDeviceSP device);\n     QRect calculateExtent(const KisPaintDeviceSP device);\n \n+    int configSeqNo() const;\n+\n public Q_SLOTS:\n     void configChanged();\n "}, {"sha": "7d534f384e9d6d08ba8b981562df38413f4c6058", "filename": "libs/image/kis_paint_layer.cc", "status": "modified", "additions": 27, "deletions": 2, "changes": 29, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/image/kis_paint_layer.cc", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/image/kis_paint_layer.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_paint_layer.cc?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -44,6 +44,8 @@\n #include \"kis_signal_auto_connection.h\"\n #include \"kis_layer_properties_icons.h\"\n \n+#include \"kis_onion_skin_cache.h\"\n+\n struct Q_DECL_HIDDEN KisPaintLayer::Private\n {\n public:\n@@ -56,6 +58,7 @@ struct Q_DECL_HIDDEN KisPaintLayer::Private\n     KisRasterKeyframeChannel *contentChannel;\n \n     KisSignalAutoConnectionsStore onionSkinConnection;\n+    KisOnionSkinCache onionSkinCache;\n };\n \n KisPaintLayer::KisPaintLayer(KisImageWSP image, const QString& name, quint8 opacity, KisPaintDeviceSP dev)\n@@ -163,10 +166,20 @@ void KisPaintLayer::copyOriginalToProjection(const KisPaintDeviceSP original,\n         onionSkinEnabled() &&\n         !m_d->paintDevice->defaultBounds()->externalFrameActive()) {\n \n-        KisOnionSkinCompositor *compositor = KisOnionSkinCompositor::instance();\n-        compositor->composite(m_d->paintDevice, projection, rect);\n+        KisPaintDeviceSP skins = m_d->onionSkinCache.projection(m_d->paintDevice);\n+\n+        KisPainter gcDest(projection);\n+        gcDest.setCompositeOp(m_d->paintDevice->colorSpace()->compositeOp(COMPOSITE_BEHIND));\n+        gcDest.bitBlt(rect.topLeft(), skins, rect);\n+        gcDest.end();\n     }\n \n+    if (!m_d->contentChannel ||\n+        (m_d->contentChannel && m_d->contentChannel->keyframeCount() <= 1) ||\n+        !onionSkinEnabled()) {\n+\n+        m_d->onionSkinCache.reset();\n+    }\n     unlockTemporaryTarget();\n }\n \n@@ -326,3 +339,15 @@ void KisPaintLayer::enableAnimation()\n \n     KisLayer::enableAnimation();\n }\n+\n+KisPaintDeviceList KisPaintLayer::getLodCapableDevices() const\n+{\n+    KisPaintDeviceList list = KisLayer::getLodCapableDevices();\n+\n+    KisPaintDeviceSP onionSkinsDevice = m_d->onionSkinCache.lodCapableDevice();\n+    if (onionSkinsDevice) {\n+        list << onionSkinsDevice;\n+    }\n+\n+    return list;\n+}"}, {"sha": "a119cc0b4d9c7b9f3bf884fdb45e9a2d185043e8", "filename": "libs/image/kis_paint_layer.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/image/kis_paint_layer.h", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/image/kis_paint_layer.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_paint_layer.h?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -148,6 +148,8 @@ class KRITAIMAGE_EXPORT KisPaintLayer : public KisLayer, public KisIndirectPaint\n \n     void enableAnimation();\n \n+    KisPaintDeviceList getLodCapableDevices() const;\n+\n public Q_SLOTS:\n     void slotExternalUpdateOnionSkins();\n "}, {"sha": "1312bc7f99ce3759b9218a014d8bb72091f904e2", "filename": "libs/ui/CMakeLists.txt", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/CMakeLists.txt?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -230,7 +230,6 @@ set(kritaui_LIB_SRCS\n     widgets/kis_scratch_pad.cpp\n     widgets/kis_scratch_pad_event_filter.cpp\n     widgets/kis_preset_selector_strip.cpp\n-    widgets/kis_tree_view_popup.cc\n     widgets/kis_slider_spin_box.cpp\n     widgets/kis_size_group.cpp\n     widgets/kis_size_group_p.cpp"}, {"sha": "63a1996b25f148c7fd9d01a228947efa1b12c494", "filename": "libs/ui/KisApplication.cpp", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/KisApplication.cpp", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/KisApplication.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisApplication.cpp?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -434,10 +434,10 @@ bool KisApplication::start(const KisApplicationArguments &args)\n                         return 1;\n                     }\n \n-                    QApplication::setOverrideCursor(Qt::WaitCursor);\n-\n+                    KisDocument *doc = KisPart::instance()->createDocument();\n+                    doc->openUrl(QUrl::fromLocalFile(fileName));\n                     KisImportExportFilter::ConversionStatus status = KisImportExportFilter::OK;\n-                    KisImportExportManager manager(fileName);\n+                    KisImportExportManager manager(doc);\n                     manager.setBatchMode(true);\n                     QByteArray mime(outputMimetype.toLatin1());\n                     status = manager.exportDocument(exportFileName, mime);"}, {"sha": "3ac53f7bdbb16ad07b9ff5658b705161f0c82cb7", "filename": "libs/ui/KisFilterChain.cpp", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/KisFilterChain.cpp", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/KisFilterChain.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisFilterChain.cpp?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -163,10 +163,12 @@ KisDocument* KisFilterChain::inputDocument()\n \n     if ((m_state & Beginning) &&\n             static_cast<KisImportExportManager::Direction>(filterManagerDirection()) == KisImportExportManager::Export &&\n-            filterManagerKisDocument())\n+            filterManagerKisDocument()) {\n         m_inputDocument = filterManagerKisDocument();\n-    else if (!m_inputDocument)\n+    }\n+    else if (!m_inputDocument) {\n         m_inputDocument = KisPart::instance()->createDocument();\n+    }\n \n     m_inputQueried = Document;\n     return m_inputDocument;"}, {"sha": "729d3788d2c41ea053d66814fcd6724678434f40", "filename": "libs/ui/KisView.cpp", "status": "modified", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/KisView.cpp", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/KisView.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisView.cpp?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -329,6 +329,16 @@ void KisView::setViewManager(KisViewManager *view)\n     connect(image(), SIGNAL(sigResolutionChanged(double,double)), this, SLOT(slotImageResolutionChanged()));\n \n     // executed in a context of an image thread\n+    connect(image(), SIGNAL(sigNodeAddedAsync(KisNodeSP)),\n+            SLOT(slotImageNodeAdded(KisNodeSP)),\n+            Qt::DirectConnection);\n+\n+    // executed in a context of the gui thread\n+    connect(this, SIGNAL(sigContinueAddNode(KisNodeSP)),\n+            SLOT(slotContinueAddNode(KisNodeSP)),\n+            Qt::AutoConnection);\n+\n+    // executed in a context of an image thread\n     connect(image(), SIGNAL(sigRemoveNodeAsync(KisNodeSP)),\n             SLOT(slotImageNodeRemoved(KisNodeSP)),\n             Qt::DirectConnection);\n@@ -357,6 +367,29 @@ KisViewManager* KisView::viewManager() const\n     return d->viewManager;\n }\n \n+void KisView::slotImageNodeAdded(KisNodeSP node)\n+{\n+    emit sigContinueAddNode(node);\n+}\n+\n+void KisView::slotContinueAddNode(KisNodeSP newActiveNode)\n+{\n+    /**\n+     * When deleting the last layer, root node got selected. We should\n+     * fix it when the first layer is added back.\n+     *\n+     * Here we basically reimplement what Qt's view/model do. But\n+     * since they are not connected, we should do it manually.\n+     */\n+\n+    if (!d->isCurrent &&\n+        (!d->currentNode || !d->currentNode->parent())) {\n+\n+        d->currentNode = newActiveNode;\n+    }\n+}\n+\n+\n void KisView::slotImageNodeRemoved(KisNodeSP node)\n {\n     emit sigContinueRemoveNode(KritaUtils::nearestNodeAfterRemoval(node));"}, {"sha": "4b0654cd852551fa998e5ea2cc5986d4e28f5516", "filename": "libs/ui/KisView.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/KisView.h", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/KisView.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisView.h?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -220,6 +220,9 @@ public Q_SLOTS:\n     bool queryClose();\n \n private Q_SLOTS:\n+    void slotImageNodeAdded(KisNodeSP node);\n+    void slotContinueAddNode(KisNodeSP newActiveNode);\n+\n     void slotImageNodeRemoved(KisNodeSP node);\n     void slotContinueRemoveNode(KisNodeSP newActiveNode);\n \n@@ -230,6 +233,7 @@ private Q_SLOTS:\n     void sigColorSpaceChanged(const KoColorSpace*  cs);\n     void titleModified(QString,bool);\n \n+    void sigContinueAddNode(KisNodeSP newActiveNode);\n     void sigContinueRemoveNode(KisNodeSP newActiveNode);\n \n protected:"}, {"sha": "ec68d6bc0b9ebc7a237dd2681a5c81d6a3bc8acc", "filename": "libs/ui/canvas/kis_guides_manager.cpp", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/canvas/kis_guides_manager.cpp", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/canvas/kis_guides_manager.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/canvas/kis_guides_manager.cpp?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -483,6 +483,7 @@ bool KisGuidesManager::Private::mouseMoveHandler(const QPointF &docPos, Qt::Keyb\n \n bool KisGuidesManager::Private::mouseReleaseHandler(const QPointF &docPos)\n {\n+    bool result = false;\n     KisCanvas2 *canvas = view->canvasBase();\n     const KisCoordinatesConverter *converter = canvas->coordinatesConverter();\n \n@@ -494,6 +495,14 @@ bool KisGuidesManager::Private::mouseReleaseHandler(const QPointF &docPos)\n         if (!workRect.contains(docPos)) {\n             deleteGuide(currentGuide);\n             q->setGuidesConfigImpl(guidesConfig);\n+\n+            /**\n+             * When we delete a guide, it might happen that we are\n+             * delting the last guide. Therefore we should eat the\n+             * corresponding event so that the event filter would stop\n+             * the filter processing.\n+             */\n+            result = true;\n         }\n \n         currentGuide = invalidGuide;\n@@ -507,7 +516,7 @@ bool KisGuidesManager::Private::mouseReleaseHandler(const QPointF &docPos)\n         updateSnappingStatus(guidesConfig);\n     }\n \n-    return updateCursor(docPos);\n+    return updateCursor(docPos) | result;\n }\n \n QPointF KisGuidesManager::Private::getDocPointFromEvent(QEvent *event)"}, {"sha": "0b19e6391dca7e12215a023d0797264fdc5bc4e8", "filename": "libs/ui/input/kis_input_manager.cpp", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/input/kis_input_manager.cpp", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/input/kis_input_manager.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_input_manager.cpp?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -127,6 +127,7 @@ void KisInputManager::attachPriorityEventFilter(QObject *filter, int priority)\n                       [priority] (const Private::PriorityPair &a) { return a.first > priority; });\n \n     d->priorityEventFilter.insert(it, qMakePair(priority, filter));\n+    d->priorityEventFilterSeqNo++;\n }\n \n void KisInputManager::detachPriorityEventFilter(QObject *filter)\n@@ -187,15 +188,29 @@ bool KisInputManager::eventFilter(QObject* object, QEvent* event)\n \n     if (!d->matcher.hasRunningShortcut()) {\n \n+        int savedPriorityEventFilterSeqNo = d->priorityEventFilterSeqNo;\n+\n         for (auto it = d->priorityEventFilter.begin(); it != d->priorityEventFilter.end(); /*noop*/) {\n             const QPointer<QObject> &filter = it->second;\n \n             if (filter.isNull()) {\n                 it = d->priorityEventFilter.erase(it);\n+\n+                d->priorityEventFilterSeqNo++;\n+                savedPriorityEventFilterSeqNo++;\n                 continue;\n             }\n \n             if (filter->eventFilter(object, event)) return true;\n+\n+            /**\n+             * If the filter removed itself from the filters list or\n+             * added something there, just exit the loop\n+             */\n+            if (d->priorityEventFilterSeqNo != savedPriorityEventFilterSeqNo) {\n+                return true;\n+            }\n+\n             ++it;\n         }\n "}, {"sha": "353cabe4bd3ad88c1ab108b52e5d8339f1eebecc", "filename": "libs/ui/input/kis_input_manager_p.cpp", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/input/kis_input_manager_p.cpp", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/input/kis_input_manager_p.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_input_manager_p.cpp?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -132,6 +132,7 @@ void KisInputManager::Private::maskSyntheticEvents(bool value)\n KisInputManager::Private::Private(KisInputManager *qq)\n     : q(qq)\n     , moveEventCompressor(10 /* ms */, KisSignalCompressor::FIRST_ACTIVE)\n+    , priorityEventFilterSeqNo(0)\n     , canvasSwitcher(this, qq)\n {\n     KisConfig cfg;"}, {"sha": "6f2d1151c8dd77c8e528160760b25e452356255b", "filename": "libs/ui/input/kis_input_manager_p.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/input/kis_input_manager_p.h", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/input/kis_input_manager_p.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_input_manager_p.h?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -75,6 +75,7 @@ class KisInputManager::Private\n     typedef QPair<int, QPointer<QObject> > PriorityPair;\n     typedef QList<PriorityPair> PriorityList;\n     PriorityList priorityEventFilter;\n+    int priorityEventFilterSeqNo;\n \n     void blockMouseEvents();\n     void allowMouseEvents();"}, {"sha": "65e49755fee1c47307d1fd65ed2c29db1d08d2f3", "filename": "libs/ui/input/wintab/kis_tablet_support_win.cpp", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/input/wintab/kis_tablet_support_win.cpp", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/ui/input/wintab/kis_tablet_support_win.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/wintab/kis_tablet_support_win.cpp?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -191,9 +191,9 @@ static void handleTabletEvent(QWidget *windowWidget, const QPointF &local, const\n     // Lock in target window\n     if (type == QEvent::TabletPress) {\n         targetWindow = windowWidget;\n-        dbgTablet << \"Locking target window\" << targetWindow;\n+        dbgInput << \"Locking target window\" << targetWindow;\n     } else if ((type == QEvent::TabletRelease || buttons == Qt::NoButton) && (targetWindow != 0)) {\n-        dbgTablet << \"Releasing target window\" << targetWindow;\n+        dbgInput << \"Releasing target window\" << targetWindow;\n         targetWindow = 0;\n     }\n     if (!windowWidget) // Should never happen\n@@ -857,11 +857,11 @@ void QWindowsTabletSupport::tabletUpdateCursor(const int pkCursor)\n         TCHAR* dvcName = new TCHAR[nameLength + 1];\n         QWindowsTabletSupport::m_winTab32DLL.wTInfo(WTI_DEVICES, DVC_NAME, dvcName);\n         QString qDvcName = QString::fromWCharArray((const wchar_t*)dvcName);\n-        dbgTablet << \"DVC_NAME =\" << qDvcName;\n+        dbgInput << \"DVC_NAME =\" << qDvcName;\n         // Name changed between older and newer Surface Pro 3 drivers\n         if (qDvcName == QString::fromLatin1(\"N-trig DuoSense device\") ||\n             qDvcName == QString::fromLatin1(\"Microsoft device\")) {\n-            dbgTablet << \"This looks like a Surface Pro 3. Enabling eraser workaround.\";\n+            dbgInput << \"This looks like a Surface Pro 3. Enabling eraser workaround.\";\n             isSurfacePro3 = true;\n         }\n         delete[] dvcName;"}, {"sha": "d1fa38aa5d296cb6ff68078244f5915f740ce7b6", "filename": "libs/ui/widgets/kis_tree_view_popup.cc", "status": "removed", "additions": 0, "deletions": 69, "changes": 69, "blob_url": "https://github.com/KDE/krita/blob/26e7607894c68b0a7a9d4069952c0e825fbbd192/libs/ui/widgets/kis_tree_view_popup.cc", "raw_url": "https://github.com/KDE/krita/raw/26e7607894c68b0a7a9d4069952c0e825fbbd192/libs/ui/widgets/kis_tree_view_popup.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/widgets/kis_tree_view_popup.cc?ref=26e7607894c68b0a7a9d4069952c0e825fbbd192", "patch": "@@ -1,69 +0,0 @@\n-/*\n- *  Copyright (c) 2007 Cyrille Berger <cberger@cberger.net>\n- *\n- *  This program is free software; you can redistribute it and/or modify\n- *  it under the terms of the GNU General Public License as published by\n- *  the Free Software Foundation; either version 2 of the License, or\n- *  (at your option) any later version.\n- *\n- *  This program is distributed in the hope that it will be useful,\n- *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n- *  GNU General Public License for more details.\n- *\n- *  You should have received a copy of the GNU General Public License\n- *  along with this program; if not, write to the Free Software\n- *  Foundation, Inc., 51 Franklin Street, Fifth Floor,\n- * Boston, MA 02110-1301, USA.\n- */\n-\n-#include \"kis_tree_view_popup.h\"\n-#include <QHeaderView>\n-#include <QResizeEvent>\n-#include <QTreeView>\n-\n-#include <kis_debug.h>\n-\n-struct KisTreeViewPopup::Private {\n-    QTreeView* view;\n-};\n-\n-\n-KisTreeViewPopup::KisTreeViewPopup(QWidget* parent)\n-    : KisPopupButton(parent)\n-    , d(new Private)\n-{\n-    setObjectName(\"KisTreeViewPopup\");\n-    d->view = new QTreeView;\n-    d->view->header()->hide();\n-    setPopupWidget(d->view);\n-    connect(d->view, SIGNAL(entered(const QModelIndex&)), SLOT(setCurrentIndex(const QModelIndex &)));\n-    connect(d->view, SIGNAL(clicked(const QModelIndex&)), SLOT(setCurrentIndex(const QModelIndex &)));\n-    connect(d->view, SIGNAL(activated(const QModelIndex&)), SLOT(setCurrentIndex(const QModelIndex &)));\n-}\n-\n-KisTreeViewPopup::~KisTreeViewPopup()\n-{\n-    delete d;\n-}\n-\n-void KisTreeViewPopup::setModel(QAbstractItemModel* model)\n-{\n-    d->view->setModel(model);\n-}\n-\n-void KisTreeViewPopup::resizeEvent(QResizeEvent * event)\n-{\n-    setPopupWidgetWidth(event->size().width());\n-}\n-\n-void KisTreeViewPopup::setCurrentIndex(const QModelIndex& idx)\n-{\n-    setText(idx.data(Qt::DisplayRole).toString());\n-    hidePopupWidget();\n-    double v = d->view->blockSignals(true);\n-    d->view->setCurrentIndex(idx);\n-    d->view->blockSignals(v);\n-    emit(currentItemChanged(idx));\n-}\n-"}, {"sha": "e667d1074c55cf07be289c9ff29ccdd523d8b103", "filename": "libs/ui/widgets/kis_tree_view_popup.h", "status": "removed", "additions": 0, "deletions": 56, "changes": 56, "blob_url": "https://github.com/KDE/krita/blob/26e7607894c68b0a7a9d4069952c0e825fbbd192/libs/ui/widgets/kis_tree_view_popup.h", "raw_url": "https://github.com/KDE/krita/raw/26e7607894c68b0a7a9d4069952c0e825fbbd192/libs/ui/widgets/kis_tree_view_popup.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/widgets/kis_tree_view_popup.h?ref=26e7607894c68b0a7a9d4069952c0e825fbbd192", "patch": "@@ -1,56 +0,0 @@\n-/*\n- *  Copyright (c) 2007 Cyrille Berger <cberger@cberger.net>\n- *\n- *  This program is free software; you can redistribute it and/or modify\n- *  it under the terms of the GNU General Public License as published by\n- *  the Free Software Foundation; either version 2 of the License, or\n- *  (at your option) any later version.\n- *\n- *  This program is distributed in the hope that it will be useful,\n- *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n- *  GNU General Public License for more details.\n- *\n- *  You should have received a copy of the GNU General Public License\n- *  along with this program; if not, write to the Free Software\n- *  Foundation, Inc., 51 Franklin Street, Fifth Floor,\n- * Boston, MA 02110-1301, USA.\n- */\n-\n-#ifndef _KIS_TREE_VIEW_POPUP_H_\n-#define _KIS_TREE_VIEW_POPUP_H_\n-\n-#include \"widgets/kis_popup_button.h\"\n-\n-class QAbstractItemModel;\n-class QModelIndex;\n-\n-/**\n- * This class is a workaround some limitation of QComboBox which doesn't\n- * allow to embed a QTreeView\n- * (see http://trolltech.com/developer/task-tracker/index_html?method=entry&id=87744\n- * and http://trolltech.com/developer/task-tracker/index_html?method=entry&id=109685).\n- * Once (if) those bugs are fixed, this class should be removed and should not be\n- * part of Krita's official API.\n- */\n-class KisTreeViewPopup : public KisPopupButton\n-{\n-    Q_OBJECT\n-public:\n-    KisTreeViewPopup(QWidget* parent);\n-    ~KisTreeViewPopup();\n-    void setModel(QAbstractItemModel* model);\n-    void setCurrentFilterId(const QString& id);\n-Q_SIGNALS:\n-    void currentItemChanged(const QModelIndex &);\n-public Q_SLOTS:\n-    void setCurrentIndex(const QModelIndex &);\n-protected:\n-    virtual void resizeEvent(QResizeEvent * event);\n-private:\n-    struct Private;\n-    Private* const d;\n-};\n-\n-\n-#endif"}, {"sha": "37483bf82c91b23d950984fa5e205083a8aee1af", "filename": "libs/widgetutils/xmlgui/kshortcutschemeseditor.cpp", "status": "modified", "additions": 11, "deletions": 13, "changes": 24, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/widgetutils/xmlgui/kshortcutschemeseditor.cpp", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/libs/widgetutils/xmlgui/kshortcutschemeseditor.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/xmlgui/kshortcutschemeseditor.cpp?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -162,15 +162,14 @@ void KShortcutSchemesEditor::exportShortcutsScheme()\n                     i18n(\"Shortcuts (*.shortcuts)\"));\n     dlg.setDefaultSuffix(QStringLiteral(\".shortcuts\"));\n     dlg.setAcceptMode(QFileDialog::AcceptSave);\n-    dlg.exec();\n-    auto path = dlg.selectedFiles().first();\n+    if (dlg.exec()) {\n+        auto path = dlg.selectedFiles().first();\n \n-    // Parent, caption, dir, filter\n-    if (path.isEmpty()) {\n-        return;\n-    }\n+        if (!path.isEmpty()) {\n+            m_dialog->exportConfiguration(path);\n+        }\n \n-    m_dialog->exportConfiguration(path);\n+    }\n }\n \n void KShortcutSchemesEditor::saveCustomShortcuts()\n@@ -182,14 +181,13 @@ void KShortcutSchemesEditor::saveCustomShortcuts()\n                     i18n(\"Shortcuts (*.shortcuts)\"));\n     dlg.setDefaultSuffix(QStringLiteral(\".shortcuts\"));\n     dlg.setAcceptMode(QFileDialog::AcceptSave);\n-    dlg.exec();\n-    auto path = dlg.selectedFiles().first();\n+    if (dlg.exec()) {\n+        auto path = dlg.selectedFiles().first();\n \n-    if (path.isEmpty()) {\n-        return;\n+        if (!path.isEmpty()) {\n+            m_dialog->saveCustomShortcuts(path);\n+        }\n     }\n-\n-    m_dialog->saveCustomShortcuts(path);\n }\n \n "}, {"sha": "06700c53aea327c3e98b855ce35b2a55960a15a1", "filename": "plugins/dockers/animation/timeline_frames_view.cpp", "status": "modified", "additions": 99, "deletions": 2, "changes": 101, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/plugins/dockers/animation/timeline_frames_view.cpp", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/plugins/dockers/animation/timeline_frames_view.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/animation/timeline_frames_view.cpp?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -28,6 +28,7 @@\n \n #include <QPainter>\n \n+#include <QApplication>\n #include <QHeaderView>\n #include <QDropEvent>\n #include <QToolButton>\n@@ -62,6 +63,7 @@ struct TimelineFramesView::Private\n           zoomStillPointIndex(-1),\n           zoomStillPointOriginalOffset(0),\n           dragInProgress(false),\n+          dragWasSuccessful(false),\n           modifiersCatcher(0),\n           selectionChangedCompressor(300, KisSignalCompressor::FIRST_INACTIVE)\n     {}\n@@ -94,6 +96,7 @@ struct TimelineFramesView::Private\n     KisDraggableToolButton *zoomDragButton;\n \n     bool dragInProgress;\n+    bool dragWasSuccessful;\n \n     KisCustomModifiersCatcher *modifiersCatcher;\n     QPoint lastPressedPosition;\n@@ -362,6 +365,51 @@ void TimelineFramesView::currentChanged(const QModelIndex &current, const QModel\n     }\n }\n \n+QItemSelectionModel::SelectionFlags TimelineFramesView::selectionCommand(const QModelIndex &index,\n+                                                                         const QEvent *event) const\n+{\n+    // WARNING: Copy-pasted from KisNodeView! Please keep in sync!\n+\n+    /**\n+     * Qt has a bug: when we Ctrl+click on an item, the item's\n+     * selections gets toggled on mouse *press*, whereas usually it is\n+     * done on mouse *release*.  Therefore the user cannot do a\n+     * Ctrl+D&D with the default configuration. This code fixes the\n+     * problem by manually returning QItemSelectionModel::NoUpdate\n+     * flag when the user clicks on an item and returning\n+     * QItemSelectionModel::Toggle on release.\n+     */\n+\n+    if (event &&\n+        (event->type() == QEvent::MouseButtonPress ||\n+         event->type() == QEvent::MouseButtonRelease) &&\n+        index.isValid()) {\n+\n+        const QMouseEvent *mevent = static_cast<const QMouseEvent*>(event);\n+\n+        if (mevent->button() == Qt::RightButton &&\n+            selectionModel()->selectedIndexes().contains(index)) {\n+\n+            // Allow calling context menu for multiple layers\n+            return QItemSelectionModel::NoUpdate;\n+        }\n+\n+        if (event->type() == QEvent::MouseButtonPress &&\n+            (mevent->modifiers() & Qt::ControlModifier)) {\n+\n+            return QItemSelectionModel::NoUpdate;\n+        }\n+\n+        if (event->type() == QEvent::MouseButtonRelease &&\n+            (mevent->modifiers() & Qt::ControlModifier)) {\n+\n+            return QItemSelectionModel::Toggle;\n+        }\n+    }\n+\n+    return QAbstractItemView::selectionCommand(index, event);\n+}\n+\n void TimelineFramesView::slotSelectionChanged()\n {\n     int minColumn = std::numeric_limits<int>::max();\n@@ -544,10 +592,60 @@ void TimelineFramesView::startDrag(Qt::DropActions supportedActions)\n                 drag->setMimeData(data);\n                 drag->setHotSpot(m_d->lastPressedPosition - rect.topLeft());\n                 drag->exec(supportedActions, Qt::MoveAction);\n+                setCurrentIndex(currentIndex());\n             }\n         }\n     } else {\n+        /**\n+         * Workaround for Qt5's bugs:\n+         *\n+         * 1) Qt doesn't treat selection the selection on D&D\n+         *    correctly, so we save it in advance and restore\n+         *    afterwards.\n+         *\n+         * 2) There is a private variable in QAbstractItemView:\n+         *    QAbstractItemView::Private::currentSelectionStartIndex.\n+         *    It is initialized *only* when the setCurrentIndex() is called\n+         *    explicitly on the view object, not on the selection model.\n+         *    Therefore we should explicitly call setCurrentIndex() after\n+         *    D&D, even if it already has *correct* value!\n+         *\n+         * 2) We should also call selectionModel()->select()\n+         *    explicitly.  There are two reasons for it: 1) Qt doesn't\n+         *    maintain selection over D&D; 2) when reselecting single\n+         *    element after D&D, Qt goes crazy, because it tries to\n+         *    read *global* keyboard modifiers. Therefore if we are\n+         *    dragging with Shift or Ctrl pressed it'll get crazy. So\n+         *    just reset it explicitly.\n+         */\n+\n+        QModelIndexList selectionBefore = selectionModel()->selectedIndexes();\n+        QModelIndex currentBefore = selectionModel()->currentIndex();\n+\n+        // initialize a global status variable\n+        m_d->dragWasSuccessful = false;\n         QAbstractItemView::startDrag(supportedActions);\n+\n+        QModelIndex newCurrent;\n+        QPoint selectionOffset;\n+\n+        if (m_d->dragWasSuccessful) {\n+            newCurrent = currentIndex();\n+            selectionOffset = QPoint(newCurrent.column() - currentBefore.column(),\n+                                     newCurrent.row() - currentBefore.row());\n+        } else {\n+            newCurrent = currentBefore;\n+            selectionOffset = QPoint();\n+        }\n+\n+        setCurrentIndex(newCurrent);\n+        selectionModel()->clearSelection();\n+        Q_FOREACH (const QModelIndex &idx, selectionBefore) {\n+            QModelIndex newIndex =\n+                model()->index(idx.row() + selectionOffset.y(),\n+                               idx.column() + selectionOffset.x());\n+            selectionModel()->select(newIndex, QItemSelectionModel::Select);\n+        }\n     }\n }\n \n@@ -582,7 +680,7 @@ void TimelineFramesView::dropEvent(QDropEvent *event)\n     m_d->model->setScrubState(false);\n \n     QAbstractItemView::dropEvent(event);\n-    setCurrentIndex(currentIndex());\n+    m_d->dragWasSuccessful = event->isAccepted();\n }\n \n void TimelineFramesView::dragLeaveEvent(QDragLeaveEvent *event)\n@@ -591,7 +689,6 @@ void TimelineFramesView::dragLeaveEvent(QDragLeaveEvent *event)\n     m_d->model->setScrubState(false);\n \n     QAbstractItemView::dragLeaveEvent(event);\n-    setCurrentIndex(currentIndex());\n }\n \n void TimelineFramesView::mousePressEvent(QMouseEvent *event)"}, {"sha": "a61f903e4d0327f4b59f0fc93262a23c7ca46dc4", "filename": "plugins/dockers/animation/timeline_frames_view.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/plugins/dockers/animation/timeline_frames_view.h", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/plugins/dockers/animation/timeline_frames_view.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/animation/timeline_frames_view.h?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -79,6 +79,9 @@ private Q_SLOTS:\n     void updateShowInTimeline();\n \n protected:\n+    QItemSelectionModel::SelectionFlags selectionCommand(const QModelIndex &index,\n+                                                         const QEvent *event) const;\n+\n     void currentChanged(const QModelIndex &current, const QModelIndex &previous);\n     void startDrag(Qt::DropActions supportedActions);\n     void dragEnterEvent(QDragEnterEvent *event);"}, {"sha": "6948a29a83360f3b07740c44ccc01fba90ca8a69", "filename": "plugins/dockers/lut/ocio_display_filter.cpp", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/plugins/dockers/lut/ocio_display_filter.cpp", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/plugins/dockers/lut/ocio_display_filter.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/lut/ocio_display_filter.cpp?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -246,6 +246,7 @@ void OcioDisplayFilter::updateShader()\n     if (!m_shaderDirty) return;\n \n     QOpenGLFunctions_3_0 *glFuncs3 = QOpenGLContext::currentContext()->versionFunctions<QOpenGLFunctions_3_0>();\n+    KIS_ASSERT_RECOVER_RETURN(glFuncs3);\n \n     const int lut3DEdgeSize = cfg.ocioLutEdgeSize();\n "}, {"sha": "e7febbc1d9556ba415c4996c29ae4ec759300b91", "filename": "windows/makepkg-32.sh", "status": "added", "additions": 88, "deletions": 0, "changes": 88, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/windows/makepkg-32.sh", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/windows/makepkg-32.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/makepkg-32.sh?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -0,0 +1,88 @@\n+#!/bin/bash\n+\n+# Halt on errors\n+#set -e\n+\n+# Be verbose\n+set -x\n+\n+BUILDROOT=/data2/cross\n+MXEROOT=/data2/cross/mxe/usr/i686-w64-mingw32.shared\n+APP=krita\n+\n+cd $BUILDROOT\n+\n+VER=$(grep \"#define CALLIGRA_VERSION_STRING\" /build/libs/version/calligraversion.h | cut -d '\"' -f 2)\n+cd $BUILDROOT/krita\n+BRANCH=$( git branch | cut -d ' ' -f 2)\n+REVISION=$(git rev-parse --short HEAD)\n+cd ..\n+VERSION=$VER$BRANCH-$REVISION\n+VERSION=\"$(sed s/\\ /-/g <<<$VERSION)\"\n+echo $VERSION\n+\n+PACKAGENAME=$APP\"-\"$VERSION\"-x86\"\n+\n+#rm -rf $BUILDROOT/out/* || true\n+mkdir -p $BUILDROOT/out/$PACKAGENAME\n+mkdir -p $BUILDROOT/out/$PACKAGENAME/bin\n+mkdir -p $BUILDROOT/out/$PACKAGENAME/lib\n+mkdir -p $BUILDROOT/out/$PACKAGENAME/share\n+\n+cp $MXEROOT/bin/krita.exe $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/bin/*.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/bin/*.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/lib/libOpenColorIO.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp -r $MXEROOT/lib/kritaplugins $BUILDROOT/out/$PACKAGENAME/lib\n+\n+cp $MXEROOT/qt5/bin/Qt5Concurrent.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Core.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Gui.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Network.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5OpenGL.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5PrintSupport.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Qml.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Quick.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Script.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5ScriptTools.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Svg.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5SystemInfo.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Widgets.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5WinExtras.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Xml.dll $BUILDROOT/out/$PACKAGENAME/bin\n+\n+cp -r $MXEROOT/qt5/plugins/iconengines $BUILDROOT/out/$PACKAGENAME/bin/\n+cp -r $MXEROOT/qt5/plugins/imageformats $BUILDROOT/out/$PACKAGENAME/bin/\n+cp -r $MXEROOT/qt5/plugins/printsupport $BUILDROOT/out/$PACKAGENAME/bin/\n+cp -r $MXEROOT/qt5/plugins/platforms $BUILDROOT/out/$PACKAGENAME/bin/\n+cp -r $MXEROOT/lib/plugins/imageformats/* $BUILDROOT/out/$PACKAGENAME/bin/imageformats/\n+\n+cp -r $MXEROOT/qt5/translations $BUILDROOT/out/$PACKAGENAME/bin/\n+\n+cp -r $MXEROOT/share/color $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/color-schemes $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/kf5 $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/krita $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/locale $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/mime $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/ocio $BUILDROOT/out/$PACKAGENAME/share\n+\n+rm krita-3.0-l10n-win-current.tar.gz || true\n+rm -rf locale\n+\n+wget http://nonaynever.ru/pub/l10n-win/krita-3.0-l10n-win-current.tar.gz\n+tar -xf krita-3.0-l10n-win-current.tar.gz\n+mkdir $BUILDROOT/out/$PACKAGENAME/bin/data\n+cp -r $BUILDROOT/locale $BUILDROOT/out/$PACKAGENAME/bin/data\n+\n+cd $BUILDROOT/out/\n+\n+zip -r $PACKAGENAME-dbg.zip $PACKAGENAME\n+sha1sum $PACKAGENAME-dbg.zip > $PACKAGENAME-dbg.sha1\n+\n+find $BUILDROOT/out/$PACKAGENAME/bin -name \\*exe | xargs $BUILDROOT/mxe/usr/bin/i686-w64-mingw32.shared-strip\n+find $BUILDROOT/out/$PACKAGENAME/bin -name \\*dll | xargs $BUILDROOT/mxe/usr/bin/i686-w64-mingw32.shared-strip\n+find $BUILDROOT/out/$PACKAGENAME/lib -name \\*dll | xargs $BUILDROOT/mxe/usr/bin/i686-w64-mingw32.shared-strip\n+\n+zip -r $PACKAGENAME.zip $PACKAGENAME\n+sha1sum $PACKAGENAME.zip > $PACKAGENAME.sha1"}, {"sha": "45bf0b54a330a658cca3d86f1897676c9127e341", "filename": "windows/makepkg-64.sh", "status": "renamed", "additions": 17, "deletions": 8, "changes": 25, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/windows/makepkg-64.sh", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/windows/makepkg-64.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/makepkg-64.sh?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -10,10 +10,10 @@ BUILDROOT=/data2/cross\n MXEROOT=/data2/cross/mxe/usr/x86_64-w64-mingw32.shared\n APP=krita\n \n-cd ${BUILDROOT}\n+cd $BUILDROOT\n \n VER=$(grep \"#define CALLIGRA_VERSION_STRING\" /build/libs/version/calligraversion.h | cut -d '\"' -f 2)\n-cd ${BUILDROOT}/krita\n+cd $BUILDROOT/krita\n BRANCH=$( git branch | cut -d ' ' -f 2)\n REVISION=$(git rev-parse --short HEAD)\n cd ..\n@@ -33,7 +33,6 @@ cp $MXEROOT/bin/krita.exe $BUILDROOT/out/$PACKAGENAME/bin\n cp $MXEROOT/bin/*.dll $BUILDROOT/out/$PACKAGENAME/bin\n cp $MXEROOT/bin/*.dll $BUILDROOT/out/$PACKAGENAME/bin\n cp $MXEROOT/lib/libOpenColorIO.dll $BUILDROOT/out/$PACKAGENAME/bin\n-cp -r $MXEROOT/lib/plugins $BUILDROOT/out/$PACKAGENAME/bin\n cp -r $MXEROOT/lib/kritaplugins $BUILDROOT/out/$PACKAGENAME/lib\n \n cp $MXEROOT/qt5/bin/Qt5Concurrent.dll $BUILDROOT/out/$PACKAGENAME/bin\n@@ -52,12 +51,11 @@ cp $MXEROOT/qt5/bin/Qt5Widgets.dll $BUILDROOT/out/$PACKAGENAME/bin\n cp $MXEROOT/qt5/bin/Qt5WinExtras.dll $BUILDROOT/out/$PACKAGENAME/bin\n cp $MXEROOT/qt5/bin/Qt5Xml.dll $BUILDROOT/out/$PACKAGENAME/bin\n \n-x86_64-w64-mingw32.shared-strip $BUILDROOT/out/$PACKAGENAME/bin/*\n-\n-cp -r $MXEROOT/qt5/plugins/iconengines $BUILDROOT/out/$PACKAGENAME/bin/plugins\n-cp -r $MXEROOT/qt5/plugins/imageformats $BUILDROOT/out/$PACKAGENAME/bin/plugins\n-cp -r $MXEROOT/qt5/plugins/printsupport $BUILDROOT/out/$PACKAGENAME/bin/plugins\n+cp -r $MXEROOT/qt5/plugins/iconengines $BUILDROOT/out/$PACKAGENAME/bin/\n+cp -r $MXEROOT/qt5/plugins/imageformats $BUILDROOT/out/$PACKAGENAME/bin/\n+cp -r $MXEROOT/qt5/plugins/printsupport $BUILDROOT/out/$PACKAGENAME/bin/\n cp -r $MXEROOT/qt5/plugins/platforms $BUILDROOT/out/$PACKAGENAME/bin/\n+cp -r $MXEROOT/lib/plugins/imageformats/* $BUILDROOT/out/$PACKAGENAME/bin/imageformats/\n \n cp -r $MXEROOT/qt5/translations $BUILDROOT/out/$PACKAGENAME/bin/\n \n@@ -79,4 +77,15 @@ cp -r $BUILDROOT/locale $BUILDROOT/out/$PACKAGENAME/bin/data\n \n cd $BUILDROOT/out/\n \n+zip -r $PACKAGENAME-dbg.zip $PACKAGENAME\n+sha1sum $PACKAGENAME-dbg.zip > $PACKAGENAME-dbg.sha1\n+\n+exit 0 \n+\n+find $BUILDROOT/out/$PACKAGENAME/bin -name \\*exe | xargs $BUILDROOT/mxe/usr/bin/x86_64-w64-mingw32.shared-strip\n+find $BUILDROOT/out/$PACKAGENAME/bin -name \\*dll | xargs $BUILDROOT/mxe/usr/bin/x86_64-w64-mingw32.shared-strip\n+find $BUILDROOT/out/$PACKAGENAME/lib -name \\*dll | xargs $BUILDROOT/mxe/usr/bin/x86_64-w64-mingw32.shared-strip\n+\n zip -r $PACKAGENAME.zip $PACKAGENAME\n+sha1sum $PACKAGENAME.zip > $PACKAGENAME.sha1\n+", "previous_filename": "windows/makepkg-mxe.sh"}, {"sha": "8ef80d41060ec4135650c895948bfee2be17232f", "filename": "windows/mxe.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/windows/mxe.txt", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/windows/mxe.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/mxe.txt?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -15,7 +15,7 @@ export PATH=$BUILDROOT/mxe/usr/bin:$BUILDROOT/mxe/usr/x86_64-w64-mingw32.shared/\n # Use  i686-w64-mingw32.shared for 32 bits builds\n # note: vc is 1.2, so we either need zagge's branch, or you need to build Vc 0.75\n # yourself. Make sure you use -DBUILD_TESTING=OFF for Vc\n-make MXE_TARGETS=x86_64-w64-mingw32.shared gcc boost curl eigen exiv2 expat fftw fontconfig freetype gettext ilmbase openexr jpeg lcms libpng libraw opencolorio openjpeg qt5 qtscript tiff vc zlib\n+make MXE_TARGETS=x86_64-w64-mingw32.shared gcc boost curl eigen exiv2 expat fftw fontconfig freetype gettext ilmbase openexr jpeg lcms libpng libraw opencolorio openjpeg qt5 qtscript tiff vc zlib gsl\n \n cd $BUILDROOT\n git clone git://anongit.kde.org/krita.git"}, {"sha": "64f80ec9d0e671240c07aaa2cc29cb46f436df90", "filename": "winquirks/unistd.h", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/db59db4ec4074bde55c1f6db5f81e81ade4bac93/winquirks/unistd.h", "raw_url": "https://github.com/KDE/krita/raw/db59db4ec4074bde55c1f6db5f81e81ade4bac93/winquirks/unistd.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/winquirks/unistd.h?ref=db59db4ec4074bde55c1f6db5f81e81ade4bac93", "patch": "@@ -1,5 +1,10 @@\n #ifndef QUIRK_UNISTD_H\n #define QUIRK_UNISTD_H\n+\n+#ifndef _MSC_VER\n+#include <unistd.h>\n+#else\n+\n #pragma message(\"winquirk: no unistd.h!\")\n \n #include <winsock2.h>\n@@ -113,9 +118,11 @@ static int gethostname(char *__name, size_t __len) {\n #define STDERR_FILENO 2\n #endif\n \n+#if defined _MSC_VER\n #if _MSC_VER < 1600\n #define ENOTSUP       ENOSYS\n #endif\n+#endif\n typedef unsigned int gid_t;\n typedef unsigned int uid_t;\n \n@@ -179,3 +186,4 @@ static int sleep(unsigned int sec) {\n }\n \n #endif\n+#endif"}]}, {"sha": "1473024a801946607cbf0393171bd210bb75f392", "stats": {"total": 126, "additions": 0, "deletions": 126}, "files": [{"sha": "1312bc7f99ce3759b9218a014d8bb72091f904e2", "filename": "libs/ui/CMakeLists.txt", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/1473024a801946607cbf0393171bd210bb75f392/libs/ui/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/1473024a801946607cbf0393171bd210bb75f392/libs/ui/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/CMakeLists.txt?ref=1473024a801946607cbf0393171bd210bb75f392", "patch": "@@ -230,7 +230,6 @@ set(kritaui_LIB_SRCS\n     widgets/kis_scratch_pad.cpp\n     widgets/kis_scratch_pad_event_filter.cpp\n     widgets/kis_preset_selector_strip.cpp\n-    widgets/kis_tree_view_popup.cc\n     widgets/kis_slider_spin_box.cpp\n     widgets/kis_size_group.cpp\n     widgets/kis_size_group_p.cpp"}, {"sha": "d1fa38aa5d296cb6ff68078244f5915f740ce7b6", "filename": "libs/ui/widgets/kis_tree_view_popup.cc", "status": "removed", "additions": 0, "deletions": 69, "changes": 69, "blob_url": "https://github.com/KDE/krita/blob/d372f522c76e266b1b2ec33786700c1e3a44d750/libs/ui/widgets/kis_tree_view_popup.cc", "raw_url": "https://github.com/KDE/krita/raw/d372f522c76e266b1b2ec33786700c1e3a44d750/libs/ui/widgets/kis_tree_view_popup.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/widgets/kis_tree_view_popup.cc?ref=d372f522c76e266b1b2ec33786700c1e3a44d750", "patch": "@@ -1,69 +0,0 @@\n-/*\n- *  Copyright (c) 2007 Cyrille Berger <cberger@cberger.net>\n- *\n- *  This program is free software; you can redistribute it and/or modify\n- *  it under the terms of the GNU General Public License as published by\n- *  the Free Software Foundation; either version 2 of the License, or\n- *  (at your option) any later version.\n- *\n- *  This program is distributed in the hope that it will be useful,\n- *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n- *  GNU General Public License for more details.\n- *\n- *  You should have received a copy of the GNU General Public License\n- *  along with this program; if not, write to the Free Software\n- *  Foundation, Inc., 51 Franklin Street, Fifth Floor,\n- * Boston, MA 02110-1301, USA.\n- */\n-\n-#include \"kis_tree_view_popup.h\"\n-#include <QHeaderView>\n-#include <QResizeEvent>\n-#include <QTreeView>\n-\n-#include <kis_debug.h>\n-\n-struct KisTreeViewPopup::Private {\n-    QTreeView* view;\n-};\n-\n-\n-KisTreeViewPopup::KisTreeViewPopup(QWidget* parent)\n-    : KisPopupButton(parent)\n-    , d(new Private)\n-{\n-    setObjectName(\"KisTreeViewPopup\");\n-    d->view = new QTreeView;\n-    d->view->header()->hide();\n-    setPopupWidget(d->view);\n-    connect(d->view, SIGNAL(entered(const QModelIndex&)), SLOT(setCurrentIndex(const QModelIndex &)));\n-    connect(d->view, SIGNAL(clicked(const QModelIndex&)), SLOT(setCurrentIndex(const QModelIndex &)));\n-    connect(d->view, SIGNAL(activated(const QModelIndex&)), SLOT(setCurrentIndex(const QModelIndex &)));\n-}\n-\n-KisTreeViewPopup::~KisTreeViewPopup()\n-{\n-    delete d;\n-}\n-\n-void KisTreeViewPopup::setModel(QAbstractItemModel* model)\n-{\n-    d->view->setModel(model);\n-}\n-\n-void KisTreeViewPopup::resizeEvent(QResizeEvent * event)\n-{\n-    setPopupWidgetWidth(event->size().width());\n-}\n-\n-void KisTreeViewPopup::setCurrentIndex(const QModelIndex& idx)\n-{\n-    setText(idx.data(Qt::DisplayRole).toString());\n-    hidePopupWidget();\n-    double v = d->view->blockSignals(true);\n-    d->view->setCurrentIndex(idx);\n-    d->view->blockSignals(v);\n-    emit(currentItemChanged(idx));\n-}\n-"}, {"sha": "e667d1074c55cf07be289c9ff29ccdd523d8b103", "filename": "libs/ui/widgets/kis_tree_view_popup.h", "status": "removed", "additions": 0, "deletions": 56, "changes": 56, "blob_url": "https://github.com/KDE/krita/blob/d372f522c76e266b1b2ec33786700c1e3a44d750/libs/ui/widgets/kis_tree_view_popup.h", "raw_url": "https://github.com/KDE/krita/raw/d372f522c76e266b1b2ec33786700c1e3a44d750/libs/ui/widgets/kis_tree_view_popup.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/widgets/kis_tree_view_popup.h?ref=d372f522c76e266b1b2ec33786700c1e3a44d750", "patch": "@@ -1,56 +0,0 @@\n-/*\n- *  Copyright (c) 2007 Cyrille Berger <cberger@cberger.net>\n- *\n- *  This program is free software; you can redistribute it and/or modify\n- *  it under the terms of the GNU General Public License as published by\n- *  the Free Software Foundation; either version 2 of the License, or\n- *  (at your option) any later version.\n- *\n- *  This program is distributed in the hope that it will be useful,\n- *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n- *  GNU General Public License for more details.\n- *\n- *  You should have received a copy of the GNU General Public License\n- *  along with this program; if not, write to the Free Software\n- *  Foundation, Inc., 51 Franklin Street, Fifth Floor,\n- * Boston, MA 02110-1301, USA.\n- */\n-\n-#ifndef _KIS_TREE_VIEW_POPUP_H_\n-#define _KIS_TREE_VIEW_POPUP_H_\n-\n-#include \"widgets/kis_popup_button.h\"\n-\n-class QAbstractItemModel;\n-class QModelIndex;\n-\n-/**\n- * This class is a workaround some limitation of QComboBox which doesn't\n- * allow to embed a QTreeView\n- * (see http://trolltech.com/developer/task-tracker/index_html?method=entry&id=87744\n- * and http://trolltech.com/developer/task-tracker/index_html?method=entry&id=109685).\n- * Once (if) those bugs are fixed, this class should be removed and should not be\n- * part of Krita's official API.\n- */\n-class KisTreeViewPopup : public KisPopupButton\n-{\n-    Q_OBJECT\n-public:\n-    KisTreeViewPopup(QWidget* parent);\n-    ~KisTreeViewPopup();\n-    void setModel(QAbstractItemModel* model);\n-    void setCurrentFilterId(const QString& id);\n-Q_SIGNALS:\n-    void currentItemChanged(const QModelIndex &);\n-public Q_SLOTS:\n-    void setCurrentIndex(const QModelIndex &);\n-protected:\n-    virtual void resizeEvent(QResizeEvent * event);\n-private:\n-    struct Private;\n-    Private* const d;\n-};\n-\n-\n-#endif"}]}, {"sha": "d372f522c76e266b1b2ec33786700c1e3a44d750", "stats": {"total": 37, "additions": 37, "deletions": 0}, "files": [{"sha": "729d3788d2c41ea053d66814fcd6724678434f40", "filename": "libs/ui/KisView.cpp", "status": "modified", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/KDE/krita/blob/d372f522c76e266b1b2ec33786700c1e3a44d750/libs/ui/KisView.cpp", "raw_url": "https://github.com/KDE/krita/raw/d372f522c76e266b1b2ec33786700c1e3a44d750/libs/ui/KisView.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisView.cpp?ref=d372f522c76e266b1b2ec33786700c1e3a44d750", "patch": "@@ -329,6 +329,16 @@ void KisView::setViewManager(KisViewManager *view)\n     connect(image(), SIGNAL(sigResolutionChanged(double,double)), this, SLOT(slotImageResolutionChanged()));\n \n     // executed in a context of an image thread\n+    connect(image(), SIGNAL(sigNodeAddedAsync(KisNodeSP)),\n+            SLOT(slotImageNodeAdded(KisNodeSP)),\n+            Qt::DirectConnection);\n+\n+    // executed in a context of the gui thread\n+    connect(this, SIGNAL(sigContinueAddNode(KisNodeSP)),\n+            SLOT(slotContinueAddNode(KisNodeSP)),\n+            Qt::AutoConnection);\n+\n+    // executed in a context of an image thread\n     connect(image(), SIGNAL(sigRemoveNodeAsync(KisNodeSP)),\n             SLOT(slotImageNodeRemoved(KisNodeSP)),\n             Qt::DirectConnection);\n@@ -357,6 +367,29 @@ KisViewManager* KisView::viewManager() const\n     return d->viewManager;\n }\n \n+void KisView::slotImageNodeAdded(KisNodeSP node)\n+{\n+    emit sigContinueAddNode(node);\n+}\n+\n+void KisView::slotContinueAddNode(KisNodeSP newActiveNode)\n+{\n+    /**\n+     * When deleting the last layer, root node got selected. We should\n+     * fix it when the first layer is added back.\n+     *\n+     * Here we basically reimplement what Qt's view/model do. But\n+     * since they are not connected, we should do it manually.\n+     */\n+\n+    if (!d->isCurrent &&\n+        (!d->currentNode || !d->currentNode->parent())) {\n+\n+        d->currentNode = newActiveNode;\n+    }\n+}\n+\n+\n void KisView::slotImageNodeRemoved(KisNodeSP node)\n {\n     emit sigContinueRemoveNode(KritaUtils::nearestNodeAfterRemoval(node));"}, {"sha": "4b0654cd852551fa998e5ea2cc5986d4e28f5516", "filename": "libs/ui/KisView.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/d372f522c76e266b1b2ec33786700c1e3a44d750/libs/ui/KisView.h", "raw_url": "https://github.com/KDE/krita/raw/d372f522c76e266b1b2ec33786700c1e3a44d750/libs/ui/KisView.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisView.h?ref=d372f522c76e266b1b2ec33786700c1e3a44d750", "patch": "@@ -220,6 +220,9 @@ public Q_SLOTS:\n     bool queryClose();\n \n private Q_SLOTS:\n+    void slotImageNodeAdded(KisNodeSP node);\n+    void slotContinueAddNode(KisNodeSP newActiveNode);\n+\n     void slotImageNodeRemoved(KisNodeSP node);\n     void slotContinueRemoveNode(KisNodeSP newActiveNode);\n \n@@ -230,6 +233,7 @@ private Q_SLOTS:\n     void sigColorSpaceChanged(const KoColorSpace*  cs);\n     void titleModified(QString,bool);\n \n+    void sigContinueAddNode(KisNodeSP newActiveNode);\n     void sigContinueRemoveNode(KisNodeSP newActiveNode);\n \n protected:"}]}, {"sha": "6c1a9d9d7ba4a352751eab1b22fa0d7ef82ce36c", "stats": {"total": 8, "additions": 8, "deletions": 0}, "files": [{"sha": "64f80ec9d0e671240c07aaa2cc29cb46f436df90", "filename": "winquirks/unistd.h", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/6c1a9d9d7ba4a352751eab1b22fa0d7ef82ce36c/winquirks/unistd.h", "raw_url": "https://github.com/KDE/krita/raw/6c1a9d9d7ba4a352751eab1b22fa0d7ef82ce36c/winquirks/unistd.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/winquirks/unistd.h?ref=6c1a9d9d7ba4a352751eab1b22fa0d7ef82ce36c", "patch": "@@ -1,5 +1,10 @@\n #ifndef QUIRK_UNISTD_H\n #define QUIRK_UNISTD_H\n+\n+#ifndef _MSC_VER\n+#include <unistd.h>\n+#else\n+\n #pragma message(\"winquirk: no unistd.h!\")\n \n #include <winsock2.h>\n@@ -113,9 +118,11 @@ static int gethostname(char *__name, size_t __len) {\n #define STDERR_FILENO 2\n #endif\n \n+#if defined _MSC_VER\n #if _MSC_VER < 1600\n #define ENOTSUP       ENOSYS\n #endif\n+#endif\n typedef unsigned int gid_t;\n typedef unsigned int uid_t;\n \n@@ -179,3 +186,4 @@ static int sleep(unsigned int sec) {\n }\n \n #endif\n+#endif"}]}, {"sha": "19e4bc2793258f3fd3a9c6f30c86d570d7bc148a", "stats": {"total": 7, "additions": 7, "deletions": 0}, "files": [{"sha": "e7febbc1d9556ba415c4996c29ae4ec759300b91", "filename": "windows/makepkg-32.sh", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/19e4bc2793258f3fd3a9c6f30c86d570d7bc148a/windows/makepkg-32.sh", "raw_url": "https://github.com/KDE/krita/raw/19e4bc2793258f3fd3a9c6f30c86d570d7bc148a/windows/makepkg-32.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/makepkg-32.sh?ref=19e4bc2793258f3fd3a9c6f30c86d570d7bc148a", "patch": "@@ -78,9 +78,11 @@ cp -r $BUILDROOT/locale $BUILDROOT/out/$PACKAGENAME/bin/data\n cd $BUILDROOT/out/\n \n zip -r $PACKAGENAME-dbg.zip $PACKAGENAME\n+sha1sum $PACKAGENAME-dbg.zip > $PACKAGENAME-dbg.sha1\n \n find $BUILDROOT/out/$PACKAGENAME/bin -name \\*exe | xargs $BUILDROOT/mxe/usr/bin/i686-w64-mingw32.shared-strip\n find $BUILDROOT/out/$PACKAGENAME/bin -name \\*dll | xargs $BUILDROOT/mxe/usr/bin/i686-w64-mingw32.shared-strip\n find $BUILDROOT/out/$PACKAGENAME/lib -name \\*dll | xargs $BUILDROOT/mxe/usr/bin/i686-w64-mingw32.shared-strip\n \n zip -r $PACKAGENAME.zip $PACKAGENAME\n+sha1sum $PACKAGENAME.zip > $PACKAGENAME.sha1"}, {"sha": "45bf0b54a330a658cca3d86f1897676c9127e341", "filename": "windows/makepkg-64.sh", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/19e4bc2793258f3fd3a9c6f30c86d570d7bc148a/windows/makepkg-64.sh", "raw_url": "https://github.com/KDE/krita/raw/19e4bc2793258f3fd3a9c6f30c86d570d7bc148a/windows/makepkg-64.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/makepkg-64.sh?ref=19e4bc2793258f3fd3a9c6f30c86d570d7bc148a", "patch": "@@ -78,9 +78,14 @@ cp -r $BUILDROOT/locale $BUILDROOT/out/$PACKAGENAME/bin/data\n cd $BUILDROOT/out/\n \n zip -r $PACKAGENAME-dbg.zip $PACKAGENAME\n+sha1sum $PACKAGENAME-dbg.zip > $PACKAGENAME-dbg.sha1\n+\n+exit 0 \n \n find $BUILDROOT/out/$PACKAGENAME/bin -name \\*exe | xargs $BUILDROOT/mxe/usr/bin/x86_64-w64-mingw32.shared-strip\n find $BUILDROOT/out/$PACKAGENAME/bin -name \\*dll | xargs $BUILDROOT/mxe/usr/bin/x86_64-w64-mingw32.shared-strip\n find $BUILDROOT/out/$PACKAGENAME/lib -name \\*dll | xargs $BUILDROOT/mxe/usr/bin/x86_64-w64-mingw32.shared-strip\n \n zip -r $PACKAGENAME.zip $PACKAGENAME\n+sha1sum $PACKAGENAME.zip > $PACKAGENAME.sha1\n+"}]}, {"sha": "d8d7ef487b1b0034d8dec5430e6ad00250d75a28", "stats": {"total": 103, "additions": 101, "deletions": 2}, "files": [{"sha": "06700c53aea327c3e98b855ce35b2a55960a15a1", "filename": "plugins/dockers/animation/timeline_frames_view.cpp", "status": "modified", "additions": 98, "deletions": 2, "changes": 100, "blob_url": "https://github.com/KDE/krita/blob/d8d7ef487b1b0034d8dec5430e6ad00250d75a28/plugins/dockers/animation/timeline_frames_view.cpp", "raw_url": "https://github.com/KDE/krita/raw/d8d7ef487b1b0034d8dec5430e6ad00250d75a28/plugins/dockers/animation/timeline_frames_view.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/animation/timeline_frames_view.cpp?ref=d8d7ef487b1b0034d8dec5430e6ad00250d75a28", "patch": "@@ -28,6 +28,7 @@\n \n #include <QPainter>\n \n+#include <QApplication>\n #include <QHeaderView>\n #include <QDropEvent>\n #include <QToolButton>\n@@ -62,6 +63,7 @@ struct TimelineFramesView::Private\n           zoomStillPointIndex(-1),\n           zoomStillPointOriginalOffset(0),\n           dragInProgress(false),\n+          dragWasSuccessful(false),\n           modifiersCatcher(0),\n           selectionChangedCompressor(300, KisSignalCompressor::FIRST_INACTIVE)\n     {}\n@@ -94,6 +96,7 @@ struct TimelineFramesView::Private\n     KisDraggableToolButton *zoomDragButton;\n \n     bool dragInProgress;\n+    bool dragWasSuccessful;\n \n     KisCustomModifiersCatcher *modifiersCatcher;\n     QPoint lastPressedPosition;\n@@ -362,6 +365,51 @@ void TimelineFramesView::currentChanged(const QModelIndex &current, const QModel\n     }\n }\n \n+QItemSelectionModel::SelectionFlags TimelineFramesView::selectionCommand(const QModelIndex &index,\n+                                                                         const QEvent *event) const\n+{\n+    // WARNING: Copy-pasted from KisNodeView! Please keep in sync!\n+\n+    /**\n+     * Qt has a bug: when we Ctrl+click on an item, the item's\n+     * selections gets toggled on mouse *press*, whereas usually it is\n+     * done on mouse *release*.  Therefore the user cannot do a\n+     * Ctrl+D&D with the default configuration. This code fixes the\n+     * problem by manually returning QItemSelectionModel::NoUpdate\n+     * flag when the user clicks on an item and returning\n+     * QItemSelectionModel::Toggle on release.\n+     */\n+\n+    if (event &&\n+        (event->type() == QEvent::MouseButtonPress ||\n+         event->type() == QEvent::MouseButtonRelease) &&\n+        index.isValid()) {\n+\n+        const QMouseEvent *mevent = static_cast<const QMouseEvent*>(event);\n+\n+        if (mevent->button() == Qt::RightButton &&\n+            selectionModel()->selectedIndexes().contains(index)) {\n+\n+            // Allow calling context menu for multiple layers\n+            return QItemSelectionModel::NoUpdate;\n+        }\n+\n+        if (event->type() == QEvent::MouseButtonPress &&\n+            (mevent->modifiers() & Qt::ControlModifier)) {\n+\n+            return QItemSelectionModel::NoUpdate;\n+        }\n+\n+        if (event->type() == QEvent::MouseButtonRelease &&\n+            (mevent->modifiers() & Qt::ControlModifier)) {\n+\n+            return QItemSelectionModel::Toggle;\n+        }\n+    }\n+\n+    return QAbstractItemView::selectionCommand(index, event);\n+}\n+\n void TimelineFramesView::slotSelectionChanged()\n {\n     int minColumn = std::numeric_limits<int>::max();\n@@ -548,8 +596,56 @@ void TimelineFramesView::startDrag(Qt::DropActions supportedActions)\n             }\n         }\n     } else {\n+        /**\n+         * Workaround for Qt5's bugs:\n+         *\n+         * 1) Qt doesn't treat selection the selection on D&D\n+         *    correctly, so we save it in advance and restore\n+         *    afterwards.\n+         *\n+         * 2) There is a private variable in QAbstractItemView:\n+         *    QAbstractItemView::Private::currentSelectionStartIndex.\n+         *    It is initialized *only* when the setCurrentIndex() is called\n+         *    explicitly on the view object, not on the selection model.\n+         *    Therefore we should explicitly call setCurrentIndex() after\n+         *    D&D, even if it already has *correct* value!\n+         *\n+         * 2) We should also call selectionModel()->select()\n+         *    explicitly.  There are two reasons for it: 1) Qt doesn't\n+         *    maintain selection over D&D; 2) when reselecting single\n+         *    element after D&D, Qt goes crazy, because it tries to\n+         *    read *global* keyboard modifiers. Therefore if we are\n+         *    dragging with Shift or Ctrl pressed it'll get crazy. So\n+         *    just reset it explicitly.\n+         */\n+\n+        QModelIndexList selectionBefore = selectionModel()->selectedIndexes();\n+        QModelIndex currentBefore = selectionModel()->currentIndex();\n+\n+        // initialize a global status variable\n+        m_d->dragWasSuccessful = false;\n         QAbstractItemView::startDrag(supportedActions);\n-        setCurrentIndex(currentIndex());\n+\n+        QModelIndex newCurrent;\n+        QPoint selectionOffset;\n+\n+        if (m_d->dragWasSuccessful) {\n+            newCurrent = currentIndex();\n+            selectionOffset = QPoint(newCurrent.column() - currentBefore.column(),\n+                                     newCurrent.row() - currentBefore.row());\n+        } else {\n+            newCurrent = currentBefore;\n+            selectionOffset = QPoint();\n+        }\n+\n+        setCurrentIndex(newCurrent);\n+        selectionModel()->clearSelection();\n+        Q_FOREACH (const QModelIndex &idx, selectionBefore) {\n+            QModelIndex newIndex =\n+                model()->index(idx.row() + selectionOffset.y(),\n+                               idx.column() + selectionOffset.x());\n+            selectionModel()->select(newIndex, QItemSelectionModel::Select);\n+        }\n     }\n }\n \n@@ -584,7 +680,7 @@ void TimelineFramesView::dropEvent(QDropEvent *event)\n     m_d->model->setScrubState(false);\n \n     QAbstractItemView::dropEvent(event);\n-    setCurrentIndex(currentIndex());\n+    m_d->dragWasSuccessful = event->isAccepted();\n }\n \n void TimelineFramesView::dragLeaveEvent(QDragLeaveEvent *event)"}, {"sha": "a61f903e4d0327f4b59f0fc93262a23c7ca46dc4", "filename": "plugins/dockers/animation/timeline_frames_view.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/d8d7ef487b1b0034d8dec5430e6ad00250d75a28/plugins/dockers/animation/timeline_frames_view.h", "raw_url": "https://github.com/KDE/krita/raw/d8d7ef487b1b0034d8dec5430e6ad00250d75a28/plugins/dockers/animation/timeline_frames_view.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/animation/timeline_frames_view.h?ref=d8d7ef487b1b0034d8dec5430e6ad00250d75a28", "patch": "@@ -79,6 +79,9 @@ private Q_SLOTS:\n     void updateShowInTimeline();\n \n protected:\n+    QItemSelectionModel::SelectionFlags selectionCommand(const QModelIndex &index,\n+                                                         const QEvent *event) const;\n+\n     void currentChanged(const QModelIndex &current, const QModelIndex &previous);\n     void startDrag(Qt::DropActions supportedActions);\n     void dragEnterEvent(QDragEnterEvent *event);"}]}, {"sha": "d207ffed0c40a59cd243fcaef7e9773fc0d7cad5", "stats": {"total": 3, "additions": 2, "deletions": 1}, "files": [{"sha": "82a633e0ee0374a2a2f77cdb63fa0dc1684f3f7b", "filename": "plugins/dockers/animation/timeline_frames_view.cpp", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/d207ffed0c40a59cd243fcaef7e9773fc0d7cad5/plugins/dockers/animation/timeline_frames_view.cpp", "raw_url": "https://github.com/KDE/krita/raw/d207ffed0c40a59cd243fcaef7e9773fc0d7cad5/plugins/dockers/animation/timeline_frames_view.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/animation/timeline_frames_view.cpp?ref=d207ffed0c40a59cd243fcaef7e9773fc0d7cad5", "patch": "@@ -544,10 +544,12 @@ void TimelineFramesView::startDrag(Qt::DropActions supportedActions)\n                 drag->setMimeData(data);\n                 drag->setHotSpot(m_d->lastPressedPosition - rect.topLeft());\n                 drag->exec(supportedActions, Qt::MoveAction);\n+                setCurrentIndex(currentIndex());\n             }\n         }\n     } else {\n         QAbstractItemView::startDrag(supportedActions);\n+        setCurrentIndex(currentIndex());\n     }\n }\n \n@@ -591,7 +593,6 @@ void TimelineFramesView::dragLeaveEvent(QDragLeaveEvent *event)\n     m_d->model->setScrubState(false);\n \n     QAbstractItemView::dragLeaveEvent(event);\n-    setCurrentIndex(currentIndex());\n }\n \n void TimelineFramesView::mousePressEvent(QMouseEvent *event)"}]}, {"sha": "87a79df65b56d38f8830ad6ec932225189213150", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "3fa284465c1463535bdda8342c4748531f124e3f", "filename": "KoConfig.h.cmake", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/87a79df65b56d38f8830ad6ec932225189213150/KoConfig.h.cmake", "raw_url": "https://github.com/KDE/krita/raw/87a79df65b56d38f8830ad6ec932225189213150/KoConfig.h.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/KoConfig.h.cmake?ref=87a79df65b56d38f8830ad6ec932225189213150", "patch": "@@ -1,6 +1,6 @@\n // Check windows\n #ifdef Q_OS_WIN\n-   #if _WIN64\n+   #ifdef _WIN64\n      #define ENV64BIT\n   #else\n     #define ENV32BIT"}]}, {"sha": "f38b47efda1a68931de07ab76b074f06020d7863", "stats": {"total": 109, "additions": 100, "deletions": 9}, "files": [{"sha": "400f65bfc47daae65f873bc76067dcef387b34c8", "filename": "3rdparty/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/f38b47efda1a68931de07ab76b074f06020d7863/3rdparty/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/f38b47efda1a68931de07ab76b074f06020d7863/3rdparty/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/3rdparty/CMakeLists.txt?ref=f38b47efda1a68931de07ab76b074f06020d7863", "patch": "@@ -55,6 +55,7 @@ endif()\n if (MSYS)\n \tset(PATCH_COMMAND patch)\n     set(GLOBAL_PROFILE ${GLOBAL_PROFILE} \n+                           -DCMAKE_TOOLCHAIN_FILE=${MXE_TOOLCHAIN}\n                            -DCMAKE_FIND_PREFIX_PATH=${CMAKE_PREFIX_PATH}\n                            -DCMAKE_SYSTEM_INCLUDE_PATH=${CMAKE_PREFIX_PATH}/include\n                            -DCMAKE_INCLUDE_PATH=${CMAKE_PREFIX_PATH}/include "}, {"sha": "aae4a478fa65f688ab5f04497c235e42733573bf", "filename": "windows/makepkg-32.sh", "status": "added", "additions": 86, "deletions": 0, "changes": 86, "blob_url": "https://github.com/KDE/krita/blob/f38b47efda1a68931de07ab76b074f06020d7863/windows/makepkg-32.sh", "raw_url": "https://github.com/KDE/krita/raw/f38b47efda1a68931de07ab76b074f06020d7863/windows/makepkg-32.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/makepkg-32.sh?ref=f38b47efda1a68931de07ab76b074f06020d7863", "patch": "@@ -0,0 +1,86 @@\n+#!/bin/bash\n+\n+# Halt on errors\n+#set -e\n+\n+# Be verbose\n+set -x\n+\n+BUILDROOT=/data2/cross\n+MXEROOT=/data2/cross/mxe/usr/i686-w64-mingw32.shared\n+APP=krita\n+\n+cd $BUILDROOT\n+\n+VER=$(grep \"#define CALLIGRA_VERSION_STRING\" /build/libs/version/calligraversion.h | cut -d '\"' -f 2)\n+cd $BUILDROOT/krita\n+BRANCH=$( git branch | cut -d ' ' -f 2)\n+REVISION=$(git rev-parse --short HEAD)\n+cd ..\n+VERSION=$VER$BRANCH-$REVISION\n+VERSION=\"$(sed s/\\ /-/g <<<$VERSION)\"\n+echo $VERSION\n+\n+PACKAGENAME=$APP\"-\"$VERSION\"-x86\"\n+\n+#rm -rf $BUILDROOT/out/* || true\n+mkdir -p $BUILDROOT/out/$PACKAGENAME\n+mkdir -p $BUILDROOT/out/$PACKAGENAME/bin\n+mkdir -p $BUILDROOT/out/$PACKAGENAME/lib\n+mkdir -p $BUILDROOT/out/$PACKAGENAME/share\n+\n+cp $MXEROOT/bin/krita.exe $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/bin/*.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/bin/*.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/lib/libOpenColorIO.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp -r $MXEROOT/lib/kritaplugins $BUILDROOT/out/$PACKAGENAME/lib\n+\n+cp $MXEROOT/qt5/bin/Qt5Concurrent.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Core.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Gui.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Network.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5OpenGL.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5PrintSupport.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Qml.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Quick.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Script.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5ScriptTools.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Svg.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5SystemInfo.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Widgets.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5WinExtras.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Xml.dll $BUILDROOT/out/$PACKAGENAME/bin\n+\n+cp -r $MXEROOT/qt5/plugins/iconengines $BUILDROOT/out/$PACKAGENAME/bin/\n+cp -r $MXEROOT/qt5/plugins/imageformats $BUILDROOT/out/$PACKAGENAME/bin/\n+cp -r $MXEROOT/qt5/plugins/printsupport $BUILDROOT/out/$PACKAGENAME/bin/\n+cp -r $MXEROOT/qt5/plugins/platforms $BUILDROOT/out/$PACKAGENAME/bin/\n+cp -r $MXEROOT/lib/plugins/imageformats/* $BUILDROOT/out/$PACKAGENAME/bin/imageformats/\n+\n+cp -r $MXEROOT/qt5/translations $BUILDROOT/out/$PACKAGENAME/bin/\n+\n+cp -r $MXEROOT/share/color $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/color-schemes $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/kf5 $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/krita $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/locale $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/mime $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/ocio $BUILDROOT/out/$PACKAGENAME/share\n+\n+rm krita-3.0-l10n-win-current.tar.gz || true\n+rm -rf locale\n+\n+wget http://nonaynever.ru/pub/l10n-win/krita-3.0-l10n-win-current.tar.gz\n+tar -xf krita-3.0-l10n-win-current.tar.gz\n+mkdir $BUILDROOT/out/$PACKAGENAME/bin/data\n+cp -r $BUILDROOT/locale $BUILDROOT/out/$PACKAGENAME/bin/data\n+\n+cd $BUILDROOT/out/\n+\n+zip -r $PACKAGENAME-dbg.zip $PACKAGENAME\n+\n+find $BUILDROOT/out/$PACKAGENAME/bin -name \\*exe | xargs $BUILDROOT/mxe/usr/bin/i686-w64-mingw32.shared-strip\n+find $BUILDROOT/out/$PACKAGENAME/bin -name \\*dll | xargs $BUILDROOT/mxe/usr/bin/i686-w64-mingw32.shared-strip\n+find $BUILDROOT/out/$PACKAGENAME/lib -name \\*dll | xargs $BUILDROOT/mxe/usr/bin/i686-w64-mingw32.shared-strip\n+\n+zip -r $PACKAGENAME.zip $PACKAGENAME"}, {"sha": "6034691df333ff62de7c2515c466e43622331e2c", "filename": "windows/makepkg-64.sh", "status": "renamed", "additions": 12, "deletions": 8, "changes": 20, "blob_url": "https://github.com/KDE/krita/blob/f38b47efda1a68931de07ab76b074f06020d7863/windows/makepkg-64.sh", "raw_url": "https://github.com/KDE/krita/raw/f38b47efda1a68931de07ab76b074f06020d7863/windows/makepkg-64.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/makepkg-64.sh?ref=f38b47efda1a68931de07ab76b074f06020d7863", "patch": "@@ -10,10 +10,10 @@ BUILDROOT=/data2/cross\n MXEROOT=/data2/cross/mxe/usr/x86_64-w64-mingw32.shared\n APP=krita\n \n-cd ${BUILDROOT}\n+cd $BUILDROOT\n \n VER=$(grep \"#define CALLIGRA_VERSION_STRING\" /build/libs/version/calligraversion.h | cut -d '\"' -f 2)\n-cd ${BUILDROOT}/krita\n+cd $BUILDROOT/krita\n BRANCH=$( git branch | cut -d ' ' -f 2)\n REVISION=$(git rev-parse --short HEAD)\n cd ..\n@@ -33,7 +33,6 @@ cp $MXEROOT/bin/krita.exe $BUILDROOT/out/$PACKAGENAME/bin\n cp $MXEROOT/bin/*.dll $BUILDROOT/out/$PACKAGENAME/bin\n cp $MXEROOT/bin/*.dll $BUILDROOT/out/$PACKAGENAME/bin\n cp $MXEROOT/lib/libOpenColorIO.dll $BUILDROOT/out/$PACKAGENAME/bin\n-cp -r $MXEROOT/lib/plugins $BUILDROOT/out/$PACKAGENAME/bin\n cp -r $MXEROOT/lib/kritaplugins $BUILDROOT/out/$PACKAGENAME/lib\n \n cp $MXEROOT/qt5/bin/Qt5Concurrent.dll $BUILDROOT/out/$PACKAGENAME/bin\n@@ -52,12 +51,11 @@ cp $MXEROOT/qt5/bin/Qt5Widgets.dll $BUILDROOT/out/$PACKAGENAME/bin\n cp $MXEROOT/qt5/bin/Qt5WinExtras.dll $BUILDROOT/out/$PACKAGENAME/bin\n cp $MXEROOT/qt5/bin/Qt5Xml.dll $BUILDROOT/out/$PACKAGENAME/bin\n \n-x86_64-w64-mingw32.shared-strip $BUILDROOT/out/$PACKAGENAME/bin/*\n-\n-cp -r $MXEROOT/qt5/plugins/iconengines $BUILDROOT/out/$PACKAGENAME/bin/plugins\n-cp -r $MXEROOT/qt5/plugins/imageformats $BUILDROOT/out/$PACKAGENAME/bin/plugins\n-cp -r $MXEROOT/qt5/plugins/printsupport $BUILDROOT/out/$PACKAGENAME/bin/plugins\n+cp -r $MXEROOT/qt5/plugins/iconengines $BUILDROOT/out/$PACKAGENAME/bin/\n+cp -r $MXEROOT/qt5/plugins/imageformats $BUILDROOT/out/$PACKAGENAME/bin/\n+cp -r $MXEROOT/qt5/plugins/printsupport $BUILDROOT/out/$PACKAGENAME/bin/\n cp -r $MXEROOT/qt5/plugins/platforms $BUILDROOT/out/$PACKAGENAME/bin/\n+cp -r $MXEROOT/lib/plugins/imageformats/* $BUILDROOT/out/$PACKAGENAME/bin/imageformats/\n \n cp -r $MXEROOT/qt5/translations $BUILDROOT/out/$PACKAGENAME/bin/\n \n@@ -79,4 +77,10 @@ cp -r $BUILDROOT/locale $BUILDROOT/out/$PACKAGENAME/bin/data\n \n cd $BUILDROOT/out/\n \n+zip -r $PACKAGENAME-dbg.zip $PACKAGENAME\n+\n+find $BUILDROOT/out/$PACKAGENAME/bin -name \\*exe | xargs $BUILDROOT/mxe/usr/bin/x86_64-w64-mingw32.shared-strip\n+find $BUILDROOT/out/$PACKAGENAME/bin -name \\*dll | xargs $BUILDROOT/mxe/usr/bin/x86_64-w64-mingw32.shared-strip\n+find $BUILDROOT/out/$PACKAGENAME/lib -name \\*dll | xargs $BUILDROOT/mxe/usr/bin/x86_64-w64-mingw32.shared-strip\n+\n zip -r $PACKAGENAME.zip $PACKAGENAME", "previous_filename": "windows/makepkg-mxe.sh"}, {"sha": "8ef80d41060ec4135650c895948bfee2be17232f", "filename": "windows/mxe.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/f38b47efda1a68931de07ab76b074f06020d7863/windows/mxe.txt", "raw_url": "https://github.com/KDE/krita/raw/f38b47efda1a68931de07ab76b074f06020d7863/windows/mxe.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/mxe.txt?ref=f38b47efda1a68931de07ab76b074f06020d7863", "patch": "@@ -15,7 +15,7 @@ export PATH=$BUILDROOT/mxe/usr/bin:$BUILDROOT/mxe/usr/x86_64-w64-mingw32.shared/\n # Use  i686-w64-mingw32.shared for 32 bits builds\n # note: vc is 1.2, so we either need zagge's branch, or you need to build Vc 0.75\n # yourself. Make sure you use -DBUILD_TESTING=OFF for Vc\n-make MXE_TARGETS=x86_64-w64-mingw32.shared gcc boost curl eigen exiv2 expat fftw fontconfig freetype gettext ilmbase openexr jpeg lcms libpng libraw opencolorio openjpeg qt5 qtscript tiff vc zlib\n+make MXE_TARGETS=x86_64-w64-mingw32.shared gcc boost curl eigen exiv2 expat fftw fontconfig freetype gettext ilmbase openexr jpeg lcms libpng libraw opencolorio openjpeg qt5 qtscript tiff vc zlib gsl\n \n cd $BUILDROOT\n git clone git://anongit.kde.org/krita.git"}]}, {"sha": "3ad36d024d4c22952ca3b3699c0e3b987a6da07c", "stats": {"total": 211, "additions": 206, "deletions": 5}, "files": [{"sha": "d14785260fb15601c28c113e0f1689029f28ed51", "filename": "libs/image/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/3ad36d024d4c22952ca3b3699c0e3b987a6da07c/libs/image/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/3ad36d024d4c22952ca3b3699c0e3b987a6da07c/libs/image/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/CMakeLists.txt?ref=3ad36d024d4c22952ca3b3699c0e3b987a6da07c", "patch": "@@ -281,6 +281,7 @@ set(kritaimage_LIB_SRCS\n    kis_scalar_keyframe_channel.cpp\n    kis_raster_keyframe_channel.cpp\n    kis_onion_skin_compositor.cpp\n+   kis_onion_skin_cache.cpp\n    kis_idle_watcher.cpp\n \n    kis_psd_layer_style.cpp"}, {"sha": "93663c0144dc1851195d776fdf22e23401cde8ca", "filename": "libs/image/kis_onion_skin_cache.cpp", "status": "added", "additions": 122, "deletions": 0, "changes": 122, "blob_url": "https://github.com/KDE/krita/blob/3ad36d024d4c22952ca3b3699c0e3b987a6da07c/libs/image/kis_onion_skin_cache.cpp", "raw_url": "https://github.com/KDE/krita/raw/3ad36d024d4c22952ca3b3699c0e3b987a6da07c/libs/image/kis_onion_skin_cache.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_onion_skin_cache.cpp?ref=3ad36d024d4c22952ca3b3699c0e3b987a6da07c", "patch": "@@ -0,0 +1,122 @@\n+/*\n+ *  Copyright (c) 2016 Dmitry Kazakov <dimula73@gmail.com>\n+ *\n+ *  This program is free software; you can redistribute it and/or modify\n+ *  it under the terms of the GNU General Public License as published by\n+ *  the Free Software Foundation; either version 2 of the License, or\n+ *  (at your option) any later version.\n+ *\n+ *  This program is distributed in the hope that it will be useful,\n+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License\n+ *  along with this program; if not, write to the Free Software\n+ *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.\n+ */\n+\n+#include \"kis_onion_skin_cache.h\"\n+\n+#include <QReadWriteLock>\n+#include <QReadLocker>\n+#include <QWriteLocker>\n+\n+\n+#include \"kis_paint_device.h\"\n+#include \"kis_onion_skin_compositor.h\"\n+#include \"kis_default_bounds.h\"\n+#include \"kis_image.h\"\n+\n+\n+struct KisOnionSkinCache::Private\n+{\n+    KisPaintDeviceSP cachedProjection;\n+\n+    int cacheTime = 0;\n+    int cacheConfigSeqNo = 0;\n+    QReadWriteLock lock;\n+\n+    bool checkCacheValid(KisPaintDeviceSP source, KisOnionSkinCompositor *compositor) {\n+        const int time = source->defaultBounds()->currentTime();\n+        const int seqNo = compositor->configSeqNo();\n+\n+        return time == cacheTime && cacheConfigSeqNo == seqNo;\n+    }\n+\n+    void updateCacheMetrics(KisPaintDeviceSP source, KisOnionSkinCompositor *compositor) {\n+        const int time = source->defaultBounds()->currentTime();\n+        const int seqNo = compositor->configSeqNo();\n+\n+        cacheTime = time;\n+        cacheConfigSeqNo = seqNo;\n+    }\n+};\n+\n+KisOnionSkinCache::KisOnionSkinCache()\n+    : m_d(new Private)\n+{\n+}\n+\n+KisOnionSkinCache::~KisOnionSkinCache()\n+{\n+}\n+\n+KisPaintDeviceSP KisOnionSkinCache::projection(KisPaintDeviceSP source)\n+{\n+    KisOnionSkinCompositor *compositor = KisOnionSkinCompositor::instance();\n+\n+    KisPaintDeviceSP cachedProjection;\n+\n+    QReadLocker readLocker(&m_d->lock);\n+    cachedProjection = m_d->cachedProjection;\n+    if (!cachedProjection || !m_d->checkCacheValid(source, compositor)) {\n+\n+        readLocker.unlock();\n+        QWriteLocker writeLocker(&m_d->lock);\n+        cachedProjection = m_d->cachedProjection;\n+        if (!cachedProjection || !m_d->checkCacheValid(source, compositor)) {\n+\n+            if (!cachedProjection) {\n+                cachedProjection = new KisPaintDevice(source->colorSpace());\n+            } else {\n+                cachedProjection->clear();\n+            }\n+\n+            cachedProjection->setDefaultBounds(new KisDefaultBounds());\n+\n+            const QRect extent = compositor->calculateExtent(source);\n+            compositor->composite(source, cachedProjection, extent);\n+\n+            cachedProjection->setDefaultBounds(source->defaultBounds());\n+\n+            /**\n+             * It might happen that the lod planes has already been\n+             * generated for all the devices, so we should cold-init them\n+             * for the onion skins.\n+             */\n+            const int lod = source->defaultBounds()->currentLevelOfDetail();\n+            if (lod > 0) {\n+                KisPaintDevice::LodDataStruct *data = cachedProjection->createLodDataStruct(lod);\n+                cachedProjection->updateLodDataStruct(data, extent);\n+                cachedProjection->uploadLodDataStruct(data);\n+            }\n+\n+            m_d->updateCacheMetrics(source, compositor);\n+            m_d->cachedProjection = cachedProjection;\n+        }\n+    }\n+\n+    return cachedProjection;\n+}\n+\n+void KisOnionSkinCache::reset()\n+{\n+    QWriteLocker writeLocker(&m_d->lock);\n+    m_d->cachedProjection = 0;\n+}\n+\n+KisPaintDeviceSP KisOnionSkinCache::lodCapableDevice() const\n+{\n+    return m_d->cachedProjection;\n+}"}, {"sha": "1846864c4cd9f310804b86860e23cd499a03de03", "filename": "libs/image/kis_onion_skin_cache.h", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/KDE/krita/blob/3ad36d024d4c22952ca3b3699c0e3b987a6da07c/libs/image/kis_onion_skin_cache.h", "raw_url": "https://github.com/KDE/krita/raw/3ad36d024d4c22952ca3b3699c0e3b987a6da07c/libs/image/kis_onion_skin_cache.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_onion_skin_cache.h?ref=3ad36d024d4c22952ca3b3699c0e3b987a6da07c", "patch": "@@ -0,0 +1,42 @@\n+/*\n+ *  Copyright (c) 2016 Dmitry Kazakov <dimula73@gmail.com>\n+ *\n+ *  This program is free software; you can redistribute it and/or modify\n+ *  it under the terms of the GNU General Public License as published by\n+ *  the Free Software Foundation; either version 2 of the License, or\n+ *  (at your option) any later version.\n+ *\n+ *  This program is distributed in the hope that it will be useful,\n+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License\n+ *  along with this program; if not, write to the Free Software\n+ *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.\n+ */\n+\n+#ifndef __KIS_ONION_SKIN_CACHE_H\n+#define __KIS_ONION_SKIN_CACHE_H\n+\n+#include <QScopedPointer>\n+#include \"kis_types.h\"\n+\n+\n+class KisOnionSkinCache\n+{\n+public:\n+    KisOnionSkinCache();\n+    ~KisOnionSkinCache();\n+\n+    KisPaintDeviceSP projection(KisPaintDeviceSP source);\n+    void reset();\n+\n+    KisPaintDeviceSP lodCapableDevice() const;\n+\n+private:\n+    struct Private;\n+    const QScopedPointer<Private> m_d;\n+};\n+\n+#endif /* __KIS_ONION_SKIN_CACHE_H */"}, {"sha": "3cd63fa9577abe88b9c133c732cb197a80f5859e", "filename": "libs/image/kis_onion_skin_compositor.cpp", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/KDE/krita/blob/3ad36d024d4c22952ca3b3699c0e3b987a6da07c/libs/image/kis_onion_skin_compositor.cpp", "raw_url": "https://github.com/KDE/krita/raw/3ad36d024d4c22952ca3b3699c0e3b987a6da07c/libs/image/kis_onion_skin_compositor.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_onion_skin_compositor.cpp?ref=3ad36d024d4c22952ca3b3699c0e3b987a6da07c", "patch": "@@ -30,15 +30,15 @@\n \n Q_GLOBAL_STATIC(KisOnionSkinCompositor, s_instance);\n \n-\n struct KisOnionSkinCompositor::Private\n {\n-    int numberOfSkins;\n-    int tintFactor;\n+    int numberOfSkins = 0;\n+    int tintFactor = 0;\n     QColor backwardTintColor;\n     QColor forwardTintColor;\n     QVector<int> backwardOpacities;\n     QVector<int> forwardOpacities;\n+    int configSeqNo = 0;\n \n     int skinOpacity(int offset)\n     {\n@@ -90,6 +90,8 @@ struct KisOnionSkinCompositor::Private\n             backwardOpacities[i] = scaleFactor * backwardState * config.onionSkinOpacity(-(i + 1));\n             forwardOpacities[i] = scaleFactor * forwardState * config.onionSkinOpacity(i + 1);\n         }\n+\n+        configSeqNo++;\n     }\n };\n \n@@ -107,6 +109,11 @@ KisOnionSkinCompositor::KisOnionSkinCompositor()\n KisOnionSkinCompositor::~KisOnionSkinCompositor()\n {}\n \n+int KisOnionSkinCompositor::configSeqNo() const\n+{\n+    return m_d->configSeqNo;\n+}\n+\n void KisOnionSkinCompositor::composite(const KisPaintDeviceSP sourceDevice, KisPaintDeviceSP targetDevice, const QRect& rect)\n {\n     KisRasterKeyframeChannel *keyframes = sourceDevice->keyframeChannel();"}, {"sha": "e094f07efc0435748e44768d0837ea3de5c31804", "filename": "libs/image/kis_onion_skin_compositor.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/3ad36d024d4c22952ca3b3699c0e3b987a6da07c/libs/image/kis_onion_skin_compositor.h", "raw_url": "https://github.com/KDE/krita/raw/3ad36d024d4c22952ca3b3699c0e3b987a6da07c/libs/image/kis_onion_skin_compositor.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_onion_skin_compositor.h?ref=3ad36d024d4c22952ca3b3699c0e3b987a6da07c", "patch": "@@ -36,6 +36,8 @@ class KRITAIMAGE_EXPORT KisOnionSkinCompositor : public QObject\n     QRect calculateFullExtent(const KisPaintDeviceSP device);\n     QRect calculateExtent(const KisPaintDeviceSP device);\n \n+    int configSeqNo() const;\n+\n public Q_SLOTS:\n     void configChanged();\n "}, {"sha": "7d534f384e9d6d08ba8b981562df38413f4c6058", "filename": "libs/image/kis_paint_layer.cc", "status": "modified", "additions": 27, "deletions": 2, "changes": 29, "blob_url": "https://github.com/KDE/krita/blob/3ad36d024d4c22952ca3b3699c0e3b987a6da07c/libs/image/kis_paint_layer.cc", "raw_url": "https://github.com/KDE/krita/raw/3ad36d024d4c22952ca3b3699c0e3b987a6da07c/libs/image/kis_paint_layer.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_paint_layer.cc?ref=3ad36d024d4c22952ca3b3699c0e3b987a6da07c", "patch": "@@ -44,6 +44,8 @@\n #include \"kis_signal_auto_connection.h\"\n #include \"kis_layer_properties_icons.h\"\n \n+#include \"kis_onion_skin_cache.h\"\n+\n struct Q_DECL_HIDDEN KisPaintLayer::Private\n {\n public:\n@@ -56,6 +58,7 @@ struct Q_DECL_HIDDEN KisPaintLayer::Private\n     KisRasterKeyframeChannel *contentChannel;\n \n     KisSignalAutoConnectionsStore onionSkinConnection;\n+    KisOnionSkinCache onionSkinCache;\n };\n \n KisPaintLayer::KisPaintLayer(KisImageWSP image, const QString& name, quint8 opacity, KisPaintDeviceSP dev)\n@@ -163,10 +166,20 @@ void KisPaintLayer::copyOriginalToProjection(const KisPaintDeviceSP original,\n         onionSkinEnabled() &&\n         !m_d->paintDevice->defaultBounds()->externalFrameActive()) {\n \n-        KisOnionSkinCompositor *compositor = KisOnionSkinCompositor::instance();\n-        compositor->composite(m_d->paintDevice, projection, rect);\n+        KisPaintDeviceSP skins = m_d->onionSkinCache.projection(m_d->paintDevice);\n+\n+        KisPainter gcDest(projection);\n+        gcDest.setCompositeOp(m_d->paintDevice->colorSpace()->compositeOp(COMPOSITE_BEHIND));\n+        gcDest.bitBlt(rect.topLeft(), skins, rect);\n+        gcDest.end();\n     }\n \n+    if (!m_d->contentChannel ||\n+        (m_d->contentChannel && m_d->contentChannel->keyframeCount() <= 1) ||\n+        !onionSkinEnabled()) {\n+\n+        m_d->onionSkinCache.reset();\n+    }\n     unlockTemporaryTarget();\n }\n \n@@ -326,3 +339,15 @@ void KisPaintLayer::enableAnimation()\n \n     KisLayer::enableAnimation();\n }\n+\n+KisPaintDeviceList KisPaintLayer::getLodCapableDevices() const\n+{\n+    KisPaintDeviceList list = KisLayer::getLodCapableDevices();\n+\n+    KisPaintDeviceSP onionSkinsDevice = m_d->onionSkinCache.lodCapableDevice();\n+    if (onionSkinsDevice) {\n+        list << onionSkinsDevice;\n+    }\n+\n+    return list;\n+}"}, {"sha": "a119cc0b4d9c7b9f3bf884fdb45e9a2d185043e8", "filename": "libs/image/kis_paint_layer.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/3ad36d024d4c22952ca3b3699c0e3b987a6da07c/libs/image/kis_paint_layer.h", "raw_url": "https://github.com/KDE/krita/raw/3ad36d024d4c22952ca3b3699c0e3b987a6da07c/libs/image/kis_paint_layer.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_paint_layer.h?ref=3ad36d024d4c22952ca3b3699c0e3b987a6da07c", "patch": "@@ -148,6 +148,8 @@ class KRITAIMAGE_EXPORT KisPaintLayer : public KisLayer, public KisIndirectPaint\n \n     void enableAnimation();\n \n+    KisPaintDeviceList getLodCapableDevices() const;\n+\n public Q_SLOTS:\n     void slotExternalUpdateOnionSkins();\n "}]}, {"sha": "bf2f2092b648b15f9ffccb0fc7cb68a8900a5d80", "stats": {"total": 24, "additions": 11, "deletions": 13}, "files": [{"sha": "37483bf82c91b23d950984fa5e205083a8aee1af", "filename": "libs/widgetutils/xmlgui/kshortcutschemeseditor.cpp", "status": "modified", "additions": 11, "deletions": 13, "changes": 24, "blob_url": "https://github.com/KDE/krita/blob/bf2f2092b648b15f9ffccb0fc7cb68a8900a5d80/libs/widgetutils/xmlgui/kshortcutschemeseditor.cpp", "raw_url": "https://github.com/KDE/krita/raw/bf2f2092b648b15f9ffccb0fc7cb68a8900a5d80/libs/widgetutils/xmlgui/kshortcutschemeseditor.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/xmlgui/kshortcutschemeseditor.cpp?ref=bf2f2092b648b15f9ffccb0fc7cb68a8900a5d80", "patch": "@@ -162,15 +162,14 @@ void KShortcutSchemesEditor::exportShortcutsScheme()\n                     i18n(\"Shortcuts (*.shortcuts)\"));\n     dlg.setDefaultSuffix(QStringLiteral(\".shortcuts\"));\n     dlg.setAcceptMode(QFileDialog::AcceptSave);\n-    dlg.exec();\n-    auto path = dlg.selectedFiles().first();\n+    if (dlg.exec()) {\n+        auto path = dlg.selectedFiles().first();\n \n-    // Parent, caption, dir, filter\n-    if (path.isEmpty()) {\n-        return;\n-    }\n+        if (!path.isEmpty()) {\n+            m_dialog->exportConfiguration(path);\n+        }\n \n-    m_dialog->exportConfiguration(path);\n+    }\n }\n \n void KShortcutSchemesEditor::saveCustomShortcuts()\n@@ -182,14 +181,13 @@ void KShortcutSchemesEditor::saveCustomShortcuts()\n                     i18n(\"Shortcuts (*.shortcuts)\"));\n     dlg.setDefaultSuffix(QStringLiteral(\".shortcuts\"));\n     dlg.setAcceptMode(QFileDialog::AcceptSave);\n-    dlg.exec();\n-    auto path = dlg.selectedFiles().first();\n+    if (dlg.exec()) {\n+        auto path = dlg.selectedFiles().first();\n \n-    if (path.isEmpty()) {\n-        return;\n+        if (!path.isEmpty()) {\n+            m_dialog->saveCustomShortcuts(path);\n+        }\n     }\n-\n-    m_dialog->saveCustomShortcuts(path);\n }\n \n "}]}, {"sha": "2f5372c9a63237fcfe6fb31be1a6245af752324c", "stats": {"total": 28, "additions": 27, "deletions": 1}, "files": [{"sha": "ec68d6bc0b9ebc7a237dd2681a5c81d6a3bc8acc", "filename": "libs/ui/canvas/kis_guides_manager.cpp", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/2f5372c9a63237fcfe6fb31be1a6245af752324c/libs/ui/canvas/kis_guides_manager.cpp", "raw_url": "https://github.com/KDE/krita/raw/2f5372c9a63237fcfe6fb31be1a6245af752324c/libs/ui/canvas/kis_guides_manager.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/canvas/kis_guides_manager.cpp?ref=2f5372c9a63237fcfe6fb31be1a6245af752324c", "patch": "@@ -483,6 +483,7 @@ bool KisGuidesManager::Private::mouseMoveHandler(const QPointF &docPos, Qt::Keyb\n \n bool KisGuidesManager::Private::mouseReleaseHandler(const QPointF &docPos)\n {\n+    bool result = false;\n     KisCanvas2 *canvas = view->canvasBase();\n     const KisCoordinatesConverter *converter = canvas->coordinatesConverter();\n \n@@ -494,6 +495,14 @@ bool KisGuidesManager::Private::mouseReleaseHandler(const QPointF &docPos)\n         if (!workRect.contains(docPos)) {\n             deleteGuide(currentGuide);\n             q->setGuidesConfigImpl(guidesConfig);\n+\n+            /**\n+             * When we delete a guide, it might happen that we are\n+             * delting the last guide. Therefore we should eat the\n+             * corresponding event so that the event filter would stop\n+             * the filter processing.\n+             */\n+            result = true;\n         }\n \n         currentGuide = invalidGuide;\n@@ -507,7 +516,7 @@ bool KisGuidesManager::Private::mouseReleaseHandler(const QPointF &docPos)\n         updateSnappingStatus(guidesConfig);\n     }\n \n-    return updateCursor(docPos);\n+    return updateCursor(docPos) | result;\n }\n \n QPointF KisGuidesManager::Private::getDocPointFromEvent(QEvent *event)"}, {"sha": "4ab17cd0ae41e08a7a598167407884f8cbc46887", "filename": "libs/ui/input/kis_input_manager.cpp", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/KDE/krita/blob/2f5372c9a63237fcfe6fb31be1a6245af752324c/libs/ui/input/kis_input_manager.cpp", "raw_url": "https://github.com/KDE/krita/raw/2f5372c9a63237fcfe6fb31be1a6245af752324c/libs/ui/input/kis_input_manager.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_input_manager.cpp?ref=2f5372c9a63237fcfe6fb31be1a6245af752324c", "patch": "@@ -127,6 +127,7 @@ void KisInputManager::attachPriorityEventFilter(QObject *filter, int priority)\n                       [priority] (const Private::PriorityPair &a) { return a.first > priority; });\n \n     d->priorityEventFilter.insert(it, qMakePair(priority, filter));\n+    d->priorityEventFilterSeqNo++;\n }\n \n void KisInputManager::detachPriorityEventFilter(QObject *filter)\n@@ -187,15 +188,29 @@ bool KisInputManager::eventFilter(QObject* object, QEvent* event)\n \n     if (!d->matcher.hasRunningShortcut()) {\n \n+        int savedPriorityEventFilterSeqNo = d->priorityEventFilterSeqNo;\n+\n         for (auto it = d->priorityEventFilter.begin(); it != d->priorityEventFilter.end(); /*noop*/) {\n             const QPointer<QObject> &filter = it->second;\n \n             if (filter.isNull()) {\n                 it = d->priorityEventFilter.erase(it);\n+\n+                d->priorityEventFilterSeqNo++;\n+                savedPriorityEventFilterSeqNo++;\n                 continue;\n             }\n \n             if (filter->eventFilter(object, event)) return true;\n+\n+            /**\n+             * If the filter removed itself from the filters list or\n+             * added something there, just exit the loop\n+             */\n+            if (d->priorityEventFilterSeqNo != savedPriorityEventFilterSeqNo) {\n+                return true;\n+            }\n+\n             ++it;\n         }\n "}, {"sha": "f89a7ecf6aeabe02d878d2fffdfe9dc11af52adc", "filename": "libs/ui/input/kis_input_manager_p.cpp", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/2f5372c9a63237fcfe6fb31be1a6245af752324c/libs/ui/input/kis_input_manager_p.cpp", "raw_url": "https://github.com/KDE/krita/raw/2f5372c9a63237fcfe6fb31be1a6245af752324c/libs/ui/input/kis_input_manager_p.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_input_manager_p.cpp?ref=2f5372c9a63237fcfe6fb31be1a6245af752324c", "patch": "@@ -132,6 +132,7 @@ void KisInputManager::Private::maskSyntheticEvents(bool value)\n KisInputManager::Private::Private(KisInputManager *qq)\n     : q(qq)\n     , moveEventCompressor(10 /* ms */, KisSignalCompressor::FIRST_ACTIVE)\n+    , priorityEventFilterSeqNo(0)\n     , canvasSwitcher(this, qq)\n {\n     KisConfig cfg;"}, {"sha": "75e99d7b9e0520828f6d2a4f8c95aba987353d21", "filename": "libs/ui/input/kis_input_manager_p.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/2f5372c9a63237fcfe6fb31be1a6245af752324c/libs/ui/input/kis_input_manager_p.h", "raw_url": "https://github.com/KDE/krita/raw/2f5372c9a63237fcfe6fb31be1a6245af752324c/libs/ui/input/kis_input_manager_p.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_input_manager_p.h?ref=2f5372c9a63237fcfe6fb31be1a6245af752324c", "patch": "@@ -75,6 +75,7 @@ class KisInputManager::Private\n     typedef QPair<int, QPointer<QObject> > PriorityPair;\n     typedef QList<PriorityPair> PriorityList;\n     PriorityList priorityEventFilter;\n+    int priorityEventFilterSeqNo;\n \n     void blockMouseEvents();\n     void allowMouseEvents();"}]}, {"sha": "f999b0acbb2ef43e681dca60e383927b632b1774", "stats": {"total": 8, "additions": 4, "deletions": 4}, "files": [{"sha": "65e49755fee1c47307d1fd65ed2c29db1d08d2f3", "filename": "libs/ui/input/wintab/kis_tablet_support_win.cpp", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/f999b0acbb2ef43e681dca60e383927b632b1774/libs/ui/input/wintab/kis_tablet_support_win.cpp", "raw_url": "https://github.com/KDE/krita/raw/f999b0acbb2ef43e681dca60e383927b632b1774/libs/ui/input/wintab/kis_tablet_support_win.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/wintab/kis_tablet_support_win.cpp?ref=f999b0acbb2ef43e681dca60e383927b632b1774", "patch": "@@ -191,9 +191,9 @@ static void handleTabletEvent(QWidget *windowWidget, const QPointF &local, const\n     // Lock in target window\n     if (type == QEvent::TabletPress) {\n         targetWindow = windowWidget;\n-        dbgTablet << \"Locking target window\" << targetWindow;\n+        dbgInput << \"Locking target window\" << targetWindow;\n     } else if ((type == QEvent::TabletRelease || buttons == Qt::NoButton) && (targetWindow != 0)) {\n-        dbgTablet << \"Releasing target window\" << targetWindow;\n+        dbgInput << \"Releasing target window\" << targetWindow;\n         targetWindow = 0;\n     }\n     if (!windowWidget) // Should never happen\n@@ -857,11 +857,11 @@ void QWindowsTabletSupport::tabletUpdateCursor(const int pkCursor)\n         TCHAR* dvcName = new TCHAR[nameLength + 1];\n         QWindowsTabletSupport::m_winTab32DLL.wTInfo(WTI_DEVICES, DVC_NAME, dvcName);\n         QString qDvcName = QString::fromWCharArray((const wchar_t*)dvcName);\n-        dbgTablet << \"DVC_NAME =\" << qDvcName;\n+        dbgInput << \"DVC_NAME =\" << qDvcName;\n         // Name changed between older and newer Surface Pro 3 drivers\n         if (qDvcName == QString::fromLatin1(\"N-trig DuoSense device\") ||\n             qDvcName == QString::fromLatin1(\"Microsoft device\")) {\n-            dbgTablet << \"This looks like a Surface Pro 3. Enabling eraser workaround.\";\n+            dbgInput << \"This looks like a Surface Pro 3. Enabling eraser workaround.\";\n             isSurfacePro3 = true;\n         }\n         delete[] dvcName;"}]}, {"sha": "ba9bf71a61d8b74f0ae2261f7d40a9aed651fa5d", "stats": {"total": 1, "additions": 1, "deletions": 0}, "files": [{"sha": "6948a29a83360f3b07740c44ccc01fba90ca8a69", "filename": "plugins/dockers/lut/ocio_display_filter.cpp", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/ba9bf71a61d8b74f0ae2261f7d40a9aed651fa5d/plugins/dockers/lut/ocio_display_filter.cpp", "raw_url": "https://github.com/KDE/krita/raw/ba9bf71a61d8b74f0ae2261f7d40a9aed651fa5d/plugins/dockers/lut/ocio_display_filter.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/lut/ocio_display_filter.cpp?ref=ba9bf71a61d8b74f0ae2261f7d40a9aed651fa5d", "patch": "@@ -246,6 +246,7 @@ void OcioDisplayFilter::updateShader()\n     if (!m_shaderDirty) return;\n \n     QOpenGLFunctions_3_0 *glFuncs3 = QOpenGLContext::currentContext()->versionFunctions<QOpenGLFunctions_3_0>();\n+    KIS_ASSERT_RECOVER_RETURN(glFuncs3);\n \n     const int lut3DEdgeSize = cfg.ocioLutEdgeSize();\n "}]}, {"sha": "26e7607894c68b0a7a9d4069952c0e825fbbd192", "stats": {"total": 96, "additions": 58, "deletions": 38}, "files": [{"sha": "75caf0c097ddc880c8901841d3662352d1079fe0", "filename": "libs/ui/input/kis_input_manager.cpp", "status": "modified", "additions": 48, "deletions": 32, "changes": 80, "blob_url": "https://github.com/KDE/krita/blob/26e7607894c68b0a7a9d4069952c0e825fbbd192/libs/ui/input/kis_input_manager.cpp", "raw_url": "https://github.com/KDE/krita/raw/26e7607894c68b0a7a9d4069952c0e825fbbd192/libs/ui/input/kis_input_manager.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_input_manager.cpp?ref=26e7607894c68b0a7a9d4069952c0e825fbbd192", "patch": "@@ -210,6 +210,49 @@ bool KisInputManager::eventFilter(QObject* object, QEvent* event)\n     return eventFilterImpl(event);\n }\n \n+template <class Event>\n+bool KisInputManager::compressMoveEventCommon(Event *event)\n+{\n+    /**\n+     * We construct a copy of this event object, so we must ensure it\n+     * has a correct type.\n+     */\n+    static_assert(std::is_same<Event, QMouseEvent>::value ||\n+                  std::is_same<Event, QTabletEvent>::value,\n+                  \"event should a mouse or a tablet event\");\n+\n+    bool retval = false;\n+\n+    /**\n+     * Compress the events if the tool doesn't need high resolution input\n+     */\n+    if ((event->type() == QEvent::MouseMove ||\n+         event->type() == QEvent::TabletMove) &&\n+        (!d->matcher.supportsHiResInputEvents() ||\n+         d->testingCompressBrushEvents)) {\n+\n+        d->compressedMoveEvent.reset(new Event(*event));\n+        d->moveEventCompressor.start();\n+\n+        /**\n+         * On Linux Qt eats the rest of unneeded events if we\n+         * ignore the first of the chunk of tablet events. So\n+         * generally we should never activate this feature. Only\n+         * for testing purposes!\n+         */\n+        if (d->testingAcceptCompressedTabletEvents) {\n+            event->setAccepted(true);\n+        }\n+\n+        retval = true;\n+    } else {\n+        slotCompressedMoveEvent();\n+        retval = d->handleCompressedTabletEvent(event);\n+    }\n+\n+    return retval;\n+}\n+\n bool KisInputManager::eventFilterImpl(QEvent * event)\n {\n     // TODO: Handle touch events correctly.\n@@ -281,12 +324,9 @@ bool KisInputManager::eventFilterImpl(QEvent * event)\n         d->debugEvent<QMouseEvent, true>(event);\n         break_if_should_ignore_cursor_events();\n \n-        if (!d->matcher.pointerMoved(event)) {\n-            //Update the current tool so things like the brush outline gets updated.\n-            d->toolProxy->forwardHoverEvent(event);\n-        }\n-        retval = true;\n-        event->setAccepted(retval);\n+        QMouseEvent *mouseEvent = static_cast<QMouseEvent*>(event);\n+        retval = compressMoveEventCommon(mouseEvent);\n+\n         break;\n     }\n     case QEvent::Wheel: {\n@@ -376,33 +416,9 @@ bool KisInputManager::eventFilterImpl(QEvent * event)\n \n     case QEvent::TabletMove: {\n         d->debugEvent<QTabletEvent, false>(event);\n-        QTabletEvent *tabletEvent = static_cast<QTabletEvent*>(event);\n \n-        /**\n-         * Compress the events if the tool doesn't need high resolution input\n-         */\n-        if (tabletEvent->type() == QEvent::TabletMove &&\n-            (!d->matcher.supportsHiResInputEvents() ||\n-             d->testingCompressBrushEvents)) {\n-\n-            d->compressedMoveEvent.reset(new QTabletEvent(*tabletEvent));\n-            d->moveEventCompressor.start();\n-\n-            /**\n-             * On Linux Qt eats the rest of unneeded events if we\n-             * ignore the first of the chunk of tablet events. So\n-             * generally we should never activate this feature. Only\n-             * for testing purposes!\n-             */\n-            if (d->testingAcceptCompressedTabletEvents) {\n-                tabletEvent->setAccepted(true);\n-            }\n-\n-            retval = true;\n-        } else {\n-            slotCompressedMoveEvent();\n-            retval = d->handleCompressedTabletEvent(tabletEvent);\n-        }\n+        QTabletEvent *tabletEvent = static_cast<QTabletEvent*>(event);\n+        retval = compressMoveEventCommon(tabletEvent);\n \n         /**\n          * The flow of tablet events means the tablet is in the"}, {"sha": "6a41dd0928c55c9043c6bedc81bb08aa09e00b15", "filename": "libs/ui/input/kis_input_manager.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/26e7607894c68b0a7a9d4069952c0e825fbbd192/libs/ui/input/kis_input_manager.h", "raw_url": "https://github.com/KDE/krita/raw/26e7607894c68b0a7a9d4069952c0e825fbbd192/libs/ui/input/kis_input_manager.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_input_manager.h?ref=26e7607894c68b0a7a9d4069952c0e825fbbd192", "patch": "@@ -116,6 +116,10 @@ private Q_SLOTS:\n     void slotCompressedMoveEvent();\n \n private:\n+    template <class Event>\n+        bool compressMoveEventCommon(Event *event);\n+\n+private:\n     class Private;\n     Private* const d;\n };"}, {"sha": "5fdec1127cdde5b702528fbf3cc7b991039fe875", "filename": "libs/ui/input/kis_input_manager_p.cpp", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/26e7607894c68b0a7a9d4069952c0e825fbbd192/libs/ui/input/kis_input_manager_p.cpp", "raw_url": "https://github.com/KDE/krita/raw/26e7607894c68b0a7a9d4069952c0e825fbbd192/libs/ui/input/kis_input_manager_p.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_input_manager_p.cpp?ref=26e7607894c68b0a7a9d4069952c0e825fbbd192", "patch": "@@ -426,15 +426,15 @@ void KisInputManager::Private::eatOneMousePress()\n     eventEater.eatOneMousePress();\n }\n \n-bool KisInputManager::Private::handleCompressedTabletEvent(QTabletEvent *tevent)\n+bool KisInputManager::Private::handleCompressedTabletEvent(QEvent *event)\n {\n     bool retval = false;\n \n-    if (!matcher.pointerMoved(tevent)) {\n-        toolProxy->forwardHoverEvent(tevent);\n+    if (!matcher.pointerMoved(event)) {\n+        toolProxy->forwardHoverEvent(event);\n     }\n     retval = true;\n-    tevent->setAccepted(true);\n+    event->setAccepted(true);\n \n     return retval;\n }"}, {"sha": "b961cd2950452462ba4ea0ade78ad6aa4ffd5d89", "filename": "libs/ui/input/kis_input_manager_p.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/26e7607894c68b0a7a9d4069952c0e825fbbd192/libs/ui/input/kis_input_manager_p.h", "raw_url": "https://github.com/KDE/krita/raw/26e7607894c68b0a7a9d4069952c0e825fbbd192/libs/ui/input/kis_input_manager_p.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_input_manager_p.h?ref=26e7607894c68b0a7a9d4069952c0e825fbbd192", "patch": "@@ -47,7 +47,7 @@ class KisInputManager::Private\n     bool processUnhandledEvent(QEvent *event);\n     void setupActions();\n     void saveTouchEvent( QTouchEvent* event );\n-    bool handleCompressedTabletEvent(QTabletEvent *tevent);\n+    bool handleCompressedTabletEvent(QEvent *event);\n \n     KisInputManager *q;\n \n@@ -67,7 +67,7 @@ class KisInputManager::Private\n \n     QObject *eventsReceiver = 0;\n     KisSignalCompressor moveEventCompressor;\n-    QScopedPointer<QTabletEvent> compressedMoveEvent;\n+    QScopedPointer<QEvent> compressedMoveEvent;\n     bool testingAcceptCompressedTabletEvents = false;\n     bool testingCompressBrushEvents = false;\n "}]}, {"sha": "44306bff3b61734968ca7ef889337a7cec3c5ec8", "stats": {"total": 47, "additions": 32, "deletions": 15}, "files": [{"sha": "f81766011e1f3494565888e959008c370d0424eb", "filename": "libs/ui/input/kis_input_manager.cpp", "status": "modified", "additions": 26, "deletions": 7, "changes": 33, "blob_url": "https://github.com/KDE/krita/blob/44306bff3b61734968ca7ef889337a7cec3c5ec8/libs/ui/input/kis_input_manager.cpp", "raw_url": "https://github.com/KDE/krita/raw/44306bff3b61734968ca7ef889337a7cec3c5ec8/libs/ui/input/kis_input_manager.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_input_manager.cpp?ref=44306bff3b61734968ca7ef889337a7cec3c5ec8", "patch": "@@ -378,11 +378,31 @@ bool KisInputManager::eventFilterImpl(QEvent * event)\n         d->debugEvent<QTabletEvent, false>(event);\n         QTabletEvent *tabletEvent = static_cast<QTabletEvent*>(event);\n \n-        if (!d->matcher.pointerMoved(tabletEvent)) {\n-            d->toolProxy->forwardHoverEvent(tabletEvent);\n+        /**\n+         * Compress the events if the tool doesn't need high resolution input\n+         */\n+        if (tabletEvent->type() == QEvent::TabletMove &&\n+            (!d->matcher.supportsHiResInputEvents() ||\n+             d->testingCompressBrushEvents)) {\n+\n+            d->compressedMoveEvent.reset(new QTabletEvent(*tabletEvent));\n+            d->moveEventCompressor.start();\n+\n+            /**\n+             * On Linux Qt eats the rest of unneeded events if we\n+             * ignore the first of the chunk of tablet events. So\n+             * generally we should never activate this feature. Only\n+             * for testing purposes!\n+             */\n+            if (d->testingAcceptCompressedTabletEvents) {\n+                tabletEvent->setAccepted(true);\n+            }\n+\n+            retval = true;\n+        } else {\n+            slotCompressedMoveEvent();\n+            retval = d->handleCompressedTabletEvent(tabletEvent);\n         }\n-        retval = true;\n-        event->setAccepted(true);\n \n         /**\n          * The flow of tablet events means the tablet is in the\n@@ -392,6 +412,7 @@ bool KisInputManager::eventFilterImpl(QEvent * event)\n          * area)\n          */\n         start_ignore_cursor_events();\n+\n         break;\n     }\n \n@@ -452,11 +473,9 @@ bool KisInputManager::eventFilterImpl(QEvent * event)\n void KisInputManager::slotCompressedMoveEvent()\n {\n     if (d->compressedMoveEvent) {\n-\n         // touch_stop_block_press_events();\n \n-        (void) d->handleCompressedTabletEvent(d->eventsReceiver, d->compressedMoveEvent.data());\n-\n+        (void) d->handleCompressedTabletEvent(d->compressedMoveEvent.data());\n         d->compressedMoveEvent.reset();\n         dbgKrita << \"Compressed move event received.\";\n     } else {"}, {"sha": "46b67a5d594dd70d9e886b2a4f3e24f6664fbe5f", "filename": "libs/ui/input/kis_input_manager_p.cpp", "status": "modified", "additions": 5, "deletions": 7, "changes": 12, "blob_url": "https://github.com/KDE/krita/blob/44306bff3b61734968ca7ef889337a7cec3c5ec8/libs/ui/input/kis_input_manager_p.cpp", "raw_url": "https://github.com/KDE/krita/raw/44306bff3b61734968ca7ef889337a7cec3c5ec8/libs/ui/input/kis_input_manager_p.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_input_manager_p.cpp?ref=44306bff3b61734968ca7ef889337a7cec3c5ec8", "patch": "@@ -426,17 +426,15 @@ void KisInputManager::Private::eatOneMousePress()\n     eventEater.eatOneMousePress();\n }\n \n-bool KisInputManager::Private::handleCompressedTabletEvent(QObject *object, QTabletEvent *tevent)\n+bool KisInputManager::Private::handleCompressedTabletEvent(QTabletEvent *tevent)\n {\n-    if(object == 0) return false;\n-\n     bool retval = false;\n \n-    retval = q->eventFilter(object, tevent);\n-\n-    if (!retval && !tevent->isAccepted()) {\n-        dbgInput << \"Rejected a compressed tablet event.\";\n+    if (!matcher.pointerMoved(tevent)) {\n+        toolProxy->forwardHoverEvent(tevent);\n     }\n+    retval = true;\n+    tevent->setAccepted(true);\n \n     return retval;\n }"}, {"sha": "3db495e64971ec957dd1640c551bfe693c3a5b13", "filename": "libs/ui/input/kis_input_manager_p.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/44306bff3b61734968ca7ef889337a7cec3c5ec8/libs/ui/input/kis_input_manager_p.h", "raw_url": "https://github.com/KDE/krita/raw/44306bff3b61734968ca7ef889337a7cec3c5ec8/libs/ui/input/kis_input_manager_p.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_input_manager_p.h?ref=44306bff3b61734968ca7ef889337a7cec3c5ec8", "patch": "@@ -47,7 +47,7 @@ class KisInputManager::Private\n     bool processUnhandledEvent(QEvent *event);\n     void setupActions();\n     void saveTouchEvent( QTouchEvent* event );\n-    bool handleCompressedTabletEvent(QObject *object, QTabletEvent *tevent);\n+    bool handleCompressedTabletEvent(QTabletEvent *tevent);\n \n     KisInputManager *q;\n "}]}, {"sha": "ab3354d9ab9821bba38012ca9bd92f24e758d6a0", "stats": {"total": 12, "additions": 7, "deletions": 5}, "files": [{"sha": "63a1996b25f148c7fd9d01a228947efa1b12c494", "filename": "libs/ui/KisApplication.cpp", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/ab3354d9ab9821bba38012ca9bd92f24e758d6a0/libs/ui/KisApplication.cpp", "raw_url": "https://github.com/KDE/krita/raw/ab3354d9ab9821bba38012ca9bd92f24e758d6a0/libs/ui/KisApplication.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisApplication.cpp?ref=ab3354d9ab9821bba38012ca9bd92f24e758d6a0", "patch": "@@ -434,10 +434,10 @@ bool KisApplication::start(const KisApplicationArguments &args)\n                         return 1;\n                     }\n \n-                    QApplication::setOverrideCursor(Qt::WaitCursor);\n-\n+                    KisDocument *doc = KisPart::instance()->createDocument();\n+                    doc->openUrl(QUrl::fromLocalFile(fileName));\n                     KisImportExportFilter::ConversionStatus status = KisImportExportFilter::OK;\n-                    KisImportExportManager manager(fileName);\n+                    KisImportExportManager manager(doc);\n                     manager.setBatchMode(true);\n                     QByteArray mime(outputMimetype.toLatin1());\n                     status = manager.exportDocument(exportFileName, mime);"}, {"sha": "3ac53f7bdbb16ad07b9ff5658b705161f0c82cb7", "filename": "libs/ui/KisFilterChain.cpp", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/ab3354d9ab9821bba38012ca9bd92f24e758d6a0/libs/ui/KisFilterChain.cpp", "raw_url": "https://github.com/KDE/krita/raw/ab3354d9ab9821bba38012ca9bd92f24e758d6a0/libs/ui/KisFilterChain.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisFilterChain.cpp?ref=ab3354d9ab9821bba38012ca9bd92f24e758d6a0", "patch": "@@ -163,10 +163,12 @@ KisDocument* KisFilterChain::inputDocument()\n \n     if ((m_state & Beginning) &&\n             static_cast<KisImportExportManager::Direction>(filterManagerDirection()) == KisImportExportManager::Export &&\n-            filterManagerKisDocument())\n+            filterManagerKisDocument()) {\n         m_inputDocument = filterManagerKisDocument();\n-    else if (!m_inputDocument)\n+    }\n+    else if (!m_inputDocument) {\n         m_inputDocument = KisPart::instance()->createDocument();\n+    }\n \n     m_inputQueried = Document;\n     return m_inputDocument;"}]}, {"sha": "fb077558c133da116d0cbc6e49b159ea9bf3d6a3", "stats": {"total": 3, "additions": 2, "deletions": 1}, "files": [{"sha": "00ff7e40fdaac93d778dda2d7f654a8744736e6a", "filename": "windows/makepkg-mxe.sh", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/fb077558c133da116d0cbc6e49b159ea9bf3d6a3/windows/makepkg-mxe.sh", "raw_url": "https://github.com/KDE/krita/raw/fb077558c133da116d0cbc6e49b159ea9bf3d6a3/windows/makepkg-mxe.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/makepkg-mxe.sh?ref=fb077558c133da116d0cbc6e49b159ea9bf3d6a3", "patch": "@@ -74,7 +74,8 @@ rm -rf locale\n \n wget http://nonaynever.ru/pub/l10n-win/krita-3.0-l10n-win-current.tar.gz\n tar -xf krita-3.0-l10n-win-current.tar.gz\n-cp -r $BUILDROOT/locale $BUILDROOT/out/$PACKAGENAME/share\n+mkdir $BUILDROOT/out/$PACKAGENAME/bin/data\n+cp -r $BUILDROOT/locale $BUILDROOT/out/$PACKAGENAME/bin/data\n \n cd $BUILDROOT/out/\n "}]}, {"sha": "6bb54efd97e2bd2a4b15753a039083307db50fed", "stats": {"total": 1, "additions": 1, "deletions": 0}, "files": [{"sha": "e5b7b28bb47745f3f97b01d8f70dbe4a0be95765", "filename": "windows/makepkg-mxe.sh", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/6bb54efd97e2bd2a4b15753a039083307db50fed/windows/makepkg-mxe.sh", "raw_url": "https://github.com/KDE/krita/raw/6bb54efd97e2bd2a4b15753a039083307db50fed/windows/makepkg-mxe.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/makepkg-mxe.sh?ref=6bb54efd97e2bd2a4b15753a039083307db50fed", "patch": "@@ -32,6 +32,7 @@ mkdir -p $BUILDROOT/out/$PACKAGENAME/share\n cp $MXEROOT/bin/krita.exe $BUILDROOT/out/$PACKAGENAME/bin\n cp $MXEROOT/bin/*.dll $BUILDROOT/out/$PACKAGENAME/bin\n cp $MXEROOT/bin/*.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/lib/libOpenColorIO.dll $BUILDROOT/out/$PACKAGENAME/bin\n cp -r $MXEROOT/lib/plugins $BUILDROOT/out/$PACKAGENAME/bin\n cp -r $MXEROOT/lib/kritaplugins $BUILDROOT/out/$PACKAGENAME/lib\n "}]}, {"sha": "53d8d95ce68ba78725eec5e73e109b17ce19580e", "stats": {"total": 11, "additions": 11, "deletions": 0}, "files": [{"sha": "044ce07f34144d9544121d7493c99bc692c5ed68", "filename": "plugins/extensions/gmic/CMakeLists.txt", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/53d8d95ce68ba78725eec5e73e109b17ce19580e/plugins/extensions/gmic/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/53d8d95ce68ba78725eec5e73e109b17ce19580e/plugins/extensions/gmic/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/gmic/CMakeLists.txt?ref=53d8d95ce68ba78725eec5e73e109b17ce19580e", "patch": "@@ -50,6 +50,8 @@ endif()\n if(OPENMP_FOUND)\n     message(\"G'Mic: using OpenMP\")\n     set (CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} ${OpenMP_CXX_FLAGS}\")\n+    add_definitions(-Dcimg_use_openmp)\n+    add_definitions(-fopenmp)\n endif()\n \n #FFTW\n@@ -99,6 +101,11 @@ if(APPLE)\n     add_definitions(-D_APPLE)\n endif()\n \n+if (MSYS)\n+    add_definitions(-Dcimg_OS=2)\n+    add_definitions(-Dcimg_display=2)\n+endif()\n+\n add_library(gmic STATIC ${gmic_sources_SRCS} ${gmic_headers_SRCS})\n \n if(FFTW3_FOUND)\n@@ -114,6 +121,10 @@ if(CURL_FOUND)\n     target_link_libraries(gmic ${CURL_LIBRARIES})\n endif()\n \n+if(OPENMP_FOUND)\n+    target_link_libraries(gmic ${OPENMP_LIBRARIES})\n+endif()\n+\n target_link_libraries(gmic ${ZLIB_LIBRARIES})\n target_link_libraries(gmic ${PNG_LIBRARIES})\n "}]}, {"sha": "a9ef420d0105c75e1b9a5f9ac2cc3b7e02257c86", "stats": {"total": 51, "additions": 21, "deletions": 30}, "files": [{"sha": "c02beff4681589b845ad935ffcf15ef9c1594601", "filename": "plugins/dockers/animation/CMakeLists.txt", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/KDE/krita/blob/a9ef420d0105c75e1b9a5f9ac2cc3b7e02257c86/plugins/dockers/animation/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/a9ef420d0105c75e1b9a5f9ac2cc3b7e02257c86/plugins/dockers/animation/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/animation/CMakeLists.txt?ref=a9ef420d0105c75e1b9a5f9ac2cc3b7e02257c86", "patch": "@@ -1,4 +1,6 @@\n-add_subdirectory(tests)\n+if (NOT WIN32 AND NOT APPLE)\n+    add_subdirectory(tests)\n+endif()    \n \n include_directories(${Boost_INCLUDE_DIRS})\n \n@@ -35,11 +37,7 @@ ki18n_wrap_ui(KRITA_ANIMATIONDOCKER_SOURCES\n     onion_skins_docker.ui\n )\n \n-if (WIN32)\n-    add_library(kritaanimationdocker SHARED ${KRITA_ANIMATIONDOCKER_SOURCES})\n-else()\n-    add_library(kritaanimationdocker MODULE ${KRITA_ANIMATIONDOCKER_SOURCES})\n-endif()\n+add_library(kritaanimationdocker MODULE ${KRITA_ANIMATIONDOCKER_SOURCES})\n \n generate_export_header(kritaanimationdocker BASE_NAME kritaanimationdocker EXPORT_MACRO_NAME KRITAANIMATIONDOCKER_EXPORT)\n target_link_libraries(kritaanimationdocker kritaui)"}, {"sha": "3f60a427fbc29c6b468fc3f9a6117d9b4c1cd18c", "filename": "plugins/dockers/lut/CMakeLists.txt", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/a9ef420d0105c75e1b9a5f9ac2cc3b7e02257c86/plugins/dockers/lut/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/a9ef420d0105c75e1b9a5f9ac2cc3b7e02257c86/plugins/dockers/lut/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/lut/CMakeLists.txt?ref=a9ef420d0105c75e1b9a5f9ac2cc3b7e02257c86", "patch": "@@ -1,4 +1,7 @@\n-add_subdirectory(tests)\n+if (NOT WIN32 AND NOT APPLE)\n+    add_subdirectory(tests)\n+endif()\n+\n include_directories( ${OCIO_INCLUDE_DIR}\n     ${Boost_INCLUDE_DIRS}\n )\n@@ -14,11 +17,7 @@ ki18n_wrap_ui(KRITA_LUTDOCKER_SOURCES\n     wdglut.ui\n )\n \n-if (WIN32)\n-    add_library(kritalutdocker SHARED ${KRITA_LUTDOCKER_SOURCES})\n-else()\n-    add_library(kritalutdocker MODULE ${KRITA_LUTDOCKER_SOURCES})\n-endif()\n+add_library(kritalutdocker MODULE ${KRITA_LUTDOCKER_SOURCES})\n \n generate_export_header(kritalutdocker BASE_NAME kritalutdocker)\n target_link_libraries(kritalutdocker kritaui ${Boost_SYSTEM_LIBRARY} ${OCIO_LIBRARIES})"}, {"sha": "0a21bb9d4e84af71e0ddf7e160601b152b8a3a15", "filename": "plugins/impex/psd/CMakeLists.txt", "status": "modified", "additions": 8, "deletions": 12, "changes": 20, "blob_url": "https://github.com/KDE/krita/blob/a9ef420d0105c75e1b9a5f9ac2cc3b7e02257c86/plugins/impex/psd/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/a9ef420d0105c75e1b9a5f9ac2cc3b7e02257c86/plugins/impex/psd/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/psd/CMakeLists.txt?ref=a9ef420d0105c75e1b9a5f9ac2cc3b7e02257c86", "patch": "@@ -1,4 +1,6 @@\n-add_subdirectory(tests)\n+if (NOT MSVC AND NOT APPLE)\n+    add_subdirectory(tests)\n+endif()\n \n configure_file(config_psd.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config_psd.h)\n \n@@ -29,17 +31,10 @@ set(kritapsdimport_SOURCES\n     ${LIB_PSD_SRCS}\n )\n \n-if (WIN32)\n-    add_library(kritapsdimport SHARED ${kritapsdimport_SOURCES})\n-else ()\n-    add_library(kritapsdimport MODULE ${kritapsdimport_SOURCES})\n-endif()\n \n-if (WIN32)\n-\ttarget_link_libraries(kritapsdimport kritaglobal kritaui kritapsd KF5::I18n ${WIN32_PLATFORM_NET_LIBS} ${ZLIB_LIBRARIES})\n-else ()\n-\ttarget_link_libraries(kritapsdimport kritaglobal kritaui kritapsd KF5::I18n ${ZLIB_LIBRARIES})\n-endif ()\n+add_library(kritapsdimport MODULE ${kritapsdimport_SOURCES})\n+\n+target_link_libraries(kritapsdimport kritaglobal kritaui kritapsd KF5::I18n ${ZLIB_LIBRARIES})\n \n install(TARGETS kritapsdimport DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n \n@@ -55,11 +50,12 @@ set(kritapsdexport_SOURCES\n \n add_library(kritapsdexport MODULE ${kritapsdexport_SOURCES})\n \n-if (WIN32)\n+if (MSVC)\n     target_link_libraries(kritapsdexport kritaui kritapsd ${WIN32_PLATFORM_NET_LIBS} ${ZLIB_LIBRARIES})\n else ()\t\n     target_link_libraries(kritapsdexport kritaui kritapsd ${ZLIB_LIBRARIES})\n endif ()\t\n+\n install(TARGETS kritapsdexport DESTINATION ${CALLIGRA_PLUGIN_INSTALL_DIR})\n \n install( PROGRAMS  krita_psd.desktop  DESTINATION ${XDG_APPS_INSTALL_DIR})"}, {"sha": "35d1fae8325c8fdb6c5172869a7cc3b7ef466cde", "filename": "plugins/tools/tool_transform2/CMakeLists.txt", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/KDE/krita/blob/a9ef420d0105c75e1b9a5f9ac2cc3b7e02257c86/plugins/tools/tool_transform2/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/a9ef420d0105c75e1b9a5f9ac2cc3b7e02257c86/plugins/tools/tool_transform2/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_transform2/CMakeLists.txt?ref=a9ef420d0105c75e1b9a5f9ac2cc3b7e02257c86", "patch": "@@ -1,4 +1,6 @@\n-add_subdirectory(tests)\n+if (NOT WIN32 AND NOT APPLE)\n+    add_subdirectory(tests)\n+endif()\n \n include_directories(${Boost_INCLUDE_DIRS})\n \n@@ -27,11 +29,7 @@ set(kritatooltransform_SOURCES\n qt5_add_resources(kritatooltransform_SOURCES tool_transform.qrc)\n ki18n_wrap_ui(kritatooltransform_SOURCES wdg_tool_transform.ui)\n \n-if (WIN32)\n-    add_library(kritatooltransform SHARED ${kritatooltransform_SOURCES})\n-else()\n-    add_library(kritatooltransform MODULE ${kritatooltransform_SOURCES})\n-endif()\n+add_library(kritatooltransform MODULE ${kritatooltransform_SOURCES})\n \n generate_export_header(kritatooltransform BASE_NAME kritatooltransform)\n "}]}, {"sha": "81ac1189da0966710ff8342ce0fc5924e2473b8d", "stats": {"total": 94, "additions": 47, "deletions": 47}, "files": [{"sha": "480f1c3a06ac423d1175d08a59af037f6f526ee5", "filename": "libs/ui/input/kis_input_manager_p.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/81ac1189da0966710ff8342ce0fc5924e2473b8d/libs/ui/input/kis_input_manager_p.cpp", "raw_url": "https://github.com/KDE/krita/raw/81ac1189da0966710ff8342ce0fc5924e2473b8d/libs/ui/input/kis_input_manager_p.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_input_manager_p.cpp?ref=81ac1189da0966710ff8342ce0fc5924e2473b8d", "patch": "@@ -100,7 +100,7 @@ bool KisInputManager::Private::EventEater::eventFilter(QObject* target, QEvent*\n void KisInputManager::Private::EventEater::activate()\n {\n     if (!hungry && (KisTabletDebugger::instance()->debugEnabled()))\n-        dbgTablet << \"Start ignoring mouse events.\";\n+        qDebug() << \"Start ignoring mouse events.\";\n     hungry = true;\n }\n "}, {"sha": "797df1610594ccd3ae0ca638dcbd3053366bfe01", "filename": "libs/ui/input/wintab/kis_tablet_support_win.cpp", "status": "modified", "additions": 32, "deletions": 32, "changes": 64, "blob_url": "https://github.com/KDE/krita/blob/81ac1189da0966710ff8342ce0fc5924e2473b8d/libs/ui/input/wintab/kis_tablet_support_win.cpp", "raw_url": "https://github.com/KDE/krita/raw/81ac1189da0966710ff8342ce0fc5924e2473b8d/libs/ui/input/wintab/kis_tablet_support_win.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/wintab/kis_tablet_support_win.cpp?ref=81ac1189da0966710ff8342ce0fc5924e2473b8d", "patch": "@@ -110,23 +110,23 @@ HWND createDummyWindow(const QString &className, const wchar_t *windowName, WNDP\n \n void printContext(const LOGCONTEXT &lc)\n {\n-    dbgInput << \"# Getting current context data:\";\n-    dbgInput << ppVar(lc.lcName);\n-    dbgInput << ppVar(lc.lcDevice);\n-    dbgInput << ppVar(lc.lcInOrgX);\n-    dbgInput << ppVar(lc.lcInOrgY);\n-    dbgInput << ppVar(lc.lcInExtX);\n-    dbgInput << ppVar(lc.lcInExtY);\n-    dbgInput << ppVar(lc.lcOutOrgX);\n-    dbgInput << ppVar(lc.lcOutOrgY);\n-    dbgInput << ppVar(lc.lcOutExtX);\n-    dbgInput << ppVar(lc.lcOutExtY);\n-    dbgInput << ppVar(lc.lcSysOrgX);\n-    dbgInput << ppVar(lc.lcSysOrgY);\n-    dbgInput << ppVar(lc.lcSysExtX);\n-    dbgInput << ppVar(lc.lcSysExtY);\n-\n-    dbgInput << \"Qt Desktop Geometry\" << QApplication::desktop()->geometry();\n+    dbgTablet << \"# Getting current context data:\";\n+    dbgTablet << ppVar(lc.lcName);\n+    dbgTablet << ppVar(lc.lcDevice);\n+    dbgTablet << ppVar(lc.lcInOrgX);\n+    dbgTablet << ppVar(lc.lcInOrgY);\n+    dbgTablet << ppVar(lc.lcInExtX);\n+    dbgTablet << ppVar(lc.lcInExtY);\n+    dbgTablet << ppVar(lc.lcOutOrgX);\n+    dbgTablet << ppVar(lc.lcOutOrgY);\n+    dbgTablet << ppVar(lc.lcOutExtX);\n+    dbgTablet << ppVar(lc.lcOutExtY);\n+    dbgTablet << ppVar(lc.lcSysOrgX);\n+    dbgTablet << ppVar(lc.lcSysOrgY);\n+    dbgTablet << ppVar(lc.lcSysExtX);\n+    dbgTablet << ppVar(lc.lcSysExtY);\n+\n+    dbgTablet << \"Qt Desktop Geometry\" << QApplication::desktop()->geometry();\n }\n \n \n@@ -191,9 +191,9 @@ static void handleTabletEvent(QWidget *windowWidget, const QPointF &local, const\n     // Lock in target window\n     if (type == QEvent::TabletPress) {\n         targetWindow = windowWidget;\n-        dbgInput << \"Locking target window\" << targetWindow;\n+        dbgTablet << \"Locking target window\" << targetWindow;\n     } else if ((type == QEvent::TabletRelease || buttons == Qt::NoButton) && (targetWindow != 0)) {\n-        dbgInput << \"Releasing target window\" << targetWindow;\n+        dbgTablet << \"Releasing target window\" << targetWindow;\n         targetWindow = 0;\n     }\n     if (!windowWidget) // Should never happen\n@@ -218,7 +218,7 @@ static void handleTabletEvent(QWidget *windowWidget, const QPointF &local, const\n \n \n     if ((type == QEvent::TabletRelease || buttons == Qt::NoButton) && (qt_tablet_target != 0)) {\n-        dbgInput << \"releasing tablet target\" << qt_tablet_target;\n+        dbgTablet << \"releasing tablet target\" << qt_tablet_target;\n         qt_tablet_target = 0;\n     }\n \n@@ -233,11 +233,11 @@ static void handleTabletEvent(QWidget *windowWidget, const QPointF &local, const\n \n \n         if (ev.isAccepted()) {\n-            // dbgInput << \"Tablet event\" << type << \"accepted\" << \"by target widget\" << finalDestination;\n+            // dbgTablet << \"Tablet event\" << type << \"accepted\" << \"by target widget\" << finalDestination;\n         }\n         else {\n             // Turn off eventEater send a synthetic mouse event.\n-            // dbgInput << \"Tablet event\" << type << \"rejected; sending mouse event to\" << finalDestination;\n+            // dbgTablet << \"Tablet event\" << type << \"rejected; sending mouse event to\" << finalDestination;\n             qt_tablet_target = 0;\n \n             // We shouldn't ever get a widget accepting a tablet event from this\n@@ -458,7 +458,7 @@ QWindowsTabletSupport *QWindowsTabletSupport::create()\n     lcMine.lcOutExtY = -lcMine.lcInExtY;\n     const HCTX context = QWindowsTabletSupport::m_winTab32DLL.wTOpen(window, &lcMine, true);\n     if (!context) {\n-        dbgInput << __FUNCTION__ << \"Unable to open tablet.\";\n+        dbgTablet << __FUNCTION__ << \"Unable to open tablet.\";\n         DestroyWindow(window);\n         return 0;\n     }\n@@ -474,7 +474,7 @@ QWindowsTabletSupport *QWindowsTabletSupport::create()\n             } // cannot restore old size\n         } // cannot set\n     } // mismatch\n-    dbgInput << \"Opened tablet context \" << context << \" on window \"\n+    dbgTablet << \"Opened tablet context \" << context << \" on window \"\n              <<  window << \"changed packet queue size \" << currentQueueSize\n              << \"->\" <<  TabletPacketQSize;\n     return new QWindowsTabletSupport(window, context);\n@@ -520,7 +520,7 @@ void QWindowsTabletSupport::notifyActivate()\n     // Cooperate with other tablet applications, but when we get focus, I want to use the tablet.\n     const bool result = QWindowsTabletSupport::m_winTab32DLL.wTEnable(m_context, true)\n                         && QWindowsTabletSupport::m_winTab32DLL.wTOverlap(m_context, true);\n-    dbgInput << __FUNCTION__ << result;\n+    dbgTablet << __FUNCTION__ << result;\n }\n \n static inline int indexOfDevice(const QVector<QWindowsTabletDeviceData> &devices, qint64 uniqueId)\n@@ -634,7 +634,7 @@ bool QWindowsTabletSupport::translateTabletProximityEvent(WPARAM /* wParam */, L\n     };\n \n     if (!LOWORD(lParam)) {\n-        // dbgInput << \"leave proximity for device #\" << m_currentDevice;\n+        // dbgTablet << \"leave proximity for device #\" << m_currentDevice;\n         sendProximityEvent(QEvent::TabletLeaveProximity);\n         return true;\n     }\n@@ -647,7 +647,7 @@ bool QWindowsTabletSupport::translateTabletProximityEvent(WPARAM /* wParam */, L\n     // WT_CSRCHANGE. We do it in WT_PROXIMITY because some wintab never send\n     // the event WT_CSRCHANGE even if asked with CXO_CSRMESSAGES\n     tabletUpdateCursor(pkCursor);\n-    // dbgInput << \"enter proximity for device #\" << m_currentDevice << m_devices.at(m_currentDevice);\n+    // dbgTablet << \"enter proximity for device #\" << m_currentDevice << m_devices.at(m_currentDevice);\n \n     sendProximityEvent(QEvent::TabletEnterProximity);\n     return true;\n@@ -772,7 +772,7 @@ bool QWindowsTabletSupport::translateTabletPacketEvent()\n \n         // This is adds *a lot* of noise to the output log\n         if (false) {\n-            dbgInput\n+            dbgTablet\n                 << \"Packet #\" << (i+1) << '/' << packetCount << \"button:\" << packet.pkButtons\n                 << globalPosF << z << \"to:\" << w << localPos << \"(packet\" << packet.pkX\n                 << packet.pkY << \") dev:\" << currentDevice << \"pointer:\"\n@@ -794,7 +794,7 @@ bool QWindowsTabletSupport::translateTabletPacketEvent()\n          */\n         if (isSurfacePro3 && (packet.pkCursor != currentPkCursor)) {\n \n-            dbgInput << \"Got an inline tool switch.\";\n+            dbgTablet << \"Got an inline tool switch.\";\n             // Send tablet release event.\n             sendTabletEvent(QTabletEvent::TabletRelease);\n \n@@ -838,7 +838,7 @@ void QWindowsTabletSupport::tabletUpdateCursor(const int pkCursor)\n         // button map when the user right-clicks in Krita while another\n         // application has focus. This forces Krita to load button settings only\n         // once, when the tablet is first detected.\n-        // \n+        //\n         // See https://bugs.kde.org/show_bug.cgi?id=359561\n         BYTE logicalButtons[32];\n         memset(logicalButtons, 0, 32);\n@@ -857,11 +857,11 @@ void QWindowsTabletSupport::tabletUpdateCursor(const int pkCursor)\n         TCHAR* dvcName = new TCHAR[nameLength + 1];\n         QWindowsTabletSupport::m_winTab32DLL.wTInfo(WTI_DEVICES, DVC_NAME, dvcName);\n         QString qDvcName = QString::fromWCharArray((const wchar_t*)dvcName);\n-        dbgInput << \"DVC_NAME =\" << qDvcName;\n+        dbgTablet << \"DVC_NAME =\" << qDvcName;\n         // Name changed between older and newer Surface Pro 3 drivers\n         if (qDvcName == QString::fromLatin1(\"N-trig DuoSense device\") ||\n             qDvcName == QString::fromLatin1(\"Microsoft device\")) {\n-            dbgInput << \"This looks like a Surface Pro 3. Enabling eraser workaround.\";\n+            dbgTablet << \"This looks like a Surface Pro 3. Enabling eraser workaround.\";\n             isSurfacePro3 = true;\n         }\n         delete[] dvcName;"}, {"sha": "8df931ec2545428f64c5b6c72bf979ba6ff3f0a4", "filename": "libs/ui/input/wintab/kis_tablet_support_x11.cpp", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/KDE/krita/blob/81ac1189da0966710ff8342ce0fc5924e2473b8d/libs/ui/input/wintab/kis_tablet_support_x11.cpp", "raw_url": "https://github.com/KDE/krita/raw/81ac1189da0966710ff8342ce0fc5924e2473b8d/libs/ui/input/wintab/kis_tablet_support_x11.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/wintab/kis_tablet_support_x11.cpp?ref=81ac1189da0966710ff8342ce0fc5924e2473b8d", "patch": "@@ -139,7 +139,7 @@ static const char kis_x11_atomnames[] = {\n     // Aiptek drivers (e.g. Hyperpen 12000U) reports non-standard type string\n     \"Stylus\\0\"\n \n-    // UGTABLET TABLET G5 9x6    \n+    // UGTABLET TABLET G5 9x6\n      \"WizardPen Tablet\\0\"\n \n };\n@@ -194,7 +194,7 @@ void QTabletDeviceData::SavedAxesData::tryFetchAxesMapping(XDevice *dev)\n     if (result == Success && propertyType > 0) {\n \n         if (KisTabletDebugger::instance()->initializationDebugEnabled()) {\n-            dbgKrita << \"# Building tablet axes remapping table:\";\n+            dbgTablet << \"# Building tablet axes remapping table:\";\n         }\n \n         QVector<AxesIndexes> axesMap(nitems, Unused);\n@@ -220,8 +220,8 @@ void QTabletDeviceData::SavedAxesData::tryFetchAxesMapping(XDevice *dev)\n             axesMap[axisIndex] = mappedIndex;\n \n             if (KisTabletDebugger::instance()->initializationDebugEnabled()) {\n-                dbgKrita << XGetAtomName(KIS_X11->display, currentAxisName)\n-                         << axisIndex << \"->\" << mappedIndex;\n+                dbgTablet << XGetAtomName(KIS_X11->display, currentAxisName)\n+                          << axisIndex << \"->\" << mappedIndex;\n             }\n         }\n \n@@ -409,9 +409,9 @@ void kis_x11_init_tablet()\n                 }\n \n                 if (KisTabletDebugger::instance()->initializationDebugEnabled()) {\n-                    dbgKrita << \"###################################\";\n-                    dbgKrita << \"# Adding a tablet device:\" << devs->name;\n-                    dbgKrita << \"Device Type:\" << KisTabletDebugger::tabletDeviceToString(deviceType);\n+                    dbgTablet << \"###################################\";\n+                    dbgTablet << \"# Adding a tablet device:\" << devs->name;\n+                    dbgTablet << \"Device Type:\" << KisTabletDebugger::tabletDeviceToString(deviceType);\n                 }\n \n                 device_data.savedAxesData.tryFetchAxesMapping(dev);\n@@ -439,13 +439,13 @@ void kis_x11_init_tablet()\n                         device_data.maxRotation = a[5].max_value;\n \n                         if (KisTabletDebugger::instance()->initializationDebugEnabled()) {\n-                            dbgKrita << \"# Axes limits data\";\n-                            dbgKrita << \"X:       \" << device_data.minX << device_data.maxX;\n-                            dbgKrita << \"Y:       \" << device_data.minY << device_data.maxY;\n-                            dbgKrita << \"Z:       \" << device_data.minZ << device_data.maxZ;\n-                            dbgKrita << \"Pressure:\" << device_data.minPressure << device_data.maxPressure;\n-                            dbgKrita << \"Rotation:\" << device_data.minRotation << device_data.maxRotation;\n-                            dbgKrita << \"T. Pres: \" << device_data.minTanPressure << device_data.maxTanPressure;\n+                            dbgTablet << \"# Axes limits data\";\n+                            dbgTablet << \"X:       \" << device_data.minX << device_data.maxX;\n+                            dbgTablet << \"Y:       \" << device_data.minY << device_data.maxY;\n+                            dbgTablet << \"Z:       \" << device_data.minZ << device_data.maxZ;\n+                            dbgTablet << \"Pressure:\" << device_data.minPressure << device_data.maxPressure;\n+                            dbgTablet << \"Rotation:\" << device_data.minRotation << device_data.maxRotation;\n+                            dbgTablet << \"T. Pres: \" << device_data.minTanPressure << device_data.maxTanPressure;\n                         }\n \n #endif"}]}, {"sha": "dc3ca3bfde8352d3284e326d48f818a462798790", "stats": {"total": 3, "additions": 2, "deletions": 1}, "files": [{"sha": "575559208bf99d2d0a3b59cfad20188af20bed73", "filename": "libs/ui/input/kis_tool_invocation_action.cpp", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/dc3ca3bfde8352d3284e326d48f818a462798790/libs/ui/input/kis_tool_invocation_action.cpp", "raw_url": "https://github.com/KDE/krita/raw/dc3ca3bfde8352d3284e326d48f818a462798790/libs/ui/input/kis_tool_invocation_action.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_tool_invocation_action.cpp?ref=dc3ca3bfde8352d3284e326d48f818a462798790", "patch": "@@ -138,7 +138,8 @@ void KisToolInvocationAction::end(QEvent *event)\n void KisToolInvocationAction::inputEvent(QEvent* event)\n {\n     if (!d->active) return;\n-\n+    if (!inputManager()) return;\n+    if (!inputManager()->toolProxy()) return;\n \n     inputManager()->toolProxy()->\n         forwardEvent(KisToolProxy::CONTINUE, KisTool::Primary, event, event);"}]}, {"sha": "6f2456c495d03f3fd2d0ba0f25126830bedd55cb", "stats": {"total": 11, "additions": 5, "deletions": 6}, "files": [{"sha": "75d247bfcbcdc0725d99bc71d72b01209d7c04a4", "filename": "libs/image/brushengine/kis_paint_information.cc", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/6f2456c495d03f3fd2d0ba0f25126830bedd55cb/libs/image/brushengine/kis_paint_information.cc", "raw_url": "https://github.com/KDE/krita/raw/6f2456c495d03f3fd2d0ba0f25126830bedd55cb/libs/image/brushengine/kis_paint_information.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/brushengine/kis_paint_information.cc?ref=6f2456c495d03f3fd2d0ba0f25126830bedd55cb", "patch": "@@ -213,8 +213,8 @@ KisPaintInformation::createHoveringModeInfo(const QPointF &pos,\n         qreal tangentialPressure,\n         qreal perspective,\n         qreal speed,\n-\t    int canvasrotation,\n-\t    bool canvasMirroredH)\n+        int canvasrotation,\n+        bool canvasMirroredH)\n {\n     KisPaintInformation info(pos,\n                              pressure,\n@@ -241,8 +241,8 @@ void KisPaintInformation::setCanvasRotation(int rotation)\n     } else {\n         d->canvasRotation= rotation % 360;\n     }\n-    \n-} \n+\n+}\n \n bool KisPaintInformation::canvasMirroredH() const\n {\n@@ -252,7 +252,7 @@ bool KisPaintInformation::canvasMirroredH() const\n void KisPaintInformation::setCanvasHorizontalMirrorState(bool mir)\n {\n     d->canvasMirroredH = mir;\n-    \n+\n }\n \n void KisPaintInformation::toXML(QDomDocument&, QDomElement& e) const\n@@ -412,7 +412,6 @@ qreal KisPaintInformation::currentTime() const\n KisRandomSourceSP KisPaintInformation::randomSource() const\n {\n     if (!d->randomSource) {\n-        qWarning() << \"WARNING: accessing a paint info object without a random source!\";\n         d->randomSource = new KisRandomSource();\n     }\n "}]}, {"sha": "44fb93844593a3be359bbcf8c4865e8ad1cfb374", "stats": {"total": 6, "additions": 4, "deletions": 2}, "files": [{"sha": "06731183762f7cec83fc4c8076cc8fbfc89260b7", "filename": "windows/makepkg-mxe.sh", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/44fb93844593a3be359bbcf8c4865e8ad1cfb374/windows/makepkg-mxe.sh", "raw_url": "https://github.com/KDE/krita/raw/44fb93844593a3be359bbcf8c4865e8ad1cfb374/windows/makepkg-mxe.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/makepkg-mxe.sh?ref=44fb93844593a3be359bbcf8c4865e8ad1cfb374", "patch": "@@ -10,8 +10,10 @@ BUILDROOT=/data2/cross\n MXEROOT=/data2/cross/mxe/usr/x86_64-w64-mingw32.shared\n APP=krita\n \n-VER=$(grep \"#define CALLIGRA_VERSION_STRING\" build/libs/version/calligraversion.h | cut -d '\"' -f 2)\n-cd krita\n+cd ${BUILDROOT}\n+\n+VER=$(grep \"#define CALLIGRA_VERSION_STRING\" /build/libs/version/calligraversion.h | cut -d '\"' -f 2)\n+cd ${BUILDROOT}/krita\n BRANCH=$( git branch | cut -d ' ' -f 2)\n REVISION=$(git rev-parse --short HEAD)\n cd .."}]}, {"sha": "8ba7784e4b422c7e4ab7799c72236f46324faab6", "stats": {"total": 78, "additions": 78, "deletions": 0}, "files": [{"sha": "d5c6f95e6b29bdf015f5eefd147738132f457d16", "filename": "windows/makepkg-mxe.sh", "status": "added", "additions": 78, "deletions": 0, "changes": 78, "blob_url": "https://github.com/KDE/krita/blob/8ba7784e4b422c7e4ab7799c72236f46324faab6/windows/makepkg-mxe.sh", "raw_url": "https://github.com/KDE/krita/raw/8ba7784e4b422c7e4ab7799c72236f46324faab6/windows/makepkg-mxe.sh", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/makepkg-mxe.sh?ref=8ba7784e4b422c7e4ab7799c72236f46324faab6", "patch": "@@ -0,0 +1,78 @@\n+#!/bin/bash\n+\n+# Halt on errors\n+#set -e\n+\n+# Be verbose\n+set -x\n+\n+BUILDROOT=/data2/cross\n+MXEROOT=/data2/cross/mxe/usr/x86_64-w64-mingw32.shared\n+APP=krita\n+\n+VER=$(grep \"#define CALLIGRA_VERSION_STRING\" build/libs/version/calligraversion.h | cut -d '\"' -f 2)\n+cd krita\n+BRANCH=$( git branch | cut -d ' ' -f 2)\n+REVISION=$(git rev-parse --short HEAD)\n+cd ..\n+VERSION=$VER$BRANCH-$REVISION\n+VERSION=\"$(sed s/\\ /-/g <<<$VERSION)\"\n+echo $VERSION\n+\n+PACKAGENAME=$APP\"-\"$VERSION\"-x64\"\n+\n+#rm -rf $BUILDROOT/out/* || true\n+mkdir -p $BUILDROOT/out/$PACKAGENAME\n+mkdir -p $BUILDROOT/out/$PACKAGENAME/bin\n+mkdir -p $BUILDROOT/out/$PACKAGENAME/lib\n+mkdir -p $BUILDROOT/out/$PACKAGENAME/share\n+\n+cp $MXEROOT/bin/krita.exe $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/bin/*.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/bin/*.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp -r $MXEROOT/lib/plugins $BUILDROOT/out/$PACKAGENAME/bin\n+cp -r $MXEROOT/lib/kritaplugins $BUILDROOT/out/$PACKAGENAME/lib\n+\n+cp $MXEROOT/qt5/bin/Qt5Concurrent.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Core.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Gui.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Network.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5OpenGL.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5PrintSupport.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Qml.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Quick.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Script.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5ScriptTools.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Svg.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5SystemInfo.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Widgets.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5WinExtras.dll $BUILDROOT/out/$PACKAGENAME/bin\n+cp $MXEROOT/qt5/bin/Qt5Xml.dll $BUILDROOT/out/$PACKAGENAME/bin\n+\n+x86_64-w64-mingw32.shared-strip $BUILDROOT/out/$PACKAGENAME/bin/*\n+\n+cp -r $MXEROOT/qt5/plugins/iconengines $BUILDROOT/out/$PACKAGENAME/bin/plugins\n+cp -r $MXEROOT/qt5/plugins/imageformats $BUILDROOT/out/$PACKAGENAME/bin/plugins\n+cp -r $MXEROOT/qt5/plugins/printsupport $BUILDROOT/out/$PACKAGENAME/bin/plugins\n+cp -r $MXEROOT/qt5/plugins/platforms $BUILDROOT/out/$PACKAGENAME/bin/\n+\n+cp -r $MXEROOT/qt5/translations $BUILDROOT/out/$PACKAGENAME/bin/\n+\n+cp -r $MXEROOT/share/color $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/color-schemes $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/kf5 $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/krita $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/locale $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/mime $BUILDROOT/out/$PACKAGENAME/share\n+cp -r $MXEROOT/share/ocio $BUILDROOT/out/$PACKAGENAME/share\n+\n+rm krita-3.0-l10n-win-current.tar.gz || true\n+rm -rf locale\n+\n+wget http://nonaynever.ru/pub/l10n-win/krita-3.0-l10n-win-current.tar.gz\n+tar -xf krita-3.0-l10n-win-current.tar.gz\n+cp -r $BUILDROOT/locale $BUILDROOT/out/$PACKAGENAME/share\n+\n+cd $BUILDROOT/out/\n+\n+zip -r $PACKAGENAME.zip $PACKAGENAME"}]}, {"sha": "09391b08a2e84c46fd1b981e67ef925fa35ad31a", "stats": {"total": 6, "additions": 0, "deletions": 6}, "files": [{"sha": "aa2fcda87b9b1099db23dfeb227fee5758682c9a", "filename": "krita/data/input/CMakeLists.txt", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/09391b08a2e84c46fd1b981e67ef925fa35ad31a/krita/data/input/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/09391b08a2e84c46fd1b981e67ef925fa35ad31a/krita/data/input/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/data/input/CMakeLists.txt?ref=09391b08a2e84c46fd1b981e67ef925fa35ad31a", "patch": "@@ -9,12 +9,6 @@ install(FILES\n     kritadefault.profile\n     painttoolsaicompatible.profile\n     photoshopcompatible.profile\n-    DESTINATION ${DATA_INSTALL_DIR}/kritaanimation/input\n-)\n-install(FILES\n-    kritadefault.profile\n-    painttoolsaicompatible.profile\n-    photoshopcompatible.profile\n     DESTINATION  ${DATA_INSTALL_DIR}/kritagemini/input\n )\n "}]}, {"sha": "b321cbf103718f3d59e63fb88ad08b67f1a4cc7f", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "a0b760eae2826650f7b0aa2c7c626869b0c3057c", "filename": "README.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/b321cbf103718f3d59e63fb88ad08b67f1a4cc7f/README.md", "raw_url": "https://github.com/KDE/krita/raw/b321cbf103718f3d59e63fb88ad08b67f1a4cc7f/README.md", "contents_url": "https://api.github.com/repos/KDE/krita/contents/README.md?ref=b321cbf103718f3d59e63fb88ad08b67f1a4cc7f", "patch": "@@ -7,7 +7,7 @@ code repository is provided by KDE:  https://phabricator.kde.org/diffusion/KRITA\n \n This repository contains the current, Qt5-based, development version of Krita. The Krita 2.9 repository is located from KDE: https://phabricator.kde.org/diffusion/CALLIGRA/\n \n-![Picture] (https://krita.org/wp-content/uploads/2015/12/user-interface.png)\n+![Picture] (https://krita.org/wp-content/uploads/2016/04/krita-30-screenshot.jpg)\n \n \n ### User Manual"}]}, {"sha": "29718fd07f10e0ff977c21a256a3ed87b4c7ff50", "stats": {"total": 8, "additions": 4, "deletions": 4}, "files": [{"sha": "fdebed5180ec5e41889559fd325600906f2b3032", "filename": "libs/widgetutils/xmlgui/kedittoolbar.cpp", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/29718fd07f10e0ff977c21a256a3ed87b4c7ff50/libs/widgetutils/xmlgui/kedittoolbar.cpp", "raw_url": "https://github.com/KDE/krita/raw/29718fd07f10e0ff977c21a256a3ed87b4c7ff50/libs/widgetutils/xmlgui/kedittoolbar.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/xmlgui/kedittoolbar.cpp?ref=29718fd07f10e0ff977c21a256a3ed87b4c7ff50", "patch": "@@ -1053,23 +1053,23 @@ void KEditToolBarWidgetPrivate::setupLayout()\n     // The buttons in the middle\n \n     m_upAction     = new QToolButton(m_widget);\n-    m_upAction->setIcon(KisIconUtils::loadIcon(QStringLiteral(\"go-up\")));\n+    m_upAction->setIcon(KisIconUtils::loadIcon(QStringLiteral(\"arrow-up\")));\n     m_upAction->setEnabled(false);\n     m_upAction->setAutoRepeat(true);\n     QObject::connect(m_upAction, SIGNAL(clicked()), m_widget, SLOT(slotUpButton()));\n \n     m_insertAction = new QToolButton(m_widget);\n-    m_insertAction->setIcon(KisIconUtils::loadIcon(QApplication::isRightToLeft() ? QStringLiteral(\"go-previous\") : QLatin1String(\"go-next\")));\n+    m_insertAction->setIcon(KisIconUtils::loadIcon(QApplication::isRightToLeft() ? QStringLiteral(\"arrow-left\") : QLatin1String(\"arrow-right\")));\n     m_insertAction->setEnabled(false);\n     QObject::connect(m_insertAction, SIGNAL(clicked()), m_widget, SLOT(slotInsertButton()));\n \n     m_removeAction = new QToolButton(m_widget);\n-    m_removeAction->setIcon(KisIconUtils::loadIcon(QApplication::isRightToLeft() ? QStringLiteral(\"go-next\") : QLatin1String(\"go-previous\")));\n+    m_removeAction->setIcon(KisIconUtils::loadIcon(QApplication::isRightToLeft() ? QStringLiteral(\"arrow-right\") : QLatin1String(\"arrow-left\")));\n     m_removeAction->setEnabled(false);\n     QObject::connect(m_removeAction, SIGNAL(clicked()), m_widget, SLOT(slotRemoveButton()));\n \n     m_downAction   = new QToolButton(m_widget);\n-    m_downAction->setIcon(KisIconUtils::loadIcon(QStringLiteral(\"go-down\")));\n+    m_downAction->setIcon(KisIconUtils::loadIcon(QStringLiteral(\"arrow-down\")));\n     m_downAction->setEnabled(false);\n     m_downAction->setAutoRepeat(true);\n     QObject::connect(m_downAction, SIGNAL(clicked()), m_widget, SLOT(slotDownButton()));"}]}, {"sha": "00d208c17d79c63509b9bcd51524216144c8ef15", "stats": {"total": 5, "additions": 4, "deletions": 1}, "files": [{"sha": "e203744fc9cc0363295320020818bbb011cb789d", "filename": "plugins/filters/colorsfilters/kis_brightness_contrast_filter.cpp", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/00d208c17d79c63509b9bcd51524216144c8ef15/plugins/filters/colorsfilters/kis_brightness_contrast_filter.cpp", "raw_url": "https://github.com/KDE/krita/raw/00d208c17d79c63509b9bcd51524216144c8ef15/plugins/filters/colorsfilters/kis_brightness_contrast_filter.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/colorsfilters/kis_brightness_contrast_filter.cpp?ref=00d208c17d79c63509b9bcd51524216144c8ef15", "patch": "@@ -231,8 +231,11 @@ KisBrightnessContrastConfigWidget::KisBrightnessContrastConfigWidget(QWidget * p\n \n     KoHistogramProducer *producer = new KoGenericLabHistogramProducer();\n     KisHistogram histogram(dev, dev->exactBounds(), producer, LINEAR);\n+\n+    QPalette appPalette = QApplication::palette();\n     QPixmap pix(256, height);\n-    pix.fill();\n+    pix.fill(QColor(appPalette.color(QPalette::Base)));\n+\n     QPainter p(&pix);\n     p.setPen(QPen(Qt::gray, 1, Qt::SolidLine));\n "}]}, {"sha": "1e2bb9e67ebbb97cb45faa6bf5ce5e0f4540af9c", "stats": {"total": 4, "additions": 3, "deletions": 1}, "files": [{"sha": "db89b1d131ea121e757923a38fd4b5caf8874470", "filename": "plugins/filters/levelfilter/kis_level_filter.cpp", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/1e2bb9e67ebbb97cb45faa6bf5ce5e0f4540af9c/plugins/filters/levelfilter/kis_level_filter.cpp", "raw_url": "https://github.com/KDE/krita/raw/1e2bb9e67ebbb97cb45faa6bf5ce5e0f4540af9c/plugins/filters/levelfilter/kis_level_filter.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/levelfilter/kis_level_filter.cpp?ref=1e2bb9e67ebbb97cb45faa6bf5ce5e0f4540af9c", "patch": "@@ -163,8 +163,10 @@ void KisLevelConfigWidget::slotDrawHistogram(bool logarithmic)\n         m_histlog = logarithmic;\n     }\n \n+    QPalette appPalette = QApplication::palette();\n     QPixmap pix(wWidth-100, wHeight);\n-    pix.fill();\n+\n+    pix.fill(QColor(appPalette.color(QPalette::Base)));\n     QPainter p(&pix);\n \n     p.setPen(QPen(Qt::gray, 1, Qt::SolidLine));"}]}, {"sha": "6e082abfcc9fb40289862b07dbe1fed0efbd0ef4", "stats": {"total": 6, "additions": 5, "deletions": 1}, "files": [{"sha": "cb6e0e33773be09a5901a586e922ae201e98cae9", "filename": "libs/ui/widgets/kis_curve_widget_p.h", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/6e082abfcc9fb40289862b07dbe1fed0efbd0ef4/libs/ui/widgets/kis_curve_widget_p.h", "raw_url": "https://github.com/KDE/krita/raw/6e082abfcc9fb40289862b07dbe1fed0efbd0ef4/libs/ui/widgets/kis_curve_widget_p.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/widgets/kis_curve_widget_p.h?ref=6e082abfcc9fb40289862b07dbe1fed0efbd0ef4", "patch": "@@ -19,6 +19,8 @@\n #ifndef _KIS_CURVE_WIDGET_P_H_\n #define _KIS_CURVE_WIDGET_P_H_\n #include <kis_cubic_curve.h>\n+#include <QApplication>\n+#include <QPalette>\n \n enum enumState {\n     ST_NORMAL,\n@@ -202,7 +204,9 @@ void KisCurveWidget::Private::drawGrid(QPainter &p, int wWidth, int wHeight)\n      * That is not mandatory but desirable\n      */\n \n-    p.setPen(QPen(Qt::gray, 1, Qt::SolidLine));\n+    QPalette appPalette = QApplication::palette();\n+\n+    p.setPen(QPen(appPalette.color(QPalette::Background), 1, Qt::SolidLine));\n     p.drawLine(div4_round(wWidth), 0, div4_round(wWidth), wHeight);\n     p.drawLine(div2_round(wWidth), 0, div2_round(wWidth), wHeight);\n     p.drawLine(div4_round(3*wWidth), 0, div4_round(3*wWidth), wHeight);"}]}, {"sha": "edc331060bcc0206e9e2ac6867b298df95fca060", "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "c574f8907f39491622fd0239ac17422ddfe33640", "filename": "libs/ui/widgets/kis_curve_widget.cpp", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/edc331060bcc0206e9e2ac6867b298df95fca060/libs/ui/widgets/kis_curve_widget.cpp", "raw_url": "https://github.com/KDE/krita/raw/edc331060bcc0206e9e2ac6867b298df95fca060/libs/ui/widgets/kis_curve_widget.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/widgets/kis_curve_widget.cpp?ref=edc331060bcc0206e9e2ac6867b298df95fca060", "patch": "@@ -324,11 +324,11 @@ void KisCurveWidget::paintEvent(QPaintEvent *)\n             curveY = d->m_curve.points().at(i).y();\n \n             if (i == d->m_grab_point_index) {\n-                p.setPen(QPen(Qt::red, 3, Qt::SolidLine));\n+                p.setPen(QPen(appPalette.color(QPalette::Text), 6, Qt::SolidLine));\n                 p.drawEllipse(QRectF(curveX * wWidth - 2,\n                                      wHeight - 2 - curveY * wHeight, 4, 4));\n             } else {\n-                p.setPen(QPen(Qt::red, 1, Qt::SolidLine));\n+                p.setPen(QPen(appPalette.color(QPalette::Text), 2, Qt::SolidLine));\n                 p.drawEllipse(QRectF(curveX * wWidth - 3,\n                                      wHeight - 3 - curveY * wHeight, 6, 6));\n             }"}]}, {"sha": "ffbb54b0d22cf7198be1e56d7de60beaace0cb66", "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "fbcf1925f881433bf21980381ab09c7f9d9f97e2", "filename": "libs/ui/widgets/kis_curve_widget.cpp", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/KDE/krita/blob/ffbb54b0d22cf7198be1e56d7de60beaace0cb66/libs/ui/widgets/kis_curve_widget.cpp", "raw_url": "https://github.com/KDE/krita/raw/ffbb54b0d22cf7198be1e56d7de60beaace0cb66/libs/ui/widgets/kis_curve_widget.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/widgets/kis_curve_widget.cpp?ref=ffbb54b0d22cf7198be1e56d7de60beaace0cb66", "patch": "@@ -37,6 +37,7 @@\n #include <QKeyEvent>\n #include <QPaintEvent>\n #include <QList>\n+#include <QApplication>\n \n #include <QSpinBox>\n \n@@ -262,13 +263,15 @@ void KisCurveWidget::paintEvent(QPaintEvent *)\n \n     QPainter p(this);\n \n+    QPalette appPalette = QApplication::palette();\n+\n     // Antialiasing is not a good idea here, because\n     // the grid will drift one pixel to any side due to rounding of int\n     // FIXME: let's user tell the last word (in config)\n     //p.setRenderHint(QPainter::Antialiasing);\n \n     // fill with color to show widget bounds\n-     p.fillRect(rect(), palette().base());\n+     p.fillRect(rect(), appPalette.color(QPalette::Base));\n \n     //  draw background\n     if (!d->m_pix.isNull()) {\n@@ -297,7 +300,7 @@ void KisCurveWidget::paintEvent(QPaintEvent *)\n \n     QPolygonF poly;\n \n-    p.setPen(QPen(Qt::black, 1, Qt::SolidLine));\n+    p.setPen(QPen(appPalette.color(QPalette::Text), 2, Qt::SolidLine));\n     for (x = 0 ; x < wWidth ; x++) {\n         normalizedX = double(x) / wWidth;\n         curY = wHeight - d->m_curve.value(normalizedX) * wHeight;"}]}, {"sha": "e87f37d788a258d661924026d031c7f49c91042e", "stats": {"total": 6, "additions": 5, "deletions": 1}, "files": [{"sha": "da5bb53c035f95ebcb83e070e8c1b8b64c9cfdd7", "filename": "plugins/filters/colorsfilters/kis_perchannel_filter.cpp", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/e87f37d788a258d661924026d031c7f49c91042e/plugins/filters/colorsfilters/kis_perchannel_filter.cpp", "raw_url": "https://github.com/KDE/krita/raw/e87f37d788a258d661924026d031c7f49c91042e/plugins/filters/colorsfilters/kis_perchannel_filter.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/colorsfilters/kis_perchannel_filter.cpp?ref=e87f37d788a258d661924026d031c7f49c91042e", "patch": "@@ -170,7 +170,11 @@ inline QPixmap KisPerChannelConfigWidget::getHistogram()\n     int i;\n     int height = 256;\n     QPixmap pix(256, height);\n-    pix.fill();\n+\n+    QPalette appPalette = QApplication::palette();\n+\n+    pix.fill(QColor(appPalette.color(QPalette::Base)));\n+\n     QPainter p(&pix);\n     p.setPen(QPen(Qt::gray, 1, Qt::SolidLine));\n "}]}, {"sha": "4e1b639433c5f41ed774ca794730f0c9b44eabd9", "stats": {"total": 5, "additions": 5, "deletions": 0}, "files": [{"sha": "30823a0530e19e3977223a1208390616d71ed00f", "filename": "libs/widgets/KoRuler.cpp", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/4e1b639433c5f41ed774ca794730f0c9b44eabd9/libs/widgets/KoRuler.cpp", "raw_url": "https://github.com/KDE/krita/raw/4e1b639433c5f41ed774ca794730f0c9b44eabd9/libs/widgets/KoRuler.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgets/KoRuler.cpp?ref=4e1b639433c5f41ed774ca794730f0c9b44eabd9", "patch": "@@ -141,6 +141,9 @@ QRectF HorizontalPaintingStrategy::drawBackground(const KoRulerPrivate *d, QPain\n     activeRangeRectangle.setHeight(rectangle.height() - 2);\n \n     painter.setPen(d->ruler->palette().color(QPalette::Mid));\n+\n+\n+    painter.fillRect(rectangle,d->ruler->palette().color(QPalette::AlternateBase)); // make background slightly different so it is easier to see\n     painter.drawRect(rectangle);\n \n     if(d->effectiveActiveRangeStart() != d->effectiveActiveRangeEnd())\n@@ -457,6 +460,8 @@ QRectF VerticalPaintingStrategy::drawBackground(const KoRulerPrivate *d, QPainte\n         d->viewConverter->documentToViewY(d->effectiveActiveRangeEnd()) + d->offset));\n \n     painter.setPen(d->ruler->palette().color(QPalette::Mid));\n+\n+    painter.fillRect(rectangle,d->ruler->palette().color(QPalette::AlternateBase));\n     painter.drawRect(rectangle);\n \n     if(d->effectiveActiveRangeStart() != d->effectiveActiveRangeEnd())"}]}, {"sha": "dfa67d5644623d54dd115bcc96aa8cb280e46d42", "stats": {"total": 4, "additions": 3, "deletions": 1}, "files": [{"sha": "d583a5fa12b3ff36063627d615596c565055364b", "filename": "libs/ui/widgets/kis_color_label_selector_widget.cpp", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/dfa67d5644623d54dd115bcc96aa8cb280e46d42/libs/ui/widgets/kis_color_label_selector_widget.cpp", "raw_url": "https://github.com/KDE/krita/raw/dfa67d5644623d54dd115bcc96aa8cb280e46d42/libs/ui/widgets/kis_color_label_selector_widget.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/widgets/kis_color_label_selector_widget.cpp?ref=dfa67d5644623d54dd115bcc96aa8cb280e46d42", "patch": "@@ -251,9 +251,11 @@ void drawToolButton(QWidget *widget, const QRect &rc, State state, const QColor\n \n         p.fillRect(colorBlobRect, fillColor);\n     } else {\n+\n+        // draw an X for no color for the first item\n         QRect crossRect = kisGrowRect(colorBlobRect, -offset);\n \n-        QColor shade = opt.palette.dark().color();\n+        QColor shade = opt.palette.text().color();\n         p.setPen(QPen(shade, 2));\n         p.drawLine(crossRect.topLeft(), crossRect.bottomRight());\n         p.drawLine(crossRect.bottomLeft(), crossRect.topRight());"}]}, {"sha": "9c0b6591ac3cb1564ba95b54f0adfe53f7d2b473", "stats": {"total": 17, "additions": 17, "deletions": 0}, "files": [{"sha": "8dae5a3a4fe317cfe8bd74d2b47e818e08685c1c", "filename": "libs/image/kis_image_interfaces.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/9c0b6591ac3cb1564ba95b54f0adfe53f7d2b473/libs/image/kis_image_interfaces.h", "raw_url": "https://github.com/KDE/krita/raw/9c0b6591ac3cb1564ba95b54f0adfe53f7d2b473/libs/image/kis_image_interfaces.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_image_interfaces.h?ref=9c0b6591ac3cb1564ba95b54f0adfe53f7d2b473", "patch": "@@ -54,6 +54,9 @@ class KRITAIMAGE_EXPORT KisUpdatesFacade\n     virtual void refreshGraphAsync(KisNodeSP root = 0) = 0;\n     virtual void refreshGraphAsync(KisNodeSP root, const QRect &rc) = 0;\n     virtual void refreshGraphAsync(KisNodeSP root, const QRect &rc, const QRect &cropRect) = 0;\n+\n+    virtual void setProjectionUpdatesFilter(KisProjectionUpdatesFilterSP filter) = 0;\n+    virtual KisProjectionUpdatesFilterSP projectionUpdatesFilter() const = 0;\n };\n \n class KRITAIMAGE_EXPORT KisProjectionUpdateListener"}, {"sha": "b611faa026a9caef3f04008f3e60d90ee5d2ebf3", "filename": "libs/ui/tool/strokes/kis_filter_stroke_strategy.cpp", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/KDE/krita/blob/9c0b6591ac3cb1564ba95b54f0adfe53f7d2b473/libs/ui/tool/strokes/kis_filter_stroke_strategy.cpp", "raw_url": "https://github.com/KDE/krita/raw/9c0b6591ac3cb1564ba95b54f0adfe53f7d2b473/libs/ui/tool/strokes/kis_filter_stroke_strategy.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/tool/strokes/kis_filter_stroke_strategy.cpp?ref=9c0b6591ac3cb1564ba95b54f0adfe53f7d2b473", "patch": "@@ -166,14 +166,28 @@ void KisFilterStrokeStrategy::cancelStrokeCallback()\n     delete m_d->secondaryTransaction;\n     m_d->filterDevice = 0;\n \n+    KisProjectionUpdatesFilterSP prevUpdatesFilter;\n+\n     if (m_d->cancelSilently) {\n+        /**\n+         * TODO: Projection updates filter is not recursive, please\n+         *       redesign this part\n+         */\n+        prevUpdatesFilter = m_d->updatesFacade->projectionUpdatesFilter();\n+        if (prevUpdatesFilter) {\n+            m_d->updatesFacade->setProjectionUpdatesFilter(KisProjectionUpdatesFilterSP());\n+        }\n         m_d->updatesFacade->disableDirtyRequests();\n     }\n \n     KisPainterBasedStrokeStrategy::cancelStrokeCallback();\n \n     if (m_d->cancelSilently) {\n         m_d->updatesFacade->enableDirtyRequests();\n+        if (prevUpdatesFilter) {\n+            m_d->updatesFacade->setProjectionUpdatesFilter(prevUpdatesFilter);\n+            prevUpdatesFilter.clear();\n+        }\n     }\n }\n "}]}, {"sha": "006eb79faf8e3239addf632606b3d54dc27eb8a3", "stats": {"total": 8, "additions": 6, "deletions": 2}, "files": [{"sha": "4f6366f7bcabe18989f355b1d69b451f1fc8cc6e", "filename": "libs/image/kis_paint_device.cc", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/006eb79faf8e3239addf632606b3d54dc27eb8a3/libs/image/kis_paint_device.cc", "raw_url": "https://github.com/KDE/krita/raw/006eb79faf8e3239addf632606b3d54dc27eb8a3/libs/image/kis_paint_device.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_paint_device.cc?ref=006eb79faf8e3239addf632606b3d54dc27eb8a3", "patch": "@@ -118,9 +118,9 @@ struct KisPaintDevice::Private\n \n         if (!copyFrames) {\n             if (m_data) {\n-                m_data->prepareClone(rhs->currentData(), true);\n+                m_data->prepareClone(rhs->currentNonLodData(), true);\n             } else {\n-                m_data = toQShared(new KisPaintDeviceData(rhs->currentData(), true));\n+                m_data = toQShared(new KisPaintDeviceData(rhs->currentNonLodData(), true));\n             }\n         } else {\n             if (m_data && !rhs->m_data) {\n@@ -141,6 +141,10 @@ struct KisPaintDevice::Private\n                 }\n             }\n         }\n+\n+        if (rhs->m_lodData) {\n+            m_lodData.reset(new KisPaintDeviceData(rhs->m_lodData.data(), true));\n+        }\n     }\n \n     void prepareClone(KisPaintDeviceSP src)"}]}, {"sha": "39ce4e79e84658fb5414a314d3ba08293a484643", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "2a61fdccf4eea167e6d4669a99bfcda56c53dc3e", "filename": "plugins/paintops/defaultpaintops/duplicate/kis_duplicateop_settings.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/39ce4e79e84658fb5414a314d3ba08293a484643/plugins/paintops/defaultpaintops/duplicate/kis_duplicateop_settings.cpp", "raw_url": "https://github.com/KDE/krita/raw/39ce4e79e84658fb5414a314d3ba08293a484643/plugins/paintops/defaultpaintops/duplicate/kis_duplicateop_settings.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/defaultpaintops/duplicate/kis_duplicateop_settings.cpp?ref=39ce4e79e84658fb5414a314d3ba08293a484643", "patch": "@@ -123,7 +123,7 @@ void KisDuplicateOpSettings::toXML(QDomDocument& doc, QDomElement& rootElt) cons\n \n KisPaintOpSettingsSP KisDuplicateOpSettings::clone() const\n {\n-    KisPaintOpSettingsSP setting = KisPaintOpSettings::clone();\n+    KisPaintOpSettingsSP setting = KisBrushBasedPaintOpSettings::clone();\n     KisDuplicateOpSettings* s = dynamic_cast<KisDuplicateOpSettings*>(setting.data());\n     s->m_offset = m_offset;\n     s->m_isOffsetNotUptodate = m_isOffsetNotUptodate;"}]}, {"sha": "e6c23b2765dd007b7b10ec480036d657d443d159", "stats": {"total": 39, "additions": 23, "deletions": 16}, "files": [{"sha": "2d21acb32495243585720c5f69526444049954f0", "filename": "libs/ui/kis_aspect_ratio_locker.cpp", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/e6c23b2765dd007b7b10ec480036d657d443d159/libs/ui/kis_aspect_ratio_locker.cpp", "raw_url": "https://github.com/KDE/krita/raw/e6c23b2765dd007b7b10ec480036d657d443d159/libs/ui/kis_aspect_ratio_locker.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kis_aspect_ratio_locker.cpp?ref=e6c23b2765dd007b7b10ec480036d657d443d159", "patch": "@@ -66,6 +66,7 @@ void KisAspectRatioLocker::slotSpinOneChanged()\n         KisSignalsBlocker b(m_d->spinTwo);\n         m_d->spinTwo->setValue(qRound(m_d->aspectRatio * m_d->spinOne->value()));\n     }\n+    emit sliderValueChanged();\n }\n \n void KisAspectRatioLocker::slotSpinTwoChanged()\n@@ -74,6 +75,8 @@ void KisAspectRatioLocker::slotSpinTwoChanged()\n         KisSignalsBlocker b(m_d->spinOne);\n         m_d->spinOne->setValue(qRound(m_d->spinTwo->value() / m_d->aspectRatio));\n     }\n+\n+    emit sliderValueChanged();\n }\n \n void KisAspectRatioLocker::slotAspectButtonChanged()\n@@ -86,4 +89,6 @@ void KisAspectRatioLocker::slotAspectButtonChanged()\n     } else {\n         m_d->aspectRatio = 1.0;\n     }\n+\n+    emit aspectButtonChanged();\n }"}, {"sha": "191461c1490ad99658372977e16211816cc75cc0", "filename": "libs/ui/kis_aspect_ratio_locker.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/e6c23b2765dd007b7b10ec480036d657d443d159/libs/ui/kis_aspect_ratio_locker.h", "raw_url": "https://github.com/KDE/krita/raw/e6c23b2765dd007b7b10ec480036d657d443d159/libs/ui/kis_aspect_ratio_locker.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kis_aspect_ratio_locker.h?ref=e6c23b2765dd007b7b10ec480036d657d443d159", "patch": "@@ -41,6 +41,10 @@ private Q_SLOTS:\n     void slotSpinTwoChanged();\n     void slotAspectButtonChanged();\n \n+Q_SIGNALS:\n+    void sliderValueChanged();\n+    void aspectButtonChanged();\n+\n private:\n     struct Private;\n     const QScopedPointer<Private> m_d;"}, {"sha": "02ba73e933acdda0d0a3a10bed3b7c30a411cfae", "filename": "plugins/dockers/griddocker/grid_config_widget.cpp", "status": "modified", "additions": 6, "deletions": 8, "changes": 14, "blob_url": "https://github.com/KDE/krita/blob/e6c23b2765dd007b7b10ec480036d657d443d159/plugins/dockers/griddocker/grid_config_widget.cpp", "raw_url": "https://github.com/KDE/krita/raw/e6c23b2765dd007b7b10ec480036d657d443d159/plugins/dockers/griddocker/grid_config_widget.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/griddocker/grid_config_widget.cpp?ref=e6c23b2765dd007b7b10ec480036d657d443d159", "patch": "@@ -67,14 +67,6 @@ GridConfigWidget::GridConfigWidget(QWidget *parent) :\n     connect(ui->chkSnapToGuides, SIGNAL(stateChanged(int)), SLOT(slotGuidesGuiChanged()));\n     connect(ui->chkLockGuides, SIGNAL(stateChanged(int)), SLOT(slotGuidesGuiChanged()));\n \n-    connect(ui->intHSpacing, SIGNAL(valueChanged(int)), SLOT(slotGridGuiChanged()));\n-    connect(ui->intVSpacing, SIGNAL(valueChanged(int)), SLOT(slotGridGuiChanged()));\n-    connect(ui->spacingAspectButton, SIGNAL(keepAspectRatioChanged(bool)), SLOT(slotGridGuiChanged()));\n-\n-    connect(ui->intXOffset, SIGNAL(valueChanged(int)), SLOT(slotGridGuiChanged()));\n-    connect(ui->intYOffset, SIGNAL(valueChanged(int)), SLOT(slotGridGuiChanged()));\n-    connect(ui->offsetAspectButton, SIGNAL(keepAspectRatioChanged(bool)), SLOT(slotGridGuiChanged()));\n-\n     connect(ui->intSubdivision, SIGNAL(valueChanged(int)), SLOT(slotGridGuiChanged()));\n \n     connect(ui->selectMainStyle, SIGNAL(currentIndexChanged(int)), SLOT(slotGridGuiChanged()));\n@@ -91,6 +83,12 @@ GridConfigWidget::GridConfigWidget(QWidget *parent) :\n \n     KisAspectRatioLocker *spacingLocker = new KisAspectRatioLocker(this);\n     spacingLocker->connectSpinBoxes(ui->intHSpacing, ui->intVSpacing, ui->spacingAspectButton);\n+\n+    connect(offsetLocker, SIGNAL(sliderValueChanged()), SLOT(slotGridGuiChanged()));\n+    connect(offsetLocker, SIGNAL(aspectButtonChanged()), SLOT(slotGridGuiChanged()));\n+\n+    connect(spacingLocker, SIGNAL(sliderValueChanged()), SLOT(slotGridGuiChanged()));\n+    connect(spacingLocker, SIGNAL(aspectButtonChanged()), SLOT(slotGridGuiChanged()));\n }\n \n GridConfigWidget::~GridConfigWidget()"}, {"sha": "ede7f471c1503908a9b284baf23aba30c054d990", "filename": "plugins/dockers/griddocker/grid_config_widget.ui", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/KDE/krita/blob/e6c23b2765dd007b7b10ec480036d657d443d159/plugins/dockers/griddocker/grid_config_widget.ui", "raw_url": "https://github.com/KDE/krita/raw/e6c23b2765dd007b7b10ec480036d657d443d159/plugins/dockers/griddocker/grid_config_widget.ui", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/griddocker/grid_config_widget.ui?ref=e6c23b2765dd007b7b10ec480036d657d443d159", "patch": "@@ -68,7 +68,7 @@\n               <string> px</string>\n              </property>\n              <property name=\"minimum\">\n-              <number>2</number>\n+              <number>1</number>\n              </property>\n              <property name=\"maximum\">\n               <number>500</number>\n@@ -91,7 +91,7 @@\n               <string> px</string>\n              </property>\n              <property name=\"minimum\">\n-              <number>2</number>\n+              <number>1</number>\n              </property>\n              <property name=\"maximum\">\n               <number>500</number>\n@@ -238,14 +238,14 @@\n              <property name=\"text\">\n               <string/>\n              </property>\n-             <property name=\"color\">\n+             <property name=\"color\" stdset=\"0\">\n               <color>\n                <red>0</red>\n                <green>0</green>\n                <blue>0</blue>\n               </color>\n              </property>\n-             <property name=\"defaultColor\">\n+             <property name=\"defaultColor\" stdset=\"0\">\n               <color>\n                <red>0</red>\n                <green>0</green>\n@@ -307,14 +307,14 @@\n              <property name=\"text\">\n               <string/>\n              </property>\n-             <property name=\"color\">\n+             <property name=\"color\" stdset=\"0\">\n               <color>\n                <red>0</red>\n                <green>0</green>\n                <blue>0</blue>\n               </color>\n              </property>\n-             <property name=\"defaultColor\">\n+             <property name=\"defaultColor\" stdset=\"0\">\n               <color>\n                <red>0</red>\n                <green>0</green>\n@@ -431,14 +431,14 @@\n              <property name=\"text\">\n               <string/>\n              </property>\n-             <property name=\"color\">\n+             <property name=\"color\" stdset=\"0\">\n               <color>\n                <red>0</red>\n                <green>0</green>\n                <blue>0</blue>\n               </color>\n              </property>\n-             <property name=\"defaultColor\">\n+             <property name=\"defaultColor\" stdset=\"0\">\n               <color>\n                <red>0</red>\n                <green>0</green>"}]}, {"sha": "0bbe01be4395e41b88401d0c6552284cbc387b1d", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "b4b50d6ff0a7d81eb3f1c65875929a7cc339ec59", "filename": "libs/image/kis_selection_based_layer.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/0bbe01be4395e41b88401d0c6552284cbc387b1d/libs/image/kis_selection_based_layer.cpp", "raw_url": "https://github.com/KDE/krita/raw/0bbe01be4395e41b88401d0c6552284cbc387b1d/libs/image/kis_selection_based_layer.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_selection_based_layer.cpp?ref=0bbe01be4395e41b88401d0c6552284cbc387b1d", "patch": "@@ -182,7 +182,7 @@ void KisSelectionBasedLayer::resetCache(const KoColorSpace *colorSpace)\n     if (!m_d->paintDevice ||\n             !(*m_d->paintDevice->colorSpace() == *colorSpace)) {\n \n-        m_d->paintDevice = new KisPaintDevice(colorSpace);\n+        m_d->paintDevice = new KisPaintDevice(this, colorSpace, new KisDefaultBounds(image()));\n     } else {\n         m_d->paintDevice->clear();\n     }"}]}, {"sha": "cb342ec320ad79c07c9d8963895ff963f841eb3f", "stats": {"total": 102, "additions": 24, "deletions": 78}, "files": [{"sha": "f26e9141e91ea1ec6aa70208d2e5cc9d7fdf090d", "filename": "libs/flake/KoSnapGuide.cpp", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/cb342ec320ad79c07c9d8963895ff963f841eb3f/libs/flake/KoSnapGuide.cpp", "raw_url": "https://github.com/KDE/krita/raw/cb342ec320ad79c07c9d8963895ff963f841eb3f/libs/flake/KoSnapGuide.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/flake/KoSnapGuide.cpp?ref=cb342ec320ad79c07c9d8963895ff963f841eb3f", "patch": "@@ -127,10 +127,7 @@ bool KoSnapGuide::addCustomSnapStrategy(KoSnapStrategy *customStrategy)\n \n void KoSnapGuide::overrideSnapStrategy(Strategy type, KoSnapStrategy *strategy)\n {\n-    Private::StrategiesList::iterator it = d->strategies.begin();\n-    Private::StrategiesList::iterator end = d->strategies.end();\n-\n-    while (it != end) {\n+    for (auto it = d->strategies.begin(); it != d->strategies.end(); /*noop*/) {\n         if ((*it)->type() == type) {\n             if (strategy) {\n                 *it = toQShared(strategy);"}, {"sha": "125e5227f80eb96f14f67d0cc5eaf797a35d7758", "filename": "libs/image/kis_layer_utils.cpp", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/cb342ec320ad79c07c9d8963895ff963f841eb3f/libs/image/kis_layer_utils.cpp", "raw_url": "https://github.com/KDE/krita/raw/cb342ec320ad79c07c9d8963895ff963f841eb3f/libs/image/kis_layer_utils.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_layer_utils.cpp?ref=cb342ec320ad79c07c9d8963895ff963f841eb3f", "patch": "@@ -1031,9 +1031,7 @@ namespace KisLayerUtils {\n     {\n         QList<KisSelectionMaskSP> selectionMasks;\n \n-        KisNodeList::iterator it = mergedNodes.begin();\n-        KisNodeList::iterator end = mergedNodes.end();\n-        while (it != end) {\n+        for (auto it = mergedNodes.begin(); it != mergedNodes.end(); /*noop*/) {\n             KisSelectionMaskSP mask = dynamic_cast<KisSelectionMask*>(it->data());\n             if (!mask) {\n                 it = mergedNodes.erase(it);"}, {"sha": "5d2364e1c234ae734e32178b263061ff5b40b55d", "filename": "libs/image/kis_lod_transform.h", "status": "modified", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/cb342ec320ad79c07c9d8963895ff963f841eb3f/libs/image/kis_lod_transform.h", "raw_url": "https://github.com/KDE/krita/raw/cb342ec320ad79c07c9d8963895ff963f841eb3f/libs/image/kis_lod_transform.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_lod_transform.h?ref=cb342ec320ad79c07c9d8963895ff963f841eb3f", "patch": "@@ -82,17 +82,6 @@ class KRITAIMAGE_EXPORT KisLodTransform {\n         return pi;\n     }\n \n-    /*vQPointF map(vQPointF v) const {\n-        vQPointF::iterator it = v.begin();\n-        vQPointF::iterator end = v.end();\n-\n-        while (it != end) {\n-            *it = m_transform.map(*it);\n-        }\n-\n-        return v;\n-        }*/\n-\n     template <class T>\n     T map(const T &object) const {\n         return m_transform.map(object);"}, {"sha": "66b856ce5e97e6a5a0d30cb956e7b709a2221f28", "filename": "libs/image/kis_paint_device.cc", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/cb342ec320ad79c07c9d8963895ff963f841eb3f/libs/image/kis_paint_device.cc", "raw_url": "https://github.com/KDE/krita/raw/cb342ec320ad79c07c9d8963895ff963f841eb3f/libs/image/kis_paint_device.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_paint_device.cc?ref=cb342ec320ad79c07c9d8963895ff963f841eb3f", "patch": "@@ -1857,8 +1857,8 @@ KisPaintDeviceFramesInterface::testingGetDataObjects() const\n \n     typedef KisPaintDevice::Private::FramesHash FramesHash;\n \n-    FramesHash::iterator it = q->m_d->m_frames.begin();\n-    FramesHash::iterator end = q->m_d->m_frames.end();\n+    FramesHash::const_iterator it = q->m_d->m_frames.constBegin();\n+    FramesHash::const_iterator end = q->m_d->m_frames.constEnd();\n \n     for (; it != end; ++it) {\n         objects.m_frames.insert(it.key(), it.value().data());"}, {"sha": "44b148e73e69b167fe97cdf1fb1cbf0253dfd9f3", "filename": "libs/image/krita_utils.cpp", "status": "modified", "additions": 6, "deletions": 24, "changes": 30, "blob_url": "https://github.com/KDE/krita/blob/cb342ec320ad79c07c9d8963895ff963f841eb3f/libs/image/krita_utils.cpp", "raw_url": "https://github.com/KDE/krita/raw/cb342ec320ad79c07c9d8963895ff963f841eb3f/libs/image/krita_utils.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/krita_utils.cpp?ref=cb342ec320ad79c07c9d8963895ff963f841eb3f", "patch": "@@ -391,36 +391,18 @@ namespace KritaUtils\n                 continue;\n             }\n \n-            QList<QPainterPath>::iterator it = resultList.begin();\n-            QList<QPainterPath>::iterator end = resultList.end();\n-            QList<QPainterPath>::iterator savedIt = end;\n-\n-            bool wasMerged = false;\n-\n-            while (it != end) {\n-                bool skipIncrement = false;\n+            QPainterPath mergedPath = testPath;\n \n+            for (auto it = resultList.begin(); it != resultList.end(); /*noop*/) {\n                 if (it->intersects(testPath)) {\n-                    if (savedIt == end) {\n-                        it->addPath(testPath);\n-                        savedIt = it;\n-                    } else {\n-                        savedIt->addPath(*it);\n-                        it = resultList.erase(it);\n-                        skipIncrement = true;\n-                    }\n-\n-                    wasMerged = true;\n-                }\n-\n-                if (!skipIncrement) {\n+                    mergedPath.addPath(*it);\n+                    it = resultList.erase(it);\n+                } else {\n                     ++it;\n                 }\n             }\n \n-            if (!wasMerged) {\n-                resultList.append(testPath);\n-            }\n+            resultList.append(mergedPath);\n         }\n \n         return resultList;"}, {"sha": "330b2e67afb30d97b801524cc3f464f47d212186", "filename": "libs/image/recorder/kis_recorded_paint_action.cpp", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/KDE/krita/blob/cb342ec320ad79c07c9d8963895ff963f841eb3f/libs/image/recorder/kis_recorded_paint_action.cpp", "raw_url": "https://github.com/KDE/krita/raw/cb342ec320ad79c07c9d8963895ff963f841eb3f/libs/image/recorder/kis_recorded_paint_action.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/recorder/kis_recorded_paint_action.cpp?ref=cb342ec320ad79c07c9d8963895ff963f841eb3f", "patch": "@@ -306,11 +306,8 @@ void KisRecordedPaintAction::play(KisNodeSP node, const KisPlayInfo& info, KoUpd\n         painter2.setOpacity(d->opacity * 255);\n \n         QVector<QRect> dirtyRects = painter->takeDirtyRegion();\n-        QVector<QRect>::iterator it = dirtyRects.begin();\n-        QVector<QRect>::iterator end = dirtyRects.end();\n-        while (it != end) {\n-            painter2.bitBlt(it->topLeft(), target, *it);\n-            ++it;\n+        Q_FOREACH (const QRect &rc, dirtyRects) {\n+            painter2.bitBlt(rc.topLeft(), target, rc);\n         }\n \n         node->setDirty(painter2.takeDirtyRegion());"}, {"sha": "d4747e3bc51cde42bd838965433a503464f123bc", "filename": "libs/pigment/resources/KoColorSet.cpp", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/KDE/krita/blob/cb342ec320ad79c07c9d8963895ff963f841eb3f/libs/pigment/resources/KoColorSet.cpp", "raw_url": "https://github.com/KDE/krita/raw/cb342ec320ad79c07c9d8963895ff963f841eb3f/libs/pigment/resources/KoColorSet.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/resources/KoColorSet.cpp?ref=cb342ec320ad79c07c9d8963895ff963f841eb3f", "patch": "@@ -233,12 +233,9 @@ void KoColorSet::add(const KoColorSetEntry & c)\n \n void KoColorSet::remove(const KoColorSetEntry & c)\n {\n-    QVector<KoColorSetEntry>::iterator it = m_colors.begin();\n-    QVector<KoColorSetEntry>::iterator end = m_colors.end();\n-\n-    while (it != end) {\n+    for (auto it = m_colors.begin(); it != m_colors.end(); /*noop*/) {\n         if ((*it) == c) {\n-            m_colors.erase(it);\n+            it = m_colors.erase(it);\n             return;\n         }\n         ++it;"}, {"sha": "ff23241a09124c60311cd630b05a7fd5c5ba7fe0", "filename": "libs/ui/input/kis_input_manager.cpp", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/cb342ec320ad79c07c9d8963895ff963f841eb3f/libs/ui/input/kis_input_manager.cpp", "raw_url": "https://github.com/KDE/krita/raw/cb342ec320ad79c07c9d8963895ff963f841eb3f/libs/ui/input/kis_input_manager.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_input_manager.cpp?ref=cb342ec320ad79c07c9d8963895ff963f841eb3f", "patch": "@@ -186,10 +186,8 @@ bool KisInputManager::eventFilter(QObject* object, QEvent* event)\n     if (d->eventEater.eventFilter(object, event)) return false;\n \n     if (!d->matcher.hasRunningShortcut()) {\n-        Private::PriorityList::iterator it = d->priorityEventFilter.begin();\n-        Private::PriorityList::iterator end = d->priorityEventFilter.end();\n \n-        while (it != end) {\n+        for (auto it = d->priorityEventFilter.begin(); it != d->priorityEventFilter.end(); /*noop*/) {\n             const QPointer<QObject> &filter = it->second;\n \n             if (filter.isNull()) {"}, {"sha": "f4f1ca91e4a8b6a4101bf3bb1ed13ec8baac2149", "filename": "plugins/dockers/animation/timeline_docker.cpp", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/cb342ec320ad79c07c9d8963895ff963f841eb3f/plugins/dockers/animation/timeline_docker.cpp", "raw_url": "https://github.com/KDE/krita/raw/cb342ec320ad79c07c9d8963895ff963f841eb3f/plugins/dockers/animation/timeline_docker.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/animation/timeline_docker.cpp?ref=cb342ec320ad79c07c9d8963895ff963f841eb3f", "patch": "@@ -133,8 +133,8 @@ void TimelineDocker::setMainWindow(KisViewManager *view)\n \n     QMap<QString, KisAction*> actions = m_d->view->globalActions();\n \n-    QMap<QString, KisAction*>::iterator it = actions.begin();\n-    QMap<QString, KisAction*>::iterator end = actions.end();\n+    QMap<QString, KisAction*>::const_iterator it = actions.constBegin();\n+    QMap<QString, KisAction*>::const_iterator end = actions.constEnd();\n \n     for (; it != end; ++it) {\n         actionManager->addAction(it.key(), it.value());"}, {"sha": "86376b93f70dde8c9b9a3aaf02c08b8bd8595626", "filename": "plugins/dockers/animation/timeline_frames_view.cpp", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/cb342ec320ad79c07c9d8963895ff963f841eb3f/plugins/dockers/animation/timeline_frames_view.cpp", "raw_url": "https://github.com/KDE/krita/raw/cb342ec320ad79c07c9d8963895ff963f841eb3f/plugins/dockers/animation/timeline_frames_view.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/animation/timeline_frames_view.cpp?ref=cb342ec320ad79c07c9d8963895ff963f841eb3f", "patch": "@@ -775,10 +775,7 @@ void TimelineFramesView::slotRemoveFrame()\n {\n     QModelIndexList indexes = selectionModel()->selectedIndexes();\n \n-    QModelIndexList::iterator it = indexes.begin();\n-    QModelIndexList::iterator end = indexes.end();\n-\n-    while (it != end) {\n+    for (auto it = indexes.begin(); it != indexes.end(); /*noop*/) {\n         if (!m_d->model->data(*it, TimelineFramesModel::FrameEditableRole).toBool()) {\n             it = indexes.erase(it);\n         } else {"}, {"sha": "69291f26b24412b4a62b4664cce002b7b68103da", "filename": "plugins/impex/exr/exr_converter.cc", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/cb342ec320ad79c07c9d8963895ff963f841eb3f/plugins/impex/exr/exr_converter.cc", "raw_url": "https://github.com/KDE/krita/raw/cb342ec320ad79c07c9d8963895ff963f841eb3f/plugins/impex/exr/exr_converter.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/exr/exr_converter.cc?ref=cb342ec320ad79c07c9d8963895ff963f841eb3f", "patch": "@@ -684,8 +684,8 @@ KisImageBuilder_Result exrConverter::decode(const QString &filename)\n         else if (info.channelMap.size() == 2) {\n             modelId = GrayAColorModelID.id();\n \n-            QMap<QString,QString>::iterator it = info.channelMap.begin();\n-            QMap<QString,QString>::iterator end = info.channelMap.end();\n+            QMap<QString,QString>::const_iterator it = info.channelMap.constBegin();\n+            QMap<QString,QString>::const_iterator end = info.channelMap.constEnd();\n \n             QString failingChannelKey;\n "}, {"sha": "62f30c227d817ee31d2f882400315dfb5f5b91b8", "filename": "plugins/tools/tool_transform2/tool_transform_args.cc", "status": "modified", "additions": 4, "deletions": 13, "changes": 17, "blob_url": "https://github.com/KDE/krita/blob/cb342ec320ad79c07c9d8963895ff963f841eb3f/plugins/tools/tool_transform2/tool_transform_args.cc", "raw_url": "https://github.com/KDE/krita/raw/cb342ec320ad79c07c9d8963895ff963f841eb3f/plugins/tools/tool_transform2/tool_transform_args.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_transform2/tool_transform_args.cc?ref=cb342ec320ad79c07c9d8963895ff963f841eb3f", "patch": "@@ -206,22 +206,13 @@ void ToolTransformArgs::translate(const QPointF &offset)\n         m_rotationCenterOffset += offset;\n         m_transformedCenter += offset;\n     } else if(m_mode == WARP || m_mode == CAGE) {\n-        {\n-            QVector<QPointF>::iterator it = m_origPoints.begin();\n-            QVector<QPointF>::iterator end = m_origPoints.end();\n-            for (; it != end; ++it) {\n-                *it += offset;\n-            }\n+        for (auto &pt : m_origPoints) {\n+            pt += offset;\n         }\n \n-        {\n-            QVector<QPointF>::iterator it = m_transfPoints.begin();\n-            QVector<QPointF>::iterator end = m_transfPoints.end();\n-            for (; it != end; ++it) {\n-                *it += offset;\n-            }\n+        for (auto &pt : m_transfPoints) {\n+            pt += offset;\n         }\n-\n     } else if (m_mode == LIQUIFY) {\n         KIS_ASSERT_RECOVER_RETURN(m_liquifyWorker);\n         m_liquifyWorker->translate(offset);"}]}, {"sha": "44c827d715c018130689a686c27891f935654efc", "stats": {"total": 3, "additions": 1, "deletions": 2}, "files": [{"sha": "aee3071db74564374e800309587eb4915fbd9782", "filename": "libs/image/kis_stroke.cpp", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/44c827d715c018130689a686c27891f935654efc/libs/image/kis_stroke.cpp", "raw_url": "https://github.com/KDE/krita/raw/44c827d715c018130689a686c27891f935654efc/libs/image/kis_stroke.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_stroke.cpp?ref=44c827d715c018130689a686c27891f935654efc", "patch": "@@ -185,9 +185,8 @@ bool KisStroke::sanityCheckAllJobsAreCancellable() const\n void KisStroke::clearQueueOnCancel()\n {\n     QQueue<KisStrokeJob*>::iterator it = m_jobsQueue.begin();\n-    QQueue<KisStrokeJob*>::iterator end = m_jobsQueue.end();\n \n-    while (it != end) {\n+    while (it != m_jobsQueue.end()) {\n         if ((*it)->isCancellable()) {\n             delete (*it);\n             it = m_jobsQueue.erase(it);"}]}, {"sha": "2063e1698fb12d053e1e404b1ebcb6abd9f43fed", "stats": {"total": 14, "additions": 10, "deletions": 4}, "files": [{"sha": "344f003a55a0c3e637c120152774c48c464c8862", "filename": "libs/image/kis_stroke.cpp", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/KDE/krita/blob/2063e1698fb12d053e1e404b1ebcb6abd9f43fed/libs/image/kis_stroke.cpp", "raw_url": "https://github.com/KDE/krita/raw/2063e1698fb12d053e1e404b1ebcb6abd9f43fed/libs/image/kis_stroke.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_stroke.cpp?ref=2063e1698fb12d053e1e404b1ebcb6abd9f43fed", "patch": "@@ -144,11 +144,17 @@ void KisStroke::cancelStroke()\n \n     if(!m_strokeInitialized) {\n         /**\n-         * FIXME: this assert is probably a bit too optimistic,\n-         *        because the LODN stroke that suspends the other one\n-         *        can be easily non-initialized\n+         * Lod0 stroke cannot be suspended and !initialized at the\n+         * same time, because the suspend job is created iff the\n+         * stroke has already done some meaningful work.\n+         *\n+         * At the same time, LodN stroke can be prepended with a\n+         * 'suspend' job even when it has not been started yet. That\n+         * is obvious: we should suspend the other stroke before doing\n+         * anything else.\n          */\n-        KIS_ASSERT_RECOVER_NOOP(sanityCheckAllJobsAreCancellable());\n+        KIS_ASSERT_RECOVER_NOOP(type() == LODN ||\n+                                sanityCheckAllJobsAreCancellable());\n         clearQueueOnCancel();\n     }\n     else if(m_strokeInitialized &&"}]}, {"sha": "7ff525c263b2a0c78d6efd6ce385f5f04dd5165f", "stats": {"total": 12, "additions": 11, "deletions": 1}, "files": [{"sha": "5462baeaf0147696e8f30a8e8efe0971011c71cc", "filename": "libs/ui/KisMainWindow.cpp", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/KDE/krita/blob/7ff525c263b2a0c78d6efd6ce385f5f04dd5165f/libs/ui/KisMainWindow.cpp", "raw_url": "https://github.com/KDE/krita/raw/7ff525c263b2a0c78d6efd6ce385f5f04dd5165f/libs/ui/KisMainWindow.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisMainWindow.cpp?ref=7ff525c263b2a0c78d6efd6ce385f5f04dd5165f", "patch": "@@ -63,6 +63,7 @@\n #include <kedittoolbar.h>\n #include <khelpmenu.h>\n #include <klocalizedstring.h>\n+#include <kaboutdata.h>\n \n #ifdef HAVE_KIO\n #include <krecentdocument.h>\n@@ -395,7 +396,16 @@ KisMainWindow::KisMainWindow()\n \n \n     if (isHelpMenuEnabled() && !d->helpMenu) {\n-        d->helpMenu = new KHelpMenu(this, \"Dummy Text That Is Not Used In Frameworks 5\", false);\n+        // workaround for KHelpMenu (or rather KAboutData::applicationData()) internally\n+        // not using the Q*Application metadata ATM, which results e.g. in the bugreport wizard\n+        // not having the app version preset\n+        // fixed hopefully in KF5 5.22.0, patch pending\n+        QGuiApplication *app = qApp;\n+        KAboutData aboutData(app->applicationName(), app->applicationDisplayName(), app->applicationVersion());\n+        aboutData.setOrganizationDomain(app->organizationDomain().toUtf8());\n+        d->helpMenu = new KHelpMenu(this, aboutData, false);\n+        // workaround-less version:\n+        // d->helpMenu = new KHelpMenu(this, QString()/*unused*/, false);\n \n         // The difference between using KActionCollection->addAction() is that\n         // these actions do not get tied to the MainWindow.  What does this all do?"}]}, {"sha": "f0d33a1136dbb1a3cbaa452186598177a1d430cd", "stats": {"total": 27, "additions": 0, "deletions": 27}, "files": [{"sha": "9eb9f37255b45a38edde0ef60e3c5de12184530e", "filename": "krita/data/aboutdata/aboutdata.qrc", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/f0d33a1136dbb1a3cbaa452186598177a1d430cd/krita/data/aboutdata/aboutdata.qrc", "raw_url": "https://github.com/KDE/krita/raw/f0d33a1136dbb1a3cbaa452186598177a1d430cd/krita/data/aboutdata/aboutdata.qrc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/data/aboutdata/aboutdata.qrc?ref=f0d33a1136dbb1a3cbaa452186598177a1d430cd", "patch": "@@ -5,10 +5,5 @@\n         <file>credits.txt</file>\n         <file>developers.txt</file>\n         <file>LICENSE</file>\n-        <file>forumfooter.html</file>\n-        <file>forumheader.html</file>\n-        <file>links.html</file>\n-        <file>newsfooter.html</file>\n-        <file>newsheader.html</file>\n     </qresource>\n </RCC>"}, {"sha": "691287b6e353f56675fffd37fe96ead589956f33", "filename": "krita/data/aboutdata/forumfooter.html", "status": "removed", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/6b2491ede682f7206754925958549542436bb671/krita/data/aboutdata/forumfooter.html", "raw_url": "https://github.com/KDE/krita/raw/6b2491ede682f7206754925958549542436bb671/krita/data/aboutdata/forumfooter.html", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/data/aboutdata/forumfooter.html?ref=6b2491ede682f7206754925958549542436bb671", "patch": "@@ -1,2 +0,0 @@\n-</body>\n-</html>\n\\ No newline at end of file"}, {"sha": "d0daf356c9e21c3b2d3e866bbe91946dba78b7b2", "filename": "krita/data/aboutdata/forumheader.html", "status": "removed", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/6b2491ede682f7206754925958549542436bb671/krita/data/aboutdata/forumheader.html", "raw_url": "https://github.com/KDE/krita/raw/6b2491ede682f7206754925958549542436bb671/krita/data/aboutdata/forumheader.html", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/data/aboutdata/forumheader.html?ref=6b2491ede682f7206754925958549542436bb671", "patch": "@@ -1,3 +0,0 @@\n-<html>\n-<body>\n-<h1>Latest Forum Posts</h1>"}, {"sha": "a1d5c4716bd0fe3f3ee0455f4a9557791333662c", "filename": "krita/data/aboutdata/links.html", "status": "removed", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/KDE/krita/blob/6b2491ede682f7206754925958549542436bb671/krita/data/aboutdata/links.html", "raw_url": "https://github.com/KDE/krita/raw/6b2491ede682f7206754925958549542436bb671/krita/data/aboutdata/links.html", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/data/aboutdata/links.html?ref=6b2491ede682f7206754925958549542436bb671", "patch": "@@ -1,12 +0,0 @@\n-<html>\n-<body>\n-<p align=\"center\"><span style=\" color:%1;\"><b>Links</b></span></p>\n-<p><a href=\"https://krita.org/support-us/\"><span style=\" text-decoration: underline; color:%1;\">Support Krita</span></a></p>\"\n-<p><a href=\"https://docs.krita.org/Category:Getting_Started\"><span style=\" text-decoration: underline; color:%1;\">Getting Started</span></a></p>\"\n-<p><a href=\"https://docs.krita.org/\"><span style=\" text-decoration: underline; color:%1;\">Manual</span></a></p>\"\n-<p><a href=\"https://krita.org/\"><span style=\" text-decoration: underline; color:%1;\">Krita Website</span></a></p>\"\n-<p><a href=\"https://forum.kde.org/viewforum.php?f=136\"><span style=\" text-decoration: underline; color:%1;\">User Community</span></a></p>\"\n-<p><a href=\"https://quickgit.kde.org/?p=krita.git\"><span style=\" text-decoration: underline; color:%1;\">Source Code</span></a></p>\"\n-<p><a href=\"https://store.steampowered.com/app/280680/\"><span style=\" text-decoration: underline; color:%1;\">Krita on Steam</span></a></p>\"\n-</body>\n-</html>"}, {"sha": "691287b6e353f56675fffd37fe96ead589956f33", "filename": "krita/data/aboutdata/newsfooter.html", "status": "removed", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/6b2491ede682f7206754925958549542436bb671/krita/data/aboutdata/newsfooter.html", "raw_url": "https://github.com/KDE/krita/raw/6b2491ede682f7206754925958549542436bb671/krita/data/aboutdata/newsfooter.html", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/data/aboutdata/newsfooter.html?ref=6b2491ede682f7206754925958549542436bb671", "patch": "@@ -1,2 +0,0 @@\n-</body>\n-</html>\n\\ No newline at end of file"}, {"sha": "6435e8442f8c2c1d6ef6e5d0729bd5b3ff706894", "filename": "krita/data/aboutdata/newsheader.html", "status": "removed", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/6b2491ede682f7206754925958549542436bb671/krita/data/aboutdata/newsheader.html", "raw_url": "https://github.com/KDE/krita/raw/6b2491ede682f7206754925958549542436bb671/krita/data/aboutdata/newsheader.html", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/data/aboutdata/newsheader.html?ref=6b2491ede682f7206754925958549542436bb671", "patch": "@@ -1,3 +0,0 @@\n-<html>\n-<body>\n-<h1>News</h1>\n\\ No newline at end of file"}]}, {"sha": "6b2491ede682f7206754925958549542436bb671", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "75a91afdae3488f1307006169bd07a511e8d9f6b", "filename": "libs/ui/wdgsplash.ui", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/6b2491ede682f7206754925958549542436bb671/libs/ui/wdgsplash.ui", "raw_url": "https://github.com/KDE/krita/raw/6b2491ede682f7206754925958549542436bb671/libs/ui/wdgsplash.ui", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/wdgsplash.ui?ref=6b2491ede682f7206754925958549542436bb671", "patch": "@@ -369,7 +369,7 @@\n         </font>\n        </property>\n        <property name=\"text\">\n-        <string>Loading...</string>\n+        <string/>\n        </property>\n        <property name=\"alignment\">\n         <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>"}]}, {"sha": "6983f0c80f819c7d36e817dfa439be0bc01110b3", "stats": {"total": 9, "additions": 9, "deletions": 0}, "files": [{"sha": "aa5acdf9a4476dd8e7fc86d190e1cdfc4f8e40d5", "filename": "libs/ui/widgets/kis_custom_image_widget.cc", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/KDE/krita/blob/6983f0c80f819c7d36e817dfa439be0bc01110b3/libs/ui/widgets/kis_custom_image_widget.cc", "raw_url": "https://github.com/KDE/krita/raw/6983f0c80f819c7d36e817dfa439be0bc01110b3/libs/ui/widgets/kis_custom_image_widget.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/widgets/kis_custom_image_widget.cc?ref=6983f0c80f819c7d36e817dfa439be0bc01110b3", "patch": "@@ -144,6 +144,15 @@ KisCustomImageWidget::KisCustomImageWidget(QWidget* parent, qint32 defWidth, qin\n \n     fillPredefined();\n     switchPortraitLandscape();\n+\n+    // this makes the portrait and landscape buttons more\n+    // obvious what is selected by changing the higlight color\n+    QPalette p = QApplication::palette();\n+    QPalette palette_highlight(p );\n+    QColor c = p.color(QPalette::Highlight);\n+    palette_highlight.setColor(QPalette::Button, c);\n+    bnLandscape->setPalette(palette_highlight);\n+    bnPortrait->setPalette(palette_highlight);\n }\n \n void KisCustomImageWidget::showEvent(QShowEvent *)"}]}, {"sha": "c59ed2a2e8d79e117e2c1c6107be4a1bd5f431bd", "stats": {"total": 14, "additions": 7, "deletions": 7}, "files": [{"sha": "1f08d51c1be235b895e4250f0e995472c10848ea", "filename": "libs/ui/kis_splash_screen.cpp", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/KDE/krita/blob/c59ed2a2e8d79e117e2c1c6107be4a1bd5f431bd/libs/ui/kis_splash_screen.cpp", "raw_url": "https://github.com/KDE/krita/raw/c59ed2a2e8d79e117e2c1c6107be4a1bd5f431bd/libs/ui/kis_splash_screen.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kis_splash_screen.cpp?ref=c59ed2a2e8d79e117e2c1c6107be4a1bd5f431bd", "patch": "@@ -62,16 +62,16 @@ KisSplashScreen::KisSplashScreen(const QString &version, const QPixmap &pixmap,\n                            \"<body>\"\n                            \"<p align=\\\"center\\\"><span style=\\\" color:%1;\\\"><b>Links</b></span></p>\"\n \n-                           \"<p><a href=\\\"https://krita.org/support-us/donations/\\\"><span style=\\\" text-decoration: underline; color:%1;\\\">Support Krita</span></a></p>\"\n+                           \"<p><a href=\\\"https://krita.org/support-us/\\\"><span style=\\\" text-decoration: underline; color:%1;\\\">Support Krita</span></a></p>\"\n \n-                           \"<p><a href=\\\"http://krita.org/resources\\\"><span style=\\\" text-decoration: underline; color:%1;\\\">Getting Started</span></a></p>\"\n-                           \"<p><a href=\\\"http://docs.krita.org\\\"><span style=\\\" text-decoration: underline; color:%1;\\\">Manual</span></a></p>\"\n-                           \"<p><a href=\\\"http://krita.org\\\"><span style=\\\" text-decoration: underline; color:%1;\\\">Krita Website</span></a></p>\"\n-                           \"<p><a href=\\\"http://forum.kde.org/viewforum.php?f=136\\\"><span style=\\\" text-decoration: underline; color:%1;\\\">User Community</span></a></p>\"\n+                           \"<p><a href=\\\"https://docs.krita.org/Category:Getting_Started\\\"><span style=\\\" text-decoration: underline; color:%1;\\\">Getting Started</span></a></p>\"\n+                           \"<p><a href=\\\"https://docs.krita.org/\\\"><span style=\\\" text-decoration: underline; color:%1;\\\">Manual</span></a></p>\"\n+                           \"<p><a href=\\\"https://krita.org/\\\"><span style=\\\" text-decoration: underline; color:%1;\\\">Krita Website</span></a></p>\"\n+                           \"<p><a href=\\\"https://forum.kde.org/viewforum.php?f=136\\\"><span style=\\\" text-decoration: underline; color:%1;\\\">User Community</span></a></p>\"\n \n-                           \"<p><a href=\\\"https://projects.kde.org/projects/calligra\\\"><span style=\\\" text-decoration: underline; color:%1;\\\">Source Code</span></a></p>\"\n+                           \"<p><a href=\\\"https://quickgit.kde.org/?p=krita.git\\\"><span style=\\\" text-decoration: underline; color:%1;\\\">Source Code</span></a></p>\"\n \n-                           \"<p><a href=\\\"http://store.steampowered.com/app/280680/\\\"><span style=\\\" text-decoration: underline; color:%1;\\\">Krita on Steam</span></a></p>\"\n+                           \"<p><a href=\\\"https://store.steampowered.com/app/280680/\\\"><span style=\\\" text-decoration: underline; color:%1;\\\">Krita on Steam</span></a></p>\"\n                            \"</body>\"\n                            \"</html>\", color));\n "}]}, {"sha": "5b8b3eb4e630617e078033f0b260f41069a56d7f", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "6f6f4ae6b07ffbefbd25f90d4d9ec1a033af4859", "filename": "CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5b8b3eb4e630617e078033f0b260f41069a56d7f/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5b8b3eb4e630617e078033f0b260f41069a56d7f/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=5b8b3eb4e630617e078033f0b260f41069a56d7f", "patch": "@@ -259,7 +259,7 @@ include (MacroLibrary)\n include (MacroAdditionalCleanFiles)\n include (MacroAddFileDependencies)\n \n-macro_ensure_out_of_source_build(\"Compiling Calligra inside the source directory is not possible. Please refer to the build instruction http://community.kde.org/Calligra/Building/Building_Calligra\")\n+macro_ensure_out_of_source_build(\"Compiling Krita inside the source directory is not possible. Please refer to the build instruction https://community.kde.org/Krita#Build_Instructions\")\n \n # Note: OPTIONAL_COMPONENTS does not seem to be reliable\n # (as of ECM 5.15.0, CMake 3.2)"}]}, {"sha": "a6bb793b09c748a21bb597553b33a0a231f4bab8", "stats": {"total": 16, "additions": 8, "deletions": 8}, "files": [{"sha": "a1d5c4716bd0fe3f3ee0455f4a9557791333662c", "filename": "krita/data/aboutdata/links.html", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/KDE/krita/blob/a6bb793b09c748a21bb597553b33a0a231f4bab8/krita/data/aboutdata/links.html", "raw_url": "https://github.com/KDE/krita/raw/a6bb793b09c748a21bb597553b33a0a231f4bab8/krita/data/aboutdata/links.html", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/data/aboutdata/links.html?ref=a6bb793b09c748a21bb597553b33a0a231f4bab8", "patch": "@@ -1,12 +1,12 @@\n <html>\n <body>\n <p align=\"center\"><span style=\" color:%1;\"><b>Links</b></span></p>\n-<p><a href=\"https://krita.org/support-us/donations/\"><span style=\" text-decoration: underline; color:%1;\">Support Krita</span></a></p>\"\n-<p><a href=\"http://krita.org/resources\"><span style=\" text-decoration: underline; color:%1;\">Getting Started</span></a></p>\"\n-<p><a href=\"http://userbase.kde.org/Krita/Manual\"><span style=\" text-decoration: underline; color:%1;\">Manual</span></a></p>\"\n-<p><a href=\"http://krita.org\"><span style=\" text-decoration: underline; color:%1;\">Krita Website</span></a></p>\"\n-<p><a href=\"http://forum.kde.org/viewforum.php?f=136\"><span style=\" text-decoration: underline; color:%1;\">User Community</span></a></p>\"\n-<p><a href=\"https://projects.kde.org/projects/calligra\"><span style=\" text-decoration: underline; color:%1;\">Source Code</span></a></p>\"\n-<p><a href=\"http://store.steampowered.com/app/280680/\"><span style=\" text-decoration: underline; color:%1;\">Krita on Steam</span></a></p>\"\n+<p><a href=\"https://krita.org/support-us/\"><span style=\" text-decoration: underline; color:%1;\">Support Krita</span></a></p>\"\n+<p><a href=\"https://docs.krita.org/Category:Getting_Started\"><span style=\" text-decoration: underline; color:%1;\">Getting Started</span></a></p>\"\n+<p><a href=\"https://docs.krita.org/\"><span style=\" text-decoration: underline; color:%1;\">Manual</span></a></p>\"\n+<p><a href=\"https://krita.org/\"><span style=\" text-decoration: underline; color:%1;\">Krita Website</span></a></p>\"\n+<p><a href=\"https://forum.kde.org/viewforum.php?f=136\"><span style=\" text-decoration: underline; color:%1;\">User Community</span></a></p>\"\n+<p><a href=\"https://quickgit.kde.org/?p=krita.git\"><span style=\" text-decoration: underline; color:%1;\">Source Code</span></a></p>\"\n+<p><a href=\"https://store.steampowered.com/app/280680/\"><span style=\" text-decoration: underline; color:%1;\">Krita on Steam</span></a></p>\"\n </body>\n-</html>\n\\ No newline at end of file\n+</html>"}]}, {"sha": "a6a5e266b548dc4fdaae2698bd7af68ca9e9cc3b", "stats": {"total": 4, "additions": 1, "deletions": 3}, "files": [{"sha": "c04c1e8440ec970f2689ce31cec1bf433b68c79d", "filename": "krita/main.cc", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/a6a5e266b548dc4fdaae2698bd7af68ca9e9cc3b/krita/main.cc", "raw_url": "https://github.com/KDE/krita/raw/a6a5e266b548dc4fdaae2698bd7af68ca9e9cc3b/krita/main.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/main.cc?ref=a6a5e266b548dc4fdaae2698bd7af68ca9e9cc3b", "patch": "@@ -72,9 +72,7 @@ extern \"C\" int main(int argc, char **argv)\n      *\n      * See: http://doc.qt.io/qt-5/qloggingcategory.html\n      */\n-    QLoggingCategory::setFilterRules(\"calligra*=false\\n\"\n-                                     \"calligra*.warning=true\\n\"\n-                                     \"krita*.debug=false\\n\"\n+    QLoggingCategory::setFilterRules(\"krita*.debug=false\\n\"\n                                      \"krita*.warning=true\\n\"\n                                      \"krita.tabletlog=true\");\n "}]}, {"sha": "8a077f953f1779cfbf84444809dae61e1ed98868", "stats": {"total": 23, "additions": 0, "deletions": 23}, "files": [{"sha": "9d1f0f1c29f60827774b3720608321c3a0bb957d", "filename": "krita/krita.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/8a077f953f1779cfbf84444809dae61e1ed98868/krita/krita.desktop", "raw_url": "https://github.com/KDE/krita/raw/8a077f953f1779cfbf84444809dae61e1ed98868/krita/krita.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/krita.desktop?ref=8a077f953f1779cfbf84444809dae61e1ed98868", "patch": "@@ -131,7 +131,6 @@ Comment[x-test]=xxDigital Paintingxx\n Type=Application\n Icon=calligrakrita\n Categories=Qt;KDE;Graphics;\n-X-Calligra-DefaultMimeTypes=application/x-krita\n X-KDE-NativeMimeType=application/x-krita\n X-KDE-ExtraNativeMimeTypes=\n StartupNotify=true"}, {"sha": "8cb147184e6a829041fd27f1e88a79d6bb690612", "filename": "plugins/impex/bmp/krita_bmp.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/bmp/krita_bmp.desktop", "raw_url": "https://github.com/KDE/krita/raw/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/bmp/krita_bmp.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/bmp/krita_bmp.desktop?ref=8a077f953f1779cfbf84444809dae61e1ed98868", "patch": "@@ -66,5 +66,4 @@ Type=Application\n Icon=calligrakrita\n Categories=Qt;KDE;Office;Graphics;\n StartupNotify=true\n-X-Calligra-DefaultMimeTypes=image/bmp,image/x-xpixmap,image/gif,image/x-xbitmap,image/vnd.microsoft.icon,image/webp\n NoDisplay=true"}, {"sha": "6ea2d6055c4bac61a75441a34c4dd09c9f73a265", "filename": "plugins/impex/brush/krita_brush.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/brush/krita_brush.desktop", "raw_url": "https://github.com/KDE/krita/raw/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/brush/krita_brush.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/brush/krita_brush.desktop?ref=8a077f953f1779cfbf84444809dae61e1ed98868", "patch": "@@ -66,7 +66,6 @@ Type=Application\n Icon=calligrakrita\n Categories=Qt;KDE;Office;Graphics;\n StartupNotify=true\n-X-Calligra-DefaultMimeTypes=image/x-gimp-brush,image/x-gimp-brush-animated\n X-DBUS-StartupType=Multi\n X-DBUS-ServiceName=org.krita.krita\n NoDisplay=true"}, {"sha": "11cdf6d82dd6aea7741b584249eae8a7fdbe29f5", "filename": "plugins/impex/csv/krita_csv.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/csv/krita_csv.desktop", "raw_url": "https://github.com/KDE/krita/raw/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/csv/krita_csv.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/csv/krita_csv.desktop?ref=8a077f953f1779cfbf84444809dae61e1ed98868", "patch": "@@ -66,5 +66,4 @@ Type=Application\n Icon=calligrakrita\n Categories=Qt;KDE;Office;Graphics;\n StartupNotify=true\n-X-Calligra-DefaultMimeTypes=text/csv\n NoDisplay=true"}, {"sha": "3d55bc694932f9e806e133deaf66c10e6d99cfcf", "filename": "plugins/impex/exr/krita_exr.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/exr/krita_exr.desktop", "raw_url": "https://github.com/KDE/krita/raw/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/exr/krita_exr.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/exr/krita_exr.desktop?ref=8a077f953f1779cfbf84444809dae61e1ed98868", "patch": "@@ -115,7 +115,6 @@ Name[zh_TW]=\u7e6a\u5716_Krita\n StartupNotify=true\n Terminal=false\n Type=Application\n-X-Calligra-DefaultMimeTypes=image/exr,application/x-extension-exr\n X-KDE-SubstituteUID=false\n X-KDE-Username=\n NoDisplay=true"}, {"sha": "5f08ca055ee823ca497b6a0f22fead8262bb0522", "filename": "plugins/impex/heightmap/krita_heightmap.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/heightmap/krita_heightmap.desktop", "raw_url": "https://github.com/KDE/krita/raw/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/heightmap/krita_heightmap.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/heightmap/krita_heightmap.desktop?ref=8a077f953f1779cfbf84444809dae61e1ed98868", "patch": "@@ -69,6 +69,5 @@ NoDisplay=true\n StartupNotify=true\n Terminal=false\n Type=Application\n-X-Calligra-DefaultMimeTypes=image/x-r16,image/x-8\n X-KDE-SubstituteUID=false\n X-KDE-Username="}, {"sha": "41a1d62655149a2024fd4aa32a68541718f479cf", "filename": "plugins/impex/jp2/krita_jp2.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/jp2/krita_jp2.desktop", "raw_url": "https://github.com/KDE/krita/raw/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/jp2/krita_jp2.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/jp2/krita_jp2.desktop?ref=8a077f953f1779cfbf84444809dae61e1ed98868", "patch": "@@ -115,7 +115,6 @@ Name[zh_TW]=\u7e6a\u5716_Krita\n StartupNotify=true\n Terminal=false\n Type=Application\n-X-Calligra-DefaultMimeTypes=image/jp2\n X-KDE-SubstituteUID=false\n X-KDE-Username=\n NoDisplay=true"}, {"sha": "f44ff0134c350c8579bd681404046f2a126dfad7", "filename": "plugins/impex/jpeg/krita_jpeg.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/jpeg/krita_jpeg.desktop", "raw_url": "https://github.com/KDE/krita/raw/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/jpeg/krita_jpeg.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/jpeg/krita_jpeg.desktop?ref=8a077f953f1779cfbf84444809dae61e1ed98868", "patch": "@@ -67,7 +67,6 @@ Name[zh_TW]=\u7e6a\u5716_Krita\n StartupNotify=true\n Terminal=false\n Type=Application\n-X-Calligra-DefaultMimeTypes=image/jpeg\n X-KDE-SubstituteUID=false\n X-KDE-Username=\n NoDisplay=true"}, {"sha": "783d432b1aa43c23f54b84f6b6eb77958c21d78a", "filename": "plugins/impex/odg/krita_odg.desktop", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/odg/krita_odg.desktop", "raw_url": "https://github.com/KDE/krita/raw/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/odg/krita_odg.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/odg/krita_odg.desktop?ref=8a077f953f1779cfbf84444809dae61e1ed98868", "patch": "@@ -66,7 +66,4 @@ Type=Application\n Icon=calligrakrita\n Categories=Qt;KDE;Office;Graphics;\n StartupNotify=true\n-# application/vnd.oasis.opendocument.graphics is not on this list because Karbon has the default;\n-# Krita will be used only in absence of Karbon\n-X-Calligra-DefaultMimeTypes=\n NoDisplay=true"}, {"sha": "abecba55569290c9e5d8d7b7c0d5748bf80c5d3d", "filename": "plugins/impex/ora/krita_ora.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/ora/krita_ora.desktop", "raw_url": "https://github.com/KDE/krita/raw/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/ora/krita_ora.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/ora/krita_ora.desktop?ref=8a077f953f1779cfbf84444809dae61e1ed98868", "patch": "@@ -68,7 +68,6 @@ Name[zh_TW]=\u7e6a\u5716_Krita\n StartupNotify=true\n Terminal=false\n Type=Application\n-X-Calligra-DefaultMimeTypes=image/openraster\n X-KDE-SubstituteUID=false\n X-KDE-Username=\n NoDisplay=true"}, {"sha": "f5eaa45464fda8925e1263aafd83660b7bede494", "filename": "plugins/impex/pdf/krita_pdf.desktop", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/pdf/krita_pdf.desktop", "raw_url": "https://github.com/KDE/krita/raw/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/pdf/krita_pdf.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/pdf/krita_pdf.desktop?ref=8a077f953f1779cfbf84444809dae61e1ed98868", "patch": "@@ -67,9 +67,6 @@ Name[zh_TW]=\u7e6a\u5716_Krita\n StartupNotify=true\n Terminal=false\n Type=Application\n-# application/pdf is not on this list because Karbon has the default;\n-# Krita will be used only in absence of Karbon\n-X-Calligra-DefaultMimeTypes=\n X-KDE-SubstituteUID=false\n X-KDE-Username=\n NoDisplay=true"}, {"sha": "98289736444e4a18a38e320a251562190024f882", "filename": "plugins/impex/png/krita_png.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/png/krita_png.desktop", "raw_url": "https://github.com/KDE/krita/raw/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/png/krita_png.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/png/krita_png.desktop?ref=8a077f953f1779cfbf84444809dae61e1ed98868", "patch": "@@ -66,5 +66,4 @@ Type=Application\n Icon=calligrakrita\n Categories=Qt;KDE;Office;Graphics;\n StartupNotify=true\n-X-Calligra-DefaultMimeTypes=image/png\n NoDisplay=true"}, {"sha": "1bcdc2dde44d0352052d83a9fa3f3133d9d03d1a", "filename": "plugins/impex/ppm/krita_ppm.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/ppm/krita_ppm.desktop", "raw_url": "https://github.com/KDE/krita/raw/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/ppm/krita_ppm.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/ppm/krita_ppm.desktop?ref=8a077f953f1779cfbf84444809dae61e1ed98868", "patch": "@@ -69,6 +69,5 @@ NoDisplay=true\n StartupNotify=true\n Terminal=false\n Type=Application\n-X-Calligra-DefaultMimeTypes=image/x-portable-pixmap,image/x-portable-graymap,image/x-portable-bitmap\n X-KDE-SubstituteUID=false\n X-KDE-Username="}, {"sha": "46e04aa361d4e4b2752f8f42c0f05549e0476e4f", "filename": "plugins/impex/psd/krita_psd.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/psd/krita_psd.desktop", "raw_url": "https://github.com/KDE/krita/raw/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/psd/krita_psd.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/psd/krita_psd.desktop?ref=8a077f953f1779cfbf84444809dae61e1ed98868", "patch": "@@ -68,6 +68,5 @@ NoDisplay=true\n StartupNotify=true\n Terminal=false\n Type=Application\n-X-Calligra-DefaultMimeTypes=image/x-psd,image/photoshop,image/x-photoshop,image/x-vnd.adobe.photoshop,image/vnd.adobe.photoshop\n X-KDE-SubstituteUID=false\n X-KDE-Username="}, {"sha": "4fdec9e6296c827c4233bd510332eb345cd56b8c", "filename": "plugins/impex/raw/krita_raw.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/raw/krita_raw.desktop", "raw_url": "https://github.com/KDE/krita/raw/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/raw/krita_raw.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/raw/krita_raw.desktop?ref=8a077f953f1779cfbf84444809dae61e1ed98868", "patch": "@@ -65,6 +65,5 @@ MimeType=image/x-nikon-nef;image/x-canon-cr2;image/x-sony-sr2;image/x-canon-crw;\n Icon=calligrakrita\n Categories=Qt;KDE;Office;Graphics;\n StartupNotify=true\n-X-Calligra-DefaultMimeTypes=image/x-nikon-nef,image/x-canon-cr2,image/x-sony-sr2,image/x-canon-crw,image/x-pentax-pef,image/x-sigma-x3f,image/x-kodak-kdc,image/x-minolta-mrw,image/x-sony-arw,image/x-kodak-k25,image/x-kodak-dcr,image/x-olympus-orf,image/x-panasonic-raw,image/x-panasonic-raw2,image/x-fuji-raf,image/x-sony-srf;image/x-adobe-dng\n NoDisplay=true\n Type=Application"}, {"sha": "be597914442b8736322b5cb2b20eac24415e588f", "filename": "plugins/impex/spriter/krita_spriter.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/spriter/krita_spriter.desktop", "raw_url": "https://github.com/KDE/krita/raw/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/spriter/krita_spriter.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/spriter/krita_spriter.desktop?ref=8a077f953f1779cfbf84444809dae61e1ed98868", "patch": "@@ -66,5 +66,4 @@ Type=Application\n Icon=calligrakrita\n Categories=Qt;KDE;Office;Graphics;\n StartupNotify=true\n-X-Calligra-DefaultMimeTypes=application/x-spriter\n NoDisplay=true"}, {"sha": "c2be6f26abc4ec33aae5c4e2fddb7b6f7a11f3bc", "filename": "plugins/impex/tga/krita_tga.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/tga/krita_tga.desktop", "raw_url": "https://github.com/KDE/krita/raw/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/tga/krita_tga.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/tga/krita_tga.desktop?ref=8a077f953f1779cfbf84444809dae61e1ed98868", "patch": "@@ -66,5 +66,4 @@ Type=Application\n Icon=calligrakrita\n Categories=Qt;KDE;Office;Graphics;\n StartupNotify=true\n-X-Calligra-DefaultMimeTypes=image/x-tga\n NoDisplay=true"}, {"sha": "2304179837b6a2fe6ed7d548f16ca36da2b10b94", "filename": "plugins/impex/tiff/krita_tiff.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/tiff/krita_tiff.desktop", "raw_url": "https://github.com/KDE/krita/raw/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/tiff/krita_tiff.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/tiff/krita_tiff.desktop?ref=8a077f953f1779cfbf84444809dae61e1ed98868", "patch": "@@ -68,6 +68,5 @@ NoDisplay=true\n StartupNotify=true\n Terminal=false\n Type=Application\n-X-Calligra-DefaultMimeTypes=image/tiff\n X-KDE-SubstituteUID=false\n X-KDE-Username="}, {"sha": "a67b8d5ef34141b28658ac6fd73ee68b7e8adba5", "filename": "plugins/impex/xcf/krita_xcf.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/xcf/krita_xcf.desktop", "raw_url": "https://github.com/KDE/krita/raw/8a077f953f1779cfbf84444809dae61e1ed98868/plugins/impex/xcf/krita_xcf.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/xcf/krita_xcf.desktop?ref=8a077f953f1779cfbf84444809dae61e1ed98868", "patch": "@@ -68,6 +68,5 @@ Type=Application\n NoDisplay=true\n StartupNotify=true\n Terminal=false\n-X-Calligra-DefaultMimeTypes=image/x-xcf\n X-KDE-SubstituteUID=false\n X-KDE-Username="}]}, {"sha": "9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "stats": {"total": 19, "additions": 0, "deletions": 19}, "files": [{"sha": "21c8f817254152b8c74528edb7d8126ecaa8ad66", "filename": "krita/krita.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/krita/krita.desktop", "raw_url": "https://github.com/KDE/krita/raw/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/krita/krita.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/krita.desktop?ref=9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "patch": "@@ -131,7 +131,6 @@ Comment[x-test]=xxDigital Paintingxx\n Type=Application\n Icon=calligrakrita\n Categories=Qt;KDE;Graphics;\n-X-KDE-ServiceTypes=Calligra/Application\n X-Calligra-DefaultMimeTypes=application/x-krita\n X-KDE-NativeMimeType=application/x-krita\n X-KDE-ExtraNativeMimeTypes="}, {"sha": "ff03d7f61bedbe89b583dbfe6f612da2f4cec33d", "filename": "plugins/impex/bmp/krita_bmp.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/bmp/krita_bmp.desktop", "raw_url": "https://github.com/KDE/krita/raw/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/bmp/krita_bmp.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/bmp/krita_bmp.desktop?ref=9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "patch": "@@ -66,6 +66,5 @@ Type=Application\n Icon=calligrakrita\n Categories=Qt;KDE;Office;Graphics;\n StartupNotify=true\n-X-KDE-ServiceTypes=Calligra/Application\n X-Calligra-DefaultMimeTypes=image/bmp,image/x-xpixmap,image/gif,image/x-xbitmap,image/vnd.microsoft.icon,image/webp\n NoDisplay=true"}, {"sha": "21607ab7013bf8f4703d070d2204edcbcd143d05", "filename": "plugins/impex/brush/krita_brush.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/brush/krita_brush.desktop", "raw_url": "https://github.com/KDE/krita/raw/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/brush/krita_brush.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/brush/krita_brush.desktop?ref=9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "patch": "@@ -66,7 +66,6 @@ Type=Application\n Icon=calligrakrita\n Categories=Qt;KDE;Office;Graphics;\n StartupNotify=true\n-X-KDE-ServiceTypes=Calligra/Application\n X-Calligra-DefaultMimeTypes=image/x-gimp-brush,image/x-gimp-brush-animated\n X-DBUS-StartupType=Multi\n X-DBUS-ServiceName=org.krita.krita"}, {"sha": "ed909aa5326bc6eab8f1a2abb75c8d9202870beb", "filename": "plugins/impex/csv/krita_csv.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/csv/krita_csv.desktop", "raw_url": "https://github.com/KDE/krita/raw/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/csv/krita_csv.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/csv/krita_csv.desktop?ref=9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "patch": "@@ -66,6 +66,5 @@ Type=Application\n Icon=calligrakrita\n Categories=Qt;KDE;Office;Graphics;\n StartupNotify=true\n-X-KDE-ServiceTypes=Calligra/Application\n X-Calligra-DefaultMimeTypes=text/csv\n NoDisplay=true"}, {"sha": "deace670f48f3817c6c3c5a6d511d3d9a453a6fe", "filename": "plugins/impex/exr/krita_exr.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/exr/krita_exr.desktop", "raw_url": "https://github.com/KDE/krita/raw/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/exr/krita_exr.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/exr/krita_exr.desktop?ref=9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "patch": "@@ -115,7 +115,6 @@ Name[zh_TW]=\u7e6a\u5716_Krita\n StartupNotify=true\n Terminal=false\n Type=Application\n-X-KDE-ServiceTypes=Calligra/Application\n X-Calligra-DefaultMimeTypes=image/exr,application/x-extension-exr\n X-KDE-SubstituteUID=false\n X-KDE-Username="}, {"sha": "69012d098489d2a896a772f4e3a6e376c28b27fa", "filename": "plugins/impex/heightmap/krita_heightmap.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/heightmap/krita_heightmap.desktop", "raw_url": "https://github.com/KDE/krita/raw/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/heightmap/krita_heightmap.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/heightmap/krita_heightmap.desktop?ref=9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "patch": "@@ -69,7 +69,6 @@ NoDisplay=true\n StartupNotify=true\n Terminal=false\n Type=Application\n-X-KDE-ServiceTypes=Calligra/Application\n X-Calligra-DefaultMimeTypes=image/x-r16,image/x-8\n X-KDE-SubstituteUID=false\n X-KDE-Username="}, {"sha": "90aacbe78abffdb319f722d9fe8af12da816e6a1", "filename": "plugins/impex/jp2/krita_jp2.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/jp2/krita_jp2.desktop", "raw_url": "https://github.com/KDE/krita/raw/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/jp2/krita_jp2.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/jp2/krita_jp2.desktop?ref=9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "patch": "@@ -115,7 +115,6 @@ Name[zh_TW]=\u7e6a\u5716_Krita\n StartupNotify=true\n Terminal=false\n Type=Application\n-X-KDE-ServiceTypes=Calligra/Application\n X-Calligra-DefaultMimeTypes=image/jp2\n X-KDE-SubstituteUID=false\n X-KDE-Username="}, {"sha": "8faf2c7829601fb8ad2de4fe69881ea6abac9cf6", "filename": "plugins/impex/jpeg/krita_jpeg.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/jpeg/krita_jpeg.desktop", "raw_url": "https://github.com/KDE/krita/raw/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/jpeg/krita_jpeg.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/jpeg/krita_jpeg.desktop?ref=9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "patch": "@@ -67,7 +67,6 @@ Name[zh_TW]=\u7e6a\u5716_Krita\n StartupNotify=true\n Terminal=false\n Type=Application\n-X-KDE-ServiceTypes=Calligra/Application\n X-Calligra-DefaultMimeTypes=image/jpeg\n X-KDE-SubstituteUID=false\n X-KDE-Username="}, {"sha": "c697b77cd123c126ae8eb8a256fd62d3d2951907", "filename": "plugins/impex/odg/krita_odg.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/odg/krita_odg.desktop", "raw_url": "https://github.com/KDE/krita/raw/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/odg/krita_odg.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/odg/krita_odg.desktop?ref=9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "patch": "@@ -66,7 +66,6 @@ Type=Application\n Icon=calligrakrita\n Categories=Qt;KDE;Office;Graphics;\n StartupNotify=true\n-X-KDE-ServiceTypes=Calligra/Application\n # application/vnd.oasis.opendocument.graphics is not on this list because Karbon has the default;\n # Krita will be used only in absence of Karbon\n X-Calligra-DefaultMimeTypes="}, {"sha": "cfaca92c3710c819be37a8bf50c68e17cee20f7f", "filename": "plugins/impex/ora/krita_ora.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/ora/krita_ora.desktop", "raw_url": "https://github.com/KDE/krita/raw/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/ora/krita_ora.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/ora/krita_ora.desktop?ref=9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "patch": "@@ -68,7 +68,6 @@ Name[zh_TW]=\u7e6a\u5716_Krita\n StartupNotify=true\n Terminal=false\n Type=Application\n-X-KDE-ServiceTypes=Calligra/Application\n X-Calligra-DefaultMimeTypes=image/openraster\n X-KDE-SubstituteUID=false\n X-KDE-Username="}, {"sha": "521a77d23a63420b726bbcaffdecbcc5e70801ca", "filename": "plugins/impex/pdf/krita_pdf.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/pdf/krita_pdf.desktop", "raw_url": "https://github.com/KDE/krita/raw/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/pdf/krita_pdf.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/pdf/krita_pdf.desktop?ref=9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "patch": "@@ -67,7 +67,6 @@ Name[zh_TW]=\u7e6a\u5716_Krita\n StartupNotify=true\n Terminal=false\n Type=Application\n-X-KDE-ServiceTypes=Calligra/Application\n # application/pdf is not on this list because Karbon has the default;\n # Krita will be used only in absence of Karbon\n X-Calligra-DefaultMimeTypes="}, {"sha": "cd7d814c4f55b0976e7c0b9e7ef3666dd607f9be", "filename": "plugins/impex/png/krita_png.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/png/krita_png.desktop", "raw_url": "https://github.com/KDE/krita/raw/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/png/krita_png.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/png/krita_png.desktop?ref=9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "patch": "@@ -66,6 +66,5 @@ Type=Application\n Icon=calligrakrita\n Categories=Qt;KDE;Office;Graphics;\n StartupNotify=true\n-X-KDE-ServiceTypes=Calligra/Application\n X-Calligra-DefaultMimeTypes=image/png\n NoDisplay=true"}, {"sha": "90fecc3022d163a1742fdc52ef47295e455d5670", "filename": "plugins/impex/ppm/krita_ppm.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/ppm/krita_ppm.desktop", "raw_url": "https://github.com/KDE/krita/raw/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/ppm/krita_ppm.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/ppm/krita_ppm.desktop?ref=9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "patch": "@@ -69,7 +69,6 @@ NoDisplay=true\n StartupNotify=true\n Terminal=false\n Type=Application\n-X-KDE-ServiceTypes=Calligra/Application\n X-Calligra-DefaultMimeTypes=image/x-portable-pixmap,image/x-portable-graymap,image/x-portable-bitmap\n X-KDE-SubstituteUID=false\n X-KDE-Username="}, {"sha": "918225063179fdd69896edce3e5d55279b4c52db", "filename": "plugins/impex/psd/krita_psd.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/psd/krita_psd.desktop", "raw_url": "https://github.com/KDE/krita/raw/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/psd/krita_psd.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/psd/krita_psd.desktop?ref=9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "patch": "@@ -68,7 +68,6 @@ NoDisplay=true\n StartupNotify=true\n Terminal=false\n Type=Application\n-X-KDE-ServiceTypes=Calligra/Application\n X-Calligra-DefaultMimeTypes=image/x-psd,image/photoshop,image/x-photoshop,image/x-vnd.adobe.photoshop,image/vnd.adobe.photoshop\n X-KDE-SubstituteUID=false\n X-KDE-Username="}, {"sha": "48e64d3f477e5c6b2d6f6ac03f34b152775b5731", "filename": "plugins/impex/raw/krita_raw.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/raw/krita_raw.desktop", "raw_url": "https://github.com/KDE/krita/raw/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/raw/krita_raw.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/raw/krita_raw.desktop?ref=9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "patch": "@@ -65,7 +65,6 @@ MimeType=image/x-nikon-nef;image/x-canon-cr2;image/x-sony-sr2;image/x-canon-crw;\n Icon=calligrakrita\n Categories=Qt;KDE;Office;Graphics;\n StartupNotify=true\n-X-KDE-ServiceTypes=Calligra/Application\n X-Calligra-DefaultMimeTypes=image/x-nikon-nef,image/x-canon-cr2,image/x-sony-sr2,image/x-canon-crw,image/x-pentax-pef,image/x-sigma-x3f,image/x-kodak-kdc,image/x-minolta-mrw,image/x-sony-arw,image/x-kodak-k25,image/x-kodak-dcr,image/x-olympus-orf,image/x-panasonic-raw,image/x-panasonic-raw2,image/x-fuji-raf,image/x-sony-srf;image/x-adobe-dng\n NoDisplay=true\n Type=Application"}, {"sha": "2f25c3ec4f54768d0d08a1ab2bb3d180b63396b0", "filename": "plugins/impex/spriter/krita_spriter.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/spriter/krita_spriter.desktop", "raw_url": "https://github.com/KDE/krita/raw/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/spriter/krita_spriter.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/spriter/krita_spriter.desktop?ref=9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "patch": "@@ -66,6 +66,5 @@ Type=Application\n Icon=calligrakrita\n Categories=Qt;KDE;Office;Graphics;\n StartupNotify=true\n-X-KDE-ServiceTypes=Calligra/Application\n X-Calligra-DefaultMimeTypes=application/x-spriter\n NoDisplay=true"}, {"sha": "15d07826b1afac6ca7ba43245c0f5dafb3c03aa3", "filename": "plugins/impex/tga/krita_tga.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/tga/krita_tga.desktop", "raw_url": "https://github.com/KDE/krita/raw/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/tga/krita_tga.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/tga/krita_tga.desktop?ref=9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "patch": "@@ -66,6 +66,5 @@ Type=Application\n Icon=calligrakrita\n Categories=Qt;KDE;Office;Graphics;\n StartupNotify=true\n-X-KDE-ServiceTypes=Calligra/Application\n X-Calligra-DefaultMimeTypes=image/x-tga\n NoDisplay=true"}, {"sha": "5b9391b760e11a1a7cf7236ded87b35e87e3e847", "filename": "plugins/impex/tiff/krita_tiff.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/tiff/krita_tiff.desktop", "raw_url": "https://github.com/KDE/krita/raw/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/tiff/krita_tiff.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/tiff/krita_tiff.desktop?ref=9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "patch": "@@ -68,7 +68,6 @@ NoDisplay=true\n StartupNotify=true\n Terminal=false\n Type=Application\n-X-KDE-ServiceTypes=Calligra/Application\n X-Calligra-DefaultMimeTypes=image/tiff\n X-KDE-SubstituteUID=false\n X-KDE-Username="}, {"sha": "d3b8944e4ec1a700b8600c87122240d6afc20bab", "filename": "plugins/impex/xcf/krita_xcf.desktop", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/xcf/krita_xcf.desktop", "raw_url": "https://github.com/KDE/krita/raw/9b6907fbc1178d891653d4e6c48fdbcaf68960d9/plugins/impex/xcf/krita_xcf.desktop", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/xcf/krita_xcf.desktop?ref=9b6907fbc1178d891653d4e6c48fdbcaf68960d9", "patch": "@@ -68,7 +68,6 @@ Type=Application\n NoDisplay=true\n StartupNotify=true\n Terminal=false\n-X-KDE-ServiceTypes=Calligra/Application\n X-Calligra-DefaultMimeTypes=image/x-xcf\n X-KDE-SubstituteUID=false\n X-KDE-Username="}]}, {"sha": "58799d65764082e5bcd2b157c2650b8672c43948", "stats": {"total": 27, "additions": 14, "deletions": 13}, "files": [{"sha": "6faaf92bd3cb158c31a70769212d9899055c377c", "filename": "libs/ui/KisNodeDelegate.cpp", "status": "modified", "additions": 14, "deletions": 13, "changes": 27, "blob_url": "https://github.com/KDE/krita/blob/58799d65764082e5bcd2b157c2650b8672c43948/libs/ui/KisNodeDelegate.cpp", "raw_url": "https://github.com/KDE/krita/raw/58799d65764082e5bcd2b157c2650b8672c43948/libs/ui/KisNodeDelegate.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisNodeDelegate.cpp?ref=58799d65764082e5bcd2b157c2650b8672c43948", "patch": "@@ -285,20 +285,21 @@ void KisNodeDelegate::drawThumbnail(QPainter *p, const QStyleOptionViewItem &opt\n \n     KisConfig cfg;\n \n-    // paint the checkers: we need a proper GUI design for them to be uncommented\n+    // paint in a checkerboard pattern behind the layer contents to represent transparent\n     const int step = scm.thumbnailSize() / 6;\n-     QImage checkers(2 * step, 2 * step, QImage::Format_ARGB32);\n-     QPainter gc(&checkers);\n-     gc.fillRect(QRect(0, 0, step, step), cfg.checkersColor1());\n-     gc.fillRect(QRect(step, 0, step, step), cfg.checkersColor2());\n-     gc.fillRect(QRect(step, step, step, step), cfg.checkersColor1());\n-     gc.fillRect(QRect(0, step, step, step), cfg.checkersColor2());\n-     QBrush brush(checkers);\n-     p->setBrushOrigin(offset);\n-     p->fillRect(img.rect().translated(offset), brush);\n-\n-     p->drawImage(offset, img);\n-     p->setOpacity(oldOpacity); // restore old opacity\n+    QImage checkers(2 * step, 2 * step, QImage::Format_ARGB32);\n+    QPainter gc(&checkers);\n+    gc.fillRect(QRect(0, 0, step, step), cfg.checkersColor1());\n+    gc.fillRect(QRect(step, 0, step, step), cfg.checkersColor2());\n+    gc.fillRect(QRect(step, step, step, step), cfg.checkersColor1());\n+    gc.fillRect(QRect(0, step, step, step), cfg.checkersColor2());\n+\n+    QBrush brush(checkers);\n+    p->setBrushOrigin(offset);\n+    p->fillRect(img.rect().translated(offset), brush);\n+\n+    p->drawImage(offset, img);\n+    p->setOpacity(oldOpacity); // restore old opacity\n \n     QRect borderRect = kisGrowRect(img.rect(), 1).translated(offset);\n     KritaUtils::renderExactRect(p, borderRect, scm.gridColor(option, d->view));"}]}, {"sha": "7d475af63b121b874e77179b379065260baf6470", "stats": {"total": 32, "additions": 16, "deletions": 16}, "files": [{"sha": "52271d129465e4844c0904aaea262c470d858082", "filename": "libs/ui/KisNodeDelegate.cpp", "status": "modified", "additions": 16, "deletions": 16, "changes": 32, "blob_url": "https://github.com/KDE/krita/blob/7d475af63b121b874e77179b379065260baf6470/libs/ui/KisNodeDelegate.cpp", "raw_url": "https://github.com/KDE/krita/raw/7d475af63b121b874e77179b379065260baf6470/libs/ui/KisNodeDelegate.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisNodeDelegate.cpp?ref=7d475af63b121b874e77179b379065260baf6470", "patch": "@@ -283,22 +283,22 @@ void KisNodeDelegate::drawThumbnail(QPainter *p, const QStyleOptionViewItem &opt\n     offset.setY((fitRect.height() - img.height()) / 2);\n     offset += fitRect.topLeft();\n \n-    // {   // paint the checkers: we need a proper GUI design for them to be uncommented\n-    //     const int step = scm.thumbnailSize() / 4;\n-    //     QImage checkers(2 * step, 2 * step, QImage::Format_ARGB32);\n-    //     QPainter gc(&checkers);\n-    //     gc.fillRect(QRect(0, 0, step, step), Qt::white);\n-    //     gc.fillRect(QRect(step, 0, step, step), Qt::gray);\n-    //     gc.fillRect(QRect(step, step, step, step), Qt::white);\n-    //     gc.fillRect(QRect(0, step, step, step), Qt::gray);\n-    //     QBrush brush(checkers);\n-    //     p->setBrushOrigin(offset);\n-    //     p->fillRect(img.rect().translated(offset), brush);*/\n-    // }\n-\n-    p->fillRect(img.rect().translated(offset), Qt::white);\n-    p->drawImage(offset, img);\n-    p->setOpacity(oldOpacity); // restore old opacity\n+    KisConfig cfg;\n+\n+    // paint the checkers: we need a proper GUI design for them to be uncommented\n+    const int step = scm.thumbnailSize() / 6;\n+     QImage checkers(2 * step, 2 * step, QImage::Format_ARGB32);\n+     QPainter gc(&checkers);\n+     gc.fillRect(QRect(0, 0, step, step), cfg.checkersColor1());\n+     gc.fillRect(QRect(step, 0, step, step), cfg.checkersColor2());\n+     gc.fillRect(QRect(step, step, step, step), cfg.checkersColor1());\n+     gc.fillRect(QRect(0, step, step, step), cfg.checkersColor2());\n+     QBrush brush(checkers);\n+     p->setBrushOrigin(offset);\n+     p->fillRect(img.rect().translated(offset), brush);\n+\n+     p->drawImage(offset, img);\n+     p->setOpacity(oldOpacity); // restore old opacity\n \n     QRect borderRect = kisGrowRect(img.rect(), 1).translated(offset);\n     KritaUtils::renderExactRect(p, borderRect, scm.gridColor(option, d->view));"}]}, {"sha": "10d6b04b2edb0e51171dc04bbee0ce8efd9a7cf2", "stats": {"total": 6, "additions": 5, "deletions": 1}, "files": [{"sha": "e739c8a6c9bc49f35b6032552ff4652180404d43", "filename": "libs/ui/widgets/kis_color_label_selector_widget.cpp", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/10d6b04b2edb0e51171dc04bbee0ce8efd9a7cf2/libs/ui/widgets/kis_color_label_selector_widget.cpp", "raw_url": "https://github.com/KDE/krita/raw/10d6b04b2edb0e51171dc04bbee0ce8efd9a7cf2/libs/ui/widgets/kis_color_label_selector_widget.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/widgets/kis_color_label_selector_widget.cpp?ref=10d6b04b2edb0e51171dc04bbee0ce8efd9a7cf2", "patch": "@@ -232,8 +232,12 @@ void drawToolButton(QWidget *widget, const QRect &rc, State state, const QColor\n         break;\n     };\n \n+\n     if (opt.state & (QStyle::State_Sunken | QStyle::State_On | QStyle::State_Raised)) {\n-        p.drawPrimitive(QStyle::PE_PanelButtonTool, opt);\n+\n+        const QRect borderRect = kisGrowRect(rc, 1);\n+        p.setPen(QPen(opt.palette.text().color(), 1, Qt::SolidLine, Qt::RoundCap, Qt::RoundJoin));\n+        p.drawRect(borderRect);\n     }\n \n     const int offset = qMax(1, rc.height() / 10);"}]}, {"sha": "226aaf25b01e8ea683384446110ad9c743eb5d63", "stats": {"total": 18, "additions": 9, "deletions": 9}, "files": [{"sha": "6dd7115b26b2bd15cb32e9b885f7e6ededc3d3db", "filename": "libs/ui/input/wintab/qxcbconnection.cpp", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/KDE/krita/blob/226aaf25b01e8ea683384446110ad9c743eb5d63/libs/ui/input/wintab/qxcbconnection.cpp", "raw_url": "https://github.com/KDE/krita/raw/226aaf25b01e8ea683384446110ad9c743eb5d63/libs/ui/input/wintab/qxcbconnection.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/wintab/qxcbconnection.cpp?ref=226aaf25b01e8ea683384446110ad9c743eb5d63", "patch": "@@ -690,7 +690,7 @@ void QWindowSystemInterface::handleWheelEvent(QWindow *tlw, ulong timestamp, con\n     // In addition high-resolution pixel-based deltas are also supported.\n     // Platforms that does not support these may pass a null point here.\n     // Angle deltas must always be sent in addition to pixel deltas.\n-    QWindowSystemInterfacePrivate::WheelEvent *e;\n+    QScopedPointer<QWindowSystemInterfacePrivate::WheelEvent> e;\n \n     // Pass Qt::ScrollBegin and Qt::ScrollEnd through\n     // even if the wheel delta is null.\n@@ -699,28 +699,28 @@ void QWindowSystemInterface::handleWheelEvent(QWindow *tlw, ulong timestamp, con\n \n     // Simple case: vertical deltas only:\n     if (angleDelta.y() != 0 && angleDelta.x() == 0) {\n-        e = new QWindowSystemInterfacePrivate::WheelEvent(tlw, timestamp, local, global, pixelDelta, angleDelta, angleDelta.y(), Qt::Vertical, mods, phase, source);\n-        processWheelEvent(e);\n+        e.reset(new QWindowSystemInterfacePrivate::WheelEvent(tlw, timestamp, local, global, pixelDelta, angleDelta, angleDelta.y(), Qt::Vertical, mods, phase, source));\n+        processWheelEvent(e.data());\n         return;\n     }\n \n     // Simple case: horizontal deltas only:\n     if (angleDelta.y() == 0 && angleDelta.x() != 0) {\n-        e = new QWindowSystemInterfacePrivate::WheelEvent(tlw, timestamp, local, global, pixelDelta, angleDelta, angleDelta.x(), Qt::Horizontal, mods, phase, source);\n-        processWheelEvent(e);\n+        e.reset(new QWindowSystemInterfacePrivate::WheelEvent(tlw, timestamp, local, global, pixelDelta, angleDelta, angleDelta.x(), Qt::Horizontal, mods, phase, source));\n+        processWheelEvent(e.data());\n         return;\n     }\n \n     // Both horizontal and vertical deltas: Send two wheel events.\n     // The first event contains the Qt 5 pixel and angle delta as points,\n     // and in addition the Qt 4 compatibility vertical angle delta.\n-    e = new QWindowSystemInterfacePrivate::WheelEvent(tlw, timestamp, local, global, pixelDelta, angleDelta, angleDelta.y(), Qt::Vertical, mods, phase, source);\n-    processWheelEvent(e);\n+    e.reset(new QWindowSystemInterfacePrivate::WheelEvent(tlw, timestamp, local, global, pixelDelta, angleDelta, angleDelta.y(), Qt::Vertical, mods, phase, source));\n+    processWheelEvent(e.data());\n \n     // The second event contains null pixel and angle points and the\n     // Qt 4 compatibility horizontal angle delta.\n-    e = new QWindowSystemInterfacePrivate::WheelEvent(tlw, timestamp, local, global, QPoint(), QPoint(), angleDelta.x(), Qt::Horizontal, mods, phase, source);\n-    processWheelEvent(e);\n+    e.reset(new QWindowSystemInterfacePrivate::WheelEvent(tlw, timestamp, local, global, QPoint(), QPoint(), angleDelta.x(), Qt::Horizontal, mods, phase, source));\n+    processWheelEvent(e.data());\n }\n \n void processWheelEvent(QWindowSystemInterfacePrivate::WheelEvent *e)"}]}, {"sha": "73d7888d42e3dd010a8b9493480c7700b932609a", "stats": {"total": 11, "additions": 9, "deletions": 2}, "files": [{"sha": "f51a080a87ecc0fccb93eed2ac5c58008e5243eb", "filename": "windows/mxe.txt", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/73d7888d42e3dd010a8b9493480c7700b932609a/windows/mxe.txt", "raw_url": "https://github.com/KDE/krita/raw/73d7888d42e3dd010a8b9493480c7700b932609a/windows/mxe.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/mxe.txt?ref=73d7888d42e3dd010a8b9493480c7700b932609a", "patch": "@@ -13,7 +13,8 @@ export PATH=$BUILDROOT/mxe/usr/bin:$BUILDROOT/mxe/usr/x86_64-w64-mingw32.shared/\n \n # note: poppler-qt5 and gsl don't work yet\n # Use  i686-w64-mingw32.shared for 32 bits builds\n-\n+# note: vc is 1.2, so we either need zagge's branch, or you need to build Vc 0.75\n+# yourself. Make sure you use -DBUILD_TESTING=OFF for Vc\n make MXE_TARGETS=x86_64-w64-mingw32.shared gcc boost curl eigen exiv2 expat fftw fontconfig freetype gettext ilmbase openexr jpeg lcms libpng libraw opencolorio openjpeg qt5 qtscript tiff vc zlib\n \n cd $BUILDROOT\n@@ -27,11 +28,17 @@ cd b\n x86_64-w64-mingw32.shared-cmake ../krita/3rdparty/ -DEXTERNALS_DOWNLOAD_DIR=$BUILDROOT/d -DINSTALL_ROOT=$BUILDROOT/mxe/usr/x86_64-w64-mingw32.shared -DMXE_TOOLCHAIN=${BUILDROOT}/mxe/usr/x86_64-w64-mingw32.shared/share/cmake/mxe-conf.cmake\n \n x86_64-w64-mingw32.shared-cmake  --build . --target ext_kwindowsystem\n-x86_64-w64-mingw32.shared-cmake  --build . --target ext_gsl\n x86_64-w64-mingw32.shared-cmake  --build . --target ext_poppler\n \n+# You might want to build gsl and vc 0.75 manually\n+\n \n # build krita\n cd ../build\n x86_64-w64-mingw32.shared-cmake ../krita  -DDEFINE_NO_DEPRECATED=1 -DBUILD_TESTING=OFF -DKDE4_BUILD_TESTS=OFF -DPACKAGERS_BUILD=ON \n make -j4 install\n+\n+# to test, configure wine\n+# WINEARCH=win64 WINEPREFIX=~/.wine64 winecfg\n+# Go to the bin directory and test krita:\n+# WINEPREFIX=~/.wine64 wine ./krita.exe"}]}, {"sha": "d23638275bae71d85e45b7495014b8739c33a0a2", "stats": {"total": 5, "additions": 2, "deletions": 3}, "files": [{"sha": "1badd51caf087f10f754ac55874a2006560b2329", "filename": "3rdparty/ext_poppler/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/d23638275bae71d85e45b7495014b8739c33a0a2/3rdparty/ext_poppler/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/d23638275bae71d85e45b7495014b8739c33a0a2/3rdparty/ext_poppler/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/3rdparty/ext_poppler/CMakeLists.txt?ref=d23638275bae71d85e45b7495014b8739c33a0a2", "patch": "@@ -5,9 +5,8 @@ ExternalProject_Add( ext_poppler\n \tURL_MD5 4554b04eedfd56c3a65be9f108e306f5\n \t\n \tINSTALL_DIR ${PREFIX_ext_poppler}\n-\tCMAKE_ARGS -DCMAKE_INSTALL_PREFIX=${PREFIX_ext_poppler} -DCMAKE_BUILD_TYPE=${GLOBAL_BUILD_TYPE} ${GLOBAL_PROFILE}\n+\tCMAKE_ARGS -DCMAKE_INSTALL_PREFIX=${PREFIX_ext_poppler} -DCMAKE_BUILD_TYPE=${GLOBAL_BUILD_TYPE} ${GLOBAL_PROFILE} -DBUILD_GTK_TESTS=OFF -DBUILD_QT5_TESTS=FALSE -BUILD_CPP_TESTS=FALSE  -DENABLE_UTILS=FALSE -DENABLE_GLIB=FALSE \n \t\n-\tDEPENDS ext_freetype ext_jpeg ext_png ext_tiff ext_zlib ext_lcms2\n-        UPDATE_COMMAND \"\"\n+    UPDATE_COMMAND \"\"\n \tALWAYS 0\n )"}]}, {"sha": "9eed0641bd6f2fa94664f9d5005e704a613e449e", "stats": {"total": 4, "additions": 1, "deletions": 3}, "files": [{"sha": "b1b72cc96420946fb2bc34a48b03e812bb36190a", "filename": "winquirks/netinet/in.h", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/9eed0641bd6f2fa94664f9d5005e704a613e449e/winquirks/netinet/in.h", "raw_url": "https://github.com/KDE/krita/raw/9eed0641bd6f2fa94664f9d5005e704a613e449e/winquirks/netinet/in.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/winquirks/netinet/in.h?ref=9eed0641bd6f2fa94664f9d5005e704a613e449e", "patch": "@@ -1,7 +1,6 @@\n #ifndef QUIRK_NETINET_IN_H\n #define QUIRK_NETINET_IN_H\n \n-#if defined (_MSC_VER)\n /*\n  * this is used for htonl mostly.\n  *\n@@ -12,6 +11,5 @@\n  */\n \n #pragma message(\"winquirk: no netinet/in.h!\")\n-#include <Winsock2.h>\n-#endif\n+#include <winsock2.h>\n #endif"}]}, {"sha": "cdc19cbb7ae34859660f9b3b7b8edd51ea1c7c3a", "stats": {"total": 17, "additions": 14, "deletions": 3}, "files": [{"sha": "68a164c47b7f6c8d57e39017731909650531529a", "filename": "windows/mxe.txt", "status": "modified", "additions": 14, "deletions": 3, "changes": 17, "blob_url": "https://github.com/KDE/krita/blob/cdc19cbb7ae34859660f9b3b7b8edd51ea1c7c3a/windows/mxe.txt", "raw_url": "https://github.com/KDE/krita/raw/cdc19cbb7ae34859660f9b3b7b8edd51ea1c7c3a/windows/mxe.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/mxe.txt?ref=cdc19cbb7ae34859660f9b3b7b8edd51ea1c7c3a", "patch": "@@ -9,7 +9,7 @@ mkdir cross/krita-build\n \n git clone git@github.com:boudewijnrempt/mxe.git\n cd mxe\n-export PATH=$BUILDROOT/mxe/usr:$BUILDROOT/mxe/usr/x86_64-w64-mingw32.shared/qt5/bin:$PATH\n+export PATH=$BUILDROOT/mxe/usr/bin:$BUILDROOT/mxe/usr/x86_64-w64-mingw32.shared/qt5/bin:$PATH\n \n # note: poppler-qt5 and gsl don't work yet\n # Use  i686-w64-mingw32.shared for 32 bits builds\n@@ -19,8 +19,19 @@ make MXE_TARGETS=x86_64-w64-mingw32.shared gcc boost curl eigen exiv2 expat fftw\n cd $BUILDROOT\n git clone git://anongit.kde.org/krita.git\n \n+\n+# build the deps that aren't in mxe\n+\n cd b\n \n-x86_64-w64-mingw32.shared-cmake ../krita/3rdparty/ -DEXTERNALS_DOWNLOAD_DIR=$BUILDROOT/d -DINSTALL_ROOT=$BUILDROOT/mxe/usr/x86_64-w64-mingw32.shared -DMXE_TOOLCHAIN=${BUILDROOT}/mxe/usr/i686-w64-mingw32.shared/share/cmake/mxe-conf.cmake\n+x86_64-w64-mingw32.shared-cmake ../krita/3rdparty/ -DEXTERNALS_DOWNLOAD_DIR=$BUILDROOT/d -DINSTALL_ROOT=$BUILDROOT/mxe/usr/x86_64-w64-mingw32.shared -DMXE_TOOLCHAIN=${BUILDROOT}/mxe/usr/x86_64-w64-mingw32.shared/share/cmake/mxe-conf.cmake\n+\n+x86_64-w64-mingw32.shared-cmake  --build . --target ext_kwindowsystem\n+x86_64-w64-mingw32.shared-cmake  --build . --target ext_gsl\n+x86_64-w64-mingw32.shared-cmake  --build . --target ext_poppler\n+\n \n-cmake --build . --target ext_kwindowsystem\n+# build krita\n+cd ../build\n+x86_64-w64-mingw32.shared-cmake ../krita  -DDEFINE_NO_DEPRECATED=1 -DBUILD_TESTING=OFF -DKDE4_BUILD_TESTS=OFF -DPACKAGERS_BUILD=ON \n+make -j4 install"}]}, {"sha": "01efc761e85b2223ee240c50ead242b97ec1f935", "stats": {"total": 43, "additions": 31, "deletions": 12}, "files": [{"sha": "88ee17a8927a1ad899059a36f2c3cfa21f1efa68", "filename": "plugins/tools/tool_transform2/kis_perspective_transform_strategy.cpp", "status": "modified", "additions": 18, "deletions": 9, "changes": 27, "blob_url": "https://github.com/KDE/krita/blob/01efc761e85b2223ee240c50ead242b97ec1f935/plugins/tools/tool_transform2/kis_perspective_transform_strategy.cpp", "raw_url": "https://github.com/KDE/krita/raw/01efc761e85b2223ee240c50ead242b97ec1f935/plugins/tools/tool_transform2/kis_perspective_transform_strategy.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_transform2/kis_perspective_transform_strategy.cpp?ref=01efc761e85b2223ee240c50ead242b97ec1f935", "patch": "@@ -214,11 +214,6 @@ void KisPerspectiveTransformStrategy::paint(QPainter &gc)\n     gc.restore();\n \n     // Draw Handles\n-    QRectF handleRect =\n-        KisTransformUtils::handleRect(KisTransformUtils::handleVisualRadius,\n-                                      m_d->handlesTransform,\n-                                      m_d->transaction.originalRect());\n-\n     QPainterPath handles;\n \n     handles.moveTo(m_d->transaction.originalTopLeft());\n@@ -227,11 +222,20 @@ void KisPerspectiveTransformStrategy::paint(QPainter &gc)\n     handles.lineTo(m_d->transaction.originalBottomLeft());\n     handles.lineTo(m_d->transaction.originalTopLeft());\n \n-    handles.addRect(handleRect.translated(m_d->transaction.originalTopLeft()));\n-    handles.addRect(handleRect.translated(m_d->transaction.originalTopRight()));\n-    handles.addRect(handleRect.translated(m_d->transaction.originalBottomLeft()));\n-    handles.addRect(handleRect.translated(m_d->transaction.originalBottomRight()));\n \n+    auto addHandleRectFunc =\n+        [&](const QPointF &pt) {\n+            handles.addRect(\n+                KisTransformUtils::handleRect(KisTransformUtils::handleVisualRadius,\n+                                              m_d->handlesTransform,\n+                                              m_d->transaction.originalRect(), pt)\n+                .translated(pt));\n+    };\n+\n+    addHandleRectFunc(m_d->transaction.originalTopLeft());\n+    addHandleRectFunc(m_d->transaction.originalTopRight());\n+    addHandleRectFunc(m_d->transaction.originalBottomLeft());\n+    addHandleRectFunc(m_d->transaction.originalBottomRight());\n \n     gc.save();\n \n@@ -264,6 +268,11 @@ void KisPerspectiveTransformStrategy::paint(QPainter &gc)\n     { // painting perspective handles\n         QPainterPath perspectiveHandles;\n \n+        QRectF handleRect =\n+            KisTransformUtils::handleRect(KisTransformUtils::handleVisualRadius,\n+                                          QTransform(),\n+                                          m_d->transaction.originalRect());\n+\n         if (m_d->transformedHandles.xVanishingExists) {\n             QRectF rc = handleRect.translated(m_d->transformedHandles.xVanishing);\n             perspectiveHandles.addEllipse(rc);"}, {"sha": "998e8084bf877eb8b2b7484d046b62dd10222b73", "filename": "plugins/tools/tool_transform2/kis_transform_utils.cpp", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/KDE/krita/blob/01efc761e85b2223ee240c50ead242b97ec1f935/plugins/tools/tool_transform2/kis_transform_utils.cpp", "raw_url": "https://github.com/KDE/krita/raw/01efc761e85b2223ee240c50ead242b97ec1f935/plugins/tools/tool_transform2/kis_transform_utils.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_transform2/kis_transform_utils.cpp?ref=01efc761e85b2223ee240c50ead242b97ec1f935", "patch": "@@ -63,11 +63,11 @@ qreal KisTransformUtils::effectiveSize(const QRectF &rc) {\n     return 0.5 * (rc.width(), rc.height());\n }\n \n-QRectF KisTransformUtils::handleRect(qreal radius, const QTransform &t, const QRectF &limitingRect, qreal *dOut) {\n+QRectF handleRectImpl(qreal radius, const QTransform &t, const QRectF &limitingRect, const QPointF &basePoint, qreal *dOut) {\n     qreal handlesExtraScale =\n-        scaleFromPerspectiveMatrix(t, limitingRect.center());\n+        KisTransformUtils::scaleFromPerspectiveMatrix(t, basePoint);\n \n-    const qreal maxD = 0.2 * effectiveSize(limitingRect);\n+    const qreal maxD = 0.2 * KisTransformUtils::effectiveSize(limitingRect);\n     const qreal d = qMin(maxD, radius / handlesExtraScale);\n \n     QRectF handleRect(-0.5 * d, -0.5 * d, d, d);\n@@ -77,6 +77,15 @@ QRectF KisTransformUtils::handleRect(qreal radius, const QTransform &t, const QR\n     }\n \n     return handleRect;\n+\n+}\n+\n+QRectF KisTransformUtils::handleRect(qreal radius, const QTransform &t, const QRectF &limitingRect, qreal *dOut) {\n+    return handleRectImpl(radius, t, limitingRect, limitingRect.center(), dOut);\n+}\n+\n+QRectF KisTransformUtils::handleRect(qreal radius, const QTransform &t, const QRectF &limitingRect, const QPointF &basePoint) {\n+    return handleRectImpl(radius, t, limitingRect, basePoint, 0);\n }\n \n QPointF KisTransformUtils::clipInRect(QPointF p, QRectF r)"}, {"sha": "d50b6f38ec7c1addf98aab4739c5105dcaae6402", "filename": "plugins/tools/tool_transform2/kis_transform_utils.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/01efc761e85b2223ee240c50ead242b97ec1f935/plugins/tools/tool_transform2/kis_transform_utils.h", "raw_url": "https://github.com/KDE/krita/raw/01efc761e85b2223ee240c50ead242b97ec1f935/plugins/tools/tool_transform2/kis_transform_utils.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_transform2/kis_transform_utils.h?ref=01efc761e85b2223ee240c50ead242b97ec1f935", "patch": "@@ -63,6 +63,7 @@ class KisTransformUtils\n     static qreal effectiveSize(const QRectF &rc);\n \n     static QRectF handleRect(qreal radius, const QTransform &t, const QRectF &limitingSize, qreal *d = 0);\n+    static QRectF handleRect(qreal radius, const QTransform &t, const QRectF &limitingRect, const QPointF &basePoint);\n \n     static QPointF clipInRect(QPointF p, QRectF r);\n "}]}, {"sha": "0d2747e8fbfc0e352b1b0d8af63280d3eab5671e", "stats": {"total": 44, "additions": 26, "deletions": 18}, "files": [{"sha": "4971d540070dfa81028a702b71da39f52115c2a7", "filename": "plugins/tools/tool_transform2/strokes/transform_stroke_strategy.cpp", "status": "modified", "additions": 26, "deletions": 18, "changes": 44, "blob_url": "https://github.com/KDE/krita/blob/0d2747e8fbfc0e352b1b0d8af63280d3eab5671e/plugins/tools/tool_transform2/strokes/transform_stroke_strategy.cpp", "raw_url": "https://github.com/KDE/krita/raw/0d2747e8fbfc0e352b1b0d8af63280d3eab5671e/plugins/tools/tool_transform2/strokes/transform_stroke_strategy.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_transform2/strokes/transform_stroke_strategy.cpp?ref=0d2747e8fbfc0e352b1b0d8af63280d3eab5671e", "patch": "@@ -32,6 +32,8 @@\n #include <kis_transform_mask.h>\n #include \"kis_transform_mask_adapter.h\"\n #include \"kis_transform_utils.h\"\n+#include \"kis_abstract_projection_plane.h\"\n+#include \"kis_recalculate_transform_mask_job.h\"\n \n #include \"kis_projection_leaf.h\"\n \n@@ -48,34 +50,40 @@ class ModifyTransformMaskCommand : public KUndo2Command {\n     void redo() {\n         m_mask->setTransformParams(m_params);\n \n-        /**\n-         * NOTE: this code \"duplicates\" the functionality provided\n-         * by KisRecalculateTransformMaskJob, but there is not much\n-         * reason for starting a separate stroke when a transformation\n-         * has happened\n-         */\n-\n-        m_mask->recaclulateStaticImage();\n-        updateMask();\n+        updateMask(m_params->isHidden());\n     }\n \n     void undo() {\n         m_mask->setTransformParams(m_oldParams);\n \n-        m_mask->recaclulateStaticImage();\n-        updateMask();\n+        updateMask(m_oldParams->isHidden());\n     }\n \n private:\n-    void updateMask() {\n-        QRect updateRect = m_mask->extent();\n+    void updateMask(bool isHidden) {\n+        /**\n+         * Depending on whether the mask is hidden we should either\n+         * update it entirely via the setDirty() call, or we can use a\n+         * lightweight approach by directly regenerating the\n+         * precalculated static image using\n+         * KisRecalculateTransformMaskJob.\n+         */\n \n-        KisNodeSP parent = m_mask->parent();\n-        if (parent && parent->original()) {\n-            updateRect |= parent->original()->defaultBounds()->bounds();\n-        }\n+        if (!isHidden) {\n+            KisRecalculateTransformMaskJob updateJob(m_mask);\n+            updateJob.run();\n+        } else {\n+            m_mask->recaclulateStaticImage();\n+\n+            QRect updateRect = m_mask->extent();\n \n-        m_mask->setDirty(updateRect);\n+            KisNodeSP parent = m_mask->parent();\n+            if (parent && parent->original()) {\n+                updateRect |= parent->original()->defaultBounds()->bounds();\n+            }\n+\n+            m_mask->setDirty(updateRect);\n+        }\n     }\n \n private:"}]}, {"sha": "5d12f4a4656b154f5c50712791adc32f6b75dfcb", "stats": {"total": 10, "additions": 9, "deletions": 1}, "files": [{"sha": "7ea2d3a2d1a2605b7d80b0b3c373b31ad35096b0", "filename": "libs/image/kis_recalculate_transform_mask_job.cpp", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/KDE/krita/blob/5d12f4a4656b154f5c50712791adc32f6b75dfcb/libs/image/kis_recalculate_transform_mask_job.cpp", "raw_url": "https://github.com/KDE/krita/raw/5d12f4a4656b154f5c50712791adc32f6b75dfcb/libs/image/kis_recalculate_transform_mask_job.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_recalculate_transform_mask_job.cpp?ref=5d12f4a4656b154f5c50712791adc32f6b75dfcb", "patch": "@@ -22,6 +22,7 @@\n #include \"kis_debug.h\"\n #include \"kis_layer.h\"\n #include \"kis_image.h\"\n+#include \"kis_abstract_projection_plane.h\"\n \n \n KisRecalculateTransformMaskJob::KisRecalculateTransformMaskJob(KisTransformMaskSP mask)\n@@ -57,7 +58,14 @@ void KisRecalculateTransformMaskJob::run()\n     KisImageSP image = layer->image();\n     Q_ASSERT(image);\n \n-    image->requestProjectionUpdateNoFilthy(layer, layer->extent(), image->bounds());\n+    /**\n+     * When we call requestProjectionUpdateNoFilthy() on a layer,\n+     * its masks' change rect is not counted, because it is considered\n+     * to be N_ABOVE_FILTHY. Therefore, we should expand the dirty\n+     * rect manually to get the correct update\n+     */\n+    QRect updateRect = layer->projectionPlane()->changeRect(layer->extent(), KisLayer::N_FILTHY);\n+    image->requestProjectionUpdateNoFilthy(layer, updateRect, image->bounds());\n }\n \n int KisRecalculateTransformMaskJob::levelOfDetail() const"}]}, {"sha": "241ddd4ec56b58172e631596696c4ea369e52a05", "stats": {"total": 474, "additions": 419, "deletions": 55}, "files": [{"sha": "d1cf2499de96015c264fb0686abe28f02991f2f3", "filename": "libs/image/kis_async_merger.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_async_merger.cpp", "raw_url": "https://github.com/KDE/krita/raw/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_async_merger.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_async_merger.cpp?ref=241ddd4ec56b58172e631596696c4ea369e52a05", "patch": "@@ -52,7 +52,7 @@\n \n #ifdef DEBUG_MERGER\n #define DEBUG_NODE_ACTION(message, type, leaf, rect)            \\\n-    dbgKrita << message << type << \":\" << leaf->node()->name() << rect\n+    qDebug() << message << type << \":\" << leaf->node()->name() << rect\n #else\n #define DEBUG_NODE_ACTION(message, type, leaf, rect)\n #endif"}, {"sha": "e1ab4362a184bd81c3691ebeb7473f1be95463be", "filename": "libs/image/kis_base_rects_walker.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_base_rects_walker.h", "raw_url": "https://github.com/KDE/krita/raw/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_base_rects_walker.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_base_rects_walker.h?ref=241ddd4ec56b58172e631596696c4ea369e52a05", "patch": "@@ -297,7 +297,7 @@ class KRITAIMAGE_EXPORT KisBaseRectsWalker : public KisShared\n     virtual void registerChangeRect(KisProjectionLeafSP leaf, NodePosition position) {\n         // We do not work with masks here. It is KisLayer's job.\n         if(!leaf->isLayer()) return;\n-        if(!leaf->visible()) return;\n+        if(!(position & N_FILTHY) && !leaf->visible()) return;\n \n         QRect currentChangeRect = leaf->projectionPlane()->changeRect(m_resultChangeRect,\n                                                                       convertPositionToFilthy(position));"}, {"sha": "a15cd67ac53787d869badfe7d06d4fc73cd1bee5", "filename": "libs/image/kis_cage_transform_worker.cpp", "status": "modified", "additions": 60, "deletions": 0, "changes": 60, "blob_url": "https://github.com/KDE/krita/blob/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_cage_transform_worker.cpp", "raw_url": "https://github.com/KDE/krita/raw/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_cage_transform_worker.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_cage_transform_worker.cpp?ref=241ddd4ec56b58172e631596696c4ea369e52a05", "patch": "@@ -27,6 +27,7 @@\n #include \"kis_selection.h\"\n #include \"kis_painter.h\"\n #include \"kis_image.h\"\n+#include \"krita_utils.h\"\n \n #include <qnumeric.h>\n \n@@ -281,6 +282,65 @@ struct KisCageTransformWorker::Private::MapIndexesOp {\n     QPolygonF m_srcCagePolygon;\n };\n \n+QRect KisCageTransformWorker::approxChangeRect(const QRect &rc)\n+{\n+    const int margin = 0.30;\n+\n+    QVector<QPointF> cageSamplePoints;\n+\n+    const int minStep = 3;\n+    const int maxSamples = 200;\n+\n+    const int totalPixels = rc.width() * rc.height();\n+    const int realStep = qMax(minStep, totalPixels / maxSamples);\n+    const QPolygonF cagePolygon(m_d->origCage);\n+\n+    for (int i = 0; i < totalPixels; i += realStep) {\n+        const int x = rc.x() + i % rc.width();\n+        const int y = rc.y() + i / rc.width();\n+\n+        const QPointF pt(x, y);\n+        if (cagePolygon.containsPoint(pt, Qt::OddEvenFill)) {\n+            cageSamplePoints << pt;\n+        }\n+    }\n+\n+    if (cageSamplePoints.isEmpty()) {\n+        return rc;\n+    }\n+\n+    KisGreenCoordinatesMath cage;\n+    cage.precalculateGreenCoordinates(m_d->origCage, cageSamplePoints);\n+    cage.generateTransformedCageNormals(m_d->transfCage);\n+\n+    const int numValidPoints = cageSamplePoints.size();\n+    QVector<QPointF> transformedPoints(numValidPoints);\n+\n+    int failedPoints = 0;\n+\n+    for (int i = 0; i < numValidPoints; i++) {\n+        transformedPoints[i] = cage.transformedPoint(i, m_d->transfCage);\n+\n+        if (qIsNaN(transformedPoints[i].x()) ||\n+            qIsNaN(transformedPoints[i].y())) {\n+\n+            transformedPoints[i] = cageSamplePoints[i];\n+            failedPoints++;\n+        }\n+    }\n+\n+    QRect resultRect =\n+        KritaUtils::approximateRectFromPoints(transformedPoints).toAlignedRect();\n+\n+    return KisAlgebra2D::blowRect(resultRect | rc, margin);\n+}\n+\n+QRect KisCageTransformWorker::approxNeedRect(const QRect &rc, const QRect &fullBounds)\n+{\n+    Q_UNUSED(rc);\n+    return fullBounds;\n+}\n+\n void KisCageTransformWorker::run()\n {\n     if (m_d->isGridEmpty()) return;"}, {"sha": "765691304387d5160831845356085367a93c82aa", "filename": "libs/image/kis_cage_transform_worker.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_cage_transform_worker.h", "raw_url": "https://github.com/KDE/krita/raw/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_cage_transform_worker.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_cage_transform_worker.h?ref=241ddd4ec56b58172e631596696c4ea369e52a05", "patch": "@@ -45,6 +45,9 @@ class KRITAIMAGE_EXPORT KisCageTransformWorker\n     void setTransformedCage(const QVector<QPointF> &transformedCage);\n     void run();\n \n+    QRect approxChangeRect(const QRect &rc);\n+    QRect approxNeedRect(const QRect &rc, const QRect &fullBounds);\n+\n     QImage runOnQImage(QPointF *newOffset);\n \n private:"}, {"sha": "18a197b6b208d3eabd8f8d2ac55547fdd3685083", "filename": "libs/image/kis_liquify_transform_worker.cpp", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/KDE/krita/blob/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_liquify_transform_worker.cpp", "raw_url": "https://github.com/KDE/krita/raw/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_liquify_transform_worker.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_liquify_transform_worker.cpp?ref=241ddd4ec56b58172e631596696c4ea369e52a05", "patch": "@@ -20,6 +20,7 @@\n \n #include \"kis_grid_interpolation_tools.h\"\n #include \"kis_dom_utils.h\"\n+#include \"krita_utils.h\"\n \n \n struct Q_DECL_HIDDEN KisLiquifyTransformWorker::Private\n@@ -428,6 +429,33 @@ void KisLiquifyTransformWorker::run(KisPaintDeviceSP device)\n                                                     m_d->transformedPoints);\n }\n \n+QRect KisLiquifyTransformWorker::approxChangeRect(const QRect &rc)\n+{\n+    const int margin = 0.05;\n+\n+    /**\n+     * Here we just return the full area occupied by the transformed grid.\n+     * We sample grid points for not doing too much work.\n+     */\n+    const int maxSamplePoints = 200;\n+    const int minStep = 3;\n+    const int step = qMax(minStep, m_d->transformedPoints.size() / maxSamplePoints);\n+\n+    QVector<QPoint> samplePoints;\n+    for (int i = 0; i < m_d->transformedPoints.size(); i += step) {\n+        samplePoints << m_d->transformedPoints[i].toPoint();\n+    }\n+\n+    QRect resultRect = KritaUtils::approximateRectFromPoints(samplePoints);\n+    return KisAlgebra2D::blowRect(resultRect | rc, margin);\n+}\n+\n+QRect KisLiquifyTransformWorker::approxNeedRect(const QRect &rc, const QRect &fullBounds)\n+{\n+    Q_UNUSED(rc);\n+    return fullBounds;\n+}\n+\n #include <functional>\n #include <QTransform>\n "}, {"sha": "83d7ab501630eaf042fc4ec0049401d00e64f4ad", "filename": "libs/image/kis_liquify_transform_worker.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_liquify_transform_worker.h", "raw_url": "https://github.com/KDE/krita/raw/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_liquify_transform_worker.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_liquify_transform_worker.h?ref=241ddd4ec56b58172e631596696c4ea369e52a05", "patch": "@@ -84,6 +84,9 @@ class KRITAIMAGE_EXPORT KisLiquifyTransformWorker : boost::equality_comparable<K\n \n     void translate(const QPointF &offset);\n \n+    QRect approxChangeRect(const QRect &rc);\n+    QRect approxNeedRect(const QRect &rc, const QRect &fullBounds);\n+\n private:\n     struct Private;\n     const QScopedPointer<Private> m_d;"}, {"sha": "5a928794b43a52b9b392fa9875de216e28dc9588", "filename": "libs/image/kis_transform_mask.cpp", "status": "modified", "additions": 35, "deletions": 20, "changes": 55, "blob_url": "https://github.com/KDE/krita/blob/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_transform_mask.cpp", "raw_url": "https://github.com/KDE/krita/raw/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_transform_mask.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_transform_mask.cpp?ref=241ddd4ec56b58172e631596696c4ea369e52a05", "patch": "@@ -292,27 +292,35 @@ QRect KisTransformMask::changeRect(const QRect &rect, PositionToFilthy pos) cons\n      * on the higher/lower level\n      */\n     if (rect.isEmpty()) return rect;\n-    if (!m_d->params->isAffine()) return rect;\n \n-    QRect bounds;\n-    QRect interestRect;\n-    KisNodeSP parentNode = parent();\n+    QRect changeRect = rect;\n \n-    if (parentNode) {\n-        bounds = parentNode->original()->defaultBounds()->bounds();\n-        interestRect = parentNode->original()->extent();\n-    } else {\n-        bounds = QRect(0,0,777,777);\n-        interestRect = QRect(0,0,888,888);\n-        warnKrita << \"WARNING: transform mask has no parent (change rect).\"\n-                   << \"Cannot run safe transformations.\"\n-                   << \"Will limit bounds to\" << ppVar(bounds);\n-    }\n+    if (m_d->params->isAffine()) {\n+        QRect bounds;\n+        QRect interestRect;\n+        KisNodeSP parentNode = parent();\n+\n+        if (parentNode) {\n+            bounds = parentNode->original()->defaultBounds()->bounds();\n+            interestRect = parentNode->original()->extent();\n+        } else {\n+            bounds = QRect(0,0,777,777);\n+            interestRect = QRect(0,0,888,888);\n+            warnKrita << \"WARNING: transform mask has no parent (change rect).\"\n+                      << \"Cannot run safe transformations.\"\n+                      << \"Will limit bounds to\" << ppVar(bounds);\n+        }\n \n-    const QRect limitingRect = KisAlgebra2D::blowRect(bounds, m_d->offBoundsReadArea);\n+        const QRect limitingRect = KisAlgebra2D::blowRect(bounds, m_d->offBoundsReadArea);\n+\n+        KisSafeTransform transform(m_d->worker.forwardTransform(), limitingRect, interestRect);\n+        changeRect = transform.mapRectForward(rect);\n+    } else {\n+        QRect interestRect;\n+        interestRect = parent() ? parent()->original()->extent() : QRect();\n \n-    KisSafeTransform transform(m_d->worker.forwardTransform(), limitingRect, interestRect);\n-    QRect changeRect = transform.mapRectForward(rect);\n+        changeRect = m_d->params->nonAffineChangeRect(rect);\n+    }\n \n     return changeRect;\n }\n@@ -343,10 +351,17 @@ QRect KisTransformMask::needRect(const QRect& rect, PositionToFilthy pos) const\n                    << \"Will limit bounds to\" << ppVar(bounds);\n     }\n \n-    const QRect limitingRect = KisAlgebra2D::blowRect(bounds, m_d->offBoundsReadArea);\n+    QRect needRect = rect;\n+\n+    if (m_d->params->isAffine()) {\n+        const QRect limitingRect = KisAlgebra2D::blowRect(bounds, m_d->offBoundsReadArea);\n+\n+        KisSafeTransform transform(m_d->worker.forwardTransform(), limitingRect, interestRect);\n+        needRect = transform.mapRectBackward(rect);\n \n-    KisSafeTransform transform(m_d->worker.forwardTransform(), limitingRect, interestRect);\n-    QRect needRect = transform.mapRectBackward(rect);\n+    } else {\n+        needRect = m_d->params->nonAffineNeedRect(rect, interestRect);\n+    }\n \n     return needRect;\n }"}, {"sha": "3dff7b1cea08b969ea84aa7fdbb4ae52447ef1d8", "filename": "libs/image/kis_transform_mask_params_interface.cpp", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_transform_mask_params_interface.cpp", "raw_url": "https://github.com/KDE/krita/raw/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_transform_mask_params_interface.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_transform_mask_params_interface.cpp?ref=241ddd4ec56b58172e631596696c4ea369e52a05", "patch": "@@ -136,6 +136,17 @@ void KisDumbTransformMaskParams::translate(const QPointF &offset)\n     m_d->transform *= QTransform::fromTranslate(offset.x(), offset.y());\n }\n \n+QRect KisDumbTransformMaskParams::nonAffineChangeRect(const QRect &rc)\n+{\n+    return rc;\n+}\n+\n+QRect KisDumbTransformMaskParams::nonAffineNeedRect(const QRect &rc, const QRect &srcBounds)\n+{\n+    Q_UNUSED(srcBounds);\n+    return rc;\n+}\n+\n QTransform KisDumbTransformMaskParams::testingGetTransform() const\n {\n     return m_d->transform;"}, {"sha": "70cf8dcebe60ed99f5861eae2965297478b8e7da", "filename": "libs/image/kis_transform_mask_params_interface.h", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_transform_mask_params_interface.h", "raw_url": "https://github.com/KDE/krita/raw/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_transform_mask_params_interface.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_transform_mask_params_interface.h?ref=241ddd4ec56b58172e631596696c4ea369e52a05", "patch": "@@ -43,6 +43,9 @@ class KRITAIMAGE_EXPORT KisTransformMaskParamsInterface\n     virtual void toXML(QDomElement *e) const = 0;\n \n     virtual void translate(const QPointF &offset) = 0;\n+\n+    virtual QRect nonAffineChangeRect(const QRect &rc) = 0;\n+    virtual QRect nonAffineNeedRect(const QRect &rc, const QRect &srcBounds) = 0;\n };\n \n \n@@ -72,6 +75,9 @@ class KRITAIMAGE_EXPORT KisDumbTransformMaskParams : public KisTransformMaskPara\n     QTransform testingGetTransform() const;\n     void testingSetTransform(const QTransform &t);\n \n+    QRect nonAffineChangeRect(const QRect &rc);\n+    QRect nonAffineNeedRect(const QRect &rc, const QRect &srcBounds);\n+\n private:\n     struct Private;\n     const QScopedPointer<Private> m_d;"}, {"sha": "c2d2c496b71631ceb418abb43f3eff468ca0ab9a", "filename": "libs/image/kis_warptransform_worker.cc", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/KDE/krita/blob/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_warptransform_worker.cc", "raw_url": "https://github.com/KDE/krita/raw/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_warptransform_worker.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_warptransform_worker.cc?ref=241ddd4ec56b58172e631596696c4ea369e52a05", "patch": "@@ -262,6 +262,24 @@ void KisWarpTransformWorker::run()\n                                     srcBounds, pixelPrecision);\n }\n \n+#include \"krita_utils.h\"\n+\n+QRect KisWarpTransformWorker::approxChangeRect(const QRect &rc)\n+{\n+    const qreal margin = 0.05;\n+\n+    FunctionTransformOp functionOp(m_warpMathFunction, m_origPoint, m_transfPoint, m_alpha);\n+    QRect resultRect = KritaUtils::approximateRectWithPointTransform(rc, functionOp);\n+\n+    return KisAlgebra2D::blowRect(resultRect, margin);\n+}\n+\n+QRect KisWarpTransformWorker::approxNeedRect(const QRect &rc, const QRect &fullBounds)\n+{\n+    Q_UNUSED(rc);\n+    return fullBounds;\n+}\n+\n QImage KisWarpTransformWorker::transformQImage(WarpType warpType,\n                                                const QVector<QPointF> &origPoint,\n                                                const QVector<QPointF> &transfPoint,"}, {"sha": "4857d3ddc888e9d87730a228f74b44a41cd0ad7d", "filename": "libs/image/kis_warptransform_worker.h", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_warptransform_worker.h", "raw_url": "https://github.com/KDE/krita/raw/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/kis_warptransform_worker.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_warptransform_worker.h?ref=241ddd4ec56b58172e631596696c4ea369e52a05", "patch": "@@ -63,9 +63,12 @@ class KRITAIMAGE_EXPORT KisWarpTransformWorker : public QObject\n     // Prepare the transformation on dev\n     KisWarpTransformWorker(WarpType warpType, KisPaintDeviceSP dev, QVector<QPointF> origPoint, QVector<QPointF> transfPoint, qreal alpha, KoUpdater *progress);\n     ~KisWarpTransformWorker();\n-    // Perform the prepated transformation\n+    // Perform the prepared transformation\n     void run();\n \n+    QRect approxChangeRect(const QRect &rc);\n+    QRect approxNeedRect(const QRect &rc, const QRect &fullBounds);\n+\n private:\n     struct FunctionTransformOp;\n     typedef QPointF (*WarpMathFunction)(QPointF, QVector<QPointF>, QVector<QPointF>, qreal);"}, {"sha": "7be7cd4a767185f074d57f867680d0d47ef7ce92", "filename": "libs/image/krita_utils.cpp", "status": "modified", "additions": 96, "deletions": 0, "changes": 96, "blob_url": "https://github.com/KDE/krita/blob/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/krita_utils.cpp", "raw_url": "https://github.com/KDE/krita/raw/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/krita_utils.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/krita_utils.cpp?ref=241ddd4ec56b58172e631596696c4ea369e52a05", "patch": "@@ -27,6 +27,11 @@\n #include <QPen>\n #include <QPainter>\n \n+#include <boost/accumulators/accumulators.hpp>\n+#include <boost/accumulators/statistics/stats.hpp>\n+#include <boost/accumulators/statistics/min.hpp>\n+#include <boost/accumulators/statistics/max.hpp>\n+#include \"kis_algebra_2d.h\"\n \n #include <KoColorSpaceRegistry.h>\n \n@@ -81,6 +86,97 @@ namespace KritaUtils\n         return patches;\n     }\n \n+    template <class Rect, class Point>\n+    QVector<Point> sampleRectWithPoints(const Rect &rect)\n+    {\n+        QVector<Point> points;\n+\n+        Point m1 = 0.5 * (rect.topLeft() + rect.topRight());\n+        Point m2 = 0.5 * (rect.bottomLeft() + rect.bottomRight());\n+\n+        points << rect.topLeft();\n+        points << m1;\n+        points << rect.topRight();\n+\n+        points << 0.5 * (rect.topLeft() + rect.bottomLeft());\n+        points << 0.5 * (m1 + m2);\n+        points << 0.5 * (rect.topRight() + rect.bottomRight());\n+\n+        points << rect.bottomLeft();\n+        points << m2;\n+        points << rect.bottomRight();\n+\n+        return points;\n+    }\n+\n+    QVector<QPoint> sampleRectWithPoints(const QRect &rect)\n+    {\n+        return sampleRectWithPoints<QRect, QPoint>(rect);\n+    }\n+\n+    QVector<QPointF> sampleRectWithPoints(const QRectF &rect)\n+    {\n+        return sampleRectWithPoints<QRectF, QPointF>(rect);\n+    }\n+\n+\n+    template <class Rect, class Point, bool alignPixels>\n+    Rect approximateRectFromPointsImpl(const QVector<Point> &points)\n+    {\n+        using namespace boost::accumulators;\n+        accumulator_set<qreal, stats<tag::min, tag::max > > accX;\n+        accumulator_set<qreal, stats<tag::min, tag::max > > accY;\n+\n+        Q_FOREACH (const Point &pt, points) {\n+            accX(pt.x());\n+            accY(pt.y());\n+        }\n+\n+        Rect resultRect;\n+\n+        if (alignPixels) {\n+            resultRect.setCoords(std::floor(min(accX)), std::floor(min(accY)),\n+                                 std::ceil(max(accX)), std::ceil(max(accY)));\n+        } else {\n+            resultRect.setCoords(min(accX), min(accY),\n+                                 max(accX), max(accY));\n+        }\n+\n+        return resultRect;\n+    }\n+\n+    QRect approximateRectFromPoints(const QVector<QPoint> &points)\n+    {\n+        return approximateRectFromPointsImpl<QRect, QPoint, true>(points);\n+    }\n+\n+    QRectF approximateRectFromPoints(const QVector<QPointF> &points)\n+    {\n+        return approximateRectFromPointsImpl<QRectF, QPointF, false>(points);\n+    }\n+\n+    QRect approximateRectWithPointTransform(const QRect &rect, std::function<QPointF(QPointF)> func)\n+    {\n+        QVector<QPoint> points = KritaUtils::sampleRectWithPoints(rect);\n+\n+        using namespace boost::accumulators;\n+        accumulator_set<qreal, stats<tag::min, tag::max > > accX;\n+        accumulator_set<qreal, stats<tag::min, tag::max > > accY;\n+\n+        Q_FOREACH (const QPoint &pt, points) {\n+            QPointF dstPt = func(pt);\n+\n+            accX(dstPt.x());\n+            accY(dstPt.y());\n+        }\n+\n+        QRect resultRect;\n+        resultRect.setCoords(std::floor(min(accX)), std::floor(min(accY)),\n+                             std::ceil(max(accX)), std::ceil(max(accY)));\n+\n+        return resultRect;\n+    }\n+\n     bool checkInTriangle(const QRectF &rect,\n                          const QPolygonF &triangle)\n     {"}, {"sha": "180f9b3620ed25aab99859fd41a78eabe462d357", "filename": "libs/image/krita_utils.h", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/krita_utils.h", "raw_url": "https://github.com/KDE/krita/raw/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/krita_utils.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/krita_utils.h?ref=241ddd4ec56b58172e631596696c4ea369e52a05", "patch": "@@ -41,6 +41,14 @@ namespace KritaUtils\n     QVector<QRect> KRITAIMAGE_EXPORT splitRectIntoPatches(const QRect &rc, const QSize &patchSize);\n     QVector<QRect> KRITAIMAGE_EXPORT splitRegionIntoPatches(const QRegion &region, const QSize &patchSize);\n \n+    QVector<QPoint> KRITAIMAGE_EXPORT sampleRectWithPoints(const QRect &rect);\n+    QVector<QPointF> KRITAIMAGE_EXPORT sampleRectWithPoints(const QRectF &rect);\n+\n+    QRect KRITAIMAGE_EXPORT approximateRectFromPoints(const QVector<QPoint> &points);\n+    QRectF KRITAIMAGE_EXPORT approximateRectFromPoints(const QVector<QPointF> &points);\n+\n+    QRect KRITAIMAGE_EXPORT approximateRectWithPointTransform(const QRect &rect, std::function<QPointF(QPointF)> func);\n+\n     QRegion KRITAIMAGE_EXPORT splitTriangles(const QPointF &center,\n                                              const QVector<QPointF> &points);\n     QRegion KRITAIMAGE_EXPORT splitPath(const QPainterPath &path);"}, {"sha": "764f526876e8e6aff81b342dfe1820236ade6a50", "filename": "libs/image/tests/kis_warp_transform_worker_test.cpp", "status": "modified", "additions": 57, "deletions": 32, "changes": 89, "blob_url": "https://github.com/KDE/krita/blob/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/tests/kis_warp_transform_worker_test.cpp", "raw_url": "https://github.com/KDE/krita/raw/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/tests/kis_warp_transform_worker_test.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/tests/kis_warp_transform_worker_test.cpp?ref=241ddd4ec56b58172e631596696c4ea369e52a05", "patch": "@@ -25,56 +25,67 @@\n \n #include <KoProgressUpdater.h>\n \n+struct WarpTransforWorkerData {\n \n-void KisWarpTransformWorkerTest::test()\n-{\n-    TestUtil::TestProgressBar bar;\n-    KoProgressUpdater pu(&bar);\n-    KoUpdaterPtr updater = pu.startSubtask();\n+    WarpTransforWorkerData() {\n+        TestUtil::TestProgressBar bar;\n+        KoProgressUpdater pu(&bar);\n+        updater = pu.startSubtask();\n \n-    const KoColorSpace *cs = KoColorSpaceRegistry::instance()->rgb8();\n-//    QImage image(TestUtil::fetchDataFileLazy(\"test_transform_quality.png\"));\n-    QImage image(TestUtil::fetchDataFileLazy(\"test_transform_quality_second.png\"));\n+        const KoColorSpace *cs = KoColorSpaceRegistry::instance()->rgb8();\n+        // QImage image(TestUtil::fetchDataFileLazy(\"test_transform_quality.png\"));\n+        QImage image(TestUtil::fetchDataFileLazy(\"test_transform_quality_second.png\"));\n \n-    KisPaintDeviceSP dev = new KisPaintDevice(cs);\n-    dev->convertFromQImage(image, 0);\n+        dev = new KisPaintDevice(cs);\n+        dev->convertFromQImage(image, 0);\n \n-    QVector<QPointF> origPoints;\n-    QVector<QPointF> transfPoints;\n-    qreal alpha = 1.0;\n+        alpha = 1.0;\n \n-    QRectF bounds(dev->exactBounds());\n+        bounds = dev->exactBounds();\n \n-    origPoints << bounds.topLeft();\n-    origPoints << bounds.topRight();\n-    origPoints << bounds.bottomRight();\n-    origPoints << bounds.bottomLeft();\n+        origPoints << bounds.topLeft();\n+        origPoints << bounds.topRight();\n+        origPoints << bounds.bottomRight();\n+        origPoints << bounds.bottomLeft();\n \n-    origPoints << 0.5 * (bounds.bottomLeft() + bounds.bottomRight());\n-    origPoints << 0.5 * (bounds.bottomLeft() + bounds.bottomRight()) + QPointF(-20, 0);\n+        origPoints << 0.5 * (bounds.bottomLeft() + bounds.bottomRight());\n+        origPoints << 0.5 * (bounds.bottomLeft() + bounds.bottomRight()) + QPointF(-20, 0);\n \n \n-    transfPoints << bounds.topLeft();\n-    transfPoints << bounds.bottomLeft() + 0.6 * (bounds.topRight() - bounds.bottomLeft());\n-    transfPoints << bounds.topLeft() + 0.8 * (bounds.bottomRight() - bounds.topLeft());\n-    transfPoints << bounds.bottomLeft() + QPointF(200, 0);\n+        transfPoints << bounds.topLeft();\n+        transfPoints << bounds.bottomLeft() + 0.6 * (bounds.topRight() - bounds.bottomLeft());\n+        transfPoints << bounds.topLeft() + 0.8 * (bounds.bottomRight() - bounds.topLeft());\n+        transfPoints << bounds.bottomLeft() + QPointF(200, 0);\n+\n+        transfPoints << 0.5 * (bounds.bottomLeft() + bounds.bottomRight()) + QPointF(40,20);\n+        transfPoints << 0.5 * (bounds.bottomLeft() + bounds.bottomRight()) + QPointF(-20, 0) + QPointF(-40,20);\n+    }\n \n-    transfPoints << 0.5 * (bounds.bottomLeft() + bounds.bottomRight()) + QPointF(40,20);\n-    transfPoints << 0.5 * (bounds.bottomLeft() + bounds.bottomRight()) + QPointF(-20, 0) + QPointF(-40,20);\n \n+    KisPaintDeviceSP dev;\n+    QVector<QPointF> origPoints;\n+    QVector<QPointF> transfPoints;\n+    qreal alpha;\n+    KoUpdaterPtr updater;\n+    QRectF bounds;\n+};\n \n+\n+void KisWarpTransformWorkerTest::test()\n+{\n+    WarpTransforWorkerData d;\n     KisWarpTransformWorker worker(KisWarpTransformWorker::RIGID_TRANSFORM,\n-                                  dev,\n-                                  origPoints,\n-                                  transfPoints,\n-                                  alpha,\n-                                  updater);\n+                                  d.dev,\n+                                  d.origPoints,\n+                                  d.transfPoints,\n+                                  d.alpha,\n+                                  d.updater);\n \n     QBENCHMARK_ONCE {\n         worker.run();\n     }\n \n-    QImage result = dev->convertToQImage(0);\n+    QImage result = d.dev->convertToQImage(0);\n \n     TestUtil::checkQImage(result, \"warp_transform_test\", \"simple\", \"tr\");\n }\n@@ -323,6 +334,20 @@ void KisWarpTransformWorkerTest::testBackwardInterpolatorExtrapolation()\n     QCOMPARE(interp.map(QPointF(0,110)), QPointF(110, 100));\n     QCOMPARE(interp.map(QPointF(-10,110)), QPointF(110,110));\n }\n+#include \"krita_utils.h\"\n+void KisWarpTransformWorkerTest::testNeedChangeRects()\n+{\n+    WarpTransforWorkerData d;\n+    KisWarpTransformWorker worker(KisWarpTransformWorker::RIGID_TRANSFORM,\n+                                  d.dev,\n+                                  d.origPoints,\n+                                  d.transfPoints,\n+                                  d.alpha,\n+                                  d.updater);\n+\n+    QCOMPARE(KritaUtils::sampleRectWithPoints(d.bounds.toAlignedRect()).size(), 9);\n+    QCOMPARE(worker.approxChangeRect(d.bounds.toAlignedRect()), QRect(-89,-89, 1072,1076));\n+}\n \n \n QTEST_MAIN(KisWarpTransformWorkerTest)"}, {"sha": "d1ed01be997ea2fdd6cb4f47ed0d72af72c6bd5d", "filename": "libs/image/tests/kis_warp_transform_worker_test.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/tests/kis_warp_transform_worker_test.h", "raw_url": "https://github.com/KDE/krita/raw/241ddd4ec56b58172e631596696c4ea369e52a05/libs/image/tests/kis_warp_transform_worker_test.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/tests/kis_warp_transform_worker_test.h?ref=241ddd4ec56b58172e631596696c4ea369e52a05", "patch": "@@ -34,6 +34,8 @@ private Q_SLOTS:\n     void testBackwardInterpolatorRoundTrip();\n     void testGridSize();\n     void testBackwardInterpolatorExtrapolation();\n+\n+    void testNeedChangeRects();\n };\n \n #endif /* __KIS_WARP_TRANSFORM_WORKER_TEST_H */"}, {"sha": "f730171043e260c6b9fdc3313c930cbccf4403e4", "filename": "plugins/tools/tool_transform2/kis_transform_mask_adapter.cpp", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/KDE/krita/blob/241ddd4ec56b58172e631596696c4ea369e52a05/plugins/tools/tool_transform2/kis_transform_mask_adapter.cpp", "raw_url": "https://github.com/KDE/krita/raw/241ddd4ec56b58172e631596696c4ea369e52a05/plugins/tools/tool_transform2/kis_transform_mask_adapter.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_transform2/kis_transform_mask_adapter.cpp?ref=241ddd4ec56b58172e631596696c4ea369e52a05", "patch": "@@ -94,6 +94,16 @@ void KisTransformMaskAdapter::translate(const QPointF &offset)\n     m_d->args.translate(offset);\n }\n \n+QRect KisTransformMaskAdapter::nonAffineChangeRect(const QRect &rc)\n+{\n+    return KisTransformUtils::changeRect(m_d->args, rc);\n+}\n+\n+QRect KisTransformMaskAdapter::nonAffineNeedRect(const QRect &rc, const QRect &srcBounds)\n+{\n+    return KisTransformUtils::needRect(m_d->args, rc, srcBounds);\n+}\n+\n #include \"kis_transform_mask_params_factory_registry.h\"\n \n struct ToolTransformParamsRegistrar {"}, {"sha": "3c06dd3ec01e9a035f4fb41c89d3a71dcef68ab8", "filename": "plugins/tools/tool_transform2/kis_transform_mask_adapter.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/241ddd4ec56b58172e631596696c4ea369e52a05/plugins/tools/tool_transform2/kis_transform_mask_adapter.h", "raw_url": "https://github.com/KDE/krita/raw/241ddd4ec56b58172e631596696c4ea369e52a05/plugins/tools/tool_transform2/kis_transform_mask_adapter.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_transform2/kis_transform_mask_adapter.h?ref=241ddd4ec56b58172e631596696c4ea369e52a05", "patch": "@@ -45,6 +45,9 @@ class KisTransformMaskAdapter : public KisTransformMaskParamsInterface\n \n     void translate(const QPointF &offset);\n \n+    QRect nonAffineChangeRect(const QRect &rc);\n+    QRect nonAffineNeedRect(const QRect &rc, const QRect &srcBounds);\n+\n private:\n     struct Private;\n     const QScopedPointer<Private> m_d;"}, {"sha": "bbbabec26baced7c3d3c2927b6d95c2a597969ca", "filename": "plugins/tools/tool_transform2/kis_transform_utils.cpp", "status": "modified", "additions": 66, "deletions": 0, "changes": 66, "blob_url": "https://github.com/KDE/krita/blob/241ddd4ec56b58172e631596696c4ea369e52a05/plugins/tools/tool_transform2/kis_transform_utils.cpp", "raw_url": "https://github.com/KDE/krita/raw/241ddd4ec56b58172e631596696c4ea369e52a05/plugins/tools/tool_transform2/kis_transform_utils.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_transform2/kis_transform_utils.cpp?ref=241ddd4ec56b58172e631596696c4ea369e52a05", "patch": "@@ -281,3 +281,69 @@ void KisTransformUtils::transformDevice(const ToolTransformArgs &config,\n         }\n     }\n }\n+\n+QRect KisTransformUtils::needRect(const ToolTransformArgs &config,\n+                                  const QRect &rc,\n+                                  const QRect &srcBounds)\n+{\n+    QRect result = rc;\n+\n+    if (config.mode() == ToolTransformArgs::WARP) {\n+        KisWarpTransformWorker worker(config.warpType(),\n+                                      0,\n+                                      config.origPoints(),\n+                                      config.transfPoints(),\n+                                      config.alpha(),\n+                                      0);\n+\n+        result = worker.approxNeedRect(rc, srcBounds);\n+\n+    } else if (config.mode() == ToolTransformArgs::CAGE) {\n+        KisCageTransformWorker worker(0,\n+                                      config.origPoints(),\n+                                      0,\n+                                      8);\n+        worker.setTransformedCage(config.transfPoints());\n+        result = worker.approxNeedRect(rc, srcBounds);\n+    } else if (config.mode() == ToolTransformArgs::LIQUIFY) {\n+        result = config.liquifyWorker() ?\n+            config.liquifyWorker()->approxNeedRect(rc, srcBounds) : rc;\n+    } else {\n+        KIS_ASSERT_RECOVER_NOOP(0 && \"this works for non-affine transformations only!\");\n+    }\n+\n+    return result;\n+}\n+\n+QRect KisTransformUtils::changeRect(const ToolTransformArgs &config,\n+                                    const QRect &rc)\n+{\n+    QRect result = rc;\n+\n+    if (config.mode() == ToolTransformArgs::WARP) {\n+        KisWarpTransformWorker worker(config.warpType(),\n+                                      0,\n+                                      config.origPoints(),\n+                                      config.transfPoints(),\n+                                      config.alpha(),\n+                                      0);\n+\n+        result = worker.approxChangeRect(rc);\n+\n+    } else if (config.mode() == ToolTransformArgs::CAGE) {\n+        KisCageTransformWorker worker(0,\n+                                      config.origPoints(),\n+                                      0,\n+                                      8);\n+\n+        worker.setTransformedCage(config.transfPoints());\n+        result = worker.approxChangeRect(rc);\n+    } else if (config.mode() == ToolTransformArgs::LIQUIFY) {\n+        result = config.liquifyWorker() ?\n+            config.liquifyWorker()->approxChangeRect(rc) : rc;\n+    } else {\n+        KIS_ASSERT_RECOVER_NOOP(0 && \"this works for non-affine transformations only!\");\n+    }\n+\n+    return result;\n+}"}, {"sha": "d358c4bda30afdfe18935b5040937ef8124e287f", "filename": "plugins/tools/tool_transform2/kis_transform_utils.h", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/KDE/krita/blob/241ddd4ec56b58172e631596696c4ea369e52a05/plugins/tools/tool_transform2/kis_transform_utils.h", "raw_url": "https://github.com/KDE/krita/raw/241ddd4ec56b58172e631596696c4ea369e52a05/plugins/tools/tool_transform2/kis_transform_utils.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_transform2/kis_transform_utils.h?ref=241ddd4ec56b58172e631596696c4ea369e52a05", "patch": "@@ -93,6 +93,13 @@ class KisTransformUtils\n                                 KisPaintDeviceSP device,\n                                 KisProcessingVisitor::ProgressHelper *helper);\n \n+    static QRect needRect(const ToolTransformArgs &config,\n+                          const QRect &rc,\n+                          const QRect &srcBounds);\n+\n+    static QRect changeRect(const ToolTransformArgs &config,\n+                            const QRect &rc);\n+\n     template<typename Function>\n     class HandleChooser {\n     public:"}]}, {"sha": "6cc9dea6ad289d2add0c7effd4897b4173147f5f", "stats": {"total": 30, "additions": 21, "deletions": 9}, "files": [{"sha": "6381eb6c643f431d762f43201eb6003b0b68e9f1", "filename": "plugins/extensions/imagesplit/imagesplit.cpp", "status": "modified", "additions": 21, "deletions": 9, "changes": 30, "blob_url": "https://github.com/KDE/krita/blob/6cc9dea6ad289d2add0c7effd4897b4173147f5f/plugins/extensions/imagesplit/imagesplit.cpp", "raw_url": "https://github.com/KDE/krita/raw/6cc9dea6ad289d2add0c7effd4897b4173147f5f/plugins/extensions/imagesplit/imagesplit.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/imagesplit/imagesplit.cpp?ref=6cc9dea6ad289d2add0c7effd4897b4173147f5f", "patch": "@@ -64,23 +64,24 @@ void Imagesplit::saveAsImage(const QRect &imgSize, const QString &mimeType, cons\n {\n     KisImageWSP image = m_view->image();\n \n-    KisDocument *d = KisPart::instance()->createDocument();\n-    d->prepareForImport();\n+    KisDocument *document = KisPart::instance()->createDocument();\n+    document->prepareForImport();\n \n-    KisImageWSP dst = new KisImage(d->createUndoStore(), imgSize.width(), imgSize.height(), image->colorSpace(), image->objectName());\n+    KisImageWSP dst = new KisImage(document->createUndoStore(), imgSize.width(), imgSize.height(), image->colorSpace(), image->objectName());\n     dst->setResolution(image->xRes(), image->yRes());\n-    d->setCurrentImage(dst);\n+    document->setCurrentImage(dst);\n \n     KisPaintLayer* paintLayer = new KisPaintLayer(dst, dst->nextLayerName(), 255);\n     KisPainter gc(paintLayer->paintDevice());\n     gc.bitBlt(QPoint(0, 0), image->projection(), imgSize);\n \n     dst->addNode(paintLayer, KisNodeSP(0));\n     dst->refreshGraph();\n-    d->setOutputMimeType(mimeType.toLatin1());\n-    d->exportDocument(QUrl::fromLocalFile(url));\n+    document->setFileBatchMode(true);\n+    document->setOutputMimeType(mimeType.toLatin1());\n+    document->exportDocument(QUrl::fromLocalFile(url));\n \n-    delete d;\n+    delete document;\n }\n \n void Imagesplit::slotImagesplit()\n@@ -91,6 +92,7 @@ void Imagesplit::slotImagesplit()\n \n     // Getting all mime types and converting them into names which are displayed at combo box\n     QStringList listMimeFilter = KisImportExportManager::mimeFilter(\"application/x-krita\", KisImportExportManager::Export);\n+    listMimeFilter.sort();\n     QStringList filteredMimeTypes;\n     QStringList listFileType;\n     Q_FOREACH (const QString & mimeType, listMimeFilter) {\n@@ -102,7 +104,7 @@ void Imagesplit::slotImagesplit()\n \n     Q_ASSERT(listMimeFilter.size() == listFileType.size());\n \n-    DlgImagesplit * dlgImagesplit = new DlgImagesplit(m_view, suffix, listFileType);\n+    DlgImagesplit *dlgImagesplit = new DlgImagesplit(m_view, suffix, listFileType);\n     dlgImagesplit->setObjectName(\"Imagesplit\");\n     Q_CHECK_PTR(dlgImagesplit);\n \n@@ -122,7 +124,17 @@ void Imagesplit::slotImagesplit()\n                 for (int j = 0; j < (numHorizontalLines + 1); j++, k++) {\n                     QString mimeTypeSelected = listMimeFilter.at(dlgImagesplit->cmbIndex);\n                     QString homepath = QDir::homePath();\n-                    QString fileName = dlgImagesplit->suffix() + '_' + QString::number(k) + KisMimeDatabase::suffixesForMimeType(mimeTypeSelected).first();\n+                    QString suffix = KisMimeDatabase::suffixesForMimeType(mimeTypeSelected).first();\n+                    qDebug() << \"suffix\" << suffix;\n+                    if (suffix.startsWith(\"*.\")) {\n+                        suffix = suffix.remove(0, 1);\n+                    }\n+                    qDebug() << \"\\tsuffix\" << suffix;\n+                    if (!suffix.startsWith(\".\")) {\n+                        suffix = suffix.prepend('.');\n+                    }\n+                    qDebug() << \"\\tsuffix\" << suffix;\n+                    QString fileName = dlgImagesplit->suffix() + '_' + QString::number(k) + suffix;\n                     QString url = homepath  + '/' + fileName;\n                     saveAsImage(QRect((i * img_width), (j * img_height), img_width, img_height), listMimeFilter.at(dlgImagesplit->cmbIndex), url);\n                 }"}]}, {"sha": "23136ab7cadc760b12ebbee1f2ac18b069c3fe91", "stats": {"total": 1425, "additions": 632, "deletions": 793}, "files": [{"sha": "b1ea6db5ee54e8df487c02a6dd43b88e27dc89dd", "filename": "plugins/dockers/advancedcolorselector/wdg_color_selector_settings.ui", "status": "modified", "additions": 632, "deletions": 793, "changes": 1425, "blob_url": "https://github.com/KDE/krita/blob/23136ab7cadc760b12ebbee1f2ac18b069c3fe91/plugins/dockers/advancedcolorselector/wdg_color_selector_settings.ui", "raw_url": "https://github.com/KDE/krita/raw/23136ab7cadc760b12ebbee1f2ac18b069c3fe91/plugins/dockers/advancedcolorselector/wdg_color_selector_settings.ui", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/advancedcolorselector/wdg_color_selector_settings.ui?ref=23136ab7cadc760b12ebbee1f2ac18b069c3fe91", "patch": "@@ -7,7 +7,7 @@\n     <x>0</x>\n     <y>0</y>\n     <width>618</width>\n-    <height>952</height>\n+    <height>982</height>\n    </rect>\n   </property>\n   <property name=\"sizePolicy\">\n@@ -77,389 +77,320 @@\n       <attribute name=\"title\">\n        <string>Color Selector</string>\n       </attribute>\n-      <widget class=\"QGroupBox\" name=\"lumaCoefficientGroupbox\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>190</x>\n-         <y>130</y>\n-         <width>391</width>\n-         <height>91</height>\n-        </rect>\n-       </property>\n-       <property name=\"sizePolicy\">\n-        <sizepolicy hsizetype=\"Fixed\" vsizetype=\"Fixed\">\n-         <horstretch>0</horstretch>\n-         <verstretch>0</verstretch>\n-        </sizepolicy>\n-       </property>\n-       <property name=\"title\">\n-        <string>Luma Coefficients</string>\n-       </property>\n-       <layout class=\"QHBoxLayout\" name=\"horizontalLayout_15\">\n-        <item>\n-         <layout class=\"QGridLayout\" name=\"gridLayout_5\">\n-          <property name=\"leftMargin\">\n-           <number>0</number>\n-          </property>\n-          <property name=\"rightMargin\">\n-           <number>0</number>\n-          </property>\n-          <property name=\"verticalSpacing\">\n-           <number>6</number>\n-          </property>\n-          <item row=\"0\" column=\"0\">\n-           <widget class=\"QLabel\" name=\"redlabel\">\n-            <property name=\"sizePolicy\">\n-             <sizepolicy hsizetype=\"Fixed\" vsizetype=\"Preferred\">\n-              <horstretch>0</horstretch>\n-              <verstretch>0</verstretch>\n-             </sizepolicy>\n-            </property>\n-            <property name=\"text\">\n-             <string>Red': </string>\n-            </property>\n-            <property name=\"alignment\">\n-             <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-            </property>\n-           </widget>\n-          </item>\n-          <item row=\"0\" column=\"3\">\n-           <widget class=\"QDoubleSpinBox\" name=\"l_lumaG\">\n-            <property name=\"sizePolicy\">\n-             <sizepolicy hsizetype=\"Fixed\" vsizetype=\"Minimum\">\n-              <horstretch>0</horstretch>\n-              <verstretch>0</verstretch>\n-             </sizepolicy>\n-            </property>\n-            <property name=\"minimumSize\">\n-             <size>\n-              <width>50</width>\n-              <height>0</height>\n-             </size>\n-            </property>\n-            <property name=\"decimals\">\n-             <number>4</number>\n-            </property>\n-           </widget>\n-          </item>\n-          <item row=\"0\" column=\"2\">\n-           <widget class=\"QLabel\" name=\"greenlabel\">\n-            <property name=\"sizePolicy\">\n-             <sizepolicy hsizetype=\"Fixed\" vsizetype=\"Preferred\">\n-              <horstretch>0</horstretch>\n-              <verstretch>0</verstretch>\n-             </sizepolicy>\n-            </property>\n-            <property name=\"text\">\n-             <string>Green':</string>\n-            </property>\n-           </widget>\n-          </item>\n-          <item row=\"0\" column=\"4\">\n-           <widget class=\"QLabel\" name=\"bluelabel\">\n-            <property name=\"sizePolicy\">\n-             <sizepolicy hsizetype=\"Fixed\" vsizetype=\"Preferred\">\n-              <horstretch>0</horstretch>\n-              <verstretch>0</verstretch>\n-             </sizepolicy>\n-            </property>\n-            <property name=\"text\">\n-             <string>Blue':</string>\n-            </property>\n-           </widget>\n-          </item>\n-          <item row=\"0\" column=\"1\">\n-           <widget class=\"QDoubleSpinBox\" name=\"l_lumaR\">\n-            <property name=\"sizePolicy\">\n-             <sizepolicy hsizetype=\"Fixed\" vsizetype=\"Minimum\">\n-              <horstretch>0</horstretch>\n-              <verstretch>0</verstretch>\n-             </sizepolicy>\n-            </property>\n-            <property name=\"minimumSize\">\n-             <size>\n-              <width>50</width>\n-              <height>0</height>\n-             </size>\n-            </property>\n-            <property name=\"decimals\">\n-             <number>4</number>\n+      <layout class=\"QVBoxLayout\" name=\"verticalLayout_4\">\n+       <item>\n+        <layout class=\"QHBoxLayout\" name=\"horizontalLayout_6\">\n+         <item>\n+          <widget class=\"KisColorSelectorComboBox\" name=\"colorSelectorConfiguration\"/>\n+         </item>\n+         <item>\n+          <layout class=\"QVBoxLayout\" name=\"verticalLayout_2\">\n+           <item>\n+            <widget class=\"QLabel\" name=\"l_type\">\n+             <property name=\"layoutDirection\">\n+              <enum>Qt::LeftToRight</enum>\n+             </property>\n+             <property name=\"text\">\n+              <string>Color Model Type: </string>\n+             </property>\n+             <property name=\"alignment\">\n+              <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+             </property>\n+             <property name=\"buddy\">\n+              <cstring>colorSelectorConfiguration</cstring>\n+             </property>\n+            </widget>\n+           </item>\n+           <item>\n+            <widget class=\"QComboBox\" name=\"colorSelectorTypeComboBox\"/>\n+           </item>\n+           <item>\n+            <widget class=\"QLabel\" name=\"ACSTypeDescriptionLabel\">\n+             <property name=\"sizePolicy\">\n+              <sizepolicy hsizetype=\"Fixed\" vsizetype=\"Fixed\">\n+               <horstretch>0</horstretch>\n+               <verstretch>0</verstretch>\n+              </sizepolicy>\n+             </property>\n+             <property name=\"text\">\n+              <string notr=\"true\">Type Description goes here</string>\n+             </property>\n+             <property name=\"alignment\">\n+              <set>Qt::AlignLeading|Qt::AlignLeft|Qt::AlignTop</set>\n+             </property>\n+             <property name=\"wordWrap\">\n+              <bool>true</bool>\n+             </property>\n+            </widget>\n+           </item>\n+           <item>\n+            <widget class=\"QGroupBox\" name=\"lumaCoefficientGroupbox\">\n+             <property name=\"sizePolicy\">\n+              <sizepolicy hsizetype=\"Fixed\" vsizetype=\"Fixed\">\n+               <horstretch>0</horstretch>\n+               <verstretch>0</verstretch>\n+              </sizepolicy>\n+             </property>\n+             <property name=\"title\">\n+              <string>Luma Coefficients</string>\n+             </property>\n+             <layout class=\"QHBoxLayout\" name=\"horizontalLayout_15\">\n+              <item>\n+               <layout class=\"QGridLayout\" name=\"gridLayout_5\">\n+                <property name=\"leftMargin\">\n+                 <number>0</number>\n+                </property>\n+                <property name=\"rightMargin\">\n+                 <number>0</number>\n+                </property>\n+                <property name=\"verticalSpacing\">\n+                 <number>6</number>\n+                </property>\n+                <item row=\"0\" column=\"0\">\n+                 <widget class=\"QLabel\" name=\"redlabel\">\n+                  <property name=\"sizePolicy\">\n+                   <sizepolicy hsizetype=\"Fixed\" vsizetype=\"Preferred\">\n+                    <horstretch>0</horstretch>\n+                    <verstretch>0</verstretch>\n+                   </sizepolicy>\n+                  </property>\n+                  <property name=\"text\">\n+                   <string>Red': </string>\n+                  </property>\n+                  <property name=\"alignment\">\n+                   <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+                  </property>\n+                 </widget>\n+                </item>\n+                <item row=\"0\" column=\"3\">\n+                 <widget class=\"QDoubleSpinBox\" name=\"l_lumaG\">\n+                  <property name=\"sizePolicy\">\n+                   <sizepolicy hsizetype=\"Fixed\" vsizetype=\"Minimum\">\n+                    <horstretch>0</horstretch>\n+                    <verstretch>0</verstretch>\n+                   </sizepolicy>\n+                  </property>\n+                  <property name=\"minimumSize\">\n+                   <size>\n+                    <width>50</width>\n+                    <height>0</height>\n+                   </size>\n+                  </property>\n+                  <property name=\"decimals\">\n+                   <number>4</number>\n+                  </property>\n+                 </widget>\n+                </item>\n+                <item row=\"0\" column=\"2\">\n+                 <widget class=\"QLabel\" name=\"greenlabel\">\n+                  <property name=\"sizePolicy\">\n+                   <sizepolicy hsizetype=\"Fixed\" vsizetype=\"Preferred\">\n+                    <horstretch>0</horstretch>\n+                    <verstretch>0</verstretch>\n+                   </sizepolicy>\n+                  </property>\n+                  <property name=\"text\">\n+                   <string>Green':</string>\n+                  </property>\n+                 </widget>\n+                </item>\n+                <item row=\"0\" column=\"4\">\n+                 <widget class=\"QLabel\" name=\"bluelabel\">\n+                  <property name=\"sizePolicy\">\n+                   <sizepolicy hsizetype=\"Fixed\" vsizetype=\"Preferred\">\n+                    <horstretch>0</horstretch>\n+                    <verstretch>0</verstretch>\n+                   </sizepolicy>\n+                  </property>\n+                  <property name=\"text\">\n+                   <string>Blue':</string>\n+                  </property>\n+                 </widget>\n+                </item>\n+                <item row=\"0\" column=\"1\">\n+                 <widget class=\"QDoubleSpinBox\" name=\"l_lumaR\">\n+                  <property name=\"sizePolicy\">\n+                   <sizepolicy hsizetype=\"Fixed\" vsizetype=\"Minimum\">\n+                    <horstretch>0</horstretch>\n+                    <verstretch>0</verstretch>\n+                   </sizepolicy>\n+                  </property>\n+                  <property name=\"minimumSize\">\n+                   <size>\n+                    <width>50</width>\n+                    <height>0</height>\n+                   </size>\n+                  </property>\n+                  <property name=\"decimals\">\n+                   <number>4</number>\n+                  </property>\n+                 </widget>\n+                </item>\n+                <item row=\"0\" column=\"5\">\n+                 <widget class=\"QDoubleSpinBox\" name=\"l_lumaB\">\n+                  <property name=\"sizePolicy\">\n+                   <sizepolicy hsizetype=\"Fixed\" vsizetype=\"Minimum\">\n+                    <horstretch>0</horstretch>\n+                    <verstretch>0</verstretch>\n+                   </sizepolicy>\n+                  </property>\n+                  <property name=\"minimumSize\">\n+                   <size>\n+                    <width>50</width>\n+                    <height>0</height>\n+                   </size>\n+                  </property>\n+                  <property name=\"decimals\">\n+                   <number>4</number>\n+                  </property>\n+                 </widget>\n+                </item>\n+                <item row=\"1\" column=\"1\">\n+                 <widget class=\"QDoubleSpinBox\" name=\"SP_Gamma\">\n+                  <property name=\"toolTip\">\n+                   <string>&lt;html&gt;&lt;head/&gt;&lt;body&gt;&lt;p&gt;This sets the gamma value that the linearised HSY Luminosity is crunched with. 1 makes the selector fully linear, 2.2 is a practical default value.&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</string>\n+                  </property>\n+                  <property name=\"decimals\">\n+                   <number>1</number>\n+                  </property>\n+                  <property name=\"minimum\">\n+                   <double>-3.000000000000000</double>\n+                  </property>\n+                  <property name=\"maximum\">\n+                   <double>3.000000000000000</double>\n+                  </property>\n+                  <property name=\"singleStep\">\n+                   <double>0.100000000000000</double>\n+                  </property>\n+                  <property name=\"value\">\n+                   <double>2.200000000000000</double>\n+                  </property>\n+                 </widget>\n+                </item>\n+                <item row=\"1\" column=\"0\">\n+                 <widget class=\"QLabel\" name=\"gamma_label\">\n+                  <property name=\"text\">\n+                   <string>Gamma:</string>\n+                  </property>\n+                 </widget>\n+                </item>\n+               </layout>\n+              </item>\n+             </layout>\n+            </widget>\n+           </item>\n+          </layout>\n+         </item>\n+        </layout>\n+       </item>\n+       <item>\n+        <widget class=\"QGroupBox\" name=\"useDifferentColorSpaceCheckbox\">\n+         <property name=\"minimumSize\">\n+          <size>\n+           <width>0</width>\n+           <height>0</height>\n+          </size>\n+         </property>\n+         <property name=\"title\">\n+          <string>Color Selector Uses Different Color Space than Image</string>\n+         </property>\n+         <property name=\"checkable\">\n+          <bool>true</bool>\n+         </property>\n+         <layout class=\"QVBoxLayout\" name=\"verticalLayout_10\">\n+          <item>\n+           <widget class=\"KisColorSpaceSelector\" name=\"colorSpace\" native=\"true\">\n+            <property name=\"enabled\">\n+             <bool>false</bool>\n             </property>\n-           </widget>\n-          </item>\n-          <item row=\"0\" column=\"5\">\n-           <widget class=\"QDoubleSpinBox\" name=\"l_lumaB\">\n             <property name=\"sizePolicy\">\n-             <sizepolicy hsizetype=\"Fixed\" vsizetype=\"Minimum\">\n+             <sizepolicy hsizetype=\"Preferred\" vsizetype=\"Preferred\">\n               <horstretch>0</horstretch>\n               <verstretch>0</verstretch>\n              </sizepolicy>\n             </property>\n-            <property name=\"minimumSize\">\n-             <size>\n-              <width>50</width>\n-              <height>0</height>\n-             </size>\n-            </property>\n-            <property name=\"decimals\">\n-             <number>4</number>\n-            </property>\n-           </widget>\n-          </item>\n-          <item row=\"1\" column=\"1\">\n-           <widget class=\"QDoubleSpinBox\" name=\"SP_Gamma\">\n-            <property name=\"toolTip\">\n-             <string>&lt;html&gt;&lt;head/&gt;&lt;body&gt;&lt;p&gt;This sets the gamma value that the linearised HSY Luminosity is crunched with. 1 makes the selector fully linear, 2.2 is a practical default value.&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</string>\n-            </property>\n-            <property name=\"decimals\">\n-             <number>1</number>\n-            </property>\n-            <property name=\"minimum\">\n-             <double>-3.000000000000000</double>\n-            </property>\n-            <property name=\"maximum\">\n-             <double>3.000000000000000</double>\n-            </property>\n-            <property name=\"singleStep\">\n-             <double>0.100000000000000</double>\n-            </property>\n-            <property name=\"value\">\n-             <double>2.200000000000000</double>\n-            </property>\n-           </widget>\n-          </item>\n-          <item row=\"1\" column=\"0\">\n-           <widget class=\"QLabel\" name=\"gamma_label\">\n-            <property name=\"text\">\n-             <string>Gamma:</string>\n-            </property>\n            </widget>\n           </item>\n          </layout>\n-        </item>\n-       </layout>\n-      </widget>\n-      <widget class=\"QLabel\" name=\"l_type\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>190</x>\n-         <y>30</y>\n-         <width>131</width>\n-         <height>21</height>\n-        </rect>\n-       </property>\n-       <property name=\"layoutDirection\">\n-        <enum>Qt::LeftToRight</enum>\n-       </property>\n-       <property name=\"text\">\n-        <string>Color Model Type: </string>\n-       </property>\n-       <property name=\"alignment\">\n-        <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-       </property>\n-       <property name=\"buddy\">\n-        <cstring>colorSelectorConfiguration</cstring>\n-       </property>\n-      </widget>\n-      <widget class=\"KisColorSelectorComboBox\" name=\"colorSelectorConfiguration\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>20</x>\n-         <y>20</y>\n-         <width>131</width>\n-         <height>121</height>\n-        </rect>\n-       </property>\n-      </widget>\n-      <widget class=\"QComboBox\" name=\"colorSelectorTypeComboBox\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>320</x>\n-         <y>30</y>\n-         <width>131</width>\n-         <height>27</height>\n-        </rect>\n-       </property>\n-      </widget>\n-      <widget class=\"QLabel\" name=\"ACSTypeDescriptionLabel\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>190</x>\n-         <y>70</y>\n-         <width>401</width>\n-         <height>61</height>\n-        </rect>\n-       </property>\n-       <property name=\"sizePolicy\">\n-        <sizepolicy hsizetype=\"Fixed\" vsizetype=\"Fixed\">\n-         <horstretch>0</horstretch>\n-         <verstretch>0</verstretch>\n-        </sizepolicy>\n-       </property>\n-       <property name=\"text\">\n-        <string notr=\"true\">Type Description goes here</string>\n-       </property>\n-       <property name=\"alignment\">\n-        <set>Qt::AlignLeading|Qt::AlignLeft|Qt::AlignTop</set>\n-       </property>\n-       <property name=\"wordWrap\">\n-        <bool>true</bool>\n-       </property>\n-      </widget>\n-      <widget class=\"QGroupBox\" name=\"useDifferentColorSpaceCheckbox\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>20</x>\n-         <y>240</y>\n-         <width>561</width>\n-         <height>141</height>\n-        </rect>\n-       </property>\n-       <property name=\"minimumSize\">\n-        <size>\n-         <width>0</width>\n-         <height>0</height>\n-        </size>\n-       </property>\n-       <property name=\"title\">\n-        <string>Color Selector Uses Different Color Space than Image</string>\n-       </property>\n-       <property name=\"checkable\">\n-        <bool>true</bool>\n-       </property>\n-       <layout class=\"QVBoxLayout\" name=\"verticalLayout_10\">\n-        <item>\n-         <widget class=\"KisColorSpaceSelector\" name=\"colorSpace\" native=\"true\">\n-          <property name=\"enabled\">\n-           <bool>false</bool>\n-          </property>\n-          <property name=\"sizePolicy\">\n-           <sizepolicy hsizetype=\"Preferred\" vsizetype=\"Preferred\">\n-            <horstretch>0</horstretch>\n-            <verstretch>0</verstretch>\n-           </sizepolicy>\n-          </property>\n-         </widget>\n-        </item>\n-       </layout>\n-      </widget>\n+        </widget>\n+       </item>\n+      </layout>\n      </widget>\n      <widget class=\"QWidget\" name=\"tab_general\">\n       <attribute name=\"title\">\n        <string>Behavior</string>\n       </attribute>\n-      <widget class=\"QComboBox\" name=\"dockerResizeOptionsComboBox\">\n-       <property name=\"enabled\">\n-        <bool>true</bool>\n-       </property>\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>140</x>\n-         <y>30</y>\n-         <width>291</width>\n-         <height>27</height>\n-        </rect>\n-       </property>\n-      </widget>\n-      <widget class=\"QComboBox\" name=\"zoomSelectorOptionComboBox\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>140</x>\n-         <y>60</y>\n-         <width>291</width>\n-         <height>27</height>\n-        </rect>\n-       </property>\n-      </widget>\n-      <widget class=\"QLabel\" name=\"label_3\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>20</x>\n-         <y>30</y>\n-         <width>121</width>\n-         <height>21</height>\n-        </rect>\n-       </property>\n-       <property name=\"layoutDirection\">\n-        <enum>Qt::LeftToRight</enum>\n-       </property>\n-       <property name=\"text\">\n-        <string>When Docker Resizes: </string>\n-       </property>\n-       <property name=\"alignment\">\n-        <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-       </property>\n-      </widget>\n-      <widget class=\"QLabel\" name=\"label_5\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>10</x>\n-         <y>60</y>\n-         <width>131</width>\n-         <height>21</height>\n-        </rect>\n-       </property>\n-       <property name=\"text\">\n-        <string>Show Zoom Selector UI: </string>\n-       </property>\n-       <property name=\"alignment\">\n-        <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-       </property>\n-      </widget>\n-      <widget class=\"QLabel\" name=\"label_11\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>30</x>\n-         <y>90</y>\n-         <width>111</width>\n-         <height>21</height>\n-        </rect>\n-       </property>\n-       <property name=\"text\">\n-        <string>Zoom Selector Size: </string>\n-       </property>\n-       <property name=\"alignment\">\n-        <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-       </property>\n-      </widget>\n-      <widget class=\"QSpinBox\" name=\"popupSize\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>140</x>\n-         <y>90</y>\n-         <width>82</width>\n-         <height>27</height>\n-        </rect>\n-       </property>\n-       <property name=\"suffix\">\n-        <string> px</string>\n-       </property>\n-       <property name=\"minimum\">\n-        <number>100</number>\n-       </property>\n-       <property name=\"maximum\">\n-        <number>1000</number>\n-       </property>\n-       <property name=\"singleStep\">\n-        <number>10</number>\n-       </property>\n-       <property name=\"value\">\n-        <number>260</number>\n-       </property>\n-      </widget>\n-      <widget class=\"QCheckBox\" name=\"hidePopupOnClickCheck\">\n-       <property name=\"geometry\">\n-        <rect>\n-         <x>140</x>\n-         <y>120</y>\n-         <width>161</width>\n-         <height>26</height>\n-        </rect>\n-       </property>\n-       <property name=\"text\">\n-        <string>Hide Popup on click.</string>\n-       </property>\n-      </widget>\n+      <layout class=\"QFormLayout\" name=\"formLayout\">\n+       <item row=\"0\" column=\"0\">\n+        <widget class=\"QLabel\" name=\"label_3\">\n+         <property name=\"layoutDirection\">\n+          <enum>Qt::LeftToRight</enum>\n+         </property>\n+         <property name=\"text\">\n+          <string>When Docker Resizes: </string>\n+         </property>\n+         <property name=\"alignment\">\n+          <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+         </property>\n+        </widget>\n+       </item>\n+       <item row=\"0\" column=\"1\">\n+        <widget class=\"QComboBox\" name=\"dockerResizeOptionsComboBox\">\n+         <property name=\"enabled\">\n+          <bool>true</bool>\n+         </property>\n+        </widget>\n+       </item>\n+       <item row=\"1\" column=\"0\">\n+        <widget class=\"QLabel\" name=\"label_5\">\n+         <property name=\"text\">\n+          <string>Show Zoom Selector UI: </string>\n+         </property>\n+         <property name=\"alignment\">\n+          <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+         </property>\n+        </widget>\n+       </item>\n+       <item row=\"1\" column=\"1\">\n+        <widget class=\"QComboBox\" name=\"zoomSelectorOptionComboBox\"/>\n+       </item>\n+       <item row=\"2\" column=\"0\">\n+        <widget class=\"QLabel\" name=\"label_11\">\n+         <property name=\"text\">\n+          <string>Zoom Selector Size: </string>\n+         </property>\n+         <property name=\"alignment\">\n+          <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+         </property>\n+        </widget>\n+       </item>\n+       <item row=\"2\" column=\"1\">\n+        <widget class=\"QSpinBox\" name=\"popupSize\">\n+         <property name=\"suffix\">\n+          <string> px</string>\n+         </property>\n+         <property name=\"minimum\">\n+          <number>100</number>\n+         </property>\n+         <property name=\"maximum\">\n+          <number>1000</number>\n+         </property>\n+         <property name=\"singleStep\">\n+          <number>10</number>\n+         </property>\n+         <property name=\"value\">\n+          <number>260</number>\n+         </property>\n+        </widget>\n+       </item>\n+       <item row=\"3\" column=\"1\">\n+        <widget class=\"QCheckBox\" name=\"hidePopupOnClickCheck\">\n+         <property name=\"text\">\n+          <string>Hide Popup on click.</string>\n+         </property>\n+        </widget>\n+       </item>\n+      </layout>\n      </widget>\n      <widget class=\"QWidget\" name=\"tab_2\">\n       <attribute name=\"title\">\n@@ -746,8 +677,8 @@\n         <rect>\n          <x>10</x>\n          <y>10</y>\n-         <width>561</width>\n-         <height>231</height>\n+         <width>466</width>\n+         <height>205</height>\n         </rect>\n        </property>\n        <property name=\"sizePolicy\">\n@@ -762,228 +693,176 @@\n        <property name=\"checkable\">\n         <bool>true</bool>\n        </property>\n-       <widget class=\"QGroupBox\" name=\"groupBox\">\n-        <property name=\"geometry\">\n-         <rect>\n-          <x>20</x>\n-          <y>40</y>\n-          <width>221</width>\n-          <height>131</height>\n-         </rect>\n-        </property>\n-        <property name=\"title\">\n-         <string>Patch Options</string>\n-        </property>\n-        <widget class=\"QLabel\" name=\"label_14\">\n-         <property name=\"geometry\">\n-          <rect>\n-           <x>30</x>\n-           <y>30</y>\n-           <width>61</width>\n-           <height>27</height>\n-          </rect>\n-         </property>\n-         <property name=\"text\">\n-          <string>Height:</string>\n-         </property>\n-         <property name=\"alignment\">\n-          <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-         </property>\n-        </widget>\n-        <widget class=\"QSpinBox\" name=\"lastUsedColorsWidth\">\n-         <property name=\"geometry\">\n-          <rect>\n-           <x>100</x>\n-           <y>30</y>\n-           <width>81</width>\n-           <height>27</height>\n-          </rect>\n-         </property>\n-         <property name=\"suffix\">\n-          <string> px</string>\n-         </property>\n-         <property name=\"prefix\">\n-          <string/>\n-         </property>\n-         <property name=\"minimum\">\n-          <number>16</number>\n-         </property>\n-        </widget>\n-        <widget class=\"QLabel\" name=\"label\">\n-         <property name=\"geometry\">\n-          <rect>\n-           <x>40</x>\n-           <y>60</y>\n-           <width>51</width>\n-           <height>21</height>\n-          </rect>\n-         </property>\n-         <property name=\"text\">\n-          <string>Width: </string>\n-         </property>\n-         <property name=\"alignment\">\n-          <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-         </property>\n-        </widget>\n-        <widget class=\"QSpinBox\" name=\"lastUsedColorsHeight\">\n-         <property name=\"geometry\">\n-          <rect>\n-           <x>100</x>\n-           <y>60</y>\n-           <width>81</width>\n-           <height>27</height>\n-          </rect>\n-         </property>\n-         <property name=\"suffix\">\n-          <string> px</string>\n-         </property>\n-         <property name=\"minimum\">\n-          <number>16</number>\n-         </property>\n-        </widget>\n-        <widget class=\"QLabel\" name=\"label_10\">\n-         <property name=\"geometry\">\n-          <rect>\n-           <x>10</x>\n-           <y>90</y>\n-           <width>81</width>\n-           <height>27</height>\n-          </rect>\n-         </property>\n-         <property name=\"text\">\n-          <string>Max Patches: </string>\n-         </property>\n-         <property name=\"alignment\">\n-          <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-         </property>\n-        </widget>\n-        <widget class=\"QSpinBox\" name=\"lastUsedColorsPatchCount\">\n-         <property name=\"geometry\">\n-          <rect>\n-           <x>100</x>\n-           <y>90</y>\n-           <width>81</width>\n-           <height>27</height>\n-          </rect>\n-         </property>\n-         <property name=\"minimum\">\n-          <number>1</number>\n-         </property>\n-         <property name=\"value\">\n-          <number>30</number>\n-         </property>\n-        </widget>\n-       </widget>\n-       <widget class=\"QCheckBox\" name=\"lastUsedColorsAllowScrolling\">\n-        <property name=\"geometry\">\n-         <rect>\n-          <x>20</x>\n-          <y>190</y>\n-          <width>131</width>\n-          <height>22</height>\n-         </rect>\n-        </property>\n-        <property name=\"text\">\n-         <string>Allow scrolling</string>\n-        </property>\n-        <property name=\"checked\">\n-         <bool>true</bool>\n-        </property>\n-       </widget>\n-       <widget class=\"QGroupBox\" name=\"groupBox_2\">\n-        <property name=\"geometry\">\n-         <rect>\n-          <x>270</x>\n-          <y>40</y>\n-          <width>251</width>\n-          <height>141</height>\n-         </rect>\n-        </property>\n-        <property name=\"title\">\n-         <string>Layout</string>\n-        </property>\n-        <widget class=\"QWidget\" name=\"gridLayoutWidget_2\">\n-         <property name=\"geometry\">\n-          <rect>\n-           <x>10</x>\n-           <y>30</y>\n-           <width>232</width>\n-           <height>80</height>\n-          </rect>\n-         </property>\n-         <layout class=\"QGridLayout\" name=\"gridLayout\">\n-          <item row=\"0\" column=\"1\">\n-           <widget class=\"QLabel\" name=\"lbl_lastUsedNumCols\">\n-            <property name=\"text\">\n-             <string>Columns:</string>\n-            </property>\n-            <property name=\"alignment\">\n-             <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-            </property>\n-            <property name=\"buddy\">\n-             <cstring>lastUsedColorsNumCols</cstring>\n-            </property>\n-           </widget>\n-          </item>\n-          <item row=\"0\" column=\"2\">\n-           <widget class=\"QSpinBox\" name=\"lastUsedColorsNumCols\">\n-            <property name=\"minimum\">\n-             <number>1</number>\n-            </property>\n-            <property name=\"maximum\">\n-             <number>20</number>\n-            </property>\n-            <property name=\"value\">\n-             <number>2</number>\n+       <layout class=\"QFormLayout\" name=\"formLayout_2\">\n+        <item row=\"0\" column=\"0\">\n+         <layout class=\"QHBoxLayout\" name=\"horizontalLayout_7\">\n+          <item>\n+           <widget class=\"QGroupBox\" name=\"groupBox\">\n+            <property name=\"title\">\n+             <string>Patch Options</string>\n             </property>\n+            <layout class=\"QGridLayout\" name=\"gridLayout_6\">\n+             <item row=\"0\" column=\"0\">\n+              <widget class=\"QLabel\" name=\"label_14\">\n+               <property name=\"text\">\n+                <string>Height:</string>\n+               </property>\n+               <property name=\"alignment\">\n+                <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+               </property>\n+              </widget>\n+             </item>\n+             <item row=\"0\" column=\"1\">\n+              <widget class=\"QSpinBox\" name=\"lastUsedColorsWidth\">\n+               <property name=\"suffix\">\n+                <string> px</string>\n+               </property>\n+               <property name=\"prefix\">\n+                <string/>\n+               </property>\n+               <property name=\"minimum\">\n+                <number>16</number>\n+               </property>\n+              </widget>\n+             </item>\n+             <item row=\"1\" column=\"0\">\n+              <widget class=\"QLabel\" name=\"label\">\n+               <property name=\"text\">\n+                <string>Width: </string>\n+               </property>\n+               <property name=\"alignment\">\n+                <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+               </property>\n+              </widget>\n+             </item>\n+             <item row=\"1\" column=\"1\">\n+              <widget class=\"QSpinBox\" name=\"lastUsedColorsHeight\">\n+               <property name=\"suffix\">\n+                <string> px</string>\n+               </property>\n+               <property name=\"minimum\">\n+                <number>16</number>\n+               </property>\n+              </widget>\n+             </item>\n+             <item row=\"2\" column=\"0\">\n+              <widget class=\"QLabel\" name=\"label_10\">\n+               <property name=\"text\">\n+                <string>Max Patches: </string>\n+               </property>\n+               <property name=\"alignment\">\n+                <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+               </property>\n+              </widget>\n+             </item>\n+             <item row=\"2\" column=\"1\">\n+              <widget class=\"QSpinBox\" name=\"lastUsedColorsPatchCount\">\n+               <property name=\"minimum\">\n+                <number>1</number>\n+               </property>\n+               <property name=\"value\">\n+                <number>30</number>\n+               </property>\n+              </widget>\n+             </item>\n+            </layout>\n            </widget>\n           </item>\n-          <item row=\"0\" column=\"0\">\n-           <widget class=\"QRadioButton\" name=\"lastUsedColorsAlignVertical\">\n-            <property name=\"text\">\n-             <string>Vertical</string>\n-            </property>\n-            <property name=\"checked\">\n-             <bool>true</bool>\n-            </property>\n-           </widget>\n-          </item>\n-          <item row=\"1\" column=\"0\">\n-           <widget class=\"QRadioButton\" name=\"lastUsedColorsAlignHorizontal\">\n-            <property name=\"text\">\n-             <string>Horizontal</string>\n-            </property>\n-           </widget>\n-          </item>\n-          <item row=\"1\" column=\"1\">\n-           <widget class=\"QLabel\" name=\"lbl_lastUsedNumRows\">\n-            <property name=\"text\">\n-             <string>Rows:</string>\n-            </property>\n-            <property name=\"alignment\">\n-             <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-            </property>\n-            <property name=\"buddy\">\n-             <cstring>lastUsedColorsNumRows</cstring>\n-            </property>\n-           </widget>\n-          </item>\n-          <item row=\"1\" column=\"2\">\n-           <widget class=\"QSpinBox\" name=\"lastUsedColorsNumRows\">\n-            <property name=\"minimum\">\n-             <number>1</number>\n-            </property>\n-            <property name=\"maximum\">\n-             <number>20</number>\n-            </property>\n-            <property name=\"value\">\n-             <number>3</number>\n+          <item>\n+           <widget class=\"QGroupBox\" name=\"groupBox_2\">\n+            <property name=\"title\">\n+             <string>Layout</string>\n             </property>\n+            <layout class=\"QGridLayout\" name=\"gridLayout_4\">\n+             <item row=\"0\" column=\"0\">\n+              <layout class=\"QGridLayout\" name=\"gridLayout\">\n+               <item row=\"0\" column=\"1\">\n+                <widget class=\"QLabel\" name=\"lbl_lastUsedNumCols\">\n+                 <property name=\"text\">\n+                  <string>Columns:</string>\n+                 </property>\n+                 <property name=\"alignment\">\n+                  <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+                 </property>\n+                 <property name=\"buddy\">\n+                  <cstring>lastUsedColorsNumCols</cstring>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"0\" column=\"2\">\n+                <widget class=\"QSpinBox\" name=\"lastUsedColorsNumCols\">\n+                 <property name=\"minimum\">\n+                  <number>1</number>\n+                 </property>\n+                 <property name=\"maximum\">\n+                  <number>20</number>\n+                 </property>\n+                 <property name=\"value\">\n+                  <number>2</number>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"0\" column=\"0\">\n+                <widget class=\"QRadioButton\" name=\"lastUsedColorsAlignVertical\">\n+                 <property name=\"text\">\n+                  <string>Vertical</string>\n+                 </property>\n+                 <property name=\"checked\">\n+                  <bool>true</bool>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"1\" column=\"0\">\n+                <widget class=\"QRadioButton\" name=\"lastUsedColorsAlignHorizontal\">\n+                 <property name=\"text\">\n+                  <string>Horizontal</string>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"1\" column=\"1\">\n+                <widget class=\"QLabel\" name=\"lbl_lastUsedNumRows\">\n+                 <property name=\"text\">\n+                  <string>Rows:</string>\n+                 </property>\n+                 <property name=\"alignment\">\n+                  <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+                 </property>\n+                 <property name=\"buddy\">\n+                  <cstring>lastUsedColorsNumRows</cstring>\n+                 </property>\n+                </widget>\n+               </item>\n+               <item row=\"1\" column=\"2\">\n+                <widget class=\"QSpinBox\" name=\"lastUsedColorsNumRows\">\n+                 <property name=\"minimum\">\n+                  <number>1</number>\n+                 </property>\n+                 <property name=\"maximum\">\n+                  <number>20</number>\n+                 </property>\n+                 <property name=\"value\">\n+                  <number>3</number>\n+                 </property>\n+                </widget>\n+               </item>\n+              </layout>\n+             </item>\n+            </layout>\n            </widget>\n           </item>\n          </layout>\n-        </widget>\n-       </widget>\n+        </item>\n+        <item row=\"1\" column=\"0\">\n+         <widget class=\"QCheckBox\" name=\"lastUsedColorsAllowScrolling\">\n+          <property name=\"text\">\n+           <string>Allow scrolling</string>\n+          </property>\n+          <property name=\"checked\">\n+           <bool>true</bool>\n+          </property>\n+         </widget>\n+        </item>\n+       </layout>\n       </widget>\n      </widget>\n      <widget class=\"QWidget\" name=\"tab_colorsFromImage\">\n@@ -1008,212 +887,6 @@\n        <property name=\"checkable\">\n         <bool>true</bool>\n        </property>\n-       <widget class=\"QGroupBox\" name=\"groupBox_4\">\n-        <property name=\"geometry\">\n-         <rect>\n-          <x>270</x>\n-          <y>40</y>\n-          <width>271</width>\n-          <height>121</height>\n-         </rect>\n-        </property>\n-        <property name=\"title\">\n-         <string>Layout</string>\n-        </property>\n-        <widget class=\"QWidget\" name=\"gridLayoutWidget_3\">\n-         <property name=\"geometry\">\n-          <rect>\n-           <x>10</x>\n-           <y>30</y>\n-           <width>232</width>\n-           <height>75</height>\n-          </rect>\n-         </property>\n-         <layout class=\"QGridLayout\" name=\"gridLayout_2\">\n-          <item row=\"3\" column=\"0\">\n-           <widget class=\"QRadioButton\" name=\"commonColorsAlignHorizontal\">\n-            <property name=\"text\">\n-             <string>Horizontal</string>\n-            </property>\n-            <property name=\"checked\">\n-             <bool>true</bool>\n-            </property>\n-           </widget>\n-          </item>\n-          <item row=\"1\" column=\"0\">\n-           <widget class=\"QRadioButton\" name=\"commonColorsAlignVertical\">\n-            <property name=\"text\">\n-             <string>Vertical</string>\n-            </property>\n-           </widget>\n-          </item>\n-          <item row=\"1\" column=\"1\">\n-           <widget class=\"QLabel\" name=\"lbl_commonColorsNumCols\">\n-            <property name=\"text\">\n-             <string>Columns:</string>\n-            </property>\n-            <property name=\"alignment\">\n-             <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-            </property>\n-            <property name=\"buddy\">\n-             <cstring>commonColorsNumCols</cstring>\n-            </property>\n-           </widget>\n-          </item>\n-          <item row=\"1\" column=\"2\">\n-           <widget class=\"QSpinBox\" name=\"commonColorsNumCols\">\n-            <property name=\"minimum\">\n-             <number>1</number>\n-            </property>\n-            <property name=\"maximum\">\n-             <number>20</number>\n-            </property>\n-            <property name=\"value\">\n-             <number>2</number>\n-            </property>\n-           </widget>\n-          </item>\n-          <item row=\"3\" column=\"1\">\n-           <widget class=\"QLabel\" name=\"lbl_commonColorsNumRows\">\n-            <property name=\"text\">\n-             <string>Rows:</string>\n-            </property>\n-            <property name=\"alignment\">\n-             <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-            </property>\n-            <property name=\"buddy\">\n-             <cstring>commonColorsNumRows</cstring>\n-            </property>\n-           </widget>\n-          </item>\n-          <item row=\"3\" column=\"2\">\n-           <widget class=\"QSpinBox\" name=\"commonColorsNumRows\">\n-            <property name=\"minimum\">\n-             <number>1</number>\n-            </property>\n-            <property name=\"maximum\">\n-             <number>20</number>\n-            </property>\n-            <property name=\"value\">\n-             <number>3</number>\n-            </property>\n-           </widget>\n-          </item>\n-         </layout>\n-        </widget>\n-       </widget>\n-       <widget class=\"QGroupBox\" name=\"groupBox_3\">\n-        <property name=\"geometry\">\n-         <rect>\n-          <x>20</x>\n-          <y>40</y>\n-          <width>211</width>\n-          <height>131</height>\n-         </rect>\n-        </property>\n-        <property name=\"title\">\n-         <string>Patch Options</string>\n-        </property>\n-        <widget class=\"QLabel\" name=\"label_12\">\n-         <property name=\"geometry\">\n-          <rect>\n-           <x>50</x>\n-           <y>30</y>\n-           <width>51</width>\n-           <height>27</height>\n-          </rect>\n-         </property>\n-         <property name=\"text\">\n-          <string>Height:</string>\n-         </property>\n-         <property name=\"alignment\">\n-          <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-         </property>\n-        </widget>\n-        <widget class=\"QSpinBox\" name=\"commonColorsWidth\">\n-         <property name=\"geometry\">\n-          <rect>\n-           <x>110</x>\n-           <y>30</y>\n-           <width>71</width>\n-           <height>27</height>\n-          </rect>\n-         </property>\n-         <property name=\"suffix\">\n-          <string> px</string>\n-         </property>\n-         <property name=\"prefix\">\n-          <string/>\n-         </property>\n-         <property name=\"minimum\">\n-          <number>16</number>\n-         </property>\n-        </widget>\n-        <widget class=\"QLabel\" name=\"label_4\">\n-         <property name=\"geometry\">\n-          <rect>\n-           <x>50</x>\n-           <y>60</y>\n-           <width>51</width>\n-           <height>21</height>\n-          </rect>\n-         </property>\n-         <property name=\"text\">\n-          <string>Width:</string>\n-         </property>\n-         <property name=\"alignment\">\n-          <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-         </property>\n-        </widget>\n-        <widget class=\"QSpinBox\" name=\"commonColorsHeight\">\n-         <property name=\"geometry\">\n-          <rect>\n-           <x>110</x>\n-           <y>60</y>\n-           <width>71</width>\n-           <height>27</height>\n-          </rect>\n-         </property>\n-         <property name=\"suffix\">\n-          <string> px</string>\n-         </property>\n-         <property name=\"minimum\">\n-          <number>16</number>\n-         </property>\n-        </widget>\n-        <widget class=\"QLabel\" name=\"label_9\">\n-         <property name=\"geometry\">\n-          <rect>\n-           <x>20</x>\n-           <y>90</y>\n-           <width>91</width>\n-           <height>31</height>\n-          </rect>\n-         </property>\n-         <property name=\"text\">\n-          <string>Max Patches: </string>\n-         </property>\n-         <property name=\"alignment\">\n-          <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n-         </property>\n-        </widget>\n-        <widget class=\"QSpinBox\" name=\"commonColorsPatchCount\">\n-         <property name=\"geometry\">\n-          <rect>\n-           <x>110</x>\n-           <y>90</y>\n-           <width>71</width>\n-           <height>27</height>\n-          </rect>\n-         </property>\n-         <property name=\"minimum\">\n-          <number>1</number>\n-         </property>\n-         <property name=\"value\">\n-          <number>30</number>\n-         </property>\n-        </widget>\n-       </widget>\n        <widget class=\"QCheckBox\" name=\"commonColorsAutoUpdate\">\n         <property name=\"geometry\">\n          <rect>\n@@ -1243,6 +916,172 @@\n          <string>Allow scrolling</string>\n         </property>\n        </widget>\n+       <widget class=\"QWidget\" name=\"\">\n+        <property name=\"geometry\">\n+         <rect>\n+          <x>20</x>\n+          <y>40</y>\n+          <width>434</width>\n+          <height>140</height>\n+         </rect>\n+        </property>\n+        <layout class=\"QHBoxLayout\" name=\"horizontalLayout_8\">\n+         <item>\n+          <widget class=\"QGroupBox\" name=\"groupBox_3\">\n+           <property name=\"title\">\n+            <string>Patch Options</string>\n+           </property>\n+           <layout class=\"QGridLayout\" name=\"gridLayout_7\">\n+            <item row=\"0\" column=\"0\">\n+             <widget class=\"QLabel\" name=\"label_12\">\n+              <property name=\"text\">\n+               <string>Height:</string>\n+              </property>\n+              <property name=\"alignment\">\n+               <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+              </property>\n+             </widget>\n+            </item>\n+            <item row=\"0\" column=\"1\">\n+             <widget class=\"QSpinBox\" name=\"commonColorsWidth\">\n+              <property name=\"suffix\">\n+               <string> px</string>\n+              </property>\n+              <property name=\"prefix\">\n+               <string/>\n+              </property>\n+              <property name=\"minimum\">\n+               <number>16</number>\n+              </property>\n+             </widget>\n+            </item>\n+            <item row=\"1\" column=\"0\">\n+             <widget class=\"QLabel\" name=\"label_4\">\n+              <property name=\"text\">\n+               <string>Width:</string>\n+              </property>\n+              <property name=\"alignment\">\n+               <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+              </property>\n+             </widget>\n+            </item>\n+            <item row=\"1\" column=\"1\">\n+             <widget class=\"QSpinBox\" name=\"commonColorsHeight\">\n+              <property name=\"suffix\">\n+               <string> px</string>\n+              </property>\n+              <property name=\"minimum\">\n+               <number>16</number>\n+              </property>\n+             </widget>\n+            </item>\n+            <item row=\"2\" column=\"0\">\n+             <widget class=\"QLabel\" name=\"label_9\">\n+              <property name=\"text\">\n+               <string>Max Patches: </string>\n+              </property>\n+              <property name=\"alignment\">\n+               <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+              </property>\n+             </widget>\n+            </item>\n+            <item row=\"2\" column=\"1\">\n+             <widget class=\"QSpinBox\" name=\"commonColorsPatchCount\">\n+              <property name=\"minimum\">\n+               <number>1</number>\n+              </property>\n+              <property name=\"value\">\n+               <number>30</number>\n+              </property>\n+             </widget>\n+            </item>\n+           </layout>\n+          </widget>\n+         </item>\n+         <item>\n+          <widget class=\"QGroupBox\" name=\"groupBox_4\">\n+           <property name=\"title\">\n+            <string>Layout</string>\n+           </property>\n+           <layout class=\"QGridLayout\" name=\"gridLayout_8\">\n+            <item row=\"0\" column=\"0\">\n+             <layout class=\"QGridLayout\" name=\"gridLayout_2\">\n+              <item row=\"3\" column=\"0\">\n+               <widget class=\"QRadioButton\" name=\"commonColorsAlignHorizontal\">\n+                <property name=\"text\">\n+                 <string>Horizontal</string>\n+                </property>\n+                <property name=\"checked\">\n+                 <bool>true</bool>\n+                </property>\n+               </widget>\n+              </item>\n+              <item row=\"1\" column=\"0\">\n+               <widget class=\"QRadioButton\" name=\"commonColorsAlignVertical\">\n+                <property name=\"text\">\n+                 <string>Vertical</string>\n+                </property>\n+               </widget>\n+              </item>\n+              <item row=\"1\" column=\"1\">\n+               <widget class=\"QLabel\" name=\"lbl_commonColorsNumCols\">\n+                <property name=\"text\">\n+                 <string>Columns:</string>\n+                </property>\n+                <property name=\"alignment\">\n+                 <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+                </property>\n+                <property name=\"buddy\">\n+                 <cstring>commonColorsNumCols</cstring>\n+                </property>\n+               </widget>\n+              </item>\n+              <item row=\"1\" column=\"2\">\n+               <widget class=\"QSpinBox\" name=\"commonColorsNumCols\">\n+                <property name=\"minimum\">\n+                 <number>1</number>\n+                </property>\n+                <property name=\"maximum\">\n+                 <number>20</number>\n+                </property>\n+                <property name=\"value\">\n+                 <number>2</number>\n+                </property>\n+               </widget>\n+              </item>\n+              <item row=\"3\" column=\"1\">\n+               <widget class=\"QLabel\" name=\"lbl_commonColorsNumRows\">\n+                <property name=\"text\">\n+                 <string>Rows:</string>\n+                </property>\n+                <property name=\"alignment\">\n+                 <set>Qt::AlignRight|Qt::AlignTrailing|Qt::AlignVCenter</set>\n+                </property>\n+                <property name=\"buddy\">\n+                 <cstring>commonColorsNumRows</cstring>\n+                </property>\n+               </widget>\n+              </item>\n+              <item row=\"3\" column=\"2\">\n+               <widget class=\"QSpinBox\" name=\"commonColorsNumRows\">\n+                <property name=\"minimum\">\n+                 <number>1</number>\n+                </property>\n+                <property name=\"maximum\">\n+                 <number>20</number>\n+                </property>\n+                <property name=\"value\">\n+                 <number>3</number>\n+                </property>\n+               </widget>\n+              </item>\n+             </layout>\n+            </item>\n+           </layout>\n+          </widget>\n+         </item>\n+        </layout>\n+       </widget>\n       </widget>\n      </widget>\n     </widget>"}]}, {"sha": "61e9950d97fe1fe15c2b20d494ac80dfa8e29c71", "stats": {"total": 19, "additions": 5, "deletions": 14}, "files": [{"sha": "293b34951214290707194186f6da214f3830bb50", "filename": "libs/ui/forms/wdgnewimage.ui", "status": "modified", "additions": 5, "deletions": 14, "changes": 19, "blob_url": "https://github.com/KDE/krita/blob/61e9950d97fe1fe15c2b20d494ac80dfa8e29c71/libs/ui/forms/wdgnewimage.ui", "raw_url": "https://github.com/KDE/krita/raw/61e9950d97fe1fe15c2b20d494ac80dfa8e29c71/libs/ui/forms/wdgnewimage.ui", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/forms/wdgnewimage.ui?ref=61e9950d97fe1fe15c2b20d494ac80dfa8e29c71", "patch": "@@ -7,7 +7,7 @@\n     <x>0</x>\n     <y>0</y>\n     <width>600</width>\n-    <height>420</height>\n+    <height>422</height>\n    </rect>\n   </property>\n   <property name=\"sizePolicy\">\n@@ -67,7 +67,7 @@\n            <property name=\"maximumSize\">\n             <size>\n              <width>16777215</width>\n-             <height>140</height>\n+             <height>16777215</height>\n             </size>\n            </property>\n            <property name=\"title\">\n@@ -523,14 +523,14 @@\n          <property name=\"toolTip\">\n           <string>Reset the image background color in the Image Properties dialog</string>\n          </property>\n-         <property name=\"color\" stdset=\"0\">\n+         <property name=\"color\">\n           <color>\n            <red>255</red>\n            <green>255</green>\n            <blue>255</blue>\n           </color>\n          </property>\n-         <property name=\"defaultColor\" stdset=\"0\">\n+         <property name=\"defaultColor\">\n           <color>\n            <red>255</red>\n            <green>255</green>\n@@ -548,16 +548,7 @@\n           <enum>QFrame::Plain</enum>\n          </property>\n          <layout class=\"QHBoxLayout\" name=\"_2\">\n-          <property name=\"leftMargin\">\n-           <number>0</number>\n-          </property>\n-          <property name=\"topMargin\">\n-           <number>0</number>\n-          </property>\n-          <property name=\"rightMargin\">\n-           <number>0</number>\n-          </property>\n-          <property name=\"bottomMargin\">\n+          <property name=\"margin\">\n            <number>0</number>\n           </property>\n           <item>"}]}, {"sha": "c9c353968e3a3f396cd29d7d99255996958de809", "stats": {"total": 26, "additions": 26, "deletions": 0}, "files": [{"sha": "00b9ea7932726add1db7615eb481616b44e6eb5b", "filename": "windows/mxe.txt", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/KDE/krita/blob/c9c353968e3a3f396cd29d7d99255996958de809/windows/mxe.txt", "raw_url": "https://github.com/KDE/krita/raw/c9c353968e3a3f396cd29d7d99255996958de809/windows/mxe.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/windows/mxe.txt?ref=c9c353968e3a3f396cd29d7d99255996958de809", "patch": "@@ -0,0 +1,26 @@\n+# Where are you building?\n+export BUILDROOT=????\n+\n+cd $BUILDROOT\n+mkdir cross\n+mkdir cross/b\n+mkdir cross/d\n+mkdir cross/krita-build\n+\n+git clone git@github.com:boudewijnrempt/mxe.git\n+cd mxe\n+export PATH=$BUILDROOT/mxe/usr:$BUILDROOT/mxe/usr/x86_64-w64-mingw32.shared/qt5/bin:$PATH\n+\n+# note: poppler-qt5 and gsl don't work yet\n+# Use  i686-w64-mingw32.shared for 32 bits builds\n+\n+make MXE_TARGETS=x86_64-w64-mingw32.shared gcc boost curl eigen exiv2 expat fftw fontconfig freetype gettext ilmbase openexr jpeg lcms libpng libraw opencolorio openjpeg qt5 qtscript tiff vc zlib\n+\n+cd $BUILDROOT\n+git clone git://anongit.kde.org/krita.git\n+\n+cd b\n+\n+x86_64-w64-mingw32.shared-cmake ../krita/3rdparty/ -DEXTERNALS_DOWNLOAD_DIR=$BUILDROOT/d -DINSTALL_ROOT=$BUILDROOT/mxe/usr/x86_64-w64-mingw32.shared -DMXE_TOOLCHAIN=${BUILDROOT}/mxe/usr/i686-w64-mingw32.shared/share/cmake/mxe-conf.cmake\n+\n+cmake --build . --target ext_kwindowsystem"}]}, {"sha": "ba2366c037e057c7cebf11578da072c5411597e7", "stats": {"total": 1, "additions": 0, "deletions": 1}, "files": [{"sha": "746867e498c207c149e9c0ba7848f191e9341d4b", "filename": "3rdparty/CMakeLists.txt", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/ba2366c037e057c7cebf11578da072c5411597e7/3rdparty/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/ba2366c037e057c7cebf11578da072c5411597e7/3rdparty/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/3rdparty/CMakeLists.txt?ref=ba2366c037e057c7cebf11578da072c5411597e7", "patch": "@@ -55,7 +55,6 @@ endif()\n if (MSYS)\n \tset(PATCH_COMMAND patch)\n     set(GLOBAL_PROFILE ${GLOBAL_PROFILE} \n-                           -DCMAKE_TOOLCHAIN_FILE=${MXE_TOOLCHAIN}\n                            -DCMAKE_FIND_PREFIX_PATH=${CMAKE_PREFIX_PATH}\n                            -DCMAKE_SYSTEM_INCLUDE_PATH=${CMAKE_PREFIX_PATH}/include\n                            -DCMAKE_INCLUDE_PATH=${CMAKE_PREFIX_PATH}/include "}]}, {"sha": "08de4b53026b615b23fa456ef8953be2ae7dc2e6", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "504b3384a69a18d7a831fce0aeb5c3ca8965df40", "filename": "winquirks/sys/time.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/08de4b53026b615b23fa456ef8953be2ae7dc2e6/winquirks/sys/time.h", "raw_url": "https://github.com/KDE/krita/raw/08de4b53026b615b23fa456ef8953be2ae7dc2e6/winquirks/sys/time.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/winquirks/sys/time.h?ref=08de4b53026b615b23fa456ef8953be2ae7dc2e6", "patch": "@@ -3,9 +3,9 @@\n \n #include <time.h>\n #include <windows.h>\n-#include <WinSock2.h>\n \n #if defined(_MSC_VER) || defined(_MSC_EXTENSIONS)\n+  #include <WinSock2.h>\n   #define DELTA_EPOCH_IN_MICROSECS  11644473600000000Ui64\n #else\n   #define DELTA_EPOCH_IN_MICROSECS  11644473600000000ULL"}]}, {"sha": "cd0c3c9f6e24d9588e6d97e7810a40360179a2a5", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "116f7e4fb6a747086158dee44647d2b8a358665c", "filename": "krita/main.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/cd0c3c9f6e24d9588e6d97e7810a40360179a2a5/krita/main.cc", "raw_url": "https://github.com/KDE/krita/raw/cd0c3c9f6e24d9588e6d97e7810a40360179a2a5/krita/main.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/main.cc?ref=cd0c3c9f6e24d9588e6d97e7810a40360179a2a5", "patch": "@@ -44,7 +44,7 @@\n #include \"KisApplicationArguments.h\"\n \n #if defined Q_OS_WIN\n-#include <Windows.h>\n+#include <windows.h>\n #include <stdlib.h>\n #include <kis_tablet_support_win.h>\n "}]}, {"sha": "7c45e8b81599407cc048ae1345c492487ebd2dd7", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "a35c5330d83c2400e696ec563aaafce4a19489ef", "filename": "krita/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/7c45e8b81599407cc048ae1345c492487ebd2dd7/krita/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/7c45e8b81599407cc048ae1345c492487ebd2dd7/krita/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/CMakeLists.txt?ref=7c45e8b81599407cc048ae1345c492487ebd2dd7", "patch": "@@ -90,7 +90,7 @@ install(FILES  krita.appdata.xml DESTINATION ${SHARE_INSTALL_PREFIX}/appdata/ )\n install(DIRECTORY DESTINATION ${DATA_INSTALL_DIR}/krita/shortcuts)\n \n \n-if (Qt5Quick_FOUND)\n+if (Qt5Quick_FOUND AND NOT MSYS)\n    add_subdirectory(sketch)\n #    add_subdirectory(gemini)\n endif ()"}]}, {"sha": "c148fa003f64ba3179b80218bb98743c64b58480", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "945166b32e470eac40f089b26eb7e9957a349a55", "filename": "CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/c148fa003f64ba3179b80218bb98743c64b58480/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/c148fa003f64ba3179b80218bb98743c64b58480/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=c148fa003f64ba3179b80218bb98743c64b58480", "patch": "@@ -392,7 +392,7 @@ endif ()\n ##\n ## Test for GNU Scientific Library\n ##\n-find_package(GSL REQUIRED)\n+macro_optional_find_package(GSL)\n macro_log_feature(GSL_FOUND \"GSL\" \"GNU Scientific Library\" \"http://www.gnu.org/software/gsl\" FALSE \"1.7\" \"Required by Krita's Transform tool.\")\n macro_bool_to_01(GSL_FOUND HAVE_GSL)\n configure_file(config-gsl.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config-gsl.h )"}]}, {"sha": "e3c0386808b2e982cafb09af2a30c43dbd2105db", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "99211793c6e52c110098add3da0b484760c8b6ea", "filename": "3rdparty/ext_frameworks/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/e3c0386808b2e982cafb09af2a30c43dbd2105db/3rdparty/ext_frameworks/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/e3c0386808b2e982cafb09af2a30c43dbd2105db/3rdparty/ext_frameworks/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/3rdparty/ext_frameworks/CMakeLists.txt?ref=e3c0386808b2e982cafb09af2a30c43dbd2105db", "patch": "@@ -149,7 +149,7 @@ ExternalProject_Add(\n                 -DBUILD_TESTING=false\n     UPDATE_COMMAND \"\"\n     ALWAYS 0\n-    DEPENDS ext_gettext ext_kguiaddons\n+    DEPENDS ext_kguiaddons\n )\n \n "}]}, {"sha": "c23bfbd4e1ee0dc88d8a8c63702b911be101a912", "stats": {"total": 12, "additions": 6, "deletions": 6}, "files": [{"sha": "400f65bfc47daae65f873bc76067dcef387b34c8", "filename": "3rdparty/CMakeLists.txt", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/KDE/krita/blob/c23bfbd4e1ee0dc88d8a8c63702b911be101a912/3rdparty/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/c23bfbd4e1ee0dc88d8a8c63702b911be101a912/3rdparty/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/3rdparty/CMakeLists.txt?ref=c23bfbd4e1ee0dc88d8a8c63702b911be101a912", "patch": "@@ -2,9 +2,9 @@ project (krita-and-all-its-deps)\n \n #\n # Build all dependencies for Krita and finally Krita itself.\n-# Parameters: EXTERNALS_DOWNLOAD_DIR place to download all packagfes\n+# Parameters: EXTERNALS_DOWNLOAD_DIR place to download all packages\n #             INSTALL_ROOT place to install everything to\n-#             WIN64_BUILD=TRUE/FALSE Whether it's a win64 build: false is default\n+#             MXE_TOOLCHAIN: the toolchain file to cross-compile using MXE\n # \n # Example usage: cmake ..\\kritadeposx -DEXTERNALS_DOWNLOAD_DIR=/dev2/d -DINSTALL_ROOT=/dev2/i -DWIN64_BUILD=TRUE  -DBOOST_LIBRARYDIR=/dev2/i/lib   -G \"Visual Studio 11 Win64\"\n \n@@ -54,15 +54,15 @@ endif()\n \n if (MSYS)\n \tset(PATCH_COMMAND patch)\n-        set(GLOBAL_PROFILE ${GLOBAL_PROFILE} -DCMAKE_TOOLCHAIN_FILE=/data/mxe/mxe/usr/i686-w64-mingw32/share/cmake/mxe-conf.cmake \n+    set(GLOBAL_PROFILE ${GLOBAL_PROFILE} \n+                           -DCMAKE_TOOLCHAIN_FILE=${MXE_TOOLCHAIN}\n                            -DCMAKE_FIND_PREFIX_PATH=${CMAKE_PREFIX_PATH}\n                            -DCMAKE_SYSTEM_INCLUDE_PATH=${CMAKE_PREFIX_PATH}/include\n                            -DCMAKE_INCLUDE_PATH=${CMAKE_PREFIX_PATH}/include \n                            -DCMAKE_LIBRARY_PATH=${CMAKE_PREFIX_PATH}/lib\n                            -DZLIB_ROOT=${CMAKE_PREFIX_PATH}\n-        )\n-        set(GLOBAL_AUTOMAKE_PROFILE  --host=i686-pc-mingw32 )\n-\n+    )\n+    set(GLOBAL_AUTOMAKE_PROFILE  --host=i686-pc-mingw32 )\n endif() \n \n if (APPLE)"}]}, {"sha": "5c4c327ad429def4eaccc8d7bbd8f70d374a51ae", "stats": {"total": 528, "additions": 273, "deletions": 255}, "files": [{"sha": "a3d5976060652969691429bc2110bed403d40192", "filename": "plugins/impex/jpeg/kis_jpeg_converter.cc", "status": "modified", "additions": 273, "deletions": 255, "changes": 528, "blob_url": "https://github.com/KDE/krita/blob/5c4c327ad429def4eaccc8d7bbd8f70d374a51ae/plugins/impex/jpeg/kis_jpeg_converter.cc", "raw_url": "https://github.com/KDE/krita/raw/5c4c327ad429def4eaccc8d7bbd8f70d374a51ae/plugins/impex/jpeg/kis_jpeg_converter.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/jpeg/kis_jpeg_converter.cc?ref=5c4c327ad429def4eaccc8d7bbd8f70d374a51ae", "patch": "@@ -83,6 +83,16 @@ const QByteArray photoshopIptc_((char*)&photoshopIptc, 2);\n namespace\n {\n \n+void jpegErrorExit ( j_common_ptr cinfo )\n+{\n+    char jpegLastErrorMsg[JMSG_LENGTH_MAX];\n+    /* Create the message */\n+    ( *( cinfo->err->format_message ) ) ( cinfo, jpegLastErrorMsg );\n+\n+    /* Jump to the setjmp point */\n+    throw std::runtime_error( jpegLastErrorMsg ); // or your preffered exception ...\n+}\n+\n J_COLOR_SPACE getColorTypeforColorSpace(const KoColorSpace * cs)\n {\n     if (KoID(cs->id()) == KoID(\"GRAYA\") || cs->id() == \"GRAYAU16\" || cs->id() == \"GRAYA16\") {\n@@ -141,297 +151,305 @@ KisImageBuilder_Result KisJPEGConverter::decode(const QString &filename)\n     struct jpeg_error_mgr jerr;\n \n     cinfo.err = jpeg_std_error(&jerr);\n-    jpeg_create_decompress(&cinfo);\n-    // open the file\n-    QFile file(filename);\n-    if (!file.exists()) {\n-        return (KisImageBuilder_RESULT_NOT_EXIST);\n-    }\n-    if (!file.open(QIODevice::ReadOnly)) {\n-        return (KisImageBuilder_RESULT_BAD_FETCH);\n-    }\n+    jerr.error_exit = jpegErrorExit;\n+\n+    try {\n+        jpeg_create_decompress(&cinfo);\n+        // open the file\n+        QFile file(filename);\n+        if (!file.exists()) {\n+            return (KisImageBuilder_RESULT_NOT_EXIST);\n+        }\n+        if (!file.open(QIODevice::ReadOnly)) {\n+            return (KisImageBuilder_RESULT_BAD_FETCH);\n+        }\n \n-    KisJPEGSource::setSource(&cinfo, &file);\n+        KisJPEGSource::setSource(&cinfo, &file);\n \n-    jpeg_save_markers(&cinfo, JPEG_COM, 0xFFFF);\n-    /* Save APP0..APP15 markers */\n-    for (int m = 0; m < 16; m++)\n-        jpeg_save_markers(&cinfo, JPEG_APP0 + m, 0xFFFF);\n+        jpeg_save_markers(&cinfo, JPEG_COM, 0xFFFF);\n+        /* Save APP0..APP15 markers */\n+        for (int m = 0; m < 16; m++)\n+            jpeg_save_markers(&cinfo, JPEG_APP0 + m, 0xFFFF);\n \n \n-//     setup_read_icc_profile(&cinfo);\n-    // read header\n-    jpeg_read_header(&cinfo, (boolean)true);\n+        //     setup_read_icc_profile(&cinfo);\n+        // read header\n+        jpeg_read_header(&cinfo, (boolean)true);\n \n-    // start reading\n-    jpeg_start_decompress(&cinfo);\n+        // start reading\n+        jpeg_start_decompress(&cinfo);\n \n-    // Get the colorspace\n-    QString modelId = getColorSpaceModelForColorType(cinfo.out_color_space);\n-    if (modelId.isEmpty()) {\n-        dbgFile << \"unsupported colorspace :\" << cinfo.out_color_space;\n-        jpeg_destroy_decompress(&cinfo);\n-        return KisImageBuilder_RESULT_UNSUPPORTED_COLORSPACE;\n-    }\n-    uchar* profile_data;\n-    uint profile_len;\n-    const KoColorProfile* profile = 0;\n-    QByteArray profile_rawdata;\n-    if (read_icc_profile(&cinfo, &profile_data, &profile_len)) {\n-        profile_rawdata.resize(profile_len);\n-        memcpy(profile_rawdata.data(), profile_data, profile_len);\n-        cmsHPROFILE hProfile = cmsOpenProfileFromMem(profile_data, profile_len);\n-\n-        if (hProfile != (cmsHPROFILE) 0) {\n-            profile = KoColorSpaceRegistry::instance()->createColorProfile(modelId, Integer8BitsColorDepthID.id(), profile_rawdata);\n-            Q_CHECK_PTR(profile);\n-            dbgFile <<\"profile name:\" << profile->name() <<\" product information:\" << profile->info();\n-            if (!profile->isSuitableForOutput()) {\n-                dbgFile << \"the profile is not suitable for output and therefore cannot be used in krita, we need to convert the image to a standard profile\"; // TODO: in ko2 popup a selection menu to inform the user\n+        // Get the colorspace\n+        QString modelId = getColorSpaceModelForColorType(cinfo.out_color_space);\n+        if (modelId.isEmpty()) {\n+            dbgFile << \"unsupported colorspace :\" << cinfo.out_color_space;\n+            jpeg_destroy_decompress(&cinfo);\n+            return KisImageBuilder_RESULT_UNSUPPORTED_COLORSPACE;\n+        }\n+        uchar* profile_data;\n+        uint profile_len;\n+        const KoColorProfile* profile = 0;\n+        QByteArray profile_rawdata;\n+        if (read_icc_profile(&cinfo, &profile_data, &profile_len)) {\n+            profile_rawdata.resize(profile_len);\n+            memcpy(profile_rawdata.data(), profile_data, profile_len);\n+            cmsHPROFILE hProfile = cmsOpenProfileFromMem(profile_data, profile_len);\n+\n+            if (hProfile != (cmsHPROFILE) 0) {\n+                profile = KoColorSpaceRegistry::instance()->createColorProfile(modelId, Integer8BitsColorDepthID.id(), profile_rawdata);\n+                Q_CHECK_PTR(profile);\n+                dbgFile <<\"profile name:\" << profile->name() <<\" product information:\" << profile->info();\n+                if (!profile->isSuitableForOutput()) {\n+                    dbgFile << \"the profile is not suitable for output and therefore cannot be used in krita, we need to convert the image to a standard profile\"; // TODO: in ko2 popup a selection menu to inform the user\n+                }\n             }\n         }\n-    }\n \n-    // Check that the profile is used by the color space\n-    if (profile && !KoColorSpaceRegistry::instance()->colorSpaceFactory(\n-        KoColorSpaceRegistry::instance()->colorSpaceId(\n-      modelId, Integer8BitsColorDepthID.id()))->profileIsCompatible(profile)) {\n-        warnFile << \"The profile \" << profile->name() << \" is not compatible with the color space model \" << modelId;\n-        profile = 0;\n-    }\n+        // Check that the profile is used by the color space\n+        if (profile && !KoColorSpaceRegistry::instance()->colorSpaceFactory(\n+                    KoColorSpaceRegistry::instance()->colorSpaceId(\n+                        modelId, Integer8BitsColorDepthID.id()))->profileIsCompatible(profile)) {\n+            warnFile << \"The profile \" << profile->name() << \" is not compatible with the color space model \" << modelId;\n+            profile = 0;\n+        }\n \n-    // Retrieve a pointer to the colorspace\n-    const KoColorSpace* cs;\n-    if (profile && profile->isSuitableForOutput()) {\n-        dbgFile << \"image has embedded profile:\" << profile -> name() << \"\";\n-        cs = KoColorSpaceRegistry::instance()->colorSpace(modelId, Integer8BitsColorDepthID.id(), profile);\n-    } else\n-        cs = KoColorSpaceRegistry::instance()->colorSpace(modelId, Integer8BitsColorDepthID.id(), \"\");\n+        // Retrieve a pointer to the colorspace\n+        const KoColorSpace* cs;\n+        if (profile && profile->isSuitableForOutput()) {\n+            dbgFile << \"image has embedded profile:\" << profile -> name() << \"\";\n+            cs = KoColorSpaceRegistry::instance()->colorSpace(modelId, Integer8BitsColorDepthID.id(), profile);\n+        } else\n+            cs = KoColorSpaceRegistry::instance()->colorSpace(modelId, Integer8BitsColorDepthID.id(), \"\");\n+\n+        if (cs == 0) {\n+            dbgFile << \"unknown colorspace\";\n+            jpeg_destroy_decompress(&cinfo);\n+            return KisImageBuilder_RESULT_UNSUPPORTED_COLORSPACE;\n+        }\n+        // TODO fixit\n+        // Create the cmsTransform if needed\n \n-    if (cs == 0) {\n-        dbgFile << \"unknown colorspace\";\n-        jpeg_destroy_decompress(&cinfo);\n-        return KisImageBuilder_RESULT_UNSUPPORTED_COLORSPACE;\n-    }\n-    // TODO fixit\n-    // Create the cmsTransform if needed\n+        KoColorTransformation* transform = 0;\n+        if (profile && !profile->isSuitableForOutput()) {\n+            transform = KoColorSpaceRegistry::instance()->colorSpace(modelId, Integer8BitsColorDepthID.id(), profile)->createColorConverter(cs, KoColorConversionTransformation::internalRenderingIntent(), KoColorConversionTransformation::internalConversionFlags());\n+        }\n+        // Apparently an invalid transform was created from the profile. See bug https://bugs.kde.org/show_bug.cgi?id=255451.\n+        // After 2.3: warn the user!\n+        if (transform && !transform->isValid()) {\n+            delete transform;\n+            transform = 0;\n+        }\n \n-    KoColorTransformation* transform = 0;\n-    if (profile && !profile->isSuitableForOutput()) {\n-        transform = KoColorSpaceRegistry::instance()->colorSpace(modelId, Integer8BitsColorDepthID.id(), profile)->createColorConverter(cs, KoColorConversionTransformation::internalRenderingIntent(), KoColorConversionTransformation::internalConversionFlags());\n-    }\n-    // Apparently an invalid transform was created from the profile. See bug https://bugs.kde.org/show_bug.cgi?id=255451.\n-    // After 2.3: warn the user!\n-    if (transform && !transform->isValid()) {\n-        delete transform;\n-        transform = 0;\n-    }\n+        // Creating the KisImageSP\n+        if (!m_d->image) {\n+            m_d->image = new KisImage(m_d->doc->createUndoStore(),  cinfo.image_width,  cinfo.image_height, cs, \"built image\");\n+            Q_CHECK_PTR(m_d->image);\n+        }\n \n-    // Creating the KisImageSP\n-    if (!m_d->image) {\n-        m_d->image = new KisImage(m_d->doc->createUndoStore(),  cinfo.image_width,  cinfo.image_height, cs, \"built image\");\n-        Q_CHECK_PTR(m_d->image);\n-    }\n+        // Set resolution\n+        double xres = 72, yres = 72;\n+        if (cinfo.density_unit == 1) {\n+            xres = cinfo.X_density;\n+            yres = cinfo.Y_density;\n+        } else if (cinfo.density_unit == 2) {\n+            xres = cinfo.X_density * 2.54;\n+            yres = cinfo.Y_density * 2.54;\n+        }\n+        if (xres < 72) {\n+            xres = 72;\n+        }\n+        if (yres < 72) {\n+            yres = 72;\n+        }\n+        m_d->image->setResolution(POINT_TO_INCH(xres), POINT_TO_INCH(yres));   // It is the \"invert\" macro because we convert from pointer-per-inchs to points\n \n-    // Set resolution\n-    double xres = 72, yres = 72;\n-    if (cinfo.density_unit == 1) {\n-        xres = cinfo.X_density;\n-        yres = cinfo.Y_density;\n-    } else if (cinfo.density_unit == 2) {\n-        xres = cinfo.X_density * 2.54;\n-        yres = cinfo.Y_density * 2.54;\n-    }\n-    if (xres < 72) {\n-        xres = 72;\n-    }\n-    if (yres < 72) {\n-        yres = 72;\n-    }\n-    m_d->image->setResolution(POINT_TO_INCH(xres), POINT_TO_INCH(yres));   // It is the \"invert\" macro because we convert from pointer-per-inchs to points\n+        // Create layer\n+        KisPaintLayerSP layer = KisPaintLayerSP(new KisPaintLayer(m_d->image.data(), m_d->image -> nextLayerName(), quint8_MAX));\n \n-    // Create layer\n-    KisPaintLayerSP layer = KisPaintLayerSP(new KisPaintLayer(m_d->image.data(), m_d->image -> nextLayerName(), quint8_MAX));\n+        // Read data\n+        JSAMPROW row_pointer = new JSAMPLE[cinfo.image_width*cinfo.num_components];\n \n-    // Read data\n-    JSAMPROW row_pointer = new JSAMPLE[cinfo.image_width*cinfo.num_components];\n+        for (; cinfo.output_scanline < cinfo.image_height;) {\n+            KisHLineIteratorSP it = layer->paintDevice()->createHLineIteratorNG(0, cinfo.output_scanline, cinfo.image_width);\n+            jpeg_read_scanlines(&cinfo, &row_pointer, 1);\n+            quint8 *src = row_pointer;\n+            switch (cinfo.out_color_space) {\n+            case JCS_GRAYSCALE:\n+                do {\n+                    quint8 *d = it->rawData();\n+                    d[0] = *(src++);\n+                    if (transform) transform->transform(d, d, 1);\n+                    d[1] = quint8_MAX;\n \n-    for (; cinfo.output_scanline < cinfo.image_height;) {\n-        KisHLineIteratorSP it = layer->paintDevice()->createHLineIteratorNG(0, cinfo.output_scanline, cinfo.image_width);\n-        jpeg_read_scanlines(&cinfo, &row_pointer, 1);\n-        quint8 *src = row_pointer;\n-        switch (cinfo.out_color_space) {\n-        case JCS_GRAYSCALE:\n-            do {\n-                quint8 *d = it->rawData();\n-                d[0] = *(src++);\n-                if (transform) transform->transform(d, d, 1);\n-                d[1] = quint8_MAX;\n+                } while (it->nextPixel());\n+                break;\n+            case JCS_RGB:\n+                do {\n+                    quint8 *d = it->rawData();\n+                    d[2] = *(src++);\n+                    d[1] = *(src++);\n+                    d[0] = *(src++);\n+                    if (transform) transform->transform(d, d, 1);\n+                    d[3] = quint8_MAX;\n \n-            } while (it->nextPixel());\n-            break;\n-        case JCS_RGB:\n-            do {\n-                quint8 *d = it->rawData();\n-                d[2] = *(src++);\n-                d[1] = *(src++);\n-                d[0] = *(src++);\n-                if (transform) transform->transform(d, d, 1);\n-                d[3] = quint8_MAX;\n-\n-            } while (it->nextPixel());\n-            break;\n-        case JCS_CMYK:\n-            do {\n-                quint8 *d = it->rawData();\n-                d[0] = quint8_MAX - *(src++);\n-                d[1] = quint8_MAX - *(src++);\n-                d[2] = quint8_MAX - *(src++);\n-                d[3] = quint8_MAX - *(src++);\n-                if (transform) transform->transform(d, d, 1);\n-                d[4] = quint8_MAX;\n-\n-            } while (it->nextPixel());\n-            break;\n-        default:\n-            return KisImageBuilder_RESULT_UNSUPPORTED;\n+                } while (it->nextPixel());\n+                break;\n+            case JCS_CMYK:\n+                do {\n+                    quint8 *d = it->rawData();\n+                    d[0] = quint8_MAX - *(src++);\n+                    d[1] = quint8_MAX - *(src++);\n+                    d[2] = quint8_MAX - *(src++);\n+                    d[3] = quint8_MAX - *(src++);\n+                    if (transform) transform->transform(d, d, 1);\n+                    d[4] = quint8_MAX;\n+\n+                } while (it->nextPixel());\n+                break;\n+            default:\n+                return KisImageBuilder_RESULT_UNSUPPORTED;\n+            }\n         }\n-    }\n \n-    m_d->image->addNode(KisNodeSP(layer.data()), m_d->image->rootLayer().data());\n+        m_d->image->addNode(KisNodeSP(layer.data()), m_d->image->rootLayer().data());\n \n-    // Read exif information\n+        // Read exif information\n \n-    dbgFile << \"Looking for exif information\";\n+        dbgFile << \"Looking for exif information\";\n \n-    for (jpeg_saved_marker_ptr marker = cinfo.marker_list; marker != 0; marker = marker->next) {\n-        dbgFile << \"Marker is\" << marker->marker;\n-        if (marker->marker != (JOCTET)(JPEG_APP0 + 1)\n-                || marker->data_length < 14) {\n-            continue; /* Exif data is in an APP1 marker of at least 14 octets */\n-        }\n+        for (jpeg_saved_marker_ptr marker = cinfo.marker_list; marker != 0; marker = marker->next) {\n+            dbgFile << \"Marker is\" << marker->marker;\n+            if (marker->marker != (JOCTET)(JPEG_APP0 + 1)\n+                    || marker->data_length < 14) {\n+                continue; /* Exif data is in an APP1 marker of at least 14 octets */\n+            }\n \n-        if (GETJOCTET(marker->data[0]) != (JOCTET) 0x45 ||\n-                GETJOCTET(marker->data[1]) != (JOCTET) 0x78 ||\n-                GETJOCTET(marker->data[2]) != (JOCTET) 0x69 ||\n-                GETJOCTET(marker->data[3]) != (JOCTET) 0x66 ||\n-                GETJOCTET(marker->data[4]) != (JOCTET) 0x00 ||\n-                GETJOCTET(marker->data[5]) != (JOCTET) 0x00)\n-            continue; /* no Exif header */\n-        dbgFile << \"Found exif information of length :\" << marker->data_length;\n-        KisMetaData::IOBackend* exifIO = KisMetaData::IOBackendRegistry::instance()->value(\"exif\");\n-        Q_ASSERT(exifIO);\n-        QByteArray byteArray((const char*)marker->data + 6, marker->data_length - 6);\n-        QBuffer buf(&byteArray);\n-        exifIO->loadFrom(layer->metaData(), &buf);\n-        // Interpret orientation tag\n-        if (layer->metaData()->containsEntry(\"http://ns.adobe.com/tiff/1.0/\", \"Orientation\")) {\n-            KisMetaData::Entry& entry = layer->metaData()->getEntry(\"http://ns.adobe.com/tiff/1.0/\", \"Orientation\");\n-            if (entry.value().type() == KisMetaData::Value::Variant) {\n-                switch (entry.value().asVariant().toInt()) {\n-                case 2:\n-                    KisTransformWorker::mirrorY(layer->paintDevice());\n-                    break;\n-                case 3:\n-                    image()->rotateImage(M_PI);\n-                    break;\n-                case 4:\n-                    KisTransformWorker::mirrorX(layer->paintDevice());\n-                    break;\n-                case 5:\n-                    image()->rotateImage(M_PI / 2);\n-                    KisTransformWorker::mirrorY(layer->paintDevice());\n-                    break;\n-                case 6:\n-                    image()->rotateImage(M_PI / 2);\n-                    break;\n-                case 7:\n-                    image()->rotateImage(M_PI / 2);\n-                    KisTransformWorker::mirrorX(layer->paintDevice());\n-                    break;\n-                case 8:\n-                    image()->rotateImage(-M_PI / 2 + M_PI*2);\n-                    break;\n-                default:\n-                    break;\n+            if (GETJOCTET(marker->data[0]) != (JOCTET) 0x45 ||\n+                    GETJOCTET(marker->data[1]) != (JOCTET) 0x78 ||\n+                    GETJOCTET(marker->data[2]) != (JOCTET) 0x69 ||\n+                    GETJOCTET(marker->data[3]) != (JOCTET) 0x66 ||\n+                    GETJOCTET(marker->data[4]) != (JOCTET) 0x00 ||\n+                    GETJOCTET(marker->data[5]) != (JOCTET) 0x00)\n+                continue; /* no Exif header */\n+            dbgFile << \"Found exif information of length :\" << marker->data_length;\n+            KisMetaData::IOBackend* exifIO = KisMetaData::IOBackendRegistry::instance()->value(\"exif\");\n+            Q_ASSERT(exifIO);\n+            QByteArray byteArray((const char*)marker->data + 6, marker->data_length - 6);\n+            QBuffer buf(&byteArray);\n+            exifIO->loadFrom(layer->metaData(), &buf);\n+            // Interpret orientation tag\n+            if (layer->metaData()->containsEntry(\"http://ns.adobe.com/tiff/1.0/\", \"Orientation\")) {\n+                KisMetaData::Entry& entry = layer->metaData()->getEntry(\"http://ns.adobe.com/tiff/1.0/\", \"Orientation\");\n+                if (entry.value().type() == KisMetaData::Value::Variant) {\n+                    switch (entry.value().asVariant().toInt()) {\n+                    case 2:\n+                        KisTransformWorker::mirrorY(layer->paintDevice());\n+                        break;\n+                    case 3:\n+                        image()->rotateImage(M_PI);\n+                        break;\n+                    case 4:\n+                        KisTransformWorker::mirrorX(layer->paintDevice());\n+                        break;\n+                    case 5:\n+                        image()->rotateImage(M_PI / 2);\n+                        KisTransformWorker::mirrorY(layer->paintDevice());\n+                        break;\n+                    case 6:\n+                        image()->rotateImage(M_PI / 2);\n+                        break;\n+                    case 7:\n+                        image()->rotateImage(M_PI / 2);\n+                        KisTransformWorker::mirrorX(layer->paintDevice());\n+                        break;\n+                    case 8:\n+                        image()->rotateImage(-M_PI / 2 + M_PI*2);\n+                        break;\n+                    default:\n+                        break;\n+                    }\n                 }\n+                entry.value().setVariant(1);\n             }\n-            entry.value().setVariant(1);\n+            break;\n         }\n-        break;\n-    }\n \n-    dbgFile << \"Looking for IPTC information\";\n+        dbgFile << \"Looking for IPTC information\";\n \n-    for (jpeg_saved_marker_ptr marker = cinfo.marker_list; marker != 0; marker = marker->next) {\n-        dbgFile << \"Marker is\" << marker->marker;\n-        if (marker->marker != (JOCTET)(JPEG_APP0 + 13) ||  marker->data_length < 14) {\n-            continue; /* IPTC data is in an APP13 marker of at least 16 octets */\n-        }\n-        if (memcmp(marker->data, photoshopMarker, 14) != 0) {\n-            for (int i = 0; i < 14; i++) {\n-                dbgFile << (int)(*(marker->data + i)) << \"\" << (int)(photoshopMarker[i]);\n+        for (jpeg_saved_marker_ptr marker = cinfo.marker_list; marker != 0; marker = marker->next) {\n+            dbgFile << \"Marker is\" << marker->marker;\n+            if (marker->marker != (JOCTET)(JPEG_APP0 + 13) ||  marker->data_length < 14) {\n+                continue; /* IPTC data is in an APP13 marker of at least 16 octets */\n+            }\n+            if (memcmp(marker->data, photoshopMarker, 14) != 0) {\n+                for (int i = 0; i < 14; i++) {\n+                    dbgFile << (int)(*(marker->data + i)) << \"\" << (int)(photoshopMarker[i]);\n+                }\n+                dbgFile << \"No photoshop marker\";\n+                continue; /* No IPTC Header */\n             }\n-            dbgFile << \"No photoshop marker\";\n-            continue; /* No IPTC Header */\n-        }\n \n-        dbgFile << \"Found Photoshop information of length :\" << marker->data_length;\n-        KisMetaData::IOBackend* iptcIO = KisMetaData::IOBackendRegistry::instance()->value(\"iptc\");\n-        Q_ASSERT(iptcIO);\n-        const Exiv2::byte *record = 0;\n-        uint32_t sizeIptc = 0;\n-        uint32_t sizeHdr = 0;\n-        // Find actual Iptc data within the APP13 segment\n-        if (!Exiv2::Photoshop::locateIptcIrb((Exiv2::byte*)(marker->data + 14),\n-                                             marker->data_length - 14, &record, &sizeHdr, &sizeIptc)) {\n-            if (sizeIptc) {\n-                // Decode the IPTC data\n-                QByteArray byteArray((const char*)(record + sizeHdr), sizeIptc);\n-                iptcIO->loadFrom(layer->metaData(), new QBuffer(&byteArray));\n-            } else {\n-                dbgFile << \"IPTC Not found in Photoshop marker\";\n+            dbgFile << \"Found Photoshop information of length :\" << marker->data_length;\n+            KisMetaData::IOBackend* iptcIO = KisMetaData::IOBackendRegistry::instance()->value(\"iptc\");\n+            Q_ASSERT(iptcIO);\n+            const Exiv2::byte *record = 0;\n+            uint32_t sizeIptc = 0;\n+            uint32_t sizeHdr = 0;\n+            // Find actual Iptc data within the APP13 segment\n+            if (!Exiv2::Photoshop::locateIptcIrb((Exiv2::byte*)(marker->data + 14),\n+                                                 marker->data_length - 14, &record, &sizeHdr, &sizeIptc)) {\n+                if (sizeIptc) {\n+                    // Decode the IPTC data\n+                    QByteArray byteArray((const char*)(record + sizeHdr), sizeIptc);\n+                    iptcIO->loadFrom(layer->metaData(), new QBuffer(&byteArray));\n+                } else {\n+                    dbgFile << \"IPTC Not found in Photoshop marker\";\n+                }\n             }\n+            break;\n         }\n-        break;\n-    }\n \n-    dbgFile << \"Looking for XMP information\";\n+        dbgFile << \"Looking for XMP information\";\n \n-    for (jpeg_saved_marker_ptr marker = cinfo.marker_list; marker != 0; marker = marker->next) {\n-        dbgFile << \"Marker is\" << marker->marker;\n-        if (marker->marker != (JOCTET)(JPEG_APP0 + 1) || marker->data_length < 31) {\n-            continue; /* XMP data is in an APP1 marker of at least 31 octets */\n-        }\n-        if (memcmp(marker->data, xmpMarker, 29) != 0) {\n-            dbgFile << \"Not XMP marker\";\n-            continue; /* No xmp Header */\n+        for (jpeg_saved_marker_ptr marker = cinfo.marker_list; marker != 0; marker = marker->next) {\n+            dbgFile << \"Marker is\" << marker->marker;\n+            if (marker->marker != (JOCTET)(JPEG_APP0 + 1) || marker->data_length < 31) {\n+                continue; /* XMP data is in an APP1 marker of at least 31 octets */\n+            }\n+            if (memcmp(marker->data, xmpMarker, 29) != 0) {\n+                dbgFile << \"Not XMP marker\";\n+                continue; /* No xmp Header */\n+            }\n+            dbgFile << \"Found XMP Marker of length \" << marker->data_length;\n+            QByteArray byteArray((const char*)marker->data + 29, marker->data_length - 29);\n+            KisMetaData::IOBackend* xmpIO = KisMetaData::IOBackendRegistry::instance()->value(\"xmp\");\n+            Q_ASSERT(xmpIO);\n+            xmpIO->loadFrom(layer->metaData(), new QBuffer(&byteArray));\n+            break;\n         }\n-        dbgFile << \"Found XMP Marker of length \" << marker->data_length;\n-        QByteArray byteArray((const char*)marker->data + 29, marker->data_length - 29);\n-        KisMetaData::IOBackend* xmpIO = KisMetaData::IOBackendRegistry::instance()->value(\"xmp\");\n-        Q_ASSERT(xmpIO);\n-        xmpIO->loadFrom(layer->metaData(), new QBuffer(&byteArray));\n-        break;\n-    }\n \n-    // Dump loaded metadata\n-    layer->metaData()->debugDump();\n+        // Dump loaded metadata\n+        layer->metaData()->debugDump();\n \n-    // Check whether the metadata has resolution info, too...\n-    if (cinfo.density_unit == 0 && layer->metaData()->containsEntry(\"tiff:XResolution\") && layer->metaData()->containsEntry(\"tiff:YResolution\")) {\n-        double xres = layer->metaData()->getEntry(\"tiff:XResolution\").value().asDouble();\n-        double yres = layer->metaData()->getEntry(\"tiff:YResolution\").value().asDouble();\n-        if (xres != 0 && yres != 0) {\n-            m_d->image->setResolution(POINT_TO_INCH(xres), POINT_TO_INCH(yres));   // It is the \"invert\" macro because we convert from pointer-per-inchs to points\n+        // Check whether the metadata has resolution info, too...\n+        if (cinfo.density_unit == 0 && layer->metaData()->containsEntry(\"tiff:XResolution\") && layer->metaData()->containsEntry(\"tiff:YResolution\")) {\n+            double xres = layer->metaData()->getEntry(\"tiff:XResolution\").value().asDouble();\n+            double yres = layer->metaData()->getEntry(\"tiff:YResolution\").value().asDouble();\n+            if (xres != 0 && yres != 0) {\n+                m_d->image->setResolution(POINT_TO_INCH(xres), POINT_TO_INCH(yres));   // It is the \"invert\" macro because we convert from pointer-per-inchs to points\n+            }\n         }\n-    }\n \n-    // Finish decompression\n-    jpeg_finish_decompress(&cinfo);\n-    jpeg_destroy_decompress(&cinfo);\n-    delete [] row_pointer;\n-    return KisImageBuilder_RESULT_OK;\n+        // Finish decompression\n+        jpeg_finish_decompress(&cinfo);\n+        jpeg_destroy_decompress(&cinfo);\n+        delete [] row_pointer;\n+        return KisImageBuilder_RESULT_OK;\n+    }\n+    catch( std::runtime_error &e) {\n+        jpeg_destroy_decompress(&cinfo);\n+        return KisImageBuilder_RESULT_FAILURE;\n+    }\n }\n \n \n@@ -531,7 +549,7 @@ KisImageBuilder_Result KisJPEGConverter::buildFile(const QString &filename, KisP\n         cinfo.comp_info[2].v_samp_factor = 1;\n \n     }\n-    break;\n+        break;\n     case 1: {\n         cinfo.comp_info[0].h_samp_factor = 2;\n         cinfo.comp_info[0].v_samp_factor = 1;\n@@ -540,7 +558,7 @@ KisImageBuilder_Result KisJPEGConverter::buildFile(const QString &filename, KisP\n         cinfo.comp_info[2].h_samp_factor = 1;\n         cinfo.comp_info[2].v_samp_factor = 1;\n     }\n-    break;\n+        break;\n     case 2: {\n         cinfo.comp_info[0].h_samp_factor = 1;\n         cinfo.comp_info[0].v_samp_factor = 2;\n@@ -549,7 +567,7 @@ KisImageBuilder_Result KisJPEGConverter::buildFile(const QString &filename, KisP\n         cinfo.comp_info[2].h_samp_factor = 1;\n         cinfo.comp_info[2].v_samp_factor = 1;\n     }\n-    break;\n+        break;\n     case 3: {\n         cinfo.comp_info[0].h_samp_factor = 1;\n         cinfo.comp_info[0].v_samp_factor = 1;\n@@ -558,7 +576,7 @@ KisImageBuilder_Result KisJPEGConverter::buildFile(const QString &filename, KisP\n         cinfo.comp_info[2].h_samp_factor = 1;\n         cinfo.comp_info[2].v_samp_factor = 1;\n     }\n-    break;\n+        break;\n     }\n \n     // Save resolution"}]}, {"sha": "fc8aa6c24bfdd0252a9710c8668fe086bf765c39", "stats": {"total": 2, "additions": 0, "deletions": 2}, "files": [{"sha": "f50cc428955bda599d0da02b30704ad3a9ef2e0c", "filename": "libs/ui/CMakeLists.txt", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/fc8aa6c24bfdd0252a9710c8668fe086bf765c39/libs/ui/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/fc8aa6c24bfdd0252a9710c8668fe086bf765c39/libs/ui/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/CMakeLists.txt?ref=fc8aa6c24bfdd0252a9710c8668fe086bf765c39", "patch": "@@ -395,8 +395,6 @@ if(UNIX)\n     endif()\n endif()\n \n-kde_enable_exceptions()\n-\n if(WIN32)\n     #ki18n_wrap_ui(\n     #    input/wintab/kis_screen_size_choice_dialog.ui"}]}, {"sha": "d84e0ad2bd5ddaf51e2088ac4b6c5f4d6e96699d", "stats": {"total": 1, "additions": 1, "deletions": 0}, "files": [{"sha": "7da0be37a3bdc9e6572982e311abe7d0b848fe93", "filename": "libs/ui/dialogs/kis_dlg_preferences.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/d84e0ad2bd5ddaf51e2088ac4b6c5f4d6e96699d/libs/ui/dialogs/kis_dlg_preferences.cc", "raw_url": "https://github.com/KDE/krita/raw/d84e0ad2bd5ddaf51e2088ac4b6c5f4d6e96699d/libs/ui/dialogs/kis_dlg_preferences.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/dialogs/kis_dlg_preferences.cc?ref=d84e0ad2bd5ddaf51e2088ac4b6c5f4d6e96699d", "patch": "@@ -275,6 +275,7 @@ void ShortcutSettingsTab::setDefault()\n \n void ShortcutSettingsTab::saveChanges()\n {\n+    m_page->save();\n     KisActionRegistry::instance()->settingsPageSaved();\n }\n "}]}, {"sha": "be622b037534cd79c8dce1622b3001d5cda6ee27", "stats": {"total": 16, "additions": 10, "deletions": 6}, "files": [{"sha": "bd8b14d3150a89ac645be73f529626ed70f26e0c", "filename": "libs/widgetutils/KoFileDialog.cpp", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/KDE/krita/blob/be622b037534cd79c8dce1622b3001d5cda6ee27/libs/widgetutils/KoFileDialog.cpp", "raw_url": "https://github.com/KDE/krita/raw/be622b037534cd79c8dce1622b3001d5cda6ee27/libs/widgetutils/KoFileDialog.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/KoFileDialog.cpp?ref=be622b037534cd79c8dce1622b3001d5cda6ee27", "patch": "@@ -423,10 +423,12 @@ const QStringList KoFileDialog::getFilterStringListFromMime(const QStringList &m\n                         allSupported.prepend(glob + \" \");\n                     }\n #ifdef Q_OS_LINUX\n+                if (qgetenv(\"XDG_CURRENT_DESKTOP\") == \"GNOME\") {\n                     oneFilter.prepend(glob.toUpper() + \" \");\n-                    if (withAllSupportedEntry) {\n-                        allSupported.prepend(glob.toUpper() + \" \");\n-                    }\n+                        if (withAllSupportedEntry) {\n+                            allSupported.prepend(glob.toUpper() + \" \");\n+                        }\n+                }\n #endif\n \n                 }\n@@ -436,9 +438,11 @@ const QStringList KoFileDialog::getFilterStringListFromMime(const QStringList &m\n                         allSupported.append(glob + \" \");\n                     }\n #ifdef Q_OS_LINUX\n-                    oneFilter.append(glob.toUpper() + \" \");\n-                    if (withAllSupportedEntry) {\n-                        allSupported.append(glob.toUpper() + \" \");\n+                    if (qgetenv(\"XDG_CURRENT_DESKTOP\") == \"GNOME\") {\n+                        oneFilter.append(glob.toUpper() + \" \");\n+                        if (withAllSupportedEntry) {\n+                            allSupported.append(glob.toUpper() + \" \");\n+                        }\n                     }\n #endif\n                 }"}]}, {"sha": "df137af6cb0694851f6b595ab53fe73cfe42a08b", "stats": {"total": 17, "additions": 17, "deletions": 0}, "files": [{"sha": "196c7ba95ccaf627289e1a2fc5b85c402e99dc0e", "filename": "winquirks/netinet/in.h", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/KDE/krita/blob/df137af6cb0694851f6b595ab53fe73cfe42a08b/winquirks/netinet/in.h", "raw_url": "https://github.com/KDE/krita/raw/df137af6cb0694851f6b595ab53fe73cfe42a08b/winquirks/netinet/in.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/winquirks/netinet/in.h?ref=df137af6cb0694851f6b595ab53fe73cfe42a08b", "patch": "@@ -0,0 +1,17 @@\n+#ifndef QUIRK_NETINET_IN_H\n+#define QUIRK_NETINET_IN_H\n+\n+#if defined (_MSC_VER)\n+/*\n+ * this is used for htonl mostly.\n+ *\n+ * while POSIX specifies <arpa/inet.h> as the portable\n+ * include file, <netinet/in.h> is used throughout\n+ * calligra.\n+ *\n+ */\n+\n+#pragma message(\"winquirk: no netinet/in.h!\")\n+#include <Winsock2.h>\n+#endif\n+#endif"}]}, {"sha": "7efd3d4dcb02fe4f502a06bf7632308d0d5ac508", "stats": {"total": 4, "additions": 3, "deletions": 1}, "files": [{"sha": "614f94e2a5e4b7dc422c6d9049183911c39a79ff", "filename": "plugins/impex/xcf/3rdparty/xcftools/xcftools.h", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/7efd3d4dcb02fe4f502a06bf7632308d0d5ac508/plugins/impex/xcf/3rdparty/xcftools/xcftools.h", "raw_url": "https://github.com/KDE/krita/raw/7efd3d4dcb02fe4f502a06bf7632308d0d5ac508/plugins/impex/xcf/3rdparty/xcftools/xcftools.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/xcf/3rdparty/xcftools/xcftools.h?ref=7efd3d4dcb02fe4f502a06bf7632308d0d5ac508", "patch": "@@ -55,7 +55,9 @@ typedef signed long int   int32_t ;\n # define __ATTRIBUTE__(x)\n #endif\n \n-#if HAVE_ARPA_INET_H\n+#if HAVE_NETINET_IN_H\n+# include <netinet/in.h>\n+#elif HAVE_ARPA_INET_H\n # include <arpa/inet.h>\n #elif WORDS_BIGENDIAN\n # define ntohl(x) (x)"}]}, {"sha": "2228cfb9d6dd0a4d795763a0d9d017ce5041b5af", "stats": {"total": 6, "additions": 3, "deletions": 3}, "files": [{"sha": "b70cc596cc11816e88e78828f5fc540b8fc26d3a", "filename": "libs/ui/dialogs/kis_dlg_preferences.cc", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/2228cfb9d6dd0a4d795763a0d9d017ce5041b5af/libs/ui/dialogs/kis_dlg_preferences.cc", "raw_url": "https://github.com/KDE/krita/raw/2228cfb9d6dd0a4d795763a0d9d017ce5041b5af/libs/ui/dialogs/kis_dlg_preferences.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/dialogs/kis_dlg_preferences.cc?ref=2228cfb9d6dd0a4d795763a0d9d017ce5041b5af", "patch": "@@ -820,7 +820,7 @@ KisDlgPreferences::KisDlgPreferences(QWidget* parent, const char* name)\n     KPageWidgetItem *page = new KPageWidgetItem(vbox, i18n(\"General\"));\n     page->setObjectName(\"general\");\n     page->setHeader(i18n(\"General\"));\n-    page->setIcon(KisIconUtils::loadIcon(\"configure\"));\n+    page->setIcon(KisIconUtils::loadIcon(\"go-home\"));\n     addPage(page);\n     m_general = new GeneralTab(vbox);\n \n@@ -829,7 +829,7 @@ KisDlgPreferences::KisDlgPreferences(QWidget* parent, const char* name)\n     page = new KPageWidgetItem(vbox, i18n(\"Keyboard Shortcuts\"));\n     page->setObjectName(\"shortcuts\");\n     page->setHeader(i18n(\"Shortcuts\"));\n-    page->setIcon(KisIconUtils::loadIcon(\"configure-shortcuts\"));\n+    page->setIcon(KisIconUtils::loadIcon(\"document-export\"));\n     addPage(page);\n     m_shortcutSettings = new ShortcutSettingsTab(vbox);\n     connect(this, SIGNAL(accepted()), m_shortcutSettings, SLOT(saveChanges()));\n@@ -840,7 +840,7 @@ KisDlgPreferences::KisDlgPreferences(QWidget* parent, const char* name)\n     page = addPage(m_inputConfiguration, i18n(\"Canvas Input Settings\"));\n     page->setHeader(i18n(\"Canvas Input\"));\n     page->setObjectName(\"canvasinput\");\n-    page->setIcon(KisIconUtils::loadIcon(\"applications-system\"));\n+    page->setIcon(KisIconUtils::loadIcon(\"configure\"));\n \n     // Display\n     vbox = new KoVBox();"}]}, {"sha": "a384d07f2a45d5af4bf658fdc3051dba4d1ce37c", "stats": {"total": 18, "additions": 10, "deletions": 8}, "files": [{"sha": "af146bd26b7920b671ee1b2bbc36c0c2854cb6b3", "filename": "plugins/extensions/imagesize/dlg_canvassize.cc", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/KDE/krita/blob/a384d07f2a45d5af4bf658fdc3051dba4d1ce37c/plugins/extensions/imagesize/dlg_canvassize.cc", "raw_url": "https://github.com/KDE/krita/raw/a384d07f2a45d5af4bf658fdc3051dba4d1ce37c/plugins/extensions/imagesize/dlg_canvassize.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/imagesize/dlg_canvassize.cc?ref=a384d07f2a45d5af4bf658fdc3051dba4d1ce37c", "patch": "@@ -522,15 +522,17 @@ void DlgCanvasSize::updateYOffsetUIValue(double value)\n \n void DlgCanvasSize::loadAnchorIcons()\n {\n-    m_anchorIcons[NORTH_WEST] =  KisIconUtils::loadIcon(\"arrow_north_west\");\n-    m_anchorIcons[NORTH] = KisIconUtils::loadIcon(\"arrow_north\");\n-    m_anchorIcons[NORTH_EAST] = KisIconUtils::loadIcon(\"arrow_north_east\");\n-    m_anchorIcons[EAST] = KisIconUtils::loadIcon(\"arrow_east\");\n+\n+    m_anchorIcons[NORTH_WEST] =  KisIconUtils::loadIcon(\"arrow-topleft\");\n+    m_anchorIcons[NORTH] = KisIconUtils::loadIcon(\"arrow-up\");\n+    m_anchorIcons[NORTH_EAST] = KisIconUtils::loadIcon(\"arrow-topright\");\n+    m_anchorIcons[EAST] = KisIconUtils::loadIcon(\"arrow-right\");\n     m_anchorIcons[CENTER] = KisIconUtils::loadIcon(\"arrow_center\");\n-    m_anchorIcons[WEST] = KisIconUtils::loadIcon(\"arrow_west\");\n-    m_anchorIcons[SOUTH_WEST] = KisIconUtils::loadIcon(\"arrow_south_west\");\n-    m_anchorIcons[SOUTH] = KisIconUtils::loadIcon(\"arrow_south\");\n-    m_anchorIcons[SOUTH_EAST] = KisIconUtils::loadIcon(\"arrow_south_east\");\n+    m_anchorIcons[WEST] = KisIconUtils::loadIcon(\"arrow-left\");\n+    m_anchorIcons[SOUTH_WEST] = KisIconUtils::loadIcon(\"arrow-downleft\");\n+    m_anchorIcons[SOUTH] = KisIconUtils::loadIcon(\"arrow-down\");\n+    m_anchorIcons[SOUTH_EAST] = KisIconUtils::loadIcon(\"arrow-downright\");\n+\n }\n \n void DlgCanvasSize::updateAnchorIcons(int id)"}]}, {"sha": "44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6", "stats": {"total": 39, "additions": 0, "deletions": 39}, "files": [{"sha": "fd42fcb1d99214de9a930c4099eb6ab12584cf4d", "filename": "libs/image/kis_keyframe.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/image/kis_keyframe.cpp", "raw_url": "https://github.com/KDE/krita/raw/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/image/kis_keyframe.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_keyframe.cpp?ref=44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6", "patch": "@@ -73,5 +73,3 @@ KisKeyframeChannel *KisKeyframe::channel() const\n {\n     return m_d->channel;\n }\n-\n-#include \"kis_keyframe.moc\""}, {"sha": "4f6f4565cc7db5545d40d341cdd06f100f2be9a3", "filename": "libs/image/kis_keyframe_channel.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/image/kis_keyframe_channel.cpp", "raw_url": "https://github.com/KDE/krita/raw/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/image/kis_keyframe_channel.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_keyframe_channel.cpp?ref=44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6", "patch": "@@ -484,5 +484,3 @@ void KisKeyframeChannel::requestUpdate(const KisTimeRange &range, const QRect &r\n         m_d->node->invalidateFrames(range, rect);\n     }\n }\n-\n-#include \"kis_keyframe_channel.moc\""}, {"sha": "2ec85d47dcff217894a535dcea759a1fdac4d039", "filename": "libs/ui/KisDetailsPane.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/KisDetailsPane.cpp", "raw_url": "https://github.com/KDE/krita/raw/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/KisDetailsPane.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisDetailsPane.cpp?ref=44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6", "patch": "@@ -111,5 +111,3 @@ QStandardItemModel* KisDetailsPane::model() const\n {\n     return &d->m_model;\n }\n-\n-#include <KisDetailsPane.moc>"}, {"sha": "89b7a5c785811395b62118a21b4695f364c2007a", "filename": "libs/ui/KisImportExportFilter.cpp", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/KisImportExportFilter.cpp", "raw_url": "https://github.com/KDE/krita/raw/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/KisImportExportFilter.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisImportExportFilter.cpp?ref=44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6", "patch": "@@ -170,6 +170,3 @@ void KisImportExportFilter::slotProgress(int value)\n         d->updater->setValue(value);\n     }\n }\n-\n-\n-#include <KisImportExportFilter.moc>"}, {"sha": "d0a4450e27c310a018b046bf8da68c99160a208c", "filename": "libs/ui/KisNodeDelegate.cpp", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/KisNodeDelegate.cpp", "raw_url": "https://github.com/KDE/krita/raw/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/KisNodeDelegate.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisNodeDelegate.cpp?ref=44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6", "patch": "@@ -840,6 +840,3 @@ void KisNodeDelegate::drawProgressBar(QPainter *p, const QStyleOptionViewItem &o\n         p->restore();\n     }\n }\n-\n-\n-#include <KisNodeDelegate.moc>"}, {"sha": "91982dc37338272f20c29b1c56af340d8eaa0c5b", "filename": "libs/ui/KisNodeToolTip.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/KisNodeToolTip.cpp", "raw_url": "https://github.com/KDE/krita/raw/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/KisNodeToolTip.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisNodeToolTip.cpp?ref=44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6", "patch": "@@ -68,5 +68,3 @@ QTextDocument *KisNodeToolTip::createDocument(const QModelIndex &index)\n \n     return doc;\n }\n-\n-#include <KisNodeToolTip.moc>"}, {"sha": "67815566e14b4c9e541509ea965b5a712e36c1a0", "filename": "libs/ui/KisNodeView.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/KisNodeView.cpp", "raw_url": "https://github.com/KDE/krita/raw/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/KisNodeView.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisNodeView.cpp?ref=44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6", "patch": "@@ -557,5 +557,3 @@ void KisNodeView::setDraggingFlag(bool flag)\n {\n     m_draggingFlag = flag;\n }\n-\n-#include <KisNodeView.moc>"}, {"sha": "7eaa53728d3bdce00c5ebc13cc2925148444f466", "filename": "libs/ui/KisPrintJob.cpp", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/KisPrintJob.cpp", "raw_url": "https://github.com/KDE/krita/raw/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/KisPrintJob.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisPrintJob.cpp?ref=44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6", "patch": "@@ -88,6 +88,3 @@ void KisPrintJob::startPrinting(RemovePolicy removePolicy)\n     if (removePolicy == DeleteWhenDone)\n         deleteLater();\n }\n-\n-\n-#include <KisPrintJob.moc>"}, {"sha": "a2673ad8738fa1b3e84cdde237a1806b03502ba5", "filename": "libs/ui/kis_animation_cache_populator.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/kis_animation_cache_populator.cpp", "raw_url": "https://github.com/KDE/krita/raw/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/kis_animation_cache_populator.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kis_animation_cache_populator.cpp?ref=44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6", "patch": "@@ -401,5 +401,3 @@ void KisAnimationCachePopulator::slotPrivateStartWaitingForConvertedFrame()\n \n     m_d->infoConversionWatcher.setFuture(requestFuture);\n }\n-\n-#include \"kis_animation_cache_populator.moc\""}, {"sha": "d3d36be0e1e1cc246cfd2c7ea4ba47bf69d1f8e2", "filename": "libs/ui/kis_animation_exporter.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/kis_animation_exporter.cpp", "raw_url": "https://github.com/KDE/krita/raw/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/kis_animation_exporter.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kis_animation_exporter.cpp?ref=44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6", "patch": "@@ -225,5 +225,3 @@ void KisAnimationExporter::frameReadyToSave()\n     }\n     stopExport(); //finish\n }\n-\n-#include \"kis_animation_exporter.moc\""}, {"sha": "a089e105cde91e595e8b7045a44dcf2a1e91dd1c", "filename": "libs/ui/kis_node_juggler_compressed.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/kis_node_juggler_compressed.cpp", "raw_url": "https://github.com/KDE/krita/raw/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/kis_node_juggler_compressed.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kis_node_juggler_compressed.cpp?ref=44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6", "patch": "@@ -840,5 +840,3 @@ bool KisNodeJugglerCompressed::isEnded() const\n {\n     return !m_d->isStarted;\n }\n-\n-#include \"kis_node_juggler_compressed.moc\""}, {"sha": "c46dc966a93b75fc622cb4f6fdbbe8753b59f5b5", "filename": "libs/ui/tests/kis_animation_exporter_test.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/tests/kis_animation_exporter_test.cpp", "raw_url": "https://github.com/KDE/krita/raw/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/tests/kis_animation_exporter_test.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/tests/kis_animation_exporter_test.cpp?ref=44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6", "patch": "@@ -96,5 +96,3 @@ void KisAnimationExporterTest::testAnimationExport()\n }\n \n QTEST_MAIN(KisAnimationExporterTest)\n-#include \"kis_animation_exporter_test.moc\"\n-"}, {"sha": "cf3eaf37985ff9b1e0b591604076b173419993fd", "filename": "libs/ui/tests/kis_animation_frame_cache_test.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/tests/kis_animation_frame_cache_test.cpp", "raw_url": "https://github.com/KDE/krita/raw/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/libs/ui/tests/kis_animation_frame_cache_test.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/tests/kis_animation_frame_cache_test.cpp?ref=44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6", "patch": "@@ -101,5 +101,3 @@ void KisAnimationFrameCacheTest::testCache()\n }\n \n QTEST_MAIN(KisAnimationFrameCacheTest)\n-#include \"kis_animation_frame_cache_test.moc\"\n-"}, {"sha": "86bc1113171f477ac15c235cd0701e6a6a471c59", "filename": "plugins/color/lcms2engine/tests/TestKoLcmsColorProfile.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/plugins/color/lcms2engine/tests/TestKoLcmsColorProfile.cpp", "raw_url": "https://github.com/KDE/krita/raw/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/plugins/color/lcms2engine/tests/TestKoLcmsColorProfile.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/color/lcms2engine/tests/TestKoLcmsColorProfile.cpp?ref=44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6", "patch": "@@ -171,5 +171,3 @@ void TestKoLcmsColorProfile::testConversion()\n }\n \n QTEST_MAIN(TestKoLcmsColorProfile)\n-#include <TestKoLcmsColorProfile.moc>\n-"}, {"sha": "ea770bb59498b3a59716e120be25a0352c52d2a8", "filename": "plugins/dockers/animation/animation_docker.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/plugins/dockers/animation/animation_docker.cpp", "raw_url": "https://github.com/KDE/krita/raw/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/plugins/dockers/animation/animation_docker.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/animation/animation_docker.cpp?ref=44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6", "patch": "@@ -564,5 +564,3 @@ void AnimationDocker::slotDropFramesChanged(bool value)\n         updateDropFramesIcon();\n     }\n }\n-\n-#include \"animation_docker.moc\""}, {"sha": "35e2288aaaf7df33d837599abf5baa753bcca095", "filename": "plugins/dockers/animation/timeline_docker.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/plugins/dockers/animation/timeline_docker.cpp", "raw_url": "https://github.com/KDE/krita/raw/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/plugins/dockers/animation/timeline_docker.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/animation/timeline_docker.cpp?ref=44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6", "patch": "@@ -140,5 +140,3 @@ void TimelineDocker::setMainWindow(KisViewManager *view)\n         actionManager->addAction(it.key(), it.value());\n     }\n }\n-\n-#include \"timeline_docker.moc\""}, {"sha": "9c925e8d18cd6f69d1d591bb42a689350e50038c", "filename": "plugins/dockers/colorslider/kis_hsv_slider.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/plugins/dockers/colorslider/kis_hsv_slider.cpp", "raw_url": "https://github.com/KDE/krita/raw/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/plugins/dockers/colorslider/kis_hsv_slider.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/colorslider/kis_hsv_slider.cpp?ref=44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6", "patch": "@@ -266,5 +266,3 @@ void KisHSVSlider::drawArrow(QPainter *painter, const QPoint &pos)\n     style()->drawPrimitive(arrowPE, &o, painter, this);\n \n }\n-\n-#include <kis_hsv_slider.moc>"}, {"sha": "479ab5aaa87020b9c652e26c1c2faf5ab6beb130", "filename": "plugins/dockers/historydocker/HistoryDock.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/plugins/dockers/historydocker/HistoryDock.cpp", "raw_url": "https://github.com/KDE/krita/raw/44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6/plugins/dockers/historydocker/HistoryDock.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/dockers/historydocker/HistoryDock.cpp?ref=44f4e23c55896ad34ed1ca9e4943f2f00fbf12a6", "patch": "@@ -48,5 +48,3 @@ void HistoryDock::setCanvas(KoCanvasBase *canvas) {\n     m_undoView->setCanvas( myCanvas );\n \n }\n-\n-#include <HistoryDock.moc>"}]}, {"sha": "6a074d530f4595019e5ea486245ecf8d27321d65", "stats": {"total": 12, "additions": 12, "deletions": 0}, "files": [{"sha": "b1074d3745d63a116a97748e79cbc312b0ef7414", "filename": "plugins/tools/tool_transform2/kis_tool_transform_config_widget.cpp", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/KDE/krita/blob/6a074d530f4595019e5ea486245ecf8d27321d65/plugins/tools/tool_transform2/kis_tool_transform_config_widget.cpp", "raw_url": "https://github.com/KDE/krita/raw/6a074d530f4595019e5ea486245ecf8d27321d65/plugins/tools/tool_transform2/kis_tool_transform_config_widget.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_transform2/kis_tool_transform_config_widget.cpp?ref=6a074d530f4595019e5ea486245ecf8d27321d65", "patch": "@@ -300,6 +300,18 @@ void KisToolTransformConfigWidget::slotUpdateIcons()\n     liquifyOffset->setIcon(KisIconUtils::loadIcon(\"transform_icons_liquify_offset\"));\n     liquifyUndo->setIcon(KisIconUtils::loadIcon(\"transform_icons_liquify_erase\"));\n \n+\n+\n+    middleRightButton->setIcon(KisIconUtils::loadIcon(\"arrow-right\"));\n+    topRightButton->setIcon(KisIconUtils::loadIcon(\"arrow-topright\"));\n+    middleTopButton->setIcon(KisIconUtils::loadIcon(\"arrow-up\"));\n+    topLeftButton->setIcon(KisIconUtils::loadIcon(\"arrow-topleft\"));\n+    middleLeftButton->setIcon(KisIconUtils::loadIcon(\"arrow-left\"));\n+    bottomLeftButton->setIcon(KisIconUtils::loadIcon(\"arrow-downleft\"));\n+    middleBottomButton->setIcon(KisIconUtils::loadIcon(\"arrow-down\"));\n+    bottomRightButton->setIcon(KisIconUtils::loadIcon(\"arrow-downright\"));\n+\n+\n     // pressure icons\n     liquifySizePressureBox->setIcon(KisIconUtils::loadIcon(\"transform_icons_penPressure\"));\n     liquifyAmountPressureBox->setIcon(KisIconUtils::loadIcon(\"transform_icons_penPressure\"));"}]}, {"sha": "444d7317e45fd4fef6acfdd57042be83c456df54", "stats": {"total": 4, "additions": 1, "deletions": 3}, "files": [{"sha": "cacd3c0abd4382b080cff2f587d049ece0defe9c", "filename": "plugins/impex/xcf/3rdparty/xcftools/xcftools.h", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/444d7317e45fd4fef6acfdd57042be83c456df54/plugins/impex/xcf/3rdparty/xcftools/xcftools.h", "raw_url": "https://github.com/KDE/krita/raw/444d7317e45fd4fef6acfdd57042be83c456df54/plugins/impex/xcf/3rdparty/xcftools/xcftools.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/xcf/3rdparty/xcftools/xcftools.h?ref=444d7317e45fd4fef6acfdd57042be83c456df54", "patch": "@@ -55,9 +55,7 @@ typedef signed long int   int32_t ;\n # define __ATTRIBUTE__(x)\n #endif\n \n-#if HAVE_NETINET_IN_H\n-# include <netinet/in.h>\n-#elif HAVE_ARPA_INET_H\n+#if HAVE_ARPA_INET_H\n # include <arpa/inet.h>\n #elif WORDS_BIGENDIAN\n # define ntohl(x) (x)"}]}, {"sha": "1531c17cb7045ff2ce2fb4cb925f55af8e015465", "stats": {"total": 1736, "additions": 1736, "deletions": 0}, "files": [{"sha": "a89fa1ec5bf7e96c558293f0d607cb319d3816d1", "filename": "krita/pics/Breeze-dark/breeze-dark-icons.qrc", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-dark/breeze-dark-icons.qrc", "raw_url": "https://github.com/KDE/krita/raw/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-dark/breeze-dark-icons.qrc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/pics/Breeze-dark/breeze-dark-icons.qrc?ref=1531c17cb7045ff2ce2fb4cb925f55af8e015465", "patch": "@@ -5,6 +5,10 @@\n         <file>dark_application-pdf.svg</file>\n         <file>dark_applications-system.svg</file>\n         <file>dark_arrow-down.svg</file>\n+        <file>dark_arrow-downright.svg</file>\n+        <file>dark_arrow-downleft.svg</file>\n+        <file>dark_arrow-topright.svg</file>\n+        <file>dark_arrow-topleft.svg</file>\n         <file>dark_arrow-left.svg</file>\n         <file>dark_arrow-right.svg</file>\n         <file>dark_arrow-up.svg</file>"}, {"sha": "b58f57ed5bbf5cb52d4a0c919aa7811d64ed627a", "filename": "krita/pics/Breeze-dark/dark_arrow-downleft.svg", "status": "added", "additions": 216, "deletions": 0, "changes": 216, "blob_url": "https://github.com/KDE/krita/blob/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-dark/dark_arrow-downleft.svg", "raw_url": "https://github.com/KDE/krita/raw/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-dark/dark_arrow-downleft.svg", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/pics/Breeze-dark/dark_arrow-downleft.svg?ref=1531c17cb7045ff2ce2fb4cb925f55af8e015465", "patch": "@@ -0,0 +1,216 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<!-- Created with Inkscape (http://www.inkscape.org/) -->\n+\n+<svg\n+   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n+   xmlns:cc=\"http://creativecommons.org/ns#\"\n+   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\n+   xmlns:svg=\"http://www.w3.org/2000/svg\"\n+   xmlns=\"http://www.w3.org/2000/svg\"\n+   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\n+   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\n+   width=\"22\"\n+   height=\"22\"\n+   id=\"svg2\"\n+   version=\"1.1\"\n+   inkscape:version=\"0.91 r13725\"\n+   viewBox=\"0 0 21.999999 22\"\n+   sodipodi:docname=\"dark_arrow-down_left.svg\">\n+  <defs\n+     id=\"defs4\" />\n+  <sodipodi:namedview\n+     id=\"base\"\n+     pagecolor=\"#ffffff\"\n+     bordercolor=\"#666666\"\n+     borderopacity=\"1.0\"\n+     inkscape:pageopacity=\"0.0\"\n+     inkscape:pageshadow=\"2\"\n+     inkscape:zoom=\"32.000001\"\n+     inkscape:cx=\"9.2256508\"\n+     inkscape:cy=\"4.6208524\"\n+     inkscape:document-units=\"px\"\n+     inkscape:current-layer=\"layer1\"\n+     showgrid=\"true\"\n+     inkscape:window-width=\"1878\"\n+     inkscape:window-height=\"1051\"\n+     inkscape:window-x=\"0\"\n+     inkscape:window-y=\"0\"\n+     inkscape:window-maximized=\"1\"\n+     inkscape:showpageshadow=\"false\"\n+     borderlayer=\"true\"\n+     units=\"px\"\n+     width=\"24px\"\n+     showguides=\"true\">\n+    <inkscape:grid\n+       type=\"xygrid\"\n+       id=\"grid4081\" />\n+    <sodipodi:guide\n+       position=\"2,20.000017\"\n+       orientation=\"18,0\"\n+       id=\"guide4113\" />\n+    <sodipodi:guide\n+       position=\"2,2.0000174\"\n+       orientation=\"0,18\"\n+       id=\"guide4115\" />\n+    <sodipodi:guide\n+       position=\"20,2.0000174\"\n+       orientation=\"-18,0\"\n+       id=\"guide4117\" />\n+    <sodipodi:guide\n+       position=\"20,20.000017\"\n+       orientation=\"0,-18\"\n+       id=\"guide4119\" />\n+    <sodipodi:guide\n+       position=\"2,20.000017\"\n+       orientation=\"18,0\"\n+       id=\"guide4143\" />\n+    <sodipodi:guide\n+       position=\"2,2.0000174\"\n+       orientation=\"0,3.9999995\"\n+       id=\"guide4145\" />\n+    <sodipodi:guide\n+       position=\"5.9999995,20.000017\"\n+       orientation=\"0,-3.9999995\"\n+       id=\"guide4149\" />\n+    <sodipodi:guide\n+       position=\"15.999999,2.0000174\"\n+       orientation=\"0,4.0000019\"\n+       id=\"guide4153\" />\n+    <sodipodi:guide\n+       position=\"20,2.0000174\"\n+       orientation=\"-18,0\"\n+       id=\"guide4155\" />\n+    <sodipodi:guide\n+       position=\"20,20.000017\"\n+       orientation=\"0,-4.0000019\"\n+       id=\"guide4157\" />\n+    <sodipodi:guide\n+       position=\"3,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4278\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,16\"\n+       id=\"guide4280\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4282\" />\n+    <sodipodi:guide\n+       position=\"19,19.000017\"\n+       orientation=\"0,-16\"\n+       id=\"guide4284\" />\n+    <sodipodi:guide\n+       position=\"3,4.0000174\"\n+       orientation=\"1,0\"\n+       id=\"guide4290\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,16\"\n+       id=\"guide4292\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-1,0\"\n+       id=\"guide4294\" />\n+    <sodipodi:guide\n+       position=\"3,19.000262\"\n+       orientation=\"1,0\"\n+       id=\"guide4298\" />\n+    <sodipodi:guide\n+       position=\"19,18.000262\"\n+       orientation=\"-1,0\"\n+       id=\"guide4302\" />\n+    <sodipodi:guide\n+       position=\"19,19.000262\"\n+       orientation=\"0,-16\"\n+       id=\"guide4304\" />\n+    <sodipodi:guide\n+       position=\"3,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4132\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,4.0000005\"\n+       id=\"guide4134\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4136\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,19.000017\"\n+       orientation=\"0,-4.0000005\"\n+       id=\"guide4138\" />\n+    <sodipodi:guide\n+       position=\"15.000001,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4140\" />\n+    <sodipodi:guide\n+       position=\"15.000001,3.0000174\"\n+       orientation=\"0,4\"\n+       id=\"guide4142\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4144\" />\n+    <sodipodi:guide\n+       position=\"19,19.000017\"\n+       orientation=\"0,-4\"\n+       id=\"guide4146\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,11.000506\"\n+       orientation=\"8,0\"\n+       id=\"guide4158\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0005057\"\n+       orientation=\"0,8\"\n+       id=\"guide4160\" />\n+    <sodipodi:guide\n+       position=\"15.000001,3.0005057\"\n+       orientation=\"-8,0\"\n+       id=\"guide4162\" />\n+    <sodipodi:guide\n+       position=\"15.000001,11.000506\"\n+       orientation=\"0,-8\"\n+       id=\"guide4164\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,19.000017\"\n+       orientation=\"15.999512,0\"\n+       id=\"guide4168\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0005057\"\n+       orientation=\"0,0.99999952\"\n+       id=\"guide4170\" />\n+    <sodipodi:guide\n+       position=\"8,3.0005057\"\n+       orientation=\"-15.999512,0\"\n+       id=\"guide4172\" />\n+    <sodipodi:guide\n+       position=\"8,19.000017\"\n+       orientation=\"0,-0.99999952\"\n+       id=\"guide4174\" />\n+  </sodipodi:namedview>\n+  <metadata\n+     id=\"metadata7\">\n+    <rdf:RDF>\n+      <cc:Work\n+         rdf:about=\"\">\n+        <dc:format>image/svg+xml</dc:format>\n+        <dc:type\n+           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\n+        <dc:title></dc:title>\n+      </cc:Work>\n+    </rdf:RDF>\n+  </metadata>\n+  <g\n+     inkscape:label=\"Capa 1\"\n+     inkscape:groupmode=\"layer\"\n+     id=\"layer1\"\n+     transform=\"translate(0,-1030.3622)\">\n+    <path\n+       style=\"fill:#4d4d4d;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       d=\"m 17,1047.3622 0,-0.9964 -10.9999998,0 0,-11.0036 -1,0 0,12 z\"\n+       id=\"path4179\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccccc\" />\n+  </g>\n+</svg>"}, {"sha": "127576f6a04a1ac7f080a71bec88e710b6139809", "filename": "krita/pics/Breeze-dark/dark_arrow-downright.svg", "status": "added", "additions": 216, "deletions": 0, "changes": 216, "blob_url": "https://github.com/KDE/krita/blob/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-dark/dark_arrow-downright.svg", "raw_url": "https://github.com/KDE/krita/raw/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-dark/dark_arrow-downright.svg", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/pics/Breeze-dark/dark_arrow-downright.svg?ref=1531c17cb7045ff2ce2fb4cb925f55af8e015465", "patch": "@@ -0,0 +1,216 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<!-- Created with Inkscape (http://www.inkscape.org/) -->\n+\n+<svg\n+   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n+   xmlns:cc=\"http://creativecommons.org/ns#\"\n+   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\n+   xmlns:svg=\"http://www.w3.org/2000/svg\"\n+   xmlns=\"http://www.w3.org/2000/svg\"\n+   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\n+   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\n+   width=\"22\"\n+   height=\"22\"\n+   id=\"svg2\"\n+   version=\"1.1\"\n+   inkscape:version=\"0.91 r13725\"\n+   viewBox=\"0 0 21.999999 22\"\n+   sodipodi:docname=\"dark_arrow-botton_right.svg\">\n+  <defs\n+     id=\"defs4\" />\n+  <sodipodi:namedview\n+     id=\"base\"\n+     pagecolor=\"#ffffff\"\n+     bordercolor=\"#666666\"\n+     borderopacity=\"1.0\"\n+     inkscape:pageopacity=\"0.0\"\n+     inkscape:pageshadow=\"2\"\n+     inkscape:zoom=\"32.000001\"\n+     inkscape:cx=\"9.2256508\"\n+     inkscape:cy=\"4.6208524\"\n+     inkscape:document-units=\"px\"\n+     inkscape:current-layer=\"layer1\"\n+     showgrid=\"true\"\n+     inkscape:window-width=\"1878\"\n+     inkscape:window-height=\"1051\"\n+     inkscape:window-x=\"0\"\n+     inkscape:window-y=\"0\"\n+     inkscape:window-maximized=\"1\"\n+     inkscape:showpageshadow=\"false\"\n+     borderlayer=\"true\"\n+     units=\"px\"\n+     width=\"24px\"\n+     showguides=\"true\">\n+    <inkscape:grid\n+       type=\"xygrid\"\n+       id=\"grid4081\" />\n+    <sodipodi:guide\n+       position=\"2,20.000017\"\n+       orientation=\"18,0\"\n+       id=\"guide4113\" />\n+    <sodipodi:guide\n+       position=\"2,2.0000174\"\n+       orientation=\"0,18\"\n+       id=\"guide4115\" />\n+    <sodipodi:guide\n+       position=\"20,2.0000174\"\n+       orientation=\"-18,0\"\n+       id=\"guide4117\" />\n+    <sodipodi:guide\n+       position=\"20,20.000017\"\n+       orientation=\"0,-18\"\n+       id=\"guide4119\" />\n+    <sodipodi:guide\n+       position=\"2,20.000017\"\n+       orientation=\"18,0\"\n+       id=\"guide4143\" />\n+    <sodipodi:guide\n+       position=\"2,2.0000174\"\n+       orientation=\"0,3.9999995\"\n+       id=\"guide4145\" />\n+    <sodipodi:guide\n+       position=\"5.9999995,20.000017\"\n+       orientation=\"0,-3.9999995\"\n+       id=\"guide4149\" />\n+    <sodipodi:guide\n+       position=\"15.999999,2.0000174\"\n+       orientation=\"0,4.0000019\"\n+       id=\"guide4153\" />\n+    <sodipodi:guide\n+       position=\"20,2.0000174\"\n+       orientation=\"-18,0\"\n+       id=\"guide4155\" />\n+    <sodipodi:guide\n+       position=\"20,20.000017\"\n+       orientation=\"0,-4.0000019\"\n+       id=\"guide4157\" />\n+    <sodipodi:guide\n+       position=\"3,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4278\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,16\"\n+       id=\"guide4280\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4282\" />\n+    <sodipodi:guide\n+       position=\"19,19.000017\"\n+       orientation=\"0,-16\"\n+       id=\"guide4284\" />\n+    <sodipodi:guide\n+       position=\"3,4.0000174\"\n+       orientation=\"1,0\"\n+       id=\"guide4290\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,16\"\n+       id=\"guide4292\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-1,0\"\n+       id=\"guide4294\" />\n+    <sodipodi:guide\n+       position=\"3,19.000262\"\n+       orientation=\"1,0\"\n+       id=\"guide4298\" />\n+    <sodipodi:guide\n+       position=\"19,18.000262\"\n+       orientation=\"-1,0\"\n+       id=\"guide4302\" />\n+    <sodipodi:guide\n+       position=\"19,19.000262\"\n+       orientation=\"0,-16\"\n+       id=\"guide4304\" />\n+    <sodipodi:guide\n+       position=\"3,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4132\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,4.0000005\"\n+       id=\"guide4134\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4136\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,19.000017\"\n+       orientation=\"0,-4.0000005\"\n+       id=\"guide4138\" />\n+    <sodipodi:guide\n+       position=\"15.000001,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4140\" />\n+    <sodipodi:guide\n+       position=\"15.000001,3.0000174\"\n+       orientation=\"0,4\"\n+       id=\"guide4142\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4144\" />\n+    <sodipodi:guide\n+       position=\"19,19.000017\"\n+       orientation=\"0,-4\"\n+       id=\"guide4146\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,11.000506\"\n+       orientation=\"8,0\"\n+       id=\"guide4158\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0005057\"\n+       orientation=\"0,8\"\n+       id=\"guide4160\" />\n+    <sodipodi:guide\n+       position=\"15.000001,3.0005057\"\n+       orientation=\"-8,0\"\n+       id=\"guide4162\" />\n+    <sodipodi:guide\n+       position=\"15.000001,11.000506\"\n+       orientation=\"0,-8\"\n+       id=\"guide4164\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,19.000017\"\n+       orientation=\"15.999512,0\"\n+       id=\"guide4168\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0005057\"\n+       orientation=\"0,0.99999952\"\n+       id=\"guide4170\" />\n+    <sodipodi:guide\n+       position=\"8,3.0005057\"\n+       orientation=\"-15.999512,0\"\n+       id=\"guide4172\" />\n+    <sodipodi:guide\n+       position=\"8,19.000017\"\n+       orientation=\"0,-0.99999952\"\n+       id=\"guide4174\" />\n+  </sodipodi:namedview>\n+  <metadata\n+     id=\"metadata7\">\n+    <rdf:RDF>\n+      <cc:Work\n+         rdf:about=\"\">\n+        <dc:format>image/svg+xml</dc:format>\n+        <dc:type\n+           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\n+        <dc:title></dc:title>\n+      </cc:Work>\n+    </rdf:RDF>\n+  </metadata>\n+  <g\n+     inkscape:label=\"Capa 1\"\n+     inkscape:groupmode=\"layer\"\n+     id=\"layer1\"\n+     transform=\"translate(0,-1030.3622)\">\n+    <path\n+       style=\"fill:#4d4d4d;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       d=\"m 17,1035.3622 -0.9964,0 0,11 -11.0035997,0 0,1 11.9999997,0 z\"\n+       id=\"path4179\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccccc\" />\n+  </g>\n+</svg>"}, {"sha": "baa7b19686453c546210976c421ad7a5779ab518", "filename": "krita/pics/Breeze-dark/dark_arrow-topleft.svg", "status": "added", "additions": 216, "deletions": 0, "changes": 216, "blob_url": "https://github.com/KDE/krita/blob/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-dark/dark_arrow-topleft.svg", "raw_url": "https://github.com/KDE/krita/raw/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-dark/dark_arrow-topleft.svg", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/pics/Breeze-dark/dark_arrow-topleft.svg?ref=1531c17cb7045ff2ce2fb4cb925f55af8e015465", "patch": "@@ -0,0 +1,216 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<!-- Created with Inkscape (http://www.inkscape.org/) -->\n+\n+<svg\n+   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n+   xmlns:cc=\"http://creativecommons.org/ns#\"\n+   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\n+   xmlns:svg=\"http://www.w3.org/2000/svg\"\n+   xmlns=\"http://www.w3.org/2000/svg\"\n+   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\n+   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\n+   width=\"22\"\n+   height=\"22\"\n+   id=\"svg2\"\n+   version=\"1.1\"\n+   inkscape:version=\"0.91 r13725\"\n+   viewBox=\"0 0 21.999999 22\"\n+   sodipodi:docname=\"dark_arrow-top_left.svg\">\n+  <defs\n+     id=\"defs4\" />\n+  <sodipodi:namedview\n+     id=\"base\"\n+     pagecolor=\"#ffffff\"\n+     bordercolor=\"#666666\"\n+     borderopacity=\"1.0\"\n+     inkscape:pageopacity=\"0.0\"\n+     inkscape:pageshadow=\"2\"\n+     inkscape:zoom=\"32.000001\"\n+     inkscape:cx=\"9.2256508\"\n+     inkscape:cy=\"4.6208524\"\n+     inkscape:document-units=\"px\"\n+     inkscape:current-layer=\"layer1\"\n+     showgrid=\"true\"\n+     inkscape:window-width=\"1878\"\n+     inkscape:window-height=\"1051\"\n+     inkscape:window-x=\"0\"\n+     inkscape:window-y=\"0\"\n+     inkscape:window-maximized=\"1\"\n+     inkscape:showpageshadow=\"false\"\n+     borderlayer=\"true\"\n+     units=\"px\"\n+     width=\"24px\"\n+     showguides=\"true\">\n+    <inkscape:grid\n+       type=\"xygrid\"\n+       id=\"grid4081\" />\n+    <sodipodi:guide\n+       position=\"2,20.000017\"\n+       orientation=\"18,0\"\n+       id=\"guide4113\" />\n+    <sodipodi:guide\n+       position=\"2,2.0000174\"\n+       orientation=\"0,18\"\n+       id=\"guide4115\" />\n+    <sodipodi:guide\n+       position=\"20,2.0000174\"\n+       orientation=\"-18,0\"\n+       id=\"guide4117\" />\n+    <sodipodi:guide\n+       position=\"20,20.000017\"\n+       orientation=\"0,-18\"\n+       id=\"guide4119\" />\n+    <sodipodi:guide\n+       position=\"2,20.000017\"\n+       orientation=\"18,0\"\n+       id=\"guide4143\" />\n+    <sodipodi:guide\n+       position=\"2,2.0000174\"\n+       orientation=\"0,3.9999995\"\n+       id=\"guide4145\" />\n+    <sodipodi:guide\n+       position=\"5.9999995,20.000017\"\n+       orientation=\"0,-3.9999995\"\n+       id=\"guide4149\" />\n+    <sodipodi:guide\n+       position=\"15.999999,2.0000174\"\n+       orientation=\"0,4.0000019\"\n+       id=\"guide4153\" />\n+    <sodipodi:guide\n+       position=\"20,2.0000174\"\n+       orientation=\"-18,0\"\n+       id=\"guide4155\" />\n+    <sodipodi:guide\n+       position=\"20,20.000017\"\n+       orientation=\"0,-4.0000019\"\n+       id=\"guide4157\" />\n+    <sodipodi:guide\n+       position=\"3,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4278\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,16\"\n+       id=\"guide4280\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4282\" />\n+    <sodipodi:guide\n+       position=\"19,19.000017\"\n+       orientation=\"0,-16\"\n+       id=\"guide4284\" />\n+    <sodipodi:guide\n+       position=\"3,4.0000174\"\n+       orientation=\"1,0\"\n+       id=\"guide4290\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,16\"\n+       id=\"guide4292\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-1,0\"\n+       id=\"guide4294\" />\n+    <sodipodi:guide\n+       position=\"3,19.000262\"\n+       orientation=\"1,0\"\n+       id=\"guide4298\" />\n+    <sodipodi:guide\n+       position=\"19,18.000262\"\n+       orientation=\"-1,0\"\n+       id=\"guide4302\" />\n+    <sodipodi:guide\n+       position=\"19,19.000262\"\n+       orientation=\"0,-16\"\n+       id=\"guide4304\" />\n+    <sodipodi:guide\n+       position=\"3,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4132\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,4.0000005\"\n+       id=\"guide4134\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4136\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,19.000017\"\n+       orientation=\"0,-4.0000005\"\n+       id=\"guide4138\" />\n+    <sodipodi:guide\n+       position=\"15.000001,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4140\" />\n+    <sodipodi:guide\n+       position=\"15.000001,3.0000174\"\n+       orientation=\"0,4\"\n+       id=\"guide4142\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4144\" />\n+    <sodipodi:guide\n+       position=\"19,19.000017\"\n+       orientation=\"0,-4\"\n+       id=\"guide4146\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,11.000506\"\n+       orientation=\"8,0\"\n+       id=\"guide4158\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0005057\"\n+       orientation=\"0,8\"\n+       id=\"guide4160\" />\n+    <sodipodi:guide\n+       position=\"15.000001,3.0005057\"\n+       orientation=\"-8,0\"\n+       id=\"guide4162\" />\n+    <sodipodi:guide\n+       position=\"15.000001,11.000506\"\n+       orientation=\"0,-8\"\n+       id=\"guide4164\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,19.000017\"\n+       orientation=\"15.999512,0\"\n+       id=\"guide4168\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0005057\"\n+       orientation=\"0,0.99999952\"\n+       id=\"guide4170\" />\n+    <sodipodi:guide\n+       position=\"8,3.0005057\"\n+       orientation=\"-15.999512,0\"\n+       id=\"guide4172\" />\n+    <sodipodi:guide\n+       position=\"8,19.000017\"\n+       orientation=\"0,-0.99999952\"\n+       id=\"guide4174\" />\n+  </sodipodi:namedview>\n+  <metadata\n+     id=\"metadata7\">\n+    <rdf:RDF>\n+      <cc:Work\n+         rdf:about=\"\">\n+        <dc:format>image/svg+xml</dc:format>\n+        <dc:type\n+           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\n+        <dc:title />\n+      </cc:Work>\n+    </rdf:RDF>\n+  </metadata>\n+  <g\n+     inkscape:label=\"Capa 1\"\n+     inkscape:groupmode=\"layer\"\n+     id=\"layer1\"\n+     transform=\"translate(0,-1030.3622)\">\n+    <path\n+       style=\"fill:#4d4d4d;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       d=\"m 4.999999,1047.3622 0.9964361,0 0,-11 11.0035639,0 3e-6,-1 -11.9999985,0 z\"\n+       id=\"path4179\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccccc\" />\n+  </g>\n+</svg>"}, {"sha": "fd99084cb81bfe4886d81dc903cc6c7f927a7023", "filename": "krita/pics/Breeze-dark/dark_arrow-topright.svg", "status": "added", "additions": 216, "deletions": 0, "changes": 216, "blob_url": "https://github.com/KDE/krita/blob/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-dark/dark_arrow-topright.svg", "raw_url": "https://github.com/KDE/krita/raw/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-dark/dark_arrow-topright.svg", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/pics/Breeze-dark/dark_arrow-topright.svg?ref=1531c17cb7045ff2ce2fb4cb925f55af8e015465", "patch": "@@ -0,0 +1,216 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<!-- Created with Inkscape (http://www.inkscape.org/) -->\n+\n+<svg\n+   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n+   xmlns:cc=\"http://creativecommons.org/ns#\"\n+   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\n+   xmlns:svg=\"http://www.w3.org/2000/svg\"\n+   xmlns=\"http://www.w3.org/2000/svg\"\n+   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\n+   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\n+   width=\"22\"\n+   height=\"22\"\n+   id=\"svg2\"\n+   version=\"1.1\"\n+   inkscape:version=\"0.91 r13725\"\n+   viewBox=\"0 0 21.999999 22\"\n+   sodipodi:docname=\"dark_arrow-top_right.svg\">\n+  <defs\n+     id=\"defs4\" />\n+  <sodipodi:namedview\n+     id=\"base\"\n+     pagecolor=\"#ffffff\"\n+     bordercolor=\"#666666\"\n+     borderopacity=\"1.0\"\n+     inkscape:pageopacity=\"0.0\"\n+     inkscape:pageshadow=\"2\"\n+     inkscape:zoom=\"32.000001\"\n+     inkscape:cx=\"9.2256508\"\n+     inkscape:cy=\"4.6208524\"\n+     inkscape:document-units=\"px\"\n+     inkscape:current-layer=\"layer1\"\n+     showgrid=\"true\"\n+     inkscape:window-width=\"1878\"\n+     inkscape:window-height=\"1051\"\n+     inkscape:window-x=\"0\"\n+     inkscape:window-y=\"0\"\n+     inkscape:window-maximized=\"1\"\n+     inkscape:showpageshadow=\"false\"\n+     borderlayer=\"true\"\n+     units=\"px\"\n+     width=\"24px\"\n+     showguides=\"true\">\n+    <inkscape:grid\n+       type=\"xygrid\"\n+       id=\"grid4081\" />\n+    <sodipodi:guide\n+       position=\"2,20.000017\"\n+       orientation=\"18,0\"\n+       id=\"guide4113\" />\n+    <sodipodi:guide\n+       position=\"2,2.0000174\"\n+       orientation=\"0,18\"\n+       id=\"guide4115\" />\n+    <sodipodi:guide\n+       position=\"20,2.0000174\"\n+       orientation=\"-18,0\"\n+       id=\"guide4117\" />\n+    <sodipodi:guide\n+       position=\"20,20.000017\"\n+       orientation=\"0,-18\"\n+       id=\"guide4119\" />\n+    <sodipodi:guide\n+       position=\"2,20.000017\"\n+       orientation=\"18,0\"\n+       id=\"guide4143\" />\n+    <sodipodi:guide\n+       position=\"2,2.0000174\"\n+       orientation=\"0,3.9999995\"\n+       id=\"guide4145\" />\n+    <sodipodi:guide\n+       position=\"5.9999995,20.000017\"\n+       orientation=\"0,-3.9999995\"\n+       id=\"guide4149\" />\n+    <sodipodi:guide\n+       position=\"15.999999,2.0000174\"\n+       orientation=\"0,4.0000019\"\n+       id=\"guide4153\" />\n+    <sodipodi:guide\n+       position=\"20,2.0000174\"\n+       orientation=\"-18,0\"\n+       id=\"guide4155\" />\n+    <sodipodi:guide\n+       position=\"20,20.000017\"\n+       orientation=\"0,-4.0000019\"\n+       id=\"guide4157\" />\n+    <sodipodi:guide\n+       position=\"3,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4278\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,16\"\n+       id=\"guide4280\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4282\" />\n+    <sodipodi:guide\n+       position=\"19,19.000017\"\n+       orientation=\"0,-16\"\n+       id=\"guide4284\" />\n+    <sodipodi:guide\n+       position=\"3,4.0000174\"\n+       orientation=\"1,0\"\n+       id=\"guide4290\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,16\"\n+       id=\"guide4292\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-1,0\"\n+       id=\"guide4294\" />\n+    <sodipodi:guide\n+       position=\"3,19.000262\"\n+       orientation=\"1,0\"\n+       id=\"guide4298\" />\n+    <sodipodi:guide\n+       position=\"19,18.000262\"\n+       orientation=\"-1,0\"\n+       id=\"guide4302\" />\n+    <sodipodi:guide\n+       position=\"19,19.000262\"\n+       orientation=\"0,-16\"\n+       id=\"guide4304\" />\n+    <sodipodi:guide\n+       position=\"3,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4132\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,4.0000005\"\n+       id=\"guide4134\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4136\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,19.000017\"\n+       orientation=\"0,-4.0000005\"\n+       id=\"guide4138\" />\n+    <sodipodi:guide\n+       position=\"15.000001,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4140\" />\n+    <sodipodi:guide\n+       position=\"15.000001,3.0000174\"\n+       orientation=\"0,4\"\n+       id=\"guide4142\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4144\" />\n+    <sodipodi:guide\n+       position=\"19,19.000017\"\n+       orientation=\"0,-4\"\n+       id=\"guide4146\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,11.000506\"\n+       orientation=\"8,0\"\n+       id=\"guide4158\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0005057\"\n+       orientation=\"0,8\"\n+       id=\"guide4160\" />\n+    <sodipodi:guide\n+       position=\"15.000001,3.0005057\"\n+       orientation=\"-8,0\"\n+       id=\"guide4162\" />\n+    <sodipodi:guide\n+       position=\"15.000001,11.000506\"\n+       orientation=\"0,-8\"\n+       id=\"guide4164\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,19.000017\"\n+       orientation=\"15.999512,0\"\n+       id=\"guide4168\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0005057\"\n+       orientation=\"0,0.99999952\"\n+       id=\"guide4170\" />\n+    <sodipodi:guide\n+       position=\"8,3.0005057\"\n+       orientation=\"-15.999512,0\"\n+       id=\"guide4172\" />\n+    <sodipodi:guide\n+       position=\"8,19.000017\"\n+       orientation=\"0,-0.99999952\"\n+       id=\"guide4174\" />\n+  </sodipodi:namedview>\n+  <metadata\n+     id=\"metadata7\">\n+    <rdf:RDF>\n+      <cc:Work\n+         rdf:about=\"\">\n+        <dc:format>image/svg+xml</dc:format>\n+        <dc:type\n+           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\n+        <dc:title></dc:title>\n+      </cc:Work>\n+    </rdf:RDF>\n+  </metadata>\n+  <g\n+     inkscape:label=\"Capa 1\"\n+     inkscape:groupmode=\"layer\"\n+     id=\"layer1\"\n+     transform=\"translate(0,-1030.3622)\">\n+    <path\n+       style=\"fill:#4d4d4d;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       d=\"m 5.0000005,1035.3622 0,0.9964 10.9999995,0 0,11.0036 1,0 0,-12 z\"\n+       id=\"path4179\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccccc\" />\n+  </g>\n+</svg>"}, {"sha": "8a3bf04bd9390e93a908895a84dae0915cf15593", "filename": "krita/pics/Breeze-light/breeze-light-icons.qrc", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-light/breeze-light-icons.qrc", "raw_url": "https://github.com/KDE/krita/raw/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-light/breeze-light-icons.qrc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/pics/Breeze-light/breeze-light-icons.qrc?ref=1531c17cb7045ff2ce2fb4cb925f55af8e015465", "patch": "@@ -5,6 +5,10 @@\n         <file>light_application-pdf.svg</file>\n         <file>light_applications-system.svg</file>\n         <file>light_arrow-down.svg</file>\n+        <file>light_arrow-downright.svg</file>\n+        <file>light_arrow-downleft.svg</file>\n+        <file>light_arrow-topright.svg</file>\n+        <file>light_arrow-topleft.svg</file>\n         <file>light_arrow-left.svg</file>\n         <file>light_arrow-right.svg</file>\n         <file>light_arrow-up.svg</file>"}, {"sha": "615b0695b73af020a43b86e0f0957755a1f68b03", "filename": "krita/pics/Breeze-light/light_arrow-downleft.svg", "status": "added", "additions": 216, "deletions": 0, "changes": 216, "blob_url": "https://github.com/KDE/krita/blob/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-light/light_arrow-downleft.svg", "raw_url": "https://github.com/KDE/krita/raw/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-light/light_arrow-downleft.svg", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/pics/Breeze-light/light_arrow-downleft.svg?ref=1531c17cb7045ff2ce2fb4cb925f55af8e015465", "patch": "@@ -0,0 +1,216 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<!-- Created with Inkscape (http://www.inkscape.org/) -->\n+\n+<svg\n+   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n+   xmlns:cc=\"http://creativecommons.org/ns#\"\n+   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\n+   xmlns:svg=\"http://www.w3.org/2000/svg\"\n+   xmlns=\"http://www.w3.org/2000/svg\"\n+   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\n+   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\n+   width=\"22\"\n+   height=\"22\"\n+   id=\"svg2\"\n+   version=\"1.1\"\n+   inkscape:version=\"0.91 r13725\"\n+   viewBox=\"0 0 21.999999 22\"\n+   sodipodi:docname=\"light_arrow-down-left.svg\">\n+  <defs\n+     id=\"defs4\" />\n+  <sodipodi:namedview\n+     id=\"base\"\n+     pagecolor=\"#ffffff\"\n+     bordercolor=\"#666666\"\n+     borderopacity=\"1.0\"\n+     inkscape:pageopacity=\"0.0\"\n+     inkscape:pageshadow=\"2\"\n+     inkscape:zoom=\"32.000001\"\n+     inkscape:cx=\"9.2256508\"\n+     inkscape:cy=\"4.6208524\"\n+     inkscape:document-units=\"px\"\n+     inkscape:current-layer=\"layer1\"\n+     showgrid=\"true\"\n+     inkscape:window-width=\"1878\"\n+     inkscape:window-height=\"1051\"\n+     inkscape:window-x=\"0\"\n+     inkscape:window-y=\"0\"\n+     inkscape:window-maximized=\"1\"\n+     inkscape:showpageshadow=\"false\"\n+     borderlayer=\"true\"\n+     units=\"px\"\n+     width=\"24px\"\n+     showguides=\"true\">\n+    <inkscape:grid\n+       type=\"xygrid\"\n+       id=\"grid4081\" />\n+    <sodipodi:guide\n+       position=\"2,20.000017\"\n+       orientation=\"18,0\"\n+       id=\"guide4113\" />\n+    <sodipodi:guide\n+       position=\"2,2.0000174\"\n+       orientation=\"0,18\"\n+       id=\"guide4115\" />\n+    <sodipodi:guide\n+       position=\"20,2.0000174\"\n+       orientation=\"-18,0\"\n+       id=\"guide4117\" />\n+    <sodipodi:guide\n+       position=\"20,20.000017\"\n+       orientation=\"0,-18\"\n+       id=\"guide4119\" />\n+    <sodipodi:guide\n+       position=\"2,20.000017\"\n+       orientation=\"18,0\"\n+       id=\"guide4143\" />\n+    <sodipodi:guide\n+       position=\"2,2.0000174\"\n+       orientation=\"0,3.9999995\"\n+       id=\"guide4145\" />\n+    <sodipodi:guide\n+       position=\"5.9999995,20.000017\"\n+       orientation=\"0,-3.9999995\"\n+       id=\"guide4149\" />\n+    <sodipodi:guide\n+       position=\"15.999999,2.0000174\"\n+       orientation=\"0,4.0000019\"\n+       id=\"guide4153\" />\n+    <sodipodi:guide\n+       position=\"20,2.0000174\"\n+       orientation=\"-18,0\"\n+       id=\"guide4155\" />\n+    <sodipodi:guide\n+       position=\"20,20.000017\"\n+       orientation=\"0,-4.0000019\"\n+       id=\"guide4157\" />\n+    <sodipodi:guide\n+       position=\"3,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4278\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,16\"\n+       id=\"guide4280\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4282\" />\n+    <sodipodi:guide\n+       position=\"19,19.000017\"\n+       orientation=\"0,-16\"\n+       id=\"guide4284\" />\n+    <sodipodi:guide\n+       position=\"3,4.0000174\"\n+       orientation=\"1,0\"\n+       id=\"guide4290\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,16\"\n+       id=\"guide4292\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-1,0\"\n+       id=\"guide4294\" />\n+    <sodipodi:guide\n+       position=\"3,19.000262\"\n+       orientation=\"1,0\"\n+       id=\"guide4298\" />\n+    <sodipodi:guide\n+       position=\"19,18.000262\"\n+       orientation=\"-1,0\"\n+       id=\"guide4302\" />\n+    <sodipodi:guide\n+       position=\"19,19.000262\"\n+       orientation=\"0,-16\"\n+       id=\"guide4304\" />\n+    <sodipodi:guide\n+       position=\"3,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4132\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,4.0000005\"\n+       id=\"guide4134\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4136\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,19.000017\"\n+       orientation=\"0,-4.0000005\"\n+       id=\"guide4138\" />\n+    <sodipodi:guide\n+       position=\"15.000001,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4140\" />\n+    <sodipodi:guide\n+       position=\"15.000001,3.0000174\"\n+       orientation=\"0,4\"\n+       id=\"guide4142\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4144\" />\n+    <sodipodi:guide\n+       position=\"19,19.000017\"\n+       orientation=\"0,-4\"\n+       id=\"guide4146\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,11.000506\"\n+       orientation=\"8,0\"\n+       id=\"guide4158\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0005057\"\n+       orientation=\"0,8\"\n+       id=\"guide4160\" />\n+    <sodipodi:guide\n+       position=\"15.000001,3.0005057\"\n+       orientation=\"-8,0\"\n+       id=\"guide4162\" />\n+    <sodipodi:guide\n+       position=\"15.000001,11.000506\"\n+       orientation=\"0,-8\"\n+       id=\"guide4164\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,19.000017\"\n+       orientation=\"15.999512,0\"\n+       id=\"guide4168\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0005057\"\n+       orientation=\"0,0.99999952\"\n+       id=\"guide4170\" />\n+    <sodipodi:guide\n+       position=\"8,3.0005057\"\n+       orientation=\"-15.999512,0\"\n+       id=\"guide4172\" />\n+    <sodipodi:guide\n+       position=\"8,19.000017\"\n+       orientation=\"0,-0.99999952\"\n+       id=\"guide4174\" />\n+  </sodipodi:namedview>\n+  <metadata\n+     id=\"metadata7\">\n+    <rdf:RDF>\n+      <cc:Work\n+         rdf:about=\"\">\n+        <dc:format>image/svg+xml</dc:format>\n+        <dc:type\n+           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\n+        <dc:title></dc:title>\n+      </cc:Work>\n+    </rdf:RDF>\n+  </metadata>\n+  <g\n+     inkscape:label=\"Capa 1\"\n+     inkscape:groupmode=\"layer\"\n+     id=\"layer1\"\n+     transform=\"translate(0,-1030.3622)\">\n+    <path\n+       style=\"fill:#f2f2f2;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       d=\"m 17,1047.3622 0,-0.9964 -10.9999998,0 0,-11.0036 -1,0 0,12 z\"\n+       id=\"path4179\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccccc\" />\n+  </g>\n+</svg>"}, {"sha": "43223c26a9ace9dc337a234559f79e69358308b3", "filename": "krita/pics/Breeze-light/light_arrow-downright.svg", "status": "added", "additions": 216, "deletions": 0, "changes": 216, "blob_url": "https://github.com/KDE/krita/blob/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-light/light_arrow-downright.svg", "raw_url": "https://github.com/KDE/krita/raw/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-light/light_arrow-downright.svg", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/pics/Breeze-light/light_arrow-downright.svg?ref=1531c17cb7045ff2ce2fb4cb925f55af8e015465", "patch": "@@ -0,0 +1,216 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<!-- Created with Inkscape (http://www.inkscape.org/) -->\n+\n+<svg\n+   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n+   xmlns:cc=\"http://creativecommons.org/ns#\"\n+   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\n+   xmlns:svg=\"http://www.w3.org/2000/svg\"\n+   xmlns=\"http://www.w3.org/2000/svg\"\n+   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\n+   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\n+   width=\"22\"\n+   height=\"22\"\n+   id=\"svg2\"\n+   version=\"1.1\"\n+   inkscape:version=\"0.91 r13725\"\n+   viewBox=\"0 0 21.999999 22\"\n+   sodipodi:docname=\"light_arrow-down-right.svg\">\n+  <defs\n+     id=\"defs4\" />\n+  <sodipodi:namedview\n+     id=\"base\"\n+     pagecolor=\"#ffffff\"\n+     bordercolor=\"#666666\"\n+     borderopacity=\"1.0\"\n+     inkscape:pageopacity=\"0.0\"\n+     inkscape:pageshadow=\"2\"\n+     inkscape:zoom=\"32.000001\"\n+     inkscape:cx=\"9.2256508\"\n+     inkscape:cy=\"4.6208524\"\n+     inkscape:document-units=\"px\"\n+     inkscape:current-layer=\"layer1\"\n+     showgrid=\"true\"\n+     inkscape:window-width=\"1878\"\n+     inkscape:window-height=\"1051\"\n+     inkscape:window-x=\"0\"\n+     inkscape:window-y=\"0\"\n+     inkscape:window-maximized=\"1\"\n+     inkscape:showpageshadow=\"false\"\n+     borderlayer=\"true\"\n+     units=\"px\"\n+     width=\"24px\"\n+     showguides=\"true\">\n+    <inkscape:grid\n+       type=\"xygrid\"\n+       id=\"grid4081\" />\n+    <sodipodi:guide\n+       position=\"2,20.000017\"\n+       orientation=\"18,0\"\n+       id=\"guide4113\" />\n+    <sodipodi:guide\n+       position=\"2,2.0000174\"\n+       orientation=\"0,18\"\n+       id=\"guide4115\" />\n+    <sodipodi:guide\n+       position=\"20,2.0000174\"\n+       orientation=\"-18,0\"\n+       id=\"guide4117\" />\n+    <sodipodi:guide\n+       position=\"20,20.000017\"\n+       orientation=\"0,-18\"\n+       id=\"guide4119\" />\n+    <sodipodi:guide\n+       position=\"2,20.000017\"\n+       orientation=\"18,0\"\n+       id=\"guide4143\" />\n+    <sodipodi:guide\n+       position=\"2,2.0000174\"\n+       orientation=\"0,3.9999995\"\n+       id=\"guide4145\" />\n+    <sodipodi:guide\n+       position=\"5.9999995,20.000017\"\n+       orientation=\"0,-3.9999995\"\n+       id=\"guide4149\" />\n+    <sodipodi:guide\n+       position=\"15.999999,2.0000174\"\n+       orientation=\"0,4.0000019\"\n+       id=\"guide4153\" />\n+    <sodipodi:guide\n+       position=\"20,2.0000174\"\n+       orientation=\"-18,0\"\n+       id=\"guide4155\" />\n+    <sodipodi:guide\n+       position=\"20,20.000017\"\n+       orientation=\"0,-4.0000019\"\n+       id=\"guide4157\" />\n+    <sodipodi:guide\n+       position=\"3,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4278\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,16\"\n+       id=\"guide4280\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4282\" />\n+    <sodipodi:guide\n+       position=\"19,19.000017\"\n+       orientation=\"0,-16\"\n+       id=\"guide4284\" />\n+    <sodipodi:guide\n+       position=\"3,4.0000174\"\n+       orientation=\"1,0\"\n+       id=\"guide4290\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,16\"\n+       id=\"guide4292\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-1,0\"\n+       id=\"guide4294\" />\n+    <sodipodi:guide\n+       position=\"3,19.000262\"\n+       orientation=\"1,0\"\n+       id=\"guide4298\" />\n+    <sodipodi:guide\n+       position=\"19,18.000262\"\n+       orientation=\"-1,0\"\n+       id=\"guide4302\" />\n+    <sodipodi:guide\n+       position=\"19,19.000262\"\n+       orientation=\"0,-16\"\n+       id=\"guide4304\" />\n+    <sodipodi:guide\n+       position=\"3,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4132\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,4.0000005\"\n+       id=\"guide4134\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4136\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,19.000017\"\n+       orientation=\"0,-4.0000005\"\n+       id=\"guide4138\" />\n+    <sodipodi:guide\n+       position=\"15.000001,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4140\" />\n+    <sodipodi:guide\n+       position=\"15.000001,3.0000174\"\n+       orientation=\"0,4\"\n+       id=\"guide4142\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4144\" />\n+    <sodipodi:guide\n+       position=\"19,19.000017\"\n+       orientation=\"0,-4\"\n+       id=\"guide4146\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,11.000506\"\n+       orientation=\"8,0\"\n+       id=\"guide4158\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0005057\"\n+       orientation=\"0,8\"\n+       id=\"guide4160\" />\n+    <sodipodi:guide\n+       position=\"15.000001,3.0005057\"\n+       orientation=\"-8,0\"\n+       id=\"guide4162\" />\n+    <sodipodi:guide\n+       position=\"15.000001,11.000506\"\n+       orientation=\"0,-8\"\n+       id=\"guide4164\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,19.000017\"\n+       orientation=\"15.999512,0\"\n+       id=\"guide4168\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0005057\"\n+       orientation=\"0,0.99999952\"\n+       id=\"guide4170\" />\n+    <sodipodi:guide\n+       position=\"8,3.0005057\"\n+       orientation=\"-15.999512,0\"\n+       id=\"guide4172\" />\n+    <sodipodi:guide\n+       position=\"8,19.000017\"\n+       orientation=\"0,-0.99999952\"\n+       id=\"guide4174\" />\n+  </sodipodi:namedview>\n+  <metadata\n+     id=\"metadata7\">\n+    <rdf:RDF>\n+      <cc:Work\n+         rdf:about=\"\">\n+        <dc:format>image/svg+xml</dc:format>\n+        <dc:type\n+           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\n+        <dc:title></dc:title>\n+      </cc:Work>\n+    </rdf:RDF>\n+  </metadata>\n+  <g\n+     inkscape:label=\"Capa 1\"\n+     inkscape:groupmode=\"layer\"\n+     id=\"layer1\"\n+     transform=\"translate(0,-1030.3622)\">\n+    <path\n+       style=\"fill:#f2f2f2;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       d=\"m 17,1035.3622 -0.9964,0 0,11 -11.0036,0 0,1 12,0 z\"\n+       id=\"path4179\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccccc\" />\n+  </g>\n+</svg>"}, {"sha": "e430fbeeebb91b81bd2caa5651e3cae34bf7e073", "filename": "krita/pics/Breeze-light/light_arrow-topleft.svg", "status": "added", "additions": 216, "deletions": 0, "changes": 216, "blob_url": "https://github.com/KDE/krita/blob/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-light/light_arrow-topleft.svg", "raw_url": "https://github.com/KDE/krita/raw/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-light/light_arrow-topleft.svg", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/pics/Breeze-light/light_arrow-topleft.svg?ref=1531c17cb7045ff2ce2fb4cb925f55af8e015465", "patch": "@@ -0,0 +1,216 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<!-- Created with Inkscape (http://www.inkscape.org/) -->\n+\n+<svg\n+   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n+   xmlns:cc=\"http://creativecommons.org/ns#\"\n+   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\n+   xmlns:svg=\"http://www.w3.org/2000/svg\"\n+   xmlns=\"http://www.w3.org/2000/svg\"\n+   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\n+   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\n+   width=\"22\"\n+   height=\"22\"\n+   id=\"svg2\"\n+   version=\"1.1\"\n+   inkscape:version=\"0.91 r13725\"\n+   viewBox=\"0 0 21.999999 22\"\n+   sodipodi:docname=\"light_arrow-top-left.svg\">\n+  <defs\n+     id=\"defs4\" />\n+  <sodipodi:namedview\n+     id=\"base\"\n+     pagecolor=\"#ffffff\"\n+     bordercolor=\"#666666\"\n+     borderopacity=\"1.0\"\n+     inkscape:pageopacity=\"0.0\"\n+     inkscape:pageshadow=\"2\"\n+     inkscape:zoom=\"32.000001\"\n+     inkscape:cx=\"9.2256508\"\n+     inkscape:cy=\"4.6208524\"\n+     inkscape:document-units=\"px\"\n+     inkscape:current-layer=\"layer1\"\n+     showgrid=\"true\"\n+     inkscape:window-width=\"1878\"\n+     inkscape:window-height=\"1051\"\n+     inkscape:window-x=\"0\"\n+     inkscape:window-y=\"0\"\n+     inkscape:window-maximized=\"1\"\n+     inkscape:showpageshadow=\"false\"\n+     borderlayer=\"true\"\n+     units=\"px\"\n+     width=\"24px\"\n+     showguides=\"true\">\n+    <inkscape:grid\n+       type=\"xygrid\"\n+       id=\"grid4081\" />\n+    <sodipodi:guide\n+       position=\"2,20.000017\"\n+       orientation=\"18,0\"\n+       id=\"guide4113\" />\n+    <sodipodi:guide\n+       position=\"2,2.0000174\"\n+       orientation=\"0,18\"\n+       id=\"guide4115\" />\n+    <sodipodi:guide\n+       position=\"20,2.0000174\"\n+       orientation=\"-18,0\"\n+       id=\"guide4117\" />\n+    <sodipodi:guide\n+       position=\"20,20.000017\"\n+       orientation=\"0,-18\"\n+       id=\"guide4119\" />\n+    <sodipodi:guide\n+       position=\"2,20.000017\"\n+       orientation=\"18,0\"\n+       id=\"guide4143\" />\n+    <sodipodi:guide\n+       position=\"2,2.0000174\"\n+       orientation=\"0,3.9999995\"\n+       id=\"guide4145\" />\n+    <sodipodi:guide\n+       position=\"5.9999995,20.000017\"\n+       orientation=\"0,-3.9999995\"\n+       id=\"guide4149\" />\n+    <sodipodi:guide\n+       position=\"15.999999,2.0000174\"\n+       orientation=\"0,4.0000019\"\n+       id=\"guide4153\" />\n+    <sodipodi:guide\n+       position=\"20,2.0000174\"\n+       orientation=\"-18,0\"\n+       id=\"guide4155\" />\n+    <sodipodi:guide\n+       position=\"20,20.000017\"\n+       orientation=\"0,-4.0000019\"\n+       id=\"guide4157\" />\n+    <sodipodi:guide\n+       position=\"3,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4278\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,16\"\n+       id=\"guide4280\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4282\" />\n+    <sodipodi:guide\n+       position=\"19,19.000017\"\n+       orientation=\"0,-16\"\n+       id=\"guide4284\" />\n+    <sodipodi:guide\n+       position=\"3,4.0000174\"\n+       orientation=\"1,0\"\n+       id=\"guide4290\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,16\"\n+       id=\"guide4292\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-1,0\"\n+       id=\"guide4294\" />\n+    <sodipodi:guide\n+       position=\"3,19.000262\"\n+       orientation=\"1,0\"\n+       id=\"guide4298\" />\n+    <sodipodi:guide\n+       position=\"19,18.000262\"\n+       orientation=\"-1,0\"\n+       id=\"guide4302\" />\n+    <sodipodi:guide\n+       position=\"19,19.000262\"\n+       orientation=\"0,-16\"\n+       id=\"guide4304\" />\n+    <sodipodi:guide\n+       position=\"3,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4132\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,4.0000005\"\n+       id=\"guide4134\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4136\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,19.000017\"\n+       orientation=\"0,-4.0000005\"\n+       id=\"guide4138\" />\n+    <sodipodi:guide\n+       position=\"15.000001,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4140\" />\n+    <sodipodi:guide\n+       position=\"15.000001,3.0000174\"\n+       orientation=\"0,4\"\n+       id=\"guide4142\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4144\" />\n+    <sodipodi:guide\n+       position=\"19,19.000017\"\n+       orientation=\"0,-4\"\n+       id=\"guide4146\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,11.000506\"\n+       orientation=\"8,0\"\n+       id=\"guide4158\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0005057\"\n+       orientation=\"0,8\"\n+       id=\"guide4160\" />\n+    <sodipodi:guide\n+       position=\"15.000001,3.0005057\"\n+       orientation=\"-8,0\"\n+       id=\"guide4162\" />\n+    <sodipodi:guide\n+       position=\"15.000001,11.000506\"\n+       orientation=\"0,-8\"\n+       id=\"guide4164\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,19.000017\"\n+       orientation=\"15.999512,0\"\n+       id=\"guide4168\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0005057\"\n+       orientation=\"0,0.99999952\"\n+       id=\"guide4170\" />\n+    <sodipodi:guide\n+       position=\"8,3.0005057\"\n+       orientation=\"-15.999512,0\"\n+       id=\"guide4172\" />\n+    <sodipodi:guide\n+       position=\"8,19.000017\"\n+       orientation=\"0,-0.99999952\"\n+       id=\"guide4174\" />\n+  </sodipodi:namedview>\n+  <metadata\n+     id=\"metadata7\">\n+    <rdf:RDF>\n+      <cc:Work\n+         rdf:about=\"\">\n+        <dc:format>image/svg+xml</dc:format>\n+        <dc:type\n+           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\n+        <dc:title></dc:title>\n+      </cc:Work>\n+    </rdf:RDF>\n+  </metadata>\n+  <g\n+     inkscape:label=\"Capa 1\"\n+     inkscape:groupmode=\"layer\"\n+     id=\"layer1\"\n+     transform=\"translate(0,-1030.3622)\">\n+    <path\n+       style=\"fill:#f2f2f2;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       d=\"m 5.0000001,1047.3622 0.9964,0 0,-11 11.0035999,0 0,-1 -11.9999999,0 z\"\n+       id=\"path4179\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccccc\" />\n+  </g>\n+</svg>"}, {"sha": "7fe2fd0cc37274ddca4c0788dac137431fb652cc", "filename": "krita/pics/Breeze-light/light_arrow-topright.svg", "status": "added", "additions": 216, "deletions": 0, "changes": 216, "blob_url": "https://github.com/KDE/krita/blob/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-light/light_arrow-topright.svg", "raw_url": "https://github.com/KDE/krita/raw/1531c17cb7045ff2ce2fb4cb925f55af8e015465/krita/pics/Breeze-light/light_arrow-topright.svg", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/pics/Breeze-light/light_arrow-topright.svg?ref=1531c17cb7045ff2ce2fb4cb925f55af8e015465", "patch": "@@ -0,0 +1,216 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<!-- Created with Inkscape (http://www.inkscape.org/) -->\n+\n+<svg\n+   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n+   xmlns:cc=\"http://creativecommons.org/ns#\"\n+   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\n+   xmlns:svg=\"http://www.w3.org/2000/svg\"\n+   xmlns=\"http://www.w3.org/2000/svg\"\n+   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\n+   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\n+   width=\"22\"\n+   height=\"22\"\n+   id=\"svg2\"\n+   version=\"1.1\"\n+   inkscape:version=\"0.91 r13725\"\n+   viewBox=\"0 0 21.999999 22\"\n+   sodipodi:docname=\"light_arrow-top-right.svg\">\n+  <defs\n+     id=\"defs4\" />\n+  <sodipodi:namedview\n+     id=\"base\"\n+     pagecolor=\"#ffffff\"\n+     bordercolor=\"#666666\"\n+     borderopacity=\"1.0\"\n+     inkscape:pageopacity=\"0.0\"\n+     inkscape:pageshadow=\"2\"\n+     inkscape:zoom=\"32.000001\"\n+     inkscape:cx=\"9.2256508\"\n+     inkscape:cy=\"4.6208524\"\n+     inkscape:document-units=\"px\"\n+     inkscape:current-layer=\"layer1\"\n+     showgrid=\"true\"\n+     inkscape:window-width=\"1878\"\n+     inkscape:window-height=\"1051\"\n+     inkscape:window-x=\"0\"\n+     inkscape:window-y=\"0\"\n+     inkscape:window-maximized=\"1\"\n+     inkscape:showpageshadow=\"false\"\n+     borderlayer=\"true\"\n+     units=\"px\"\n+     width=\"24px\"\n+     showguides=\"true\">\n+    <inkscape:grid\n+       type=\"xygrid\"\n+       id=\"grid4081\" />\n+    <sodipodi:guide\n+       position=\"2,20.000017\"\n+       orientation=\"18,0\"\n+       id=\"guide4113\" />\n+    <sodipodi:guide\n+       position=\"2,2.0000174\"\n+       orientation=\"0,18\"\n+       id=\"guide4115\" />\n+    <sodipodi:guide\n+       position=\"20,2.0000174\"\n+       orientation=\"-18,0\"\n+       id=\"guide4117\" />\n+    <sodipodi:guide\n+       position=\"20,20.000017\"\n+       orientation=\"0,-18\"\n+       id=\"guide4119\" />\n+    <sodipodi:guide\n+       position=\"2,20.000017\"\n+       orientation=\"18,0\"\n+       id=\"guide4143\" />\n+    <sodipodi:guide\n+       position=\"2,2.0000174\"\n+       orientation=\"0,3.9999995\"\n+       id=\"guide4145\" />\n+    <sodipodi:guide\n+       position=\"5.9999995,20.000017\"\n+       orientation=\"0,-3.9999995\"\n+       id=\"guide4149\" />\n+    <sodipodi:guide\n+       position=\"15.999999,2.0000174\"\n+       orientation=\"0,4.0000019\"\n+       id=\"guide4153\" />\n+    <sodipodi:guide\n+       position=\"20,2.0000174\"\n+       orientation=\"-18,0\"\n+       id=\"guide4155\" />\n+    <sodipodi:guide\n+       position=\"20,20.000017\"\n+       orientation=\"0,-4.0000019\"\n+       id=\"guide4157\" />\n+    <sodipodi:guide\n+       position=\"3,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4278\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,16\"\n+       id=\"guide4280\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4282\" />\n+    <sodipodi:guide\n+       position=\"19,19.000017\"\n+       orientation=\"0,-16\"\n+       id=\"guide4284\" />\n+    <sodipodi:guide\n+       position=\"3,4.0000174\"\n+       orientation=\"1,0\"\n+       id=\"guide4290\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,16\"\n+       id=\"guide4292\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-1,0\"\n+       id=\"guide4294\" />\n+    <sodipodi:guide\n+       position=\"3,19.000262\"\n+       orientation=\"1,0\"\n+       id=\"guide4298\" />\n+    <sodipodi:guide\n+       position=\"19,18.000262\"\n+       orientation=\"-1,0\"\n+       id=\"guide4302\" />\n+    <sodipodi:guide\n+       position=\"19,19.000262\"\n+       orientation=\"0,-16\"\n+       id=\"guide4304\" />\n+    <sodipodi:guide\n+       position=\"3,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4132\" />\n+    <sodipodi:guide\n+       position=\"3,3.0000174\"\n+       orientation=\"0,4.0000005\"\n+       id=\"guide4134\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4136\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,19.000017\"\n+       orientation=\"0,-4.0000005\"\n+       id=\"guide4138\" />\n+    <sodipodi:guide\n+       position=\"15.000001,19.000017\"\n+       orientation=\"16,0\"\n+       id=\"guide4140\" />\n+    <sodipodi:guide\n+       position=\"15.000001,3.0000174\"\n+       orientation=\"0,4\"\n+       id=\"guide4142\" />\n+    <sodipodi:guide\n+       position=\"19,3.0000174\"\n+       orientation=\"-16,0\"\n+       id=\"guide4144\" />\n+    <sodipodi:guide\n+       position=\"19,19.000017\"\n+       orientation=\"0,-4\"\n+       id=\"guide4146\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,11.000506\"\n+       orientation=\"8,0\"\n+       id=\"guide4158\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0005057\"\n+       orientation=\"0,8\"\n+       id=\"guide4160\" />\n+    <sodipodi:guide\n+       position=\"15.000001,3.0005057\"\n+       orientation=\"-8,0\"\n+       id=\"guide4162\" />\n+    <sodipodi:guide\n+       position=\"15.000001,11.000506\"\n+       orientation=\"0,-8\"\n+       id=\"guide4164\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,19.000017\"\n+       orientation=\"15.999512,0\"\n+       id=\"guide4168\" />\n+    <sodipodi:guide\n+       position=\"7.0000005,3.0005057\"\n+       orientation=\"0,0.99999952\"\n+       id=\"guide4170\" />\n+    <sodipodi:guide\n+       position=\"8,3.0005057\"\n+       orientation=\"-15.999512,0\"\n+       id=\"guide4172\" />\n+    <sodipodi:guide\n+       position=\"8,19.000017\"\n+       orientation=\"0,-0.99999952\"\n+       id=\"guide4174\" />\n+  </sodipodi:namedview>\n+  <metadata\n+     id=\"metadata7\">\n+    <rdf:RDF>\n+      <cc:Work\n+         rdf:about=\"\">\n+        <dc:format>image/svg+xml</dc:format>\n+        <dc:type\n+           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\n+        <dc:title></dc:title>\n+      </cc:Work>\n+    </rdf:RDF>\n+  </metadata>\n+  <g\n+     inkscape:label=\"Capa 1\"\n+     inkscape:groupmode=\"layer\"\n+     id=\"layer1\"\n+     transform=\"translate(0,-1030.3622)\">\n+    <path\n+       style=\"fill:#f2f2f2;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n+       d=\"m 5,1035.3622 0,0.9964 11,0 0,11.0036 1,0 0,-12 z\"\n+       id=\"path4179\"\n+       inkscape:connector-curvature=\"0\"\n+       sodipodi:nodetypes=\"ccccccc\" />\n+  </g>\n+</svg>"}]}, {"sha": "4adb5a998ae487b66eae01785be837faecd06e6b", "stats": {"total": 6, "additions": 3, "deletions": 3}, "files": [{"sha": "41f0cc4ec8ca9403d9d1ed40631b3f7c98ac2337", "filename": "libs/widgetutils/xmlgui/kswitchlanguagedialog_p.cpp", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/4adb5a998ae487b66eae01785be837faecd06e6b/libs/widgetutils/xmlgui/kswitchlanguagedialog_p.cpp", "raw_url": "https://github.com/KDE/krita/raw/4adb5a998ae487b66eae01785be837faecd06e6b/libs/widgetutils/xmlgui/kswitchlanguagedialog_p.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/xmlgui/kswitchlanguagedialog_p.cpp?ref=4adb5a998ae487b66eae01785be837faecd06e6b", "patch": "@@ -57,7 +57,7 @@ static QByteArray getApplicationSpecificLanguage(const QByteArray &defaultCode =\n {\n     QSettingsPtr settings = localeOverridesSettings();\n     settings->beginGroup(QStringLiteral(\"Language\"));\n-    qDebug() << \"our language\" << settings->value(qAppName(), defaultCode).toByteArray();\n+    //qDebug() << \"our language\" << settings->value(qAppName(), defaultCode).toByteArray();\n     return settings->value(qAppName(), defaultCode).toByteArray();\n }\n \n@@ -85,8 +85,8 @@ static void initializeLanguages()\n             qputenv(\"LANGUAGE\", languageCode + \":\" + languages);\n         }\n     }\n-    qDebug() << \">>>>>>>>>>>>>> LANGUAGE\" << qgetenv(\"LANGUAGE\");\n-    qDebug() << \">>>>>>>>>>>>>> DATADIRS\" << qgetenv(\"XDG_DATA_DIRS\");\n+    //qDebug() << \">>>>>>>>>>>>>> LANGUAGE\" << qgetenv(\"LANGUAGE\");\n+    //qDebug() << \">>>>>>>>>>>>>> DATADIRS\" << qgetenv(\"XDG_DATA_DIRS\");\n }\n \n Q_COREAPP_STARTUP_FUNCTION(initializeLanguages)"}]}, {"sha": "5e5e466cee204f3edd20cedc7b10c24766a43a7f", "stats": {"total": 149, "additions": 67, "deletions": 82}, "files": [{"sha": "ee569d5c45d9d17634936bba8b4829fdb7d7297f", "filename": "libs/brush/kis_abr_brush_collection.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5e5e466cee204f3edd20cedc7b10c24766a43a7f/libs/brush/kis_abr_brush_collection.cpp", "raw_url": "https://github.com/KDE/krita/raw/5e5e466cee204f3edd20cedc7b10c24766a43a7f/libs/brush/kis_abr_brush_collection.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/brush/kis_abr_brush_collection.cpp?ref=5e5e466cee204f3edd20cedc7b10c24766a43a7f", "patch": "@@ -17,7 +17,7 @@\n  *  along with this program; if not, write to the Free Software\n  *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.\n  */\n-#include <netinet/in.h>\n+#include <QtEndian>\n \n #include \"kis_abr_brush_collection.h\"\n #include \"kis_abr_brush.h\""}, {"sha": "03333e0b12b7b4f52545087c14d1877b0f19b511", "filename": "libs/brush/kis_gbr_brush.cpp", "status": "modified", "additions": 16, "deletions": 16, "changes": 32, "blob_url": "https://github.com/KDE/krita/blob/5e5e466cee204f3edd20cedc7b10c24766a43a7f/libs/brush/kis_gbr_brush.cpp", "raw_url": "https://github.com/KDE/krita/raw/5e5e466cee204f3edd20cedc7b10c24766a43a7f/libs/brush/kis_gbr_brush.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/brush/kis_gbr_brush.cpp?ref=5e5e466cee204f3edd20cedc7b10c24766a43a7f", "patch": "@@ -22,7 +22,7 @@\n  *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.\n  */\n #include <sys/types.h>\n-#include <netinet/in.h> // htonl\n+#include <QtEndian>\n \n #include \"kis_gbr_brush.h\"\n \n@@ -176,27 +176,27 @@ bool KisGbrBrush::init()\n     }\n \n     memcpy(&bh, d->data, sizeof(GimpBrushHeader));\n-    bh.header_size = ntohl(bh.header_size);\n+    bh.header_size = qFromBigEndian(bh.header_size);\n     d->header_size = bh.header_size;\n \n-    bh.version = ntohl(bh.version);\n+    bh.version = qFromBigEndian(bh.version);\n     d->version = bh.version;\n \n-    bh.width = ntohl(bh.width);\n-    bh.height = ntohl(bh.height);\n+    bh.width = qFromBigEndian(bh.width);\n+    bh.height = qFromBigEndian(bh.height);\n \n-    bh.bytes = ntohl(bh.bytes);\n+    bh.bytes = qFromBigEndian(bh.bytes);\n     d->bytes = bh.bytes;\n \n-    bh.magic_number = ntohl(bh.magic_number);\n+    bh.magic_number = qFromBigEndian(bh.magic_number);\n     d->magic_number = bh.magic_number;\n \n     if (bh.version == 1) {\n         // No spacing in version 1 files so use Gimp default\n         bh.spacing = static_cast<int>(DEFAULT_SPACING * 100);\n     }\n     else {\n-        bh.spacing = ntohl(bh.spacing);\n+        bh.spacing = qFromBigEndian(bh.spacing);\n \n         if (bh.spacing > 1000) {\n             return false;\n@@ -327,19 +327,19 @@ bool KisGbrBrush::saveToDevice(QIODevice* dev) const\n     int nameLength = qstrlen(name);\n     int wrote;\n \n-    bh.header_size = htonl(sizeof(GimpBrushHeader) + nameLength + 1);\n-    bh.version = htonl(2); // Only RGBA8 data needed atm, no cinepaint stuff\n-    bh.width = htonl(width());\n-    bh.height = htonl(height());\n+    bh.header_size = qToBigEndian((quint32)sizeof(GimpBrushHeader) + nameLength + 1);\n+    bh.version = qToBigEndian((quint32)2); // Only RGBA8 data needed atm, no cinepaint stuff\n+    bh.width = qToBigEndian((quint32)width());\n+    bh.height = qToBigEndian((quint32)height());\n     // Hardcoded, 4 bytes RGBA or 1 byte GREY\n     if (!hasColor()) {\n-        bh.bytes = htonl(1);\n+        bh.bytes = qToBigEndian((quint32)1);\n     }\n     else {\n-        bh.bytes = htonl(4);\n+        bh.bytes = qToBigEndian((quint32)4);\n     }\n-    bh.magic_number = htonl(GimpV2BrushMagic);\n-    bh.spacing = htonl(static_cast<quint32>(spacing() * 100.0));\n+    bh.magic_number = qToBigEndian((quint32)GimpV2BrushMagic);\n+    bh.spacing = qToBigEndian(static_cast<quint32>(spacing() * 100.0));\n \n     // Write header: first bh, then the name\n     QByteArray bytes = QByteArray::fromRawData(reinterpret_cast<char*>(&bh), sizeof(GimpBrushHeader));"}, {"sha": "95b48d2c8f644b95a51450fdc45bdae413e21d7a", "filename": "libs/pigment/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/5e5e466cee204f3edd20cedc7b10c24766a43a7f/libs/pigment/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/5e5e466cee204f3edd20cedc7b10c24766a43a7f/libs/pigment/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/CMakeLists.txt?ref=5e5e466cee204f3edd20cedc7b10c24766a43a7f", "patch": "@@ -108,6 +108,7 @@ target_link_libraries( kritapigment\n         kritaplugin\n         ${EXTRA_LIBRARIES}\n         KF5::I18n \n+        Qt5::Core\n         Qt5::Gui\n         Qt5::Xml\n         ${WIN32_PLATFORM_NET_LIBS}"}, {"sha": "dbf204bfb8f626d7334ca283075f52d030894234", "filename": "libs/pigment/resources/KoColorSet.cpp", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/5e5e466cee204f3edd20cedc7b10c24766a43a7f/libs/pigment/resources/KoColorSet.cpp", "raw_url": "https://github.com/KDE/krita/raw/5e5e466cee204f3edd20cedc7b10c24766a43a7f/libs/pigment/resources/KoColorSet.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/resources/KoColorSet.cpp?ref=5e5e466cee204f3edd20cedc7b10c24766a43a7f", "patch": "@@ -19,7 +19,7 @@\n #include <resources/KoColorSet.h>\n \n #include <sys/types.h>\n-#include <netinet/in.h> // htonl\n+#include <QtEndian> // qFromLittleEndian\n \n #include <QImage>\n #include <QPoint>\n@@ -377,7 +377,7 @@ bool KoColorSet::loadRiff()\n \n     RiffHeader header;\n     memcpy(&header, m_data.constData(), sizeof(RiffHeader));\n-    header.colorcount = ntohl(header.colorcount);\n+    header.colorcount = qFromBigEndian(header.colorcount);\n \n     for (int i = sizeof(RiffHeader);\n          (i < (int)(sizeof(RiffHeader) + header.colorcount) && i < m_data.size());\n@@ -442,7 +442,7 @@ quint16 readShort(QIODevice *io) {\n     quint16 val;\n     quint64 read = io->read((char*)&val, 2);\n     if (read != 2) return false;\n-    return ntohs(val);\n+    return qFromBigEndian(val);\n }\n \n bool KoColorSet::loadAco()"}, {"sha": "b276f05ba01e51f4feb6ed39b0accea6072f5993", "filename": "libs/pigment/resources/KoPattern.cpp", "status": "modified", "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/KDE/krita/blob/5e5e466cee204f3edd20cedc7b10c24766a43a7f/libs/pigment/resources/KoPattern.cpp", "raw_url": "https://github.com/KDE/krita/raw/5e5e466cee204f3edd20cedc7b10c24766a43a7f/libs/pigment/resources/KoPattern.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/resources/KoPattern.cpp?ref=5e5e466cee204f3edd20cedc7b10c24766a43a7f", "patch": "@@ -21,7 +21,7 @@\n #include <resources/KoPattern.h>\n \n #include <sys/types.h>\n-#include <netinet/in.h>\n+#include <QtEndian>\n \n #include <limits.h>\n #include <stdlib.h>\n@@ -120,12 +120,12 @@ bool KoPattern::savePatToDevice(QIODevice* dev) const\n     char const* name = utf8Name.data();\n     int nameLength = qstrlen(name);\n \n-    ph.header_size = htonl(sizeof(GimpPatternHeader) + nameLength + 1); // trailing 0\n-    ph.version = htonl(1);\n-    ph.width = htonl(width());\n-    ph.height = htonl(height());\n-    ph.bytes = htonl(4);\n-    ph.magic_number = htonl(GimpPatternMagic);\n+    ph.header_size = qToBigEndian((quint32)sizeof(GimpPatternHeader) + nameLength + 1); // trailing 0\n+    ph.version = qToBigEndian((quint32)1);\n+    ph.width = qToBigEndian((quint32)width());\n+    ph.height = qToBigEndian((quint32)height());\n+    ph.bytes = qToBigEndian((quint32)4);\n+    ph.magic_number = qToBigEndian((quint32)GimpPatternMagic);\n \n     QByteArray bytes = QByteArray::fromRawData(reinterpret_cast<char*>(&ph), sizeof(GimpPatternHeader));\n     int wrote = dev->write(bytes);\n@@ -230,12 +230,12 @@ bool KoPattern::init(QByteArray& bytes)\n     }\n \n     memcpy(&bh, data, sizeof(GimpPatternHeader));\n-    bh.header_size = ntohl(bh.header_size);\n-    bh.version = ntohl(bh.version);\n-    bh.width = ntohl(bh.width);\n-    bh.height = ntohl(bh.height);\n-    bh.bytes = ntohl(bh.bytes);\n-    bh.magic_number = ntohl(bh.magic_number);\n+    bh.header_size = qFromBigEndian(bh.header_size);\n+    bh.version = qFromBigEndian(bh.version);\n+    bh.width = qFromBigEndian(bh.width);\n+    bh.height = qFromBigEndian(bh.height);\n+    bh.bytes = qFromBigEndian(bh.bytes);\n+    bh.magic_number = qFromBigEndian(bh.magic_number);\n \n     if ((int)bh.header_size > dataSize || bh.header_size == 0) {\n         return false;"}, {"sha": "dd9bd98f7ced00412e3190a83cfa475bdacd2bd9", "filename": "libs/psd/compression.cpp", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/5e5e466cee204f3edd20cedc7b10c24766a43a7f/libs/psd/compression.cpp", "raw_url": "https://github.com/KDE/krita/raw/5e5e466cee204f3edd20cedc7b10c24766a43a7f/libs/psd/compression.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/psd/compression.cpp?ref=5e5e466cee204f3edd20cedc7b10c24766a43a7f", "patch": "@@ -21,7 +21,7 @@\n #include <QBuffer>\n #include \"psd_utils.h\"\n #include \"kis_debug.h\"\n-#include <netinet/in.h> // htonl\n+#include <QtEndian>\n \n // from gimp's psd-save.c\n static quint32 pack_pb_line (const QByteArray &src,\n@@ -223,7 +223,7 @@ QByteArray Compression::uncompress(quint32 unpacked_len, QByteArray bytes, Compr\n \n         QByteArray b;\n         QBuffer buf(&b);\n-        quint32 val = ntohl(unpacked_len);\n+        quint32 val = qFromBigEndian(unpacked_len);\n         buf.write((char*)&val, 4);\n         b.append(bytes);\n "}, {"sha": "69e48903e9a0665e79b96a0439f1ea13141eeb38", "filename": "libs/psd/psd_utils.cpp", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/KDE/krita/blob/5e5e466cee204f3edd20cedc7b10c24766a43a7f/libs/psd/psd_utils.cpp", "raw_url": "https://github.com/KDE/krita/raw/5e5e466cee204f3edd20cedc7b10c24766a43a7f/libs/psd/psd_utils.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/psd/psd_utils.cpp?ref=5e5e466cee204f3edd20cedc7b10c24766a43a7f", "patch": "@@ -22,7 +22,7 @@\n #include <QIODevice>\n #include <QString>\n \n-#include <netinet/in.h> // htonl\n+#include <QtEndian>\n #include \"psd.h\"\n \n bool psdwrite(QIODevice* io, quint8 v)\n@@ -33,21 +33,21 @@ bool psdwrite(QIODevice* io, quint8 v)\n \n bool psdwrite(QIODevice* io, quint16 v)\n {\n-    quint16 val = htons(v);\n+    quint16 val = qToBigEndian((quint16)v);\n     int written = io->write((char*)&val, 2);\n     return written == 2;\n }\n \n bool psdwrite(QIODevice* io, qint16 v)\n {\n-    qint16 val = htons(v);\n+    qint16 val = qToBigEndian((qint16)v);\n     int written = io->write((char*)&val, 2);\n     return written == 2;\n }\n \n bool psdwrite(QIODevice* io, quint32 v)\n {\n-    quint32 val = htonl(v);\n+    quint32 val = qToBigEndian((quint32)v);\n     int written = io->write((char*)&val, 4);\n     return written == 4;\n }\n@@ -149,7 +149,7 @@ bool psdread(QIODevice* io, quint16* v)\n     quint16 val;\n     quint64 read = io->read((char*)&val, 2);\n     if (read != 2) return false;\n-    *v = ntohs(val);\n+    *v = qFromBigEndian(val);\n     return true;\n }\n \n@@ -158,7 +158,7 @@ bool psdread(QIODevice* io, qint16* v)\n     qint16 val;\n     quint64 read = io->read((char*)&val, 2);\n     if (read != 2) return false;\n-    *v = ntohs(val);\n+    *v = qFromBigEndian(val);\n     return true;\n }\n \n@@ -168,7 +168,7 @@ bool psdread(QIODevice* io, quint32* v)\n     quint32 val;\n     quint64 read = io->read((char*)&val, 4);\n     if (read != 4) return false;\n-    *v = ntohl(val);\n+    *v = qFromBigEndian(val);\n     return true;\n }\n \n@@ -178,7 +178,7 @@ bool psdread(QIODevice* io, qint32* v)\n     qint32 val;\n     quint64 read = io->read((char*)&val, 4);\n     if (read != 4) return false;\n-    *v = ntohl(val);\n+    *v = qFromBigEndian(val);\n     return true;\n }\n "}, {"sha": "6d6f551447d82d2d2ab5d8a7a7ccbeb1ccdd8b10", "filename": "plugins/impex/psd/psd_header.cpp", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/KDE/krita/blob/5e5e466cee204f3edd20cedc7b10c24766a43a7f/plugins/impex/psd/psd_header.cpp", "raw_url": "https://github.com/KDE/krita/raw/5e5e466cee204f3edd20cedc7b10c24766a43a7f/plugins/impex/psd/psd_header.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/psd/psd_header.cpp?ref=5e5e466cee204f3edd20cedc7b10c24766a43a7f", "patch": "@@ -21,7 +21,7 @@\n #include <QIODevice>\n \n #include \"psd_utils.h\"\n-#include <netinet/in.h> // htonl\n+#include <QtEndian>\n \n struct Header {\n     char signature[4];    // 8PBS\n@@ -56,17 +56,17 @@ bool PSDHeader::read(QIODevice* device)\n \n     signature = QString(header.signature);\n     memcpy(&version, header.version, 2);\n-    version = ntohs(version);\n+    version = qFromBigEndian(version);\n     memcpy(&nChannels, header.nChannels, 2);\n-    nChannels = ntohs(nChannels);\n+    nChannels = qFromBigEndian(nChannels);\n     memcpy(&height, header.height, 4);\n-    height = ntohl(height);\n+    height = qFromBigEndian(height);\n     memcpy(&width, header.width, 4);\n-    width = ntohl(width);\n+    width = qFromBigEndian(width);\n     memcpy(&channelDepth, header.channelDepth, 2);\n-    channelDepth = ntohs(channelDepth);\n+    channelDepth = qFromBigEndian(channelDepth);\n     memcpy(&colormode, header.colormode, 2);\n-    colormode = (psd_color_mode)ntohs((quint16)colormode);\n+    colormode = (psd_color_mode)qFromBigEndian((quint16)colormode);\n \n     return valid();\n }"}, {"sha": "7fa02cdb87fca2998d94c219038cd301f8f76cb1", "filename": "plugins/impex/psd/psd_image_data.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5e5e466cee204f3edd20cedc7b10c24766a43a7f/plugins/impex/psd/psd_image_data.cpp", "raw_url": "https://github.com/KDE/krita/raw/5e5e466cee204f3edd20cedc7b10c24766a43a7f/plugins/impex/psd/psd_image_data.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/psd/psd_image_data.cpp?ref=5e5e466cee204f3edd20cedc7b10c24766a43a7f", "patch": "@@ -17,7 +17,7 @@\n \n #include <psd_image_data.h>\n \n-#include <netinet/in.h> // htonl\n+#include <QtEndian>\n \n #include <QFile>\n #include <kis_debug.h>"}, {"sha": "d168e419ffae25e2414d378e27278fcbef9f55e3", "filename": "plugins/impex/psd/psd_layer_record.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5e5e466cee204f3edd20cedc7b10c24766a43a7f/plugins/impex/psd/psd_layer_record.cpp", "raw_url": "https://github.com/KDE/krita/raw/5e5e466cee204f3edd20cedc7b10c24766a43a7f/plugins/impex/psd/psd_layer_record.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/psd/psd_layer_record.cpp?ref=5e5e466cee204f3edd20cedc7b10c24766a43a7f", "patch": "@@ -17,7 +17,7 @@\n  */\n #include \"psd_layer_record.h\"\n \n-#include <netinet/in.h> // htonl\n+#include <QtEndian>\n \n #include <QIODevice>\n #include <QBuffer>"}, {"sha": "f0d065fda5afb59aed515dec9fa9b92db9054053", "filename": "plugins/impex/psd/psd_pixel_utils.cpp", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/KDE/krita/blob/5e5e466cee204f3edd20cedc7b10c24766a43a7f/plugins/impex/psd/psd_pixel_utils.cpp", "raw_url": "https://github.com/KDE/krita/raw/5e5e466cee204f3edd20cedc7b10c24766a43a7f/plugins/impex/psd/psd_pixel_utils.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/psd/psd_pixel_utils.cpp?ref=5e5e466cee204f3edd20cedc7b10c24766a43a7f", "patch": "@@ -28,7 +28,7 @@\n #include <KoColorSpaceTraits.h>\n #include <KoCmykColorSpaceTraits.h>\n \n-#include <netinet/in.h> // htonl\n+#include <QtEndian>\n \n #include \"kis_global.h\"\n #include <asl/kis_asl_writer_utils.h>\n@@ -56,12 +56,12 @@ inline quint8 convertByteOrder<KoGrayU8Traits>(quint8 value) {\n \n template <>\n inline quint16 convertByteOrder<KoGrayU16Traits>(quint16 value) {\n-    return ntohs(value);\n+    return qFromBigEndian((quint16)value);\n }\n \n template <>\n inline quint32 convertByteOrder<KoGrayU32Traits>(quint32 value) {\n-    return ntohs(value);\n+    return qFromBigEndian((quint32)value);\n }\n \n template <>\n@@ -71,12 +71,12 @@ inline quint8 convertByteOrder<KoBgrU8Traits>(quint8 value) {\n \n template <>\n inline quint16 convertByteOrder<KoBgrU16Traits>(quint16 value) {\n-    return ntohs(value);\n+    return qFromBigEndian((quint16)value);\n }\n \n template <>\n inline quint32 convertByteOrder<KoBgrU32Traits>(quint32 value) {\n-    return ntohs(value);\n+    return qFromBigEndian((quint32)value);\n }\n \n template <>\n@@ -86,12 +86,12 @@ inline quint8 convertByteOrder<KoCmykU8Traits>(quint8 value) {\n \n template <>\n inline quint16 convertByteOrder<KoCmykU16Traits>(quint16 value) {\n-    return ntohs(value);\n+    return qFromBigEndian((quint16)value);\n }\n \n template <>\n inline float convertByteOrder<KoCmykF32Traits>(float value) {\n-    return ntohs(value);\n+    return qFromBigEndian((quint32)value);\n }\n \n template <>\n@@ -101,12 +101,12 @@ inline quint8 convertByteOrder<KoLabU8Traits>(quint8 value) {\n \n template <>\n inline quint16 convertByteOrder<KoLabU16Traits>(quint16 value) {\n-    return ntohs(value);\n+    return qFromBigEndian((quint16)value);\n }\n \n template <>\n inline float convertByteOrder<KoLabF32Traits>(float value) {\n-    return ntohs(value);\n+    return qFromBigEndian((quint32)value);\n }\n \n template <class Traits>\n@@ -271,7 +271,7 @@ typedef quint8 psd_uchar;\n typedef int psd_int;\n typedef quint8 Bytef;\n \n-psd_status psd_unzip_without_prediction(psd_uchar *src_buf, psd_int src_len, \n+psd_status psd_unzip_without_prediction(psd_uchar *src_buf, psd_int src_len,\n                                         psd_uchar *dst_buf, psd_int dst_len)\n {\n #ifdef HAVE_ZLIB\n@@ -307,8 +307,8 @@ psd_status psd_unzip_without_prediction(psd_uchar *src_buf, psd_int src_len,\n     return 0;\n }\n \n-psd_status psd_unzip_with_prediction(psd_uchar *src_buf, psd_int src_len, \n-                                     psd_uchar *dst_buf, psd_int dst_len, \n+psd_status psd_unzip_with_prediction(psd_uchar *src_buf, psd_int src_len,\n+                                     psd_uchar *dst_buf, psd_int dst_len,\n                                      psd_int row_size, psd_int color_depth)\n {\n     psd_status status;\n@@ -560,7 +560,7 @@ inline void preparePixelForWrite(quint8 *dataPlane,\n             quint16 *pixelPtr = reinterpret_cast<quint16*>(dataPlane) + i;\n \n             val = *pixelPtr;\n-            val = ntohs(val);\n+            val = qFromBigEndian(val);\n             if (channelId >= 0 && (colorMode == CMYK || colorMode == CMYK64)) {\n                 val = quint16_MAX - val;\n             }\n@@ -573,7 +573,7 @@ inline void preparePixelForWrite(quint8 *dataPlane,\n             quint32 *pixelPtr = reinterpret_cast<quint32*>(dataPlane) + i;\n \n             val = *pixelPtr;\n-            val = ntohl(val);\n+            val = qFromBigEndian(val);\n             if (channelId >= 0 && (colorMode == CMYK || colorMode == CMYK64)) {\n                 val = quint16_MAX - val;\n             }"}, {"sha": "42157372fce0380421feb49ed250340197a89e88", "filename": "winquirks/netinet/in.h", "status": "removed", "additions": 0, "deletions": 16, "changes": 16, "blob_url": "https://github.com/KDE/krita/blob/972a6eedfdd3fd4fe0e01c9fd466d7ad7761758a/winquirks/netinet/in.h", "raw_url": "https://github.com/KDE/krita/raw/972a6eedfdd3fd4fe0e01c9fd466d7ad7761758a/winquirks/netinet/in.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/winquirks/netinet/in.h?ref=972a6eedfdd3fd4fe0e01c9fd466d7ad7761758a", "patch": "@@ -1,16 +0,0 @@\n-#ifndef QUIRK_NETINET_IN_H\n-#define QUIRK_NETINET_IN_H\n-\n-/*\n- * this is used for htonl mostly.\n- *\n- * while POSIX specifies <arpa/inet.h> as the portable\n- * include file, <netinet/in.h> is used throughout\n- * calligra.\n- *\n- */\n-\n-#pragma message(\"winquirk: no netinet/in.h!\")\n-#include <Winsock2.h>\n-\n-#endif"}]}, {"sha": "972a6eedfdd3fd4fe0e01c9fd466d7ad7761758a", "stats": {"total": 26, "additions": 13, "deletions": 13}, "files": [{"sha": "6d7c8603ae5b1e7f65bea15964f39ebbe2c5ca7a", "filename": "libs/pigment/KoColorSpace.cpp", "status": "modified", "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/KDE/krita/blob/972a6eedfdd3fd4fe0e01c9fd466d7ad7761758a/libs/pigment/KoColorSpace.cpp", "raw_url": "https://github.com/KDE/krita/raw/972a6eedfdd3fd4fe0e01c9fd466d7ad7761758a/libs/pigment/KoColorSpace.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/KoColorSpace.cpp?ref=972a6eedfdd3fd4fe0e01c9fd466d7ad7761758a", "patch": "@@ -122,10 +122,10 @@ QPolygonF KoColorSpace::gamutXYY() const\n             \n         }\n         int samples = 5;//amount of samples in our color space.\n-        QString name = KoColorSpaceRegistry::instance()->colorSpaceFactory(\"XYZAF16\")->defaultProfile();\n-        const KoColorSpace* xyzColorSpace = KoColorSpaceRegistry::instance()->colorSpace(\"XYZA\", \"F16\", name);\n+        QString name = KoColorSpaceRegistry::instance()->colorSpaceFactory(\"XYZAF32\")->defaultProfile();\n+        const KoColorSpace* xyzColorSpace = KoColorSpaceRegistry::instance()->colorSpace(\"XYZA\", \"F32\", name);\n         quint8 *data = new quint8[pixelSize()];\n-        quint8 data2[8]; // xyza is 8 bytes per pixel.\n+        quint8 data2[16]; // xyza f32 is 4 floats, that is 16 bytes per pixel.\n         //QVector <qreal> sampleCoordinates(pow(colorChannelCount(),samples));\n         //sampleCoordinates.fill(0.0);\n \n@@ -138,25 +138,25 @@ QPolygonF KoColorSpace::gamutXYY() const\n                 channelValuesF[1]=max;\n                 fromNormalisedChannelsValue(data, channelValuesF);\n                 convertPixelsTo(data, data2, xyzColorSpace, 1, KoColorConversionTransformation::IntentAbsoluteColorimetric, KoColorConversionTransformation::adjustmentConversionFlags());\n-                xyzColorSpace->normalisedChannelsValue(data2,channelValuesF);\n+                xyzColorSpace->normalisedChannelsValue(data2, channelValuesF);\n                 qreal x = channelValuesF[0]/(channelValuesF[0]+channelValuesF[1]+channelValuesF[2]);\n                 qreal y = channelValuesF[1]/(channelValuesF[0]+channelValuesF[1]+channelValuesF[2]);\n-                d->gamutXYY<< QPointF(x,y);\n+                d->gamutXYY << QPointF(x,y);\n             } else {\n                 for(int y=0;y<samples;y++){\n                     for(int z=0;z<samples;z++){\n                         if (colorChannelCount()==4) {\n                             for(int k=0;k<samples;k++){\n-                                channelValuesF[0]=(max/(samples-1))*(x);\n-                                channelValuesF[1]=(max/(samples-1))*(y);\n-                                channelValuesF[2]=(max/(samples-1))*(z);\n-                                channelValuesF[3]=(max/(samples-1))*(k);\n-                                channelValuesF[4]=max;\n+                                channelValuesF[0] = (max / (samples - 1)) * (x);\n+                                channelValuesF[1] = (max / (samples - 1)) * (y);\n+                                channelValuesF[2] = (max / (samples - 1)) * (z);\n+                                channelValuesF[3] = (max / (samples - 1)) * (k);\n+                                channelValuesF[4] = max;\n                                 fromNormalisedChannelsValue(data, channelValuesF);\n                                 convertPixelsTo(data, data2, xyzColorSpace, 1, KoColorConversionTransformation::IntentAbsoluteColorimetric, KoColorConversionTransformation::adjustmentConversionFlags());\n-                                xyzColorSpace->normalisedChannelsValue(data2,channelValuesF);\n-                                qreal x = channelValuesF[0]/(channelValuesF[0]+channelValuesF[1]+channelValuesF[2]);\n-                                qreal y = channelValuesF[1]/(channelValuesF[0]+channelValuesF[1]+channelValuesF[2]);\n+                                xyzColorSpace->normalisedChannelsValue(data2, channelValuesF);\n+                                qreal x = channelValuesF[0] / (channelValuesF[0] + channelValuesF[1] + channelValuesF[2]);\n+                                qreal y = channelValuesF[1] / (channelValuesF[0] + channelValuesF[1] + channelValuesF[2]);\n                                 d->gamutXYY<< QPointF(x,y);\n                             }\n                         } else {"}]}, {"sha": "ba25e96e1ba8119d2d2fb5085a7d75a851d883bd", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "a969101fee63649466da5dc432005a9056c33dfb", "filename": "libs/widgets/KoResourceServer.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/ba25e96e1ba8119d2d2fb5085a7d75a851d883bd/libs/widgets/KoResourceServer.h", "raw_url": "https://github.com/KDE/krita/raw/ba25e96e1ba8119d2d2fb5085a7d75a851d883bd/libs/widgets/KoResourceServer.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgets/KoResourceServer.h?ref=ba25e96e1ba8119d2d2fb5085a7d75a851d883bd", "patch": "@@ -134,7 +134,7 @@ class KoResourceServer : public KoResourceServerBase\n     KoResourceServer(const QString& type, const QString& extensions)\n         : KoResourceServerBase(type, extensions)\n     {\n-        m_blackListFile = KoResourcePaths::locateLocal(\"data\", \"krita/\" + type + \".blacklist\");\n+        m_blackListFile = KoResourcePaths::locateLocal(\"data\", type + \".blacklist\");\n         m_blackListFileNames = readBlackListFile();\n         m_tagStore = new KoResourceTagStore(this);\n         m_tagStore->loadTags();"}]}, {"sha": "a32a2f3ca29fcc8e1e353fc4a0fa00ea39de9baa", "stats": {"total": 18, "additions": 16, "deletions": 2}, "files": [{"sha": "6ff3301384301503006c719e67be9028f3f6f786", "filename": "krita/krita.xmlgui", "status": "modified", "additions": 16, "deletions": 2, "changes": 18, "blob_url": "https://github.com/KDE/krita/blob/a32a2f3ca29fcc8e1e353fc4a0fa00ea39de9baa/krita/krita.xmlgui", "raw_url": "https://github.com/KDE/krita/raw/a32a2f3ca29fcc8e1e353fc4a0fa00ea39de9baa/krita/krita.xmlgui", "contents_url": "https://api.github.com/repos/KDE/krita/contents/krita/krita.xmlgui?ref=a32a2f3ca29fcc8e1e353fc4a0fa00ea39de9baa", "patch": "@@ -88,12 +88,26 @@ xsi:schemaLocation=\"http://www.kde.org/standards/kxmlgui/1.0  http://www.kde.org\n       <Action name=\"rulers_track_mouse\"/>\n       <Action name=\"view_show_guides\"/>\n       <Action name=\"view_lock_guides\"/>\n-      <Action name=\"view_snap_to_guides\"/>\n       <Action name=\"showStatusBar\" />\n       <Separator/>\n       <Action name=\"view_grid\"/>\n-      <Action name=\"view_snap_to_grid\"/>\n+      \n+      \n+      <Separator/>\n+      <Menu name=\"SnapTo\">\n+        <text>&amp;Snap To</text>\n+        <Action name=\"view_snap_to_guides\"/>\n+  \t    <Action name=\"view_snap_to_grid\"/>\n+    \t  <Action name=\"view_snap_orthogonal\" />\n+  \t    <Action name=\"view_snap_node\" />\n+  \t    <Action name=\"view_snap_extension\" />\n+  \t    <Action name=\"view_snap_intersection\" />\n+  \t    <Action name=\"view_snap_bounding_box\" />\n+  \t    <Action name=\"view_snap_image_bounds\" />\n+\t     <Action name=\"view_snap_image_center\" />\n+      </Menu>\n       <Separator/>\n+\n       <Action name=\"view_toggle_painting_assistants\"/>\n       <Action name=\"view_toggle_assistant_previews\"/>\n       <Separator/>"}]}, {"sha": "695cc85ebc95f0c1e40024105172016e37148c6f", "stats": {"total": 22, "additions": 13, "deletions": 9}, "files": [{"sha": "ef32e79d9956b451efd63e3329b9ea5c992ddf12", "filename": "plugins/tools/tool_transform2/kis_tool_transform.cc", "status": "modified", "additions": 12, "deletions": 8, "changes": 20, "blob_url": "https://github.com/KDE/krita/blob/695cc85ebc95f0c1e40024105172016e37148c6f/plugins/tools/tool_transform2/kis_tool_transform.cc", "raw_url": "https://github.com/KDE/krita/raw/695cc85ebc95f0c1e40024105172016e37148c6f/plugins/tools/tool_transform2/kis_tool_transform.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_transform2/kis_tool_transform.cc?ref=695cc85ebc95f0c1e40024105172016e37148c6f", "patch": "@@ -259,7 +259,7 @@ void KisToolTransform::beginActionImpl(KoPointerEvent *event, bool usePrimaryAct\n     }\n \n     if (!m_strokeData.strokeId()) {\n-        startStroke(m_currentArgs.mode());\n+        startStroke(m_currentArgs.mode(), false);\n     } else {\n         bool result = false;\n \n@@ -798,7 +798,7 @@ void KisToolTransform::activate(ToolActivation toolActivation, const QSet<KoShap\n         m_transaction = TransformTransactionProperties(QRectF(), &m_currentArgs, currentNode());\n     }\n \n-    startStroke(ToolTransformArgs::FREE_TRANSFORM);\n+    startStroke(ToolTransformArgs::FREE_TRANSFORM, false);\n }\n \n void KisToolTransform::deactivate()\n@@ -825,7 +825,7 @@ void KisToolTransform::requestStrokeCancellation()\n     cancelStroke();\n }\n \n-void KisToolTransform::startStroke(ToolTransformArgs::TransformMode mode)\n+void KisToolTransform::startStroke(ToolTransformArgs::TransformMode mode, bool forceReset)\n {\n     Q_ASSERT(!m_strokeData.strokeId());\n \n@@ -856,7 +856,11 @@ void KisToolTransform::startStroke(ToolTransformArgs::TransformMode mode)\n     }\n \n     ToolTransformArgs fetchedArgs;\n-    bool fetchedFromCommand = tryFetchArgsFromCommandAndUndo(&fetchedArgs, mode, currentNode);\n+    bool fetchedFromCommand = false;\n+\n+    if (!forceReset) {\n+        fetchedFromCommand = tryFetchArgsFromCommandAndUndo(&fetchedArgs, mode, currentNode);\n+    }\n \n     if (m_optionsWidget) {\n         m_workRecursively = m_optionsWidget->workRecursively() ||\n@@ -896,10 +900,10 @@ void KisToolTransform::startStroke(ToolTransformArgs::TransformMode mode)\n     initThumbnailImage(previewDevice);\n     updateSelectionPath();\n \n-    if (fetchedFromCommand) {\n+    if (!forceReset && fetchedFromCommand) {\n         m_currentArgs = fetchedArgs;\n         initGuiAfterTransformMode();\n-    } else if (!tryInitTransformModeFromNode(currentNode)) {\n+    } else if (forceReset || !tryInitTransformModeFromNode(currentNode)) {\n         initTransformMode(mode);\n     }\n \n@@ -1104,7 +1108,7 @@ void KisToolTransform::slotResetTransform()\n         } else {\n             cancelStroke();\n             image()->waitForDone();\n-            startStroke(savedMode);\n+            startStroke(savedMode, true);\n \n             KIS_ASSERT_RECOVER_NOOP(!m_currentArgs.continuedTransform());\n         }\n@@ -1121,7 +1125,7 @@ void KisToolTransform::slotRestartTransform()\n     ToolTransformArgs savedArgs(m_currentArgs);\n     cancelStroke();\n     image()->waitForDone();\n-    startStroke(savedArgs.mode());\n+    startStroke(savedArgs.mode(), true);\n }\n \n void KisToolTransform::slotEditingFinished()"}, {"sha": "7891b07d82efafb012f237cfe9a9d750d803092d", "filename": "plugins/tools/tool_transform2/kis_tool_transform.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/695cc85ebc95f0c1e40024105172016e37148c6f/plugins/tools/tool_transform2/kis_tool_transform.h", "raw_url": "https://github.com/KDE/krita/raw/695cc85ebc95f0c1e40024105172016e37148c6f/plugins/tools/tool_transform2/kis_tool_transform.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/tools/tool_transform2/kis_tool_transform.h?ref=695cc85ebc95f0c1e40024105172016e37148c6f", "patch": "@@ -213,7 +213,7 @@ public Q_SLOTS:\n     bool clearDevices(KisNodeSP node, bool recursive);\n     void transformDevices(KisNodeSP node, bool recursive);\n \n-    void startStroke(ToolTransformArgs::TransformMode mode);\n+    void startStroke(ToolTransformArgs::TransformMode mode, bool forceReset);\n     void endStroke();\n     void cancelStroke();\n "}]}, {"sha": "caeff5a4dc1e16e2e5cb1c664372018ea3f7dd73", "stats": {"total": 57, "additions": 38, "deletions": 19}, "files": [{"sha": "0a98f0f3f59358704b39b8ecbef098266ec88b6c", "filename": "libs/image/kis_safe_transform.cpp", "status": "modified", "additions": 38, "deletions": 17, "changes": 55, "blob_url": "https://github.com/KDE/krita/blob/caeff5a4dc1e16e2e5cb1c664372018ea3f7dd73/libs/image/kis_safe_transform.cpp", "raw_url": "https://github.com/KDE/krita/raw/caeff5a4dc1e16e2e5cb1c664372018ea3f7dd73/libs/image/kis_safe_transform.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_safe_transform.cpp?ref=caeff5a4dc1e16e2e5cb1c664372018ea3f7dd73", "patch": "@@ -30,6 +30,8 @@\n \n struct Q_DECL_HIDDEN KisSafeTransform::Private\n {\n+    bool needsClipping = true;\n+\n     QRect bounds;\n     QTransform forwardTransform;\n     QTransform backwardTransform;\n@@ -133,23 +135,26 @@ KisSafeTransform::KisSafeTransform(const QTransform &transform,\n     m_d->forwardTransform = transform;\n     m_d->backwardTransform = transform.inverted();\n \n-    m_d->srcClipPolygon = QPolygonF(QRectF(m_d->bounds));\n-    m_d->dstClipPolygon = QPolygonF(QRectF(m_d->bounds));\n+    m_d->needsClipping = transform.type() > QTransform::TxShear;\n \n-    qreal crossCoeff = 1.0;\n+    if (m_d->needsClipping) {\n+        m_d->srcClipPolygon = QPolygonF(QRectF(m_d->bounds));\n+        m_d->dstClipPolygon = QPolygonF(QRectF(m_d->bounds));\n \n-    QLineF srcHorizon;\n-    if (m_d->getHorizon(m_d->backwardTransform, &srcHorizon)) {\n-        crossCoeff = m_d->getCrossSign(srcHorizon, srcInterestRect);\n-        m_d->srcClipPolygon = m_d->getCroppedPolygon(srcHorizon, m_d->bounds, crossCoeff);\n-    }\n+        qreal crossCoeff = 1.0;\n \n-    QLineF dstHorizon;\n-    if (m_d->getHorizon(m_d->forwardTransform, &dstHorizon)) {\n-        crossCoeff = m_d->getCrossSign(dstHorizon, mapRectForward(srcInterestRect));\n-        m_d->dstClipPolygon = m_d->getCroppedPolygon(dstHorizon, m_d->bounds, crossCoeff);\n-    }\n+        QLineF srcHorizon;\n+        if (m_d->getHorizon(m_d->backwardTransform, &srcHorizon)) {\n+            crossCoeff = m_d->getCrossSign(srcHorizon, srcInterestRect);\n+            m_d->srcClipPolygon = m_d->getCroppedPolygon(srcHorizon, m_d->bounds, crossCoeff);\n+        }\n \n+        QLineF dstHorizon;\n+        if (m_d->getHorizon(m_d->forwardTransform, &dstHorizon)) {\n+            crossCoeff = m_d->getCrossSign(dstHorizon, mapRectForward(srcInterestRect));\n+            m_d->dstClipPolygon = m_d->getCroppedPolygon(dstHorizon, m_d->bounds, crossCoeff);\n+        }\n+    }\n }\n \n KisSafeTransform::~KisSafeTransform()\n@@ -168,14 +173,30 @@ QPolygonF KisSafeTransform::dstClipPolygon() const\n \n QPolygonF KisSafeTransform::mapForward(const QPolygonF &p)\n {\n-    QPolygonF poly = m_d->srcClipPolygon.intersected(p);\n-    return m_d->forwardTransform.map(poly).intersected(QRectF(m_d->bounds));\n+    QPolygonF poly;\n+\n+    if (!m_d->needsClipping) {\n+        poly = m_d->forwardTransform.map(p);\n+    } else {\n+        poly = m_d->srcClipPolygon.intersected(p);\n+        poly = m_d->forwardTransform.map(poly).intersected(QRectF(m_d->bounds));\n+    }\n+\n+    return poly;\n }\n \n QPolygonF KisSafeTransform::mapBackward(const QPolygonF &p)\n {\n-    QPolygonF poly = m_d->dstClipPolygon.intersected(p);\n-    return m_d->backwardTransform.map(poly).intersected(QRectF(m_d->bounds));\n+    QPolygonF poly;\n+\n+    if (!m_d->needsClipping) {\n+        poly = m_d->backwardTransform.map(p);\n+    } else {\n+        poly = m_d->dstClipPolygon.intersected(p);\n+        poly = m_d->backwardTransform.map(poly).intersected(QRectF(m_d->bounds));\n+    }\n+\n+    return poly;\n }\n \n QRectF KisSafeTransform::mapRectForward(const QRectF &rc)"}, {"sha": "6635d9a28b1f6339fc0b197838a6c61c4c791cb4", "filename": "libs/ui/kis_file_layer.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/caeff5a4dc1e16e2e5cb1c664372018ea3f7dd73/libs/ui/kis_file_layer.cpp", "raw_url": "https://github.com/KDE/krita/raw/caeff5a4dc1e16e2e5cb1c664372018ea3f7dd73/libs/ui/kis_file_layer.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/kis_file_layer.cpp?ref=caeff5a4dc1e16e2e5cb1c664372018ea3f7dd73", "patch": "@@ -172,8 +172,6 @@ KisNodeSP KisFileLayer::clone() const\n \n bool KisFileLayer::allowAsChild(KisNodeSP node) const\n {\n-    // Transform masks and file layers don't work together yet\n-    if (node->inherits(\"KisTransformMask\")) return false;\n     return node->inherits(\"KisMask\");\n }\n "}]}, {"sha": "5c286b952cead3aa4188380b470a1c727c206286", "stats": {"total": 3, "additions": 1, "deletions": 2}, "files": [{"sha": "fd117fe3e2a48ee21a6c003b1cc3c549c325927c", "filename": "libs/ui/KisMainWindow.cpp", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/5c286b952cead3aa4188380b470a1c727c206286/libs/ui/KisMainWindow.cpp", "raw_url": "https://github.com/KDE/krita/raw/5c286b952cead3aa4188380b470a1c727c206286/libs/ui/KisMainWindow.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisMainWindow.cpp?ref=5c286b952cead3aa4188380b470a1c727c206286", "patch": "@@ -2134,8 +2134,7 @@ void KisMainWindow::configChanged()\n void KisMainWindow::newView(QObject *document)\n {\n     KisDocument *doc = qobject_cast<KisDocument*>(document);\n-    KisView *view = KisPart::instance()->createView(doc, resourceManager(), actionCollection(), this);\n-    addView(view);\n+    addViewAndNotifyLoadingCompleted(doc);\n     d->actionManager()->updateGUI();\n }\n "}]}, {"sha": "69f357b87955e6f74c9c7caea6d380fb9534016f", "stats": {"total": 1, "additions": 0, "deletions": 1}, "files": [{"sha": "49680ecb6f8b28f1bbc1859659b7e4a2a2166862", "filename": "libs/ui/KisMainWindow.cpp", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/69f357b87955e6f74c9c7caea6d380fb9534016f/libs/ui/KisMainWindow.cpp", "raw_url": "https://github.com/KDE/krita/raw/69f357b87955e6f74c9c7caea6d380fb9534016f/libs/ui/KisMainWindow.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisMainWindow.cpp?ref=69f357b87955e6f74c9c7caea6d380fb9534016f", "patch": "@@ -452,7 +452,6 @@ KisMainWindow::KisMainWindow()\n \n     // If we have customized the toolbars, load that first\n     setLocalXMLFile(KoResourcePaths::locateLocal(\"data\", \"krita.xmlgui\"));\n-    QString doc;\n     setXMLFile(\":/kxmlgui5/krita.xmlgui\");\n \n     guiFactory()->addClient(this);"}]}, {"sha": "4308f313c9240712c2feb05694ab9d57b7f2be1a", "stats": {"total": 5, "additions": 2, "deletions": 3}, "files": [{"sha": "48dfd02e5ce0c52221493ff8dcb564a139aef09e", "filename": "libs/ui/KisMainWindow.cpp", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/4308f313c9240712c2feb05694ab9d57b7f2be1a/libs/ui/KisMainWindow.cpp", "raw_url": "https://github.com/KDE/krita/raw/4308f313c9240712c2feb05694ab9d57b7f2be1a/libs/ui/KisMainWindow.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisMainWindow.cpp?ref=4308f313c9240712c2feb05694ab9d57b7f2be1a", "patch": "@@ -452,9 +452,8 @@ KisMainWindow::KisMainWindow()\n \n     // If we have customized the toolbars, load that first\n     setLocalXMLFile(KoResourcePaths::locateLocal(\"data\", \"krita.xmlgui\"));\n-    QFile doc(\":/kxmlgui5/krita.xmlgui\");\n-    doc.open(QFile::ReadOnly);\n-    setXML(doc.readAll());\n+    QString doc;\n+    setXMLFile(\":/kxmlgui5/krita.xmlgui\");\n \n     guiFactory()->addClient(this);\n "}]}, {"sha": "358450ea5cb017a9094ae549ce30d6845c2a3297", "stats": {"total": 11, "additions": 10, "deletions": 1}, "files": [{"sha": "bb5153bdb1b1dba47f1495c41cbd0eab3d38a683", "filename": "libs/pigment/compositeops/KoVcMultiArchBuildSupport.h", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/358450ea5cb017a9094ae549ce30d6845c2a3297/libs/pigment/compositeops/KoVcMultiArchBuildSupport.h", "raw_url": "https://github.com/KDE/krita/raw/358450ea5cb017a9094ae549ce30d6845c2a3297/libs/pigment/compositeops/KoVcMultiArchBuildSupport.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/compositeops/KoVcMultiArchBuildSupport.h?ref=358450ea5cb017a9094ae549ce30d6845c2a3297", "patch": "@@ -45,7 +45,16 @@\n #else /* HAVE_VC */\n \n namespace Vc {\n-    typedef enum {ScalarImpl} CurrentImplementation;\n+    enum Implementation /*: std::uint_least32_t*/ {\n+            ScalarImpl,\n+    };\n+    class CurrentImplementation {\n+        public:\n+            static constexpr Implementation current()\n+            {\n+                return static_cast<Implementation>(ScalarImpl);\n+            }\n+    };\n }\n \n #ifdef DO_PACKAGERS_BUILD"}]}, {"sha": "dc73d61d163d0f98b6fb13f80a58c6ba0e7d1eda", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "200d138eb3ae570481eeaa17f489ce49242633a3", "filename": "CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/dc73d61d163d0f98b6fb13f80a58c6ba0e7d1eda/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/dc73d61d163d0f98b6fb13f80a58c6ba0e7d1eda/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=dc73d61d163d0f98b6fb13f80a58c6ba0e7d1eda", "patch": "@@ -489,8 +489,8 @@ if( NOT MSVC)\n     macro_log_feature(Vc_FOUND \"Vc\" \"Portable, zero-overhead SIMD library for C++\" \"https://github.com/VcDevel/Vc\" FALSE \"\" \"Required by the Krita for vectorization\")\n     macro_bool_to_01(Vc_FOUND HAVE_VC)\n     macro_bool_to_01(PACKAGERS_BUILD DO_PACKAGERS_BUILD)\n-    configure_file(config-vc.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config-vc.h )\n endif()\n+configure_file(config-vc.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config-vc.h )\n \n if(HAVE_VC)\n     message(STATUS \"Vc found!\")"}]}, {"sha": "9b5199d7637c4561f02d26279961c189480158dc", "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "b6d3c7413bfe3ebb24772ad0aeb92d9b6edd9f40", "filename": "CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/9b5199d7637c4561f02d26279961c189480158dc/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/9b5199d7637c4561f02d26279961c189480158dc/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=9b5199d7637c4561f02d26279961c189480158dc", "patch": "@@ -481,10 +481,10 @@ endif()\n ##\n ## Test for Vc\n ##\n+set(OLD_CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} )\n+set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake/modules )\n set(HAVE_VC FALSE)\n if( NOT MSVC)\n-    set(OLD_CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} )\n-    set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake/modules )\n     macro_optional_find_package(Vc 1.0.0)\n     macro_log_feature(Vc_FOUND \"Vc\" \"Portable, zero-overhead SIMD library for C++\" \"https://github.com/VcDevel/Vc\" FALSE \"\" \"Required by the Krita for vectorization\")\n     macro_bool_to_01(Vc_FOUND HAVE_VC)"}]}, {"sha": "69fb1a1c8f10594e5583c0d0a81670b8809dd862", "stats": {"total": 18, "additions": 10, "deletions": 8}, "files": [{"sha": "28c5c025807c82ef35bce7b73ac7350cb15f2dc4", "filename": "CMakeLists.txt", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/KDE/krita/blob/69fb1a1c8f10594e5583c0d0a81670b8809dd862/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/69fb1a1c8f10594e5583c0d0a81670b8809dd862/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=69fb1a1c8f10594e5583c0d0a81670b8809dd862", "patch": "@@ -481,14 +481,16 @@ endif()\n ##\n ## Test for Vc\n ##\n-set(OLD_CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} )\n-set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake/modules )\n-macro_optional_find_package(Vc 1.0.0)\n-macro_log_feature(Vc_FOUND \"Vc\" \"Portable, zero-overhead SIMD library for C++\" \"https://github.com/VcDevel/Vc\" FALSE \"\" \"Required by the Krita for vectorization\")\n-macro_bool_to_01(Vc_FOUND HAVE_VC)\n-macro_bool_to_01(PACKAGERS_BUILD DO_PACKAGERS_BUILD)\n-\n-configure_file(config-vc.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config-vc.h )\n+set(HAVE_VC FALSE)\n+if( NOT MSVC)\n+    set(OLD_CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} )\n+    set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake/modules )\n+    macro_optional_find_package(Vc 1.0.0)\n+    macro_log_feature(Vc_FOUND \"Vc\" \"Portable, zero-overhead SIMD library for C++\" \"https://github.com/VcDevel/Vc\" FALSE \"\" \"Required by the Krita for vectorization\")\n+    macro_bool_to_01(Vc_FOUND HAVE_VC)\n+    macro_bool_to_01(PACKAGERS_BUILD DO_PACKAGERS_BUILD)\n+    configure_file(config-vc.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config-vc.h )\n+endif()\n \n if(HAVE_VC)\n     message(STATUS \"Vc found!\")"}]}, {"sha": "b5dc9f0b5e6dbc5f02e62a8bf76bb56942168176", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "999fe460030d3c60c8a480ff72ea6be0bd64a651", "filename": "libs/pigment/compositeops/KoStreamedMath.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/b5dc9f0b5e6dbc5f02e62a8bf76bb56942168176/libs/pigment/compositeops/KoStreamedMath.h", "raw_url": "https://github.com/KDE/krita/raw/b5dc9f0b5e6dbc5f02e62a8bf76bb56942168176/libs/pigment/compositeops/KoStreamedMath.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/compositeops/KoStreamedMath.h?ref=b5dc9f0b5e6dbc5f02e62a8bf76bb56942168176", "patch": "@@ -232,7 +232,7 @@ template<bool useMask, bool useFlow, class Compositor, int pixelSize>\n     if (!params.srcRowStride) {\n         if (pixelSize == 4) {\n             quint32 *buf = Vc::malloc<quint32, Vc::AlignOnVector>(vectorSize);\n-            *((Vc::uint_v*)buf) = Vc::uint_v(*((const quint32*)params.srcRowStart));\n+            *((uint_v*)buf) = uint_v(*((const quint32*)params.srcRowStart));\n             srcRowStart = reinterpret_cast<quint8*>(buf);\n             srcLinearInc = 0;\n             srcVectorInc = 0;"}]}, {"sha": "2b3d1401541847552e869404fe4970f276d0ab4c", "stats": {"total": 42, "additions": 21, "deletions": 21}, "files": [{"sha": "3925ee1d25dfe88ea654566c6cc7235be3bd2c03", "filename": "benchmarks/kis_composition_benchmark.cpp", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/KDE/krita/blob/2b3d1401541847552e869404fe4970f276d0ab4c/benchmarks/kis_composition_benchmark.cpp", "raw_url": "https://github.com/KDE/krita/raw/2b3d1401541847552e869404fe4970f276d0ab4c/benchmarks/kis_composition_benchmark.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/benchmarks/kis_composition_benchmark.cpp?ref=2b3d1401541847552e869404fe4970f276d0ab4c", "patch": "@@ -227,7 +227,7 @@ QVector<Tile> generateTiles(int size,\n     QVector<Tile> tiles(size);\n \n #ifdef HAVE_VC\n-    const int vecSize = Vc::float_v::Size;\n+    const int vecSize = Vc::float_v::size();\n #else\n     const int vecSize = 1;\n #endif\n@@ -472,7 +472,7 @@ void checkRounding(qreal opacity, qreal flow, qreal averageOpacity = -1, quint32\n     QVector<Tile> tiles =\n         generateTiles(2, 0, 0, ALPHA_RANDOM, ALPHA_RANDOM, pixelSize);\n \n-    const int vecSize = Vc::float_v::Size;\n+    const int vecSize = Vc::float_v::size();\n \n     const int numBlocks = numPixels / vecSize;\n \n@@ -810,7 +810,7 @@ void KisCompositionBenchmark::benchmarkMemcpy()\n }\n \n #ifdef HAVE_VC\n-    const int vecSize = Vc::float_v::Size;\n+    const int vecSize = Vc::float_v::size();\n     const size_t uint8VecAlignment = qMax(vecSize * sizeof(quint8), sizeof(void*));\n     const size_t uint32VecAlignment = qMax(vecSize * sizeof(quint32), sizeof(void*));\n     const size_t floatVecAlignment = qMax(vecSize * sizeof(float), sizeof(void*));\n@@ -835,7 +835,7 @@ void KisCompositionBenchmark::benchmarkUintFloat()\n     float *fData = (float*)ptr;\n \n     QBENCHMARK {\n-        for (int i = 0; i < dataSize; i += Vc::float_v::Size) {\n+        for (int i = 0; i < dataSize; i += Vc::float_v::size()) {\n             // convert uint -> float directly, this causes\n             // static_cast helper be called\n             Vc::float_v b(uint_v(iData + i));\n@@ -868,7 +868,7 @@ void KisCompositionBenchmark::benchmarkUintIntFloat()\n     float *fData = (float*)ptr;\n \n     QBENCHMARK {\n-        for (int i = 0; i < dataSize; i += Vc::float_v::Size) {\n+        for (int i = 0; i < dataSize; i += Vc::float_v::size()) {\n             // convert uint->int->float, that avoids special sign\n             // treating, and gives 2.6 times speedup\n             Vc::float_v b(int_v(uint_v(iData + i)));\n@@ -900,7 +900,7 @@ void KisCompositionBenchmark::benchmarkFloatUint()\n     float *fData = (float*)ptr;\n \n     QBENCHMARK {\n-        for (int i = 0; i < dataSize; i += Vc::float_v::Size) {\n+        for (int i = 0; i < dataSize; i += Vc::float_v::size()) {\n             // conversion float -> uint\n             uint_v b(Vc::float_v(fData + i));\n \n@@ -933,7 +933,7 @@ void KisCompositionBenchmark::benchmarkFloatIntUint()\n     float *fData = (float*)ptr;\n \n     QBENCHMARK {\n-        for (int i = 0; i < dataSize; i += Vc::float_v::Size) {\n+        for (int i = 0; i < dataSize; i += Vc::float_v::size()) {\n             // conversion float -> int -> uint\n             uint_v b(int_v(Vc::float_v(fData + i)));\n "}, {"sha": "3306d6cc454bd55e66516e34e9b2787e8ffad6e8", "filename": "libs/image/kis_brush_mask_applicator_factories.cpp", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/2b3d1401541847552e869404fe4970f276d0ab4c/libs/image/kis_brush_mask_applicator_factories.cpp", "raw_url": "https://github.com/KDE/krita/raw/2b3d1401541847552e869404fe4970f276d0ab4c/libs/image/kis_brush_mask_applicator_factories.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_brush_mask_applicator_factories.cpp?ref=2b3d1401541847552e869404fe4970f276d0ab4c", "patch": "@@ -71,7 +71,7 @@ FastRowProcessor::process<Vc::CurrentImplementation::current()>(float* buffer, i\n \n     Vc::float_v currentIndices = Vc::float_v::IndexesFromZero();\n \n-    Vc::float_v increment((float)Vc::float_v::Size);\n+    Vc::float_v increment((float)Vc::float_v::size());\n     Vc::float_v vCenterX(centerX);\n \n     Vc::float_v vCosa(cosa);\n@@ -87,7 +87,7 @@ FastRowProcessor::process<Vc::CurrentImplementation::current()>(float* buffer, i\n \n     Vc::float_v vOne(Vc::One);\n \n-    for (int i=0; i < width; i+= Vc::float_v::Size){\n+    for (int i=0; i < width; i+= Vc::float_v::size()){\n \n         Vc::float_v x_ = currentIndices - vCenterX;\n \n@@ -130,7 +130,7 @@ FastRowProcessor::process<Vc::CurrentImplementation::current()>(float* buffer, i\n \n         currentIndices = currentIndices + increment;\n \n-        bufferPointer += Vc::float_v::Size;\n+        bufferPointer += Vc::float_v::size();\n     }\n }\n "}, {"sha": "55a0c76b693bc00e8e64d896bf51cf028e6c2474", "filename": "libs/image/kis_brush_mask_applicators.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/2b3d1401541847552e869404fe4970f276d0ab4c/libs/image/kis_brush_mask_applicators.h", "raw_url": "https://github.com/KDE/krita/raw/2b3d1401541847552e869404fe4970f276d0ab4c/libs/image/kis_brush_mask_applicators.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_brush_mask_applicators.h?ref=2b3d1401541847552e869404fe4970f276d0ab4c", "patch": "@@ -110,8 +110,8 @@ void KisBrushMaskVectorApplicator<MaskGenerator, _impl>::processVector(const QRe\n \n     // We need to calculate with a multiple of the width of the simd register\n     int alignOffset = 0;\n-    if (width % Vc::float_v::Size != 0) {\n-        alignOffset = Vc::float_v::Size - (width % Vc::float_v::Size);\n+    if (width % Vc::float_v::size() != 0) {\n+        alignOffset = Vc::float_v::size() - (width % Vc::float_v::size());\n     }\n     int simdWidth = width + alignOffset;\n "}, {"sha": "87e3aacdd733b979d87388073f3bfc1c303a4f1c", "filename": "libs/pigment/compositeops/KoOptimizedCompositeOpAlphaDarken128.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/2b3d1401541847552e869404fe4970f276d0ab4c/libs/pigment/compositeops/KoOptimizedCompositeOpAlphaDarken128.h", "raw_url": "https://github.com/KDE/krita/raw/2b3d1401541847552e869404fe4970f276d0ab4c/libs/pigment/compositeops/KoOptimizedCompositeOpAlphaDarken128.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/compositeops/KoOptimizedCompositeOpAlphaDarken128.h?ref=2b3d1401541847552e869404fe4970f276d0ab4c", "patch": "@@ -47,7 +47,7 @@ struct AlphaDarkenCompositor128 {\n \n     /**\n      * This is a vector equivalent of compositeOnePixelScalar(). It is considered\n-     * to process Vc::float_v::Size pixels in a single pass.\n+     * to process Vc::float_v::size() pixels in a single pass.\n      *\n      * o the \\p haveMask parameter points whether the real (non-null) mask\n      *   pointer is passed to the function."}, {"sha": "e8f7b5a23f5b9ec26e2b3ad8272d30c072dc5b39", "filename": "libs/pigment/compositeops/KoOptimizedCompositeOpAlphaDarken32.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/2b3d1401541847552e869404fe4970f276d0ab4c/libs/pigment/compositeops/KoOptimizedCompositeOpAlphaDarken32.h", "raw_url": "https://github.com/KDE/krita/raw/2b3d1401541847552e869404fe4970f276d0ab4c/libs/pigment/compositeops/KoOptimizedCompositeOpAlphaDarken32.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/compositeops/KoOptimizedCompositeOpAlphaDarken32.h?ref=2b3d1401541847552e869404fe4970f276d0ab4c", "patch": "@@ -42,7 +42,7 @@ struct AlphaDarkenCompositor32 {\n \n     /**\n      * This is a vector equivalent of compositeOnePixelScalar(). It is considered\n-     * to process Vc::float_v::Size pixels in a single pass.\n+     * to process Vc::float_v::size() pixels in a single pass.\n      *\n      * o the \\p haveMask parameter points whether the real (non-null) mask\n      *   pointer is passed to the function.\n@@ -111,7 +111,7 @@ struct AlphaDarkenCompositor32 {\n         } else if (srcAlphaIsUnit) {\n             bool dstAlphaIsUnit = (dst_alpha == uint8Max).isFull();\n             if (dstAlphaIsUnit) {\n-                memcpy(dst, src, 4 * Vc::float_v::Size);\n+                memcpy(dst, src, 4 * Vc::float_v::size());\n                 return;\n             } else {\n                 dst_c1 = src_c1;"}, {"sha": "e6f958a2cc02819360740b91cc117e24d6c3f91f", "filename": "libs/pigment/compositeops/KoOptimizedCompositeOpOver32.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/2b3d1401541847552e869404fe4970f276d0ab4c/libs/pigment/compositeops/KoOptimizedCompositeOpOver32.h", "raw_url": "https://github.com/KDE/krita/raw/2b3d1401541847552e869404fe4970f276d0ab4c/libs/pigment/compositeops/KoOptimizedCompositeOpOver32.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/compositeops/KoOptimizedCompositeOpOver32.h?ref=2b3d1401541847552e869404fe4970f276d0ab4c", "patch": "@@ -109,7 +109,7 @@ struct OverCompositor32 {\n \n         } else {\n             if (!haveMask && !haveOpacity) {\n-                memcpy(dst, src, 4 * Vc::float_v::Size);\n+                memcpy(dst, src, 4 * Vc::float_v::size());\n                 return;\n             } else {\n                 // opacity has changed the alpha of the source,"}, {"sha": "f77bcec842ea202f78e6d2fe8011d533859f1fb0", "filename": "libs/pigment/compositeops/KoStreamedMath.h", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/KDE/krita/blob/2b3d1401541847552e869404fe4970f276d0ab4c/libs/pigment/compositeops/KoStreamedMath.h", "raw_url": "https://github.com/KDE/krita/raw/2b3d1401541847552e869404fe4970f276d0ab4c/libs/pigment/compositeops/KoStreamedMath.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/compositeops/KoStreamedMath.h?ref=2b3d1401541847552e869404fe4970f276d0ab4c", "patch": "@@ -111,7 +111,7 @@ static inline quint8 lerp_mixed_u8_float(quint8 a, quint8 b, float alpha) {\n }\n \n /**\n- * Get a vector containing first Vc::float_v::Size values of mask.\n+ * Get a vector containing first Vc::float_v::size() values of mask.\n  * Each source mask element is considered to be a 8-bit integer\n  */\n static inline Vc::float_v fetch_mask_8(const quint8 *data) {\n@@ -120,7 +120,7 @@ static inline Vc::float_v fetch_mask_8(const quint8 *data) {\n }\n \n /**\n- * Get an alpha values from Vc::float_v::Size pixels 32-bit each\n+ * Get an alpha values from Vc::float_v::size() pixels 32-bit each\n  * (4 channels, 8 bit per channel).  The alpha value is considered\n  * to be stored in the most significat byte of the pixel\n  *\n@@ -144,7 +144,7 @@ static inline Vc::float_v fetch_alpha_32(const quint8 *data) {\n }\n \n /**\n- * Get color values from Vc::float_v::Size pixels 32-bit each\n+ * Get color values from Vc::float_v::size() pixels 32-bit each\n  * (4 channels, 8 bit per channel).  The color data is considered\n  * to be stored in the 3 least significant bytes of the pixel.\n  *\n@@ -176,7 +176,7 @@ static inline void fetch_colors_32(const quint8 *data,\n }\n \n /**\n- * Pack color and alpha values to Vc::float_v::Size pixels 32-bit each\n+ * Pack color and alpha values to Vc::float_v::size() pixels 32-bit each\n  * (4 channels, 8 bit per channel).  The color data is considered\n  * to be stored in the 3 least significant bytes of the pixel, alpha -\n  * in the most significant byte\n@@ -218,7 +218,7 @@ template<bool useMask, bool useFlow, class Compositor, int pixelSize>\n {\n     using namespace Arithmetic;\n \n-    const int vectorSize = Vc::float_v::Size;\n+    const int vectorSize = Vc::float_v::size();\n     const qint32 vectorInc = pixelSize * vectorSize;\n     const qint32 linearInc = pixelSize;\n     qint32 srcVectorInc = vectorInc;"}]}, {"sha": "f99de4bc0e628bbb03494a9fb08304b9d6388dba", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "07b2d32761a3d7651ad6869b8e8a3a5c3064ea6f", "filename": "libs/pigment/compositeops/KoStreamedMath.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/f99de4bc0e628bbb03494a9fb08304b9d6388dba/libs/pigment/compositeops/KoStreamedMath.h", "raw_url": "https://github.com/KDE/krita/raw/f99de4bc0e628bbb03494a9fb08304b9d6388dba/libs/pigment/compositeops/KoStreamedMath.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/compositeops/KoStreamedMath.h?ref=f99de4bc0e628bbb03494a9fb08304b9d6388dba", "patch": "@@ -205,7 +205,7 @@ static inline void write_channels_32(quint8 *data,\n     uint_v v4 = uint_v(int_v(Vc::round(c3))) & mask;\n     v1 = v1 | v2;\n     v3 = v3 | v4;\n-    *((uint_v*)data) = v1 | v3;\n+    (v1 | v3).store((quint32*)data, Vc::Aligned);\n }\n \n /**"}]}, {"sha": "2c8a5d054c7a09f4c1ebbd58c0f61f318eb2b3ac", "stats": {"total": 66, "additions": 43, "deletions": 23}, "files": [{"sha": "da3709a01e61c7e17bcd6e4c956151266fb24482", "filename": "benchmarks/kis_mask_generator_benchmark.cpp", "status": "modified", "additions": 14, "deletions": 7, "changes": 21, "blob_url": "https://github.com/KDE/krita/blob/2c8a5d054c7a09f4c1ebbd58c0f61f318eb2b3ac/benchmarks/kis_mask_generator_benchmark.cpp", "raw_url": "https://github.com/KDE/krita/raw/2c8a5d054c7a09f4c1ebbd58c0f61f318eb2b3ac/benchmarks/kis_mask_generator_benchmark.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/benchmarks/kis_mask_generator_benchmark.cpp?ref=2c8a5d054c7a09f4c1ebbd58c0f61f318eb2b3ac", "patch": "@@ -60,19 +60,17 @@ void KisMaskGeneratorBenchmark::benchmarkCircle()\n #include \"krita_utils.h\"\n \n \n-void KisMaskGeneratorBenchmark::benchmarkSIMD()\n-{\n-#ifdef HAVE_VC\n+void benchmarkSIMD(qreal fade) {\n     const KoColorSpace * cs = KoColorSpaceRegistry::instance()->rgb8();\n     KisFixedPaintDeviceSP dev = new KisFixedPaintDevice(cs);\n-    dev->setRect(QRect(0, 0, 100, 100));\n+    dev->setRect(QRect(0, 0, 1000, 1000));\n     dev->initialize();\n \n     MaskProcessingData data(dev, cs,\n                             0.0, 1.0,\n-                            50, 50, 0);\n+                            500, 500, 0);\n \n-    KisCircleMaskGenerator gen(100, 0.5, 0.5, 0.5, 2, false);\n+    KisCircleMaskGenerator gen(1000, 1.0, fade, fade, 2, false);\n \n     KisBrushMaskApplicatorBase *applicator = gen.applicator();\n     applicator->initializeData(&data);\n@@ -84,7 +82,16 @@ void KisMaskGeneratorBenchmark::benchmarkSIMD()\n             applicator->process(rc);\n         }\n     }\n-#endif\n+}\n+\n+void KisMaskGeneratorBenchmark::benchmarkSIMD_SharpBrush()\n+{\n+    benchmarkSIMD(1.0);\n+}\n+\n+void KisMaskGeneratorBenchmark::benchmarkSIMD_FadedBrush()\n+{\n+    benchmarkSIMD(0.5);\n }\n \n void KisMaskGeneratorBenchmark::benchmarkSquare()"}, {"sha": "a70bfe5dc36621ab460fe8069ad0991c431fc9e2", "filename": "benchmarks/kis_mask_generator_benchmark.h", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/2c8a5d054c7a09f4c1ebbd58c0f61f318eb2b3ac/benchmarks/kis_mask_generator_benchmark.h", "raw_url": "https://github.com/KDE/krita/raw/2c8a5d054c7a09f4c1ebbd58c0f61f318eb2b3ac/benchmarks/kis_mask_generator_benchmark.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/benchmarks/kis_mask_generator_benchmark.h?ref=2c8a5d054c7a09f4c1ebbd58c0f61f318eb2b3ac", "patch": "@@ -26,9 +26,10 @@ class KisMaskGeneratorBenchmark : public QObject\n     Q_OBJECT\n private Q_SLOTS:\n     void benchmarkCircle();\n-    void benchmarkSIMD();\n+    void benchmarkSIMD_SharpBrush();\n+    void benchmarkSIMD_FadedBrush();\n     void benchmarkSquare();\n-    \n+\n };\n \n #endif"}, {"sha": "e9f7f66519f398fe9ada317d7c62b251d81cd18d", "filename": "libs/image/kis_brush_mask_applicator_factories.cpp", "status": "modified", "additions": 21, "deletions": 14, "changes": 35, "blob_url": "https://github.com/KDE/krita/blob/2c8a5d054c7a09f4c1ebbd58c0f61f318eb2b3ac/libs/image/kis_brush_mask_applicator_factories.cpp", "raw_url": "https://github.com/KDE/krita/raw/2c8a5d054c7a09f4c1ebbd58c0f61f318eb2b3ac/libs/image/kis_brush_mask_applicator_factories.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_brush_mask_applicator_factories.cpp?ref=2c8a5d054c7a09f4c1ebbd58c0f61f318eb2b3ac", "patch": "@@ -61,6 +61,7 @@ FastRowProcessor::process<Vc::CurrentImplementation::current()>(float* buffer, i\n                                    float centerX, float centerY)\n {\n     const bool useSmoothing = d->copyOfAntialiasEdges;\n+    const bool noFading = d->noFading;\n \n     float y_ = y - centerY;\n     float sinay_ = sina * y_;\n@@ -84,7 +85,7 @@ FastRowProcessor::process<Vc::CurrentImplementation::current()>(float* buffer, i\n     Vc::float_v vTransformedFadeX(d->transformedFadeX);\n     Vc::float_v vTransformedFadeY(d->transformedFadeY);\n \n-    Vc::float_v vOne(1.0f);\n+    Vc::float_v vOne(Vc::One);\n \n     for (int i=0; i < width; i+= Vc::float_v::Size){\n \n@@ -98,24 +99,30 @@ FastRowProcessor::process<Vc::CurrentImplementation::current()>(float* buffer, i\n \n         if (!outsideMask.isFull()) {\n \n-            if (useSmoothing) {\n-                 xr = Vc::abs(xr) + vOne;\n-                 yr = Vc::abs(yr) + vOne;\n-            }\n+            if (noFading) {\n+                Vc::float_v vFade(Vc::Zero);\n+                vFade(outsideMask) = vOne;\n+                vFade.store(bufferPointer, Vc::Aligned);\n+            } else {\n+                if (useSmoothing) {\n+                    xr = Vc::abs(xr) + vOne;\n+                    yr = Vc::abs(yr) + vOne;\n+                }\n \n-            Vc::float_v vNormFade = pow2(xr * vTransformedFadeX) + pow2(yr * vTransformedFadeY);\n+                Vc::float_v vNormFade = pow2(xr * vTransformedFadeX) + pow2(yr * vTransformedFadeY);\n \n-            //255 * n * (normeFade - 1) / (normeFade - n)\n-            Vc::float_v vFade = n * (vNormFade - vOne) / (vNormFade - n);\n+                //255 * n * (normeFade - 1) / (normeFade - n)\n+                Vc::float_v vFade = n * (vNormFade - vOne) / (vNormFade - n);\n \n-            // Mask in the inner circe of the mask\n-            Vc::float_m mask = vNormFade < vOne;\n-            vFade.setZero(mask);\n+                // Mask in the inner circe of the mask\n+                Vc::float_m mask = vNormFade < vOne;\n+                vFade.setZero(mask);\n \n-            // Mask out the outer circe of the mask\n-            vFade(outsideMask) = vOne;\n+                // Mask out the outer circe of the mask\n+                vFade(outsideMask) = vOne;\n \n-            vFade.store(bufferPointer, Vc::Aligned);\n+                vFade.store(bufferPointer, Vc::Aligned);\n+            }\n         } else {\n             // Mask out everything outside the circle\n             vOne.store(bufferPointer, Vc::Aligned);"}, {"sha": "07f5fdc93581e4ce44eb0770dafd42402649b026", "filename": "libs/image/kis_circle_mask_generator.cpp", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/2c8a5d054c7a09f4c1ebbd58c0f61f318eb2b3ac/libs/image/kis_circle_mask_generator.cpp", "raw_url": "https://github.com/KDE/krita/raw/2c8a5d054c7a09f4c1ebbd58c0f61f318eb2b3ac/libs/image/kis_circle_mask_generator.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_circle_mask_generator.cpp?ref=2c8a5d054c7a09f4c1ebbd58c0f61f318eb2b3ac", "patch": "@@ -70,6 +70,10 @@ void KisCircleMaskGenerator::setScale(qreal scaleX, qreal scaleY)\n     d->yfadecoef = (verticalFade() == 0)   ? 1 : (2.0 / (verticalFade() * effectiveSrcHeight()));\n     d->transformedFadeX = KisMaskGenerator::softness() * d->xfadecoef;\n     d->transformedFadeY = KisMaskGenerator::softness() * d->yfadecoef;\n+\n+    d->noFading = !d->copyOfAntialiasEdges &&\n+        qFuzzyCompare(d->xcoef, d->transformedFadeX) &&\n+        qFuzzyCompare(d->ycoef, d->transformedFadeY);\n }\n \n KisCircleMaskGenerator::~KisCircleMaskGenerator()"}, {"sha": "7f7c330a923187a4d979218c68fabf5501918c93", "filename": "libs/image/kis_circle_mask_generator_p.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/2c8a5d054c7a09f4c1ebbd58c0f61f318eb2b3ac/libs/image/kis_circle_mask_generator_p.h", "raw_url": "https://github.com/KDE/krita/raw/2c8a5d054c7a09f4c1ebbd58c0f61f318eb2b3ac/libs/image/kis_circle_mask_generator_p.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_circle_mask_generator_p.h?ref=2c8a5d054c7a09f4c1ebbd58c0f61f318eb2b3ac", "patch": "@@ -24,6 +24,7 @@ struct Q_DECL_HIDDEN KisCircleMaskGenerator::Private {\n     double xfadecoef, yfadecoef;\n     double transformedFadeX, transformedFadeY;\n     bool copyOfAntialiasEdges;\n+    bool noFading;\n \n     KisBrushMaskApplicatorBase *applicator;\n };"}]}, {"sha": "0b4c3f9339d9ec7ff686f2ad437c1cf535f504ae", "stats": {"total": 67, "additions": 48, "deletions": 19}, "files": [{"sha": "dc88f64551ef45bb41084b7246e2f58daba374f1", "filename": "benchmarks/kis_mask_generator_benchmark.cpp", "status": "modified", "additions": 25, "deletions": 7, "changes": 32, "blob_url": "https://github.com/KDE/krita/blob/0b4c3f9339d9ec7ff686f2ad437c1cf535f504ae/benchmarks/kis_mask_generator_benchmark.cpp", "raw_url": "https://github.com/KDE/krita/raw/0b4c3f9339d9ec7ff686f2ad437c1cf535f504ae/benchmarks/kis_mask_generator_benchmark.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/benchmarks/kis_mask_generator_benchmark.cpp?ref=0b4c3f9339d9ec7ff686f2ad437c1cf535f504ae", "patch": "@@ -52,20 +52,38 @@ void KisMaskGeneratorBenchmark::benchmarkCircle()\n     }\n }\n \n+#include <KoColorSpace.h>\n+#include <KoColorSpaceRegistry.h>\n+#include \"kis_fixed_paint_device.h\"\n+#include \"kis_types.h\"\n+#include \"kis_brush_mask_applicator_base.h\"\n+#include \"krita_utils.h\"\n+\n+\n void KisMaskGeneratorBenchmark::benchmarkSIMD()\n {\n #ifdef HAVE_VC\n-    int width = 1000;\n-    float *buffer = Vc::malloc<float, Vc::AlignOnVector>(width);\n+    const KoColorSpace * cs = KoColorSpaceRegistry::instance()->rgb8();\n+    KisFixedPaintDeviceSP dev = new KisFixedPaintDevice(cs);\n+    dev->setRect(QRect(0, 0, 100, 100));\n+    dev->initialize();\n+\n+    MaskProcessingData data(dev, cs,\n+                            0.0, 1.0,\n+                            50, 50, 0);\n+\n+    KisCircleMaskGenerator gen(100, 0.5, 0.5, 0.5, 2, false);\n+\n+    KisBrushMaskApplicatorBase *applicator = gen.applicator();\n+    applicator->initializeData(&data);\n+\n+    QVector<QRect> rects = KritaUtils::splitRectIntoPatches(dev->bounds(), QSize(63, 63));\n \n-    KisCircleMaskGenerator gen(1000, 0.5, 0.5, 0.5, 2, true);\n     QBENCHMARK{\n-        for(int y = 0; y < 1000; ++y)\n-        {\n-//            gen.processRowFast(buffer, width, y, 0.0f, 1.0f, 500.0f, 500.0f, 0.5f, 0.5f);\n+        Q_FOREACH (const QRect &rc, rects) {\n+            applicator->process(rc);\n         }\n     }\n-    Vc::free(buffer);\n #endif\n }\n "}, {"sha": "fbfda538481486fdf20c4da46fd206ec05e4b236", "filename": "libs/image/kis_brush_mask_applicator_factories.cpp", "status": "modified", "additions": 23, "deletions": 12, "changes": 35, "blob_url": "https://github.com/KDE/krita/blob/0b4c3f9339d9ec7ff686f2ad437c1cf535f504ae/libs/image/kis_brush_mask_applicator_factories.cpp", "raw_url": "https://github.com/KDE/krita/raw/0b4c3f9339d9ec7ff686f2ad437c1cf535f504ae/libs/image/kis_brush_mask_applicator_factories.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_brush_mask_applicator_factories.cpp?ref=0b4c3f9339d9ec7ff686f2ad437c1cf535f504ae", "patch": "@@ -94,22 +94,33 @@ FastRowProcessor::process<Vc::CurrentImplementation::current()>(float* buffer, i\n         Vc::float_v yr = x_ * vSina + vCosaY_;\n \n         Vc::float_v n = pow2(xr * vXCoeff) + pow2(yr * vYCoeff);\n+        Vc::float_m outsideMask = n > vOne;\n \n-        if (useSmoothing) {\n-            xr = Vc::abs(xr) + vOne;\n-            yr = Vc::abs(yr) + vOne;\n-        }\n+        if (!outsideMask.isFull()) {\n+\n+            if (useSmoothing) {\n+                 xr = Vc::abs(xr) + vOne;\n+                 yr = Vc::abs(yr) + vOne;\n+            }\n+\n+            Vc::float_v vNormFade = pow2(xr * vTransformedFadeX) + pow2(yr * vTransformedFadeY);\n \n-        Vc::float_v vNormFade = pow2(xr * vTransformedFadeX) + pow2(yr * vTransformedFadeY);\n+            //255 * n * (normeFade - 1) / (normeFade - n)\n+            Vc::float_v vFade = n * (vNormFade - vOne) / (vNormFade - n);\n \n-        //255 * n * (normeFade - 1) / (normeFade - n)\n-        Vc::float_v vFade = n * (vNormFade - vOne) / (vNormFade - n);\n-        // Mask out the inner circe of the mask\n-        Vc::float_m mask = vNormFade < vOne;\n-        vFade.setZero(mask);\n-        vFade = Vc::min(vFade, vOne);\n+            // Mask in the inner circe of the mask\n+            Vc::float_m mask = vNormFade < vOne;\n+            vFade.setZero(mask);\n+\n+            // Mask out the outer circe of the mask\n+            vFade(outsideMask) = vOne;\n+\n+            vFade.store(bufferPointer, Vc::Aligned);\n+        } else {\n+            // Mask out everything outside the circle\n+            vOne.store(bufferPointer, Vc::Aligned);\n+        }\n \n-        vFade.store(bufferPointer);\n         currentIndices = currentIndices + increment;\n \n         bufferPointer += Vc::float_v::Size;"}]}, {"sha": "5d59709c37c8e70dd01ad44a43cf096b8d345f08", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "b80bf597d6a4fce1c7c4bc513c68acfca022ec17", "filename": "libs/image/kis_brush_mask_applicator_factories.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/5d59709c37c8e70dd01ad44a43cf096b8d345f08/libs/image/kis_brush_mask_applicator_factories.cpp", "raw_url": "https://github.com/KDE/krita/raw/5d59709c37c8e70dd01ad44a43cf096b8d345f08/libs/image/kis_brush_mask_applicator_factories.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_brush_mask_applicator_factories.cpp?ref=5d59709c37c8e70dd01ad44a43cf096b8d345f08", "patch": "@@ -68,7 +68,7 @@ FastRowProcessor::process<Vc::CurrentImplementation::current()>(float* buffer, i\n \n     float* bufferPointer = buffer;\n \n-    Vc::float_v currentIndices(Vc::int_v::IndexesFromZero());\n+    Vc::float_v currentIndices = Vc::float_v::IndexesFromZero();\n \n     Vc::float_v increment((float)Vc::float_v::Size);\n     Vc::float_v vCenterX(centerX);"}]}, {"sha": "6f058ed989b83389152f99bc4410e68254077696", "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "d6680211a367d06d753c8f46f07e1192eb291784", "filename": "3rdparty/ext_vc/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/6f058ed989b83389152f99bc4410e68254077696/3rdparty/ext_vc/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/6f058ed989b83389152f99bc4410e68254077696/3rdparty/ext_vc/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/3rdparty/ext_vc/CMakeLists.txt?ref=6f058ed989b83389152f99bc4410e68254077696", "patch": "@@ -1,8 +1,8 @@\n SET(PREFIX_ext_vc \"${EXTPREFIX}\" )\n ExternalProject_Add( ext_vc\n     DOWNLOAD_DIR ${EXTERNALS_DOWNLOAD_DIR}\n-    URL http://files.kde.org/krita/build/dependencies/Vc-0.7.5.tar.gz\n-    URL_MD5 59854e2381b78d602b4a00e459e3d333\n+    URL http://files.kde.org/krita/build/dependencies/Vc-1.2.0.tar.gz\n+    URL_MD5 f2a213ae4bad0dcf4ec6469e4dad41c1\n \n     INSTALL_DIR ${PREFIX_ext_vc}\n \tCMAKE_ARGS -DCMAKE_INSTALL_PREFIX=${PREFIX_ext_vc} -DBUILD_TESTING=OFF -DCMAKE_BUILD_TYPE=${GLOBAL_BUILD_TYPE} ${GLOBAL_PROFILE}"}]}, {"sha": "c9a87c8875128756fd3b11a021447f965eb43422", "stats": {"total": 2326, "additions": 80, "deletions": 2246}, "files": [{"sha": "36594a92146a978154b69969807cc512197138f5", "filename": "CMakeLists.txt", "status": "modified", "additions": 18, "deletions": 38, "changes": 56, "blob_url": "https://github.com/KDE/krita/blob/c9a87c8875128756fd3b11a021447f965eb43422/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/c9a87c8875128756fd3b11a021447f965eb43422/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=c9a87c8875128756fd3b11a021447f965eb43422", "patch": "@@ -483,7 +483,7 @@ endif()\n ##\n set(OLD_CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} )\n set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake/modules )\n-macro_optional_find_package(Vc 0.6.70)\n+macro_optional_find_package(Vc 1.0.0)\n macro_log_feature(Vc_FOUND \"Vc\" \"Portable, zero-overhead SIMD library for C++\" \"https://github.com/VcDevel/Vc\" FALSE \"\" \"Required by the Krita for vectorization\")\n macro_bool_to_01(Vc_FOUND HAVE_VC)\n macro_bool_to_01(PACKAGERS_BUILD DO_PACKAGERS_BUILD)\n@@ -504,48 +504,28 @@ if(HAVE_VC)\n     endif()\n \n     #Handle Vc master\n-    if(Vc_VERSION_MAJOR GREATER 0 OR Vc_VERSION_MINOR GREATER 7)\n-        message(STATUS \"Vc version is greater than 0.7, enabling AVX2 support\")\n-\n-        if(Vc_COMPILER_IS_GCC OR Vc_COMPILER_IS_CLANG)\n-            AddCompilerFlag(\"-std=c++11\" _ok)\n-            if(NOT _ok)\n-                AddCompilerFlag(\"-std=c++0x\" _ok)\n-            endif()\n+    if(Vc_COMPILER_IS_GCC OR Vc_COMPILER_IS_CLANG)\n+        AddCompilerFlag(\"-std=c++11\" _ok)\n+        if(NOT _ok)\n+            AddCompilerFlag(\"-std=c++0x\" _ok)\n         endif()\n+    endif()\n \n-        macro(ko_compile_for_all_implementations_no_scalar _objs _src)\n-        if(PACKAGERS_BUILD)\n-            vc_compile_for_all_implementations(${_objs} ${_src} FLAGS ${ADDITIONAL_VC_FLAGS} ONLY SSE2 SSSE3 SSE4_1 AVX AVX2)\n-        else()\n-            set(${_objs} ${_src})\n-        endif()\n-        endmacro()\n-\n-        macro(ko_compile_for_all_implementations _objs _src)\n-        if(PACKAGERS_BUILD)\n-            vc_compile_for_all_implementations(${_objs} ${_src} FLAGS ${ADDITIONAL_VC_FLAGS} ONLY Scalar SSE2 SSSE3 SSE4_1 AVX AVX2)\n-        else()\n-            set(${_objs} ${_src})\n-        endif()\n-        endmacro()\n+    macro(ko_compile_for_all_implementations_no_scalar _objs _src)\n+    if(PACKAGERS_BUILD)\n+        vc_compile_for_all_implementations(${_objs} ${_src} FLAGS ${ADDITIONAL_VC_FLAGS} ONLY SSE2 SSSE3 SSE4_1 AVX AVX2+FMA+BMI2)\n     else()\n-        macro(ko_compile_for_all_implementations_no_scalar _objs _src)\n-        if(PACKAGERS_BUILD)\n-            vc_compile_for_all_implementations(${_objs} ${_src} FLAGS ${ADDITIONAL_VC_FLAGS} ONLY SSE2 SSSE3 SSE4_1 AVX)\n-        else()\n-            set(${_objs} ${_src})\n-        endif()\n-        endmacro()\n+        set(${_objs} ${_src})\n+    endif()\n+    endmacro()\n \n-        macro(ko_compile_for_all_implementations _objs _src)\n-        if(PACKAGERS_BUILD)\n-            vc_compile_for_all_implementations(${_objs} ${_src} FLAGS ${ADDITIONAL_VC_FLAGS} ONLY Scalar SSE2 SSSE3 SSE4_1 AVX)\n-        else()\n-            set(${_objs} ${_src})\n-        endif()\n-        endmacro()\n+    macro(ko_compile_for_all_implementations _objs _src)\n+    if(PACKAGERS_BUILD)\n+        vc_compile_for_all_implementations(${_objs} ${_src} FLAGS ${ADDITIONAL_VC_FLAGS} ONLY Scalar SSE2 SSSE3 SSE4_1 AVX AVX2+FMA+BMI2)\n+    else()\n+        set(${_objs} ${_src})\n     endif()\n+    endmacro()\n \n     if (NOT PACKAGERS_BUILD)\n         # Optimize everything for the current architecture"}, {"sha": "db47808637f26e8a9a797aa29e7a4f7d3fd39367", "filename": "benchmarks/CMakeLists.txt", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/c9a87c8875128756fd3b11a021447f965eb43422/benchmarks/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/c9a87c8875128756fd3b11a021447f965eb43422/benchmarks/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/benchmarks/CMakeLists.txt?ref=c9a87c8875128756fd3b11a021447f965eb43422", "patch": "@@ -72,4 +72,7 @@ target_link_libraries(KisGradientBenchmark  kritaimage  Qt5::Test)\n target_link_libraries(KisLowMemoryBenchmark  kritaimage  Qt5::Test)\n target_link_libraries(KisFilterSelectionsBenchmark   kritaimage  Qt5::Test)\n target_link_libraries(KisCompositionBenchmark  kritaimage  Qt5::Test ${LINK_VC_LIB})\n+if(HAVE_VC)\n+    set_property(TARGET KisCompositionBenchmark APPEND PROPERTY COMPILE_OPTIONS \"${Vc_ARCHITECTURE_FLAGS}\")\n+endif()\n target_link_libraries(KisMaskGeneratorBenchmark  kritaimage  Qt5::Test)"}, {"sha": "51fb77be37025f0aae4d77d516b9baf4c06f0796", "filename": "benchmarks/kis_composition_benchmark.cpp", "status": "modified", "additions": 16, "deletions": 6, "changes": 22, "blob_url": "https://github.com/KDE/krita/blob/c9a87c8875128756fd3b11a021447f965eb43422/benchmarks/kis_composition_benchmark.cpp", "raw_url": "https://github.com/KDE/krita/raw/c9a87c8875128756fd3b11a021447f965eb43422/benchmarks/kis_composition_benchmark.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/benchmarks/kis_composition_benchmark.cpp?ref=c9a87c8875128756fd3b11a021447f965eb43422", "patch": "@@ -499,7 +499,7 @@ void checkRounding(qreal opacity, qreal flow, qreal averageOpacity = -1, quint32\n     // The error count is needed as 38.5 gets rounded to 38 instead of 39 in the vc version.\n     int errorcount = 0;\n     for (int i = 0; i < numBlocks; i++) {\n-        Compositor::template compositeVector<true,true, VC_IMPL>(src1, dst1, msk1, params.opacity, optionalParams);\n+        Compositor::template compositeVector<true,true, Vc::CurrentImplementation::current()>(src1, dst1, msk1, params.opacity, optionalParams);\n         for (int j = 0; j < vecSize; j++) {\n \n             //if (8 * i + j == 7080) {\n@@ -508,7 +508,7 @@ void checkRounding(qreal opacity, qreal flow, qreal averageOpacity = -1, quint32\n             //    dbgKrita << \"msk:\" << msk2[0];\n             //}\n \n-            Compositor::template compositeOnePixelScalar<true, VC_IMPL>(src2, dst2, msk2, params.opacity, optionalParams);\n+            Compositor::template compositeOnePixelScalar<true, Vc::CurrentImplementation::current()>(src2, dst2, msk2, params.opacity, optionalParams);\n \n             bool compareResult = true;\n             if (pixelSize == 4) {\n@@ -819,6 +819,8 @@ void KisCompositionBenchmark::benchmarkMemcpy()\n void KisCompositionBenchmark::benchmarkUintFloat()\n {\n #ifdef HAVE_VC\n+    using uint_v = Vc::SimdArray<unsigned int, Vc::float_v::size()>;\n+\n     const int dataSize = 4096;\n     void *ptr = 0;\n     int error = MEMALIGN_ALLOC(&ptr, uint8VecAlignment, dataSize);\n@@ -836,7 +838,7 @@ void KisCompositionBenchmark::benchmarkUintFloat()\n         for (int i = 0; i < dataSize; i += Vc::float_v::Size) {\n             // convert uint -> float directly, this causes\n             // static_cast helper be called\n-            Vc::float_v b(Vc::uint_v(iData + i));\n+            Vc::float_v b(uint_v(iData + i));\n             b.store(fData + i);\n         }\n     }\n@@ -849,6 +851,9 @@ void KisCompositionBenchmark::benchmarkUintFloat()\n void KisCompositionBenchmark::benchmarkUintIntFloat()\n {\n #ifdef HAVE_VC\n+    using int_v = Vc::SimdArray<int, Vc::float_v::size()>;\n+    using uint_v = Vc::SimdArray<unsigned int, Vc::float_v::size()>;\n+\n     const int dataSize = 4096;\n     void *ptr = 0;\n     int error = MEMALIGN_ALLOC(&ptr, uint8VecAlignment, dataSize);\n@@ -866,7 +871,7 @@ void KisCompositionBenchmark::benchmarkUintIntFloat()\n         for (int i = 0; i < dataSize; i += Vc::float_v::Size) {\n             // convert uint->int->float, that avoids special sign\n             // treating, and gives 2.6 times speedup\n-            Vc::float_v b(Vc::int_v(Vc::uint_v(iData + i)));\n+            Vc::float_v b(int_v(uint_v(iData + i)));\n             b.store(fData + i);\n         }\n     }\n@@ -879,6 +884,8 @@ void KisCompositionBenchmark::benchmarkUintIntFloat()\n void KisCompositionBenchmark::benchmarkFloatUint()\n {\n #ifdef HAVE_VC\n+    using uint_v = Vc::SimdArray<unsigned int, Vc::float_v::size()>;\n+\n     const int dataSize = 4096;\n     void *ptr = 0;\n     int error = MEMALIGN_ALLOC(&ptr, uint32VecAlignment, dataSize * sizeof(quint32));\n@@ -895,7 +902,7 @@ void KisCompositionBenchmark::benchmarkFloatUint()\n     QBENCHMARK {\n         for (int i = 0; i < dataSize; i += Vc::float_v::Size) {\n             // conversion float -> uint\n-            Vc::uint_v b(Vc::float_v(fData + i));\n+            uint_v b(Vc::float_v(fData + i));\n \n             b.store(iData + i);\n         }\n@@ -909,6 +916,9 @@ void KisCompositionBenchmark::benchmarkFloatUint()\n void KisCompositionBenchmark::benchmarkFloatIntUint()\n {\n #ifdef HAVE_VC\n+    using int_v = Vc::SimdArray<int, Vc::float_v::size()>;\n+    using uint_v = Vc::SimdArray<unsigned int, Vc::float_v::size()>;\n+\n     const int dataSize = 4096;\n     void *ptr = 0;\n     int error = MEMALIGN_ALLOC(&ptr, uint32VecAlignment, dataSize * sizeof(quint32));\n@@ -925,7 +935,7 @@ void KisCompositionBenchmark::benchmarkFloatIntUint()\n     QBENCHMARK {\n         for (int i = 0; i < dataSize; i += Vc::float_v::Size) {\n             // conversion float -> int -> uint\n-            Vc::uint_v b(Vc::int_v(Vc::float_v(fData + i)));\n+            uint_v b(int_v(Vc::float_v(fData + i)));\n \n             b.store(iData + i);\n         }"}, {"sha": "801cdd849f0458191829fccc063f900e14060f74", "filename": "cmake/vc/AddCompilerFlag.cmake", "status": "removed", "additions": 0, "deletions": 162, "changes": 162, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/AddCompilerFlag.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/AddCompilerFlag.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/AddCompilerFlag.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -1,162 +0,0 @@\n-# - Add a given compiler flag to flags variables.\n-# AddCompilerFlag(<flag> [<var>])\n-# or\n-# AddCompilerFlag(<flag> [C_FLAGS <var>] [CXX_FLAGS <var>] [C_RESULT <var>]\n-#                        [CXX_RESULT <var>])\n-\n-#=============================================================================\n-# Copyright 2010-2013 Matthias Kretz <kretz@kde.org>\n-#\n-# Redistribution and use in source and binary forms, with or without\n-# modification, are permitted provided that the following conditions are\n-# met:\n-#\n-#  * Redistributions of source code must retain the above copyright notice,\n-#    this list of conditions and the following disclaimer.\n-#\n-#  * Redistributions in binary form must reproduce the above copyright notice,\n-#    this list of conditions and the following disclaimer in the documentation\n-#    and/or other materials provided with the distribution.\n-#\n-#  * The names of Kitware, Inc., the Insight Consortium, or the names of\n-#    any consortium members, or of any contributors, may not be used to\n-#    endorse or promote products derived from this software without\n-#    specific prior written permission.\n-#\n-# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS ``AS IS''\n-# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n-# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n-# ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR\n-# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n-# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n-# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n-# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n-# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n-# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n-#=============================================================================\n-\n-get_filename_component(_currentDir \"${CMAKE_CURRENT_LIST_FILE}\" PATH)\n-include(\"${_currentDir}/CheckCCompilerFlag.cmake\")\n-include(\"${_currentDir}/CheckCXXCompilerFlag.cmake\")\n-include(\"${_currentDir}/CheckMicCCompilerFlag.cmake\")\n-include(\"${_currentDir}/CheckMicCXXCompilerFlag.cmake\")\n-\n-macro(AddCompilerFlag _flag)\n-   string(REGEX REPLACE \"[-.+/:= ]\" \"_\" _flag_esc \"${_flag}\")\n-\n-   set(_c_flags \"CMAKE_C_FLAGS\")\n-   set(_cxx_flags \"CMAKE_CXX_FLAGS\")\n-   set(_mic_c_flags \"CMAKE_MIC_C_FLAGS\")\n-   set(_mic_cxx_flags \"CMAKE_MIC_CXX_FLAGS\")\n-   set(_c_result tmp)\n-   set(_cxx_result tmp)\n-   set(_mic_c_result)\n-   set(_mic_cxx_result)\n-   if(${ARGC} EQUAL 2)\n-      message(WARNING \"Deprecated use of the AddCompilerFlag macro.\")\n-      unset(_c_result)\n-      set(_cxx_result ${ARGV1})\n-   elseif(${ARGC} GREATER 2)\n-      set(state 0)\n-      unset(_c_flags)\n-      unset(_cxx_flags)\n-      unset(_mic_c_flags)\n-      unset(_mic_cxx_flags)\n-      unset(_c_result)\n-      unset(_cxx_result)\n-      unset(_mic_c_result)\n-      unset(_mic_cxx_result)\n-      foreach(_arg ${ARGN})\n-         if(_arg STREQUAL \"C_FLAGS\")\n-            set(state 1)\n-            if(NOT DEFINED _c_result)\n-               set(_c_result tmp)\n-            endif()\n-         elseif(_arg STREQUAL \"CXX_FLAGS\")\n-            set(state 2)\n-            if(NOT DEFINED _cxx_result)\n-               set(_cxx_result tmp)\n-            endif()\n-         elseif(_arg STREQUAL \"C_RESULT\")\n-            set(state 3)\n-         elseif(_arg STREQUAL \"CXX_RESULT\")\n-            set(state 4)\n-         elseif(_arg STREQUAL \"MIC_C_RESULT\")\n-            set(state 5)\n-         elseif(_arg STREQUAL \"MIC_CXX_RESULT\")\n-            set(state 6)\n-         elseif(_arg STREQUAL \"MIC_C_FLAGS\")\n-            set(state 7)\n-         elseif(_arg STREQUAL \"MIC_CXX_FLAGS\")\n-            set(state 8)\n-         elseif(state EQUAL 1)\n-            set(_c_flags \"${_arg}\")\n-         elseif(state EQUAL 2)\n-            set(_cxx_flags \"${_arg}\")\n-         elseif(state EQUAL 3)\n-            set(_c_result \"${_arg}\")\n-         elseif(state EQUAL 4)\n-            set(_cxx_result \"${_arg}\")\n-         elseif(state EQUAL 5)\n-            set(_mic_c_result \"${_arg}\")\n-         elseif(state EQUAL 6)\n-            set(_mic_cxx_result \"${_arg}\")\n-         elseif(state EQUAL 7)\n-            set(_mic_c_flags \"${_arg}\")\n-         elseif(state EQUAL 8)\n-            set(_mic_cxx_flags \"${_arg}\")\n-         else()\n-            message(FATAL_ERROR \"Syntax error for AddCompilerFlag\")\n-         endif()\n-      endforeach()\n-   endif()\n-\n-   if(\"${_flag}\" STREQUAL \"-mfma\")\n-      # Compiling with FMA3 support may fail only at the assembler level.\n-      # In that case we need to have such an instruction in the test code\n-      set(_code \"#include <immintrin.h>\n-      __m128 foo(__m128 x) { return _mm_fmadd_ps(x, x, x); }\n-      int main() { return 0; }\")\n-   elseif(\"${_flag}\" STREQUAL \"-stdlib=libc++\")\n-      # Compiling with libc++ not only requires a compiler that understands it, but also\n-      # the libc++ headers itself\n-      set(_code \"#include <iostream>\n-      int main() { return 0; }\")\n-   else()\n-      set(_code \"int main() { return 0; }\")\n-   endif()\n-\n-   if(DEFINED _c_result)\n-      check_c_compiler_flag(\"${_flag}\" check_c_compiler_flag_${_flag_esc} \"${_code}\")\n-      set(${_c_result} ${check_c_compiler_flag_${_flag_esc}})\n-   endif()\n-   if(DEFINED _cxx_result)\n-      check_cxx_compiler_flag(\"${_flag}\" check_cxx_compiler_flag_${_flag_esc} \"${_code}\")\n-      set(${_cxx_result} ${check_cxx_compiler_flag_${_flag_esc}})\n-   endif()\n-\n-   if(check_c_compiler_flag_${_flag_esc} AND DEFINED _c_flags)\n-      set(${_c_flags} \"${${_c_flags}} ${_flag}\")\n-   endif()\n-   if(check_cxx_compiler_flag_${_flag_esc} AND DEFINED _cxx_flags)\n-      set(${_cxx_flags} \"${${_cxx_flags}} ${_flag}\")\n-   endif()\n-\n-   if(MIC_NATIVE_FOUND)\n-      if(DEFINED _mic_c_result)\n-         check_mic_c_compiler_flag(\"${_flag}\" check_mic_c_compiler_flag_${_flag_esc} \"${_code}\")\n-         set(${_mic_c_result} ${check_mic_c_compiler_flag_${_flag_esc}})\n-      endif()\n-      if(DEFINED _mic_cxx_result)\n-         check_mic_cxx_compiler_flag(\"${_flag}\" check_mic_cxx_compiler_flag_${_flag_esc} \"${_code}\")\n-         set(${_mic_cxx_result} ${check_mic_cxx_compiler_flag_${_flag_esc}})\n-      endif()\n-\n-      if(check_mic_c_compiler_flag_${_flag_esc} AND DEFINED _mic_c_flags)\n-         set(${_mic_c_flags} \"${${_mic_c_flags}} ${_flag}\")\n-      endif()\n-      if(check_mic_cxx_compiler_flag_${_flag_esc} AND DEFINED _mic_cxx_flags)\n-         set(${_mic_cxx_flags} \"${${_mic_cxx_flags}} ${_flag}\")\n-      endif()\n-   endif()\n-endmacro(AddCompilerFlag)"}, {"sha": "c410135ea897af7c6ad75a345bcec90a64625ac2", "filename": "cmake/vc/AddTargetProperty.cmake", "status": "removed", "additions": 0, "deletions": 39, "changes": 39, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/AddTargetProperty.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/AddTargetProperty.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/AddTargetProperty.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -1,39 +0,0 @@\n-#=============================================================================\n-# Copyright 2010-2013 Matthias Kretz <kretz@kde.org>\n-#\n-# Redistribution and use in source and binary forms, with or without\n-# modification, are permitted provided that the following conditions are\n-# met:\n-#\n-#  * Redistributions of source code must retain the above copyright notice,\n-#    this list of conditions and the following disclaimer.\n-#\n-#  * Redistributions in binary form must reproduce the above copyright notice,\n-#    this list of conditions and the following disclaimer in the documentation\n-#    and/or other materials provided with the distribution.\n-#\n-#  * The names of Kitware, Inc., the Insight Consortium, or the names of\n-#    any consortium members, or of any contributors, may not be used to\n-#    endorse or promote products derived from this software without\n-#    specific prior written permission.\n-#\n-# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS ``AS IS''\n-# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n-# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n-# ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR\n-# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n-# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n-# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n-# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n-# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n-# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n-#=============================================================================\n-\n-macro(add_target_property _target _prop _value)\n-   get_target_property(_oldprop \"${_target}\" ${_prop})\n-   if(NOT _oldprop)\n-      set_target_properties(\"${_target}\" PROPERTIES ${_prop} \"${_value}\")\n-   else(NOT _oldprop)\n-      set_target_properties(\"${_target}\" PROPERTIES ${_prop} \"${_oldprop} ${_value}\")\n-   endif(NOT _oldprop)\n-endmacro(add_target_property)"}, {"sha": "c9680c5fa0673cf5ea257edc986858ba63b5f1d0", "filename": "cmake/vc/CheckCCompilerFlag.cmake", "status": "removed", "additions": 0, "deletions": 70, "changes": 70, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/CheckCCompilerFlag.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/CheckCCompilerFlag.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/CheckCCompilerFlag.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -1,70 +0,0 @@\n-# - Check whether the C compiler supports a given flag.\n-# CHECK_C_COMPILER_FLAG(<flag> <var>)\n-#  <flag> - the compiler flag\n-#  <var>  - variable to store the result\n-# This internally calls the check_c_source_compiles macro.\n-# See help for CheckCSourceCompiles for a listing of variables\n-# that can modify the build.\n-\n-#=============================================================================\n-# Copyright 2006-2009 Kitware, Inc.\n-# Copyright 2006 Alexander Neundorf <neundorf@kde.org>\n-# Copyright 2011-2013 Matthias Kretz <kretz@kde.org>\n-#\n-# Redistribution and use in source and binary forms, with or without\n-# modification, are permitted provided that the following conditions are\n-# met:\n-#\n-#  * Redistributions of source code must retain the above copyright notice,\n-#    this list of conditions and the following disclaimer.\n-#\n-#  * Redistributions in binary form must reproduce the above copyright notice,\n-#    this list of conditions and the following disclaimer in the documentation\n-#    and/or other materials provided with the distribution.\n-#\n-#  * The names of Kitware, Inc., the Insight Consortium, or the names of\n-#    any consortium members, or of any contributors, may not be used to\n-#    endorse or promote products derived from this software without\n-#    specific prior written permission.\n-#\n-# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS ``AS IS''\n-# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n-# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n-# ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR\n-# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n-# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n-# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n-# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n-# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n-# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n-#=============================================================================\n-\n-INCLUDE(CheckCSourceCompiles)\n-\n-MACRO (CHECK_C_COMPILER_FLAG _FLAG _RESULT)\n-   SET(SAFE_CMAKE_REQUIRED_DEFINITIONS \"${CMAKE_REQUIRED_DEFINITIONS}\")\n-   SET(CMAKE_REQUIRED_DEFINITIONS \"${_FLAG}\")\n-   if(${ARGC} GREATER 2)\n-      SET(TEST_SOURCE \"${ARGV2}\")\n-   else()\n-      SET(TEST_SOURCE \"int main() { return 0;}\")\n-   endif()\n-   CHECK_C_SOURCE_COMPILES(\"${TEST_SOURCE}\" ${_RESULT}\n-     # Some compilers do not fail with a bad flag\n-     FAIL_REGEX \"error: bad value (.*) for .* switch\"       # GNU\n-     FAIL_REGEX \"argument unused during compilation\"        # clang\n-     FAIL_REGEX \"is valid for .* but not for C\"             # GNU\n-     FAIL_REGEX \"unrecognized .*option\"                     # GNU\n-     FAIL_REGEX \"ignored for target\"                        # GNU\n-     FAIL_REGEX \"ignoring unknown option\"                   # MSVC\n-     FAIL_REGEX \"[Uu]nknown option\"                         # HP\n-     FAIL_REGEX \"[Ww]arning: [Oo]ption\"                     # SunPro\n-     FAIL_REGEX \"command option .* is not recognized\"       # XL\n-     FAIL_REGEX \"WARNING: unknown flag:\"                    # Open64\n-     FAIL_REGEX \"command line error\"                        # ICC\n-     FAIL_REGEX \"command line warning\"                      # ICC\n-     FAIL_REGEX \"#10236:\"                                   # ICC: File not found\n-     )\n-   SET (CMAKE_REQUIRED_DEFINITIONS \"${SAFE_CMAKE_REQUIRED_DEFINITIONS}\")\n-ENDMACRO (CHECK_C_COMPILER_FLAG)\n-"}, {"sha": "72a6cc39fc97d919770e19c8edfb8a34ace10611", "filename": "cmake/vc/CheckCXXCompilerFlag.cmake", "status": "removed", "additions": 0, "deletions": 70, "changes": 70, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/CheckCXXCompilerFlag.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/CheckCXXCompilerFlag.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/CheckCXXCompilerFlag.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -1,70 +0,0 @@\n-# - Check whether the CXX compiler supports a given flag.\n-# CHECK_CXX_COMPILER_FLAG(<flag> <var>)\n-#  <flag> - the compiler flag\n-#  <var>  - variable to store the result\n-# This internally calls the check_cxx_source_compiles macro.  See help\n-# for CheckCXXSourceCompiles for a listing of variables that can\n-# modify the build.\n-\n-#=============================================================================\n-# Copyright 2006-2009 Kitware, Inc.\n-# Copyright 2006 Alexander Neundorf <neundorf@kde.org>\n-# Copyright 2011-2013 Matthias Kretz <kretz@kde.org>\n-#\n-# Redistribution and use in source and binary forms, with or without\n-# modification, are permitted provided that the following conditions are\n-# met:\n-#\n-#  * Redistributions of source code must retain the above copyright notice,\n-#    this list of conditions and the following disclaimer.\n-#\n-#  * Redistributions in binary form must reproduce the above copyright notice,\n-#    this list of conditions and the following disclaimer in the documentation\n-#    and/or other materials provided with the distribution.\n-#\n-#  * The names of Kitware, Inc., the Insight Consortium, or the names of\n-#    any consortium members, or of any contributors, may not be used to\n-#    endorse or promote products derived from this software without\n-#    specific prior written permission.\n-#\n-# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS ``AS IS''\n-# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n-# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n-# ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR\n-# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n-# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n-# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n-# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n-# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n-# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n-#=============================================================================\n-\n-INCLUDE(CheckCXXSourceCompiles)\n-\n-MACRO (CHECK_CXX_COMPILER_FLAG _FLAG _RESULT)\n-   SET(SAFE_CMAKE_REQUIRED_DEFINITIONS \"${CMAKE_REQUIRED_DEFINITIONS}\")\n-   SET(CMAKE_REQUIRED_DEFINITIONS \"${_FLAG}\")\n-   if(${ARGC} GREATER 2)\n-      SET(TEST_SOURCE \"${ARGV2}\")\n-   else()\n-      SET(TEST_SOURCE \"int main() { return 0;}\")\n-   endif()\n-   CHECK_CXX_SOURCE_COMPILES(\"${TEST_SOURCE}\" ${_RESULT}\n-     # Some compilers do not fail with a bad flag\n-     FAIL_REGEX \"error: bad value (.*) for .* switch\"       # GNU\n-     FAIL_REGEX \"argument unused during compilation\"        # clang\n-     FAIL_REGEX \"is valid for .* but not for C\\\\\\\\+\\\\\\\\+\"   # GNU\n-     FAIL_REGEX \"unrecognized .*option\"                     # GNU\n-     FAIL_REGEX \"ignored for target\"                        # GNU\n-     FAIL_REGEX \"ignoring unknown option\"                   # MSVC\n-     FAIL_REGEX \"[Uu]nknown option\"                         # HP\n-     FAIL_REGEX \"[Ww]arning: [Oo]ption\"                     # SunPro\n-     FAIL_REGEX \"command option .* is not recognized\"       # XL\n-     FAIL_REGEX \"WARNING: unknown flag:\"                    # Open64\n-     FAIL_REGEX \"command line error\"                        # ICC\n-     FAIL_REGEX \"command line warning\"                      # ICC\n-     FAIL_REGEX \"#10236:\"                                   # ICC: File not found\n-     )\n-   SET (CMAKE_REQUIRED_DEFINITIONS \"${SAFE_CMAKE_REQUIRED_DEFINITIONS}\")\n-ENDMACRO (CHECK_CXX_COMPILER_FLAG)\n-"}, {"sha": "eae725b790a5368270a814cc8be88cacfafb60b8", "filename": "cmake/vc/CheckMicCCompilerFlag.cmake", "status": "removed", "additions": 0, "deletions": 101, "changes": 101, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/CheckMicCCompilerFlag.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/CheckMicCCompilerFlag.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/CheckMicCCompilerFlag.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -1,101 +0,0 @@\n-# - Check whether the MIC C compiler supports a given flag.\n-# CHECK_MIC_C_COMPILER_FLAG(<flag> <var>)\n-#  <flag> - the compiler flag\n-#  <var>  - variable to store the result\n-# This internally calls the check_c_source_compiles macro.  See help\n-# for CheckCSourceCompiles for a listing of variables that can\n-# modify the build.\n-\n-#=============================================================================\n-# Copyright 2006-2009 Kitware, Inc.\n-# Copyright 2006 Alexander Neundorf <neundorf@kde.org>\n-# Copyright 2011-2013 Matthias Kretz <kretz@kde.org>\n-#\n-# Redistribution and use in source and binary forms, with or without\n-# modification, are permitted provided that the following conditions are\n-# met:\n-#\n-#  * Redistributions of source code must retain the above copyright notice,\n-#    this list of conditions and the following disclaimer.\n-#\n-#  * Redistributions in binary form must reproduce the above copyright notice,\n-#    this list of conditions and the following disclaimer in the documentation\n-#    and/or other materials provided with the distribution.\n-#\n-#  * The names of Kitware, Inc., the Insight Consortium, or the names of\n-#    any consortium members, or of any contributors, may not be used to\n-#    endorse or promote products derived from this software without\n-#    specific prior written permission.\n-#\n-# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS ``AS IS''\n-# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n-# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n-# ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR\n-# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n-# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n-# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n-# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n-# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n-# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n-#=============================================================================\n-\n-macro(check_mic_c_compiler_flag _FLAG _RESULT)\n-   if(\"${_RESULT}\" MATCHES \"^${_RESULT}$\")\n-      set(_tmpdir \"${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeTmp\")\n-      if(${ARGC} GREATER 2)\n-         file(WRITE \"${_tmpdir}/src.c\" \"${ARGV2}\")\n-      else()\n-         file(WRITE \"${_tmpdir}/src.c\" \"int main() { return 0; }\")\n-      endif()\n-\n-      execute_process(\n-         COMMAND \"${MIC_CC}\" -mmic -c -o \"${_tmpdir}/src.o\"\n-         \"${_FLAG}\" \"${_tmpdir}/src.c\"\n-         WORKING_DIRECTORY ${CMAKE_BINARY_DIR}\n-         RESULT_VARIABLE ${_RESULT}\n-         OUTPUT_VARIABLE OUTPUT\n-         ERROR_VARIABLE OUTPUT\n-         )\n-\n-      if(${_RESULT})\n-         foreach(_fail_regex\n-               \"error: bad value (.*) for .* switch\"       # GNU\n-               \"argument unused during compilation\"        # clang\n-               \"is valid for .* but not for C\"             # GNU\n-               \"unrecognized .*option\"                     # GNU\n-               \"ignored for target\"                        # GNU\n-               \"ignoring unknown option\"                   # MSVC\n-               \"[Uu]nknown option\"                         # HP\n-               \"[Ww]arning: [Oo]ption\"                     # SunPro\n-               \"command option .* is not recognized\"       # XL\n-               \"WARNING: unknown flag:\"                    # Open64\n-               \"command line error\"                        # ICC\n-               \"command line warning\"                      # ICC\n-               \"#10236:\"                                   # ICC: File not found\n-               )\n-            if(\"${OUTPUT}\" MATCHES \"${_fail_regex}\")\n-               set(${_RESULT} FALSE)\n-            endif()\n-         endforeach()\n-      endif()\n-\n-      if(${_RESULT})\n-         set(${_RESULT} 1 CACHE INTERNAL \"Test ${_FLAG}\")\n-         message(STATUS \"Performing Test Check MIC C   Compiler flag ${_FLAG} - Success\")\n-         file(APPEND ${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeOutput.log\n-            \"Performing MIC C Compiler Flag Test ${_FLAG} succeded with the following output:\\n\"\n-            \"${OUTPUT}\\n\"\n-            \"COMMAND: ${MIC_CC} -mmic -c -o ${_tmpdir}/src.o ${_FLAG} ${_tmpdir}/src.cpp\\n\"\n-            )\n-      else()\n-         message(STATUS \"Performing Test Check MIC C   Compiler flag ${_FLAG} - Failed\")\n-         set(${_RESULT} \"\" CACHE INTERNAL \"Test ${_FLAG}\")\n-         file(APPEND ${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeError.log\n-            \"Performing MIC C Compiler Flag Test ${_FLAG} failed with the following output:\\n\"\n-            \"${OUTPUT}\\n\"\n-            \"COMMAND: ${MIC_CC} -mmic -c -o ${_tmpdir}/src.o ${_FLAG} ${_tmpdir}/src.cpp\\n\"\n-            )\n-      endif()\n-   endif()\n-endmacro()\n-"}, {"sha": "c0444c4cc2d06a36041032225f495287d85f1b59", "filename": "cmake/vc/CheckMicCXXCompilerFlag.cmake", "status": "removed", "additions": 0, "deletions": 101, "changes": 101, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/CheckMicCXXCompilerFlag.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/CheckMicCXXCompilerFlag.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/CheckMicCXXCompilerFlag.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -1,101 +0,0 @@\n-# - Check whether the MIC CXX compiler supports a given flag.\n-# CHECK_MIC_CXX_COMPILER_FLAG(<flag> <var>)\n-#  <flag> - the compiler flag\n-#  <var>  - variable to store the result\n-# This internally calls the check_cxx_source_compiles macro.  See help\n-# for CheckCXXSourceCompiles for a listing of variables that can\n-# modify the build.\n-\n-#=============================================================================\n-# Copyright 2006-2009 Kitware, Inc.\n-# Copyright 2006 Alexander Neundorf <neundorf@kde.org>\n-# Copyright 2011-2013 Matthias Kretz <kretz@kde.org>\n-#\n-# Redistribution and use in source and binary forms, with or without\n-# modification, are permitted provided that the following conditions are\n-# met:\n-#\n-#  * Redistributions of source code must retain the above copyright notice,\n-#    this list of conditions and the following disclaimer.\n-#\n-#  * Redistributions in binary form must reproduce the above copyright notice,\n-#    this list of conditions and the following disclaimer in the documentation\n-#    and/or other materials provided with the distribution.\n-#\n-#  * The names of Kitware, Inc., the Insight Consortium, or the names of\n-#    any consortium members, or of any contributors, may not be used to\n-#    endorse or promote products derived from this software without\n-#    specific prior written permission.\n-#\n-# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS ``AS IS''\n-# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n-# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n-# ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR\n-# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n-# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n-# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n-# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n-# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n-# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n-#=============================================================================\n-\n-macro(check_mic_cxx_compiler_flag _FLAG _RESULT)\n-   if(\"${_RESULT}\" MATCHES \"^${_RESULT}$\")\n-      set(_tmpdir \"${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeTmp\")\n-      if(${ARGC} GREATER 2)\n-         file(WRITE \"${_tmpdir}/src.cpp\" \"${ARGV2}\")\n-      else()\n-         file(WRITE \"${_tmpdir}/src.cpp\" \"int main() { return 0; }\")\n-      endif()\n-\n-      execute_process(\n-         COMMAND \"${MIC_CXX}\" -mmic -c -o \"${_tmpdir}/src.o\"\n-         \"${_FLAG}\" \"${_tmpdir}/src.cpp\"\n-         WORKING_DIRECTORY ${CMAKE_BINARY_DIR}\n-         RESULT_VARIABLE ${_RESULT}\n-         OUTPUT_VARIABLE OUTPUT\n-         ERROR_VARIABLE OUTPUT\n-         )\n-\n-      if(${_RESULT} EQUAL 0)\n-         foreach(_fail_regex\n-               \"error: bad value (.*) for .* switch\"       # GNU\n-               \"argument unused during compilation\"        # clang\n-               \"is valid for .* but not for C\\\\\\\\+\\\\\\\\+\"   # GNU\n-               \"unrecognized .*option\"                     # GNU\n-               \"ignored for target\"                        # GNU\n-               \"ignoring unknown option\"                   # MSVC\n-               \"[Uu]nknown option\"                         # HP\n-               \"[Ww]arning: [Oo]ption\"                     # SunPro\n-               \"command option .* is not recognized\"       # XL\n-               \"WARNING: unknown flag:\"                    # Open64\n-               \"command line error\"                        # ICC\n-               \"command line warning\"                      # ICC\n-               \"#10236:\"                                   # ICC: File not found\n-               )\n-            if(\"${OUTPUT}\" MATCHES \"${_fail_regex}\")\n-               set(${_RESULT} FALSE)\n-            endif()\n-         endforeach()\n-      endif()\n-\n-      if(${_RESULT} EQUAL 0)\n-         set(${_RESULT} 1 CACHE INTERNAL \"Test ${_FLAG}\")\n-         message(STATUS \"Performing Test Check MIC C++ Compiler flag ${_FLAG} - Success\")\n-         file(APPEND ${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeOutput.log\n-            \"Performing MIC C++ Compiler Flag Test ${_FLAG} succeded with the following output:\\n\"\n-            \"${OUTPUT}\\n\"\n-            \"COMMAND: ${MIC_CXX} -mmic -c -o ${_tmpdir}/src.o ${_FLAG} ${_tmpdir}/src.cpp\\n\"\n-            )\n-      else()\n-         message(STATUS \"Performing Test Check MIC C++ Compiler flag ${_FLAG} - Failed\")\n-         set(${_RESULT} \"\" CACHE INTERNAL \"Test ${_FLAG}\")\n-         file(APPEND ${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeError.log\n-            \"Performing MIC C++ Compiler Flag Test ${_FLAG} failed with the following output:\\n\"\n-            \"${OUTPUT}\\n\"\n-            \"COMMAND: ${MIC_CXX} -mmic -c -o ${_tmpdir}/src.o ${_FLAG} ${_tmpdir}/src.cpp\\n\"\n-            )\n-      endif()\n-   endif()\n-endmacro()\n-"}, {"sha": "830c1af3dc41e5d9b3ca54f5d3273f9121af8c64", "filename": "cmake/vc/FindMIC.cmake", "status": "removed", "additions": 0, "deletions": 393, "changes": 393, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/FindMIC.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/FindMIC.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/FindMIC.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -1,393 +0,0 @@\n-#  Copyright (C) 2010-2013 Matthias Kretz <kretz@kde.org>\n-#\n-#  This program is free software: you can redistribute it and/or modify\n-#  it under the terms of the GNU General Public License as published by\n-#  the Free Software Foundation, either version 3 of the License, or\n-#  (at your option) any later version.\n-#\n-#  This program is distributed in the hope that it will be useful,\n-#  but WITHOUT ANY WARRANTY; without even the implied warranty of\n-#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-#  GNU General Public License for more details.\n-#\n-#  You should have received a copy of the GNU General Public License\n-#  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n-\n-# This check will search for a MIC compiler and check whether the C and C++\n-# compilers are able to offload via offload pragma and target(mic) attribute.\n-# The project may choose to either build native MIC binaries, or offload\n-# binaries (hybrid code), or both. In the case where only native MIC binaries\n-# are built, the compiler does not need to support offloading\n-#\n-# MIC_NATIVE_FOUND is true if native MIC binaries can be built\n-# MIC_OFFLOAD_FOUND is true if hybrid host/MIC binaries via offload can be built\n-# MIC_FOUND is true if either MIC_NATIVE_FOUND or MIC_OFFLOAD_FOUND is true\n-#\n-# When MIC_NATIVE_FOUND is true you can use the macros\n-# mic_add_definitions\n-# mic_include_directories\n-# mic_set_link_libraries\n-# mic_add_library\n-# mic_add_executable\n-# for building native libraries/executables\n-#\n-# When MIC_OFFLOAD_FOUND is true you use the standard cmake macros to build\n-# libraries and executables but have to make sure manually that the necessary\n-# offload compiler switches are present. You might want to add something like:\n-# if(MIC_OFFLOAD_FOUND)\n-#    AddCompilerFlag(\"-offload-build\")\n-#    AddCompilerFlag(\"-offload-copts=-vec-report=3 -H\")\n-#    AddCompilerFlag(\"-offload-ldopts=-lmylib\")\n-#    AddCompilerFlag(\"-opt-report-phase=offload\")\n-# endif()\n-\n-set(MIC_FOUND false)\n-set(MIC_NATIVE_FOUND false)\n-\n-file(GLOB _intel_dirs \"/opt/intel/composer_xe_*\")\n-list(SORT _intel_dirs)\n-list(REVERSE _intel_dirs)\n-find_path(MIC_SDK_DIR bin/intel64_mic/icpc PATHS\n-   \"$ENV{MIC_SDK_DIR}\"\n-   ${_intel_dirs}\n-   )\n-\n-##############################################################################\n-# First check whether offload works\n-\n-if(NOT DEFINED c_compiler_can_offload OR NOT DEFINED cxx_compiler_can_offload)\n-   set(c_compiler_can_offload FALSE)\n-   set(cxx_compiler_can_offload FALSE)\n-\n-   # For now offload is not supported so skip it\n-#   include(CheckCSourceCompiles)\n-#   include(CheckCXXSourceCompiles)\n-#\n-#   #find_library(MIC_HOST_IMF_LIBRARY   imf   HINTS ENV LIBRARY_PATH)\n-#   #find_library(MIC_HOST_SVML_LIBRARY  svml  HINTS ENV LIBRARY_PATH)\n-#   #find_library(MIC_HOST_INTLC_LIBRARY intlc HINTS ENV LIBRARY_PATH)\n-#\n-#   #set(MIC_HOST_LIBS ${MIC_HOST_IMF_LIBRARY} ${MIC_HOST_SVML_LIBRARY} ${MIC_HOST_INTLC_LIBRARY})\n-#\n-#   set(_mic_offload_test_source \"\n-##ifdef __MIC__\n-##include <immintrin.h>\n-##endif\n-#__attribute__((target(mic))) void test()\n-#{\n-##ifdef __MIC__\n-# __m512 v = _mm512_setzero_ps();\n-# (void)v;\n-##endif\n-#}\n-#\n-#int main()\n-#{\n-##pragma offload target(mic)\n-# test();\n-# return 0;\n-#}\n-#\")\n-#\n-#   set(CMAKE_REQUIRED_FLAGS \"-offload-build\")\n-#   check_c_source_compiles(\"${_mic_offload_test_source}\" c_compiler_can_offload)\n-#   check_cxx_source_compiles(\"${_mic_offload_test_source}\" cxx_compiler_can_offload)\n-#   set(CMAKE_REQUIRED_FLAGS)\n-endif()\n-\n-if(c_compiler_can_offload AND cxx_compiler_can_offload)\n-   message(STATUS \"C/C++ Compiler can offload to MIC.\")\n-   set(MIC_OFFLOAD_FOUND true)\n-else()\n-   message(STATUS \"C/C++ Compiler can NOT offload to MIC.\")\n-   set(MIC_OFFLOAD_FOUND false)\n-endif()\n-\n-##############################################################################\n-# Next check whether everything required for native builds is available\n-\n-find_path(MIC_TARGET_TOOLS_DIR bin/x86_64-k1om-linux-ar HINTS\n-   \"$ENV{MIC_TARGET_TOOLS_DIR}\"\n-   \"${MIC_SDK_DIR}/target\"\n-   \"/usr/linux-k1om-4.7\"\n-   )\n-find_program(MIC_AR x86_64-k1om-linux-ar PATHS \"${MIC_TARGET_TOOLS_DIR}/bin\")\n-find_program(MIC_RANLIB x86_64-k1om-linux-ranlib PATHS \"${MIC_TARGET_TOOLS_DIR}/bin\")\n-find_program(MIC_NATIVELOAD micnativeloadex PATHS \"/opt/intel/mic/bin\")\n-mark_as_advanced(MIC_AR MIC_RANLIB MIC_NATIVELOAD)\n-\n-if(MIC_SDK_DIR AND MIC_AR AND MIC_RANLIB)\n-   find_program(MIC_CC  icc  HINTS \"${MIC_SDK_DIR}/bin\" \"${MIC_SDK_DIR}/bin/intel64\")\n-   find_program(MIC_CXX icpc HINTS \"${MIC_SDK_DIR}/bin\" \"${MIC_SDK_DIR}/bin/intel64\")\n-\n-   find_library(MIC_IMF_LIBRARY   imf      HINTS \"${MIC_SDK_DIR}/compiler/lib/mic\")\n-   find_library(MIC_SVML_LIBRARY  svml     HINTS \"${MIC_SDK_DIR}/compiler/lib/mic\")\n-   find_library(MIC_INTLC_LIBRARY intlc    HINTS \"${MIC_SDK_DIR}/compiler/lib/mic\")\n-   mark_as_advanced(MIC_CC MIC_CXX MIC_IMF_LIBRARY MIC_SVML_LIBRARY MIC_INTLC_LIBRARY)\n-\n-   set(MIC_LIBS ${MIC_IMF_LIBRARY} ${MIC_SVML_LIBRARY} ${MIC_INTLC_LIBRARY})\n-   set(MIC_CFLAGS \"-O2 -vec\")\n-\n-   exec_program(${MIC_CXX} ARGS -V OUTPUT_VARIABLE _mic_icc_version_string)\n-   string(REGEX MATCH \"Version (Mainline)?[0-9. a-zA-Z]+\" Vc_MIC_ICC_VERSION \"${_mic_icc_version_string}\")\n-   string(SUBSTRING \"${Vc_MIC_ICC_VERSION}\" 8 -1 Vc_MIC_ICC_VERSION)\n-   message(STATUS \"MIC ICC Version: \\\"${Vc_MIC_ICC_VERSION}\\\"\")\n-\n-   if(MIC_CC AND MIC_CXX AND MIC_IMF_LIBRARY AND MIC_SVML_LIBRARY AND MIC_INTLC_LIBRARY)\n-      set(MIC_NATIVE_FOUND true)\n-   endif()\n-endif()\n-\n-if(MIC_NATIVE_FOUND OR MIC_OFFLOAD_FOUND)\n-   set(MIC_FOUND true)\n-   list(APPEND CMAKE_MIC_CXX_FLAGS \"-diag-disable 2338\") # this switch statement does not have a default clause\n-   list(APPEND CMAKE_MIC_CXX_FLAGS \"-diag-disable 193\") # zero used for undefined preprocessing identifier \"VC_GCC\"\n-\n-   macro(mic_add_definitions)\n-      add_definitions(${ARGN})\n-      foreach(_def ${ARGN})\n-         set(_mic_cflags ${_mic_cflags} \"${_def}\")\n-      endforeach()\n-   endmacro()\n-   macro(mic_include_directories)\n-      foreach(_dir ${ARGN})\n-         set(_mic_cflags ${_mic_cflags} \"-I${_dir}\")\n-      endforeach()\n-      include_directories(${ARGN})\n-   endmacro()\n-   if(NOT DEFINED MIC_C_FLAGS)\n-      set(MIC_C_FLAGS)\n-   endif()\n-   if(NOT DEFINED MIC_CXX_FLAGS)\n-      set(MIC_CXX_FLAGS)\n-   endif()\n-else()\n-   message(WARNING \"MIC SDK was not found!\")\n-endif()\n-\n-if(MIC_NATIVE_FOUND)\n-   macro(_mic_add_object _target _source _output)\n-      get_filename_component(_abs \"${_source}\" ABSOLUTE)\n-      get_filename_component(_ext \"${_source}\" EXT)\n-      get_filename_component(_tmp \"${_source}\" NAME_WE)\n-      set(${_output} \"${CMAKE_CURRENT_BINARY_DIR}/CMakeFiles/${_target}.dir/${_tmp}${_ext}.mic.o\")\n-      set(_lang CXX)\n-      set(_compiler \"${MIC_CXX}\")\n-      if(_ext STREQUAL \"c\")\n-         set(_lang C)\n-         set(_compiler \"${MIC_CC}\")\n-      endif()\n-\n-      string(TOUPPER \"${CMAKE_BUILD_TYPE}\" _tmp)\n-      string(STRIP \"${CMAKE_MIC_${_lang}_FLAGS} ${CMAKE_${_lang}_FLAGS_${_tmp}} ${_mic_cflags}\" _flags)\n-      string(REPLACE \" \" \";\" _flags \"${_flags} ${ARGN}\")\n-      get_directory_property(_inc INCLUDE_DIRECTORIES)\n-      foreach(_i ${_inc})\n-         list(APPEND _flags \"-I${_i}\")\n-      endforeach()\n-\n-      add_custom_command(OUTPUT \"${${_output}}\"\n-         COMMAND \"${_compiler}\" -mmic\n-         -DVC_IMPL=MIC\n-         ${_flags} -c -o \"${${_output}}\" \"${_abs}\"\n-         DEPENDS \"${_abs}\"\n-         IMPLICIT_DEPENDS ${_lang} \"${_abs}\"\n-         WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}\n-         COMMENT \"Compiling (MIC) ${${_output}}\"\n-         VERBATIM\n-         )\n-   endmacro()\n-   macro(mic_set_link_libraries)\n-      set(_mic_lflags)\n-      foreach(_lib ${ARGN})\n-         get_filename_component(_lpath \"${_lib}\" PATH)\n-         get_filename_component(_lname \"${_lib}\" NAME)\n-         set(_mic_lflags ${_mic_lflags} \"-L${_lpath}\" \"-l${_lname}\")\n-      endforeach()\n-   endmacro()\n-   macro(mic_add_library _target)\n-      set(_state 0)\n-      if(BUILD_SHARED_LIBS)\n-         set(_type SHARED)\n-      else()\n-         set(_type STATIC)\n-      endif()\n-      set(_all ALL)\n-      set(_srcs)\n-      set(_cflags)\n-      set(_libs)\n-      foreach(_arg ${ARGN})\n-         if(_arg MATCHES \"^(STATIC|SHARED|MODULE)$\")\n-            set(_type ${_arg})\n-         elseif(_arg STREQUAL \"EXCLUDE_FROM_ALL\")\n-            set(_all)\n-         elseif(_arg STREQUAL \"COMPILE_FLAGS\")\n-            set(_state 1)\n-         elseif(_arg STREQUAL \"LINK_LIBRARIES\")\n-            set(_state 2)\n-         elseif(_arg STREQUAL \"SOURCES\")\n-            set(_state 0)\n-         elseif(_state EQUAL 0) # SOURCES\n-            set(_srcs ${_srcs} \"${_arg}\")\n-         elseif(_state EQUAL 1) # COMPILE_FLAGS\n-            list(APPEND _cflags \"${_arg}\")\n-         elseif(_state EQUAL 2) # LINK_LIBRARIES\n-            get_filename_component(_lpath \"${_arg}\" PATH)\n-            get_filename_component(_lname \"${_arg}\" NAME)\n-            set(_libs ${_libs} \"-L${_lpath}\" \"-l${_lname}\")\n-         endif()\n-      endforeach()\n-      set(_objects)\n-      set(_objectsStr)\n-      foreach(_src ${_srcs})\n-         _mic_add_object(\"${_target}\" \"${_src}\" _obj ${_cflags})\n-         list(APPEND _objects \"${_obj}\")\n-         set(_objectsStr \"${_objectsStr} \\\"${_obj}\\\"\")\n-      endforeach()\n-\n-      set(_outdir \"${CMAKE_CURRENT_BINARY_DIR}/x86_64-k1om-linux\")\n-      file(MAKE_DIRECTORY \"${_outdir}\")\n-\n-      #TODO: handle STATIC/SHARED/MODULE differently\n-      set(_output \"lib${_target}.a\")\n-      set(_linkscript \"${CMAKE_CURRENT_BINARY_DIR}/CMakeFiles/${_target}.dir/link.txt\")\n-      set(_cleanscript \"CMakeFiles/${_target}.dir/cmake_clean_target.cmake\")\n-      file(WRITE \"${_linkscript}\"\n-         \"${MIC_AR} cr ${_output} ${_objectsStr}\n-${MIC_RANLIB} ${_output}\n-\")\n-      file(WRITE \"${CMAKE_CURRENT_BINARY_DIR}/${_cleanscript}\"\n-         \"FILE(REMOVE_RECURSE \\\"${_output}\\\")\n-\")\n-      add_custom_command(OUTPUT \"${_outdir}/${_output}\"\n-         COMMAND \"${CMAKE_COMMAND}\" -E cmake_link_script \"${_linkscript}\" --verbose=$(VERBOSE)\n-         DEPENDS ${_objects}\n-         WORKING_DIRECTORY \"${_outdir}\"\n-         COMMENT \"Linking (MIC) ${_output}\"\n-         VERBATIM\n-         )\n-      add_custom_target(\"${_target}\" ${_all}\n-         DEPENDS \"${_outdir}/${_output}\"\n-         COMMENT \"\"\n-         SOURCES ${_srcs}\n-         )\n-      set_target_properties(\"${_target}\" PROPERTIES\n-         OUTPUT_NAME \"${_outdir}/${_output}\"\n-         )\n-   endmacro()\n-\n-   macro(mic_add_executable _target)\n-      set(_state 0)\n-      set(_all ALL)\n-      set(_srcs)\n-      set(_cflags)\n-      set(_libs)\n-      set(_libTargets)\n-      set(_dump_asm false)\n-      set(_exec_output_name \"${_target}\")\n-      foreach(_arg ${ARGN})\n-         if(_arg STREQUAL \"EXCLUDE_FROM_ALL\")\n-            set(_all)\n-         elseif(_arg STREQUAL \"COMPILE_FLAGS\")\n-            set(_state 1)\n-         elseif(_arg STREQUAL \"LINK_LIBRARIES\")\n-            set(_state 2)\n-         elseif(_arg STREQUAL \"OUTPUT_NAME\")\n-            set(_state 3)\n-         elseif(_arg STREQUAL \"SOURCES\")\n-            set(_state 0)\n-         elseif(_arg STREQUAL \"DUMP_ASM\")\n-            set(_dump_asm true)\n-         elseif(_state EQUAL 0) # SOURCES\n-            set(_srcs ${_srcs} \"${_arg}\")\n-         elseif(_state EQUAL 1) # COMPILE_FLAGS\n-            set(_cflags ${_cflags} \"${_arg}\")\n-         elseif(_state EQUAL 2) # LINK_LIBRARIES\n-            get_target_property(_tmp \"${_arg}\" OUTPUT_NAME)\n-            if(_tmp)\n-               set(_libs ${_libs} \"${_tmp}\")\n-               set(_libTargets ${_libTargets} \"${_tmp}\" \"${_arg}\")\n-            else()\n-               get_filename_component(_lpath \"${_arg}\" PATH)\n-               get_filename_component(_lname \"${_arg}\" NAME)\n-               set(_libs \"${_libs} \\\"-L${_lpath}\\\" \\\"-l${_lname}\\\"\")\n-               set(_libTargets ${_libTargets} \"${_arg}\")\n-            endif()\n-         elseif(_state EQUAL 3) # OUTPUT_NAME\n-            set(_exec_output_name \"${_arg}\")\n-         endif()\n-      endforeach()\n-      set(_objects)\n-      set(_objectsStr)\n-      foreach(_src ${_srcs})\n-         _mic_add_object(\"${_target}\" \"${_src}\" _obj ${_cflags})\n-         set(_objects ${_objects} \"${_obj}\")\n-         set(_objectsStr \"${_objectsStr} \\\"${_obj}\\\"\")\n-      endforeach()\n-\n-      set(_exec_output \"${CMAKE_CURRENT_BINARY_DIR}/${_exec_output_name}\")\n-      add_custom_command(OUTPUT \"${_exec_output}\"\n-         COMMAND \"${MIC_CXX}\" -mmic\n-         \"-L${MIC_SDK_DIR}/compiler/lib/mic/\"\n-         ${_mic_lflags} ${_objects} -o \"${_exec_output}\"\n-         ${_libs}\n-         DEPENDS ${_objects} ${_libTargets}\n-         WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}\n-         COMMENT \"Linking (MIC) ${_exec_output}\"\n-         VERBATIM\n-         )\n-      set(_dump_asm_output)\n-      if(_dump_asm)\n-         foreach(_src ${_srcs})\n-            get_filename_component(_abs \"${_src}\" ABSOLUTE)\n-            get_filename_component(_name \"${_src}\" NAME)\n-            add_custom_command(OUTPUT \"${_name}.s\"\n-               COMMAND \"${MIC_CXX}\" -mmic\n-               -DVC_IMPL=LRBni ${_mic_cflags} ${_cflags}\n-               ${_abs}\n-               -S -fsource-asm -fno-verbose-asm -o \"${_name}.x\"\n-               COMMAND sh -c \"grep -v ___tag_value '${_name}.x' | c++filt > '${_name}.s'\"\n-               COMMAND rm \"${_name}.x\"\n-               DEPENDS ${_abs}\n-               WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}\n-               COMMENT \"Creating MIC Assembly ${_name}.s\"\n-               VERBATIM\n-               )\n-            set(_dump_asm_output ${_dump_asm_output} \"${CMAKE_CURRENT_BINARY_DIR}/${_name}.s\")\n-         endforeach()\n-      endif()\n-      add_custom_target(\"${_target}\" ${_all}\n-         DEPENDS \"${_exec_output}\" ${_dump_asm_output}\n-         COMMENT \"\"\n-         SOURCES ${_srcs}\n-         )\n-      set_target_properties(\"${_target}\" PROPERTIES OUTPUT_NAME \"${_exec_output_name}\")\n-   endmacro()\n-endif()\n-\n-if(MIC_OFFLOAD_FOUND)\n-   macro(mic_offload _target)\n-      set(_mic_debug)\n-      if(CMAKE_BUILD_TYPE STREQUAL \"Debug\" OR CMAKE_BUILD_TYPE STREQUAL \"RelWithDebInfo\")\n-         set(_mic_debug \"-g\")\n-      endif()\n-      add_target_property(${_target} COMPILE_FLAGS \"-offload-build -DCAN_OFFLOAD ${_mic_debug}\")\n-      set(_offload_ldflags \"${_mic_debug}\")\n-      set(_libTargets)\n-      foreach(_lib ${ARGN})\n-         get_target_property(_tmp \"${_lib}\" OUTPUT_NAME)\n-         if(_tmp)\n-            set(_offload_ldflags \"${_offload_ldflags} ${_tmp}\")\n-            set(_libTargets ${_libTargets} \"${_arg}\")\n-         else()\n-            get_filename_component(_lpath \"${_arg}\" PATH)\n-            get_filename_component(_lname \"${_arg}\" NAME)\n-            set(_offload_ldflags \"${_offload_ldflags} -L${_lpath} -l${_lname}\")\n-         endif()\n-      endforeach()\n-      add_target_property(${_target} LINK_FLAGS \"-offload-build -offload-ldopts=\\\"${_offload_ldflags}\\\" ${_mic_debug}\")\n-      if(_libTargets)\n-         add_dependencies(${_target} ${_libTargets})\n-      endif()\n-   endmacro()\n-endif()"}, {"sha": "6ece876896810dd6823f40c84cfdf8ebe1206466", "filename": "cmake/vc/FindSSE.cmake", "status": "removed", "additions": 0, "deletions": 104, "changes": 104, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/FindSSE.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/FindSSE.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/FindSSE.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -1,104 +0,0 @@\n-# Check if SSE instructions are available on the machine where \n-# the project is compiled.\n-\n-IF(CMAKE_SYSTEM_NAME MATCHES \"Linux\")\n-   EXEC_PROGRAM(cat ARGS \"/proc/cpuinfo\" OUTPUT_VARIABLE CPUINFO)\n-\n-   STRING(REGEX REPLACE \"^.*(sse2).*$\" \"\\\\1\" SSE_THERE ${CPUINFO})\n-   STRING(COMPARE EQUAL \"sse2\" \"${SSE_THERE}\" SSE2_TRUE)\n-   IF (SSE2_TRUE)\n-      set(SSE2_FOUND true CACHE BOOL \"SSE2 available on host\")\n-   ELSE (SSE2_TRUE)\n-      set(SSE2_FOUND false CACHE BOOL \"SSE2 available on host\")\n-   ENDIF (SSE2_TRUE)\n-\n-   # /proc/cpuinfo apparently omits sse3 :(\n-   STRING(REGEX REPLACE \"^.*[^s](sse3).*$\" \"\\\\1\" SSE_THERE ${CPUINFO})\n-   STRING(COMPARE EQUAL \"sse3\" \"${SSE_THERE}\" SSE3_TRUE)\n-   IF (NOT SSE3_TRUE)\n-      STRING(REGEX REPLACE \"^.*(T2300).*$\" \"\\\\1\" SSE_THERE ${CPUINFO})\n-      STRING(COMPARE EQUAL \"T2300\" \"${SSE_THERE}\" SSE3_TRUE)\n-   ENDIF (NOT SSE3_TRUE)\n-\n-   STRING(REGEX REPLACE \"^.*(ssse3).*$\" \"\\\\1\" SSE_THERE ${CPUINFO})\n-   STRING(COMPARE EQUAL \"ssse3\" \"${SSE_THERE}\" SSSE3_TRUE)\n-   IF (SSE3_TRUE OR SSSE3_TRUE)\n-      set(SSE3_FOUND true CACHE BOOL \"SSE3 available on host\")\n-   ELSE (SSE3_TRUE OR SSSE3_TRUE)\n-      set(SSE3_FOUND false CACHE BOOL \"SSE3 available on host\")\n-   ENDIF (SSE3_TRUE OR SSSE3_TRUE)\n-   IF (SSSE3_TRUE)\n-      set(SSSE3_FOUND true CACHE BOOL \"SSSE3 available on host\")\n-   ELSE (SSSE3_TRUE)\n-      set(SSSE3_FOUND false CACHE BOOL \"SSSE3 available on host\")\n-   ENDIF (SSSE3_TRUE)\n-\n-   STRING(REGEX REPLACE \"^.*(sse4_1).*$\" \"\\\\1\" SSE_THERE ${CPUINFO})\n-   STRING(COMPARE EQUAL \"sse4_1\" \"${SSE_THERE}\" SSE41_TRUE)\n-   IF (SSE41_TRUE)\n-      set(SSE4_1_FOUND true CACHE BOOL \"SSE4.1 available on host\")\n-   ELSE (SSE41_TRUE)\n-      set(SSE4_1_FOUND false CACHE BOOL \"SSE4.1 available on host\")\n-   ENDIF (SSE41_TRUE)\n-ELSEIF(CMAKE_SYSTEM_NAME MATCHES \"Darwin\")\n-   EXEC_PROGRAM(\"/usr/sbin/sysctl -n machdep.cpu.features\" OUTPUT_VARIABLE\n-      CPUINFO)\n-\n-   STRING(REGEX REPLACE \"^.*[^S](SSE2).*$\" \"\\\\1\" SSE_THERE ${CPUINFO})\n-   STRING(COMPARE EQUAL \"SSE2\" \"${SSE_THERE}\" SSE2_TRUE)\n-   IF (SSE2_TRUE)\n-      set(SSE2_FOUND true CACHE BOOL \"SSE2 available on host\")\n-   ELSE (SSE2_TRUE)\n-      set(SSE2_FOUND false CACHE BOOL \"SSE2 available on host\")\n-   ENDIF (SSE2_TRUE)\n-\n-   STRING(REGEX REPLACE \"^.*[^S](SSE3).*$\" \"\\\\1\" SSE_THERE ${CPUINFO})\n-   STRING(COMPARE EQUAL \"SSE3\" \"${SSE_THERE}\" SSE3_TRUE)\n-   IF (SSE3_TRUE)\n-      set(SSE3_FOUND true CACHE BOOL \"SSE3 available on host\")\n-   ELSE (SSE3_TRUE)\n-      set(SSE3_FOUND false CACHE BOOL \"SSE3 available on host\")\n-   ENDIF (SSE3_TRUE)\n-\n-   STRING(REGEX REPLACE \"^.*(SSSE3).*$\" \"\\\\1\" SSE_THERE ${CPUINFO})\n-   STRING(COMPARE EQUAL \"SSSE3\" \"${SSE_THERE}\" SSSE3_TRUE)\n-   IF (SSSE3_TRUE)\n-      set(SSSE3_FOUND true CACHE BOOL \"SSSE3 available on host\")\n-   ELSE (SSSE3_TRUE)\n-      set(SSSE3_FOUND false CACHE BOOL \"SSSE3 available on host\")\n-   ENDIF (SSSE3_TRUE)\n-\n-   STRING(REGEX REPLACE \"^.*(SSE4.1).*$\" \"\\\\1\" SSE_THERE ${CPUINFO})\n-   STRING(COMPARE EQUAL \"SSE4.1\" \"${SSE_THERE}\" SSE41_TRUE)\n-   IF (SSE41_TRUE)\n-      set(SSE4_1_FOUND true CACHE BOOL \"SSE4.1 available on host\")\n-   ELSE (SSE41_TRUE)\n-      set(SSE4_1_FOUND false CACHE BOOL \"SSE4.1 available on host\")\n-   ENDIF (SSE41_TRUE)\n-ELSEIF(CMAKE_SYSTEM_NAME MATCHES \"Windows\")\n-   # TODO\n-   set(SSE2_FOUND   true  CACHE BOOL \"SSE2 available on host\")\n-   set(SSE3_FOUND   false CACHE BOOL \"SSE3 available on host\")\n-   set(SSSE3_FOUND  false CACHE BOOL \"SSSE3 available on host\")\n-   set(SSE4_1_FOUND false CACHE BOOL \"SSE4.1 available on host\")\n-ELSE(CMAKE_SYSTEM_NAME MATCHES \"Linux\")\n-   set(SSE2_FOUND   true  CACHE BOOL \"SSE2 available on host\")\n-   set(SSE3_FOUND   false CACHE BOOL \"SSE3 available on host\")\n-   set(SSSE3_FOUND  false CACHE BOOL \"SSSE3 available on host\")\n-   set(SSE4_1_FOUND false CACHE BOOL \"SSE4.1 available on host\")\n-ENDIF(CMAKE_SYSTEM_NAME MATCHES \"Linux\")\n-\n-if(NOT SSE2_FOUND)\n-      MESSAGE(STATUS \"Could not find hardware support for SSE2 on this machine.\")\n-endif(NOT SSE2_FOUND)\n-if(NOT SSE3_FOUND)\n-      MESSAGE(STATUS \"Could not find hardware support for SSE3 on this machine.\")\n-endif(NOT SSE3_FOUND)\n-if(NOT SSSE3_FOUND)\n-      MESSAGE(STATUS \"Could not find hardware support for SSSE3 on this machine.\")\n-endif(NOT SSSE3_FOUND)\n-if(NOT SSE4_1_FOUND)\n-      MESSAGE(STATUS \"Could not find hardware support for SSE4.1 on this machine.\")\n-endif(NOT SSE4_1_FOUND)\n-\n-mark_as_advanced(SSE2_FOUND SSE3_FOUND SSSE3_FOUND SSE4_1_FOUND)"}, {"sha": "704bc08dc80f98ef67905ebcf0b2d52c825e983f", "filename": "cmake/vc/FindVc.cmake", "status": "removed", "additions": 0, "deletions": 61, "changes": 61, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/FindVc.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/FindVc.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/FindVc.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -1,61 +0,0 @@\n-# Locate the Vc template library. Vc can be found at http://gitorious.org/Vc/\n-#\n-# This file is meant to be copied into projects that want to use Vc. It will\n-# search for VcConfig.cmake, which ships with Vc and will provide up-to-date\n-# buildsystem changes. Thus there should not be any need to update FindVc.cmake\n-# again after you integrated it into your project.\n-#\n-# This module defines the following variables:\n-# Vc_FOUND\n-# Vc_INCLUDE_DIR\n-# Vc_LIBRARIES\n-# Vc_DEFINITIONS\n-# Vc_VERSION_MAJOR\n-# Vc_VERSION_MINOR\n-# Vc_VERSION_PATCH\n-# Vc_VERSION\n-# Vc_VERSION_STRING\n-# Vc_INSTALL_DIR\n-# Vc_LIB_DIR\n-# Vc_CMAKE_MODULES_DIR\n-#\n-# The following two variables are set according to the compiler used. Feel free\n-# to use them to skip whole compilation units.\n-# Vc_SSE_INTRINSICS_BROKEN\n-# Vc_AVX_INTRINSICS_BROKEN\n-#\n-#=============================================================================\n-# Copyright 2009-2012   Matthias Kretz <kretz@kde.org>\n-#\n-# Redistribution and use in source and binary forms, with or without\n-# modification, are permitted provided that the following conditions are\n-# met:\n-#\n-#  * Redistributions of source code must retain the above copyright notice,\n-#    this list of conditions and the following disclaimer.\n-#\n-#  * Redistributions in binary form must reproduce the above copyright notice,\n-#    this list of conditions and the following disclaimer in the documentation\n-#    and/or other materials provided with the distribution.\n-#\n-#  * The names of Kitware, Inc., the Insight Consortium, or the names of\n-#    any consortium members, or of any contributors, may not be used to\n-#    endorse or promote products derived from this software without\n-#    specific prior written permission.\n-#\n-# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS ``AS IS''\n-# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n-# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n-# ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR\n-# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n-# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n-# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n-# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n-# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n-# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n-#=============================================================================\n-\n-find_package(Vc ${Vc_FIND_VERSION} QUIET NO_MODULE PATHS $ENV{HOME} /opt/Vc)\n-\n-include(FindPackageHandleStandardArgs)\n-find_package_handle_standard_args(Vc CONFIG_MODE)"}, {"sha": "0bdcae3cfee0c6e0461ca7ce3186c2bd5cebcd4b", "filename": "cmake/vc/OptimizeForArchitecture.cmake", "status": "removed", "additions": 0, "deletions": 468, "changes": 468, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/OptimizeForArchitecture.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/OptimizeForArchitecture.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/OptimizeForArchitecture.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -1,468 +0,0 @@\n-#=============================================================================\n-# Copyright 2010-2013 Matthias Kretz <kretz@kde.org>\n-#\n-# Redistribution and use in source and binary forms, with or without\n-# modification, are permitted provided that the following conditions are\n-# met:\n-#\n-#  * Redistributions of source code must retain the above copyright notice,\n-#    this list of conditions and the following disclaimer.\n-#\n-#  * Redistributions in binary form must reproduce the above copyright notice,\n-#    this list of conditions and the following disclaimer in the documentation\n-#    and/or other materials provided with the distribution.\n-#\n-#  * The names of Kitware, Inc., the Insight Consortium, or the names of\n-#    any consortium members, or of any contributors, may not be used to\n-#    endorse or promote products derived from this software without\n-#    specific prior written permission.\n-#\n-# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS ``AS IS''\n-# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n-# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n-# ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR\n-# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n-# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n-# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n-# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n-# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n-# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n-#=============================================================================\n-\n-get_filename_component(_currentDir \"${CMAKE_CURRENT_LIST_FILE}\" PATH)\n-include(\"${_currentDir}/AddCompilerFlag.cmake\")\n-include(CheckIncludeFile)\n-\n-macro(_my_find _list _value _ret)\n-   list(FIND ${_list} \"${_value}\" _found)\n-   if(_found EQUAL -1)\n-      set(${_ret} FALSE)\n-   else(_found EQUAL -1)\n-      set(${_ret} TRUE)\n-   endif(_found EQUAL -1)\n-endmacro(_my_find)\n-\n-macro(AutodetectHostArchitecture)\n-   set(TARGET_ARCHITECTURE \"generic\")\n-   set(Vc_ARCHITECTURE_FLAGS)\n-   set(_vendor_id)\n-   set(_cpu_family)\n-   set(_cpu_model)\n-   if(CMAKE_SYSTEM_NAME STREQUAL \"Linux\")\n-      file(READ \"/proc/cpuinfo\" _cpuinfo)\n-      string(REGEX REPLACE \".*vendor_id[ \\t]*:[ \\t]+([a-zA-Z0-9_-]+).*\" \"\\\\1\" _vendor_id \"${_cpuinfo}\")\n-      string(REGEX REPLACE \".*cpu family[ \\t]*:[ \\t]+([a-zA-Z0-9_-]+).*\" \"\\\\1\" _cpu_family \"${_cpuinfo}\")\n-      string(REGEX REPLACE \".*model[ \\t]*:[ \\t]+([a-zA-Z0-9_-]+).*\" \"\\\\1\" _cpu_model \"${_cpuinfo}\")\n-      string(REGEX REPLACE \".*flags[ \\t]*:[ \\t]+([^\\n]+).*\" \"\\\\1\" _cpu_flags \"${_cpuinfo}\")\n-   elseif(CMAKE_SYSTEM_NAME STREQUAL \"Darwin\")\n-      exec_program(\"/usr/sbin/sysctl -n machdep.cpu.vendor\" OUTPUT_VARIABLE _vendor_id)\n-      exec_program(\"/usr/sbin/sysctl -n machdep.cpu.model\"  OUTPUT_VARIABLE _cpu_model)\n-      exec_program(\"/usr/sbin/sysctl -n machdep.cpu.family\" OUTPUT_VARIABLE _cpu_family)\n-      exec_program(\"/usr/sbin/sysctl -n machdep.cpu.features\" OUTPUT_VARIABLE _cpu_flags)\n-      string(TOLOWER \"${_cpu_flags}\" _cpu_flags)\n-      string(REPLACE \".\" \"_\" _cpu_flags \"${_cpu_flags}\")\n-   elseif(CMAKE_SYSTEM_NAME STREQUAL \"Windows\")\n-      get_filename_component(_vendor_id \"[HKEY_LOCAL_MACHINE\\\\Hardware\\\\Description\\\\System\\\\CentralProcessor\\\\0;VendorIdentifier]\" NAME CACHE)\n-      get_filename_component(_cpu_id \"[HKEY_LOCAL_MACHINE\\\\Hardware\\\\Description\\\\System\\\\CentralProcessor\\\\0;Identifier]\" NAME CACHE)\n-      mark_as_advanced(_vendor_id _cpu_id)\n-      string(REGEX REPLACE \".* Family ([0-9]+) .*\" \"\\\\1\" _cpu_family \"${_cpu_id}\")\n-      string(REGEX REPLACE \".* Model ([0-9]+) .*\" \"\\\\1\" _cpu_model \"${_cpu_id}\")\n-   endif(CMAKE_SYSTEM_NAME STREQUAL \"Linux\")\n-   if(_vendor_id STREQUAL \"GenuineIntel\")\n-      if(_cpu_family EQUAL 6)\n-         # Any recent Intel CPU except NetBurst\n-         if(_cpu_model EQUAL 58)\n-            set(TARGET_ARCHITECTURE \"ivy-bridge\")\n-         elseif(_cpu_model EQUAL 47) # Xeon E7 4860\n-            set(TARGET_ARCHITECTURE \"westmere\")\n-         elseif(_cpu_model EQUAL 46) # Xeon 7500 series\n-            set(TARGET_ARCHITECTURE \"westmere\")\n-         elseif(_cpu_model EQUAL 45) # Xeon TNG\n-            set(TARGET_ARCHITECTURE \"sandy-bridge\")\n-         elseif(_cpu_model EQUAL 44) # Xeon 5600 series\n-            set(TARGET_ARCHITECTURE \"westmere\")\n-         elseif(_cpu_model EQUAL 42) # Core TNG\n-            set(TARGET_ARCHITECTURE \"sandy-bridge\")\n-         elseif(_cpu_model EQUAL 37) # Core i7/i5/i3\n-            set(TARGET_ARCHITECTURE \"westmere\")\n-         elseif(_cpu_model EQUAL 31) # Core i7/i5\n-            set(TARGET_ARCHITECTURE \"westmere\")\n-         elseif(_cpu_model EQUAL 30) # Core i7/i5\n-            set(TARGET_ARCHITECTURE \"westmere\")\n-         elseif(_cpu_model EQUAL 29)\n-            set(TARGET_ARCHITECTURE \"penryn\")\n-         elseif(_cpu_model EQUAL 28)\n-            set(TARGET_ARCHITECTURE \"atom\")\n-         elseif(_cpu_model EQUAL 26)\n-            set(TARGET_ARCHITECTURE \"nehalem\")\n-         elseif(_cpu_model EQUAL 23)\n-            set(TARGET_ARCHITECTURE \"penryn\")\n-         elseif(_cpu_model EQUAL 15)\n-            set(TARGET_ARCHITECTURE \"merom\")\n-         elseif(_cpu_model EQUAL 14)\n-            set(TARGET_ARCHITECTURE \"core\")\n-         elseif(_cpu_model LESS 14)\n-            message(WARNING \"Your CPU (family ${_cpu_family}, model ${_cpu_model}) is not known. Auto-detection of optimization flags failed and will use the generic CPU settings with SSE2.\")\n-            set(TARGET_ARCHITECTURE \"generic\")\n-         else()\n-            message(WARNING \"Your CPU (family ${_cpu_family}, model ${_cpu_model}) is not known. Auto-detection of optimization flags failed and will use the 65nm Core 2 CPU settings.\")\n-            set(TARGET_ARCHITECTURE \"merom\")\n-         endif()\n-      elseif(_cpu_family EQUAL 7) # Itanium (not supported)\n-         message(WARNING \"Your CPU (Itanium: family ${_cpu_family}, model ${_cpu_model}) is not supported by OptimizeForArchitecture.cmake.\")\n-      elseif(_cpu_family EQUAL 15) # NetBurst\n-         list(APPEND _available_vector_units_list \"sse\" \"sse2\")\n-         if(_cpu_model GREATER 2) # Not sure whether this must be 3 or even 4 instead\n-            list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\")\n-         endif(_cpu_model GREATER 2)\n-      endif(_cpu_family EQUAL 6)\n-   elseif(_vendor_id STREQUAL \"AuthenticAMD\")\n-      if(_cpu_family EQUAL 21) # 15h\n-         if(_cpu_model LESS 2)\n-            set(TARGET_ARCHITECTURE \"bulldozer\")\n-         else()\n-            set(TARGET_ARCHITECTURE \"piledriver\")\n-         endif()\n-      elseif(_cpu_family EQUAL 20) # 14h\n-      elseif(_cpu_family EQUAL 18) # 12h\n-      elseif(_cpu_family EQUAL 16) # 10h\n-         set(TARGET_ARCHITECTURE \"barcelona\")\n-      elseif(_cpu_family EQUAL 15)\n-         set(TARGET_ARCHITECTURE \"k8\")\n-         if(_cpu_model GREATER 64) # I don't know the right number to put here. This is just a guess from the hardware I have access to\n-            set(TARGET_ARCHITECTURE \"k8-sse3\")\n-         endif(_cpu_model GREATER 64)\n-      endif()\n-   endif(_vendor_id STREQUAL \"GenuineIntel\")\n-endmacro()\n-\n-macro(OptimizeForArchitecture)\n-   set(TARGET_ARCHITECTURE \"auto\" CACHE STRING \"CPU architecture to optimize for. Using an incorrect setting here can result in crashes of the resulting binary because of invalid instructions used.\\nSetting the value to \\\"auto\\\" will try to optimize for the architecture where cmake is called.\\nOther supported values are: \\\"none\\\", \\\"generic\\\", \\\"core\\\", \\\"merom\\\" (65nm Core2), \\\"penryn\\\" (45nm Core2), \\\"nehalem\\\", \\\"westmere\\\", \\\"sandy-bridge\\\", \\\"ivy-bridge\\\", \\\"atom\\\", \\\"k8\\\", \\\"k8-sse3\\\", \\\"barcelona\\\", \\\"istanbul\\\", \\\"magny-cours\\\", \\\"bulldozer\\\", \\\"interlagos\\\", \\\"piledriver\\\".\")\n-   set(_force)\n-   if(NOT _last_target_arch STREQUAL \"${TARGET_ARCHITECTURE}\")\n-      message(STATUS \"target changed from \\\"${_last_target_arch}\\\" to \\\"${TARGET_ARCHITECTURE}\\\"\")\n-      set(_force FORCE)\n-   endif()\n-   set(_last_target_arch \"${TARGET_ARCHITECTURE}\" CACHE STRING \"\" FORCE)\n-   mark_as_advanced(_last_target_arch)\n-   string(TOLOWER \"${TARGET_ARCHITECTURE}\" TARGET_ARCHITECTURE)\n-\n-   set(_march_flag_list)\n-   set(_available_vector_units_list)\n-\n-   if(TARGET_ARCHITECTURE STREQUAL \"auto\")\n-      AutodetectHostArchitecture()\n-      message(STATUS \"Detected CPU: ${TARGET_ARCHITECTURE}\")\n-   endif(TARGET_ARCHITECTURE STREQUAL \"auto\")\n-\n-   if(TARGET_ARCHITECTURE STREQUAL \"core\")\n-      list(APPEND _march_flag_list \"core2\")\n-      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\")\n-   elseif(TARGET_ARCHITECTURE STREQUAL \"merom\")\n-      list(APPEND _march_flag_list \"merom\")\n-      list(APPEND _march_flag_list \"core2\")\n-      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\")\n-   elseif(TARGET_ARCHITECTURE STREQUAL \"penryn\")\n-      list(APPEND _march_flag_list \"penryn\")\n-      list(APPEND _march_flag_list \"core2\")\n-      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\")\n-      message(STATUS \"Sadly the Penryn architecture exists in variants with SSE4.1 and without SSE4.1.\")\n-      if(_cpu_flags MATCHES \"sse4_1\")\n-         message(STATUS \"SSE4.1: enabled (auto-detected from this computer's CPU flags)\")\n-         list(APPEND _available_vector_units_list \"sse4.1\")\n-      else()\n-         message(STATUS \"SSE4.1: disabled (auto-detected from this computer's CPU flags)\")\n-      endif()\n-   elseif(TARGET_ARCHITECTURE STREQUAL \"nehalem\")\n-      list(APPEND _march_flag_list \"nehalem\")\n-      list(APPEND _march_flag_list \"corei7\")\n-      list(APPEND _march_flag_list \"core2\")\n-      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\" \"sse4.1\" \"sse4.2\")\n-   elseif(TARGET_ARCHITECTURE STREQUAL \"westmere\")\n-      list(APPEND _march_flag_list \"westmere\")\n-      list(APPEND _march_flag_list \"corei7\")\n-      list(APPEND _march_flag_list \"core2\")\n-      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\" \"sse4.1\" \"sse4.2\")\n-   elseif(TARGET_ARCHITECTURE STREQUAL \"ivy-bridge\")\n-      list(APPEND _march_flag_list \"core-avx-i\")\n-      list(APPEND _march_flag_list \"corei7-avx\")\n-      list(APPEND _march_flag_list \"core2\")\n-      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\" \"sse4.1\" \"sse4.2\" \"avx\" \"rdrnd\" \"f16c\")\n-   elseif(TARGET_ARCHITECTURE STREQUAL \"sandy-bridge\")\n-      list(APPEND _march_flag_list \"sandybridge\")\n-      list(APPEND _march_flag_list \"corei7-avx\")\n-      list(APPEND _march_flag_list \"core2\")\n-      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\" \"sse4.1\" \"sse4.2\" \"avx\")\n-   elseif(TARGET_ARCHITECTURE STREQUAL \"atom\")\n-      list(APPEND _march_flag_list \"atom\")\n-      list(APPEND _march_flag_list \"core2\")\n-      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\")\n-   elseif(TARGET_ARCHITECTURE STREQUAL \"k8\")\n-      list(APPEND _march_flag_list \"k8\")\n-      list(APPEND _available_vector_units_list \"sse\" \"sse2\")\n-   elseif(TARGET_ARCHITECTURE STREQUAL \"k8-sse3\")\n-      list(APPEND _march_flag_list \"k8-sse3\")\n-      list(APPEND _march_flag_list \"k8\")\n-      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\")\n-   elseif(TARGET_ARCHITECTURE STREQUAL \"piledriver\")\n-      list(APPEND _march_flag_list \"bdver2\")\n-      list(APPEND _march_flag_list \"bdver1\")\n-      list(APPEND _march_flag_list \"bulldozer\")\n-      list(APPEND _march_flag_list \"barcelona\")\n-      list(APPEND _march_flag_list \"core2\")\n-      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\" \"sse4a\" \"sse4.1\" \"sse4.2\" \"avx\" \"xop\" \"fma4\" \"fma\" \"f16c\")\n-   elseif(TARGET_ARCHITECTURE STREQUAL \"interlagos\")\n-      list(APPEND _march_flag_list \"bdver1\")\n-      list(APPEND _march_flag_list \"bulldozer\")\n-      list(APPEND _march_flag_list \"barcelona\")\n-      list(APPEND _march_flag_list \"core2\")\n-      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\" \"sse4a\" \"sse4.1\" \"sse4.2\" \"avx\" \"xop\" \"fma4\")\n-   elseif(TARGET_ARCHITECTURE STREQUAL \"bulldozer\")\n-      list(APPEND _march_flag_list \"bdver1\")\n-      list(APPEND _march_flag_list \"bulldozer\")\n-      list(APPEND _march_flag_list \"barcelona\")\n-      list(APPEND _march_flag_list \"core2\")\n-      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\" \"sse4a\" \"sse4.1\" \"sse4.2\" \"avx\" \"xop\" \"fma4\")\n-   elseif(TARGET_ARCHITECTURE STREQUAL \"barcelona\")\n-      list(APPEND _march_flag_list \"barcelona\")\n-      list(APPEND _march_flag_list \"core2\")\n-      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"sse4a\")\n-   elseif(TARGET_ARCHITECTURE STREQUAL \"istanbul\")\n-      list(APPEND _march_flag_list \"barcelona\")\n-      list(APPEND _march_flag_list \"core2\")\n-      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"sse4a\")\n-   elseif(TARGET_ARCHITECTURE STREQUAL \"magny-cours\")\n-      list(APPEND _march_flag_list \"barcelona\")\n-      list(APPEND _march_flag_list \"core2\")\n-      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"sse4a\")\n-   elseif(TARGET_ARCHITECTURE STREQUAL \"generic\")\n-      list(APPEND _march_flag_list \"generic\")\n-   elseif(TARGET_ARCHITECTURE STREQUAL \"none\")\n-      # add this clause to remove it from the else clause\n-   else(TARGET_ARCHITECTURE STREQUAL \"core\")\n-      message(FATAL_ERROR \"Unknown target architecture: \\\"${TARGET_ARCHITECTURE}\\\". Please set TARGET_ARCHITECTURE to a supported value.\")\n-   endif(TARGET_ARCHITECTURE STREQUAL \"core\")\n-\n-   if(NOT TARGET_ARCHITECTURE STREQUAL \"none\")\n-      set(_disable_vector_unit_list)\n-      set(_enable_vector_unit_list)\n-      _my_find(_available_vector_units_list \"sse2\" SSE2_FOUND)\n-      _my_find(_available_vector_units_list \"sse3\" SSE3_FOUND)\n-      _my_find(_available_vector_units_list \"ssse3\" SSSE3_FOUND)\n-      _my_find(_available_vector_units_list \"sse4.1\" SSE4_1_FOUND)\n-      _my_find(_available_vector_units_list \"sse4.2\" SSE4_2_FOUND)\n-      _my_find(_available_vector_units_list \"sse4a\" SSE4a_FOUND)\n-      if(DEFINED Vc_AVX_INTRINSICS_BROKEN AND Vc_AVX_INTRINSICS_BROKEN)\n-         UserWarning(\"AVX disabled per default because of old/broken compiler\")\n-         set(AVX_FOUND false)\n-         set(XOP_FOUND false)\n-         set(FMA4_FOUND false)\n-         set(AVX2_FOUND false)\n-      else()\n-         _my_find(_available_vector_units_list \"avx\" AVX_FOUND)\n-         if(DEFINED Vc_FMA4_INTRINSICS_BROKEN AND Vc_FMA4_INTRINSICS_BROKEN)\n-            UserWarning(\"FMA4 disabled per default because of old/broken compiler\")\n-            set(FMA4_FOUND false)\n-         else()\n-            _my_find(_available_vector_units_list \"fma4\" FMA4_FOUND)\n-         endif()\n-         if(DEFINED Vc_XOP_INTRINSICS_BROKEN AND Vc_XOP_INTRINSICS_BROKEN)\n-            UserWarning(\"XOP disabled per default because of old/broken compiler\")\n-            set(XOP_FOUND false)\n-         else()\n-            _my_find(_available_vector_units_list \"xop\" XOP_FOUND)\n-         endif()\n-         if(DEFINED Vc_AVX2_INTRINSICS_BROKEN AND Vc_AVX2_INTRINSICS_BROKEN)\n-            UserWarning(\"AVX2 disabled per default because of old/broken compiler\")\n-            set(AVX2_FOUND false)\n-         else()\n-            _my_find(_available_vector_units_list \"avx2\" AVX2_FOUND)\n-         endif()\n-      endif()\n-      set(USE_SSE2   ${SSE2_FOUND}   CACHE BOOL \"Use SSE2. If SSE2 instructions are not enabled the SSE implementation will be disabled.\" ${_force})\n-      set(USE_SSE3   ${SSE3_FOUND}   CACHE BOOL \"Use SSE3. If SSE3 instructions are not enabled they will be emulated.\" ${_force})\n-      set(USE_SSSE3  ${SSSE3_FOUND}  CACHE BOOL \"Use SSSE3. If SSSE3 instructions are not enabled they will be emulated.\" ${_force})\n-      set(USE_SSE4_1 ${SSE4_1_FOUND} CACHE BOOL \"Use SSE4.1. If SSE4.1 instructions are not enabled they will be emulated.\" ${_force})\n-      set(USE_SSE4_2 ${SSE4_2_FOUND} CACHE BOOL \"Use SSE4.2. If SSE4.2 instructions are not enabled they will be emulated.\" ${_force})\n-      set(USE_SSE4a  ${SSE4a_FOUND}  CACHE BOOL \"Use SSE4a. If SSE4a instructions are not enabled they will be emulated.\" ${_force})\n-      set(USE_AVX    ${AVX_FOUND}    CACHE BOOL \"Use AVX. This will double some of the vector sizes relative to SSE.\" ${_force})\n-      set(USE_AVX2   ${AVX2_FOUND}   CACHE BOOL \"Use AVX2. This will double all of the vector sizes relative to SSE.\" ${_force})\n-      set(USE_XOP    ${XOP_FOUND}    CACHE BOOL \"Use XOP.\" ${_force})\n-      set(USE_FMA4   ${FMA4_FOUND}   CACHE BOOL \"Use FMA4.\" ${_force})\n-      mark_as_advanced(USE_SSE2 USE_SSE3 USE_SSSE3 USE_SSE4_1 USE_SSE4_2 USE_SSE4a USE_AVX USE_AVX2 USE_XOP USE_FMA4)\n-      if(USE_SSE2)\n-         list(APPEND _enable_vector_unit_list \"sse2\")\n-      else(USE_SSE2)\n-         list(APPEND _disable_vector_unit_list \"sse2\")\n-      endif(USE_SSE2)\n-      if(USE_SSE3)\n-         list(APPEND _enable_vector_unit_list \"sse3\")\n-      else(USE_SSE3)\n-         list(APPEND _disable_vector_unit_list \"sse3\")\n-      endif(USE_SSE3)\n-      if(USE_SSSE3)\n-         list(APPEND _enable_vector_unit_list \"ssse3\")\n-      else(USE_SSSE3)\n-         list(APPEND _disable_vector_unit_list \"ssse3\")\n-      endif(USE_SSSE3)\n-      if(USE_SSE4_1)\n-         list(APPEND _enable_vector_unit_list \"sse4.1\")\n-      else(USE_SSE4_1)\n-         list(APPEND _disable_vector_unit_list \"sse4.1\")\n-      endif(USE_SSE4_1)\n-      if(USE_SSE4_2)\n-         list(APPEND _enable_vector_unit_list \"sse4.2\")\n-      else(USE_SSE4_2)\n-         list(APPEND _disable_vector_unit_list \"sse4.2\")\n-      endif(USE_SSE4_2)\n-      if(USE_SSE4a)\n-         list(APPEND _enable_vector_unit_list \"sse4a\")\n-      else(USE_SSE4a)\n-         list(APPEND _disable_vector_unit_list \"sse4a\")\n-      endif(USE_SSE4a)\n-      if(USE_AVX)\n-         list(APPEND _enable_vector_unit_list \"avx\")\n-         # we want SSE intrinsics to result in instructions using the VEX prefix.\n-         # Otherwise integer ops (which require the older SSE intrinsics) would\n-         # always have a large penalty.\n-         list(APPEND _enable_vector_unit_list \"sse2avx\")\n-      else(USE_AVX)\n-         list(APPEND _disable_vector_unit_list \"avx\")\n-      endif(USE_AVX)\n-      if(USE_XOP)\n-         list(APPEND _enable_vector_unit_list \"xop\")\n-      else()\n-         list(APPEND _disable_vector_unit_list \"xop\")\n-      endif()\n-      if(USE_FMA4)\n-         list(APPEND _enable_vector_unit_list \"fma4\")\n-      else()\n-         list(APPEND _disable_vector_unit_list \"fma4\")\n-      endif()\n-      if(USE_AVX2)\n-         list(APPEND _enable_vector_unit_list \"avx2\")\n-      else()\n-         list(APPEND _disable_vector_unit_list \"avx2\")\n-      endif()\n-      if(MSVC)\n-         # MSVC on 32 bit can select /arch:SSE2 (since 2010 also /arch:AVX)\n-         # MSVC on 64 bit cannot select anything (should have changed with MSVC 2010)\n-         _my_find(_enable_vector_unit_list \"avx\" _avx)\n-         set(_avx_flag FALSE)\n-         if(_avx)\n-            AddCompilerFlag(\"/arch:AVX\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS CXX_RESULT _avx_flag)\n-         endif()\n-         if(NOT _avx_flag)\n-            _my_find(_enable_vector_unit_list \"sse2\" _found)\n-            if(_found)\n-               AddCompilerFlag(\"/arch:SSE2\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n-            endif()\n-         endif()\n-         foreach(_flag ${_enable_vector_unit_list})\n-            string(TOUPPER \"${_flag}\" _flag)\n-            string(REPLACE \".\" \"_\" _flag \"__${_flag}__\")\n-            add_definitions(\"-D${_flag}\")\n-         endforeach(_flag)\n-      elseif(CMAKE_CXX_COMPILER MATCHES \"/(icpc|icc)$\") # ICC (on Linux)\n-         _my_find(_available_vector_units_list \"avx2\"    _found)\n-         if(_found)\n-            AddCompilerFlag(\"-xCORE-AVX2\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n-         else(_found)\n-            _my_find(_available_vector_units_list \"f16c\"    _found)\n-            if(_found)\n-               AddCompilerFlag(\"-xCORE-AVX-I\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n-            else(_found)\n-               _my_find(_available_vector_units_list \"avx\"    _found)\n-               if(_found)\n-                  AddCompilerFlag(\"-xAVX\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n-               else(_found)\n-                  _my_find(_available_vector_units_list \"sse4.2\" _found)\n-                  if(_found)\n-                     AddCompilerFlag(\"-xSSE4.2\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n-                  else(_found)\n-                     _my_find(_available_vector_units_list \"sse4.1\" _found)\n-                     if(_found)\n-                        AddCompilerFlag(\"-xSSE4.1\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n-                     else(_found)\n-                        _my_find(_available_vector_units_list \"ssse3\"  _found)\n-                        if(_found)\n-                           AddCompilerFlag(\"-xSSSE3\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n-                        else(_found)\n-                           _my_find(_available_vector_units_list \"sse3\"   _found)\n-                           if(_found)\n-                              # If the target host is an AMD machine then we still want to use -xSSE2 because the binary would refuse to run at all otherwise\n-                              _my_find(_march_flag_list \"barcelona\" _found)\n-                              if(NOT _found)\n-                                 _my_find(_march_flag_list \"k8-sse3\" _found)\n-                              endif(NOT _found)\n-                              if(_found)\n-                                 AddCompilerFlag(\"-xSSE2\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n-                              else(_found)\n-                                 AddCompilerFlag(\"-xSSE3\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n-                              endif(_found)\n-                           else(_found)\n-                              _my_find(_available_vector_units_list \"sse2\"   _found)\n-                              if(_found)\n-                                 AddCompilerFlag(\"-xSSE2\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n-                              endif(_found)\n-                           endif(_found)\n-                        endif(_found)\n-                     endif(_found)\n-                  endif(_found)\n-               endif(_found)\n-            endif(_found)\n-         endif(_found)\n-      else() # not MSVC and not ICC => GCC, Clang, Open64\n-         foreach(_flag ${_march_flag_list})\n-            AddCompilerFlag(\"-march=${_flag}\" CXX_RESULT _good CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n-            if(_good)\n-               break()\n-            endif(_good)\n-         endforeach(_flag)\n-         foreach(_flag ${_enable_vector_unit_list})\n-            AddCompilerFlag(\"-m${_flag}\" CXX_RESULT _result CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n-            if(_result)\n-               set(_header FALSE)\n-               if(_flag STREQUAL \"sse3\")\n-                  set(_header \"pmmintrin.h\")\n-               elseif(_flag STREQUAL \"ssse3\")\n-                  set(_header \"tmmintrin.h\")\n-               elseif(_flag STREQUAL \"sse4.1\")\n-                  set(_header \"smmintrin.h\")\n-               elseif(_flag STREQUAL \"sse4.2\")\n-                  set(_header \"smmintrin.h\")\n-               elseif(_flag STREQUAL \"sse4a\")\n-                  set(_header \"ammintrin.h\")\n-               elseif(_flag STREQUAL \"avx\")\n-                  set(_header \"immintrin.h\")\n-               elseif(_flag STREQUAL \"avx2\")\n-                  set(_header \"immintrin.h\")\n-               elseif(_flag STREQUAL \"fma4\")\n-                  set(_header \"x86intrin.h\")\n-               elseif(_flag STREQUAL \"xop\")\n-                  set(_header \"x86intrin.h\")\n-               endif()\n-               set(_resultVar \"HAVE_${_header}\")\n-               string(REPLACE \".\" \"_\" _resultVar \"${_resultVar}\")\n-               if(_header)\n-                  CHECK_INCLUDE_FILE(\"${_header}\" ${_resultVar} \"-m${_flag}\")\n-                  if(NOT ${_resultVar})\n-                     set(_useVar \"USE_${_flag}\")\n-                     string(TOUPPER \"${_useVar}\" _useVar)\n-                     string(REPLACE \".\" \"_\" _useVar \"${_useVar}\")\n-                     message(STATUS \"disabling ${_useVar} because ${_header} is missing\")\n-                     set(${_useVar} FALSE)\n-                     list(APPEND _disable_vector_unit_list \"${_flag}\")\n-                  endif()\n-               endif()\n-               if(NOT _header OR ${_resultVar})\n-                  set(Vc_ARCHITECTURE_FLAGS \"${Vc_ARCHITECTURE_FLAGS} -m${_flag}\")\n-               endif()\n-            endif()\n-         endforeach(_flag)\n-         foreach(_flag ${_disable_vector_unit_list})\n-            AddCompilerFlag(\"-mno-${_flag}\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n-         endforeach(_flag)\n-      endif()\n-   endif()\n-endmacro(OptimizeForArchitecture)"}, {"sha": "0be6ad240d7fb29f603e364da5fe0e72951c4eac", "filename": "cmake/vc/UserWarning.cmake", "status": "removed", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/UserWarning.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/UserWarning.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/UserWarning.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -1,9 +0,0 @@\n-macro(UserWarning _msg)\n-   if(\"$ENV{DASHBOARD_TEST_FROM_CTEST}\" STREQUAL \"\")\n-      # developer (non-dashboard) build\n-      message(WARNING \"${_msg}\")\n-   else()\n-      # dashboard build\n-      message(STATUS \"${_msg}\")\n-   endif()\n-endmacro()"}, {"sha": "dd38ae0c71abd5689639a78ece6204f10107a9e7", "filename": "cmake/vc/VcConfig.cmake.in", "status": "removed", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/VcConfig.cmake.in", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/VcConfig.cmake.in", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/VcConfig.cmake.in?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -1,18 +0,0 @@\n-set(Vc_VERSION_MAJOR @Vc_VERSION_MAJOR@)\n-set(Vc_VERSION_MINOR @Vc_VERSION_MINOR@)\n-set(Vc_VERSION_PATCH @Vc_VERSION_PATCH@)\n-set(Vc_VERSION @Vc_VERSION_MAJOR@.@Vc_VERSION_MINOR@.@Vc_VERSION_PATCH@)\n-set(Vc_VERSION_STRING \"@Vc_VERSION_MAJOR@.@Vc_VERSION_MINOR@.@Vc_VERSION_PATCH@\")\n-\n-set(Vc_INSTALL_DIR \"@CMAKE_INSTALL_PREFIX@\")\n-\n-set(Vc_LIB_DIR              \"@CMAKE_INSTALL_PREFIX@/lib\")\n-set(Vc_INCLUDE_DIR          \"@CMAKE_INSTALL_PREFIX@/include\")\n-set(Vc_CMAKE_MODULES_DIR    \"@CMAKE_INSTALL_PREFIX@/lib/cmake/Vc\")\n-\n-find_library(Vc_LIBRARIES Vc PATHS \"${Vc_LIB_DIR}\" NO_DEFAULT_PATH)\n-\n-include(\"${Vc_CMAKE_MODULES_DIR}/VcMacros.cmake\")\n-\n-set(Vc_DEFINITIONS)\n-vc_set_preferred_compiler_flags()"}, {"sha": "19f767296b3beea6a81d09921b0a819382f7602a", "filename": "cmake/vc/VcConfigVersion.cmake.in", "status": "removed", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/VcConfigVersion.cmake.in", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/VcConfigVersion.cmake.in", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/VcConfigVersion.cmake.in?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -1,11 +0,0 @@\n-set(PACKAGE_VERSION @Vc_VERSION_MAJOR@.@Vc_VERSION_MINOR@.@Vc_VERSION_PATCH@)\n-\n-if(\"${PACKAGE_VERSION}\" VERSION_LESS \"${PACKAGE_FIND_VERSION}\")\n-   set(PACKAGE_VERSION_COMPATIBLE FALSE)\n-else()\n-   set(PACKAGE_VERSION_COMPATIBLE TRUE)\n-   if(\"${PACKAGE_FIND_VERSION}\" STREQUAL \"${PACKAGE_VERSION}\")\n-      set(PACKAGE_VERSION_EXACT TRUE)\n-   endif()\n-endif()\n-"}, {"sha": "9d6f8514e6e676f2a59d32a5658387761323ea84", "filename": "cmake/vc/VcMacros.cmake", "status": "removed", "additions": 0, "deletions": 511, "changes": 511, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/VcMacros.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/VcMacros.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/VcMacros.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -1,511 +0,0 @@\n-# Macros for use with the Vc library. Vc can be found at http://code.compeng.uni-frankfurt.de/projects/vc\n-#\n-# The following macros are provided:\n-# vc_determine_compiler\n-# vc_set_preferred_compiler_flags\n-#\n-#=============================================================================\n-# Copyright 2009-2013   Matthias Kretz <kretz@kde.org>\n-#\n-# Redistribution and use in source and binary forms, with or without\n-# modification, are permitted provided that the following conditions are\n-# met:\n-#\n-#  * Redistributions of source code must retain the above copyright notice,\n-#    this list of conditions and the following disclaimer.\n-#\n-#  * Redistributions in binary form must reproduce the above copyright notice,\n-#    this list of conditions and the following disclaimer in the documentation\n-#    and/or other materials provided with the distribution.\n-#\n-#  * The names of Kitware, Inc., the Insight Consortium, or the names of\n-#    any consortium members, or of any contributors, may not be used to\n-#    endorse or promote products derived from this software without\n-#    specific prior written permission.\n-#\n-# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS ``AS IS''\n-# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n-# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n-# ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR\n-# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n-# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n-# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n-# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n-# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n-# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n-#=============================================================================\n-\n-cmake_minimum_required(VERSION 2.8.3)\n-\n-get_filename_component(_currentDir \"${CMAKE_CURRENT_LIST_FILE}\" PATH)\n-include (\"${_currentDir}/UserWarning.cmake\")\n-include (\"${_currentDir}/AddCompilerFlag.cmake\")\n-include (\"${_currentDir}/OptimizeForArchitecture.cmake\")\n-\n-macro(vc_determine_compiler)\n-   if(NOT DEFINED Vc_COMPILER_IS_INTEL)\n-      execute_process(COMMAND \"${CMAKE_CXX_COMPILER}\" \"--version\" OUTPUT_VARIABLE _cxx_compiler_version ERROR_VARIABLE _cxx_compiler_version)\n-      set(Vc_COMPILER_IS_INTEL false)\n-      set(Vc_COMPILER_IS_OPEN64 false)\n-      set(Vc_COMPILER_IS_CLANG false)\n-      set(Vc_COMPILER_IS_MSVC false)\n-      set(Vc_COMPILER_IS_GCC false)\n-      if(CMAKE_CXX_COMPILER MATCHES \"/(icpc|icc)$\")\n-         set(Vc_COMPILER_IS_INTEL true)\n-         exec_program(${CMAKE_C_COMPILER} ARGS -dumpversion OUTPUT_VARIABLE Vc_ICC_VERSION)\n-         message(STATUS \"Detected Compiler: Intel ${Vc_ICC_VERSION}\")\n-      elseif(CMAKE_CXX_COMPILER MATCHES \"(opencc|openCC)$\")\n-         set(Vc_COMPILER_IS_OPEN64 true)\n-         message(STATUS \"Detected Compiler: Open64\")\n-      elseif(CMAKE_CXX_COMPILER MATCHES \"clang\\\\+\\\\+$\" OR \"${_cxx_compiler_version}\" MATCHES \"clang\")\n-         set(Vc_COMPILER_IS_CLANG true)\n-         exec_program(${CMAKE_CXX_COMPILER} ARGS --version OUTPUT_VARIABLE Vc_CLANG_VERSION)\n-         string(REGEX MATCH \"[0-9]+\\\\.[0-9]+(\\\\.[0-9]+)?\" Vc_CLANG_VERSION \"${Vc_CLANG_VERSION}\")\n-         message(STATUS \"Detected Compiler: Clang ${Vc_CLANG_VERSION}\")\n-      elseif(MSVC)\n-         set(Vc_COMPILER_IS_MSVC true)\n-         message(STATUS \"Detected Compiler: MSVC ${MSVC_VERSION}\")\n-      elseif(CMAKE_COMPILER_IS_GNUCXX)\n-         set(Vc_COMPILER_IS_GCC true)\n-         exec_program(${CMAKE_C_COMPILER} ARGS -dumpversion OUTPUT_VARIABLE Vc_GCC_VERSION)\n-         message(STATUS \"Detected Compiler: GCC ${Vc_GCC_VERSION}\")\n-\n-         # some distributions patch their GCC to return nothing or only major and minor version on -dumpversion.\n-         # In that case we must extract the version number from --version.\n-         if(NOT Vc_GCC_VERSION OR Vc_GCC_VERSION MATCHES \"^[0-9]\\\\.[0-9]+$\")\n-            exec_program(${CMAKE_C_COMPILER} ARGS --version OUTPUT_VARIABLE Vc_GCC_VERSION)\n-            string(REGEX MATCH \"[0-9]+\\\\.[0-9]+\\\\.[0-9]+\" Vc_GCC_VERSION \"${Vc_GCC_VERSION}\")\n-            message(STATUS \"GCC Version from --version: ${Vc_GCC_VERSION}\")\n-         endif()\n-\n-         # some distributions patch their GCC to be API incompatible to what the FSF released. In\n-         # those cases we require a macro to identify the distribution version\n-         find_program(_lsb_release lsb_release)\n-         mark_as_advanced(_lsb_release)\n-         if(_lsb_release)\n-            execute_process(COMMAND ${_lsb_release} -is OUTPUT_VARIABLE _distributor_id OUTPUT_STRIP_TRAILING_WHITESPACE)\n-            execute_process(COMMAND ${_lsb_release} -rs OUTPUT_VARIABLE _distributor_release OUTPUT_STRIP_TRAILING_WHITESPACE)\n-            string(TOUPPER \"${_distributor_id}\" _distributor_id)\n-            if(_distributor_id STREQUAL \"UBUNTU\")\n-               execute_process(COMMAND ${CMAKE_C_COMPILER} --version OUTPUT_STRIP_TRAILING_WHITESPACE OUTPUT_VARIABLE _gcc_version)\n-               string(REGEX MATCH \"\\\\(.* ${Vc_GCC_VERSION}-([0-9]+).*\\\\)\" _tmp \"${_gcc_version}\")\n-               if(_tmp)\n-                  set(_patch ${CMAKE_MATCH_1})\n-                  string(REGEX MATCH \"^([0-9]+)\\\\.([0-9]+)$\" _tmp \"${_distributor_release}\")\n-                  execute_process(COMMAND printf 0x%x%02x%02x ${CMAKE_MATCH_1} ${CMAKE_MATCH_2} ${_patch} OUTPUT_STRIP_TRAILING_WHITESPACE OUTPUT_VARIABLE _tmp)\n-                  set(Vc_DEFINITIONS \"${Vc_DEFINITIONS} -D__GNUC_UBUNTU_VERSION__=${_tmp}\")\n-               endif()\n-            endif()\n-         endif()\n-      else()\n-         message(WARNING \"Untested/-supported Compiler (${CMAKE_CXX_COMPILER}) for use with Vc.\\nPlease fill out the missing parts in the CMake scripts and submit a patch to http://code.compeng.uni-frankfurt.de/projects/vc\")\n-      endif()\n-   endif()\n-endmacro()\n-\n-macro(vc_set_gnu_buildtype_flags)\n-   set(CMAKE_CXX_FLAGS_DEBUG          \"-g3\"          CACHE STRING \"Flags used by the compiler during debug builds.\" FORCE)\n-   set(CMAKE_CXX_FLAGS_MINSIZEREL     \"-Os -DNDEBUG\" CACHE STRING \"Flags used by the compiler during release minsize builds.\" FORCE)\n-   set(CMAKE_CXX_FLAGS_RELEASE        \"-O3 -DNDEBUG\" CACHE STRING \"Flags used by the compiler during release builds (/MD /Ob1 /Oi /Ot /Oy /Gs will produce slightly less optimized but smaller files).\" FORCE)\n-   set(CMAKE_CXX_FLAGS_RELWITHDEBUG   \"-O3\"          CACHE STRING \"Flags used by the compiler during release builds containing runtime checks.\" FORCE)\n-   set(CMAKE_CXX_FLAGS_RELWITHDEBINFO \"${CMAKE_CXX_FLAGS_RELWITHDEBUG} -g\" CACHE STRING \"Flags used by the compiler during Release with Debug Info builds.\" FORCE)\n-   set(CMAKE_C_FLAGS_DEBUG          \"${CMAKE_CXX_FLAGS_DEBUG}\"          CACHE STRING \"Flags used by the compiler during debug builds.\" FORCE)\n-   set(CMAKE_C_FLAGS_MINSIZEREL     \"${CMAKE_CXX_FLAGS_MINSIZEREL}\"     CACHE STRING \"Flags used by the compiler during release minsize builds.\" FORCE)\n-   set(CMAKE_C_FLAGS_RELEASE        \"${CMAKE_CXX_FLAGS_RELEASE}\"        CACHE STRING \"Flags used by the compiler during release builds (/MD /Ob1 /Oi /Ot /Oy /Gs will produce slightly less optimized but smaller files).\" FORCE)\n-   set(CMAKE_C_FLAGS_RELWITHDEBUG   \"${CMAKE_CXX_FLAGS_RELWITHDEBUG}\"   CACHE STRING \"Flags used by the compiler during release builds containing runtime checks.\" FORCE)\n-   set(CMAKE_C_FLAGS_RELWITHDEBINFO \"${CMAKE_CXX_FLAGS_RELWITHDEBINFO}\" CACHE STRING \"Flags used by the compiler during Release with Debug Info builds.\" FORCE)\n-   if(CMAKE_BUILD_TYPE STREQUAL \"Release\" OR CMAKE_BUILD_TYPE STREQUAL \"RelWithDebInfo\" OR CMAKE_BUILD_TYPE STREQUAL \"RelWithDebug\")\n-      set(ENABLE_STRICT_ALIASING true CACHE BOOL \"Enables strict aliasing rules for more aggressive optimizations\")\n-      if(NOT ENABLE_STRICT_ALIASING)\n-         AddCompilerFlag(-fno-strict-aliasing)\n-      endif(NOT ENABLE_STRICT_ALIASING)\n-   endif()\n-   mark_as_advanced(CMAKE_CXX_FLAGS_RELWITHDEBUG CMAKE_C_FLAGS_RELWITHDEBUG)\n-endmacro()\n-\n-macro(vc_add_compiler_flag VAR _flag)\n-   AddCompilerFlag(\"${_flag}\" CXX_FLAGS ${VAR})\n-endmacro()\n-\n-macro(vc_check_assembler)\n-   if(APPLE)\n-      if(NOT Vc_COMPILER_IS_CLANG)\n-         message(WARNING \"Apple does not provide an assembler with AVX support. AVX will not be available. Please use Clang if you want to use AVX.\")\n-         set(Vc_DEFINITIONS \"${Vc_DEFINITIONS} -DVC_NO_XGETBV\")\n-         set(Vc_AVX_INTRINSICS_BROKEN true)\n-         set(Vc_AVX2_INTRINSICS_BROKEN true)\n-      endif()\n-   else(APPLE)\n-      if(${ARGC} EQUAL 1)\n-         set(_as \"${ARGV1}\")\n-      else()\n-         exec_program(${CMAKE_CXX_COMPILER} ARGS -print-prog-name=as OUTPUT_VARIABLE _as)\n-         mark_as_advanced(_as)\n-      endif()\n-      if(NOT _as)\n-         message(WARNING \"Could not find 'as', the assembler used by GCC. Hoping everything will work out...\")\n-      else()\n-         exec_program(${_as} ARGS --version OUTPUT_VARIABLE _as_version)\n-         string(REGEX REPLACE \"\\\\([^\\\\)]*\\\\)\" \"\" _as_version \"${_as_version}\")\n-         string(REGEX MATCH \"[1-9]\\\\.[0-9]+(\\\\.[0-9]+)?\" _as_version \"${_as_version}\")\n-         if(_as_version VERSION_LESS \"2.18.93\")\n-            UserWarning(\"Your binutils is too old (${_as_version}). Some optimizations of Vc will be disabled.\")\n-            add_definitions(-DVC_NO_XGETBV) # old assembler doesn't know the xgetbv instruction\n-            set(Vc_AVX_INTRINSICS_BROKEN true)\n-            set(Vc_XOP_INTRINSICS_BROKEN true)\n-            set(Vc_FMA4_INTRINSICS_BROKEN true)\n-         elseif(_as_version VERSION_LESS \"2.21.0\")\n-            UserWarning(\"Your binutils is too old (${_as_version}) for XOP instructions. They will therefore not be provided in libVc.\")\n-            set(Vc_XOP_INTRINSICS_BROKEN true)\n-         endif()\n-      endif()\n-   endif(APPLE)\n-endmacro()\n-\n-macro(vc_check_fpmath)\n-   # if compiling for 32 bit x86 we need to use the -mfpmath=sse since the x87 is broken by design\n-   include (CheckCXXSourceRuns)\n-   check_cxx_source_runs(\"int main() { return sizeof(void*) != 8; }\" Vc_VOID_PTR_IS_64BIT)\n-   if(NOT Vc_VOID_PTR_IS_64BIT)\n-      exec_program(${CMAKE_C_COMPILER} ARGS -dumpmachine OUTPUT_VARIABLE _gcc_machine)\n-      if(_gcc_machine MATCHES \"[x34567]86\" OR _gcc_machine STREQUAL \"mingw32\")\n-         vc_add_compiler_flag(Vc_DEFINITIONS \"-mfpmath=sse\")\n-      endif()\n-   endif()\n-endmacro()\n-\n-macro(vc_set_preferred_compiler_flags)\n-   vc_determine_compiler()\n-\n-   set(_add_warning_flags false)\n-   set(_add_buildtype_flags false)\n-   foreach(_arg ${ARGN})\n-      if(_arg STREQUAL \"WARNING_FLAGS\")\n-         set(_add_warning_flags true)\n-      elseif(_arg STREQUAL \"BUILDTYPE_FLAGS\")\n-         set(_add_buildtype_flags true)\n-      endif()\n-   endforeach()\n-\n-   set(Vc_SSE_INTRINSICS_BROKEN false)\n-   set(Vc_AVX_INTRINSICS_BROKEN false)\n-   set(Vc_AVX2_INTRINSICS_BROKEN false)\n-   set(Vc_XOP_INTRINSICS_BROKEN false)\n-   set(Vc_FMA4_INTRINSICS_BROKEN false)\n-\n-   if(Vc_COMPILER_IS_OPEN64)\n-      ##################################################################################################\n-      #                                             Open64                                             #\n-      ##################################################################################################\n-      if(_add_warning_flags)\n-         AddCompilerFlag(\"-W\")\n-         AddCompilerFlag(\"-Wall\")\n-         AddCompilerFlag(\"-Wimplicit\")\n-         AddCompilerFlag(\"-Wswitch\")\n-         AddCompilerFlag(\"-Wformat\")\n-         AddCompilerFlag(\"-Wchar-subscripts\")\n-         AddCompilerFlag(\"-Wparentheses\")\n-         AddCompilerFlag(\"-Wmultichar\")\n-         AddCompilerFlag(\"-Wtrigraphs\")\n-         AddCompilerFlag(\"-Wpointer-arith\")\n-         AddCompilerFlag(\"-Wcast-align\")\n-         AddCompilerFlag(\"-Wreturn-type\")\n-         AddCompilerFlag(\"-Wno-unused-function\")\n-         AddCompilerFlag(\"-pedantic\")\n-         AddCompilerFlag(\"-Wno-long-long\")\n-         AddCompilerFlag(\"-Wshadow\")\n-         AddCompilerFlag(\"-Wold-style-cast\")\n-         AddCompilerFlag(\"-Wno-variadic-macros\")\n-      endif()\n-      if(_add_buildtype_flags)\n-         vc_set_gnu_buildtype_flags()\n-      endif()\n-\n-      vc_check_assembler()\n-\n-      # Open64 4.5.1 still doesn't ship immintrin.h\n-      set(Vc_AVX_INTRINSICS_BROKEN true)\n-      set(Vc_AVX2_INTRINSICS_BROKEN true)\n-   elseif(Vc_COMPILER_IS_GCC)\n-      ##################################################################################################\n-      #                                              GCC                                               #\n-      ##################################################################################################\n-      if(_add_warning_flags)\n-         foreach(_f -W -Wall -Wswitch -Wformat -Wchar-subscripts -Wparentheses -Wmultichar -Wtrigraphs -Wpointer-arith -Wcast-align -Wreturn-type -Wno-unused-function -pedantic -Wshadow -Wundef -Wold-style-cast -Wno-variadic-macros)\n-            AddCompilerFlag(\"${_f}\")\n-         endforeach()\n-         if(Vc_GCC_VERSION VERSION_GREATER \"4.5.2\" AND Vc_GCC_VERSION VERSION_LESS \"4.6.4\")\n-            # GCC gives bogus \"array subscript is above array bounds\" warnings in math.cpp\n-            AddCompilerFlag(\"-Wno-array-bounds\")\n-         endif()\n-         if(Vc_GCC_VERSION VERSION_GREATER \"4.7.99\")\n-            # GCC 4.8 warns about stuff we don't care about\n-            # Some older GCC versions have problems to note that they don't support the flag\n-            AddCompilerFlag(\"-Wno-unused-local-typedefs\")\n-         endif()\n-      endif() \n-      if (NOT MSVC)\n-          vc_add_compiler_flag(Vc_DEFINITIONS \"-Wabi\")\n-      endif()\n-      vc_add_compiler_flag(Vc_DEFINITIONS \"-fabi-version=0\") # ABI version 4 is required to make __m128 and __m256 appear as different types. 0 should give us the latest version.\n-\n-      if(_add_buildtype_flags)\n-         vc_set_gnu_buildtype_flags()\n-      endif()\n-\n-      # GCC 4.5.[01] fail at inlining some functions, creating functions with a single instructions,\n-      # thus creating a large overhead.\n-      if(Vc_GCC_VERSION VERSION_LESS \"4.5.2\" AND NOT Vc_GCC_VERSION VERSION_LESS \"4.5.0\")\n-         UserWarning(\"GCC 4.5.0 and 4.5.1 have problems with inlining correctly. Setting early-inlining-insns=12 as workaround.\")\n-         AddCompilerFlag(\"--param early-inlining-insns=12\")\n-      endif()\n-\n-      if(Vc_GCC_VERSION VERSION_LESS \"4.1.99\")\n-         UserWarning(\"Your GCC is ancient and crashes on some important optimizations.  The full set of SSE2 intrinsics is not supported.  Vc will fall back to the scalar implementation.  Use of the may_alias and always_inline attributes will be disabled.  In turn all code using Vc must be compiled with -fno-strict-aliasing\")\n-         vc_add_compiler_flag(Vc_DEFINITIONS \"-fno-strict-aliasing\")\n-         set(Vc_AVX_INTRINSICS_BROKEN true)\n-         set(Vc_AVX2_INTRINSICS_BROKEN true)\n-         set(Vc_SSE_INTRINSICS_BROKEN true)\n-      elseif(Vc_GCC_VERSION VERSION_LESS \"4.4.6\")\n-         UserWarning(\"Your GCC is older than 4.4.6. This is known to cause problems/bugs. Please update to the latest GCC if you can.\")\n-         set(Vc_AVX_INTRINSICS_BROKEN true)\n-         set(Vc_AVX2_INTRINSICS_BROKEN true)\n-         if(Vc_GCC_VERSION VERSION_LESS \"4.3.0\")\n-            UserWarning(\"Your GCC is older than 4.3.0. It is unable to handle the full set of SSE2 intrinsics. All SSE code will be disabled. Please update to the latest GCC if you can.\")\n-            set(Vc_SSE_INTRINSICS_BROKEN true)\n-         endif()\n-      endif()\n-\n-      if(Vc_GCC_VERSION VERSION_LESS 4.5.0)\n-         UserWarning(\"GCC 4.4.x shows false positives for -Wparentheses, thus we rather disable the warning.\")\n-         string(REPLACE \" -Wparentheses \" \" \" CMAKE_C_FLAGS \"${CMAKE_C_FLAGS}\")\n-         string(REPLACE \" -Wparentheses \" \" \" CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS}\")\n-         set(Vc_DEFINITIONS \"${Vc_DEFINITIONS} -Wno-parentheses\")\n-\n-         UserWarning(\"GCC 4.4.x shows false positives for -Wstrict-aliasing, thus we rather disable the warning. Use a newer GCC for better warnings.\")\n-         AddCompilerFlag(\"-Wno-strict-aliasing\")\n-\n-         UserWarning(\"GCC 4.4.x shows false positives for -Wuninitialized, thus we rather disable the warning. Use a newer GCC for better warnings.\")\n-         AddCompilerFlag(\"-Wno-uninitialized\")\n-      elseif(Vc_GCC_VERSION VERSION_EQUAL 4.6.0)\n-         UserWarning(\"GCC 4.6.0 miscompiles AVX loads/stores, leading to spurious segfaults. Disabling AVX per default.\")\n-         set(Vc_AVX_INTRINSICS_BROKEN true)\n-         set(Vc_AVX2_INTRINSICS_BROKEN true)\n-      elseif(Vc_GCC_VERSION VERSION_EQUAL 4.7.0)\n-         UserWarning(\"GCC 4.7.0 miscompiles at -O3, adding -fno-predictive-commoning to the compiler flags as workaround\")\n-         set(Vc_DEFINITIONS \"${Vc_DEFINITIONS} -fno-predictive-commoning\")\n-      endif()\n-\n-      vc_check_fpmath()\n-      vc_check_assembler()\n-   elseif(Vc_COMPILER_IS_INTEL)\n-      ##################################################################################################\n-      #                                          Intel Compiler                                        #\n-      ##################################################################################################\n-\n-      if(_add_buildtype_flags)\n-         set(CMAKE_CXX_FLAGS_RELEASE        \"${CMAKE_CXX_FLAGS_RELEASE} -O3\")\n-         set(CMAKE_CXX_FLAGS_RELWITHDEBINFO \"${CMAKE_CXX_FLAGS_RELWITHDEBINFO} -DNDEBUG -O3\")\n-         set(CMAKE_C_FLAGS_RELEASE          \"${CMAKE_C_FLAGS_RELEASE} -O3\")\n-         set(CMAKE_C_FLAGS_RELWITHDEBINFO   \"${CMAKE_C_FLAGS_RELWITHDEBINFO} -DNDEBUG -O3\")\n-\n-         set(ALIAS_FLAGS \"-no-ansi-alias\")\n-         if(CMAKE_BUILD_TYPE STREQUAL \"Release\" OR CMAKE_BUILD_TYPE STREQUAL \"RelWithDebInfo\")\n-            # default ICC to -no-ansi-alias because otherwise tests/utils_sse fails. So far I suspect a miscompilation...\n-            set(ENABLE_STRICT_ALIASING true CACHE BOOL \"Enables strict aliasing rules for more aggressive optimizations\")\n-            if(ENABLE_STRICT_ALIASING)\n-               set(ALIAS_FLAGS \"-ansi-alias\")\n-            endif(ENABLE_STRICT_ALIASING)\n-         endif()\n-         set(CMAKE_C_FLAGS   \"${CMAKE_C_FLAGS}   ${ALIAS_FLAGS}\")\n-         set(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} ${ALIAS_FLAGS}\")\n-      endif()\n-      vc_add_compiler_flag(Vc_DEFINITIONS \"-diag-disable 913\")\n-      # Disable warning #13211 \"Immediate parameter to intrinsic call too large\". (sse/vector.tcc rotated(int))\n-      vc_add_compiler_flag(Vc_DEFINITIONS \"-diag-disable 13211\")\n-\n-      if(NOT \"$ENV{DASHBOARD_TEST_FROM_CTEST}\" STREQUAL \"\")\n-         # disable warning #2928: the __GXX_EXPERIMENTAL_CXX0X__ macro is disabled when using GNU version 4.6 with the c++0x option\n-         # this warning just adds noise about problems in the compiler - but I'm only interested in seeing problems in Vc\n-         vc_add_compiler_flag(Vc_DEFINITIONS \"-diag-disable 2928\")\n-      endif()\n-\n-      # Intel doesn't implement the XOP or FMA4 intrinsics\n-      set(Vc_XOP_INTRINSICS_BROKEN true)\n-      set(Vc_FMA4_INTRINSICS_BROKEN true)\n-   elseif(Vc_COMPILER_IS_MSVC)\n-      ##################################################################################################\n-      #                                      Microsoft Visual Studio                                   #\n-      ##################################################################################################\n-\n-      if(_add_warning_flags)\n-         AddCompilerFlag(\"/wd4800\") # Disable warning \"forcing value to bool\"\n-         AddCompilerFlag(\"/wd4996\") # Disable warning about strdup vs. _strdup\n-         AddCompilerFlag(\"/wd4244\") # Disable warning \"conversion from 'unsigned int' to 'float', possible loss of data\"\n-         AddCompilerFlag(\"/wd4146\") # Disable warning \"unary minus operator applied to unsigned type, result still unsigned\"\n-         AddCompilerFlag(\"/wd4227\") # Disable warning \"anachronism used : qualifiers on reference are ignored\" (this is about 'restrict' usage on references, stupid MSVC)\n-         AddCompilerFlag(\"/wd4722\") # Disable warning \"destructor never returns, potential memory leak\" (warns about ~_UnitTest_Global_Object which we don't care about)\n-         AddCompilerFlag(\"/wd4748\") # Disable warning \"/GS can not protect parameters and local variables from local buffer overrun because optimizations are disabled in function\" (I don't get it)\n-         add_definitions(-D_CRT_SECURE_NO_WARNINGS)\n-      endif()\n-\n-      # MSVC does not support inline assembly on 64 bit! :(\n-      # searching the help for xgetbv doesn't turn up anything. So just fall back to not supporting AVX on Windows :(\n-      # TODO: apparently MSVC 2010 SP1 added _xgetbv\n-      set(Vc_DEFINITIONS \"${Vc_DEFINITIONS} -DVC_NO_XGETBV\")\n-\n-      # get rid of the min/max macros\n-      set(Vc_DEFINITIONS \"${Vc_DEFINITIONS} -DNOMINMAX\")\n-\n-      # MSVC doesn't implement the XOP or FMA4 intrinsics\n-      set(Vc_XOP_INTRINSICS_BROKEN true)\n-      set(Vc_FMA4_INTRINSICS_BROKEN true)\n-\n-      if(MSVC_VERSION LESS 1700)\n-         UserWarning(\"MSVC before 2012 has a broken std::vector::resize implementation. STL + Vc code will probably not compile.\")\n-      endif()\n-   elseif(Vc_COMPILER_IS_CLANG)\n-      ##################################################################################################\n-      #                                              Clang                                             #\n-      ##################################################################################################\n-\n-      # for now I don't know of any arguments I want to pass. -march and stuff is tried by OptimizeForArchitecture...\n-      if(Vc_CLANG_VERSION VERSION_EQUAL \"3.0\")\n-         UserWarning(\"Clang 3.0 has serious issues to compile Vc code and will most likely crash when trying to do so.\\nPlease update to a recent clang version.\")\n-      elseif(Vc_CLANG_VERSION VERSION_LESS \"3.3\")\n-         # the LLVM assembler gets FMAs wrong (bug 15040)\n-         vc_add_compiler_flag(Vc_DEFINITIONS \"-no-integrated-as\")\n-      endif()\n-\n-      # disable these warnings because clang shows them for function overloads that were discarded via SFINAE\n-      vc_add_compiler_flag(Vc_DEFINITIONS \"-Wno-local-type-template-args\")\n-      vc_add_compiler_flag(Vc_DEFINITIONS \"-Wno-unnamed-type-template-args\")\n-\n-      AddCompilerFlag(-stdlib=libc++)\n-   endif()\n-\n-   if(NOT Vc_COMPILER_IS_MSVC)\n-      vc_add_compiler_flag(Vc_DEFINITIONS \"-ffp-contract=fast\")\n-   endif()\n-\n-   OptimizeForArchitecture()\n-   set(Vc_DEFINITIONS \"${Vc_ARCHITECTURE_FLAGS} ${Vc_DEFINITIONS}\")\n-\n-   set(VC_IMPL \"auto\" CACHE STRING \"Force the Vc implementation globally to the selected instruction set. \\\"auto\\\" lets Vc use the best available instructions.\")\n-   if(NOT VC_IMPL STREQUAL \"auto\")\n-      set(Vc_DEFINITIONS \"${Vc_DEFINITIONS} -DVC_IMPL=${VC_IMPL}\")\n-      if(NOT VC_IMPL STREQUAL \"Scalar\")\n-         set(_use_var \"USE_${VC_IMPL}\")\n-         if(VC_IMPL STREQUAL \"SSE\")\n-            set(_use_var \"USE_SSE2\")\n-         endif()\n-         if(NOT ${_use_var})\n-            message(WARNING \"The selected value for VC_IMPL (${VC_IMPL}) will not work because the relevant instructions are not enabled via compiler flags.\")\n-         endif()\n-      endif()\n-   endif()\n-endmacro()\n-\n-# helper macro for vc_compile_for_all_implementations\n-macro(_vc_compile_one_implementation _srcs _impl)\n-   list(FIND _disabled_targets \"${_impl}\" _disabled_index)\n-   list(FIND _only_targets \"${_impl}\" _only_index)\n-   if(${_disabled_index} EQUAL -1 AND (NOT _only_targets OR ${_only_index} GREATER -1))\n-      set(_extra_flags)\n-      set(_ok FALSE)\n-      foreach(_flags ${ARGN})\n-         if(_flags STREQUAL \"NO_FLAG\")\n-            set(_ok TRUE)\n-            break()\n-         endif()\n-         string(REPLACE \" \" \";\" _flag_list \"${_flags}\")\n-         foreach(_f ${_flag_list})\n-            AddCompilerFlag(${_f} CXX_RESULT _ok)\n-            if(NOT _ok)\n-               break()\n-            endif()\n-         endforeach()\n-         if(_ok)\n-            set(_extra_flags ${_flags})\n-            break()\n-         endif()\n-      endforeach()\n-\n-      if(Vc_COMPILER_IS_MSVC)\n-         # MSVC for 64bit does not recognize /arch:SSE2 anymore. Therefore we set override _ok if _impl\n-         # says SSE\n-         if(\"${_impl}\" MATCHES \"SSE\")\n-            set(_ok TRUE)\n-         endif()\n-      endif()\n-\n-      if(_ok)\n-         get_filename_component(_out \"${_vc_compile_src}\" NAME_WE)\n-         get_filename_component(_ext \"${_vc_compile_src}\" EXT)\n-         set(_out \"${CMAKE_CURRENT_BINARY_DIR}/${_out}_${_impl}${_ext}\")\n-         configure_file( ${_vc_compile_src} \"${_out}\" COPYONLY )\n-         set_source_files_properties( \"${_out}\" PROPERTIES\n-            COMPILE_DEFINITIONS \"VC_IMPL=${_impl}\"\n-            COMPILE_FLAGS \"${_flags} ${_extra_flags}\"\n-         )\n-         list(APPEND ${_srcs} \"${_out}\")\n-      endif()\n-   endif()\n-endmacro()\n-\n-# Generate compile rules for the given C++ source file for all available implementations and return\n-# the resulting list of object files in _obj\n-# all remaining arguments are additional flags\n-# Example:\n-#   vc_compile_for_all_implementations(_objs src/trigonometric.cpp FLAGS -DCOMPILE_BLAH EXCLUDE Scalar)\n-#   add_executable(executable main.cpp ${_objs})\n-macro(vc_compile_for_all_implementations _srcs _src)\n-   set(_flags)\n-   unset(_disabled_targets)\n-   unset(_only_targets)\n-   set(_state 0)\n-   foreach(_arg ${ARGN})\n-      if(_arg STREQUAL \"FLAGS\")\n-         set(_state 1)\n-      elseif(_arg STREQUAL \"EXCLUDE\")\n-         set(_state 2)\n-      elseif(_arg STREQUAL \"ONLY\")\n-         set(_state 3)\n-      elseif(_state EQUAL 1)\n-         set(_flags \"${_flags} ${_arg}\")\n-      elseif(_state EQUAL 2)\n-         list(APPEND _disabled_targets \"${_arg}\")\n-      elseif(_state EQUAL 3)\n-         list(APPEND _only_targets \"${_arg}\")\n-      else()\n-         message(FATAL_ERROR \"incorrect argument to vc_compile_for_all_implementations\")\n-      endif()\n-   endforeach()\n-\n-   set(_vc_compile_src \"${_src}\")\n-\n-   _vc_compile_one_implementation(${_srcs} Scalar NO_FLAG)\n-   if(NOT Vc_SSE_INTRINSICS_BROKEN)\n-      _vc_compile_one_implementation(${_srcs} SSE2   \"-xSSE2\"   \"-msse2\"   \"/arch:SSE2\")\n-      _vc_compile_one_implementation(${_srcs} SSE3   \"-xSSE3\"   \"-msse3\"   \"/arch:SSE2\")\n-      _vc_compile_one_implementation(${_srcs} SSSE3  \"-xSSSE3\"  \"-mssse3\"  \"/arch:SSE2\")\n-      _vc_compile_one_implementation(${_srcs} SSE4_1 \"-xSSE4.1\" \"-msse4.1\" \"/arch:SSE2\")\n-      _vc_compile_one_implementation(${_srcs} SSE4_2 \"-xSSE4.2\" \"-msse4.2\" \"/arch:SSE2\")\n-      _vc_compile_one_implementation(${_srcs} SSE3+SSE4a  \"-msse4a\")\n-   endif()\n-   if(NOT Vc_AVX_INTRINSICS_BROKEN)\n-      _vc_compile_one_implementation(${_srcs} AVX      \"-xAVX\"    \"-mavx\"    \"/arch:AVX\")\n-      if(NOT Vc_XOP_INTRINSICS_BROKEN)\n-         if(NOT Vc_FMA4_INTRINSICS_BROKEN)\n-            _vc_compile_one_implementation(${_srcs} SSE+XOP+FMA4 \"-mxop -mfma4\"        \"\"    \"\")\n-            _vc_compile_one_implementation(${_srcs} AVX+XOP+FMA4 \"-mavx -mxop -mfma4\"  \"\"    \"\")\n-         endif()\n-         _vc_compile_one_implementation(${_srcs} SSE+XOP+FMA \"-mxop -mfma\"        \"\"    \"\")\n-         _vc_compile_one_implementation(${_srcs} AVX+XOP+FMA \"-mavx -mxop -mfma\"  \"\"    \"\")\n-      endif()\n-      _vc_compile_one_implementation(${_srcs} AVX+FMA \"-mavx -mfma\"  \"\"    \"\")\n-   endif()\n-   if(NOT Vc_AVX2_INTRINSICS_BROKEN)\n-      _vc_compile_one_implementation(${_srcs} AVX2 \"-xCORE-AVX2\"  \"-mavx2\"    \"/arch:AVX2\")\n-   endif()\n-endmacro()"}, {"sha": "5324c7d0a974033b976583339365d2282794ac43", "filename": "cmake/vc/msvc_version.c", "status": "removed", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/msvc_version.c", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/msvc_version.c", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/msvc_version.c?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -1 +0,0 @@\n-MSVC _MSC_FULL_VER"}, {"sha": "05465a982d7bb9b511eef54f166371d2a7190f3b", "filename": "libs/image/CMakeLists.txt", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/c9a87c8875128756fd3b11a021447f965eb43422/libs/image/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/c9a87c8875128756fd3b11a021447f965eb43422/libs/image/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/CMakeLists.txt?ref=c9a87c8875128756fd3b11a021447f965eb43422", "patch": "@@ -335,6 +335,9 @@ endif()\n \n if(HAVE_VC)\n   target_link_libraries(kritaimage PUBLIC ${Vc_LIBRARIES})\n+  if (NOT PACKAGERS_BUILD)\n+      set_property(TARGET kritaimage APPEND PROPERTY COMPILE_OPTIONS \"${Vc_ARCHITECTURE_FLAGS}\")\n+  endif()\n endif()\n \n if (NOT GSL_FOUND)"}, {"sha": "891b3e8f8d38c5847895d46826ec8d406a5f194b", "filename": "libs/image/kis_brush_mask_applicator_factories.cpp", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/KDE/krita/blob/c9a87c8875128756fd3b11a021447f965eb43422/libs/image/kis_brush_mask_applicator_factories.cpp", "raw_url": "https://github.com/KDE/krita/raw/c9a87c8875128756fd3b11a021447f965eb43422/libs/image/kis_brush_mask_applicator_factories.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_brush_mask_applicator_factories.cpp?ref=c9a87c8875128756fd3b11a021447f965eb43422", "patch": "@@ -29,17 +29,17 @@\n template<>\n template<>\n MaskApplicatorFactory<KisMaskGenerator, KisBrushMaskScalarApplicator>::ReturnType\n-MaskApplicatorFactory<KisMaskGenerator, KisBrushMaskScalarApplicator>::create<VC_IMPL>(ParamType maskGenerator)\n+MaskApplicatorFactory<KisMaskGenerator, KisBrushMaskScalarApplicator>::create<Vc::CurrentImplementation::current()>(ParamType maskGenerator)\n {\n-    return new KisBrushMaskScalarApplicator<KisMaskGenerator,VC_IMPL>(maskGenerator);\n+    return new KisBrushMaskScalarApplicator<KisMaskGenerator,Vc::CurrentImplementation::current()>(maskGenerator);\n }\n \n template<>\n template<>\n MaskApplicatorFactory<KisCircleMaskGenerator, KisBrushMaskVectorApplicator>::ReturnType\n-MaskApplicatorFactory<KisCircleMaskGenerator, KisBrushMaskVectorApplicator>::create<VC_IMPL>(ParamType maskGenerator)\n+MaskApplicatorFactory<KisCircleMaskGenerator, KisBrushMaskVectorApplicator>::create<Vc::CurrentImplementation::current()>(ParamType maskGenerator)\n {\n-    return new KisBrushMaskVectorApplicator<KisCircleMaskGenerator,VC_IMPL>(maskGenerator);\n+    return new KisBrushMaskVectorApplicator<KisCircleMaskGenerator,Vc::CurrentImplementation::current()>(maskGenerator);\n }\n \n #if defined HAVE_VC\n@@ -57,7 +57,7 @@ struct KisCircleMaskGenerator::FastRowProcessor\n };\n \n template<> void KisCircleMaskGenerator::\n-FastRowProcessor::process<VC_IMPL>(float* buffer, int width, float y, float cosa, float sina,\n+FastRowProcessor::process<Vc::CurrentImplementation::current()>(float* buffer, int width, float y, float cosa, float sina,\n                                    float centerX, float centerY)\n {\n     const bool useSmoothing = d->copyOfAntialiasEdges;"}, {"sha": "b8101d8ea3e4b3426d949f79449f2c74dd550a4d", "filename": "libs/pigment/CMakeLists.txt", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/c9a87c8875128756fd3b11a021447f965eb43422/libs/pigment/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/c9a87c8875128756fd3b11a021447f965eb43422/libs/pigment/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/CMakeLists.txt?ref=c9a87c8875128756fd3b11a021447f965eb43422", "patch": "@@ -95,6 +95,9 @@ generate_export_header(kritapigment)\n \n if (HAVE_VC)\n     target_link_libraries(kritapigment PUBLIC KF5::I18n KF5::ConfigCore)\n+    if (NOT PACKAGERS_BUILD)\n+        set_property(TARGET kritapigment APPEND PROPERTY COMPILE_OPTIONS \"${Vc_ARCHITECTURE_FLAGS}\")\n+    endif()\n endif()\n \n target_include_directories( kritapigment"}, {"sha": "f817b5571e0aebd903c21ad9f5aed08646f2e4e1", "filename": "libs/pigment/compositeops/KoOptimizedCompositeOpFactoryPerArch.cpp", "status": "modified", "additions": 10, "deletions": 12, "changes": 22, "blob_url": "https://github.com/KDE/krita/blob/c9a87c8875128756fd3b11a021447f965eb43422/libs/pigment/compositeops/KoOptimizedCompositeOpFactoryPerArch.cpp", "raw_url": "https://github.com/KDE/krita/raw/c9a87c8875128756fd3b11a021447f965eb43422/libs/pigment/compositeops/KoOptimizedCompositeOpFactoryPerArch.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/compositeops/KoOptimizedCompositeOpFactoryPerArch.cpp?ref=c9a87c8875128756fd3b11a021447f965eb43422", "patch": "@@ -39,33 +39,33 @@\n template<>\n template<>\n KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpAlphaDarken32>::ReturnType\n-KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpAlphaDarken32>::create<VC_IMPL>(ParamType param)\n+KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpAlphaDarken32>::create<Vc::CurrentImplementation::current()>(ParamType param)\n {\n-    return new KoOptimizedCompositeOpAlphaDarken32<VC_IMPL>(param);\n+    return new KoOptimizedCompositeOpAlphaDarken32<Vc::CurrentImplementation::current()>(param);\n }\n \n template<>\n template<>\n KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpOver32>::ReturnType\n-KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpOver32>::create<VC_IMPL>(ParamType param)\n+KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpOver32>::create<Vc::CurrentImplementation::current()>(ParamType param)\n {\n-    return new KoOptimizedCompositeOpOver32<VC_IMPL>(param);\n+    return new KoOptimizedCompositeOpOver32<Vc::CurrentImplementation::current()>(param);\n }\n \n template<>\n template<>\n KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpAlphaDarken128>::ReturnType\n-KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpAlphaDarken128>::create<VC_IMPL>(ParamType param)\n+KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpAlphaDarken128>::create<Vc::CurrentImplementation::current()>(ParamType param)\n {\n-    return new KoOptimizedCompositeOpAlphaDarken128<VC_IMPL>(param);\n+    return new KoOptimizedCompositeOpAlphaDarken128<Vc::CurrentImplementation::current()>(param);\n }\n \n template<>\n template<>\n KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpOver128>::ReturnType\n-KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpOver128>::create<VC_IMPL>(ParamType param)\n+KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpOver128>::create<Vc::CurrentImplementation::current()>(ParamType param)\n {\n-    return new KoOptimizedCompositeOpOver128<VC_IMPL>(param);\n+    return new KoOptimizedCompositeOpOver128<Vc::CurrentImplementation::current()>(param);\n }\n \n #define __stringify(_s) #_s\n@@ -78,15 +78,13 @@ inline void printFeatureSupported(const QString &feature, Vc::Implementation imp\n \n template<>\n KoReportCurrentArch::ReturnType\n-KoReportCurrentArch::create<VC_IMPL>(ParamType)\n+KoReportCurrentArch::create<Vc::CurrentImplementation::current()>(ParamType)\n {\n-    dbgPigment << \"Compiled for arch:\" << stringify(VC_IMPL);\n+    dbgPigment << \"Compiled for arch:\" << Vc::CurrentImplementation::current();\n     dbgPigment << \"Features supported:\";\n     printFeatureSupported(\"SSE2\", Vc::SSE2Impl);\n     printFeatureSupported(\"SSSE3\", Vc::SSSE3Impl);\n     printFeatureSupported(\"SSE4.1\", Vc::SSE41Impl);\n     printFeatureSupported(\"AVX \", Vc::AVXImpl);\n-#if VC_VERSION_NUMBER >= VC_VERSION_CHECK(0, 8, 0)\n     printFeatureSupported(\"AVX2 \", Vc::AVX2Impl);\n-#endif\n }"}, {"sha": "4716d444ff7d14d06ea6ff144069a17aa692ec17", "filename": "libs/pigment/compositeops/KoStreamedMath.h", "status": "modified", "additions": 18, "deletions": 58, "changes": 76, "blob_url": "https://github.com/KDE/krita/blob/c9a87c8875128756fd3b11a021447f965eb43422/libs/pigment/compositeops/KoStreamedMath.h", "raw_url": "https://github.com/KDE/krita/raw/c9a87c8875128756fd3b11a021447f965eb43422/libs/pigment/compositeops/KoStreamedMath.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/compositeops/KoStreamedMath.h?ref=c9a87c8875128756fd3b11a021447f965eb43422", "patch": "@@ -45,6 +45,9 @@\n template<Vc::Implementation _impl>\n struct KoStreamedMath {\n \n+using int_v = Vc::SimdArray<int, Vc::float_v::size()>;\n+using uint_v = Vc::SimdArray<unsigned int, Vc::float_v::size()>;\n+\n /**\n  * Composes src into dst without using vector instructions\n  */\n@@ -112,8 +115,8 @@ static inline quint8 lerp_mixed_u8_float(quint8 a, quint8 b, float alpha) {\n  * Each source mask element is considered to be a 8-bit integer\n  */\n static inline Vc::float_v fetch_mask_8(const quint8 *data) {\n-    Vc::uint_v data_i(data);\n-    return Vc::float_v(Vc::int_v(data_i));\n+    uint_v data_i(data);\n+    return Vc::float_v(int_v(data_i));\n }\n \n /**\n@@ -130,14 +133,14 @@ static inline Vc::float_v fetch_mask_8(const quint8 *data) {\n  */\n template <bool aligned>\n static inline Vc::float_v fetch_alpha_32(const quint8 *data) {\n-    Vc::uint_v data_i;\n+    uint_v data_i;\n     if (aligned) {\n         data_i.load((const quint32*)data, Vc::Aligned);\n     } else {\n         data_i.load((const quint32*)data, Vc::Unaligned);\n     }\n \n-    return Vc::float_v(Vc::int_v(data_i >> 24));\n+    return Vc::float_v(int_v(data_i >> 24));\n }\n \n /**\n@@ -157,61 +160,19 @@ static inline void fetch_colors_32(const quint8 *data,\n                             Vc::float_v &c1,\n                             Vc::float_v &c2,\n                             Vc::float_v &c3) {\n-    Vc::uint_v data_i;\n-    if (aligned) {\n-        data_i.load((const quint32*)data, Vc::Aligned);\n-    } else {\n-        data_i.load((const quint32*)data, Vc::Unaligned);\n-    }\n-\n-    const quint32 lowByteMask = 0xFF;\n-    Vc::uint_v mask(lowByteMask);\n-\n-    c1 = Vc::float_v(Vc::int_v((data_i >> 16) & mask));\n-    c2 = Vc::float_v(Vc::int_v((data_i >> 8)  & mask));\n-    c3 = Vc::float_v(Vc::int_v( data_i        & mask));\n-}\n-\n-/**\n- *\n- */\n-template <bool aligned>\n-static inline void fetch_all_32(const quint8 *data,\n-                            Vc::float_v &alpha,\n-                            Vc::float_v &c1,\n-                            Vc::float_v &c2,\n-                            Vc::float_v &c3) {\n-    Vc::uint_v data_i;\n+    int_v data_i;\n     if (aligned) {\n         data_i.load((const quint32*)data, Vc::Aligned);\n     } else {\n         data_i.load((const quint32*)data, Vc::Unaligned);\n     }\n \n     const quint32 lowByteMask = 0xFF;\n-    Vc::uint_v mask(lowByteMask);\n+    uint_v mask(lowByteMask);\n \n-    alpha = Vc::float_v(Vc::int_v(data_i >> 24));\n-    c1 = Vc::float_v(Vc::int_v((data_i >> 16) & mask));\n-    c2 = Vc::float_v(Vc::int_v((data_i >> 8)  & mask));\n-    c3 = Vc::float_v(Vc::int_v( data_i        & mask));\n-}\n-\n-template <bool aligned>\n-static inline void fetch_8_offset(const quint8 *data,\n-                                  Vc::float_v &value,\n-                                  const quint32 offset) {\n-    Vc::uint_v data_i;\n-    if (aligned) {\n-        data_i.load((const quint32*)data, Vc::Aligned);\n-    } else {\n-        data_i.load((const quint32*)data, Vc::Unaligned);\n-    }\n-\n-    const quint32 lowByteMask = 0xFF;\n-    Vc::uint_v mask(lowByteMask);\n-\n-    value = Vc::float_v(Vc::int_v((data_i >> offset) & mask));\n+    c1 = Vc::float_v(int_v((data_i >> 16) & mask));\n+    c2 = Vc::float_v(int_v((data_i >> 8)  & mask));\n+    c3 = Vc::float_v(int_v( data_i        & mask));\n }\n \n /**\n@@ -233,19 +194,18 @@ static inline void write_channels_32(quint8 *data,\n      */\n \n     const quint32 lowByteMask = 0xFF;\n-    Vc::uint_v mask(lowByteMask);\n \n     // FIXME: Use single-instruction rounding + conversion\n     //        The achieve that we need to implement Vc::iRound()\n \n-    Vc::uint_v v1 = Vc::uint_v(Vc::int_v(Vc::round(alpha))) << 24;\n-    Vc::uint_v v2 = (Vc::uint_v(Vc::int_v(Vc::round(c1))) & mask) << 16;\n-    Vc::uint_v v3 = (Vc::uint_v(Vc::int_v(Vc::round(c2))) & mask) <<  8;\n+    uint_v mask(lowByteMask);\n+    uint_v v1 = uint_v(int_v(Vc::round(alpha))) << 24;\n+    uint_v v2 = (uint_v(int_v(Vc::round(c1))) & mask) << 16;\n+    uint_v v3 = (uint_v(int_v(Vc::round(c2))) & mask) <<  8;\n+    uint_v v4 = uint_v(int_v(Vc::round(c3))) & mask;\n     v1 = v1 | v2;\n-    Vc::uint_v v4 = Vc::uint_v(Vc::int_v(Vc::round(c3))) & mask;\n     v3 = v3 | v4;\n-\n-    *((Vc::uint_v*)data) = v1 | v3;\n+    *((uint_v*)data) = v1 | v3;\n }\n \n /**"}, {"sha": "2b10257087bd256ed9497f0b39451189e900cc31", "filename": "libs/pigment/compositeops/KoVcMultiArchBuildSupport.h", "status": "modified", "additions": 4, "deletions": 8, "changes": 12, "blob_url": "https://github.com/KDE/krita/blob/c9a87c8875128756fd3b11a021447f965eb43422/libs/pigment/compositeops/KoVcMultiArchBuildSupport.h", "raw_url": "https://github.com/KDE/krita/raw/c9a87c8875128756fd3b11a021447f965eb43422/libs/pigment/compositeops/KoVcMultiArchBuildSupport.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/compositeops/KoVcMultiArchBuildSupport.h?ref=c9a87c8875128756fd3b11a021447f965eb43422", "patch": "@@ -35,6 +35,7 @@\n #pragma warning ( disable : 4244 )\n #pragma warning ( disable : 4800 )\n #endif\n+#include <Vc/global.h>\n #include <Vc/Vc>\n #include <Vc/support.h>\n #if defined _MSC_VER\n@@ -44,11 +45,9 @@\n #else /* HAVE_VC */\n \n namespace Vc {\n-    typedef enum {ScalarImpl} Implementation;\n+    typedef enum {ScalarImpl} CurrentImplementation;\n }\n \n-#define VC_IMPL ::Vc::ScalarImpl\n-\n #ifdef DO_PACKAGERS_BUILD\n #ifdef __GNUC__\n #warning \"Packagers build is not available without the presence of Vc library. Disabling.\"\n@@ -90,12 +89,9 @@ createOptimizedClass(typename FactoryType::ParamType param)\n      *\n      * TODO: Add FMA3/4 when it is adopted by Vc\n      */\n-#if VC_VERSION_NUMBER >= VC_VERSION_CHECK(0, 8, 0)\n     if (Vc::isImplementationSupported(Vc::AVX2Impl)) {\n         return FactoryType::template create<Vc::AVX2Impl>(param);\n-    } else\n-#endif\n-    if (Vc::isImplementationSupported(Vc::AVXImpl)) {\n+    } else if (Vc::isImplementationSupported(Vc::AVXImpl)) {\n         return FactoryType::template create<Vc::AVXImpl>(param);\n     } else if (Vc::isImplementationSupported(Vc::SSE41Impl)) {\n         return FactoryType::template create<Vc::SSE41Impl>(param);\n@@ -119,7 +115,7 @@ template<class FactoryType>\n typename FactoryType::ReturnType\n createOptimizedClass(typename FactoryType::ParamType param)\n {\n-    return FactoryType::template create<VC_IMPL>(param);\n+    return FactoryType::template create<Vc::CurrentImplementation::current()>(param);\n }\n \n #endif /* DO_PACKAGERS_BUILD */"}]}, {"sha": "e5109c2f553fc7e515f6f7f6944ca19497f75f02", "stats": {"total": 15, "additions": 8, "deletions": 7}, "files": [{"sha": "1c576e00787ed8b7fb16a1661474d670efa26b33", "filename": "libs/widgets/KoStrokeConfigWidget.cpp", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/KDE/krita/blob/e5109c2f553fc7e515f6f7f6944ca19497f75f02/libs/widgets/KoStrokeConfigWidget.cpp", "raw_url": "https://github.com/KDE/krita/raw/e5109c2f553fc7e515f6f7f6944ca19497f75f02/libs/widgets/KoStrokeConfigWidget.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgets/KoStrokeConfigWidget.cpp?ref=e5109c2f553fc7e515f6f7f6944ca19497f75f02", "patch": "@@ -526,16 +526,17 @@ void KoStrokeConfigWidget::setCanvas( KoCanvasBase *canvas )\n         connect(canvas->resourceManager(), SIGNAL(canvasResourceChanged(int, const QVariant&)),\n                 this, SLOT(canvasResourceChanged(int, const QVariant &)));\n         setUnit(canvas->unit());\n-    }\n \n-    d->canvas = canvas;\n-    KoDocumentResourceManager *resourceManager = canvas->shapeController()->resourceManager();\n-    if (resourceManager) {\n-        KoMarkerCollection *collection = resourceManager->resource(KoDocumentResourceManager::MarkerCollection).value<KoMarkerCollection*>();\n-        if (collection) {\n-            updateMarkers(collection->markers());\n+        KoDocumentResourceManager *resourceManager = canvas->shapeController()->resourceManager();\n+        if (resourceManager) {\n+            KoMarkerCollection *collection = resourceManager->resource(KoDocumentResourceManager::MarkerCollection).value<KoMarkerCollection*>();\n+            if (collection) {\n+                updateMarkers(collection->markers());\n+            }\n         }\n     }\n+\n+    d->canvas = canvas;\n }\n \n void KoStrokeConfigWidget::canvasResourceChanged(int key, const QVariant &value)"}]}, {"sha": "9cccb04c3ad92a26a4ed19c44c422e6c3bf9420d", "stats": {"total": 4, "additions": 4, "deletions": 0}, "files": [{"sha": "28a702f812eda95914985b51a5a795df43c67135", "filename": "plugins/extensions/resourcemanager/dlg_bundle_manager.cpp", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/9cccb04c3ad92a26a4ed19c44c422e6c3bf9420d/plugins/extensions/resourcemanager/dlg_bundle_manager.cpp", "raw_url": "https://github.com/KDE/krita/raw/9cccb04c3ad92a26a4ed19c44c422e6c3bf9420d/plugins/extensions/resourcemanager/dlg_bundle_manager.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/extensions/resourcemanager/dlg_bundle_manager.cpp?ref=9cccb04c3ad92a26a4ed19c44c422e6c3bf9420d", "patch": "@@ -355,6 +355,10 @@ void DlgBundleManager::slotImportResource()\n         else if (buttonName == \"bnImportWorkspaces\") {\n             action = m_actionManager->actionByName(\"import_workspaces\");\n         }\n+        else {\n+            warnUI << \"Unhandled bundle manager import button \" << buttonName;\n+            return;\n+        }\n \n         action->trigger();\n         refreshListData();"}]}, {"sha": "daeb04abd0876fdc752a4642f8fdb0fc24d18c9b", "stats": {"total": 11, "additions": 2, "deletions": 9}, "files": [{"sha": "14bc141a708b151bb0cf64d45a4e21dd529f5fd0", "filename": "libs/flake/KoCanvasControllerWidget.cpp", "status": "modified", "additions": 2, "deletions": 9, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/daeb04abd0876fdc752a4642f8fdb0fc24d18c9b/libs/flake/KoCanvasControllerWidget.cpp", "raw_url": "https://github.com/KDE/krita/raw/daeb04abd0876fdc752a4642f8fdb0fc24d18c9b/libs/flake/KoCanvasControllerWidget.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/flake/KoCanvasControllerWidget.cpp?ref=daeb04abd0876fdc752a4642f8fdb0fc24d18c9b", "patch": "@@ -60,15 +60,8 @@ void KoCanvasControllerWidget::Private::setDocumentOffset()\n     QWidget *canvasWidget = canvas->canvasWidget();\n \n     if (canvasWidget) {\n-        bool isCanvasOpenGL = false;\n-        QWidget *canvasWidget = canvas->canvasWidget();\n-        if (canvasWidget) {\n-            if (qobject_cast<QOpenGLWidget*>(canvasWidget) != 0) {\n-                isCanvasOpenGL = true;\n-            }\n-        }\n-\n-        if (!isCanvasOpenGL) {\n+        // If it isn't an OpenGL canvas\n+        if (qobject_cast<QOpenGLWidget*>(canvasWidget) == 0) {\n             QPoint diff = q->documentOffset() - pt;\n             if (q->canvasMode() == Spreadsheet && canvasWidget->layoutDirection() == Qt::RightToLeft) {\n                 canvasWidget->scroll(-diff.x(), diff.y());"}]}, {"sha": "8f3f6923002324bccb00b18da5f6279e42513683", "stats": {"total": 6, "additions": 4, "deletions": 2}, "files": [{"sha": "b83ac7c07b14bd382ad958ce65a61553d375d8cd", "filename": "plugins/paintops/libpaintop/kis_color_source_option.cpp", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/8f3f6923002324bccb00b18da5f6279e42513683/plugins/paintops/libpaintop/kis_color_source_option.cpp", "raw_url": "https://github.com/KDE/krita/raw/8f3f6923002324bccb00b18da5f6279e42513683/plugins/paintops/libpaintop/kis_color_source_option.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/paintops/libpaintop/kis_color_source_option.cpp?ref=8f3f6923002324bccb00b18da5f6279e42513683", "patch": "@@ -79,6 +79,8 @@ void KisColorSourceOption::readOptionSetting(const KisPropertiesConfiguration* s\n \n KisColorSource* KisColorSourceOption::createColorSource(const KisPainter* _painter) const\n {\n+    Q_ASSERT(_painter);\n+\n     switch (d->type) {\n     case PLAIN:\n         return new KisPlainColorSource(_painter->backgroundColor(), _painter->paintColor());\n@@ -89,14 +91,14 @@ KisColorSource* KisColorSourceOption::createColorSource(const KisPainter* _paint\n     case TOTAL_RANDOM:\n         return new KisTotalRandomColorSource();\n     case PATTERN: {\n-        if (_painter && _painter->pattern()) {\n+        if (_painter->pattern()) {\n             KisPaintDevice* dev = new KisPaintDevice(_painter->paintColor().colorSpace(), _painter->pattern()->name());\n             dev->convertFromQImage(_painter->pattern()->pattern(), 0);\n             return new KoPatternColorSource(dev, _painter->pattern()->width(), _painter->pattern()->height(), false);\n         }\n     }\n     case PATTERN_LOCKED: {\n-        if (_painter && _painter->pattern()) {\n+        if (_painter->pattern()) {\n             KisPaintDevice* dev = new KisPaintDevice(_painter->paintColor().colorSpace(), _painter->pattern()->name());\n             dev->convertFromQImage(_painter->pattern()->pattern(), 0);\n             return new KoPatternColorSource(dev, _painter->pattern()->width(), _painter->pattern()->height(), true);"}]}, {"sha": "36509994b0961e614add8f09db6459ddb8bca670", "stats": {"total": 22, "additions": 12, "deletions": 10}, "files": [{"sha": "02917c02a1594acfaa901c629a83dbf381245f8d", "filename": "3rdparty/CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/36509994b0961e614add8f09db6459ddb8bca670/3rdparty/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/36509994b0961e614add8f09db6459ddb8bca670/3rdparty/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/3rdparty/CMakeLists.txt?ref=36509994b0961e614add8f09db6459ddb8bca670", "patch": "@@ -53,6 +53,7 @@ if (MSVC)\n endif()\n \n if (MSYS)\n+\tset(PATCH_COMMAND patch)\n         set(GLOBAL_PROFILE ${GLOBAL_PROFILE} -DCMAKE_TOOLCHAIN_FILE=/data/mxe/mxe/usr/i686-w64-mingw32/share/cmake/mxe-conf.cmake \n                            -DCMAKE_FIND_PREFIX_PATH=${CMAKE_PREFIX_PATH}\n                            -DCMAKE_SYSTEM_INCLUDE_PATH=${CMAKE_PREFIX_PATH}/include"}, {"sha": "099e99ae736cb1de1607b1cbdef01f6cbeef5254", "filename": "libs/image/kis_keyframe_channel.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/36509994b0961e614add8f09db6459ddb8bca670/libs/image/kis_keyframe_channel.cpp", "raw_url": "https://github.com/KDE/krita/raw/36509994b0961e614add8f09db6459ddb8bca670/libs/image/kis_keyframe_channel.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_keyframe_channel.cpp?ref=36509994b0961e614add8f09db6459ddb8bca670", "patch": "@@ -26,7 +26,7 @@\n \n #include <QMap>\n \n-const KoID KisKeyframeChannel::Content = KoID(\"content\", i18n(\"Content\"));\n+const KoID KisKeyframeChannel::Content = KoID(\"content\", ki18n(\"Content\"));\n \n struct KisKeyframeChannel::Private\n {"}, {"sha": "73e0f05533ec264254c131f7c96bc566cbc70663", "filename": "libs/image/kis_layer_properties_icons.cpp", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/KDE/krita/blob/36509994b0961e614add8f09db6459ddb8bca670/libs/image/kis_layer_properties_icons.cpp", "raw_url": "https://github.com/KDE/krita/raw/36509994b0961e614add8f09db6459ddb8bca670/libs/image/kis_layer_properties_icons.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_layer_properties_icons.cpp?ref=36509994b0961e614add8f09db6459ddb8bca670", "patch": "@@ -26,15 +26,15 @@ Q_GLOBAL_STATIC(KisLayerPropertiesIcons, s_instance)\n #include <kis_icon_utils.h>\n \n \n-const KoID KisLayerPropertiesIcons::locked(\"locked\", i18n(\"Locked\"));\n-const KoID KisLayerPropertiesIcons::visible(\"visible\", i18n(\"Visible\"));\n-const KoID KisLayerPropertiesIcons::layerStyle(\"layer-style\", i18n(\"Layer Style\"));\n-const KoID KisLayerPropertiesIcons::inheritAlpha(\"inherit-alpha\", i18n(\"Inherit Alpha\"));\n-const KoID KisLayerPropertiesIcons::alphaLocked(\"alpha-locked\", i18n(\"Alpha Locked\"));\n-const KoID KisLayerPropertiesIcons::onionSkins(\"onion-skins\", i18n(\"Onion Skins\"));\n-const KoID KisLayerPropertiesIcons::passThrough(\"pass-through\", i18n(\"Pass Through\"));\n-const KoID KisLayerPropertiesIcons::selectionActive(\"selection-active\", i18n(\"Active\"));\n-const KoID KisLayerPropertiesIcons::colorLabelIndex(\"color-label\", i18n(\"Color Label\"));\n+const KoID KisLayerPropertiesIcons::locked(\"locked\", ki18n(\"Locked\"));\n+const KoID KisLayerPropertiesIcons::visible(\"visible\", ki18n(\"Visible\"));\n+const KoID KisLayerPropertiesIcons::layerStyle(\"layer-style\", ki18n(\"Layer Style\"));\n+const KoID KisLayerPropertiesIcons::inheritAlpha(\"inherit-alpha\", ki18n(\"Inherit Alpha\"));\n+const KoID KisLayerPropertiesIcons::alphaLocked(\"alpha-locked\", ki18n(\"Alpha Locked\"));\n+const KoID KisLayerPropertiesIcons::onionSkins(\"onion-skins\", ki18n(\"Onion Skins\"));\n+const KoID KisLayerPropertiesIcons::passThrough(\"pass-through\", ki18n(\"Pass Through\"));\n+const KoID KisLayerPropertiesIcons::selectionActive(\"selection-active\", ki18n(\"Active\"));\n+const KoID KisLayerPropertiesIcons::colorLabelIndex(\"color-label\", ki18n(\"Color Label\"));\n \n \n struct IconsPair {"}, {"sha": "ccd5e5e92df6b4342cec7b6bee955b1cbe1cfcb0", "filename": "libs/widgetutils/xmlgui/kswitchlanguagedialog_p.cpp", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/36509994b0961e614add8f09db6459ddb8bca670/libs/widgetutils/xmlgui/kswitchlanguagedialog_p.cpp", "raw_url": "https://github.com/KDE/krita/raw/36509994b0961e614add8f09db6459ddb8bca670/libs/widgetutils/xmlgui/kswitchlanguagedialog_p.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/widgetutils/xmlgui/kswitchlanguagedialog_p.cpp?ref=36509994b0961e614add8f09db6459ddb8bca670", "patch": "@@ -86,6 +86,7 @@ static void initializeLanguages()\n         }\n     }\n     qDebug() << \">>>>>>>>>>>>>> LANGUAGE\" << qgetenv(\"LANGUAGE\");\n+    qDebug() << \">>>>>>>>>>>>>> DATADIRS\" << qgetenv(\"XDG_DATA_DIRS\");\n }\n \n Q_COREAPP_STARTUP_FUNCTION(initializeLanguages)"}]}, {"sha": "71b4cb46f480a19b5d5fb0d6ec8249239ee52271", "stats": {"total": 3, "additions": 3, "deletions": 0}, "files": [{"sha": "418e15ca813158d41518dce287add332e4fc34e3", "filename": "libs/ui/input/kis_input_manager_p.cpp", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/71b4cb46f480a19b5d5fb0d6ec8249239ee52271/libs/ui/input/kis_input_manager_p.cpp", "raw_url": "https://github.com/KDE/krita/raw/71b4cb46f480a19b5d5fb0d6ec8249239ee52271/libs/ui/input/kis_input_manager_p.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/input/kis_input_manager_p.cpp?ref=71b4cb46f480a19b5d5fb0d6ec8249239ee52271", "patch": "@@ -281,6 +281,9 @@ void KisInputManager::Private::addStrokeShortcut(KisAbstractInputAction* action,\n         strokeShortcut->setButtons(QSet<Qt::Key>::fromList(modifiers), QSet<Qt::MouseButton>::fromList(buttonList));\n         matcher.addShortcut(strokeShortcut);\n     }\n+    else {\n+        delete strokeShortcut;\n+    }\n }\n \n void KisInputManager::Private::addKeyShortcut(KisAbstractInputAction* action, int index,"}]}, {"sha": "deda99fd2bce9b581993a33459848966598a339c", "stats": {"total": 8, "additions": 8, "deletions": 0}, "files": [{"sha": "c9d57ada49f5ed5f232bb438e58c1139ac27fb75", "filename": "plugins/impex/tiff/kis_tiff_converter.cc", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/KDE/krita/blob/deda99fd2bce9b581993a33459848966598a339c/plugins/impex/tiff/kis_tiff_converter.cc", "raw_url": "https://github.com/KDE/krita/raw/deda99fd2bce9b581993a33459848966598a339c/plugins/impex/tiff/kis_tiff_converter.cc", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/impex/tiff/kis_tiff_converter.cc?ref=deda99fd2bce9b581993a33459848966598a339c", "patch": "@@ -484,6 +484,14 @@ KisImageBuilder_Result KisTIFFConverter::readTIFFDirectory(TIFF* image)\n         tiffReader = new KisTIFFReaderTarget32bit(layer->paintDevice(), poses, alphapos, depth, sampletype, nbcolorsamples, extrasamplescount, transform, postprocessor, alphaValue.i);\n     }\n \n+    if (!tiffReader) {\n+        delete postprocessor;\n+        delete[] lineSizeCoeffs;\n+        TIFFClose(image);\n+        dbgFile << \"Image has an invalid/unsupported color type: \" << color_type;\n+        return KisImageBuilder_RESULT_INVALID_ARG;\n+    }\n+\n     if (TIFFIsTiled(image)) {\n         dbgFile << \"tiled image\";\n         uint32 tileWidth, tileHeight;"}]}, {"sha": "164fe5878fb277879d18767d4028656780243667", "stats": {"total": 23, "additions": 12, "deletions": 11}, "files": [{"sha": "239461d6af3650aba092384fb40b20f0856183fe", "filename": "libs/color/colord/KisColord.cpp", "status": "modified", "additions": 12, "deletions": 11, "changes": 23, "blob_url": "https://github.com/KDE/krita/blob/164fe5878fb277879d18767d4028656780243667/libs/color/colord/KisColord.cpp", "raw_url": "https://github.com/KDE/krita/raw/164fe5878fb277879d18767d4028656780243667/libs/color/colord/KisColord.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/color/colord/KisColord.cpp?ref=164fe5878fb277879d18767d4028656780243667", "patch": "@@ -127,25 +127,26 @@ QByteArray KisColord::deviceProfile(const QString &id, int p)\n             break;\n         }\n     }\n-    if (dev->profiles.size() > 0) {\n-        if (dev) {\n+\n+    if (dev) {\n+        if (dev->profiles.size() > 0) {\n             if (dev->profiles.size() < p) {\n                 profile = dev->profiles[p];\n             }\n             else {\n                 profile = dev->profiles[0];\n             }\n         }\n-    }\n \n-    if (profile) {\n-        //dbgKrita << \"profile filename\" << profile->filename;\n-        QFile f(profile->filename);\n-        if (f.open(QFile::ReadOnly)) {\n-            ba = f.readAll();\n-        }\n-        else {\n-            dbgKrita << \"Could not load profile\" << profile->title << profile->filename;\n+        if (profile) {\n+            //dbgKrita << \"profile filename\" << profile->filename;\n+            QFile f(profile->filename);\n+            if (f.open(QFile::ReadOnly)) {\n+                ba = f.readAll();\n+            }\n+            else {\n+                dbgKrita << \"Could not load profile\" << profile->title << profile->filename;\n+            }\n         }\n     }\n "}]}, {"sha": "ce6046152a020b02d0767fb175bb35486287b4b4", "stats": {"total": 6, "additions": 3, "deletions": 3}, "files": [{"sha": "9f5a947813243da1e5563890088aaa58a280e896", "filename": "libs/ui/KisView.cpp", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/ce6046152a020b02d0767fb175bb35486287b4b4/libs/ui/KisView.cpp", "raw_url": "https://github.com/KDE/krita/raw/ce6046152a020b02d0767fb175bb35486287b4b4/libs/ui/KisView.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisView.cpp?ref=ce6046152a020b02d0767fb175bb35486287b4b4", "patch": "@@ -259,10 +259,10 @@ KisView::~KisView()\n         KoProgressProxy *proxy = d->viewManager->statusBar()->progress()->progressProxy();\n         KIS_ASSERT_RECOVER_NOOP(proxy);\n         image()->compositeProgressProxy()->removeProxy(proxy);\n-    }\n \n-    if (d->viewManager->filterManager()->isStrokeRunning()) {\n-        d->viewManager->filterManager()->cancel();\n+        if (d->viewManager->filterManager()->isStrokeRunning()) {\n+            d->viewManager->filterManager()->cancel();\n+        }\n     }\n \n     KisPart::instance()->removeView(this);"}]}, {"sha": "7b90faa6596d3b11d2176818e5dd2b322b6a7f2b", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "411521a01ad8f3df5889737901614ef9789f6fd9", "filename": "libs/image/kis_selection_filters.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/7b90faa6596d3b11d2176818e5dd2b322b6a7f2b/libs/image/kis_selection_filters.cpp", "raw_url": "https://github.com/KDE/krita/raw/7b90faa6596d3b11d2176818e5dd2b322b6a7f2b/libs/image/kis_selection_filters.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_selection_filters.cpp?ref=7b90faa6596d3b11d2176818e5dd2b322b6a7f2b", "patch": "@@ -443,7 +443,7 @@ void KisBorderSelectionFilter::process(KisPixelSelectionSP pixelSelection, const\n     delete [] out;\n \n     for (qint32 i = 0; i < 3; i++)\n-        delete buf[i];\n+        delete[] buf[i];\n \n     max -= m_xRadius;\n     delete[] max;"}]}, {"sha": "a36022a53e85e6a670efba1986dbb6baa42fe441", "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "fe9d4b44863f5351a7de74b52b0879bc724e467b", "filename": "plugins/filters/unsharp/kis_unsharp_filter.cpp", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/a36022a53e85e6a670efba1986dbb6baa42fe441/plugins/filters/unsharp/kis_unsharp_filter.cpp", "raw_url": "https://github.com/KDE/krita/raw/a36022a53e85e6a670efba1986dbb6baa42fe441/plugins/filters/unsharp/kis_unsharp_filter.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/plugins/filters/unsharp/kis_unsharp_filter.cpp?ref=a36022a53e85e6a670efba1986dbb6baa42fe441", "patch": "@@ -159,8 +159,8 @@ void KisUnsharpFilter::processRaw(KisPaintDeviceSP device,\n         dstIt->nextRow();\n     }\n \n-    delete colors[0];\n-    delete colors[1];\n+    delete[] colors[0];\n+    delete[] colors[1];\n }\n \n void KisUnsharpFilter::processLightnessOnly(KisPaintDeviceSP device,"}]}, {"sha": "2f3d53e6c08ce812a22f058e9ae4598a9e319471", "stats": {"total": 2326, "additions": 2246, "deletions": 80}, "files": [{"sha": "82a0641e95b283d3e9b05bef9dd5c7ce62e6e64b", "filename": "CMakeLists.txt", "status": "modified", "additions": 38, "deletions": 18, "changes": 56, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -483,7 +483,7 @@ endif()\n ##\n set(OLD_CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} )\n set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake/modules )\n-macro_optional_find_package(Vc 1.0.0)\n+macro_optional_find_package(Vc 0.6.70)\n macro_log_feature(Vc_FOUND \"Vc\" \"Portable, zero-overhead SIMD library for C++\" \"https://github.com/VcDevel/Vc\" FALSE \"\" \"Required by the Krita for vectorization\")\n macro_bool_to_01(Vc_FOUND HAVE_VC)\n macro_bool_to_01(PACKAGERS_BUILD DO_PACKAGERS_BUILD)\n@@ -504,28 +504,48 @@ if(HAVE_VC)\n     endif()\n \n     #Handle Vc master\n-    if(Vc_COMPILER_IS_GCC OR Vc_COMPILER_IS_CLANG)\n-        AddCompilerFlag(\"-std=c++11\" _ok)\n-        if(NOT _ok)\n-            AddCompilerFlag(\"-std=c++0x\" _ok)\n+    if(Vc_VERSION_MAJOR GREATER 0 OR Vc_VERSION_MINOR GREATER 7)\n+        message(STATUS \"Vc version is greater than 0.7, enabling AVX2 support\")\n+\n+        if(Vc_COMPILER_IS_GCC OR Vc_COMPILER_IS_CLANG)\n+            AddCompilerFlag(\"-std=c++11\" _ok)\n+            if(NOT _ok)\n+                AddCompilerFlag(\"-std=c++0x\" _ok)\n+            endif()\n         endif()\n-    endif()\n \n-    macro(ko_compile_for_all_implementations_no_scalar _objs _src)\n-    if(PACKAGERS_BUILD)\n-        vc_compile_for_all_implementations(${_objs} ${_src} FLAGS ${ADDITIONAL_VC_FLAGS} ONLY SSE2 SSSE3 SSE4_1 AVX AVX2+FMA+BMI2)\n-    else()\n-        set(${_objs} ${_src})\n-    endif()\n-    endmacro()\n+        macro(ko_compile_for_all_implementations_no_scalar _objs _src)\n+        if(PACKAGERS_BUILD)\n+            vc_compile_for_all_implementations(${_objs} ${_src} FLAGS ${ADDITIONAL_VC_FLAGS} ONLY SSE2 SSSE3 SSE4_1 AVX AVX2)\n+        else()\n+            set(${_objs} ${_src})\n+        endif()\n+        endmacro()\n \n-    macro(ko_compile_for_all_implementations _objs _src)\n-    if(PACKAGERS_BUILD)\n-        vc_compile_for_all_implementations(${_objs} ${_src} FLAGS ${ADDITIONAL_VC_FLAGS} ONLY Scalar SSE2 SSSE3 SSE4_1 AVX AVX2+FMA+BMI2)\n+        macro(ko_compile_for_all_implementations _objs _src)\n+        if(PACKAGERS_BUILD)\n+            vc_compile_for_all_implementations(${_objs} ${_src} FLAGS ${ADDITIONAL_VC_FLAGS} ONLY Scalar SSE2 SSSE3 SSE4_1 AVX AVX2)\n+        else()\n+            set(${_objs} ${_src})\n+        endif()\n+        endmacro()\n     else()\n-        set(${_objs} ${_src})\n+        macro(ko_compile_for_all_implementations_no_scalar _objs _src)\n+        if(PACKAGERS_BUILD)\n+            vc_compile_for_all_implementations(${_objs} ${_src} FLAGS ${ADDITIONAL_VC_FLAGS} ONLY SSE2 SSSE3 SSE4_1 AVX)\n+        else()\n+            set(${_objs} ${_src})\n+        endif()\n+        endmacro()\n+\n+        macro(ko_compile_for_all_implementations _objs _src)\n+        if(PACKAGERS_BUILD)\n+            vc_compile_for_all_implementations(${_objs} ${_src} FLAGS ${ADDITIONAL_VC_FLAGS} ONLY Scalar SSE2 SSSE3 SSE4_1 AVX)\n+        else()\n+            set(${_objs} ${_src})\n+        endif()\n+        endmacro()\n     endif()\n-    endmacro()\n \n     if (NOT PACKAGERS_BUILD)\n         # Optimize everything for the current architecture"}, {"sha": "1361d627094f936ec79ffa56d36a127bba7a7771", "filename": "benchmarks/CMakeLists.txt", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/benchmarks/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/benchmarks/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/benchmarks/CMakeLists.txt?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -72,7 +72,4 @@ target_link_libraries(KisGradientBenchmark  kritaimage  Qt5::Test)\n target_link_libraries(KisLowMemoryBenchmark  kritaimage  Qt5::Test)\n target_link_libraries(KisFilterSelectionsBenchmark   kritaimage  Qt5::Test)\n target_link_libraries(KisCompositionBenchmark  kritaimage  Qt5::Test ${LINK_VC_LIB})\n-if(HAVE_VC)\n-    set_property(TARGET KisCompositionBenchmark APPEND PROPERTY COMPILE_OPTIONS \"${Vc_ARCHITECTURE_FLAGS}\")\n-endif()\n target_link_libraries(KisMaskGeneratorBenchmark  kritaimage  Qt5::Test)"}, {"sha": "75f70ff0fecb2b543edaeb423bd80d070ecf89e7", "filename": "benchmarks/kis_composition_benchmark.cpp", "status": "modified", "additions": 6, "deletions": 16, "changes": 22, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/benchmarks/kis_composition_benchmark.cpp", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/benchmarks/kis_composition_benchmark.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/benchmarks/kis_composition_benchmark.cpp?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -499,7 +499,7 @@ void checkRounding(qreal opacity, qreal flow, qreal averageOpacity = -1, quint32\n     // The error count is needed as 38.5 gets rounded to 38 instead of 39 in the vc version.\n     int errorcount = 0;\n     for (int i = 0; i < numBlocks; i++) {\n-        Compositor::template compositeVector<true,true, Vc::CurrentImplementation::current()>(src1, dst1, msk1, params.opacity, optionalParams);\n+        Compositor::template compositeVector<true,true, VC_IMPL>(src1, dst1, msk1, params.opacity, optionalParams);\n         for (int j = 0; j < vecSize; j++) {\n \n             //if (8 * i + j == 7080) {\n@@ -508,7 +508,7 @@ void checkRounding(qreal opacity, qreal flow, qreal averageOpacity = -1, quint32\n             //    dbgKrita << \"msk:\" << msk2[0];\n             //}\n \n-            Compositor::template compositeOnePixelScalar<true, Vc::CurrentImplementation::current()>(src2, dst2, msk2, params.opacity, optionalParams);\n+            Compositor::template compositeOnePixelScalar<true, VC_IMPL>(src2, dst2, msk2, params.opacity, optionalParams);\n \n             bool compareResult = true;\n             if (pixelSize == 4) {\n@@ -819,8 +819,6 @@ void KisCompositionBenchmark::benchmarkMemcpy()\n void KisCompositionBenchmark::benchmarkUintFloat()\n {\n #ifdef HAVE_VC\n-    using uint_v = Vc::SimdArray<unsigned int, Vc::float_v::size()>;\n-\n     const int dataSize = 4096;\n     void *ptr = 0;\n     int error = MEMALIGN_ALLOC(&ptr, uint8VecAlignment, dataSize);\n@@ -838,7 +836,7 @@ void KisCompositionBenchmark::benchmarkUintFloat()\n         for (int i = 0; i < dataSize; i += Vc::float_v::Size) {\n             // convert uint -> float directly, this causes\n             // static_cast helper be called\n-            Vc::float_v b(uint_v(iData + i));\n+            Vc::float_v b(Vc::uint_v(iData + i));\n             b.store(fData + i);\n         }\n     }\n@@ -851,9 +849,6 @@ void KisCompositionBenchmark::benchmarkUintFloat()\n void KisCompositionBenchmark::benchmarkUintIntFloat()\n {\n #ifdef HAVE_VC\n-    using int_v = Vc::SimdArray<int, Vc::float_v::size()>;\n-    using uint_v = Vc::SimdArray<unsigned int, Vc::float_v::size()>;\n-\n     const int dataSize = 4096;\n     void *ptr = 0;\n     int error = MEMALIGN_ALLOC(&ptr, uint8VecAlignment, dataSize);\n@@ -871,7 +866,7 @@ void KisCompositionBenchmark::benchmarkUintIntFloat()\n         for (int i = 0; i < dataSize; i += Vc::float_v::Size) {\n             // convert uint->int->float, that avoids special sign\n             // treating, and gives 2.6 times speedup\n-            Vc::float_v b(int_v(uint_v(iData + i)));\n+            Vc::float_v b(Vc::int_v(Vc::uint_v(iData + i)));\n             b.store(fData + i);\n         }\n     }\n@@ -884,8 +879,6 @@ void KisCompositionBenchmark::benchmarkUintIntFloat()\n void KisCompositionBenchmark::benchmarkFloatUint()\n {\n #ifdef HAVE_VC\n-    using uint_v = Vc::SimdArray<unsigned int, Vc::float_v::size()>;\n-\n     const int dataSize = 4096;\n     void *ptr = 0;\n     int error = MEMALIGN_ALLOC(&ptr, uint32VecAlignment, dataSize * sizeof(quint32));\n@@ -902,7 +895,7 @@ void KisCompositionBenchmark::benchmarkFloatUint()\n     QBENCHMARK {\n         for (int i = 0; i < dataSize; i += Vc::float_v::Size) {\n             // conversion float -> uint\n-            uint_v b(Vc::float_v(fData + i));\n+            Vc::uint_v b(Vc::float_v(fData + i));\n \n             b.store(iData + i);\n         }\n@@ -916,9 +909,6 @@ void KisCompositionBenchmark::benchmarkFloatUint()\n void KisCompositionBenchmark::benchmarkFloatIntUint()\n {\n #ifdef HAVE_VC\n-    using int_v = Vc::SimdArray<int, Vc::float_v::size()>;\n-    using uint_v = Vc::SimdArray<unsigned int, Vc::float_v::size()>;\n-\n     const int dataSize = 4096;\n     void *ptr = 0;\n     int error = MEMALIGN_ALLOC(&ptr, uint32VecAlignment, dataSize * sizeof(quint32));\n@@ -935,7 +925,7 @@ void KisCompositionBenchmark::benchmarkFloatIntUint()\n     QBENCHMARK {\n         for (int i = 0; i < dataSize; i += Vc::float_v::Size) {\n             // conversion float -> int -> uint\n-            uint_v b(int_v(Vc::float_v(fData + i)));\n+            Vc::uint_v b(Vc::int_v(Vc::float_v(fData + i)));\n \n             b.store(iData + i);\n         }"}, {"sha": "801cdd849f0458191829fccc063f900e14060f74", "filename": "cmake/vc/AddCompilerFlag.cmake", "status": "added", "additions": 162, "deletions": 0, "changes": 162, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/AddCompilerFlag.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/AddCompilerFlag.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/AddCompilerFlag.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -0,0 +1,162 @@\n+# - Add a given compiler flag to flags variables.\n+# AddCompilerFlag(<flag> [<var>])\n+# or\n+# AddCompilerFlag(<flag> [C_FLAGS <var>] [CXX_FLAGS <var>] [C_RESULT <var>]\n+#                        [CXX_RESULT <var>])\n+\n+#=============================================================================\n+# Copyright 2010-2013 Matthias Kretz <kretz@kde.org>\n+#\n+# Redistribution and use in source and binary forms, with or without\n+# modification, are permitted provided that the following conditions are\n+# met:\n+#\n+#  * Redistributions of source code must retain the above copyright notice,\n+#    this list of conditions and the following disclaimer.\n+#\n+#  * Redistributions in binary form must reproduce the above copyright notice,\n+#    this list of conditions and the following disclaimer in the documentation\n+#    and/or other materials provided with the distribution.\n+#\n+#  * The names of Kitware, Inc., the Insight Consortium, or the names of\n+#    any consortium members, or of any contributors, may not be used to\n+#    endorse or promote products derived from this software without\n+#    specific prior written permission.\n+#\n+# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS ``AS IS''\n+# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n+# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n+# ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR\n+# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n+# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n+# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n+# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n+# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+#=============================================================================\n+\n+get_filename_component(_currentDir \"${CMAKE_CURRENT_LIST_FILE}\" PATH)\n+include(\"${_currentDir}/CheckCCompilerFlag.cmake\")\n+include(\"${_currentDir}/CheckCXXCompilerFlag.cmake\")\n+include(\"${_currentDir}/CheckMicCCompilerFlag.cmake\")\n+include(\"${_currentDir}/CheckMicCXXCompilerFlag.cmake\")\n+\n+macro(AddCompilerFlag _flag)\n+   string(REGEX REPLACE \"[-.+/:= ]\" \"_\" _flag_esc \"${_flag}\")\n+\n+   set(_c_flags \"CMAKE_C_FLAGS\")\n+   set(_cxx_flags \"CMAKE_CXX_FLAGS\")\n+   set(_mic_c_flags \"CMAKE_MIC_C_FLAGS\")\n+   set(_mic_cxx_flags \"CMAKE_MIC_CXX_FLAGS\")\n+   set(_c_result tmp)\n+   set(_cxx_result tmp)\n+   set(_mic_c_result)\n+   set(_mic_cxx_result)\n+   if(${ARGC} EQUAL 2)\n+      message(WARNING \"Deprecated use of the AddCompilerFlag macro.\")\n+      unset(_c_result)\n+      set(_cxx_result ${ARGV1})\n+   elseif(${ARGC} GREATER 2)\n+      set(state 0)\n+      unset(_c_flags)\n+      unset(_cxx_flags)\n+      unset(_mic_c_flags)\n+      unset(_mic_cxx_flags)\n+      unset(_c_result)\n+      unset(_cxx_result)\n+      unset(_mic_c_result)\n+      unset(_mic_cxx_result)\n+      foreach(_arg ${ARGN})\n+         if(_arg STREQUAL \"C_FLAGS\")\n+            set(state 1)\n+            if(NOT DEFINED _c_result)\n+               set(_c_result tmp)\n+            endif()\n+         elseif(_arg STREQUAL \"CXX_FLAGS\")\n+            set(state 2)\n+            if(NOT DEFINED _cxx_result)\n+               set(_cxx_result tmp)\n+            endif()\n+         elseif(_arg STREQUAL \"C_RESULT\")\n+            set(state 3)\n+         elseif(_arg STREQUAL \"CXX_RESULT\")\n+            set(state 4)\n+         elseif(_arg STREQUAL \"MIC_C_RESULT\")\n+            set(state 5)\n+         elseif(_arg STREQUAL \"MIC_CXX_RESULT\")\n+            set(state 6)\n+         elseif(_arg STREQUAL \"MIC_C_FLAGS\")\n+            set(state 7)\n+         elseif(_arg STREQUAL \"MIC_CXX_FLAGS\")\n+            set(state 8)\n+         elseif(state EQUAL 1)\n+            set(_c_flags \"${_arg}\")\n+         elseif(state EQUAL 2)\n+            set(_cxx_flags \"${_arg}\")\n+         elseif(state EQUAL 3)\n+            set(_c_result \"${_arg}\")\n+         elseif(state EQUAL 4)\n+            set(_cxx_result \"${_arg}\")\n+         elseif(state EQUAL 5)\n+            set(_mic_c_result \"${_arg}\")\n+         elseif(state EQUAL 6)\n+            set(_mic_cxx_result \"${_arg}\")\n+         elseif(state EQUAL 7)\n+            set(_mic_c_flags \"${_arg}\")\n+         elseif(state EQUAL 8)\n+            set(_mic_cxx_flags \"${_arg}\")\n+         else()\n+            message(FATAL_ERROR \"Syntax error for AddCompilerFlag\")\n+         endif()\n+      endforeach()\n+   endif()\n+\n+   if(\"${_flag}\" STREQUAL \"-mfma\")\n+      # Compiling with FMA3 support may fail only at the assembler level.\n+      # In that case we need to have such an instruction in the test code\n+      set(_code \"#include <immintrin.h>\n+      __m128 foo(__m128 x) { return _mm_fmadd_ps(x, x, x); }\n+      int main() { return 0; }\")\n+   elseif(\"${_flag}\" STREQUAL \"-stdlib=libc++\")\n+      # Compiling with libc++ not only requires a compiler that understands it, but also\n+      # the libc++ headers itself\n+      set(_code \"#include <iostream>\n+      int main() { return 0; }\")\n+   else()\n+      set(_code \"int main() { return 0; }\")\n+   endif()\n+\n+   if(DEFINED _c_result)\n+      check_c_compiler_flag(\"${_flag}\" check_c_compiler_flag_${_flag_esc} \"${_code}\")\n+      set(${_c_result} ${check_c_compiler_flag_${_flag_esc}})\n+   endif()\n+   if(DEFINED _cxx_result)\n+      check_cxx_compiler_flag(\"${_flag}\" check_cxx_compiler_flag_${_flag_esc} \"${_code}\")\n+      set(${_cxx_result} ${check_cxx_compiler_flag_${_flag_esc}})\n+   endif()\n+\n+   if(check_c_compiler_flag_${_flag_esc} AND DEFINED _c_flags)\n+      set(${_c_flags} \"${${_c_flags}} ${_flag}\")\n+   endif()\n+   if(check_cxx_compiler_flag_${_flag_esc} AND DEFINED _cxx_flags)\n+      set(${_cxx_flags} \"${${_cxx_flags}} ${_flag}\")\n+   endif()\n+\n+   if(MIC_NATIVE_FOUND)\n+      if(DEFINED _mic_c_result)\n+         check_mic_c_compiler_flag(\"${_flag}\" check_mic_c_compiler_flag_${_flag_esc} \"${_code}\")\n+         set(${_mic_c_result} ${check_mic_c_compiler_flag_${_flag_esc}})\n+      endif()\n+      if(DEFINED _mic_cxx_result)\n+         check_mic_cxx_compiler_flag(\"${_flag}\" check_mic_cxx_compiler_flag_${_flag_esc} \"${_code}\")\n+         set(${_mic_cxx_result} ${check_mic_cxx_compiler_flag_${_flag_esc}})\n+      endif()\n+\n+      if(check_mic_c_compiler_flag_${_flag_esc} AND DEFINED _mic_c_flags)\n+         set(${_mic_c_flags} \"${${_mic_c_flags}} ${_flag}\")\n+      endif()\n+      if(check_mic_cxx_compiler_flag_${_flag_esc} AND DEFINED _mic_cxx_flags)\n+         set(${_mic_cxx_flags} \"${${_mic_cxx_flags}} ${_flag}\")\n+      endif()\n+   endif()\n+endmacro(AddCompilerFlag)"}, {"sha": "c410135ea897af7c6ad75a345bcec90a64625ac2", "filename": "cmake/vc/AddTargetProperty.cmake", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/AddTargetProperty.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/AddTargetProperty.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/AddTargetProperty.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -0,0 +1,39 @@\n+#=============================================================================\n+# Copyright 2010-2013 Matthias Kretz <kretz@kde.org>\n+#\n+# Redistribution and use in source and binary forms, with or without\n+# modification, are permitted provided that the following conditions are\n+# met:\n+#\n+#  * Redistributions of source code must retain the above copyright notice,\n+#    this list of conditions and the following disclaimer.\n+#\n+#  * Redistributions in binary form must reproduce the above copyright notice,\n+#    this list of conditions and the following disclaimer in the documentation\n+#    and/or other materials provided with the distribution.\n+#\n+#  * The names of Kitware, Inc., the Insight Consortium, or the names of\n+#    any consortium members, or of any contributors, may not be used to\n+#    endorse or promote products derived from this software without\n+#    specific prior written permission.\n+#\n+# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS ``AS IS''\n+# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n+# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n+# ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR\n+# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n+# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n+# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n+# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n+# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+#=============================================================================\n+\n+macro(add_target_property _target _prop _value)\n+   get_target_property(_oldprop \"${_target}\" ${_prop})\n+   if(NOT _oldprop)\n+      set_target_properties(\"${_target}\" PROPERTIES ${_prop} \"${_value}\")\n+   else(NOT _oldprop)\n+      set_target_properties(\"${_target}\" PROPERTIES ${_prop} \"${_oldprop} ${_value}\")\n+   endif(NOT _oldprop)\n+endmacro(add_target_property)"}, {"sha": "c9680c5fa0673cf5ea257edc986858ba63b5f1d0", "filename": "cmake/vc/CheckCCompilerFlag.cmake", "status": "added", "additions": 70, "deletions": 0, "changes": 70, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/CheckCCompilerFlag.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/CheckCCompilerFlag.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/CheckCCompilerFlag.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -0,0 +1,70 @@\n+# - Check whether the C compiler supports a given flag.\n+# CHECK_C_COMPILER_FLAG(<flag> <var>)\n+#  <flag> - the compiler flag\n+#  <var>  - variable to store the result\n+# This internally calls the check_c_source_compiles macro.\n+# See help for CheckCSourceCompiles for a listing of variables\n+# that can modify the build.\n+\n+#=============================================================================\n+# Copyright 2006-2009 Kitware, Inc.\n+# Copyright 2006 Alexander Neundorf <neundorf@kde.org>\n+# Copyright 2011-2013 Matthias Kretz <kretz@kde.org>\n+#\n+# Redistribution and use in source and binary forms, with or without\n+# modification, are permitted provided that the following conditions are\n+# met:\n+#\n+#  * Redistributions of source code must retain the above copyright notice,\n+#    this list of conditions and the following disclaimer.\n+#\n+#  * Redistributions in binary form must reproduce the above copyright notice,\n+#    this list of conditions and the following disclaimer in the documentation\n+#    and/or other materials provided with the distribution.\n+#\n+#  * The names of Kitware, Inc., the Insight Consortium, or the names of\n+#    any consortium members, or of any contributors, may not be used to\n+#    endorse or promote products derived from this software without\n+#    specific prior written permission.\n+#\n+# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS ``AS IS''\n+# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n+# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n+# ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR\n+# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n+# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n+# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n+# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n+# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+#=============================================================================\n+\n+INCLUDE(CheckCSourceCompiles)\n+\n+MACRO (CHECK_C_COMPILER_FLAG _FLAG _RESULT)\n+   SET(SAFE_CMAKE_REQUIRED_DEFINITIONS \"${CMAKE_REQUIRED_DEFINITIONS}\")\n+   SET(CMAKE_REQUIRED_DEFINITIONS \"${_FLAG}\")\n+   if(${ARGC} GREATER 2)\n+      SET(TEST_SOURCE \"${ARGV2}\")\n+   else()\n+      SET(TEST_SOURCE \"int main() { return 0;}\")\n+   endif()\n+   CHECK_C_SOURCE_COMPILES(\"${TEST_SOURCE}\" ${_RESULT}\n+     # Some compilers do not fail with a bad flag\n+     FAIL_REGEX \"error: bad value (.*) for .* switch\"       # GNU\n+     FAIL_REGEX \"argument unused during compilation\"        # clang\n+     FAIL_REGEX \"is valid for .* but not for C\"             # GNU\n+     FAIL_REGEX \"unrecognized .*option\"                     # GNU\n+     FAIL_REGEX \"ignored for target\"                        # GNU\n+     FAIL_REGEX \"ignoring unknown option\"                   # MSVC\n+     FAIL_REGEX \"[Uu]nknown option\"                         # HP\n+     FAIL_REGEX \"[Ww]arning: [Oo]ption\"                     # SunPro\n+     FAIL_REGEX \"command option .* is not recognized\"       # XL\n+     FAIL_REGEX \"WARNING: unknown flag:\"                    # Open64\n+     FAIL_REGEX \"command line error\"                        # ICC\n+     FAIL_REGEX \"command line warning\"                      # ICC\n+     FAIL_REGEX \"#10236:\"                                   # ICC: File not found\n+     )\n+   SET (CMAKE_REQUIRED_DEFINITIONS \"${SAFE_CMAKE_REQUIRED_DEFINITIONS}\")\n+ENDMACRO (CHECK_C_COMPILER_FLAG)\n+"}, {"sha": "72a6cc39fc97d919770e19c8edfb8a34ace10611", "filename": "cmake/vc/CheckCXXCompilerFlag.cmake", "status": "added", "additions": 70, "deletions": 0, "changes": 70, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/CheckCXXCompilerFlag.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/CheckCXXCompilerFlag.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/CheckCXXCompilerFlag.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -0,0 +1,70 @@\n+# - Check whether the CXX compiler supports a given flag.\n+# CHECK_CXX_COMPILER_FLAG(<flag> <var>)\n+#  <flag> - the compiler flag\n+#  <var>  - variable to store the result\n+# This internally calls the check_cxx_source_compiles macro.  See help\n+# for CheckCXXSourceCompiles for a listing of variables that can\n+# modify the build.\n+\n+#=============================================================================\n+# Copyright 2006-2009 Kitware, Inc.\n+# Copyright 2006 Alexander Neundorf <neundorf@kde.org>\n+# Copyright 2011-2013 Matthias Kretz <kretz@kde.org>\n+#\n+# Redistribution and use in source and binary forms, with or without\n+# modification, are permitted provided that the following conditions are\n+# met:\n+#\n+#  * Redistributions of source code must retain the above copyright notice,\n+#    this list of conditions and the following disclaimer.\n+#\n+#  * Redistributions in binary form must reproduce the above copyright notice,\n+#    this list of conditions and the following disclaimer in the documentation\n+#    and/or other materials provided with the distribution.\n+#\n+#  * The names of Kitware, Inc., the Insight Consortium, or the names of\n+#    any consortium members, or of any contributors, may not be used to\n+#    endorse or promote products derived from this software without\n+#    specific prior written permission.\n+#\n+# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS ``AS IS''\n+# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n+# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n+# ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR\n+# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n+# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n+# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n+# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n+# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+#=============================================================================\n+\n+INCLUDE(CheckCXXSourceCompiles)\n+\n+MACRO (CHECK_CXX_COMPILER_FLAG _FLAG _RESULT)\n+   SET(SAFE_CMAKE_REQUIRED_DEFINITIONS \"${CMAKE_REQUIRED_DEFINITIONS}\")\n+   SET(CMAKE_REQUIRED_DEFINITIONS \"${_FLAG}\")\n+   if(${ARGC} GREATER 2)\n+      SET(TEST_SOURCE \"${ARGV2}\")\n+   else()\n+      SET(TEST_SOURCE \"int main() { return 0;}\")\n+   endif()\n+   CHECK_CXX_SOURCE_COMPILES(\"${TEST_SOURCE}\" ${_RESULT}\n+     # Some compilers do not fail with a bad flag\n+     FAIL_REGEX \"error: bad value (.*) for .* switch\"       # GNU\n+     FAIL_REGEX \"argument unused during compilation\"        # clang\n+     FAIL_REGEX \"is valid for .* but not for C\\\\\\\\+\\\\\\\\+\"   # GNU\n+     FAIL_REGEX \"unrecognized .*option\"                     # GNU\n+     FAIL_REGEX \"ignored for target\"                        # GNU\n+     FAIL_REGEX \"ignoring unknown option\"                   # MSVC\n+     FAIL_REGEX \"[Uu]nknown option\"                         # HP\n+     FAIL_REGEX \"[Ww]arning: [Oo]ption\"                     # SunPro\n+     FAIL_REGEX \"command option .* is not recognized\"       # XL\n+     FAIL_REGEX \"WARNING: unknown flag:\"                    # Open64\n+     FAIL_REGEX \"command line error\"                        # ICC\n+     FAIL_REGEX \"command line warning\"                      # ICC\n+     FAIL_REGEX \"#10236:\"                                   # ICC: File not found\n+     )\n+   SET (CMAKE_REQUIRED_DEFINITIONS \"${SAFE_CMAKE_REQUIRED_DEFINITIONS}\")\n+ENDMACRO (CHECK_CXX_COMPILER_FLAG)\n+"}, {"sha": "eae725b790a5368270a814cc8be88cacfafb60b8", "filename": "cmake/vc/CheckMicCCompilerFlag.cmake", "status": "added", "additions": 101, "deletions": 0, "changes": 101, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/CheckMicCCompilerFlag.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/CheckMicCCompilerFlag.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/CheckMicCCompilerFlag.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -0,0 +1,101 @@\n+# - Check whether the MIC C compiler supports a given flag.\n+# CHECK_MIC_C_COMPILER_FLAG(<flag> <var>)\n+#  <flag> - the compiler flag\n+#  <var>  - variable to store the result\n+# This internally calls the check_c_source_compiles macro.  See help\n+# for CheckCSourceCompiles for a listing of variables that can\n+# modify the build.\n+\n+#=============================================================================\n+# Copyright 2006-2009 Kitware, Inc.\n+# Copyright 2006 Alexander Neundorf <neundorf@kde.org>\n+# Copyright 2011-2013 Matthias Kretz <kretz@kde.org>\n+#\n+# Redistribution and use in source and binary forms, with or without\n+# modification, are permitted provided that the following conditions are\n+# met:\n+#\n+#  * Redistributions of source code must retain the above copyright notice,\n+#    this list of conditions and the following disclaimer.\n+#\n+#  * Redistributions in binary form must reproduce the above copyright notice,\n+#    this list of conditions and the following disclaimer in the documentation\n+#    and/or other materials provided with the distribution.\n+#\n+#  * The names of Kitware, Inc., the Insight Consortium, or the names of\n+#    any consortium members, or of any contributors, may not be used to\n+#    endorse or promote products derived from this software without\n+#    specific prior written permission.\n+#\n+# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS ``AS IS''\n+# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n+# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n+# ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR\n+# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n+# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n+# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n+# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n+# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+#=============================================================================\n+\n+macro(check_mic_c_compiler_flag _FLAG _RESULT)\n+   if(\"${_RESULT}\" MATCHES \"^${_RESULT}$\")\n+      set(_tmpdir \"${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeTmp\")\n+      if(${ARGC} GREATER 2)\n+         file(WRITE \"${_tmpdir}/src.c\" \"${ARGV2}\")\n+      else()\n+         file(WRITE \"${_tmpdir}/src.c\" \"int main() { return 0; }\")\n+      endif()\n+\n+      execute_process(\n+         COMMAND \"${MIC_CC}\" -mmic -c -o \"${_tmpdir}/src.o\"\n+         \"${_FLAG}\" \"${_tmpdir}/src.c\"\n+         WORKING_DIRECTORY ${CMAKE_BINARY_DIR}\n+         RESULT_VARIABLE ${_RESULT}\n+         OUTPUT_VARIABLE OUTPUT\n+         ERROR_VARIABLE OUTPUT\n+         )\n+\n+      if(${_RESULT})\n+         foreach(_fail_regex\n+               \"error: bad value (.*) for .* switch\"       # GNU\n+               \"argument unused during compilation\"        # clang\n+               \"is valid for .* but not for C\"             # GNU\n+               \"unrecognized .*option\"                     # GNU\n+               \"ignored for target\"                        # GNU\n+               \"ignoring unknown option\"                   # MSVC\n+               \"[Uu]nknown option\"                         # HP\n+               \"[Ww]arning: [Oo]ption\"                     # SunPro\n+               \"command option .* is not recognized\"       # XL\n+               \"WARNING: unknown flag:\"                    # Open64\n+               \"command line error\"                        # ICC\n+               \"command line warning\"                      # ICC\n+               \"#10236:\"                                   # ICC: File not found\n+               )\n+            if(\"${OUTPUT}\" MATCHES \"${_fail_regex}\")\n+               set(${_RESULT} FALSE)\n+            endif()\n+         endforeach()\n+      endif()\n+\n+      if(${_RESULT})\n+         set(${_RESULT} 1 CACHE INTERNAL \"Test ${_FLAG}\")\n+         message(STATUS \"Performing Test Check MIC C   Compiler flag ${_FLAG} - Success\")\n+         file(APPEND ${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeOutput.log\n+            \"Performing MIC C Compiler Flag Test ${_FLAG} succeded with the following output:\\n\"\n+            \"${OUTPUT}\\n\"\n+            \"COMMAND: ${MIC_CC} -mmic -c -o ${_tmpdir}/src.o ${_FLAG} ${_tmpdir}/src.cpp\\n\"\n+            )\n+      else()\n+         message(STATUS \"Performing Test Check MIC C   Compiler flag ${_FLAG} - Failed\")\n+         set(${_RESULT} \"\" CACHE INTERNAL \"Test ${_FLAG}\")\n+         file(APPEND ${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeError.log\n+            \"Performing MIC C Compiler Flag Test ${_FLAG} failed with the following output:\\n\"\n+            \"${OUTPUT}\\n\"\n+            \"COMMAND: ${MIC_CC} -mmic -c -o ${_tmpdir}/src.o ${_FLAG} ${_tmpdir}/src.cpp\\n\"\n+            )\n+      endif()\n+   endif()\n+endmacro()\n+"}, {"sha": "c0444c4cc2d06a36041032225f495287d85f1b59", "filename": "cmake/vc/CheckMicCXXCompilerFlag.cmake", "status": "added", "additions": 101, "deletions": 0, "changes": 101, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/CheckMicCXXCompilerFlag.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/CheckMicCXXCompilerFlag.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/CheckMicCXXCompilerFlag.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -0,0 +1,101 @@\n+# - Check whether the MIC CXX compiler supports a given flag.\n+# CHECK_MIC_CXX_COMPILER_FLAG(<flag> <var>)\n+#  <flag> - the compiler flag\n+#  <var>  - variable to store the result\n+# This internally calls the check_cxx_source_compiles macro.  See help\n+# for CheckCXXSourceCompiles for a listing of variables that can\n+# modify the build.\n+\n+#=============================================================================\n+# Copyright 2006-2009 Kitware, Inc.\n+# Copyright 2006 Alexander Neundorf <neundorf@kde.org>\n+# Copyright 2011-2013 Matthias Kretz <kretz@kde.org>\n+#\n+# Redistribution and use in source and binary forms, with or without\n+# modification, are permitted provided that the following conditions are\n+# met:\n+#\n+#  * Redistributions of source code must retain the above copyright notice,\n+#    this list of conditions and the following disclaimer.\n+#\n+#  * Redistributions in binary form must reproduce the above copyright notice,\n+#    this list of conditions and the following disclaimer in the documentation\n+#    and/or other materials provided with the distribution.\n+#\n+#  * The names of Kitware, Inc., the Insight Consortium, or the names of\n+#    any consortium members, or of any contributors, may not be used to\n+#    endorse or promote products derived from this software without\n+#    specific prior written permission.\n+#\n+# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS ``AS IS''\n+# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n+# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n+# ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR\n+# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n+# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n+# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n+# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n+# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+#=============================================================================\n+\n+macro(check_mic_cxx_compiler_flag _FLAG _RESULT)\n+   if(\"${_RESULT}\" MATCHES \"^${_RESULT}$\")\n+      set(_tmpdir \"${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeTmp\")\n+      if(${ARGC} GREATER 2)\n+         file(WRITE \"${_tmpdir}/src.cpp\" \"${ARGV2}\")\n+      else()\n+         file(WRITE \"${_tmpdir}/src.cpp\" \"int main() { return 0; }\")\n+      endif()\n+\n+      execute_process(\n+         COMMAND \"${MIC_CXX}\" -mmic -c -o \"${_tmpdir}/src.o\"\n+         \"${_FLAG}\" \"${_tmpdir}/src.cpp\"\n+         WORKING_DIRECTORY ${CMAKE_BINARY_DIR}\n+         RESULT_VARIABLE ${_RESULT}\n+         OUTPUT_VARIABLE OUTPUT\n+         ERROR_VARIABLE OUTPUT\n+         )\n+\n+      if(${_RESULT} EQUAL 0)\n+         foreach(_fail_regex\n+               \"error: bad value (.*) for .* switch\"       # GNU\n+               \"argument unused during compilation\"        # clang\n+               \"is valid for .* but not for C\\\\\\\\+\\\\\\\\+\"   # GNU\n+               \"unrecognized .*option\"                     # GNU\n+               \"ignored for target\"                        # GNU\n+               \"ignoring unknown option\"                   # MSVC\n+               \"[Uu]nknown option\"                         # HP\n+               \"[Ww]arning: [Oo]ption\"                     # SunPro\n+               \"command option .* is not recognized\"       # XL\n+               \"WARNING: unknown flag:\"                    # Open64\n+               \"command line error\"                        # ICC\n+               \"command line warning\"                      # ICC\n+               \"#10236:\"                                   # ICC: File not found\n+               )\n+            if(\"${OUTPUT}\" MATCHES \"${_fail_regex}\")\n+               set(${_RESULT} FALSE)\n+            endif()\n+         endforeach()\n+      endif()\n+\n+      if(${_RESULT} EQUAL 0)\n+         set(${_RESULT} 1 CACHE INTERNAL \"Test ${_FLAG}\")\n+         message(STATUS \"Performing Test Check MIC C++ Compiler flag ${_FLAG} - Success\")\n+         file(APPEND ${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeOutput.log\n+            \"Performing MIC C++ Compiler Flag Test ${_FLAG} succeded with the following output:\\n\"\n+            \"${OUTPUT}\\n\"\n+            \"COMMAND: ${MIC_CXX} -mmic -c -o ${_tmpdir}/src.o ${_FLAG} ${_tmpdir}/src.cpp\\n\"\n+            )\n+      else()\n+         message(STATUS \"Performing Test Check MIC C++ Compiler flag ${_FLAG} - Failed\")\n+         set(${_RESULT} \"\" CACHE INTERNAL \"Test ${_FLAG}\")\n+         file(APPEND ${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeError.log\n+            \"Performing MIC C++ Compiler Flag Test ${_FLAG} failed with the following output:\\n\"\n+            \"${OUTPUT}\\n\"\n+            \"COMMAND: ${MIC_CXX} -mmic -c -o ${_tmpdir}/src.o ${_FLAG} ${_tmpdir}/src.cpp\\n\"\n+            )\n+      endif()\n+   endif()\n+endmacro()\n+"}, {"sha": "830c1af3dc41e5d9b3ca54f5d3273f9121af8c64", "filename": "cmake/vc/FindMIC.cmake", "status": "added", "additions": 393, "deletions": 0, "changes": 393, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/FindMIC.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/FindMIC.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/FindMIC.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -0,0 +1,393 @@\n+#  Copyright (C) 2010-2013 Matthias Kretz <kretz@kde.org>\n+#\n+#  This program is free software: you can redistribute it and/or modify\n+#  it under the terms of the GNU General Public License as published by\n+#  the Free Software Foundation, either version 3 of the License, or\n+#  (at your option) any later version.\n+#\n+#  This program is distributed in the hope that it will be useful,\n+#  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+#  GNU General Public License for more details.\n+#\n+#  You should have received a copy of the GNU General Public License\n+#  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+# This check will search for a MIC compiler and check whether the C and C++\n+# compilers are able to offload via offload pragma and target(mic) attribute.\n+# The project may choose to either build native MIC binaries, or offload\n+# binaries (hybrid code), or both. In the case where only native MIC binaries\n+# are built, the compiler does not need to support offloading\n+#\n+# MIC_NATIVE_FOUND is true if native MIC binaries can be built\n+# MIC_OFFLOAD_FOUND is true if hybrid host/MIC binaries via offload can be built\n+# MIC_FOUND is true if either MIC_NATIVE_FOUND or MIC_OFFLOAD_FOUND is true\n+#\n+# When MIC_NATIVE_FOUND is true you can use the macros\n+# mic_add_definitions\n+# mic_include_directories\n+# mic_set_link_libraries\n+# mic_add_library\n+# mic_add_executable\n+# for building native libraries/executables\n+#\n+# When MIC_OFFLOAD_FOUND is true you use the standard cmake macros to build\n+# libraries and executables but have to make sure manually that the necessary\n+# offload compiler switches are present. You might want to add something like:\n+# if(MIC_OFFLOAD_FOUND)\n+#    AddCompilerFlag(\"-offload-build\")\n+#    AddCompilerFlag(\"-offload-copts=-vec-report=3 -H\")\n+#    AddCompilerFlag(\"-offload-ldopts=-lmylib\")\n+#    AddCompilerFlag(\"-opt-report-phase=offload\")\n+# endif()\n+\n+set(MIC_FOUND false)\n+set(MIC_NATIVE_FOUND false)\n+\n+file(GLOB _intel_dirs \"/opt/intel/composer_xe_*\")\n+list(SORT _intel_dirs)\n+list(REVERSE _intel_dirs)\n+find_path(MIC_SDK_DIR bin/intel64_mic/icpc PATHS\n+   \"$ENV{MIC_SDK_DIR}\"\n+   ${_intel_dirs}\n+   )\n+\n+##############################################################################\n+# First check whether offload works\n+\n+if(NOT DEFINED c_compiler_can_offload OR NOT DEFINED cxx_compiler_can_offload)\n+   set(c_compiler_can_offload FALSE)\n+   set(cxx_compiler_can_offload FALSE)\n+\n+   # For now offload is not supported so skip it\n+#   include(CheckCSourceCompiles)\n+#   include(CheckCXXSourceCompiles)\n+#\n+#   #find_library(MIC_HOST_IMF_LIBRARY   imf   HINTS ENV LIBRARY_PATH)\n+#   #find_library(MIC_HOST_SVML_LIBRARY  svml  HINTS ENV LIBRARY_PATH)\n+#   #find_library(MIC_HOST_INTLC_LIBRARY intlc HINTS ENV LIBRARY_PATH)\n+#\n+#   #set(MIC_HOST_LIBS ${MIC_HOST_IMF_LIBRARY} ${MIC_HOST_SVML_LIBRARY} ${MIC_HOST_INTLC_LIBRARY})\n+#\n+#   set(_mic_offload_test_source \"\n+##ifdef __MIC__\n+##include <immintrin.h>\n+##endif\n+#__attribute__((target(mic))) void test()\n+#{\n+##ifdef __MIC__\n+# __m512 v = _mm512_setzero_ps();\n+# (void)v;\n+##endif\n+#}\n+#\n+#int main()\n+#{\n+##pragma offload target(mic)\n+# test();\n+# return 0;\n+#}\n+#\")\n+#\n+#   set(CMAKE_REQUIRED_FLAGS \"-offload-build\")\n+#   check_c_source_compiles(\"${_mic_offload_test_source}\" c_compiler_can_offload)\n+#   check_cxx_source_compiles(\"${_mic_offload_test_source}\" cxx_compiler_can_offload)\n+#   set(CMAKE_REQUIRED_FLAGS)\n+endif()\n+\n+if(c_compiler_can_offload AND cxx_compiler_can_offload)\n+   message(STATUS \"C/C++ Compiler can offload to MIC.\")\n+   set(MIC_OFFLOAD_FOUND true)\n+else()\n+   message(STATUS \"C/C++ Compiler can NOT offload to MIC.\")\n+   set(MIC_OFFLOAD_FOUND false)\n+endif()\n+\n+##############################################################################\n+# Next check whether everything required for native builds is available\n+\n+find_path(MIC_TARGET_TOOLS_DIR bin/x86_64-k1om-linux-ar HINTS\n+   \"$ENV{MIC_TARGET_TOOLS_DIR}\"\n+   \"${MIC_SDK_DIR}/target\"\n+   \"/usr/linux-k1om-4.7\"\n+   )\n+find_program(MIC_AR x86_64-k1om-linux-ar PATHS \"${MIC_TARGET_TOOLS_DIR}/bin\")\n+find_program(MIC_RANLIB x86_64-k1om-linux-ranlib PATHS \"${MIC_TARGET_TOOLS_DIR}/bin\")\n+find_program(MIC_NATIVELOAD micnativeloadex PATHS \"/opt/intel/mic/bin\")\n+mark_as_advanced(MIC_AR MIC_RANLIB MIC_NATIVELOAD)\n+\n+if(MIC_SDK_DIR AND MIC_AR AND MIC_RANLIB)\n+   find_program(MIC_CC  icc  HINTS \"${MIC_SDK_DIR}/bin\" \"${MIC_SDK_DIR}/bin/intel64\")\n+   find_program(MIC_CXX icpc HINTS \"${MIC_SDK_DIR}/bin\" \"${MIC_SDK_DIR}/bin/intel64\")\n+\n+   find_library(MIC_IMF_LIBRARY   imf      HINTS \"${MIC_SDK_DIR}/compiler/lib/mic\")\n+   find_library(MIC_SVML_LIBRARY  svml     HINTS \"${MIC_SDK_DIR}/compiler/lib/mic\")\n+   find_library(MIC_INTLC_LIBRARY intlc    HINTS \"${MIC_SDK_DIR}/compiler/lib/mic\")\n+   mark_as_advanced(MIC_CC MIC_CXX MIC_IMF_LIBRARY MIC_SVML_LIBRARY MIC_INTLC_LIBRARY)\n+\n+   set(MIC_LIBS ${MIC_IMF_LIBRARY} ${MIC_SVML_LIBRARY} ${MIC_INTLC_LIBRARY})\n+   set(MIC_CFLAGS \"-O2 -vec\")\n+\n+   exec_program(${MIC_CXX} ARGS -V OUTPUT_VARIABLE _mic_icc_version_string)\n+   string(REGEX MATCH \"Version (Mainline)?[0-9. a-zA-Z]+\" Vc_MIC_ICC_VERSION \"${_mic_icc_version_string}\")\n+   string(SUBSTRING \"${Vc_MIC_ICC_VERSION}\" 8 -1 Vc_MIC_ICC_VERSION)\n+   message(STATUS \"MIC ICC Version: \\\"${Vc_MIC_ICC_VERSION}\\\"\")\n+\n+   if(MIC_CC AND MIC_CXX AND MIC_IMF_LIBRARY AND MIC_SVML_LIBRARY AND MIC_INTLC_LIBRARY)\n+      set(MIC_NATIVE_FOUND true)\n+   endif()\n+endif()\n+\n+if(MIC_NATIVE_FOUND OR MIC_OFFLOAD_FOUND)\n+   set(MIC_FOUND true)\n+   list(APPEND CMAKE_MIC_CXX_FLAGS \"-diag-disable 2338\") # this switch statement does not have a default clause\n+   list(APPEND CMAKE_MIC_CXX_FLAGS \"-diag-disable 193\") # zero used for undefined preprocessing identifier \"VC_GCC\"\n+\n+   macro(mic_add_definitions)\n+      add_definitions(${ARGN})\n+      foreach(_def ${ARGN})\n+         set(_mic_cflags ${_mic_cflags} \"${_def}\")\n+      endforeach()\n+   endmacro()\n+   macro(mic_include_directories)\n+      foreach(_dir ${ARGN})\n+         set(_mic_cflags ${_mic_cflags} \"-I${_dir}\")\n+      endforeach()\n+      include_directories(${ARGN})\n+   endmacro()\n+   if(NOT DEFINED MIC_C_FLAGS)\n+      set(MIC_C_FLAGS)\n+   endif()\n+   if(NOT DEFINED MIC_CXX_FLAGS)\n+      set(MIC_CXX_FLAGS)\n+   endif()\n+else()\n+   message(WARNING \"MIC SDK was not found!\")\n+endif()\n+\n+if(MIC_NATIVE_FOUND)\n+   macro(_mic_add_object _target _source _output)\n+      get_filename_component(_abs \"${_source}\" ABSOLUTE)\n+      get_filename_component(_ext \"${_source}\" EXT)\n+      get_filename_component(_tmp \"${_source}\" NAME_WE)\n+      set(${_output} \"${CMAKE_CURRENT_BINARY_DIR}/CMakeFiles/${_target}.dir/${_tmp}${_ext}.mic.o\")\n+      set(_lang CXX)\n+      set(_compiler \"${MIC_CXX}\")\n+      if(_ext STREQUAL \"c\")\n+         set(_lang C)\n+         set(_compiler \"${MIC_CC}\")\n+      endif()\n+\n+      string(TOUPPER \"${CMAKE_BUILD_TYPE}\" _tmp)\n+      string(STRIP \"${CMAKE_MIC_${_lang}_FLAGS} ${CMAKE_${_lang}_FLAGS_${_tmp}} ${_mic_cflags}\" _flags)\n+      string(REPLACE \" \" \";\" _flags \"${_flags} ${ARGN}\")\n+      get_directory_property(_inc INCLUDE_DIRECTORIES)\n+      foreach(_i ${_inc})\n+         list(APPEND _flags \"-I${_i}\")\n+      endforeach()\n+\n+      add_custom_command(OUTPUT \"${${_output}}\"\n+         COMMAND \"${_compiler}\" -mmic\n+         -DVC_IMPL=MIC\n+         ${_flags} -c -o \"${${_output}}\" \"${_abs}\"\n+         DEPENDS \"${_abs}\"\n+         IMPLICIT_DEPENDS ${_lang} \"${_abs}\"\n+         WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}\n+         COMMENT \"Compiling (MIC) ${${_output}}\"\n+         VERBATIM\n+         )\n+   endmacro()\n+   macro(mic_set_link_libraries)\n+      set(_mic_lflags)\n+      foreach(_lib ${ARGN})\n+         get_filename_component(_lpath \"${_lib}\" PATH)\n+         get_filename_component(_lname \"${_lib}\" NAME)\n+         set(_mic_lflags ${_mic_lflags} \"-L${_lpath}\" \"-l${_lname}\")\n+      endforeach()\n+   endmacro()\n+   macro(mic_add_library _target)\n+      set(_state 0)\n+      if(BUILD_SHARED_LIBS)\n+         set(_type SHARED)\n+      else()\n+         set(_type STATIC)\n+      endif()\n+      set(_all ALL)\n+      set(_srcs)\n+      set(_cflags)\n+      set(_libs)\n+      foreach(_arg ${ARGN})\n+         if(_arg MATCHES \"^(STATIC|SHARED|MODULE)$\")\n+            set(_type ${_arg})\n+         elseif(_arg STREQUAL \"EXCLUDE_FROM_ALL\")\n+            set(_all)\n+         elseif(_arg STREQUAL \"COMPILE_FLAGS\")\n+            set(_state 1)\n+         elseif(_arg STREQUAL \"LINK_LIBRARIES\")\n+            set(_state 2)\n+         elseif(_arg STREQUAL \"SOURCES\")\n+            set(_state 0)\n+         elseif(_state EQUAL 0) # SOURCES\n+            set(_srcs ${_srcs} \"${_arg}\")\n+         elseif(_state EQUAL 1) # COMPILE_FLAGS\n+            list(APPEND _cflags \"${_arg}\")\n+         elseif(_state EQUAL 2) # LINK_LIBRARIES\n+            get_filename_component(_lpath \"${_arg}\" PATH)\n+            get_filename_component(_lname \"${_arg}\" NAME)\n+            set(_libs ${_libs} \"-L${_lpath}\" \"-l${_lname}\")\n+         endif()\n+      endforeach()\n+      set(_objects)\n+      set(_objectsStr)\n+      foreach(_src ${_srcs})\n+         _mic_add_object(\"${_target}\" \"${_src}\" _obj ${_cflags})\n+         list(APPEND _objects \"${_obj}\")\n+         set(_objectsStr \"${_objectsStr} \\\"${_obj}\\\"\")\n+      endforeach()\n+\n+      set(_outdir \"${CMAKE_CURRENT_BINARY_DIR}/x86_64-k1om-linux\")\n+      file(MAKE_DIRECTORY \"${_outdir}\")\n+\n+      #TODO: handle STATIC/SHARED/MODULE differently\n+      set(_output \"lib${_target}.a\")\n+      set(_linkscript \"${CMAKE_CURRENT_BINARY_DIR}/CMakeFiles/${_target}.dir/link.txt\")\n+      set(_cleanscript \"CMakeFiles/${_target}.dir/cmake_clean_target.cmake\")\n+      file(WRITE \"${_linkscript}\"\n+         \"${MIC_AR} cr ${_output} ${_objectsStr}\n+${MIC_RANLIB} ${_output}\n+\")\n+      file(WRITE \"${CMAKE_CURRENT_BINARY_DIR}/${_cleanscript}\"\n+         \"FILE(REMOVE_RECURSE \\\"${_output}\\\")\n+\")\n+      add_custom_command(OUTPUT \"${_outdir}/${_output}\"\n+         COMMAND \"${CMAKE_COMMAND}\" -E cmake_link_script \"${_linkscript}\" --verbose=$(VERBOSE)\n+         DEPENDS ${_objects}\n+         WORKING_DIRECTORY \"${_outdir}\"\n+         COMMENT \"Linking (MIC) ${_output}\"\n+         VERBATIM\n+         )\n+      add_custom_target(\"${_target}\" ${_all}\n+         DEPENDS \"${_outdir}/${_output}\"\n+         COMMENT \"\"\n+         SOURCES ${_srcs}\n+         )\n+      set_target_properties(\"${_target}\" PROPERTIES\n+         OUTPUT_NAME \"${_outdir}/${_output}\"\n+         )\n+   endmacro()\n+\n+   macro(mic_add_executable _target)\n+      set(_state 0)\n+      set(_all ALL)\n+      set(_srcs)\n+      set(_cflags)\n+      set(_libs)\n+      set(_libTargets)\n+      set(_dump_asm false)\n+      set(_exec_output_name \"${_target}\")\n+      foreach(_arg ${ARGN})\n+         if(_arg STREQUAL \"EXCLUDE_FROM_ALL\")\n+            set(_all)\n+         elseif(_arg STREQUAL \"COMPILE_FLAGS\")\n+            set(_state 1)\n+         elseif(_arg STREQUAL \"LINK_LIBRARIES\")\n+            set(_state 2)\n+         elseif(_arg STREQUAL \"OUTPUT_NAME\")\n+            set(_state 3)\n+         elseif(_arg STREQUAL \"SOURCES\")\n+            set(_state 0)\n+         elseif(_arg STREQUAL \"DUMP_ASM\")\n+            set(_dump_asm true)\n+         elseif(_state EQUAL 0) # SOURCES\n+            set(_srcs ${_srcs} \"${_arg}\")\n+         elseif(_state EQUAL 1) # COMPILE_FLAGS\n+            set(_cflags ${_cflags} \"${_arg}\")\n+         elseif(_state EQUAL 2) # LINK_LIBRARIES\n+            get_target_property(_tmp \"${_arg}\" OUTPUT_NAME)\n+            if(_tmp)\n+               set(_libs ${_libs} \"${_tmp}\")\n+               set(_libTargets ${_libTargets} \"${_tmp}\" \"${_arg}\")\n+            else()\n+               get_filename_component(_lpath \"${_arg}\" PATH)\n+               get_filename_component(_lname \"${_arg}\" NAME)\n+               set(_libs \"${_libs} \\\"-L${_lpath}\\\" \\\"-l${_lname}\\\"\")\n+               set(_libTargets ${_libTargets} \"${_arg}\")\n+            endif()\n+         elseif(_state EQUAL 3) # OUTPUT_NAME\n+            set(_exec_output_name \"${_arg}\")\n+         endif()\n+      endforeach()\n+      set(_objects)\n+      set(_objectsStr)\n+      foreach(_src ${_srcs})\n+         _mic_add_object(\"${_target}\" \"${_src}\" _obj ${_cflags})\n+         set(_objects ${_objects} \"${_obj}\")\n+         set(_objectsStr \"${_objectsStr} \\\"${_obj}\\\"\")\n+      endforeach()\n+\n+      set(_exec_output \"${CMAKE_CURRENT_BINARY_DIR}/${_exec_output_name}\")\n+      add_custom_command(OUTPUT \"${_exec_output}\"\n+         COMMAND \"${MIC_CXX}\" -mmic\n+         \"-L${MIC_SDK_DIR}/compiler/lib/mic/\"\n+         ${_mic_lflags} ${_objects} -o \"${_exec_output}\"\n+         ${_libs}\n+         DEPENDS ${_objects} ${_libTargets}\n+         WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}\n+         COMMENT \"Linking (MIC) ${_exec_output}\"\n+         VERBATIM\n+         )\n+      set(_dump_asm_output)\n+      if(_dump_asm)\n+         foreach(_src ${_srcs})\n+            get_filename_component(_abs \"${_src}\" ABSOLUTE)\n+            get_filename_component(_name \"${_src}\" NAME)\n+            add_custom_command(OUTPUT \"${_name}.s\"\n+               COMMAND \"${MIC_CXX}\" -mmic\n+               -DVC_IMPL=LRBni ${_mic_cflags} ${_cflags}\n+               ${_abs}\n+               -S -fsource-asm -fno-verbose-asm -o \"${_name}.x\"\n+               COMMAND sh -c \"grep -v ___tag_value '${_name}.x' | c++filt > '${_name}.s'\"\n+               COMMAND rm \"${_name}.x\"\n+               DEPENDS ${_abs}\n+               WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}\n+               COMMENT \"Creating MIC Assembly ${_name}.s\"\n+               VERBATIM\n+               )\n+            set(_dump_asm_output ${_dump_asm_output} \"${CMAKE_CURRENT_BINARY_DIR}/${_name}.s\")\n+         endforeach()\n+      endif()\n+      add_custom_target(\"${_target}\" ${_all}\n+         DEPENDS \"${_exec_output}\" ${_dump_asm_output}\n+         COMMENT \"\"\n+         SOURCES ${_srcs}\n+         )\n+      set_target_properties(\"${_target}\" PROPERTIES OUTPUT_NAME \"${_exec_output_name}\")\n+   endmacro()\n+endif()\n+\n+if(MIC_OFFLOAD_FOUND)\n+   macro(mic_offload _target)\n+      set(_mic_debug)\n+      if(CMAKE_BUILD_TYPE STREQUAL \"Debug\" OR CMAKE_BUILD_TYPE STREQUAL \"RelWithDebInfo\")\n+         set(_mic_debug \"-g\")\n+      endif()\n+      add_target_property(${_target} COMPILE_FLAGS \"-offload-build -DCAN_OFFLOAD ${_mic_debug}\")\n+      set(_offload_ldflags \"${_mic_debug}\")\n+      set(_libTargets)\n+      foreach(_lib ${ARGN})\n+         get_target_property(_tmp \"${_lib}\" OUTPUT_NAME)\n+         if(_tmp)\n+            set(_offload_ldflags \"${_offload_ldflags} ${_tmp}\")\n+            set(_libTargets ${_libTargets} \"${_arg}\")\n+         else()\n+            get_filename_component(_lpath \"${_arg}\" PATH)\n+            get_filename_component(_lname \"${_arg}\" NAME)\n+            set(_offload_ldflags \"${_offload_ldflags} -L${_lpath} -l${_lname}\")\n+         endif()\n+      endforeach()\n+      add_target_property(${_target} LINK_FLAGS \"-offload-build -offload-ldopts=\\\"${_offload_ldflags}\\\" ${_mic_debug}\")\n+      if(_libTargets)\n+         add_dependencies(${_target} ${_libTargets})\n+      endif()\n+   endmacro()\n+endif()"}, {"sha": "6ece876896810dd6823f40c84cfdf8ebe1206466", "filename": "cmake/vc/FindSSE.cmake", "status": "added", "additions": 104, "deletions": 0, "changes": 104, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/FindSSE.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/FindSSE.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/FindSSE.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -0,0 +1,104 @@\n+# Check if SSE instructions are available on the machine where \n+# the project is compiled.\n+\n+IF(CMAKE_SYSTEM_NAME MATCHES \"Linux\")\n+   EXEC_PROGRAM(cat ARGS \"/proc/cpuinfo\" OUTPUT_VARIABLE CPUINFO)\n+\n+   STRING(REGEX REPLACE \"^.*(sse2).*$\" \"\\\\1\" SSE_THERE ${CPUINFO})\n+   STRING(COMPARE EQUAL \"sse2\" \"${SSE_THERE}\" SSE2_TRUE)\n+   IF (SSE2_TRUE)\n+      set(SSE2_FOUND true CACHE BOOL \"SSE2 available on host\")\n+   ELSE (SSE2_TRUE)\n+      set(SSE2_FOUND false CACHE BOOL \"SSE2 available on host\")\n+   ENDIF (SSE2_TRUE)\n+\n+   # /proc/cpuinfo apparently omits sse3 :(\n+   STRING(REGEX REPLACE \"^.*[^s](sse3).*$\" \"\\\\1\" SSE_THERE ${CPUINFO})\n+   STRING(COMPARE EQUAL \"sse3\" \"${SSE_THERE}\" SSE3_TRUE)\n+   IF (NOT SSE3_TRUE)\n+      STRING(REGEX REPLACE \"^.*(T2300).*$\" \"\\\\1\" SSE_THERE ${CPUINFO})\n+      STRING(COMPARE EQUAL \"T2300\" \"${SSE_THERE}\" SSE3_TRUE)\n+   ENDIF (NOT SSE3_TRUE)\n+\n+   STRING(REGEX REPLACE \"^.*(ssse3).*$\" \"\\\\1\" SSE_THERE ${CPUINFO})\n+   STRING(COMPARE EQUAL \"ssse3\" \"${SSE_THERE}\" SSSE3_TRUE)\n+   IF (SSE3_TRUE OR SSSE3_TRUE)\n+      set(SSE3_FOUND true CACHE BOOL \"SSE3 available on host\")\n+   ELSE (SSE3_TRUE OR SSSE3_TRUE)\n+      set(SSE3_FOUND false CACHE BOOL \"SSE3 available on host\")\n+   ENDIF (SSE3_TRUE OR SSSE3_TRUE)\n+   IF (SSSE3_TRUE)\n+      set(SSSE3_FOUND true CACHE BOOL \"SSSE3 available on host\")\n+   ELSE (SSSE3_TRUE)\n+      set(SSSE3_FOUND false CACHE BOOL \"SSSE3 available on host\")\n+   ENDIF (SSSE3_TRUE)\n+\n+   STRING(REGEX REPLACE \"^.*(sse4_1).*$\" \"\\\\1\" SSE_THERE ${CPUINFO})\n+   STRING(COMPARE EQUAL \"sse4_1\" \"${SSE_THERE}\" SSE41_TRUE)\n+   IF (SSE41_TRUE)\n+      set(SSE4_1_FOUND true CACHE BOOL \"SSE4.1 available on host\")\n+   ELSE (SSE41_TRUE)\n+      set(SSE4_1_FOUND false CACHE BOOL \"SSE4.1 available on host\")\n+   ENDIF (SSE41_TRUE)\n+ELSEIF(CMAKE_SYSTEM_NAME MATCHES \"Darwin\")\n+   EXEC_PROGRAM(\"/usr/sbin/sysctl -n machdep.cpu.features\" OUTPUT_VARIABLE\n+      CPUINFO)\n+\n+   STRING(REGEX REPLACE \"^.*[^S](SSE2).*$\" \"\\\\1\" SSE_THERE ${CPUINFO})\n+   STRING(COMPARE EQUAL \"SSE2\" \"${SSE_THERE}\" SSE2_TRUE)\n+   IF (SSE2_TRUE)\n+      set(SSE2_FOUND true CACHE BOOL \"SSE2 available on host\")\n+   ELSE (SSE2_TRUE)\n+      set(SSE2_FOUND false CACHE BOOL \"SSE2 available on host\")\n+   ENDIF (SSE2_TRUE)\n+\n+   STRING(REGEX REPLACE \"^.*[^S](SSE3).*$\" \"\\\\1\" SSE_THERE ${CPUINFO})\n+   STRING(COMPARE EQUAL \"SSE3\" \"${SSE_THERE}\" SSE3_TRUE)\n+   IF (SSE3_TRUE)\n+      set(SSE3_FOUND true CACHE BOOL \"SSE3 available on host\")\n+   ELSE (SSE3_TRUE)\n+      set(SSE3_FOUND false CACHE BOOL \"SSE3 available on host\")\n+   ENDIF (SSE3_TRUE)\n+\n+   STRING(REGEX REPLACE \"^.*(SSSE3).*$\" \"\\\\1\" SSE_THERE ${CPUINFO})\n+   STRING(COMPARE EQUAL \"SSSE3\" \"${SSE_THERE}\" SSSE3_TRUE)\n+   IF (SSSE3_TRUE)\n+      set(SSSE3_FOUND true CACHE BOOL \"SSSE3 available on host\")\n+   ELSE (SSSE3_TRUE)\n+      set(SSSE3_FOUND false CACHE BOOL \"SSSE3 available on host\")\n+   ENDIF (SSSE3_TRUE)\n+\n+   STRING(REGEX REPLACE \"^.*(SSE4.1).*$\" \"\\\\1\" SSE_THERE ${CPUINFO})\n+   STRING(COMPARE EQUAL \"SSE4.1\" \"${SSE_THERE}\" SSE41_TRUE)\n+   IF (SSE41_TRUE)\n+      set(SSE4_1_FOUND true CACHE BOOL \"SSE4.1 available on host\")\n+   ELSE (SSE41_TRUE)\n+      set(SSE4_1_FOUND false CACHE BOOL \"SSE4.1 available on host\")\n+   ENDIF (SSE41_TRUE)\n+ELSEIF(CMAKE_SYSTEM_NAME MATCHES \"Windows\")\n+   # TODO\n+   set(SSE2_FOUND   true  CACHE BOOL \"SSE2 available on host\")\n+   set(SSE3_FOUND   false CACHE BOOL \"SSE3 available on host\")\n+   set(SSSE3_FOUND  false CACHE BOOL \"SSSE3 available on host\")\n+   set(SSE4_1_FOUND false CACHE BOOL \"SSE4.1 available on host\")\n+ELSE(CMAKE_SYSTEM_NAME MATCHES \"Linux\")\n+   set(SSE2_FOUND   true  CACHE BOOL \"SSE2 available on host\")\n+   set(SSE3_FOUND   false CACHE BOOL \"SSE3 available on host\")\n+   set(SSSE3_FOUND  false CACHE BOOL \"SSSE3 available on host\")\n+   set(SSE4_1_FOUND false CACHE BOOL \"SSE4.1 available on host\")\n+ENDIF(CMAKE_SYSTEM_NAME MATCHES \"Linux\")\n+\n+if(NOT SSE2_FOUND)\n+      MESSAGE(STATUS \"Could not find hardware support for SSE2 on this machine.\")\n+endif(NOT SSE2_FOUND)\n+if(NOT SSE3_FOUND)\n+      MESSAGE(STATUS \"Could not find hardware support for SSE3 on this machine.\")\n+endif(NOT SSE3_FOUND)\n+if(NOT SSSE3_FOUND)\n+      MESSAGE(STATUS \"Could not find hardware support for SSSE3 on this machine.\")\n+endif(NOT SSSE3_FOUND)\n+if(NOT SSE4_1_FOUND)\n+      MESSAGE(STATUS \"Could not find hardware support for SSE4.1 on this machine.\")\n+endif(NOT SSE4_1_FOUND)\n+\n+mark_as_advanced(SSE2_FOUND SSE3_FOUND SSSE3_FOUND SSE4_1_FOUND)"}, {"sha": "704bc08dc80f98ef67905ebcf0b2d52c825e983f", "filename": "cmake/vc/FindVc.cmake", "status": "added", "additions": 61, "deletions": 0, "changes": 61, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/FindVc.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/FindVc.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/FindVc.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -0,0 +1,61 @@\n+# Locate the Vc template library. Vc can be found at http://gitorious.org/Vc/\n+#\n+# This file is meant to be copied into projects that want to use Vc. It will\n+# search for VcConfig.cmake, which ships with Vc and will provide up-to-date\n+# buildsystem changes. Thus there should not be any need to update FindVc.cmake\n+# again after you integrated it into your project.\n+#\n+# This module defines the following variables:\n+# Vc_FOUND\n+# Vc_INCLUDE_DIR\n+# Vc_LIBRARIES\n+# Vc_DEFINITIONS\n+# Vc_VERSION_MAJOR\n+# Vc_VERSION_MINOR\n+# Vc_VERSION_PATCH\n+# Vc_VERSION\n+# Vc_VERSION_STRING\n+# Vc_INSTALL_DIR\n+# Vc_LIB_DIR\n+# Vc_CMAKE_MODULES_DIR\n+#\n+# The following two variables are set according to the compiler used. Feel free\n+# to use them to skip whole compilation units.\n+# Vc_SSE_INTRINSICS_BROKEN\n+# Vc_AVX_INTRINSICS_BROKEN\n+#\n+#=============================================================================\n+# Copyright 2009-2012   Matthias Kretz <kretz@kde.org>\n+#\n+# Redistribution and use in source and binary forms, with or without\n+# modification, are permitted provided that the following conditions are\n+# met:\n+#\n+#  * Redistributions of source code must retain the above copyright notice,\n+#    this list of conditions and the following disclaimer.\n+#\n+#  * Redistributions in binary form must reproduce the above copyright notice,\n+#    this list of conditions and the following disclaimer in the documentation\n+#    and/or other materials provided with the distribution.\n+#\n+#  * The names of Kitware, Inc., the Insight Consortium, or the names of\n+#    any consortium members, or of any contributors, may not be used to\n+#    endorse or promote products derived from this software without\n+#    specific prior written permission.\n+#\n+# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS ``AS IS''\n+# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n+# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n+# ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR\n+# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n+# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n+# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n+# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n+# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+#=============================================================================\n+\n+find_package(Vc ${Vc_FIND_VERSION} QUIET NO_MODULE PATHS $ENV{HOME} /opt/Vc)\n+\n+include(FindPackageHandleStandardArgs)\n+find_package_handle_standard_args(Vc CONFIG_MODE)"}, {"sha": "0bdcae3cfee0c6e0461ca7ce3186c2bd5cebcd4b", "filename": "cmake/vc/OptimizeForArchitecture.cmake", "status": "added", "additions": 468, "deletions": 0, "changes": 468, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/OptimizeForArchitecture.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/OptimizeForArchitecture.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/OptimizeForArchitecture.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -0,0 +1,468 @@\n+#=============================================================================\n+# Copyright 2010-2013 Matthias Kretz <kretz@kde.org>\n+#\n+# Redistribution and use in source and binary forms, with or without\n+# modification, are permitted provided that the following conditions are\n+# met:\n+#\n+#  * Redistributions of source code must retain the above copyright notice,\n+#    this list of conditions and the following disclaimer.\n+#\n+#  * Redistributions in binary form must reproduce the above copyright notice,\n+#    this list of conditions and the following disclaimer in the documentation\n+#    and/or other materials provided with the distribution.\n+#\n+#  * The names of Kitware, Inc., the Insight Consortium, or the names of\n+#    any consortium members, or of any contributors, may not be used to\n+#    endorse or promote products derived from this software without\n+#    specific prior written permission.\n+#\n+# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS ``AS IS''\n+# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n+# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n+# ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR\n+# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n+# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n+# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n+# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n+# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+#=============================================================================\n+\n+get_filename_component(_currentDir \"${CMAKE_CURRENT_LIST_FILE}\" PATH)\n+include(\"${_currentDir}/AddCompilerFlag.cmake\")\n+include(CheckIncludeFile)\n+\n+macro(_my_find _list _value _ret)\n+   list(FIND ${_list} \"${_value}\" _found)\n+   if(_found EQUAL -1)\n+      set(${_ret} FALSE)\n+   else(_found EQUAL -1)\n+      set(${_ret} TRUE)\n+   endif(_found EQUAL -1)\n+endmacro(_my_find)\n+\n+macro(AutodetectHostArchitecture)\n+   set(TARGET_ARCHITECTURE \"generic\")\n+   set(Vc_ARCHITECTURE_FLAGS)\n+   set(_vendor_id)\n+   set(_cpu_family)\n+   set(_cpu_model)\n+   if(CMAKE_SYSTEM_NAME STREQUAL \"Linux\")\n+      file(READ \"/proc/cpuinfo\" _cpuinfo)\n+      string(REGEX REPLACE \".*vendor_id[ \\t]*:[ \\t]+([a-zA-Z0-9_-]+).*\" \"\\\\1\" _vendor_id \"${_cpuinfo}\")\n+      string(REGEX REPLACE \".*cpu family[ \\t]*:[ \\t]+([a-zA-Z0-9_-]+).*\" \"\\\\1\" _cpu_family \"${_cpuinfo}\")\n+      string(REGEX REPLACE \".*model[ \\t]*:[ \\t]+([a-zA-Z0-9_-]+).*\" \"\\\\1\" _cpu_model \"${_cpuinfo}\")\n+      string(REGEX REPLACE \".*flags[ \\t]*:[ \\t]+([^\\n]+).*\" \"\\\\1\" _cpu_flags \"${_cpuinfo}\")\n+   elseif(CMAKE_SYSTEM_NAME STREQUAL \"Darwin\")\n+      exec_program(\"/usr/sbin/sysctl -n machdep.cpu.vendor\" OUTPUT_VARIABLE _vendor_id)\n+      exec_program(\"/usr/sbin/sysctl -n machdep.cpu.model\"  OUTPUT_VARIABLE _cpu_model)\n+      exec_program(\"/usr/sbin/sysctl -n machdep.cpu.family\" OUTPUT_VARIABLE _cpu_family)\n+      exec_program(\"/usr/sbin/sysctl -n machdep.cpu.features\" OUTPUT_VARIABLE _cpu_flags)\n+      string(TOLOWER \"${_cpu_flags}\" _cpu_flags)\n+      string(REPLACE \".\" \"_\" _cpu_flags \"${_cpu_flags}\")\n+   elseif(CMAKE_SYSTEM_NAME STREQUAL \"Windows\")\n+      get_filename_component(_vendor_id \"[HKEY_LOCAL_MACHINE\\\\Hardware\\\\Description\\\\System\\\\CentralProcessor\\\\0;VendorIdentifier]\" NAME CACHE)\n+      get_filename_component(_cpu_id \"[HKEY_LOCAL_MACHINE\\\\Hardware\\\\Description\\\\System\\\\CentralProcessor\\\\0;Identifier]\" NAME CACHE)\n+      mark_as_advanced(_vendor_id _cpu_id)\n+      string(REGEX REPLACE \".* Family ([0-9]+) .*\" \"\\\\1\" _cpu_family \"${_cpu_id}\")\n+      string(REGEX REPLACE \".* Model ([0-9]+) .*\" \"\\\\1\" _cpu_model \"${_cpu_id}\")\n+   endif(CMAKE_SYSTEM_NAME STREQUAL \"Linux\")\n+   if(_vendor_id STREQUAL \"GenuineIntel\")\n+      if(_cpu_family EQUAL 6)\n+         # Any recent Intel CPU except NetBurst\n+         if(_cpu_model EQUAL 58)\n+            set(TARGET_ARCHITECTURE \"ivy-bridge\")\n+         elseif(_cpu_model EQUAL 47) # Xeon E7 4860\n+            set(TARGET_ARCHITECTURE \"westmere\")\n+         elseif(_cpu_model EQUAL 46) # Xeon 7500 series\n+            set(TARGET_ARCHITECTURE \"westmere\")\n+         elseif(_cpu_model EQUAL 45) # Xeon TNG\n+            set(TARGET_ARCHITECTURE \"sandy-bridge\")\n+         elseif(_cpu_model EQUAL 44) # Xeon 5600 series\n+            set(TARGET_ARCHITECTURE \"westmere\")\n+         elseif(_cpu_model EQUAL 42) # Core TNG\n+            set(TARGET_ARCHITECTURE \"sandy-bridge\")\n+         elseif(_cpu_model EQUAL 37) # Core i7/i5/i3\n+            set(TARGET_ARCHITECTURE \"westmere\")\n+         elseif(_cpu_model EQUAL 31) # Core i7/i5\n+            set(TARGET_ARCHITECTURE \"westmere\")\n+         elseif(_cpu_model EQUAL 30) # Core i7/i5\n+            set(TARGET_ARCHITECTURE \"westmere\")\n+         elseif(_cpu_model EQUAL 29)\n+            set(TARGET_ARCHITECTURE \"penryn\")\n+         elseif(_cpu_model EQUAL 28)\n+            set(TARGET_ARCHITECTURE \"atom\")\n+         elseif(_cpu_model EQUAL 26)\n+            set(TARGET_ARCHITECTURE \"nehalem\")\n+         elseif(_cpu_model EQUAL 23)\n+            set(TARGET_ARCHITECTURE \"penryn\")\n+         elseif(_cpu_model EQUAL 15)\n+            set(TARGET_ARCHITECTURE \"merom\")\n+         elseif(_cpu_model EQUAL 14)\n+            set(TARGET_ARCHITECTURE \"core\")\n+         elseif(_cpu_model LESS 14)\n+            message(WARNING \"Your CPU (family ${_cpu_family}, model ${_cpu_model}) is not known. Auto-detection of optimization flags failed and will use the generic CPU settings with SSE2.\")\n+            set(TARGET_ARCHITECTURE \"generic\")\n+         else()\n+            message(WARNING \"Your CPU (family ${_cpu_family}, model ${_cpu_model}) is not known. Auto-detection of optimization flags failed and will use the 65nm Core 2 CPU settings.\")\n+            set(TARGET_ARCHITECTURE \"merom\")\n+         endif()\n+      elseif(_cpu_family EQUAL 7) # Itanium (not supported)\n+         message(WARNING \"Your CPU (Itanium: family ${_cpu_family}, model ${_cpu_model}) is not supported by OptimizeForArchitecture.cmake.\")\n+      elseif(_cpu_family EQUAL 15) # NetBurst\n+         list(APPEND _available_vector_units_list \"sse\" \"sse2\")\n+         if(_cpu_model GREATER 2) # Not sure whether this must be 3 or even 4 instead\n+            list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\")\n+         endif(_cpu_model GREATER 2)\n+      endif(_cpu_family EQUAL 6)\n+   elseif(_vendor_id STREQUAL \"AuthenticAMD\")\n+      if(_cpu_family EQUAL 21) # 15h\n+         if(_cpu_model LESS 2)\n+            set(TARGET_ARCHITECTURE \"bulldozer\")\n+         else()\n+            set(TARGET_ARCHITECTURE \"piledriver\")\n+         endif()\n+      elseif(_cpu_family EQUAL 20) # 14h\n+      elseif(_cpu_family EQUAL 18) # 12h\n+      elseif(_cpu_family EQUAL 16) # 10h\n+         set(TARGET_ARCHITECTURE \"barcelona\")\n+      elseif(_cpu_family EQUAL 15)\n+         set(TARGET_ARCHITECTURE \"k8\")\n+         if(_cpu_model GREATER 64) # I don't know the right number to put here. This is just a guess from the hardware I have access to\n+            set(TARGET_ARCHITECTURE \"k8-sse3\")\n+         endif(_cpu_model GREATER 64)\n+      endif()\n+   endif(_vendor_id STREQUAL \"GenuineIntel\")\n+endmacro()\n+\n+macro(OptimizeForArchitecture)\n+   set(TARGET_ARCHITECTURE \"auto\" CACHE STRING \"CPU architecture to optimize for. Using an incorrect setting here can result in crashes of the resulting binary because of invalid instructions used.\\nSetting the value to \\\"auto\\\" will try to optimize for the architecture where cmake is called.\\nOther supported values are: \\\"none\\\", \\\"generic\\\", \\\"core\\\", \\\"merom\\\" (65nm Core2), \\\"penryn\\\" (45nm Core2), \\\"nehalem\\\", \\\"westmere\\\", \\\"sandy-bridge\\\", \\\"ivy-bridge\\\", \\\"atom\\\", \\\"k8\\\", \\\"k8-sse3\\\", \\\"barcelona\\\", \\\"istanbul\\\", \\\"magny-cours\\\", \\\"bulldozer\\\", \\\"interlagos\\\", \\\"piledriver\\\".\")\n+   set(_force)\n+   if(NOT _last_target_arch STREQUAL \"${TARGET_ARCHITECTURE}\")\n+      message(STATUS \"target changed from \\\"${_last_target_arch}\\\" to \\\"${TARGET_ARCHITECTURE}\\\"\")\n+      set(_force FORCE)\n+   endif()\n+   set(_last_target_arch \"${TARGET_ARCHITECTURE}\" CACHE STRING \"\" FORCE)\n+   mark_as_advanced(_last_target_arch)\n+   string(TOLOWER \"${TARGET_ARCHITECTURE}\" TARGET_ARCHITECTURE)\n+\n+   set(_march_flag_list)\n+   set(_available_vector_units_list)\n+\n+   if(TARGET_ARCHITECTURE STREQUAL \"auto\")\n+      AutodetectHostArchitecture()\n+      message(STATUS \"Detected CPU: ${TARGET_ARCHITECTURE}\")\n+   endif(TARGET_ARCHITECTURE STREQUAL \"auto\")\n+\n+   if(TARGET_ARCHITECTURE STREQUAL \"core\")\n+      list(APPEND _march_flag_list \"core2\")\n+      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\")\n+   elseif(TARGET_ARCHITECTURE STREQUAL \"merom\")\n+      list(APPEND _march_flag_list \"merom\")\n+      list(APPEND _march_flag_list \"core2\")\n+      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\")\n+   elseif(TARGET_ARCHITECTURE STREQUAL \"penryn\")\n+      list(APPEND _march_flag_list \"penryn\")\n+      list(APPEND _march_flag_list \"core2\")\n+      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\")\n+      message(STATUS \"Sadly the Penryn architecture exists in variants with SSE4.1 and without SSE4.1.\")\n+      if(_cpu_flags MATCHES \"sse4_1\")\n+         message(STATUS \"SSE4.1: enabled (auto-detected from this computer's CPU flags)\")\n+         list(APPEND _available_vector_units_list \"sse4.1\")\n+      else()\n+         message(STATUS \"SSE4.1: disabled (auto-detected from this computer's CPU flags)\")\n+      endif()\n+   elseif(TARGET_ARCHITECTURE STREQUAL \"nehalem\")\n+      list(APPEND _march_flag_list \"nehalem\")\n+      list(APPEND _march_flag_list \"corei7\")\n+      list(APPEND _march_flag_list \"core2\")\n+      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\" \"sse4.1\" \"sse4.2\")\n+   elseif(TARGET_ARCHITECTURE STREQUAL \"westmere\")\n+      list(APPEND _march_flag_list \"westmere\")\n+      list(APPEND _march_flag_list \"corei7\")\n+      list(APPEND _march_flag_list \"core2\")\n+      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\" \"sse4.1\" \"sse4.2\")\n+   elseif(TARGET_ARCHITECTURE STREQUAL \"ivy-bridge\")\n+      list(APPEND _march_flag_list \"core-avx-i\")\n+      list(APPEND _march_flag_list \"corei7-avx\")\n+      list(APPEND _march_flag_list \"core2\")\n+      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\" \"sse4.1\" \"sse4.2\" \"avx\" \"rdrnd\" \"f16c\")\n+   elseif(TARGET_ARCHITECTURE STREQUAL \"sandy-bridge\")\n+      list(APPEND _march_flag_list \"sandybridge\")\n+      list(APPEND _march_flag_list \"corei7-avx\")\n+      list(APPEND _march_flag_list \"core2\")\n+      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\" \"sse4.1\" \"sse4.2\" \"avx\")\n+   elseif(TARGET_ARCHITECTURE STREQUAL \"atom\")\n+      list(APPEND _march_flag_list \"atom\")\n+      list(APPEND _march_flag_list \"core2\")\n+      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\")\n+   elseif(TARGET_ARCHITECTURE STREQUAL \"k8\")\n+      list(APPEND _march_flag_list \"k8\")\n+      list(APPEND _available_vector_units_list \"sse\" \"sse2\")\n+   elseif(TARGET_ARCHITECTURE STREQUAL \"k8-sse3\")\n+      list(APPEND _march_flag_list \"k8-sse3\")\n+      list(APPEND _march_flag_list \"k8\")\n+      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\")\n+   elseif(TARGET_ARCHITECTURE STREQUAL \"piledriver\")\n+      list(APPEND _march_flag_list \"bdver2\")\n+      list(APPEND _march_flag_list \"bdver1\")\n+      list(APPEND _march_flag_list \"bulldozer\")\n+      list(APPEND _march_flag_list \"barcelona\")\n+      list(APPEND _march_flag_list \"core2\")\n+      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\" \"sse4a\" \"sse4.1\" \"sse4.2\" \"avx\" \"xop\" \"fma4\" \"fma\" \"f16c\")\n+   elseif(TARGET_ARCHITECTURE STREQUAL \"interlagos\")\n+      list(APPEND _march_flag_list \"bdver1\")\n+      list(APPEND _march_flag_list \"bulldozer\")\n+      list(APPEND _march_flag_list \"barcelona\")\n+      list(APPEND _march_flag_list \"core2\")\n+      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\" \"sse4a\" \"sse4.1\" \"sse4.2\" \"avx\" \"xop\" \"fma4\")\n+   elseif(TARGET_ARCHITECTURE STREQUAL \"bulldozer\")\n+      list(APPEND _march_flag_list \"bdver1\")\n+      list(APPEND _march_flag_list \"bulldozer\")\n+      list(APPEND _march_flag_list \"barcelona\")\n+      list(APPEND _march_flag_list \"core2\")\n+      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"ssse3\" \"sse4a\" \"sse4.1\" \"sse4.2\" \"avx\" \"xop\" \"fma4\")\n+   elseif(TARGET_ARCHITECTURE STREQUAL \"barcelona\")\n+      list(APPEND _march_flag_list \"barcelona\")\n+      list(APPEND _march_flag_list \"core2\")\n+      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"sse4a\")\n+   elseif(TARGET_ARCHITECTURE STREQUAL \"istanbul\")\n+      list(APPEND _march_flag_list \"barcelona\")\n+      list(APPEND _march_flag_list \"core2\")\n+      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"sse4a\")\n+   elseif(TARGET_ARCHITECTURE STREQUAL \"magny-cours\")\n+      list(APPEND _march_flag_list \"barcelona\")\n+      list(APPEND _march_flag_list \"core2\")\n+      list(APPEND _available_vector_units_list \"sse\" \"sse2\" \"sse3\" \"sse4a\")\n+   elseif(TARGET_ARCHITECTURE STREQUAL \"generic\")\n+      list(APPEND _march_flag_list \"generic\")\n+   elseif(TARGET_ARCHITECTURE STREQUAL \"none\")\n+      # add this clause to remove it from the else clause\n+   else(TARGET_ARCHITECTURE STREQUAL \"core\")\n+      message(FATAL_ERROR \"Unknown target architecture: \\\"${TARGET_ARCHITECTURE}\\\". Please set TARGET_ARCHITECTURE to a supported value.\")\n+   endif(TARGET_ARCHITECTURE STREQUAL \"core\")\n+\n+   if(NOT TARGET_ARCHITECTURE STREQUAL \"none\")\n+      set(_disable_vector_unit_list)\n+      set(_enable_vector_unit_list)\n+      _my_find(_available_vector_units_list \"sse2\" SSE2_FOUND)\n+      _my_find(_available_vector_units_list \"sse3\" SSE3_FOUND)\n+      _my_find(_available_vector_units_list \"ssse3\" SSSE3_FOUND)\n+      _my_find(_available_vector_units_list \"sse4.1\" SSE4_1_FOUND)\n+      _my_find(_available_vector_units_list \"sse4.2\" SSE4_2_FOUND)\n+      _my_find(_available_vector_units_list \"sse4a\" SSE4a_FOUND)\n+      if(DEFINED Vc_AVX_INTRINSICS_BROKEN AND Vc_AVX_INTRINSICS_BROKEN)\n+         UserWarning(\"AVX disabled per default because of old/broken compiler\")\n+         set(AVX_FOUND false)\n+         set(XOP_FOUND false)\n+         set(FMA4_FOUND false)\n+         set(AVX2_FOUND false)\n+      else()\n+         _my_find(_available_vector_units_list \"avx\" AVX_FOUND)\n+         if(DEFINED Vc_FMA4_INTRINSICS_BROKEN AND Vc_FMA4_INTRINSICS_BROKEN)\n+            UserWarning(\"FMA4 disabled per default because of old/broken compiler\")\n+            set(FMA4_FOUND false)\n+         else()\n+            _my_find(_available_vector_units_list \"fma4\" FMA4_FOUND)\n+         endif()\n+         if(DEFINED Vc_XOP_INTRINSICS_BROKEN AND Vc_XOP_INTRINSICS_BROKEN)\n+            UserWarning(\"XOP disabled per default because of old/broken compiler\")\n+            set(XOP_FOUND false)\n+         else()\n+            _my_find(_available_vector_units_list \"xop\" XOP_FOUND)\n+         endif()\n+         if(DEFINED Vc_AVX2_INTRINSICS_BROKEN AND Vc_AVX2_INTRINSICS_BROKEN)\n+            UserWarning(\"AVX2 disabled per default because of old/broken compiler\")\n+            set(AVX2_FOUND false)\n+         else()\n+            _my_find(_available_vector_units_list \"avx2\" AVX2_FOUND)\n+         endif()\n+      endif()\n+      set(USE_SSE2   ${SSE2_FOUND}   CACHE BOOL \"Use SSE2. If SSE2 instructions are not enabled the SSE implementation will be disabled.\" ${_force})\n+      set(USE_SSE3   ${SSE3_FOUND}   CACHE BOOL \"Use SSE3. If SSE3 instructions are not enabled they will be emulated.\" ${_force})\n+      set(USE_SSSE3  ${SSSE3_FOUND}  CACHE BOOL \"Use SSSE3. If SSSE3 instructions are not enabled they will be emulated.\" ${_force})\n+      set(USE_SSE4_1 ${SSE4_1_FOUND} CACHE BOOL \"Use SSE4.1. If SSE4.1 instructions are not enabled they will be emulated.\" ${_force})\n+      set(USE_SSE4_2 ${SSE4_2_FOUND} CACHE BOOL \"Use SSE4.2. If SSE4.2 instructions are not enabled they will be emulated.\" ${_force})\n+      set(USE_SSE4a  ${SSE4a_FOUND}  CACHE BOOL \"Use SSE4a. If SSE4a instructions are not enabled they will be emulated.\" ${_force})\n+      set(USE_AVX    ${AVX_FOUND}    CACHE BOOL \"Use AVX. This will double some of the vector sizes relative to SSE.\" ${_force})\n+      set(USE_AVX2   ${AVX2_FOUND}   CACHE BOOL \"Use AVX2. This will double all of the vector sizes relative to SSE.\" ${_force})\n+      set(USE_XOP    ${XOP_FOUND}    CACHE BOOL \"Use XOP.\" ${_force})\n+      set(USE_FMA4   ${FMA4_FOUND}   CACHE BOOL \"Use FMA4.\" ${_force})\n+      mark_as_advanced(USE_SSE2 USE_SSE3 USE_SSSE3 USE_SSE4_1 USE_SSE4_2 USE_SSE4a USE_AVX USE_AVX2 USE_XOP USE_FMA4)\n+      if(USE_SSE2)\n+         list(APPEND _enable_vector_unit_list \"sse2\")\n+      else(USE_SSE2)\n+         list(APPEND _disable_vector_unit_list \"sse2\")\n+      endif(USE_SSE2)\n+      if(USE_SSE3)\n+         list(APPEND _enable_vector_unit_list \"sse3\")\n+      else(USE_SSE3)\n+         list(APPEND _disable_vector_unit_list \"sse3\")\n+      endif(USE_SSE3)\n+      if(USE_SSSE3)\n+         list(APPEND _enable_vector_unit_list \"ssse3\")\n+      else(USE_SSSE3)\n+         list(APPEND _disable_vector_unit_list \"ssse3\")\n+      endif(USE_SSSE3)\n+      if(USE_SSE4_1)\n+         list(APPEND _enable_vector_unit_list \"sse4.1\")\n+      else(USE_SSE4_1)\n+         list(APPEND _disable_vector_unit_list \"sse4.1\")\n+      endif(USE_SSE4_1)\n+      if(USE_SSE4_2)\n+         list(APPEND _enable_vector_unit_list \"sse4.2\")\n+      else(USE_SSE4_2)\n+         list(APPEND _disable_vector_unit_list \"sse4.2\")\n+      endif(USE_SSE4_2)\n+      if(USE_SSE4a)\n+         list(APPEND _enable_vector_unit_list \"sse4a\")\n+      else(USE_SSE4a)\n+         list(APPEND _disable_vector_unit_list \"sse4a\")\n+      endif(USE_SSE4a)\n+      if(USE_AVX)\n+         list(APPEND _enable_vector_unit_list \"avx\")\n+         # we want SSE intrinsics to result in instructions using the VEX prefix.\n+         # Otherwise integer ops (which require the older SSE intrinsics) would\n+         # always have a large penalty.\n+         list(APPEND _enable_vector_unit_list \"sse2avx\")\n+      else(USE_AVX)\n+         list(APPEND _disable_vector_unit_list \"avx\")\n+      endif(USE_AVX)\n+      if(USE_XOP)\n+         list(APPEND _enable_vector_unit_list \"xop\")\n+      else()\n+         list(APPEND _disable_vector_unit_list \"xop\")\n+      endif()\n+      if(USE_FMA4)\n+         list(APPEND _enable_vector_unit_list \"fma4\")\n+      else()\n+         list(APPEND _disable_vector_unit_list \"fma4\")\n+      endif()\n+      if(USE_AVX2)\n+         list(APPEND _enable_vector_unit_list \"avx2\")\n+      else()\n+         list(APPEND _disable_vector_unit_list \"avx2\")\n+      endif()\n+      if(MSVC)\n+         # MSVC on 32 bit can select /arch:SSE2 (since 2010 also /arch:AVX)\n+         # MSVC on 64 bit cannot select anything (should have changed with MSVC 2010)\n+         _my_find(_enable_vector_unit_list \"avx\" _avx)\n+         set(_avx_flag FALSE)\n+         if(_avx)\n+            AddCompilerFlag(\"/arch:AVX\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS CXX_RESULT _avx_flag)\n+         endif()\n+         if(NOT _avx_flag)\n+            _my_find(_enable_vector_unit_list \"sse2\" _found)\n+            if(_found)\n+               AddCompilerFlag(\"/arch:SSE2\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n+            endif()\n+         endif()\n+         foreach(_flag ${_enable_vector_unit_list})\n+            string(TOUPPER \"${_flag}\" _flag)\n+            string(REPLACE \".\" \"_\" _flag \"__${_flag}__\")\n+            add_definitions(\"-D${_flag}\")\n+         endforeach(_flag)\n+      elseif(CMAKE_CXX_COMPILER MATCHES \"/(icpc|icc)$\") # ICC (on Linux)\n+         _my_find(_available_vector_units_list \"avx2\"    _found)\n+         if(_found)\n+            AddCompilerFlag(\"-xCORE-AVX2\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n+         else(_found)\n+            _my_find(_available_vector_units_list \"f16c\"    _found)\n+            if(_found)\n+               AddCompilerFlag(\"-xCORE-AVX-I\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n+            else(_found)\n+               _my_find(_available_vector_units_list \"avx\"    _found)\n+               if(_found)\n+                  AddCompilerFlag(\"-xAVX\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n+               else(_found)\n+                  _my_find(_available_vector_units_list \"sse4.2\" _found)\n+                  if(_found)\n+                     AddCompilerFlag(\"-xSSE4.2\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n+                  else(_found)\n+                     _my_find(_available_vector_units_list \"sse4.1\" _found)\n+                     if(_found)\n+                        AddCompilerFlag(\"-xSSE4.1\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n+                     else(_found)\n+                        _my_find(_available_vector_units_list \"ssse3\"  _found)\n+                        if(_found)\n+                           AddCompilerFlag(\"-xSSSE3\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n+                        else(_found)\n+                           _my_find(_available_vector_units_list \"sse3\"   _found)\n+                           if(_found)\n+                              # If the target host is an AMD machine then we still want to use -xSSE2 because the binary would refuse to run at all otherwise\n+                              _my_find(_march_flag_list \"barcelona\" _found)\n+                              if(NOT _found)\n+                                 _my_find(_march_flag_list \"k8-sse3\" _found)\n+                              endif(NOT _found)\n+                              if(_found)\n+                                 AddCompilerFlag(\"-xSSE2\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n+                              else(_found)\n+                                 AddCompilerFlag(\"-xSSE3\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n+                              endif(_found)\n+                           else(_found)\n+                              _my_find(_available_vector_units_list \"sse2\"   _found)\n+                              if(_found)\n+                                 AddCompilerFlag(\"-xSSE2\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n+                              endif(_found)\n+                           endif(_found)\n+                        endif(_found)\n+                     endif(_found)\n+                  endif(_found)\n+               endif(_found)\n+            endif(_found)\n+         endif(_found)\n+      else() # not MSVC and not ICC => GCC, Clang, Open64\n+         foreach(_flag ${_march_flag_list})\n+            AddCompilerFlag(\"-march=${_flag}\" CXX_RESULT _good CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n+            if(_good)\n+               break()\n+            endif(_good)\n+         endforeach(_flag)\n+         foreach(_flag ${_enable_vector_unit_list})\n+            AddCompilerFlag(\"-m${_flag}\" CXX_RESULT _result CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n+            if(_result)\n+               set(_header FALSE)\n+               if(_flag STREQUAL \"sse3\")\n+                  set(_header \"pmmintrin.h\")\n+               elseif(_flag STREQUAL \"ssse3\")\n+                  set(_header \"tmmintrin.h\")\n+               elseif(_flag STREQUAL \"sse4.1\")\n+                  set(_header \"smmintrin.h\")\n+               elseif(_flag STREQUAL \"sse4.2\")\n+                  set(_header \"smmintrin.h\")\n+               elseif(_flag STREQUAL \"sse4a\")\n+                  set(_header \"ammintrin.h\")\n+               elseif(_flag STREQUAL \"avx\")\n+                  set(_header \"immintrin.h\")\n+               elseif(_flag STREQUAL \"avx2\")\n+                  set(_header \"immintrin.h\")\n+               elseif(_flag STREQUAL \"fma4\")\n+                  set(_header \"x86intrin.h\")\n+               elseif(_flag STREQUAL \"xop\")\n+                  set(_header \"x86intrin.h\")\n+               endif()\n+               set(_resultVar \"HAVE_${_header}\")\n+               string(REPLACE \".\" \"_\" _resultVar \"${_resultVar}\")\n+               if(_header)\n+                  CHECK_INCLUDE_FILE(\"${_header}\" ${_resultVar} \"-m${_flag}\")\n+                  if(NOT ${_resultVar})\n+                     set(_useVar \"USE_${_flag}\")\n+                     string(TOUPPER \"${_useVar}\" _useVar)\n+                     string(REPLACE \".\" \"_\" _useVar \"${_useVar}\")\n+                     message(STATUS \"disabling ${_useVar} because ${_header} is missing\")\n+                     set(${_useVar} FALSE)\n+                     list(APPEND _disable_vector_unit_list \"${_flag}\")\n+                  endif()\n+               endif()\n+               if(NOT _header OR ${_resultVar})\n+                  set(Vc_ARCHITECTURE_FLAGS \"${Vc_ARCHITECTURE_FLAGS} -m${_flag}\")\n+               endif()\n+            endif()\n+         endforeach(_flag)\n+         foreach(_flag ${_disable_vector_unit_list})\n+            AddCompilerFlag(\"-mno-${_flag}\" CXX_FLAGS Vc_ARCHITECTURE_FLAGS)\n+         endforeach(_flag)\n+      endif()\n+   endif()\n+endmacro(OptimizeForArchitecture)"}, {"sha": "0be6ad240d7fb29f603e364da5fe0e72951c4eac", "filename": "cmake/vc/UserWarning.cmake", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/UserWarning.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/UserWarning.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/UserWarning.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -0,0 +1,9 @@\n+macro(UserWarning _msg)\n+   if(\"$ENV{DASHBOARD_TEST_FROM_CTEST}\" STREQUAL \"\")\n+      # developer (non-dashboard) build\n+      message(WARNING \"${_msg}\")\n+   else()\n+      # dashboard build\n+      message(STATUS \"${_msg}\")\n+   endif()\n+endmacro()"}, {"sha": "dd38ae0c71abd5689639a78ece6204f10107a9e7", "filename": "cmake/vc/VcConfig.cmake.in", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/VcConfig.cmake.in", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/VcConfig.cmake.in", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/VcConfig.cmake.in?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -0,0 +1,18 @@\n+set(Vc_VERSION_MAJOR @Vc_VERSION_MAJOR@)\n+set(Vc_VERSION_MINOR @Vc_VERSION_MINOR@)\n+set(Vc_VERSION_PATCH @Vc_VERSION_PATCH@)\n+set(Vc_VERSION @Vc_VERSION_MAJOR@.@Vc_VERSION_MINOR@.@Vc_VERSION_PATCH@)\n+set(Vc_VERSION_STRING \"@Vc_VERSION_MAJOR@.@Vc_VERSION_MINOR@.@Vc_VERSION_PATCH@\")\n+\n+set(Vc_INSTALL_DIR \"@CMAKE_INSTALL_PREFIX@\")\n+\n+set(Vc_LIB_DIR              \"@CMAKE_INSTALL_PREFIX@/lib\")\n+set(Vc_INCLUDE_DIR          \"@CMAKE_INSTALL_PREFIX@/include\")\n+set(Vc_CMAKE_MODULES_DIR    \"@CMAKE_INSTALL_PREFIX@/lib/cmake/Vc\")\n+\n+find_library(Vc_LIBRARIES Vc PATHS \"${Vc_LIB_DIR}\" NO_DEFAULT_PATH)\n+\n+include(\"${Vc_CMAKE_MODULES_DIR}/VcMacros.cmake\")\n+\n+set(Vc_DEFINITIONS)\n+vc_set_preferred_compiler_flags()"}, {"sha": "19f767296b3beea6a81d09921b0a819382f7602a", "filename": "cmake/vc/VcConfigVersion.cmake.in", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/VcConfigVersion.cmake.in", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/VcConfigVersion.cmake.in", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/VcConfigVersion.cmake.in?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -0,0 +1,11 @@\n+set(PACKAGE_VERSION @Vc_VERSION_MAJOR@.@Vc_VERSION_MINOR@.@Vc_VERSION_PATCH@)\n+\n+if(\"${PACKAGE_VERSION}\" VERSION_LESS \"${PACKAGE_FIND_VERSION}\")\n+   set(PACKAGE_VERSION_COMPATIBLE FALSE)\n+else()\n+   set(PACKAGE_VERSION_COMPATIBLE TRUE)\n+   if(\"${PACKAGE_FIND_VERSION}\" STREQUAL \"${PACKAGE_VERSION}\")\n+      set(PACKAGE_VERSION_EXACT TRUE)\n+   endif()\n+endif()\n+"}, {"sha": "9d6f8514e6e676f2a59d32a5658387761323ea84", "filename": "cmake/vc/VcMacros.cmake", "status": "added", "additions": 511, "deletions": 0, "changes": 511, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/VcMacros.cmake", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/VcMacros.cmake", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/VcMacros.cmake?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -0,0 +1,511 @@\n+# Macros for use with the Vc library. Vc can be found at http://code.compeng.uni-frankfurt.de/projects/vc\n+#\n+# The following macros are provided:\n+# vc_determine_compiler\n+# vc_set_preferred_compiler_flags\n+#\n+#=============================================================================\n+# Copyright 2009-2013   Matthias Kretz <kretz@kde.org>\n+#\n+# Redistribution and use in source and binary forms, with or without\n+# modification, are permitted provided that the following conditions are\n+# met:\n+#\n+#  * Redistributions of source code must retain the above copyright notice,\n+#    this list of conditions and the following disclaimer.\n+#\n+#  * Redistributions in binary form must reproduce the above copyright notice,\n+#    this list of conditions and the following disclaimer in the documentation\n+#    and/or other materials provided with the distribution.\n+#\n+#  * The names of Kitware, Inc., the Insight Consortium, or the names of\n+#    any consortium members, or of any contributors, may not be used to\n+#    endorse or promote products derived from this software without\n+#    specific prior written permission.\n+#\n+# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS ``AS IS''\n+# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n+# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n+# ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE FOR\n+# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n+# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n+# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n+# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n+# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+#=============================================================================\n+\n+cmake_minimum_required(VERSION 2.8.3)\n+\n+get_filename_component(_currentDir \"${CMAKE_CURRENT_LIST_FILE}\" PATH)\n+include (\"${_currentDir}/UserWarning.cmake\")\n+include (\"${_currentDir}/AddCompilerFlag.cmake\")\n+include (\"${_currentDir}/OptimizeForArchitecture.cmake\")\n+\n+macro(vc_determine_compiler)\n+   if(NOT DEFINED Vc_COMPILER_IS_INTEL)\n+      execute_process(COMMAND \"${CMAKE_CXX_COMPILER}\" \"--version\" OUTPUT_VARIABLE _cxx_compiler_version ERROR_VARIABLE _cxx_compiler_version)\n+      set(Vc_COMPILER_IS_INTEL false)\n+      set(Vc_COMPILER_IS_OPEN64 false)\n+      set(Vc_COMPILER_IS_CLANG false)\n+      set(Vc_COMPILER_IS_MSVC false)\n+      set(Vc_COMPILER_IS_GCC false)\n+      if(CMAKE_CXX_COMPILER MATCHES \"/(icpc|icc)$\")\n+         set(Vc_COMPILER_IS_INTEL true)\n+         exec_program(${CMAKE_C_COMPILER} ARGS -dumpversion OUTPUT_VARIABLE Vc_ICC_VERSION)\n+         message(STATUS \"Detected Compiler: Intel ${Vc_ICC_VERSION}\")\n+      elseif(CMAKE_CXX_COMPILER MATCHES \"(opencc|openCC)$\")\n+         set(Vc_COMPILER_IS_OPEN64 true)\n+         message(STATUS \"Detected Compiler: Open64\")\n+      elseif(CMAKE_CXX_COMPILER MATCHES \"clang\\\\+\\\\+$\" OR \"${_cxx_compiler_version}\" MATCHES \"clang\")\n+         set(Vc_COMPILER_IS_CLANG true)\n+         exec_program(${CMAKE_CXX_COMPILER} ARGS --version OUTPUT_VARIABLE Vc_CLANG_VERSION)\n+         string(REGEX MATCH \"[0-9]+\\\\.[0-9]+(\\\\.[0-9]+)?\" Vc_CLANG_VERSION \"${Vc_CLANG_VERSION}\")\n+         message(STATUS \"Detected Compiler: Clang ${Vc_CLANG_VERSION}\")\n+      elseif(MSVC)\n+         set(Vc_COMPILER_IS_MSVC true)\n+         message(STATUS \"Detected Compiler: MSVC ${MSVC_VERSION}\")\n+      elseif(CMAKE_COMPILER_IS_GNUCXX)\n+         set(Vc_COMPILER_IS_GCC true)\n+         exec_program(${CMAKE_C_COMPILER} ARGS -dumpversion OUTPUT_VARIABLE Vc_GCC_VERSION)\n+         message(STATUS \"Detected Compiler: GCC ${Vc_GCC_VERSION}\")\n+\n+         # some distributions patch their GCC to return nothing or only major and minor version on -dumpversion.\n+         # In that case we must extract the version number from --version.\n+         if(NOT Vc_GCC_VERSION OR Vc_GCC_VERSION MATCHES \"^[0-9]\\\\.[0-9]+$\")\n+            exec_program(${CMAKE_C_COMPILER} ARGS --version OUTPUT_VARIABLE Vc_GCC_VERSION)\n+            string(REGEX MATCH \"[0-9]+\\\\.[0-9]+\\\\.[0-9]+\" Vc_GCC_VERSION \"${Vc_GCC_VERSION}\")\n+            message(STATUS \"GCC Version from --version: ${Vc_GCC_VERSION}\")\n+         endif()\n+\n+         # some distributions patch their GCC to be API incompatible to what the FSF released. In\n+         # those cases we require a macro to identify the distribution version\n+         find_program(_lsb_release lsb_release)\n+         mark_as_advanced(_lsb_release)\n+         if(_lsb_release)\n+            execute_process(COMMAND ${_lsb_release} -is OUTPUT_VARIABLE _distributor_id OUTPUT_STRIP_TRAILING_WHITESPACE)\n+            execute_process(COMMAND ${_lsb_release} -rs OUTPUT_VARIABLE _distributor_release OUTPUT_STRIP_TRAILING_WHITESPACE)\n+            string(TOUPPER \"${_distributor_id}\" _distributor_id)\n+            if(_distributor_id STREQUAL \"UBUNTU\")\n+               execute_process(COMMAND ${CMAKE_C_COMPILER} --version OUTPUT_STRIP_TRAILING_WHITESPACE OUTPUT_VARIABLE _gcc_version)\n+               string(REGEX MATCH \"\\\\(.* ${Vc_GCC_VERSION}-([0-9]+).*\\\\)\" _tmp \"${_gcc_version}\")\n+               if(_tmp)\n+                  set(_patch ${CMAKE_MATCH_1})\n+                  string(REGEX MATCH \"^([0-9]+)\\\\.([0-9]+)$\" _tmp \"${_distributor_release}\")\n+                  execute_process(COMMAND printf 0x%x%02x%02x ${CMAKE_MATCH_1} ${CMAKE_MATCH_2} ${_patch} OUTPUT_STRIP_TRAILING_WHITESPACE OUTPUT_VARIABLE _tmp)\n+                  set(Vc_DEFINITIONS \"${Vc_DEFINITIONS} -D__GNUC_UBUNTU_VERSION__=${_tmp}\")\n+               endif()\n+            endif()\n+         endif()\n+      else()\n+         message(WARNING \"Untested/-supported Compiler (${CMAKE_CXX_COMPILER}) for use with Vc.\\nPlease fill out the missing parts in the CMake scripts and submit a patch to http://code.compeng.uni-frankfurt.de/projects/vc\")\n+      endif()\n+   endif()\n+endmacro()\n+\n+macro(vc_set_gnu_buildtype_flags)\n+   set(CMAKE_CXX_FLAGS_DEBUG          \"-g3\"          CACHE STRING \"Flags used by the compiler during debug builds.\" FORCE)\n+   set(CMAKE_CXX_FLAGS_MINSIZEREL     \"-Os -DNDEBUG\" CACHE STRING \"Flags used by the compiler during release minsize builds.\" FORCE)\n+   set(CMAKE_CXX_FLAGS_RELEASE        \"-O3 -DNDEBUG\" CACHE STRING \"Flags used by the compiler during release builds (/MD /Ob1 /Oi /Ot /Oy /Gs will produce slightly less optimized but smaller files).\" FORCE)\n+   set(CMAKE_CXX_FLAGS_RELWITHDEBUG   \"-O3\"          CACHE STRING \"Flags used by the compiler during release builds containing runtime checks.\" FORCE)\n+   set(CMAKE_CXX_FLAGS_RELWITHDEBINFO \"${CMAKE_CXX_FLAGS_RELWITHDEBUG} -g\" CACHE STRING \"Flags used by the compiler during Release with Debug Info builds.\" FORCE)\n+   set(CMAKE_C_FLAGS_DEBUG          \"${CMAKE_CXX_FLAGS_DEBUG}\"          CACHE STRING \"Flags used by the compiler during debug builds.\" FORCE)\n+   set(CMAKE_C_FLAGS_MINSIZEREL     \"${CMAKE_CXX_FLAGS_MINSIZEREL}\"     CACHE STRING \"Flags used by the compiler during release minsize builds.\" FORCE)\n+   set(CMAKE_C_FLAGS_RELEASE        \"${CMAKE_CXX_FLAGS_RELEASE}\"        CACHE STRING \"Flags used by the compiler during release builds (/MD /Ob1 /Oi /Ot /Oy /Gs will produce slightly less optimized but smaller files).\" FORCE)\n+   set(CMAKE_C_FLAGS_RELWITHDEBUG   \"${CMAKE_CXX_FLAGS_RELWITHDEBUG}\"   CACHE STRING \"Flags used by the compiler during release builds containing runtime checks.\" FORCE)\n+   set(CMAKE_C_FLAGS_RELWITHDEBINFO \"${CMAKE_CXX_FLAGS_RELWITHDEBINFO}\" CACHE STRING \"Flags used by the compiler during Release with Debug Info builds.\" FORCE)\n+   if(CMAKE_BUILD_TYPE STREQUAL \"Release\" OR CMAKE_BUILD_TYPE STREQUAL \"RelWithDebInfo\" OR CMAKE_BUILD_TYPE STREQUAL \"RelWithDebug\")\n+      set(ENABLE_STRICT_ALIASING true CACHE BOOL \"Enables strict aliasing rules for more aggressive optimizations\")\n+      if(NOT ENABLE_STRICT_ALIASING)\n+         AddCompilerFlag(-fno-strict-aliasing)\n+      endif(NOT ENABLE_STRICT_ALIASING)\n+   endif()\n+   mark_as_advanced(CMAKE_CXX_FLAGS_RELWITHDEBUG CMAKE_C_FLAGS_RELWITHDEBUG)\n+endmacro()\n+\n+macro(vc_add_compiler_flag VAR _flag)\n+   AddCompilerFlag(\"${_flag}\" CXX_FLAGS ${VAR})\n+endmacro()\n+\n+macro(vc_check_assembler)\n+   if(APPLE)\n+      if(NOT Vc_COMPILER_IS_CLANG)\n+         message(WARNING \"Apple does not provide an assembler with AVX support. AVX will not be available. Please use Clang if you want to use AVX.\")\n+         set(Vc_DEFINITIONS \"${Vc_DEFINITIONS} -DVC_NO_XGETBV\")\n+         set(Vc_AVX_INTRINSICS_BROKEN true)\n+         set(Vc_AVX2_INTRINSICS_BROKEN true)\n+      endif()\n+   else(APPLE)\n+      if(${ARGC} EQUAL 1)\n+         set(_as \"${ARGV1}\")\n+      else()\n+         exec_program(${CMAKE_CXX_COMPILER} ARGS -print-prog-name=as OUTPUT_VARIABLE _as)\n+         mark_as_advanced(_as)\n+      endif()\n+      if(NOT _as)\n+         message(WARNING \"Could not find 'as', the assembler used by GCC. Hoping everything will work out...\")\n+      else()\n+         exec_program(${_as} ARGS --version OUTPUT_VARIABLE _as_version)\n+         string(REGEX REPLACE \"\\\\([^\\\\)]*\\\\)\" \"\" _as_version \"${_as_version}\")\n+         string(REGEX MATCH \"[1-9]\\\\.[0-9]+(\\\\.[0-9]+)?\" _as_version \"${_as_version}\")\n+         if(_as_version VERSION_LESS \"2.18.93\")\n+            UserWarning(\"Your binutils is too old (${_as_version}). Some optimizations of Vc will be disabled.\")\n+            add_definitions(-DVC_NO_XGETBV) # old assembler doesn't know the xgetbv instruction\n+            set(Vc_AVX_INTRINSICS_BROKEN true)\n+            set(Vc_XOP_INTRINSICS_BROKEN true)\n+            set(Vc_FMA4_INTRINSICS_BROKEN true)\n+         elseif(_as_version VERSION_LESS \"2.21.0\")\n+            UserWarning(\"Your binutils is too old (${_as_version}) for XOP instructions. They will therefore not be provided in libVc.\")\n+            set(Vc_XOP_INTRINSICS_BROKEN true)\n+         endif()\n+      endif()\n+   endif(APPLE)\n+endmacro()\n+\n+macro(vc_check_fpmath)\n+   # if compiling for 32 bit x86 we need to use the -mfpmath=sse since the x87 is broken by design\n+   include (CheckCXXSourceRuns)\n+   check_cxx_source_runs(\"int main() { return sizeof(void*) != 8; }\" Vc_VOID_PTR_IS_64BIT)\n+   if(NOT Vc_VOID_PTR_IS_64BIT)\n+      exec_program(${CMAKE_C_COMPILER} ARGS -dumpmachine OUTPUT_VARIABLE _gcc_machine)\n+      if(_gcc_machine MATCHES \"[x34567]86\" OR _gcc_machine STREQUAL \"mingw32\")\n+         vc_add_compiler_flag(Vc_DEFINITIONS \"-mfpmath=sse\")\n+      endif()\n+   endif()\n+endmacro()\n+\n+macro(vc_set_preferred_compiler_flags)\n+   vc_determine_compiler()\n+\n+   set(_add_warning_flags false)\n+   set(_add_buildtype_flags false)\n+   foreach(_arg ${ARGN})\n+      if(_arg STREQUAL \"WARNING_FLAGS\")\n+         set(_add_warning_flags true)\n+      elseif(_arg STREQUAL \"BUILDTYPE_FLAGS\")\n+         set(_add_buildtype_flags true)\n+      endif()\n+   endforeach()\n+\n+   set(Vc_SSE_INTRINSICS_BROKEN false)\n+   set(Vc_AVX_INTRINSICS_BROKEN false)\n+   set(Vc_AVX2_INTRINSICS_BROKEN false)\n+   set(Vc_XOP_INTRINSICS_BROKEN false)\n+   set(Vc_FMA4_INTRINSICS_BROKEN false)\n+\n+   if(Vc_COMPILER_IS_OPEN64)\n+      ##################################################################################################\n+      #                                             Open64                                             #\n+      ##################################################################################################\n+      if(_add_warning_flags)\n+         AddCompilerFlag(\"-W\")\n+         AddCompilerFlag(\"-Wall\")\n+         AddCompilerFlag(\"-Wimplicit\")\n+         AddCompilerFlag(\"-Wswitch\")\n+         AddCompilerFlag(\"-Wformat\")\n+         AddCompilerFlag(\"-Wchar-subscripts\")\n+         AddCompilerFlag(\"-Wparentheses\")\n+         AddCompilerFlag(\"-Wmultichar\")\n+         AddCompilerFlag(\"-Wtrigraphs\")\n+         AddCompilerFlag(\"-Wpointer-arith\")\n+         AddCompilerFlag(\"-Wcast-align\")\n+         AddCompilerFlag(\"-Wreturn-type\")\n+         AddCompilerFlag(\"-Wno-unused-function\")\n+         AddCompilerFlag(\"-pedantic\")\n+         AddCompilerFlag(\"-Wno-long-long\")\n+         AddCompilerFlag(\"-Wshadow\")\n+         AddCompilerFlag(\"-Wold-style-cast\")\n+         AddCompilerFlag(\"-Wno-variadic-macros\")\n+      endif()\n+      if(_add_buildtype_flags)\n+         vc_set_gnu_buildtype_flags()\n+      endif()\n+\n+      vc_check_assembler()\n+\n+      # Open64 4.5.1 still doesn't ship immintrin.h\n+      set(Vc_AVX_INTRINSICS_BROKEN true)\n+      set(Vc_AVX2_INTRINSICS_BROKEN true)\n+   elseif(Vc_COMPILER_IS_GCC)\n+      ##################################################################################################\n+      #                                              GCC                                               #\n+      ##################################################################################################\n+      if(_add_warning_flags)\n+         foreach(_f -W -Wall -Wswitch -Wformat -Wchar-subscripts -Wparentheses -Wmultichar -Wtrigraphs -Wpointer-arith -Wcast-align -Wreturn-type -Wno-unused-function -pedantic -Wshadow -Wundef -Wold-style-cast -Wno-variadic-macros)\n+            AddCompilerFlag(\"${_f}\")\n+         endforeach()\n+         if(Vc_GCC_VERSION VERSION_GREATER \"4.5.2\" AND Vc_GCC_VERSION VERSION_LESS \"4.6.4\")\n+            # GCC gives bogus \"array subscript is above array bounds\" warnings in math.cpp\n+            AddCompilerFlag(\"-Wno-array-bounds\")\n+         endif()\n+         if(Vc_GCC_VERSION VERSION_GREATER \"4.7.99\")\n+            # GCC 4.8 warns about stuff we don't care about\n+            # Some older GCC versions have problems to note that they don't support the flag\n+            AddCompilerFlag(\"-Wno-unused-local-typedefs\")\n+         endif()\n+      endif() \n+      if (NOT MSVC)\n+          vc_add_compiler_flag(Vc_DEFINITIONS \"-Wabi\")\n+      endif()\n+      vc_add_compiler_flag(Vc_DEFINITIONS \"-fabi-version=0\") # ABI version 4 is required to make __m128 and __m256 appear as different types. 0 should give us the latest version.\n+\n+      if(_add_buildtype_flags)\n+         vc_set_gnu_buildtype_flags()\n+      endif()\n+\n+      # GCC 4.5.[01] fail at inlining some functions, creating functions with a single instructions,\n+      # thus creating a large overhead.\n+      if(Vc_GCC_VERSION VERSION_LESS \"4.5.2\" AND NOT Vc_GCC_VERSION VERSION_LESS \"4.5.0\")\n+         UserWarning(\"GCC 4.5.0 and 4.5.1 have problems with inlining correctly. Setting early-inlining-insns=12 as workaround.\")\n+         AddCompilerFlag(\"--param early-inlining-insns=12\")\n+      endif()\n+\n+      if(Vc_GCC_VERSION VERSION_LESS \"4.1.99\")\n+         UserWarning(\"Your GCC is ancient and crashes on some important optimizations.  The full set of SSE2 intrinsics is not supported.  Vc will fall back to the scalar implementation.  Use of the may_alias and always_inline attributes will be disabled.  In turn all code using Vc must be compiled with -fno-strict-aliasing\")\n+         vc_add_compiler_flag(Vc_DEFINITIONS \"-fno-strict-aliasing\")\n+         set(Vc_AVX_INTRINSICS_BROKEN true)\n+         set(Vc_AVX2_INTRINSICS_BROKEN true)\n+         set(Vc_SSE_INTRINSICS_BROKEN true)\n+      elseif(Vc_GCC_VERSION VERSION_LESS \"4.4.6\")\n+         UserWarning(\"Your GCC is older than 4.4.6. This is known to cause problems/bugs. Please update to the latest GCC if you can.\")\n+         set(Vc_AVX_INTRINSICS_BROKEN true)\n+         set(Vc_AVX2_INTRINSICS_BROKEN true)\n+         if(Vc_GCC_VERSION VERSION_LESS \"4.3.0\")\n+            UserWarning(\"Your GCC is older than 4.3.0. It is unable to handle the full set of SSE2 intrinsics. All SSE code will be disabled. Please update to the latest GCC if you can.\")\n+            set(Vc_SSE_INTRINSICS_BROKEN true)\n+         endif()\n+      endif()\n+\n+      if(Vc_GCC_VERSION VERSION_LESS 4.5.0)\n+         UserWarning(\"GCC 4.4.x shows false positives for -Wparentheses, thus we rather disable the warning.\")\n+         string(REPLACE \" -Wparentheses \" \" \" CMAKE_C_FLAGS \"${CMAKE_C_FLAGS}\")\n+         string(REPLACE \" -Wparentheses \" \" \" CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS}\")\n+         set(Vc_DEFINITIONS \"${Vc_DEFINITIONS} -Wno-parentheses\")\n+\n+         UserWarning(\"GCC 4.4.x shows false positives for -Wstrict-aliasing, thus we rather disable the warning. Use a newer GCC for better warnings.\")\n+         AddCompilerFlag(\"-Wno-strict-aliasing\")\n+\n+         UserWarning(\"GCC 4.4.x shows false positives for -Wuninitialized, thus we rather disable the warning. Use a newer GCC for better warnings.\")\n+         AddCompilerFlag(\"-Wno-uninitialized\")\n+      elseif(Vc_GCC_VERSION VERSION_EQUAL 4.6.0)\n+         UserWarning(\"GCC 4.6.0 miscompiles AVX loads/stores, leading to spurious segfaults. Disabling AVX per default.\")\n+         set(Vc_AVX_INTRINSICS_BROKEN true)\n+         set(Vc_AVX2_INTRINSICS_BROKEN true)\n+      elseif(Vc_GCC_VERSION VERSION_EQUAL 4.7.0)\n+         UserWarning(\"GCC 4.7.0 miscompiles at -O3, adding -fno-predictive-commoning to the compiler flags as workaround\")\n+         set(Vc_DEFINITIONS \"${Vc_DEFINITIONS} -fno-predictive-commoning\")\n+      endif()\n+\n+      vc_check_fpmath()\n+      vc_check_assembler()\n+   elseif(Vc_COMPILER_IS_INTEL)\n+      ##################################################################################################\n+      #                                          Intel Compiler                                        #\n+      ##################################################################################################\n+\n+      if(_add_buildtype_flags)\n+         set(CMAKE_CXX_FLAGS_RELEASE        \"${CMAKE_CXX_FLAGS_RELEASE} -O3\")\n+         set(CMAKE_CXX_FLAGS_RELWITHDEBINFO \"${CMAKE_CXX_FLAGS_RELWITHDEBINFO} -DNDEBUG -O3\")\n+         set(CMAKE_C_FLAGS_RELEASE          \"${CMAKE_C_FLAGS_RELEASE} -O3\")\n+         set(CMAKE_C_FLAGS_RELWITHDEBINFO   \"${CMAKE_C_FLAGS_RELWITHDEBINFO} -DNDEBUG -O3\")\n+\n+         set(ALIAS_FLAGS \"-no-ansi-alias\")\n+         if(CMAKE_BUILD_TYPE STREQUAL \"Release\" OR CMAKE_BUILD_TYPE STREQUAL \"RelWithDebInfo\")\n+            # default ICC to -no-ansi-alias because otherwise tests/utils_sse fails. So far I suspect a miscompilation...\n+            set(ENABLE_STRICT_ALIASING true CACHE BOOL \"Enables strict aliasing rules for more aggressive optimizations\")\n+            if(ENABLE_STRICT_ALIASING)\n+               set(ALIAS_FLAGS \"-ansi-alias\")\n+            endif(ENABLE_STRICT_ALIASING)\n+         endif()\n+         set(CMAKE_C_FLAGS   \"${CMAKE_C_FLAGS}   ${ALIAS_FLAGS}\")\n+         set(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} ${ALIAS_FLAGS}\")\n+      endif()\n+      vc_add_compiler_flag(Vc_DEFINITIONS \"-diag-disable 913\")\n+      # Disable warning #13211 \"Immediate parameter to intrinsic call too large\". (sse/vector.tcc rotated(int))\n+      vc_add_compiler_flag(Vc_DEFINITIONS \"-diag-disable 13211\")\n+\n+      if(NOT \"$ENV{DASHBOARD_TEST_FROM_CTEST}\" STREQUAL \"\")\n+         # disable warning #2928: the __GXX_EXPERIMENTAL_CXX0X__ macro is disabled when using GNU version 4.6 with the c++0x option\n+         # this warning just adds noise about problems in the compiler - but I'm only interested in seeing problems in Vc\n+         vc_add_compiler_flag(Vc_DEFINITIONS \"-diag-disable 2928\")\n+      endif()\n+\n+      # Intel doesn't implement the XOP or FMA4 intrinsics\n+      set(Vc_XOP_INTRINSICS_BROKEN true)\n+      set(Vc_FMA4_INTRINSICS_BROKEN true)\n+   elseif(Vc_COMPILER_IS_MSVC)\n+      ##################################################################################################\n+      #                                      Microsoft Visual Studio                                   #\n+      ##################################################################################################\n+\n+      if(_add_warning_flags)\n+         AddCompilerFlag(\"/wd4800\") # Disable warning \"forcing value to bool\"\n+         AddCompilerFlag(\"/wd4996\") # Disable warning about strdup vs. _strdup\n+         AddCompilerFlag(\"/wd4244\") # Disable warning \"conversion from 'unsigned int' to 'float', possible loss of data\"\n+         AddCompilerFlag(\"/wd4146\") # Disable warning \"unary minus operator applied to unsigned type, result still unsigned\"\n+         AddCompilerFlag(\"/wd4227\") # Disable warning \"anachronism used : qualifiers on reference are ignored\" (this is about 'restrict' usage on references, stupid MSVC)\n+         AddCompilerFlag(\"/wd4722\") # Disable warning \"destructor never returns, potential memory leak\" (warns about ~_UnitTest_Global_Object which we don't care about)\n+         AddCompilerFlag(\"/wd4748\") # Disable warning \"/GS can not protect parameters and local variables from local buffer overrun because optimizations are disabled in function\" (I don't get it)\n+         add_definitions(-D_CRT_SECURE_NO_WARNINGS)\n+      endif()\n+\n+      # MSVC does not support inline assembly on 64 bit! :(\n+      # searching the help for xgetbv doesn't turn up anything. So just fall back to not supporting AVX on Windows :(\n+      # TODO: apparently MSVC 2010 SP1 added _xgetbv\n+      set(Vc_DEFINITIONS \"${Vc_DEFINITIONS} -DVC_NO_XGETBV\")\n+\n+      # get rid of the min/max macros\n+      set(Vc_DEFINITIONS \"${Vc_DEFINITIONS} -DNOMINMAX\")\n+\n+      # MSVC doesn't implement the XOP or FMA4 intrinsics\n+      set(Vc_XOP_INTRINSICS_BROKEN true)\n+      set(Vc_FMA4_INTRINSICS_BROKEN true)\n+\n+      if(MSVC_VERSION LESS 1700)\n+         UserWarning(\"MSVC before 2012 has a broken std::vector::resize implementation. STL + Vc code will probably not compile.\")\n+      endif()\n+   elseif(Vc_COMPILER_IS_CLANG)\n+      ##################################################################################################\n+      #                                              Clang                                             #\n+      ##################################################################################################\n+\n+      # for now I don't know of any arguments I want to pass. -march and stuff is tried by OptimizeForArchitecture...\n+      if(Vc_CLANG_VERSION VERSION_EQUAL \"3.0\")\n+         UserWarning(\"Clang 3.0 has serious issues to compile Vc code and will most likely crash when trying to do so.\\nPlease update to a recent clang version.\")\n+      elseif(Vc_CLANG_VERSION VERSION_LESS \"3.3\")\n+         # the LLVM assembler gets FMAs wrong (bug 15040)\n+         vc_add_compiler_flag(Vc_DEFINITIONS \"-no-integrated-as\")\n+      endif()\n+\n+      # disable these warnings because clang shows them for function overloads that were discarded via SFINAE\n+      vc_add_compiler_flag(Vc_DEFINITIONS \"-Wno-local-type-template-args\")\n+      vc_add_compiler_flag(Vc_DEFINITIONS \"-Wno-unnamed-type-template-args\")\n+\n+      AddCompilerFlag(-stdlib=libc++)\n+   endif()\n+\n+   if(NOT Vc_COMPILER_IS_MSVC)\n+      vc_add_compiler_flag(Vc_DEFINITIONS \"-ffp-contract=fast\")\n+   endif()\n+\n+   OptimizeForArchitecture()\n+   set(Vc_DEFINITIONS \"${Vc_ARCHITECTURE_FLAGS} ${Vc_DEFINITIONS}\")\n+\n+   set(VC_IMPL \"auto\" CACHE STRING \"Force the Vc implementation globally to the selected instruction set. \\\"auto\\\" lets Vc use the best available instructions.\")\n+   if(NOT VC_IMPL STREQUAL \"auto\")\n+      set(Vc_DEFINITIONS \"${Vc_DEFINITIONS} -DVC_IMPL=${VC_IMPL}\")\n+      if(NOT VC_IMPL STREQUAL \"Scalar\")\n+         set(_use_var \"USE_${VC_IMPL}\")\n+         if(VC_IMPL STREQUAL \"SSE\")\n+            set(_use_var \"USE_SSE2\")\n+         endif()\n+         if(NOT ${_use_var})\n+            message(WARNING \"The selected value for VC_IMPL (${VC_IMPL}) will not work because the relevant instructions are not enabled via compiler flags.\")\n+         endif()\n+      endif()\n+   endif()\n+endmacro()\n+\n+# helper macro for vc_compile_for_all_implementations\n+macro(_vc_compile_one_implementation _srcs _impl)\n+   list(FIND _disabled_targets \"${_impl}\" _disabled_index)\n+   list(FIND _only_targets \"${_impl}\" _only_index)\n+   if(${_disabled_index} EQUAL -1 AND (NOT _only_targets OR ${_only_index} GREATER -1))\n+      set(_extra_flags)\n+      set(_ok FALSE)\n+      foreach(_flags ${ARGN})\n+         if(_flags STREQUAL \"NO_FLAG\")\n+            set(_ok TRUE)\n+            break()\n+         endif()\n+         string(REPLACE \" \" \";\" _flag_list \"${_flags}\")\n+         foreach(_f ${_flag_list})\n+            AddCompilerFlag(${_f} CXX_RESULT _ok)\n+            if(NOT _ok)\n+               break()\n+            endif()\n+         endforeach()\n+         if(_ok)\n+            set(_extra_flags ${_flags})\n+            break()\n+         endif()\n+      endforeach()\n+\n+      if(Vc_COMPILER_IS_MSVC)\n+         # MSVC for 64bit does not recognize /arch:SSE2 anymore. Therefore we set override _ok if _impl\n+         # says SSE\n+         if(\"${_impl}\" MATCHES \"SSE\")\n+            set(_ok TRUE)\n+         endif()\n+      endif()\n+\n+      if(_ok)\n+         get_filename_component(_out \"${_vc_compile_src}\" NAME_WE)\n+         get_filename_component(_ext \"${_vc_compile_src}\" EXT)\n+         set(_out \"${CMAKE_CURRENT_BINARY_DIR}/${_out}_${_impl}${_ext}\")\n+         configure_file( ${_vc_compile_src} \"${_out}\" COPYONLY )\n+         set_source_files_properties( \"${_out}\" PROPERTIES\n+            COMPILE_DEFINITIONS \"VC_IMPL=${_impl}\"\n+            COMPILE_FLAGS \"${_flags} ${_extra_flags}\"\n+         )\n+         list(APPEND ${_srcs} \"${_out}\")\n+      endif()\n+   endif()\n+endmacro()\n+\n+# Generate compile rules for the given C++ source file for all available implementations and return\n+# the resulting list of object files in _obj\n+# all remaining arguments are additional flags\n+# Example:\n+#   vc_compile_for_all_implementations(_objs src/trigonometric.cpp FLAGS -DCOMPILE_BLAH EXCLUDE Scalar)\n+#   add_executable(executable main.cpp ${_objs})\n+macro(vc_compile_for_all_implementations _srcs _src)\n+   set(_flags)\n+   unset(_disabled_targets)\n+   unset(_only_targets)\n+   set(_state 0)\n+   foreach(_arg ${ARGN})\n+      if(_arg STREQUAL \"FLAGS\")\n+         set(_state 1)\n+      elseif(_arg STREQUAL \"EXCLUDE\")\n+         set(_state 2)\n+      elseif(_arg STREQUAL \"ONLY\")\n+         set(_state 3)\n+      elseif(_state EQUAL 1)\n+         set(_flags \"${_flags} ${_arg}\")\n+      elseif(_state EQUAL 2)\n+         list(APPEND _disabled_targets \"${_arg}\")\n+      elseif(_state EQUAL 3)\n+         list(APPEND _only_targets \"${_arg}\")\n+      else()\n+         message(FATAL_ERROR \"incorrect argument to vc_compile_for_all_implementations\")\n+      endif()\n+   endforeach()\n+\n+   set(_vc_compile_src \"${_src}\")\n+\n+   _vc_compile_one_implementation(${_srcs} Scalar NO_FLAG)\n+   if(NOT Vc_SSE_INTRINSICS_BROKEN)\n+      _vc_compile_one_implementation(${_srcs} SSE2   \"-xSSE2\"   \"-msse2\"   \"/arch:SSE2\")\n+      _vc_compile_one_implementation(${_srcs} SSE3   \"-xSSE3\"   \"-msse3\"   \"/arch:SSE2\")\n+      _vc_compile_one_implementation(${_srcs} SSSE3  \"-xSSSE3\"  \"-mssse3\"  \"/arch:SSE2\")\n+      _vc_compile_one_implementation(${_srcs} SSE4_1 \"-xSSE4.1\" \"-msse4.1\" \"/arch:SSE2\")\n+      _vc_compile_one_implementation(${_srcs} SSE4_2 \"-xSSE4.2\" \"-msse4.2\" \"/arch:SSE2\")\n+      _vc_compile_one_implementation(${_srcs} SSE3+SSE4a  \"-msse4a\")\n+   endif()\n+   if(NOT Vc_AVX_INTRINSICS_BROKEN)\n+      _vc_compile_one_implementation(${_srcs} AVX      \"-xAVX\"    \"-mavx\"    \"/arch:AVX\")\n+      if(NOT Vc_XOP_INTRINSICS_BROKEN)\n+         if(NOT Vc_FMA4_INTRINSICS_BROKEN)\n+            _vc_compile_one_implementation(${_srcs} SSE+XOP+FMA4 \"-mxop -mfma4\"        \"\"    \"\")\n+            _vc_compile_one_implementation(${_srcs} AVX+XOP+FMA4 \"-mavx -mxop -mfma4\"  \"\"    \"\")\n+         endif()\n+         _vc_compile_one_implementation(${_srcs} SSE+XOP+FMA \"-mxop -mfma\"        \"\"    \"\")\n+         _vc_compile_one_implementation(${_srcs} AVX+XOP+FMA \"-mavx -mxop -mfma\"  \"\"    \"\")\n+      endif()\n+      _vc_compile_one_implementation(${_srcs} AVX+FMA \"-mavx -mfma\"  \"\"    \"\")\n+   endif()\n+   if(NOT Vc_AVX2_INTRINSICS_BROKEN)\n+      _vc_compile_one_implementation(${_srcs} AVX2 \"-xCORE-AVX2\"  \"-mavx2\"    \"/arch:AVX2\")\n+   endif()\n+endmacro()"}, {"sha": "5324c7d0a974033b976583339365d2282794ac43", "filename": "cmake/vc/msvc_version.c", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/msvc_version.c", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/cmake/vc/msvc_version.c", "contents_url": "https://api.github.com/repos/KDE/krita/contents/cmake/vc/msvc_version.c?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -0,0 +1 @@\n+MSVC _MSC_FULL_VER"}, {"sha": "7b4599a93f08ea94c51447e19b9304b869e7d9ef", "filename": "libs/image/CMakeLists.txt", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/libs/image/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/libs/image/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/CMakeLists.txt?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -335,9 +335,6 @@ endif()\n \n if(HAVE_VC)\n   target_link_libraries(kritaimage PUBLIC ${Vc_LIBRARIES})\n-  if (NOT PACKAGERS_BUILD)\n-      set_property(TARGET kritaimage APPEND PROPERTY COMPILE_OPTIONS \"${Vc_ARCHITECTURE_FLAGS}\")\n-  endif()\n endif()\n \n if (NOT GSL_FOUND)"}, {"sha": "f29784001b5eecb7164325c5f78e6a8ae25c48df", "filename": "libs/image/kis_brush_mask_applicator_factories.cpp", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/libs/image/kis_brush_mask_applicator_factories.cpp", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/libs/image/kis_brush_mask_applicator_factories.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_brush_mask_applicator_factories.cpp?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -29,17 +29,17 @@\n template<>\n template<>\n MaskApplicatorFactory<KisMaskGenerator, KisBrushMaskScalarApplicator>::ReturnType\n-MaskApplicatorFactory<KisMaskGenerator, KisBrushMaskScalarApplicator>::create<Vc::CurrentImplementation::current()>(ParamType maskGenerator)\n+MaskApplicatorFactory<KisMaskGenerator, KisBrushMaskScalarApplicator>::create<VC_IMPL>(ParamType maskGenerator)\n {\n-    return new KisBrushMaskScalarApplicator<KisMaskGenerator,Vc::CurrentImplementation::current()>(maskGenerator);\n+    return new KisBrushMaskScalarApplicator<KisMaskGenerator,VC_IMPL>(maskGenerator);\n }\n \n template<>\n template<>\n MaskApplicatorFactory<KisCircleMaskGenerator, KisBrushMaskVectorApplicator>::ReturnType\n-MaskApplicatorFactory<KisCircleMaskGenerator, KisBrushMaskVectorApplicator>::create<Vc::CurrentImplementation::current()>(ParamType maskGenerator)\n+MaskApplicatorFactory<KisCircleMaskGenerator, KisBrushMaskVectorApplicator>::create<VC_IMPL>(ParamType maskGenerator)\n {\n-    return new KisBrushMaskVectorApplicator<KisCircleMaskGenerator,Vc::CurrentImplementation::current()>(maskGenerator);\n+    return new KisBrushMaskVectorApplicator<KisCircleMaskGenerator,VC_IMPL>(maskGenerator);\n }\n \n #if defined HAVE_VC\n@@ -57,7 +57,7 @@ struct KisCircleMaskGenerator::FastRowProcessor\n };\n \n template<> void KisCircleMaskGenerator::\n-FastRowProcessor::process<Vc::CurrentImplementation::current()>(float* buffer, int width, float y, float cosa, float sina,\n+FastRowProcessor::process<VC_IMPL>(float* buffer, int width, float y, float cosa, float sina,\n                                    float centerX, float centerY)\n {\n     const bool useSmoothing = d->copyOfAntialiasEdges;"}, {"sha": "0f6e4653ce85f6e4376902cdcec95fcf514cf99b", "filename": "libs/pigment/CMakeLists.txt", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/libs/pigment/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/libs/pigment/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/CMakeLists.txt?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -95,9 +95,6 @@ generate_export_header(kritapigment)\n \n if (HAVE_VC)\n     target_link_libraries(kritapigment PUBLIC KF5::I18n KF5::ConfigCore)\n-    if (NOT PACKAGERS_BUILD)\n-        set_property(TARGET kritapigment APPEND PROPERTY COMPILE_OPTIONS \"${Vc_ARCHITECTURE_FLAGS}\")\n-    endif()\n endif()\n \n target_include_directories( kritapigment"}, {"sha": "8076557f1e51b097818daa7f6918d033dc3346a4", "filename": "libs/pigment/compositeops/KoOptimizedCompositeOpFactoryPerArch.cpp", "status": "modified", "additions": 12, "deletions": 10, "changes": 22, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/libs/pigment/compositeops/KoOptimizedCompositeOpFactoryPerArch.cpp", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/libs/pigment/compositeops/KoOptimizedCompositeOpFactoryPerArch.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/compositeops/KoOptimizedCompositeOpFactoryPerArch.cpp?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -39,33 +39,33 @@\n template<>\n template<>\n KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpAlphaDarken32>::ReturnType\n-KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpAlphaDarken32>::create<Vc::CurrentImplementation::current()>(ParamType param)\n+KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpAlphaDarken32>::create<VC_IMPL>(ParamType param)\n {\n-    return new KoOptimizedCompositeOpAlphaDarken32<Vc::CurrentImplementation::current()>(param);\n+    return new KoOptimizedCompositeOpAlphaDarken32<VC_IMPL>(param);\n }\n \n template<>\n template<>\n KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpOver32>::ReturnType\n-KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpOver32>::create<Vc::CurrentImplementation::current()>(ParamType param)\n+KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpOver32>::create<VC_IMPL>(ParamType param)\n {\n-    return new KoOptimizedCompositeOpOver32<Vc::CurrentImplementation::current()>(param);\n+    return new KoOptimizedCompositeOpOver32<VC_IMPL>(param);\n }\n \n template<>\n template<>\n KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpAlphaDarken128>::ReturnType\n-KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpAlphaDarken128>::create<Vc::CurrentImplementation::current()>(ParamType param)\n+KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpAlphaDarken128>::create<VC_IMPL>(ParamType param)\n {\n-    return new KoOptimizedCompositeOpAlphaDarken128<Vc::CurrentImplementation::current()>(param);\n+    return new KoOptimizedCompositeOpAlphaDarken128<VC_IMPL>(param);\n }\n \n template<>\n template<>\n KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpOver128>::ReturnType\n-KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpOver128>::create<Vc::CurrentImplementation::current()>(ParamType param)\n+KoOptimizedCompositeOpFactoryPerArch<KoOptimizedCompositeOpOver128>::create<VC_IMPL>(ParamType param)\n {\n-    return new KoOptimizedCompositeOpOver128<Vc::CurrentImplementation::current()>(param);\n+    return new KoOptimizedCompositeOpOver128<VC_IMPL>(param);\n }\n \n #define __stringify(_s) #_s\n@@ -78,13 +78,15 @@ inline void printFeatureSupported(const QString &feature, Vc::Implementation imp\n \n template<>\n KoReportCurrentArch::ReturnType\n-KoReportCurrentArch::create<Vc::CurrentImplementation::current()>(ParamType)\n+KoReportCurrentArch::create<VC_IMPL>(ParamType)\n {\n-    dbgPigment << \"Compiled for arch:\" << Vc::CurrentImplementation::current();\n+    dbgPigment << \"Compiled for arch:\" << stringify(VC_IMPL);\n     dbgPigment << \"Features supported:\";\n     printFeatureSupported(\"SSE2\", Vc::SSE2Impl);\n     printFeatureSupported(\"SSSE3\", Vc::SSSE3Impl);\n     printFeatureSupported(\"SSE4.1\", Vc::SSE41Impl);\n     printFeatureSupported(\"AVX \", Vc::AVXImpl);\n+#if VC_VERSION_NUMBER >= VC_VERSION_CHECK(0, 8, 0)\n     printFeatureSupported(\"AVX2 \", Vc::AVX2Impl);\n+#endif\n }"}, {"sha": "2fcb0b29ec8ab194791660f0756d786b8343c915", "filename": "libs/pigment/compositeops/KoStreamedMath.h", "status": "modified", "additions": 58, "deletions": 18, "changes": 76, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/libs/pigment/compositeops/KoStreamedMath.h", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/libs/pigment/compositeops/KoStreamedMath.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/compositeops/KoStreamedMath.h?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -45,9 +45,6 @@\n template<Vc::Implementation _impl>\n struct KoStreamedMath {\n \n-using int_v = Vc::SimdArray<int, Vc::float_v::size()>;\n-using uint_v = Vc::SimdArray<unsigned int, Vc::float_v::size()>;\n-\n /**\n  * Composes src into dst without using vector instructions\n  */\n@@ -115,8 +112,8 @@ static inline quint8 lerp_mixed_u8_float(quint8 a, quint8 b, float alpha) {\n  * Each source mask element is considered to be a 8-bit integer\n  */\n static inline Vc::float_v fetch_mask_8(const quint8 *data) {\n-    uint_v data_i(data);\n-    return Vc::float_v(int_v(data_i));\n+    Vc::uint_v data_i(data);\n+    return Vc::float_v(Vc::int_v(data_i));\n }\n \n /**\n@@ -133,14 +130,14 @@ static inline Vc::float_v fetch_mask_8(const quint8 *data) {\n  */\n template <bool aligned>\n static inline Vc::float_v fetch_alpha_32(const quint8 *data) {\n-    uint_v data_i;\n+    Vc::uint_v data_i;\n     if (aligned) {\n         data_i.load((const quint32*)data, Vc::Aligned);\n     } else {\n         data_i.load((const quint32*)data, Vc::Unaligned);\n     }\n \n-    return Vc::float_v(int_v(data_i >> 24));\n+    return Vc::float_v(Vc::int_v(data_i >> 24));\n }\n \n /**\n@@ -160,19 +157,61 @@ static inline void fetch_colors_32(const quint8 *data,\n                             Vc::float_v &c1,\n                             Vc::float_v &c2,\n                             Vc::float_v &c3) {\n-    int_v data_i;\n+    Vc::uint_v data_i;\n+    if (aligned) {\n+        data_i.load((const quint32*)data, Vc::Aligned);\n+    } else {\n+        data_i.load((const quint32*)data, Vc::Unaligned);\n+    }\n+\n+    const quint32 lowByteMask = 0xFF;\n+    Vc::uint_v mask(lowByteMask);\n+\n+    c1 = Vc::float_v(Vc::int_v((data_i >> 16) & mask));\n+    c2 = Vc::float_v(Vc::int_v((data_i >> 8)  & mask));\n+    c3 = Vc::float_v(Vc::int_v( data_i        & mask));\n+}\n+\n+/**\n+ *\n+ */\n+template <bool aligned>\n+static inline void fetch_all_32(const quint8 *data,\n+                            Vc::float_v &alpha,\n+                            Vc::float_v &c1,\n+                            Vc::float_v &c2,\n+                            Vc::float_v &c3) {\n+    Vc::uint_v data_i;\n     if (aligned) {\n         data_i.load((const quint32*)data, Vc::Aligned);\n     } else {\n         data_i.load((const quint32*)data, Vc::Unaligned);\n     }\n \n     const quint32 lowByteMask = 0xFF;\n-    uint_v mask(lowByteMask);\n+    Vc::uint_v mask(lowByteMask);\n \n-    c1 = Vc::float_v(int_v((data_i >> 16) & mask));\n-    c2 = Vc::float_v(int_v((data_i >> 8)  & mask));\n-    c3 = Vc::float_v(int_v( data_i        & mask));\n+    alpha = Vc::float_v(Vc::int_v(data_i >> 24));\n+    c1 = Vc::float_v(Vc::int_v((data_i >> 16) & mask));\n+    c2 = Vc::float_v(Vc::int_v((data_i >> 8)  & mask));\n+    c3 = Vc::float_v(Vc::int_v( data_i        & mask));\n+}\n+\n+template <bool aligned>\n+static inline void fetch_8_offset(const quint8 *data,\n+                                  Vc::float_v &value,\n+                                  const quint32 offset) {\n+    Vc::uint_v data_i;\n+    if (aligned) {\n+        data_i.load((const quint32*)data, Vc::Aligned);\n+    } else {\n+        data_i.load((const quint32*)data, Vc::Unaligned);\n+    }\n+\n+    const quint32 lowByteMask = 0xFF;\n+    Vc::uint_v mask(lowByteMask);\n+\n+    value = Vc::float_v(Vc::int_v((data_i >> offset) & mask));\n }\n \n /**\n@@ -194,18 +233,19 @@ static inline void write_channels_32(quint8 *data,\n      */\n \n     const quint32 lowByteMask = 0xFF;\n+    Vc::uint_v mask(lowByteMask);\n \n     // FIXME: Use single-instruction rounding + conversion\n     //        The achieve that we need to implement Vc::iRound()\n \n-    uint_v mask(lowByteMask);\n-    uint_v v1 = uint_v(int_v(Vc::round(alpha))) << 24;\n-    uint_v v2 = (uint_v(int_v(Vc::round(c1))) & mask) << 16;\n-    uint_v v3 = (uint_v(int_v(Vc::round(c2))) & mask) <<  8;\n-    uint_v v4 = uint_v(int_v(Vc::round(c3))) & mask;\n+    Vc::uint_v v1 = Vc::uint_v(Vc::int_v(Vc::round(alpha))) << 24;\n+    Vc::uint_v v2 = (Vc::uint_v(Vc::int_v(Vc::round(c1))) & mask) << 16;\n+    Vc::uint_v v3 = (Vc::uint_v(Vc::int_v(Vc::round(c2))) & mask) <<  8;\n     v1 = v1 | v2;\n+    Vc::uint_v v4 = Vc::uint_v(Vc::int_v(Vc::round(c3))) & mask;\n     v3 = v3 | v4;\n-    *((uint_v*)data) = v1 | v3;\n+\n+    *((Vc::uint_v*)data) = v1 | v3;\n }\n \n /**"}, {"sha": "09677a680d9fdb83204c8f596ef114579ec03824", "filename": "libs/pigment/compositeops/KoVcMultiArchBuildSupport.h", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/KDE/krita/blob/2f3d53e6c08ce812a22f058e9ae4598a9e319471/libs/pigment/compositeops/KoVcMultiArchBuildSupport.h", "raw_url": "https://github.com/KDE/krita/raw/2f3d53e6c08ce812a22f058e9ae4598a9e319471/libs/pigment/compositeops/KoVcMultiArchBuildSupport.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/compositeops/KoVcMultiArchBuildSupport.h?ref=2f3d53e6c08ce812a22f058e9ae4598a9e319471", "patch": "@@ -35,7 +35,6 @@\n #pragma warning ( disable : 4244 )\n #pragma warning ( disable : 4800 )\n #endif\n-#include <Vc/global.h>\n #include <Vc/Vc>\n #include <Vc/support.h>\n #if defined _MSC_VER\n@@ -45,9 +44,11 @@\n #else /* HAVE_VC */\n \n namespace Vc {\n-    typedef enum {ScalarImpl} CurrentImplementation;\n+    typedef enum {ScalarImpl} Implementation;\n }\n \n+#define VC_IMPL ::Vc::ScalarImpl\n+\n #ifdef DO_PACKAGERS_BUILD\n #ifdef __GNUC__\n #warning \"Packagers build is not available without the presence of Vc library. Disabling.\"\n@@ -89,9 +90,12 @@ createOptimizedClass(typename FactoryType::ParamType param)\n      *\n      * TODO: Add FMA3/4 when it is adopted by Vc\n      */\n+#if VC_VERSION_NUMBER >= VC_VERSION_CHECK(0, 8, 0)\n     if (Vc::isImplementationSupported(Vc::AVX2Impl)) {\n         return FactoryType::template create<Vc::AVX2Impl>(param);\n-    } else if (Vc::isImplementationSupported(Vc::AVXImpl)) {\n+    } else\n+#endif\n+    if (Vc::isImplementationSupported(Vc::AVXImpl)) {\n         return FactoryType::template create<Vc::AVXImpl>(param);\n     } else if (Vc::isImplementationSupported(Vc::SSE41Impl)) {\n         return FactoryType::template create<Vc::SSE41Impl>(param);\n@@ -115,7 +119,7 @@ template<class FactoryType>\n typename FactoryType::ReturnType\n createOptimizedClass(typename FactoryType::ParamType param)\n {\n-    return FactoryType::template create<Vc::CurrentImplementation::current()>(param);\n+    return FactoryType::template create<VC_IMPL>(param);\n }\n \n #endif /* DO_PACKAGERS_BUILD */"}]}, {"sha": "0c9c64d0c3b10069b2157c54369b30be494cdf96", "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "421c171f917584b706b77487a444a7203ca606d6", "filename": "3rdparty/ext_vc/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/0c9c64d0c3b10069b2157c54369b30be494cdf96/3rdparty/ext_vc/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/0c9c64d0c3b10069b2157c54369b30be494cdf96/3rdparty/ext_vc/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/3rdparty/ext_vc/CMakeLists.txt?ref=0c9c64d0c3b10069b2157c54369b30be494cdf96", "patch": "@@ -1,8 +1,8 @@\n SET(PREFIX_ext_vc \"${EXTPREFIX}\" )\n ExternalProject_Add( ext_vc\n     DOWNLOAD_DIR ${EXTERNALS_DOWNLOAD_DIR}\n-    URL http://files.kde.org/krita/build/dependencies/Vc-1.2.0.tar.gz\n-    URL_MD5 f2a213ae4bad0dcf4ec6469e4dad41c1\n+    URL http://files.kde.org/krita/build/dependencies/Vc-0.7.5.tar.gz\n+    URL_MD5 59854e2381b78d602b4a00e459e3d333\n \n     INSTALL_DIR ${PREFIX_ext_vc}\n \tCMAKE_ARGS -DCMAKE_INSTALL_PREFIX=${PREFIX_ext_vc} -DBUILD_TESTING=OFF -DCMAKE_BUILD_TYPE=${GLOBAL_BUILD_TYPE} ${GLOBAL_PROFILE}"}]}, {"sha": "8b0cccc9d5c0e2d344f769480bc1a266fd1a1784", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "891b3e8f8d38c5847895d46826ec8d406a5f194b", "filename": "libs/image/kis_brush_mask_applicator_factories.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/8b0cccc9d5c0e2d344f769480bc1a266fd1a1784/libs/image/kis_brush_mask_applicator_factories.cpp", "raw_url": "https://github.com/KDE/krita/raw/8b0cccc9d5c0e2d344f769480bc1a266fd1a1784/libs/image/kis_brush_mask_applicator_factories.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_brush_mask_applicator_factories.cpp?ref=8b0cccc9d5c0e2d344f769480bc1a266fd1a1784", "patch": "@@ -68,7 +68,7 @@ FastRowProcessor::process<Vc::CurrentImplementation::current()>(float* buffer, i\n \n     float* bufferPointer = buffer;\n \n-    Vc::float_v currentIndices = Vc::float_v::IndexesFromZero();\n+    Vc::float_v currentIndices(Vc::int_v::IndexesFromZero());\n \n     Vc::float_v increment((float)Vc::float_v::Size);\n     Vc::float_v vCenterX(centerX);"}]}, {"sha": "c2d1405feeccafc5dcc31a367b6a8c11ec1375a6", "stats": {"total": 67, "additions": 19, "deletions": 48}, "files": [{"sha": "d8999c16c8a201e2076a2ffe374702a38dfc9f2a", "filename": "benchmarks/kis_mask_generator_benchmark.cpp", "status": "modified", "additions": 7, "deletions": 25, "changes": 32, "blob_url": "https://github.com/KDE/krita/blob/c2d1405feeccafc5dcc31a367b6a8c11ec1375a6/benchmarks/kis_mask_generator_benchmark.cpp", "raw_url": "https://github.com/KDE/krita/raw/c2d1405feeccafc5dcc31a367b6a8c11ec1375a6/benchmarks/kis_mask_generator_benchmark.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/benchmarks/kis_mask_generator_benchmark.cpp?ref=c2d1405feeccafc5dcc31a367b6a8c11ec1375a6", "patch": "@@ -52,38 +52,20 @@ void KisMaskGeneratorBenchmark::benchmarkCircle()\n     }\n }\n \n-#include <KoColorSpace.h>\n-#include <KoColorSpaceRegistry.h>\n-#include \"kis_fixed_paint_device.h\"\n-#include \"kis_types.h\"\n-#include \"kis_brush_mask_applicator_base.h\"\n-#include \"krita_utils.h\"\n-\n-\n void KisMaskGeneratorBenchmark::benchmarkSIMD()\n {\n #ifdef HAVE_VC\n-    const KoColorSpace * cs = KoColorSpaceRegistry::instance()->rgb8();\n-    KisFixedPaintDeviceSP dev = new KisFixedPaintDevice(cs);\n-    dev->setRect(QRect(0, 0, 100, 100));\n-    dev->initialize();\n-\n-    MaskProcessingData data(dev, cs,\n-                            0.0, 1.0,\n-                            50, 50, 0);\n-\n-    KisCircleMaskGenerator gen(100, 0.5, 0.5, 0.5, 2, false);\n-\n-    KisBrushMaskApplicatorBase *applicator = gen.applicator();\n-    applicator->initializeData(&data);\n-\n-    QVector<QRect> rects = KritaUtils::splitRectIntoPatches(dev->bounds(), QSize(63, 63));\n+    int width = 1000;\n+    float *buffer = Vc::malloc<float, Vc::AlignOnVector>(width);\n \n+    KisCircleMaskGenerator gen(1000, 0.5, 0.5, 0.5, 2, true);\n     QBENCHMARK{\n-        Q_FOREACH (const QRect &rc, rects) {\n-            applicator->process(rc);\n+        for(int y = 0; y < 1000; ++y)\n+        {\n+//            gen.processRowFast(buffer, width, y, 0.0f, 1.0f, 500.0f, 500.0f, 0.5f, 0.5f);\n         }\n     }\n+    Vc::free(buffer);\n #endif\n }\n "}, {"sha": "b80bf597d6a4fce1c7c4bc513c68acfca022ec17", "filename": "libs/image/kis_brush_mask_applicator_factories.cpp", "status": "modified", "additions": 12, "deletions": 23, "changes": 35, "blob_url": "https://github.com/KDE/krita/blob/c2d1405feeccafc5dcc31a367b6a8c11ec1375a6/libs/image/kis_brush_mask_applicator_factories.cpp", "raw_url": "https://github.com/KDE/krita/raw/c2d1405feeccafc5dcc31a367b6a8c11ec1375a6/libs/image/kis_brush_mask_applicator_factories.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_brush_mask_applicator_factories.cpp?ref=c2d1405feeccafc5dcc31a367b6a8c11ec1375a6", "patch": "@@ -94,33 +94,22 @@ FastRowProcessor::process<Vc::CurrentImplementation::current()>(float* buffer, i\n         Vc::float_v yr = x_ * vSina + vCosaY_;\n \n         Vc::float_v n = pow2(xr * vXCoeff) + pow2(yr * vYCoeff);\n-        Vc::float_m outsideMask = n > vOne;\n \n-        if (!outsideMask.isFull()) {\n-\n-            if (useSmoothing) {\n-                 xr = Vc::abs(xr) + vOne;\n-                 yr = Vc::abs(yr) + vOne;\n-            }\n-\n-            Vc::float_v vNormFade = pow2(xr * vTransformedFadeX) + pow2(yr * vTransformedFadeY);\n-\n-            //255 * n * (normeFade - 1) / (normeFade - n)\n-            Vc::float_v vFade = n * (vNormFade - vOne) / (vNormFade - n);\n-\n-            // Mask in the inner circe of the mask\n-            Vc::float_m mask = vNormFade < vOne;\n-            vFade.setZero(mask);\n+        if (useSmoothing) {\n+            xr = Vc::abs(xr) + vOne;\n+            yr = Vc::abs(yr) + vOne;\n+        }\n \n-            // Mask out the outer circe of the mask\n-            vFade(outsideMask) = vOne;\n+        Vc::float_v vNormFade = pow2(xr * vTransformedFadeX) + pow2(yr * vTransformedFadeY);\n \n-            vFade.store(bufferPointer, Vc::Aligned);\n-        } else {\n-            // Mask out everything outside the circle\n-            vOne.store(bufferPointer, Vc::Aligned);\n-        }\n+        //255 * n * (normeFade - 1) / (normeFade - n)\n+        Vc::float_v vFade = n * (vNormFade - vOne) / (vNormFade - n);\n+        // Mask out the inner circe of the mask\n+        Vc::float_m mask = vNormFade < vOne;\n+        vFade.setZero(mask);\n+        vFade = Vc::min(vFade, vOne);\n \n+        vFade.store(bufferPointer);\n         currentIndices = currentIndices + increment;\n \n         bufferPointer += Vc::float_v::Size;"}]}, {"sha": "d7971a9494eb095b81efbd5f11858afc673172cc", "stats": {"total": 66, "additions": 23, "deletions": 43}, "files": [{"sha": "dc88f64551ef45bb41084b7246e2f58daba374f1", "filename": "benchmarks/kis_mask_generator_benchmark.cpp", "status": "modified", "additions": 7, "deletions": 14, "changes": 21, "blob_url": "https://github.com/KDE/krita/blob/d7971a9494eb095b81efbd5f11858afc673172cc/benchmarks/kis_mask_generator_benchmark.cpp", "raw_url": "https://github.com/KDE/krita/raw/d7971a9494eb095b81efbd5f11858afc673172cc/benchmarks/kis_mask_generator_benchmark.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/benchmarks/kis_mask_generator_benchmark.cpp?ref=d7971a9494eb095b81efbd5f11858afc673172cc", "patch": "@@ -60,17 +60,19 @@ void KisMaskGeneratorBenchmark::benchmarkCircle()\n #include \"krita_utils.h\"\n \n \n-void benchmarkSIMD(qreal fade) {\n+void KisMaskGeneratorBenchmark::benchmarkSIMD()\n+{\n+#ifdef HAVE_VC\n     const KoColorSpace * cs = KoColorSpaceRegistry::instance()->rgb8();\n     KisFixedPaintDeviceSP dev = new KisFixedPaintDevice(cs);\n-    dev->setRect(QRect(0, 0, 1000, 1000));\n+    dev->setRect(QRect(0, 0, 100, 100));\n     dev->initialize();\n \n     MaskProcessingData data(dev, cs,\n                             0.0, 1.0,\n-                            500, 500, 0);\n+                            50, 50, 0);\n \n-    KisCircleMaskGenerator gen(1000, 1.0, fade, fade, 2, false);\n+    KisCircleMaskGenerator gen(100, 0.5, 0.5, 0.5, 2, false);\n \n     KisBrushMaskApplicatorBase *applicator = gen.applicator();\n     applicator->initializeData(&data);\n@@ -82,16 +84,7 @@ void benchmarkSIMD(qreal fade) {\n             applicator->process(rc);\n         }\n     }\n-}\n-\n-void KisMaskGeneratorBenchmark::benchmarkSIMD_SharpBrush()\n-{\n-    benchmarkSIMD(1.0);\n-}\n-\n-void KisMaskGeneratorBenchmark::benchmarkSIMD_FadedBrush()\n-{\n-    benchmarkSIMD(0.5);\n+#endif\n }\n \n void KisMaskGeneratorBenchmark::benchmarkSquare()"}, {"sha": "a7fa3695511291907e8a0f1325b03a081bbb1709", "filename": "benchmarks/kis_mask_generator_benchmark.h", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/KDE/krita/blob/d7971a9494eb095b81efbd5f11858afc673172cc/benchmarks/kis_mask_generator_benchmark.h", "raw_url": "https://github.com/KDE/krita/raw/d7971a9494eb095b81efbd5f11858afc673172cc/benchmarks/kis_mask_generator_benchmark.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/benchmarks/kis_mask_generator_benchmark.h?ref=d7971a9494eb095b81efbd5f11858afc673172cc", "patch": "@@ -26,10 +26,9 @@ class KisMaskGeneratorBenchmark : public QObject\n     Q_OBJECT\n private Q_SLOTS:\n     void benchmarkCircle();\n-    void benchmarkSIMD_SharpBrush();\n-    void benchmarkSIMD_FadedBrush();\n+    void benchmarkSIMD();\n     void benchmarkSquare();\n-\n+    \n };\n \n #endif"}, {"sha": "fbfda538481486fdf20c4da46fd206ec05e4b236", "filename": "libs/image/kis_brush_mask_applicator_factories.cpp", "status": "modified", "additions": 14, "deletions": 21, "changes": 35, "blob_url": "https://github.com/KDE/krita/blob/d7971a9494eb095b81efbd5f11858afc673172cc/libs/image/kis_brush_mask_applicator_factories.cpp", "raw_url": "https://github.com/KDE/krita/raw/d7971a9494eb095b81efbd5f11858afc673172cc/libs/image/kis_brush_mask_applicator_factories.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_brush_mask_applicator_factories.cpp?ref=d7971a9494eb095b81efbd5f11858afc673172cc", "patch": "@@ -61,7 +61,6 @@ FastRowProcessor::process<Vc::CurrentImplementation::current()>(float* buffer, i\n                                    float centerX, float centerY)\n {\n     const bool useSmoothing = d->copyOfAntialiasEdges;\n-    const bool noFading = d->noFading;\n \n     float y_ = y - centerY;\n     float sinay_ = sina * y_;\n@@ -85,7 +84,7 @@ FastRowProcessor::process<Vc::CurrentImplementation::current()>(float* buffer, i\n     Vc::float_v vTransformedFadeX(d->transformedFadeX);\n     Vc::float_v vTransformedFadeY(d->transformedFadeY);\n \n-    Vc::float_v vOne(Vc::One);\n+    Vc::float_v vOne(1.0f);\n \n     for (int i=0; i < width; i+= Vc::float_v::Size){\n \n@@ -99,30 +98,24 @@ FastRowProcessor::process<Vc::CurrentImplementation::current()>(float* buffer, i\n \n         if (!outsideMask.isFull()) {\n \n-            if (noFading) {\n-                Vc::float_v vFade(Vc::Zero);\n-                vFade(outsideMask) = vOne;\n-                vFade.store(bufferPointer, Vc::Aligned);\n-            } else {\n-                if (useSmoothing) {\n-                    xr = Vc::abs(xr) + vOne;\n-                    yr = Vc::abs(yr) + vOne;\n-                }\n+            if (useSmoothing) {\n+                 xr = Vc::abs(xr) + vOne;\n+                 yr = Vc::abs(yr) + vOne;\n+            }\n \n-                Vc::float_v vNormFade = pow2(xr * vTransformedFadeX) + pow2(yr * vTransformedFadeY);\n+            Vc::float_v vNormFade = pow2(xr * vTransformedFadeX) + pow2(yr * vTransformedFadeY);\n \n-                //255 * n * (normeFade - 1) / (normeFade - n)\n-                Vc::float_v vFade = n * (vNormFade - vOne) / (vNormFade - n);\n+            //255 * n * (normeFade - 1) / (normeFade - n)\n+            Vc::float_v vFade = n * (vNormFade - vOne) / (vNormFade - n);\n \n-                // Mask in the inner circe of the mask\n-                Vc::float_m mask = vNormFade < vOne;\n-                vFade.setZero(mask);\n+            // Mask in the inner circe of the mask\n+            Vc::float_m mask = vNormFade < vOne;\n+            vFade.setZero(mask);\n \n-                // Mask out the outer circe of the mask\n-                vFade(outsideMask) = vOne;\n+            // Mask out the outer circe of the mask\n+            vFade(outsideMask) = vOne;\n \n-                vFade.store(bufferPointer, Vc::Aligned);\n-            }\n+            vFade.store(bufferPointer, Vc::Aligned);\n         } else {\n             // Mask out everything outside the circle\n             vOne.store(bufferPointer, Vc::Aligned);"}, {"sha": "e2454f69309bfac21523a7ef99ed0392fc34f2c7", "filename": "libs/image/kis_circle_mask_generator.cpp", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/d7971a9494eb095b81efbd5f11858afc673172cc/libs/image/kis_circle_mask_generator.cpp", "raw_url": "https://github.com/KDE/krita/raw/d7971a9494eb095b81efbd5f11858afc673172cc/libs/image/kis_circle_mask_generator.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_circle_mask_generator.cpp?ref=d7971a9494eb095b81efbd5f11858afc673172cc", "patch": "@@ -70,10 +70,6 @@ void KisCircleMaskGenerator::setScale(qreal scaleX, qreal scaleY)\n     d->yfadecoef = (verticalFade() == 0)   ? 1 : (2.0 / (verticalFade() * effectiveSrcHeight()));\n     d->transformedFadeX = KisMaskGenerator::softness() * d->xfadecoef;\n     d->transformedFadeY = KisMaskGenerator::softness() * d->yfadecoef;\n-\n-    d->noFading = !d->copyOfAntialiasEdges &&\n-        qFuzzyCompare(d->xcoef, d->transformedFadeX) &&\n-        qFuzzyCompare(d->ycoef, d->transformedFadeY);\n }\n \n KisCircleMaskGenerator::~KisCircleMaskGenerator()"}, {"sha": "d738583b2db1f43cce81ab823c6e7696f0bcb6c6", "filename": "libs/image/kis_circle_mask_generator_p.h", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/d7971a9494eb095b81efbd5f11858afc673172cc/libs/image/kis_circle_mask_generator_p.h", "raw_url": "https://github.com/KDE/krita/raw/d7971a9494eb095b81efbd5f11858afc673172cc/libs/image/kis_circle_mask_generator_p.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_circle_mask_generator_p.h?ref=d7971a9494eb095b81efbd5f11858afc673172cc", "patch": "@@ -24,7 +24,6 @@ struct Q_DECL_HIDDEN KisCircleMaskGenerator::Private {\n     double xfadecoef, yfadecoef;\n     double transformedFadeX, transformedFadeY;\n     bool copyOfAntialiasEdges;\n-    bool noFading;\n \n     KisBrushMaskApplicatorBase *applicator;\n };"}]}, {"sha": "e0cf4c2f7a6d78ac425fc422c28443ca106a8b79", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "4716d444ff7d14d06ea6ff144069a17aa692ec17", "filename": "libs/pigment/compositeops/KoStreamedMath.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/e0cf4c2f7a6d78ac425fc422c28443ca106a8b79/libs/pigment/compositeops/KoStreamedMath.h", "raw_url": "https://github.com/KDE/krita/raw/e0cf4c2f7a6d78ac425fc422c28443ca106a8b79/libs/pigment/compositeops/KoStreamedMath.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/compositeops/KoStreamedMath.h?ref=e0cf4c2f7a6d78ac425fc422c28443ca106a8b79", "patch": "@@ -205,7 +205,7 @@ static inline void write_channels_32(quint8 *data,\n     uint_v v4 = uint_v(int_v(Vc::round(c3))) & mask;\n     v1 = v1 | v2;\n     v3 = v3 | v4;\n-    (v1 | v3).store((quint32*)data, Vc::Aligned);\n+    *((uint_v*)data) = v1 | v3;\n }\n \n /**"}]}, {"sha": "61e059d3bcaca79011aafffcfae622f537695196", "stats": {"total": 42, "additions": 21, "deletions": 21}, "files": [{"sha": "51fb77be37025f0aae4d77d516b9baf4c06f0796", "filename": "benchmarks/kis_composition_benchmark.cpp", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/KDE/krita/blob/61e059d3bcaca79011aafffcfae622f537695196/benchmarks/kis_composition_benchmark.cpp", "raw_url": "https://github.com/KDE/krita/raw/61e059d3bcaca79011aafffcfae622f537695196/benchmarks/kis_composition_benchmark.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/benchmarks/kis_composition_benchmark.cpp?ref=61e059d3bcaca79011aafffcfae622f537695196", "patch": "@@ -227,7 +227,7 @@ QVector<Tile> generateTiles(int size,\n     QVector<Tile> tiles(size);\n \n #ifdef HAVE_VC\n-    const int vecSize = Vc::float_v::size();\n+    const int vecSize = Vc::float_v::Size;\n #else\n     const int vecSize = 1;\n #endif\n@@ -472,7 +472,7 @@ void checkRounding(qreal opacity, qreal flow, qreal averageOpacity = -1, quint32\n     QVector<Tile> tiles =\n         generateTiles(2, 0, 0, ALPHA_RANDOM, ALPHA_RANDOM, pixelSize);\n \n-    const int vecSize = Vc::float_v::size();\n+    const int vecSize = Vc::float_v::Size;\n \n     const int numBlocks = numPixels / vecSize;\n \n@@ -810,7 +810,7 @@ void KisCompositionBenchmark::benchmarkMemcpy()\n }\n \n #ifdef HAVE_VC\n-    const int vecSize = Vc::float_v::size();\n+    const int vecSize = Vc::float_v::Size;\n     const size_t uint8VecAlignment = qMax(vecSize * sizeof(quint8), sizeof(void*));\n     const size_t uint32VecAlignment = qMax(vecSize * sizeof(quint32), sizeof(void*));\n     const size_t floatVecAlignment = qMax(vecSize * sizeof(float), sizeof(void*));\n@@ -835,7 +835,7 @@ void KisCompositionBenchmark::benchmarkUintFloat()\n     float *fData = (float*)ptr;\n \n     QBENCHMARK {\n-        for (int i = 0; i < dataSize; i += Vc::float_v::size()) {\n+        for (int i = 0; i < dataSize; i += Vc::float_v::Size) {\n             // convert uint -> float directly, this causes\n             // static_cast helper be called\n             Vc::float_v b(uint_v(iData + i));\n@@ -868,7 +868,7 @@ void KisCompositionBenchmark::benchmarkUintIntFloat()\n     float *fData = (float*)ptr;\n \n     QBENCHMARK {\n-        for (int i = 0; i < dataSize; i += Vc::float_v::size()) {\n+        for (int i = 0; i < dataSize; i += Vc::float_v::Size) {\n             // convert uint->int->float, that avoids special sign\n             // treating, and gives 2.6 times speedup\n             Vc::float_v b(int_v(uint_v(iData + i)));\n@@ -900,7 +900,7 @@ void KisCompositionBenchmark::benchmarkFloatUint()\n     float *fData = (float*)ptr;\n \n     QBENCHMARK {\n-        for (int i = 0; i < dataSize; i += Vc::float_v::size()) {\n+        for (int i = 0; i < dataSize; i += Vc::float_v::Size) {\n             // conversion float -> uint\n             uint_v b(Vc::float_v(fData + i));\n \n@@ -933,7 +933,7 @@ void KisCompositionBenchmark::benchmarkFloatIntUint()\n     float *fData = (float*)ptr;\n \n     QBENCHMARK {\n-        for (int i = 0; i < dataSize; i += Vc::float_v::size()) {\n+        for (int i = 0; i < dataSize; i += Vc::float_v::Size) {\n             // conversion float -> int -> uint\n             uint_v b(int_v(Vc::float_v(fData + i)));\n "}, {"sha": "e9f7f66519f398fe9ada317d7c62b251d81cd18d", "filename": "libs/image/kis_brush_mask_applicator_factories.cpp", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/KDE/krita/blob/61e059d3bcaca79011aafffcfae622f537695196/libs/image/kis_brush_mask_applicator_factories.cpp", "raw_url": "https://github.com/KDE/krita/raw/61e059d3bcaca79011aafffcfae622f537695196/libs/image/kis_brush_mask_applicator_factories.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_brush_mask_applicator_factories.cpp?ref=61e059d3bcaca79011aafffcfae622f537695196", "patch": "@@ -71,7 +71,7 @@ FastRowProcessor::process<Vc::CurrentImplementation::current()>(float* buffer, i\n \n     Vc::float_v currentIndices = Vc::float_v::IndexesFromZero();\n \n-    Vc::float_v increment((float)Vc::float_v::size());\n+    Vc::float_v increment((float)Vc::float_v::Size);\n     Vc::float_v vCenterX(centerX);\n \n     Vc::float_v vCosa(cosa);\n@@ -87,7 +87,7 @@ FastRowProcessor::process<Vc::CurrentImplementation::current()>(float* buffer, i\n \n     Vc::float_v vOne(Vc::One);\n \n-    for (int i=0; i < width; i+= Vc::float_v::size()){\n+    for (int i=0; i < width; i+= Vc::float_v::Size){\n \n         Vc::float_v x_ = currentIndices - vCenterX;\n \n@@ -130,7 +130,7 @@ FastRowProcessor::process<Vc::CurrentImplementation::current()>(float* buffer, i\n \n         currentIndices = currentIndices + increment;\n \n-        bufferPointer += Vc::float_v::size();\n+        bufferPointer += Vc::float_v::Size;\n     }\n }\n "}, {"sha": "ef6c5492e23ed47ec3ca4c6a538a8e9524bb6d01", "filename": "libs/image/kis_brush_mask_applicators.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/61e059d3bcaca79011aafffcfae622f537695196/libs/image/kis_brush_mask_applicators.h", "raw_url": "https://github.com/KDE/krita/raw/61e059d3bcaca79011aafffcfae622f537695196/libs/image/kis_brush_mask_applicators.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/image/kis_brush_mask_applicators.h?ref=61e059d3bcaca79011aafffcfae622f537695196", "patch": "@@ -110,8 +110,8 @@ void KisBrushMaskVectorApplicator<MaskGenerator, _impl>::processVector(const QRe\n \n     // We need to calculate with a multiple of the width of the simd register\n     int alignOffset = 0;\n-    if (width % Vc::float_v::size() != 0) {\n-        alignOffset = Vc::float_v::size() - (width % Vc::float_v::size());\n+    if (width % Vc::float_v::Size != 0) {\n+        alignOffset = Vc::float_v::Size - (width % Vc::float_v::Size);\n     }\n     int simdWidth = width + alignOffset;\n "}, {"sha": "7632578081f157e86b7522d16b87222a30133e8c", "filename": "libs/pigment/compositeops/KoOptimizedCompositeOpAlphaDarken128.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/61e059d3bcaca79011aafffcfae622f537695196/libs/pigment/compositeops/KoOptimizedCompositeOpAlphaDarken128.h", "raw_url": "https://github.com/KDE/krita/raw/61e059d3bcaca79011aafffcfae622f537695196/libs/pigment/compositeops/KoOptimizedCompositeOpAlphaDarken128.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/compositeops/KoOptimizedCompositeOpAlphaDarken128.h?ref=61e059d3bcaca79011aafffcfae622f537695196", "patch": "@@ -47,7 +47,7 @@ struct AlphaDarkenCompositor128 {\n \n     /**\n      * This is a vector equivalent of compositeOnePixelScalar(). It is considered\n-     * to process Vc::float_v::size() pixels in a single pass.\n+     * to process Vc::float_v::Size pixels in a single pass.\n      *\n      * o the \\p haveMask parameter points whether the real (non-null) mask\n      *   pointer is passed to the function."}, {"sha": "6af0d3df7553375d5354d110353d10078adfdac8", "filename": "libs/pigment/compositeops/KoOptimizedCompositeOpAlphaDarken32.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/61e059d3bcaca79011aafffcfae622f537695196/libs/pigment/compositeops/KoOptimizedCompositeOpAlphaDarken32.h", "raw_url": "https://github.com/KDE/krita/raw/61e059d3bcaca79011aafffcfae622f537695196/libs/pigment/compositeops/KoOptimizedCompositeOpAlphaDarken32.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/compositeops/KoOptimizedCompositeOpAlphaDarken32.h?ref=61e059d3bcaca79011aafffcfae622f537695196", "patch": "@@ -42,7 +42,7 @@ struct AlphaDarkenCompositor32 {\n \n     /**\n      * This is a vector equivalent of compositeOnePixelScalar(). It is considered\n-     * to process Vc::float_v::size() pixels in a single pass.\n+     * to process Vc::float_v::Size pixels in a single pass.\n      *\n      * o the \\p haveMask parameter points whether the real (non-null) mask\n      *   pointer is passed to the function.\n@@ -111,7 +111,7 @@ struct AlphaDarkenCompositor32 {\n         } else if (srcAlphaIsUnit) {\n             bool dstAlphaIsUnit = (dst_alpha == uint8Max).isFull();\n             if (dstAlphaIsUnit) {\n-                memcpy(dst, src, 4 * Vc::float_v::size());\n+                memcpy(dst, src, 4 * Vc::float_v::Size);\n                 return;\n             } else {\n                 dst_c1 = src_c1;"}, {"sha": "2ad712239a5d31f262fc94559e8b933b0653fd77", "filename": "libs/pigment/compositeops/KoOptimizedCompositeOpOver32.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/61e059d3bcaca79011aafffcfae622f537695196/libs/pigment/compositeops/KoOptimizedCompositeOpOver32.h", "raw_url": "https://github.com/KDE/krita/raw/61e059d3bcaca79011aafffcfae622f537695196/libs/pigment/compositeops/KoOptimizedCompositeOpOver32.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/compositeops/KoOptimizedCompositeOpOver32.h?ref=61e059d3bcaca79011aafffcfae622f537695196", "patch": "@@ -109,7 +109,7 @@ struct OverCompositor32 {\n \n         } else {\n             if (!haveMask && !haveOpacity) {\n-                memcpy(dst, src, 4 * Vc::float_v::size());\n+                memcpy(dst, src, 4 * Vc::float_v::Size);\n                 return;\n             } else {\n                 // opacity has changed the alpha of the source,"}, {"sha": "07b2d32761a3d7651ad6869b8e8a3a5c3064ea6f", "filename": "libs/pigment/compositeops/KoStreamedMath.h", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/KDE/krita/blob/61e059d3bcaca79011aafffcfae622f537695196/libs/pigment/compositeops/KoStreamedMath.h", "raw_url": "https://github.com/KDE/krita/raw/61e059d3bcaca79011aafffcfae622f537695196/libs/pigment/compositeops/KoStreamedMath.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/compositeops/KoStreamedMath.h?ref=61e059d3bcaca79011aafffcfae622f537695196", "patch": "@@ -111,7 +111,7 @@ static inline quint8 lerp_mixed_u8_float(quint8 a, quint8 b, float alpha) {\n }\n \n /**\n- * Get a vector containing first Vc::float_v::size() values of mask.\n+ * Get a vector containing first Vc::float_v::Size values of mask.\n  * Each source mask element is considered to be a 8-bit integer\n  */\n static inline Vc::float_v fetch_mask_8(const quint8 *data) {\n@@ -120,7 +120,7 @@ static inline Vc::float_v fetch_mask_8(const quint8 *data) {\n }\n \n /**\n- * Get an alpha values from Vc::float_v::size() pixels 32-bit each\n+ * Get an alpha values from Vc::float_v::Size pixels 32-bit each\n  * (4 channels, 8 bit per channel).  The alpha value is considered\n  * to be stored in the most significat byte of the pixel\n  *\n@@ -144,7 +144,7 @@ static inline Vc::float_v fetch_alpha_32(const quint8 *data) {\n }\n \n /**\n- * Get color values from Vc::float_v::size() pixels 32-bit each\n+ * Get color values from Vc::float_v::Size pixels 32-bit each\n  * (4 channels, 8 bit per channel).  The color data is considered\n  * to be stored in the 3 least significant bytes of the pixel.\n  *\n@@ -176,7 +176,7 @@ static inline void fetch_colors_32(const quint8 *data,\n }\n \n /**\n- * Pack color and alpha values to Vc::float_v::size() pixels 32-bit each\n+ * Pack color and alpha values to Vc::float_v::Size pixels 32-bit each\n  * (4 channels, 8 bit per channel).  The color data is considered\n  * to be stored in the 3 least significant bytes of the pixel, alpha -\n  * in the most significant byte\n@@ -218,7 +218,7 @@ template<bool useMask, bool useFlow, class Compositor, int pixelSize>\n {\n     using namespace Arithmetic;\n \n-    const int vectorSize = Vc::float_v::size();\n+    const int vectorSize = Vc::float_v::Size;\n     const qint32 vectorInc = pixelSize * vectorSize;\n     const qint32 linearInc = pixelSize;\n     qint32 srcVectorInc = vectorInc;"}]}, {"sha": "ef985d59527093809db59e88d0e79362df6beb0f", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "f77bcec842ea202f78e6d2fe8011d533859f1fb0", "filename": "libs/pigment/compositeops/KoStreamedMath.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/ef985d59527093809db59e88d0e79362df6beb0f/libs/pigment/compositeops/KoStreamedMath.h", "raw_url": "https://github.com/KDE/krita/raw/ef985d59527093809db59e88d0e79362df6beb0f/libs/pigment/compositeops/KoStreamedMath.h", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/pigment/compositeops/KoStreamedMath.h?ref=ef985d59527093809db59e88d0e79362df6beb0f", "patch": "@@ -232,7 +232,7 @@ template<bool useMask, bool useFlow, class Compositor, int pixelSize>\n     if (!params.srcRowStride) {\n         if (pixelSize == 4) {\n             quint32 *buf = Vc::malloc<quint32, Vc::AlignOnVector>(vectorSize);\n-            *((uint_v*)buf) = uint_v(*((const quint32*)params.srcRowStart));\n+            *((Vc::uint_v*)buf) = Vc::uint_v(*((const quint32*)params.srcRowStart));\n             srcRowStart = reinterpret_cast<quint8*>(buf);\n             srcLinearInc = 0;\n             srcVectorInc = 0;"}]}, {"sha": "b39bfe02bdc523ed30b54c6ea941d1c073e425dc", "stats": {"total": 18, "additions": 8, "deletions": 10}, "files": [{"sha": "36594a92146a978154b69969807cc512197138f5", "filename": "CMakeLists.txt", "status": "modified", "additions": 8, "deletions": 10, "changes": 18, "blob_url": "https://github.com/KDE/krita/blob/b39bfe02bdc523ed30b54c6ea941d1c073e425dc/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/b39bfe02bdc523ed30b54c6ea941d1c073e425dc/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=b39bfe02bdc523ed30b54c6ea941d1c073e425dc", "patch": "@@ -481,16 +481,14 @@ endif()\n ##\n ## Test for Vc\n ##\n-set(HAVE_VC FALSE)\n-if( NOT MSVC)\n-    set(OLD_CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} )\n-    set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake/modules )\n-    macro_optional_find_package(Vc 1.0.0)\n-    macro_log_feature(Vc_FOUND \"Vc\" \"Portable, zero-overhead SIMD library for C++\" \"https://github.com/VcDevel/Vc\" FALSE \"\" \"Required by the Krita for vectorization\")\n-    macro_bool_to_01(Vc_FOUND HAVE_VC)\n-    macro_bool_to_01(PACKAGERS_BUILD DO_PACKAGERS_BUILD)\n-    configure_file(config-vc.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config-vc.h )\n-endif()\n+set(OLD_CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} )\n+set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake/modules )\n+macro_optional_find_package(Vc 1.0.0)\n+macro_log_feature(Vc_FOUND \"Vc\" \"Portable, zero-overhead SIMD library for C++\" \"https://github.com/VcDevel/Vc\" FALSE \"\" \"Required by the Krita for vectorization\")\n+macro_bool_to_01(Vc_FOUND HAVE_VC)\n+macro_bool_to_01(PACKAGERS_BUILD DO_PACKAGERS_BUILD)\n+\n+configure_file(config-vc.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config-vc.h )\n \n if(HAVE_VC)\n     message(STATUS \"Vc found!\")"}]}, {"sha": "2a4ab9d3f790deb7543cda551eb53fd5aa48b84c", "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "28c5c025807c82ef35bce7b73ac7350cb15f2dc4", "filename": "CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/2a4ab9d3f790deb7543cda551eb53fd5aa48b84c/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/2a4ab9d3f790deb7543cda551eb53fd5aa48b84c/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=2a4ab9d3f790deb7543cda551eb53fd5aa48b84c", "patch": "@@ -481,10 +481,10 @@ endif()\n ##\n ## Test for Vc\n ##\n-set(OLD_CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} )\n-set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake/modules )\n set(HAVE_VC FALSE)\n if( NOT MSVC)\n+    set(OLD_CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} )\n+    set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake/modules )\n     macro_optional_find_package(Vc 1.0.0)\n     macro_log_feature(Vc_FOUND \"Vc\" \"Portable, zero-overhead SIMD library for C++\" \"https://github.com/VcDevel/Vc\" FALSE \"\" \"Required by the Krita for vectorization\")\n     macro_bool_to_01(Vc_FOUND HAVE_VC)"}]}, {"sha": "2cf3d7b7e9a6dcf5bed5a15ade5306472bbe7fed", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "b6d3c7413bfe3ebb24772ad0aeb92d9b6edd9f40", "filename": "CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/2cf3d7b7e9a6dcf5bed5a15ade5306472bbe7fed/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/2cf3d7b7e9a6dcf5bed5a15ade5306472bbe7fed/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=2cf3d7b7e9a6dcf5bed5a15ade5306472bbe7fed", "patch": "@@ -489,8 +489,8 @@ if( NOT MSVC)\n     macro_log_feature(Vc_FOUND \"Vc\" \"Portable, zero-overhead SIMD library for C++\" \"https://github.com/VcDevel/Vc\" FALSE \"\" \"Required by the Krita for vectorization\")\n     macro_bool_to_01(Vc_FOUND HAVE_VC)\n     macro_bool_to_01(PACKAGERS_BUILD DO_PACKAGERS_BUILD)\n+    configure_file(config-vc.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config-vc.h )\n endif()\n-configure_file(config-vc.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config-vc.h )\n \n if(HAVE_VC)\n     message(STATUS \"Vc found!\")"}]}, {"sha": "47ae70a8a600daccdb4bb29611cab344644d8c88", "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "200d138eb3ae570481eeaa17f489ce49242633a3", "filename": "CMakeLists.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/KDE/krita/blob/47ae70a8a600daccdb4bb29611cab344644d8c88/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/47ae70a8a600daccdb4bb29611cab344644d8c88/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=47ae70a8a600daccdb4bb29611cab344644d8c88", "patch": "@@ -489,8 +489,8 @@ if( NOT MSVC)\n     macro_log_feature(Vc_FOUND \"Vc\" \"Portable, zero-overhead SIMD library for C++\" \"https://github.com/VcDevel/Vc\" FALSE \"\" \"Required by the Krita for vectorization\")\n     macro_bool_to_01(Vc_FOUND HAVE_VC)\n     macro_bool_to_01(PACKAGERS_BUILD DO_PACKAGERS_BUILD)\n-    configure_file(config-vc.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config-vc.h )\n endif()\n+configure_file(config-vc.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config-vc.h )\n \n if(HAVE_VC)\n     message(STATUS \"Vc found!\")"}]}, {"sha": "b59c82891bf54f1cdc222790981246d896991f9b", "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "b6d3c7413bfe3ebb24772ad0aeb92d9b6edd9f40", "filename": "CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/KDE/krita/blob/b59c82891bf54f1cdc222790981246d896991f9b/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/b59c82891bf54f1cdc222790981246d896991f9b/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=b59c82891bf54f1cdc222790981246d896991f9b", "patch": "@@ -481,10 +481,10 @@ endif()\n ##\n ## Test for Vc\n ##\n+set(OLD_CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} )\n+set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake/modules )\n set(HAVE_VC FALSE)\n if( NOT MSVC)\n-    set(OLD_CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} )\n-    set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake/modules )\n     macro_optional_find_package(Vc 1.0.0)\n     macro_log_feature(Vc_FOUND \"Vc\" \"Portable, zero-overhead SIMD library for C++\" \"https://github.com/VcDevel/Vc\" FALSE \"\" \"Required by the Krita for vectorization\")\n     macro_bool_to_01(Vc_FOUND HAVE_VC)"}]}, {"sha": "f9e03729b690042ca92ce36acfb564a828d5cb27", "stats": {"total": 18, "additions": 10, "deletions": 8}, "files": [{"sha": "28c5c025807c82ef35bce7b73ac7350cb15f2dc4", "filename": "CMakeLists.txt", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/KDE/krita/blob/f9e03729b690042ca92ce36acfb564a828d5cb27/CMakeLists.txt", "raw_url": "https://github.com/KDE/krita/raw/f9e03729b690042ca92ce36acfb564a828d5cb27/CMakeLists.txt", "contents_url": "https://api.github.com/repos/KDE/krita/contents/CMakeLists.txt?ref=f9e03729b690042ca92ce36acfb564a828d5cb27", "patch": "@@ -481,14 +481,16 @@ endif()\n ##\n ## Test for Vc\n ##\n-set(OLD_CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} )\n-set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake/modules )\n-macro_optional_find_package(Vc 1.0.0)\n-macro_log_feature(Vc_FOUND \"Vc\" \"Portable, zero-overhead SIMD library for C++\" \"https://github.com/VcDevel/Vc\" FALSE \"\" \"Required by the Krita for vectorization\")\n-macro_bool_to_01(Vc_FOUND HAVE_VC)\n-macro_bool_to_01(PACKAGERS_BUILD DO_PACKAGERS_BUILD)\n-\n-configure_file(config-vc.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config-vc.h )\n+set(HAVE_VC FALSE)\n+if( NOT MSVC)\n+    set(OLD_CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} )\n+    set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake/modules )\n+    macro_optional_find_package(Vc 1.0.0)\n+    macro_log_feature(Vc_FOUND \"Vc\" \"Portable, zero-overhead SIMD library for C++\" \"https://github.com/VcDevel/Vc\" FALSE \"\" \"Required by the Krita for vectorization\")\n+    macro_bool_to_01(Vc_FOUND HAVE_VC)\n+    macro_bool_to_01(PACKAGERS_BUILD DO_PACKAGERS_BUILD)\n+    configure_file(config-vc.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config-vc.h )\n+endif()\n \n if(HAVE_VC)\n     message(STATUS \"Vc found!\")"}]}, {"sha": "8a3ba3327dcc8a4ac33df0e5a74e1eeb842dba8a", "stats": {"total": 1, "additions": 0, "deletions": 1}, "files": [{"sha": "7bc69baff7e60351f63c4747bb143457b4a28913", "filename": "libs/ui/KisImportExportFilter.cpp", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/KDE/krita/blob/8a3ba3327dcc8a4ac33df0e5a74e1eeb842dba8a/libs/ui/KisImportExportFilter.cpp", "raw_url": "https://github.com/KDE/krita/raw/8a3ba3327dcc8a4ac33df0e5a74e1eeb842dba8a/libs/ui/KisImportExportFilter.cpp", "contents_url": "https://api.github.com/repos/KDE/krita/contents/libs/ui/KisImportExportFilter.cpp?ref=8a3ba3327dcc8a4ac33df0e5a74e1eeb842dba8a", "patch": "@@ -21,7 +21,6 @@ Boston, MA 02110-1301, USA.\n #include \"KisImportExportFilter.h\"\n \n #include <QFile>\n-#include <QUrl>\n #include <QTemporaryFile>\n #include <kis_debug.h>\n #include <QStack>"}]}]